(function(win){var spectrumDeviceManager={OnDeviceVisibleCallbacks:[],Initialize:function(){wireEventHandlers();if(!win.spectrumPathDevices){return;}for(var i=0;i<win.spectrumPathDevices.length;i++){var pathDeviceModel=win.spectrumPathDevices[i];if(!pathDeviceModel){continue;}var pathDeviceConstructor=pathDeviceModel.DeviceType+"PathDevice";if(eval("typeof "+pathDeviceConstructor)!=="function"){continue;}var pathDeviceInstance=eval("new "+pathDeviceConstructor+"();");if(!pathDeviceInstance){continue;}pathDeviceInstance.PathDeviceModel=pathDeviceModel;pathDeviceInstancesMap[pathDeviceModel.Id]=pathDeviceInstance;pathDeviceModel.deviceSettings=loadDeviceSettingsFromCookie(pathDeviceModel.Id);if(typeof pathDeviceInstance.Init==="function"){pathDeviceInstance.Init(pathDeviceModel);}}for(var j=0;j<win.spectrumStepDevicePlacements.length;j++){var stepDevicePlacement=win.spectrumStepDevicePlacements[j];if(!stepDevicePlacement){continue;}var stepDeviceInstance=spectrumDeviceManager.CreateStepDeviceInstance(stepDevicePlacement);if(!stepDeviceInstance){continue;}var renderDeviceAsHidden=(stepDevicePlacement.DisplayTrigger==="OnSubmit");var isRenderedDeviceVisible=renderDevice(stepDeviceInstance,renderDeviceAsHidden,false);if(isRenderedDeviceVisible&&stepDevicePlacement.PresentationStyle!=win.DevicePresentationStyles.Lightbox){invokeRegisteredCallbacksForDevice(stepDeviceInstance);}if(stepDevicePlacement.PresentationStyle===win.DevicePresentationStyles.Lightbox&&stepDevicePlacement.DisplayTrigger==="OnLoad"){showDeviceInLightbox(stepDeviceInstance,null,false);}}Notifications.Notify("onafter-device-render-completion",null);},CreateStepDeviceInstance:function(stepDevicePlacement){if(!stepDevicePlacement){return null;}if(stepDeviceInstancesMap[stepDevicePlacement.Id]){return stepDeviceInstancesMap[stepDevicePlacement.Id];}var pathDeviceModel2=findPathDeviceModelById(stepDevicePlacement.DeviceModelId);if(!pathDeviceModel2){return null;}stepDevicePlacement.DeviceModel=pathDeviceModel2;var userDeviceType=window.spectrumDeviceType||"DESKTOP";var isMobile=userDeviceType=="MOBILE";if(isMobile){transformDevicePlacementForMobile(stepDevicePlacement);}var stepDeviceConstructor=pathDeviceModel2.DeviceType+"StepDevice";if(eval("typeof "+stepDeviceConstructor)!=="function"){return null;}var stepDeviceInstance=eval("new "+stepDeviceConstructor+"();");if(!stepDeviceInstance){return null;}stepDeviceInstance.PathDeviceModel=pathDeviceModel2;stepDeviceInstance.StepDevicePlacement=stepDevicePlacement;if(typeof stepDeviceInstance.Init==="function"){stepDeviceInstance.Init(pathDeviceModel2,stepDevicePlacement,userDeviceType);}stepDeviceInstancesMap[stepDevicePlacement.Id]=stepDeviceInstance;return stepDeviceInstance;},GetPathDeviceModelsByType:function(deviceType){var filteredModels=new Array();if(!win.spectrumPathDevices){return filteredModels;}for(var i=0;i<win.spectrumPathDevices.length;i++){var pathDeviceModel=win.spectrumPathDevices[i];if(!pathDeviceModel){continue;}if(pathDeviceModel.DeviceType===deviceType){filteredModels.push(pathDeviceModel);}}return filteredModels;},SaveDevice:function(pathDeviceModel){saveDeviceSettingsToCookie(pathDeviceModel.Id,pathDeviceModel.deviceSettings);},ShowDevice:function(pathDeviceModelId){if(isNaN(pathDeviceModelId)){return;}if(pathDeviceModelId<=0){return;}var placementsForPathDevice=findStepDevicesByPathDevice(pathDeviceModelId);if(placementsForPathDevice.length<=0){return;}var placement=placementsForPathDevice[0];if(!placement){return;}if(placement.PresentationStyle===win.DevicePresentationStyles.Lightbox){var deviceInstance=stepDeviceInstancesMap[placement.Id];showDeviceInLightbox(deviceInstance,null,true);}},ShowTabDevices:function(tabIndex,isSummaryTab,devicePlacementsInCurrentTab){if(isNaN(tabIndex)){return;}var tab=isSummaryTab?$("[id$='tab_summary']"):$(".tab"+tabIndex);var devicePlaceholders=tab.children('div[id^="spectrumProductAdminDevice_"]');if(devicePlaceholders.length<=0){return;}devicePlaceholders.each(function(index,item){var placeholderId=$(item).attr("id");if(!placeholderId||!placeholderId.length){return;}var splits=placeholderId.split("spectrumProductAdminDevice_");if(!splits||splits.length!=2){return;}var devicePlacementId=splits[1];if(!devicePlacementId||isNaN(devicePlacementId)){return;}devicePlacementId=parseInt(devicePlacementId);var deviceInstance=stepDeviceInstancesMap[devicePlacementId];if(!deviceInstance){return;}var placement=deviceInstance.StepDevicePlacement;if(!placement){return;}if(placement.DisplayTrigger==="OnTabLoad"){var shoulDisplayInLightbox=placement.PresentationStyle===win.DevicePresentationStyles.Lightbox;if(shoulDisplayInLightbox){showDeviceInLightbox(deviceInstance,$(item),false);}else{showInPageDevice(placeholderId,deviceInstance);invokeRegisteredCallbacksForDevice(deviceInstance);}}});},ForEachStepDeviceInstance:function(deviceFilters,callback){if(!win.spectrumStepDevicePlacements){return false;}for(var j=0;j<win.spectrumStepDevicePlacements.length;j++){var devicePlacement=win.spectrumStepDevicePlacements[j];if(!devicePlacement){continue;}var sdim=stepDeviceInstancesMap;var deviceInstance=sdim[devicePlacement.Id];if(!deviceInstance){continue;}var pathDeviceModel=deviceInstance.PathDeviceModel;if(!pathDeviceModel){continue;}if(deviceFilters.DeviceType&&pathDeviceModel.DeviceType!==deviceFilters.DeviceType){continue;}if(!isNaN(deviceFilters.DeviceModelId)&&pathDeviceModel.Id!==deviceFilters.DeviceModelId){continue;}if(deviceFilters.DisplayTrigger&&deviceFilters.DisplayTrigger!==devicePlacement.DisplayTrigger){continue;}var shouldBreak=callback(deviceInstance);if(shouldBreak){return true;}}return false;},RefreshDevice:function(deviceInstance,deviceFilters){renderDevice(deviceInstance,deviceFilters.renderAsHidden,true);if(deviceInstance.StepDevicePlacement&&(deviceInstance.StepDevicePlacement.PresentationStyle===DevicePresentationStyles.Lightbox)){showDeviceInLightbox(deviceInstance,null,deviceFilters.forceDisplay);}},HideCurrentlyActiveLightbox:function(){if(!currentlyActiveLightbox){return;}SpectrumLightbox.HideLightbox(currentlyActiveLightbox);currentlyActiveLightbox=null;},GetCartController:function(){return getCartController();},GetAbandonedCartController:function(renderer,controller,emptyCartMessage,stepDevicePlacementId){return getAbandonedCartDeviceCartController(renderer,controller,emptyCartMessage,stepDevicePlacementId);},DeletePathDeviceCookies:function(){if(!win.spectrumPathDevices){return;}for(var i=0;i<win.spectrumPathDevices.length;i++){var pathDeviceModel=win.spectrumPathDevices[i];if(!pathDeviceModel){continue;}win.DeleteCookie("sdm_"+pathDeviceModel.Id,null,win.globalDomainName);}},FindPathDeviceModelById:function(deviceModelId){return findPathDeviceModelById(deviceModelId);},GetPriceSettingsForDevice:function(stepDevicePlacementId,offerCode){var stepDeviceIsntance=stepDeviceInstancesMap[stepDevicePlacementId];if(!stepDeviceIsntance){return null;}if(stepDeviceIsntance.PathDeviceModel&&stepDeviceIsntance.PathDeviceModel.DeviceType==="AbandonedCart"){return priceSettingsFromAbandonedCartItem(stepDeviceIsntance,offerCode);}if(!stepDeviceIsntance.PathDeviceModel||!stepDeviceIsntance.PathDeviceModel.PriceSettings){return null;}return stepDeviceIsntance.PathDeviceModel.PriceSettings;},RegisterDeviceVisibleCallback:function(callback,presentationStyle,displayTrigger){this.OnDeviceVisibleCallbacks.push({Callback:callback,PresentationStyle:presentationStyle,DisplayTrigger:displayTrigger});},GetCartItemInfoBy:function(devicePlacemetId){var stepDeviceInstance=stepDeviceInstancesMap[devicePlacemetId];if(!stepDeviceInstance){return null;}var deviceModel=stepDeviceInstance.PathDeviceModel;if(!deviceModel){return null;}var lineupId,mailId,priceSettings=null;switch(deviceModel.DeviceType){case"DealPop":lineupId=deviceModel.LineupId;mailId=deviceModel.OfflineMailingId;priceSettings=deviceModel.PriceSettings;break;case"FusionProductsTab":lineupId=deviceModel.FusionLineUpId;mailId=deviceModel.FusionMailId;priceSettings=deviceModel.PriceSettings;break;default:break;}return{lineupId:lineupId,mailId:mailId,priceSettings:priceSettings};},GetAbanondedCartItemAndGroupBy:function(offerCode){var abandonedCartDeviceModel=spectrumDeviceManager.GetPathDeviceModelsByType("AbandonedCart");if(!abandonedCartDeviceModel){return null;}abandonedCartDeviceModel=abandonedCartDeviceModel[0];var item=null;for(var i=0;i<abandonedCartDeviceModel.AbandonedCartForUser.Items.length;i++){if(abandonedCartDeviceModel.AbandonedCartForUser.Items[i].Id!=offerCode){continue;}item=abandonedCartDeviceModel.AbandonedCartForUser.Items[i];break;}var group=null;for(var j=0;j<abandonedCartDeviceModel.AbandonedCartForUser.ItemGroups.length;j++){if(abandonedCartDeviceModel.AbandonedCartForUser.ItemGroups[j].Id!=item.GroupId){continue;}group=abandonedCartDeviceModel.AbandonedCartForUser.ItemGroups[j];break;}return{Item:item,OfferGroup:group};}};function priceSettingsFromAbandonedCartItem(stepDeviceIsntance,offerCode){if(!stepDeviceIsntance||!offerCode){return null;}var deviceModel=stepDeviceIsntance.PathDeviceModel;if(!deviceModel){return null;}var abandonedCart=deviceModel.AbandonedCartForUser;if(!abandonedCart){return null;}var items=abandonedCart.Items;if(!items){return null;}for(var i=0;i<items.length;i++){var item=items[i];if($.trim(item.Id)!==$.trim(offerCode)){continue;}return item.PriceSettings;}return null;}function transformDevicePlacementForMobile(stepDevicePlacement){if(!stepDevicePlacement){return;}if(stepDevicePlacement.PresentationStyle==DevicePresentationStyles.Lightbox){stepDevicePlacement.PresentationStyle=DevicePresentationStyles.InPage;}}function findPathDeviceModelById(deviceModelId){if(!win.spectrumPathDevices){return null;}for(var i=0;i<win.spectrumPathDevices.length;i++){var pathDeviceModel=win.spectrumPathDevices[i];if(!pathDeviceModel){continue;}if(pathDeviceModel.Id===deviceModelId){return pathDeviceModel;}}return null;}function findStepDevicesByPathDevice(pathDeviceModelId){if(!win.spectrumStepDevicePlacements){return null;}var filteredPlacements=[];for(var i=0;i<win.spectrumStepDevicePlacements.length;i++){var placement=win.spectrumStepDevicePlacements[i];if(!placement){continue;}if(placement.DeviceModelId===pathDeviceModelId){filteredPlacements.push(placement);}}return filteredPlacements;}function renderDevice(deviceInstance,renderAsHidden,refreshDevice){if(!deviceInstance){return false;}var stepDevicePlacement=deviceInstance.StepDevicePlacement;if(!stepDevicePlacement||!stepDevicePlacement.Position){return false;}var pathDeviceModel=deviceInstance.PathDeviceModel;if(!pathDeviceModel){return false;}var hasBeenPresented=pathDeviceModel.deviceSettings&&pathDeviceModel.deviceSettings.hasBeenPresented;var shouldShowDevice=evaluateDeviceCondition(stepDevicePlacement.DisplayCondition,hasBeenPresented);if(!shouldShowDevice){renderAsHidden=true;}var isRenderSuccessful;if(stepDevicePlacement.Position.IsPackageSlot){isRenderSuccessful=renderDeviceInPackageSlot(stepDevicePlacement.Position.PositionName,deviceInstance,renderAsHidden,refreshDevice);if(!renderAsHidden&&isRenderSuccessful){callDeviceVisible(deviceInstance);signalDeviceShownForInpageDevices(deviceInstance);}return(!renderAsHidden&&isRenderSuccessful);}if(stepDevicePlacement.Position.PositionName===win.DevicePositions.None){renderDeviceInNonePosition(deviceInstance,refreshDevice);return false;}if(stepDevicePlacement.Position.PositionName===win.DevicePositions.AboveOfferingArea){isRenderSuccessful=renderDeviceAboveOfferingArea(deviceInstance,renderAsHidden,refreshDevice);if(!renderAsHidden&&isRenderSuccessful){callDeviceVisible(deviceInstance);signalDeviceShownForInpageDevices(deviceInstance);}return(!renderAsHidden&&isRenderSuccessful);}if(stepDevicePlacement.Position.PositionName===win.DevicePositions.WithinOfferingArea){isRenderSuccessful=renderDeviceInProductAdminTab(deviceInstance,refreshDevice,renderAsHidden);return(!renderAsHidden&&isRenderSuccessful);}if(stepDevicePlacement.Position.PositionName===win.DevicePositions.WithinSummaryTab){isRenderSuccessful=renderDeviceInProductAdminTab(deviceInstance,refreshDevice,renderAsHidden);return(!renderAsHidden&&isRenderSuccessful);}return false;}function showInPageDevice(placeholderId,deviceInstance){var device=$("#"+placeholderId);if(!device){return false;}var pathDeviceModel=deviceInstance.PathDeviceModel;if(!pathDeviceModel){return false;}var hasBeenPresented=pathDeviceModel.deviceSettings&&pathDeviceModel.deviceSettings.hasBeenPresented;var stepDevicePlacement=deviceInstance.StepDevicePlacement;if(!stepDevicePlacement||!stepDevicePlacement.DisplayCondition){return false;}var shouldShowDevice=evaluateDeviceCondition(stepDevicePlacement.DisplayCondition,hasBeenPresented);if(shouldShowDevice){device.show();if(typeof deviceInstance.AfterDeviceIsVisible==="function"){deviceInstance.AfterDeviceIsVisible();}signalDeviceShownForInpageDevices(deviceInstance);return true;}if(device.is(":visible")){device.hide();}return false;}function signalDeviceShownForInpageDevices(deviceInstance){if(!deviceInstance||!deviceInstance.StepDevicePlacement){return;}var stepDevicePlacement=deviceInstance.StepDevicePlacement;if(stepDevicePlacement.PresentationStyle===win.DevicePresentationStyles.InPage){signalDeviceShownAndSaveDeviceSettings(deviceInstance);}}function renderDeviceInNonePosition(deviceInstance,refreshDevice){var formElement=$("form");if(!formElement||formElement.length<=0){return false;}var deviceElement=refreshDevice?callDeviceRefresh(deviceInstance,formElement):callDeviceRender(deviceInstance,formElement);var isRenderSuccessful=deviceElement&&deviceElement.length>0;if(isRenderSuccessful){deviceElement.hide();}return isRenderSuccessful;}function renderDeviceAboveOfferingArea(deviceInstance,renderAsHidden,refreshDevice){if(!deviceInstance){return false;}var placement=deviceInstance.StepDevicePlacement;var isLightbox=(placement&&placement.PresentationStyle===win.DevicePresentationStyles.Lightbox);var shouldHide=renderAsHidden||isLightbox;var renderTarget=$("#spectrumAboveOfferingAreaDevices");var deviceElement=refreshDevice?callDeviceRefresh(deviceInstance,renderTarget):callDeviceRender(deviceInstance,renderTarget);var isRenderSuccessful=deviceElement&&deviceElement.length>0;if(isRenderSuccessful&&shouldHide){deviceElement.hide();}return isRenderSuccessful;}function showDeviceInLightbox(stepDeviceInstance,deviceContainer,forceDisplay){if(!stepDeviceInstance){return false;}var stepDevicePlacement=stepDeviceInstance.StepDevicePlacement;if(!stepDevicePlacement){return false;}var pathDeviceModel=stepDeviceInstance.PathDeviceModel;if(!pathDeviceModel){return false;}var deviceSettings=pathDeviceModel.deviceSettings||{};var hasBeenPresented=deviceSettings.hasBeenPresented;var shouldShowDevice=evaluateDeviceCondition(stepDevicePlacement.DisplayCondition,hasBeenPresented);if(!forceDisplay&&!shouldShowDevice){return false;}var lightboxId="spectrumDeviceLightbox_"+stepDevicePlacement.Id;var containerAttributes={id:lightboxId,"class":"spectrumLightbox_content2"};var lightboxContainer=$("div#"+lightboxId);if(!lightboxContainer||lightboxContainer.length<=0){lightboxContainer=$("<div></div>",containerAttributes);}$("form").append(lightboxContainer);if(!stepDeviceInstance.DeviceContent){return false;}var containerHaveChildren=lightboxContainer.children().length>0;if(!containerHaveChildren){lightboxContainer.append(stepDeviceInstance.DeviceContent);}stepDeviceInstance.DeviceContent.show(0,function(){showLightBoxContentCallBack(stepDeviceInstance,deviceContainer,lightboxContainer);});return true;}function showLightBoxContentCallBack(stepDeviceInstance,deviceContainer,lightboxContainer){currentlyActiveLightbox={content:lightboxContainer,data:stepDeviceInstance,displaySettings:{top:20,closeOnOverlayClick:false},showCallback:function(){callDeviceVisible(stepDeviceInstance);invokeRegisteredCallbacksForDevice(stepDeviceInstance);}};var stepDevicePlacement=stepDeviceInstance.StepDevicePlacement;var isWithinOfferingArea=(stepDevicePlacement.Position.PositionName===win.DevicePositions.WithinOfferingArea);if(isWithinOfferingArea){currentlyActiveLightbox.displaySettings.scrollToTop=false;}if(typeof stepDeviceInstance.GetLightboxDisplaySettings==="function"){var displaySettings=stepDeviceInstance.GetLightboxDisplaySettings();overrideObject(currentlyActiveLightbox.displaySettings,displaySettings);}if(stepDevicePlacement.Position.PositionName===DevicePositions.WithinOfferingArea&&window.MpUtils){window.MpUtils.ScrollToMultipage(true);}if(deviceContainer&&deviceContainer.length>0){deviceContainer.show(0,function(){SpectrumLightbox.ShowLightbox(currentlyActiveLightbox);});}else{SpectrumLightbox.ShowLightbox(currentlyActiveLightbox);}signalDeviceShownAndSaveDeviceSettings(stepDeviceInstance);}function signalDeviceShownAndSaveDeviceSettings(stepDeviceInstance){var pathDeviceModel=stepDeviceInstance.PathDeviceModel;var deviceSettings=pathDeviceModel.deviceSettings||{};deviceSettings.hasBeenPresented=(stepDeviceInstance.DeviceContent&&stepDeviceInstance.DeviceContent.length>0)?true:false;pathDeviceModel.deviceSettings=deviceSettings;saveDeviceSettingsToCookie(pathDeviceModel.Id,deviceSettings);}function renderDeviceInPackageSlot(slotName,deviceInstance,renderAsHidden,refreshDevice){if(!deviceInstance){return false;}if(!slotName||!slotName.length){slotName="deviceSlot1";}var renderTarget=$("#"+slotName);var deviceElement=refreshDevice?callDeviceRefresh(deviceInstance,renderTarget):callDeviceRender(deviceInstance,renderTarget);var placement=deviceInstance.StepDevicePlacement;var isLightbox=(placement&&placement.PresentationStyle===win.DevicePresentationStyles.Lightbox);var shouldHide=renderAsHidden||isLightbox;var isRenderSuccessful=deviceElement&&deviceElement.length>0;if(isRenderSuccessful&&shouldHide){deviceElement.hide();}return isRenderSuccessful;}function renderDeviceInProductAdminTab(deviceInstance,refreshDevice,renderAsHidden){if(!deviceInstance){return false;}var placement=deviceInstance.StepDevicePlacement;if(!placement){return false;}var devicePlaceholder=$('.tab div[id^="spectrumProductAdminDevice_'+placement.Id+'"]');if(!devicePlaceholder||devicePlaceholder.length<=0){return false;}var deviceContent;if(refreshDevice){deviceContent=callDeviceRefresh(deviceInstance,devicePlaceholder);}else{deviceContent=callDeviceRender(deviceInstance,devicePlaceholder);}var isRenderSuccessful=deviceContent&&deviceContent.length>0;var isTriggerOnTabLoad=(placement&&placement.DisplayTrigger==="OnTabLoad");if(isTriggerOnTabLoad||renderAsHidden){devicePlaceholder.hide();}if(!isTriggerOnTabLoad&&!renderAsHidden&&isRenderSuccessful){signalDeviceShownForInpageDevices(deviceInstance);}return isRenderSuccessful;}function callDeviceRender(deviceInstance,renderTarget){if(!deviceInstance){return null;}if(typeof deviceInstance.Render!=="function"){return null;}deviceInstance.DeviceContent=deviceInstance.Render(renderTarget);if(deviceInstance.DeviceContent&&deviceInstance.DeviceContent.length>0){setHasBeenRendered(deviceInstance,true);}return deviceInstance.DeviceContent;}function callDeviceRefresh(deviceInstance,renderTarget){if(!deviceInstance){return null;}if(typeof deviceInstance.Refresh!=="function"){return callDeviceRender(deviceInstance,renderTarget);}deviceInstance.DeviceContent=deviceInstance.Refresh(renderTarget);setHasBeenRendered(deviceInstance,true);return deviceInstance.DeviceContent;}function setHasBeenRendered(deviceInstance,hasBeenRendered){var pathDeviceModel=deviceInstance.PathDeviceModel;var deviceSettings=pathDeviceModel.deviceSettings||{};deviceSettings.hasBeenRendered=hasBeenRendered;pathDeviceModel.deviceSettings=deviceSettings;}function wireEventHandlers(){if(!window.Notifications){return;}Notifications.Subscribe("on-spectrum-form-submit",renderOnSubmitDevices,true);Notifications.Subscribe("on-spectrum-form-submit",onSpectrumFormSubmit,true);Notifications.Subscribe("on-cart-item-added",onCartItemAdded,true);}function renderOnSubmitDevices(){if(!win.spectrumStepDevicePlacements){return NotificationResults.Continue;}var userDeviceType=window.spectrumDeviceType||"DESKTOP";var isMobile=userDeviceType=="MOBILE";if(isMobile){return NotificationResults.Continue;}var shouldCancel=spectrumDeviceManager.ForEachStepDeviceInstance({DisplayTrigger:"OnSubmit"},function(deviceInstance){var pathDeviceModel=deviceInstance.PathDeviceModel;if(!pathDeviceModel){return false;}var devicePlacement=deviceInstance.StepDevicePlacement;if(devicePlacement.PresentationStyle==win.DevicePresentationStyles.Lightbox){if(showDeviceInLightbox(deviceInstance,null,false)){return true;}return false;}if(deviceInstance.DeviceContent&&deviceInstance.DeviceContent.length>0){deviceInstance.DeviceContent.show();}return false;});return shouldCancel?NotificationResults.Cancel:NotificationResults.Continue;}function onSpectrumFormSubmit(){var sdm=spectrumDeviceManager;sdm.ValidationStatus=validateDevices();if(sdm.ValidationStatus!==DeviceValidationStatuses.Success){return NotificationResults.Cancel;}saveAllDevicesToCookie();return NotificationResults.Continue;}function onCartItemAdded(sender,cartItem){spectrumDeviceManager.ForEachStepDeviceInstance({DisplayTrigger:"OnAddToCart"},function(deviceInstance){if(!deviceInstance.DeviceContent||deviceInstance.DeviceContent.length<=0){return;}callDeviceVisible(deviceInstance,cartItem);invokeRegisteredCallbacksForDevice(deviceInstance);});}function saveAllDevicesToCookie(){var sdim=stepDeviceInstancesMap;for(var placementId in sdim){var stepDeviceInstance=sdim[placementId];if(!stepDeviceInstance){continue;}var pathDeviceModel=stepDeviceInstance.PathDeviceModel;if(!pathDeviceModel){continue;}var settings=pathDeviceModel.deviceSettings;if(typeof stepDeviceInstance.GetSettings==="function"){settings=stepDeviceInstance.GetSettings();}saveDeviceSettingsToCookie(pathDeviceModel.Id,settings);}}function saveDeviceSettingsToCookie(pathDeviceModelId,deviceSettings){if(!pathDeviceModelId||isNaN(pathDeviceModelId)){return;}if(!deviceSettings||$.isEmptyObject(deviceSettings)){return;}if(typeof win.SetCookie!=="function"){return;}var cookieValue=$.toJSON(deviceSettings);win.SetCookie("sdm_"+pathDeviceModelId,cookieValue,null,null,win.globalDomainName,false);}function loadDeviceSettingsFromCookie(pathDeviceModelId){if(!pathDeviceModelId||isNaN(pathDeviceModelId)){return null;}if(typeof win.GetCookie!=="function"){return null;}var cookieValue=win.GetCookie("sdm_"+pathDeviceModelId);if(!cookieValue||!cookieValue.length){return null;}var settings=$.parseJSON(cookieValue);return settings;}function validateDevices(){var pdim=pathDeviceInstancesMap;for(var deviceModelId in pdim){var pathDeviceInstance=pdim[deviceModelId];if(!pathDeviceInstance){continue;}var pathDeviceModel=pathDeviceInstance.PathDeviceModel;if(!pathDeviceModel){continue;}if(pathDeviceInstance&&typeof pathDeviceInstance.Validate==="function"){var validationStatus=pathDeviceInstance.Validate(deviceValidationCallback);if(validationStatus===DeviceValidationStatuses.Failure){return validationStatus;}else{if(validationStatus===DeviceValidationStatuses.Wait){enterWaitMode();return validationStatus;}}}}return DeviceValidationStatuses.Success;}function deviceValidationCallback(pathDeviceInstance,validationStatus){if(validationStatus!==DeviceValidationStatuses.Success){return;}exitWaitMode();SpectrumRegistrationCore.Controller.OnSpectrumFormSubmit();}function evaluateDeviceCondition(displayCondition,hasBeenPresented){if(!displayCondition||displayCondition.length<=0){return false;}var cartCount=0;try{cartCount=getCartController().Cart.CountOrderable();}catch(e){}var deviceDisplayParams=buildDeviceDisplayParams(SpectrumUtils.GetOrderLimit(),cartCount,hasBeenPresented);eval("window.conditionEvaluator = function (params) { return ("+displayCondition+"); };");if(!window.conditionEvaluator){return false;}return window.conditionEvaluator(deviceDisplayParams);}function buildDeviceDisplayParams(orderLimit,cartCount,hasBeenPresented){return{OrderLimit:orderLimit,CartCount:cartCount,IsDeviceShown:hasBeenPresented};}function enterWaitMode(){}function exitWaitMode(){}function overrideObject(targetObject,overridingObject){if(!targetObject||!overridingObject){return;}for(var prop in overridingObject){if(!prop){continue;}var overridingValue=overridingObject[prop];if(typeof overridingValue==="undefined"){continue;}targetObject[prop]=overridingValue;}}function callDeviceVisible(deviceInstance,args){if(!deviceInstance||typeof deviceInstance.OnDeviceVisible!=="function"){return;}deviceInstance.OnDeviceVisible(args);}var cartController=null;function getCartController(){if(!cartController){cartController=win._cart||CartControllerFactory.CreateDefault();cartController.Cart=SpectrumUtils.GetCart();var orderLimit=SpectrumUtils.GetOrderLimit();if(orderLimit!=null&&cartController.Cart){cartController.Cart.LimitSize=orderLimit;}}return cartController;}function getAbandonedCartDeviceCartController(renderer,controller,emptyCartMessage,stepDevicePlacementId){if(!win._cart){win._cart=null;}cartController=CartControllerFactory.CreateAbandonedCartDeviceController(renderer,controller,emptyCartMessage,stepDevicePlacementId);cartController.Cart=SpectrumUtils.GetCart();var orderLimit=SpectrumUtils.GetOrderLimit();if(orderLimit!=null&&cartController.Cart){cartController.Cart.LimitSize=orderLimit;}return cartController;}function invokeRegisteredCallbacksForDevice(deviceInstance){if(!spectrumDeviceManager.OnDeviceVisibleCallbacks.length){return;}for(var i=0;i<spectrumDeviceManager.OnDeviceVisibleCallbacks.length;i++){var registeredCallback=spectrumDeviceManager.OnDeviceVisibleCallbacks[i];if(registeredCallback.DisplayTrigger!=deviceInstance.StepDevicePlacement.DisplayTrigger){continue;}var presentationStyle=registeredCallback.PresentationStyle===win.DevicePresentationStyles.Lightbox?0:1;if(presentationStyle!=deviceInstance.StepDevicePlacement.PresentationStyle){continue;}if(typeof registeredCallback.Callback==="function"){registeredCallback.Callback(deviceInstance);}}}var pathDeviceInstancesMap={};var stepDeviceInstancesMap={};var currentlyActiveLightbox=null;win.SpectrumDeviceManager=spectrumDeviceManager;}(window));var DevicePresentationStyles={Lightbox:0,InPage:1};var DevicePositions={None:"None",AboveOfferingArea:"AboveOfferingArea",WithinOfferingArea:"WithinOfferingArea",WithinSummaryTab:"WithinSummaryTab"};var DeviceValidationStatuses={Success:0,Failure:1,Wait:2};var DeviceDisplayTrigger={OnLoad:"OnLoad",OnTabLoad:"OnTabLoad",OnSubmit:"OnSubmit",OnAddToCart:"OnAddToCart"};var optinDeviceJson=null;function OptinPathDevice(){}OptinPathDevice.prototype.Init=function(a){};(function(c){function b(){}b.prototype.Init=function(d,e){};b.prototype.Render=function(f,e){if(!f||!f.length){return null;}var g=$("script#optinDeviceTemplate");if(!g||!g.length){return null;}var d=g.render(this.StepDevicePlacement.DeviceModel);d.appendTo(f);if(!e){a();if(window.Notifications){window.Notifications.Notify("on-optins-available-for-analytics");}}return d;};b.prototype.Refresh=function(e){var f=new Array();$(".SpectrumOptinList input:not(:checked)").each(function(g,h){f.push($(h).attr("id"));});var d=this;d.DeviceContent.empty();d.DeviceContent=d.Render(e,true);$(".SpectrumOptinList input:checked").each(function(g,h){if($.inArray(h.id,f)!=-1){$(h).click();}});a();return d.DeviceContent;};b.prototype.GetOptinsFromModel=function(d){var e=this;if(!e||!e.StepDevicePlacement||!e.StepDevicePlacement.DeviceModel||!e.StepDevicePlacement.DeviceModel.SelectedOptins){return null;}var f={};$(e.StepDevicePlacement.DeviceModel.SelectedOptins).each(function(g,h){if(h.PreChecked==d){f[h.SubscriptionCode]=0;}});return f;};function a(){if(window.Notifications){window.Notifications.Notify("on-optins-render-complete");}}c.OptinStepDevice=b;}(window));(function(n){var l={Settings:{IsIdentPage:false,IsUserRecognized:false,TopButtonConfig:false},Initialize:function(r){var o=l;o.Settings=r||o.Settings;var q=n.SpectrumUniNavPresenter;o.Settings.TopButtonConfig=window.spectrumUniNavTopButtonConfig;if(!o.Settings.TopButtonConfig){o.Settings.TopButtonConfig={SupportsSignOutButton:true,SupportsSignInButton:true,SupportsRegisterButton:!o.Settings.IsIdentPage};}if(q.IsMobile){o.MyAccountPath=window.spectrumMyAccountUrl;o.SetupRulesAndFacts();o.SetUpFooterAndBunForMobile(o.Settings.IsIdentPage,o.Settings.IsUserRecognized);}else{o.SetupRulesAndFacts();o.SetupDesktopShelf();if(n.Notifications){Notifications.Subscribe("sign-in-successful",i);}var p=SpectrumRegistrationCore.Presenter;if(p&&p.IsInlineRegPresent){q.RemoveEditInfoSupport();}}o.SetupTopButton(r.IsUserRecognized,r.TopButtonConfig);},PopulateUserNameForDesktop:function(){var o=SpectrumRegistrationCore.Logger;o.LogInformation("SpectrumUniNavController.. Populating user name..");var p=b();n.SpectrumUniNavPresenter.PopulateUserName(p);if(n.SpectrumUniNavController.Settings.TopButtonConfig.SupportsSignOutButton){n.SpectrumUniNavPresenter.ShowSignOutLink();}},SetupDesktopShelf:function(){var p=n.SpectrumUniNavPresenter;p.InitializeDesktopShelf();var o=l;if(SpectrumRegistrationCore.IsUserRecognized()){i();}if(n.Notifications){Notifications.Subscribe("clear-unishelf-errors",function(){var q=SpectrumRegistrationCore;q.ClearSignInErrors();q.ClearCoreErrors();});Notifications.Subscribe("on-registration-response-dto-update",function(){o.PopulateUserNameForDesktop();});}},SetupRulesAndFacts:function(){var o=SpectrumRegistrationCore.Logger;o.LogInformation("SpectrumUniNavController.. Setting up Rules and Facts Links..");var p=a();n.SpectrumUniNavPresenter.PopulateRulesUrl(p);},SetupTopButton:function(o,r){var q=l;var p=n.SpectrumUniNavPresenter;if(o&&r.SupportsSignOutButton){q.ShowHeaderSignOut();return;}if(!o&&r.SupportsSignInButton){q.ShowHeaderSignIn();return;}if(!o&&r.SupportsRegisterButton){p.AttachRegisterButtonClickHandler(g);p.ShowRegisterButton();return;}},ShowHeaderSignOut:function(){var o=n.SpectrumUniNavPresenter;o.AttachSignOutButtonClickHandler(k,SpectrumRegistrationCore.HandleNotYouLink);o.ShowSignOutLink();o.ShowHeaderSignoutLink();},ShowHeaderSignIn:function(){var o=n.SpectrumUniNavPresenter;o.AttachSignInButtonClickHandler(h);o.ShowSignInButton();},SetUpFooterAndBunForMobile:function(o,q){var p=m(window.location.pathname,"MyAccount");if(p){return;}if(!q){return;}var r=n.SpectrumUniNavPresenter;r.ShowFooter();$(".lower-layer").insertAfter(".upper-layer");r.AttachHamburgerButtonClickHandler(e);r.ShowHamburgerButton();r.SetUserNameInMobileFooter(b());r.AttachFooterNameAndEditInfoClickHandlers(d);r.AttachBackButtonClickHandler(c);if(!o){r.ShowFooterSignOutLink();}}};function e(){var o=$("#hamburgerBunLink");var r=$(".upper-layer");var q=$(".lower-layer");var p=r.hasClass("slide-open");var s=document.querySelector("meta[name=viewport]");s.setAttribute("content","width=device-width, initial-scale=1.0, maximum-scale=1.0");if(!p){r.addClass("slide-open");q.addClass("slide-open");}else{r.removeClass("slide-open");q.removeClass("slide-open");if($(".upper-layer").has($("#uni-nav-top")).length>0){}else{$("#uni-nav-top").appendTo(".upper-layer");}}}function i(s,o){var p=SpectrumRegistrationCore.Logger;p.LogInformation("SpectrumUniNavController.. Personalize UI for desktop..");var q=SpectrumRegistrationCore.Controller;q.ShowCityAndState();q.RefreshOrderLimitsAndUI();if(o&&o.hasOwnProperty("sign-in")){q.DisableEmailFields();var r=SpectrumRegistrationCore.Presenter;r.HideFormField("Password");r.HideFormField("ConfirmPassword");}p.LogInformation("SpectrumUniNavController.. calling Shelf Management..");n.SpectrumUniNavPresenter.CloseShelfForDesktop();l.PopulateUserNameForDesktop();}function m(q,p){var o=q.indexOf(p);if(o>=0){return true;}return false;}function a(){var o=new String(document.location.pathname);o=o.replace("/Path/","");o=o.substr(0,o.indexOf("/"));o="http://rules.pch.com/viewrulesfacts?mailid="+o;return o;}function b(){var o=SpectrumRegistrationCore.Logger;o.LogInformation("SpectrumUniNavPresenter.. Retrieving Sepctrum Customer..");if(window.SpectrumRegistrationResponseDto){var p=window.SpectrumRegistrationResponseDto.SpectrumCustomer;if(p&&p.User){var q=p.User.FirstName+" "+p.User.LastName;if(q.trim().length>0){return q;}return p.User.Email;}}return null;}function j(){var o=window.SpectrumUtils.GetUrlParams();var p=o.pu||n.document.referrer;if(!p||p.length<=0){n.location.reload();return false;}SpectrumRegistrationCore.Utils.RedirectTo(p);return false;}function k(){if(n.Notifications){Notifications.Notify("sso-click-event",null,{linkLabel:"signout"});}var q=SpectrumRegistrationCore.Logger;q.LogInformation("SignOut()... Clearing cookies and redirecting...");window.showAlert="false";var p=SpectrumRegistrationCore;p.DeleteUserIdentificationAndCartCookies();var r=SpectrumRegistrationCore.Utils;switch(window.tokenSourceType){case"Acquisition":j();break;case"Main Path":r.RedirectTo(window.mainNotYouUrl);break;default:var o=window.spectrumUrlsAreRelative?window.baseUrl:"";r.RedirectTo(o+window.houseNotYouUrl);break;}}function h(){if(n.Notifications){Notifications.Notify("sso-click-event",null,{linkLabel:"signin"});}var o=window.SpectrumUtils.GetUrlParams();SpectrumRegistrationCore.Utils.RedirectTo((l.MyAccountPath+"SignIn.aspx"),o);return false;}function g(){if(n.Notifications){Notifications.Notify("sso-click-event",null,{linkLabel:"register"});}var o=SpectrumUtils.GetUrlParams().pu;if(!o){o=window.document.referrer;}if(!o){return false;}SpectrumRegistrationCore.Utils.RedirectTo(o);return false;}function f(){if(!m(window.location.href,$("#hamburgerBunLink").attr("href"))){window.location.href=window.location+$("#hamburgerBunLink").attr("href");}$("html,body").animate({scrollTop:$("#spectrumMobileUniNavFooter").offset().top},"slow");return false;}function d(){var o=SpectrumRegistrationCore.Utils;o.RedirectToEditInfo();return false;}function c(){e();}n.SpectrumUniNavController=l;})(window);(function(c){var b={IsMobile:(window.SpectrumUniNavIsMobile)?true:false,Settings:null,Initialize:function(e){var d=b;d.Settings=e||d.Settings;},PopulateRulesUrl:function(d){$("#uniNav1_RulesLink").attr("href",d);$("#uniNav1_FactsLink").attr("href",d+"#facts");$("#uniNavRules a:eq(1)").attr("href",d);$("#uniNavRules a:eq(2)").attr("href",d+"#facts");},ShowHeaderSignoutLink:function(){$("#signOutButtonDiv").show();},ShowSignInButton:function(){$("#signInButtonDiv").show();},ShowRegisterButton:function(){$("#registerButtonDiv").show();},ShowSignOutLink:function(){$("#hypSignOut").show();$("#hypEditInfo").is(":visible")?$("#seperaterLine").show():$("#seperaterLine").hide();},OnClickCall:function(e,d){$(e).click(function(f){if(f&&f.preventDefault){f.preventDefault();}d.call(this);});},AttachSignInButtonClickHandler:function(d){b.OnClickCall("#btnSignIn_Mobile",d);},AttachSignOutButtonClickHandler:function(e,d){b.OnClickCall("#btnSignOut_Mobile",e);b.OnClickCall("#signOutLink",d);},AttachRegisterButtonClickHandler:function(d){b.OnClickCall("#btnRegister_Mobile",d);},AttachHamburgerButtonClickHandler:function(d){b.OnClickCall("#hamburgerBunLink",d);},AttachFooterNameAndEditInfoClickHandlers:function(d){b.OnClickCall("#userNameLink",d);b.OnClickCall("#mobEditInfoLink",d);},AttachBackButtonClickHandler:function(d){b.OnClickCall("#backButtonLink",d);},SetUserNameInMobileFooter:function(d){$("#userNameLink").text(d);},ShowFooter:function(){$("#spectrumMobileUniNavFooter").show();},IsFooterVisible:function(){return $("#spectrumMobileUniNavFooter:visible").length>0;},ShowHamburgerButton:function(){$("#hamburgerBunLink").show();},ShowFooterSignOutLink:function(){$("#signOutLink").show();},InitializeDesktopShelf:function(){b.uniExp.Shelf.Initialize();},PopulateUserName:function(d){$("#hypName").text(d);$(".credentials").show();a();},RemoveEditInfoSupport:function(){$("#hypEditInfo").hide();$("#seperaterLine").hide();$("#hypName").removeAttr("href");$("#hypName").removeAttr("onclick");},CloseShelfForDesktop:function(){b.uniExp.Shelf.CloseShelf();}};function a(){var d=SpectrumRegistrationCore.Logger;d.LogInformation("SpectrumUniNavPresenter.. Hiding unrecognized bar..");$(".unrecognized-bar .content .unrecognized .sign-in").hide();}c.SpectrumUniNavPresenter=b;})(window);SpectrumUniNavPresenter=window.SpectrumUniNavPresenter||{};if(typeof SpectrumUniNavPresenter.uniExp!=="object"){SpectrumUniNavPresenter.uniExp={};}SpectrumUniNavPresenter.uniExp.Shelf={Header:null,Shelf:null,btnLoginIn:null,shelfState:null,closeX:null,signIn:null,imgLoader:null,shelfController:null,Initialize:function(){Header=$(".header");Shelf=Header.find("#uni_shelf");if(!Shelf.length||!Header.length){if(window.console){console.log("NO REGISTRATION FORM  MANAGER");}return false;}else{shelfController=SpectrumUniNavPresenter.uniExp.Shelf;signIn=$(".unrecognized").find("a.sign-in");var b={};var a=Shelf.find("div.content");closeX=a.find("div.close-x");btnLoginIn=a.find("button.btn-signin");imgLoader=btnLoginIn.next();shelfState=(Shelf.height()>0)?"open":"close";shelfController.ForEachItem(Shelf.find("div.sign-in.section fieldset fieldset"));closeX.bind("mouseup",shelfController.BindCloseX);signIn.bind("click",shelfController.SignInClick);btnLoginIn.bind("click",shelfController.BtnLoginInClick);b.openShelf=shelfController.OpenShelf;b.closeShelf=shelfController.CloseShelf;return b;}},BindCloseX:function(a){signIn.removeClass("active");shelfController.ClearErrors();shelfController.CloseShelf();},SignInClick:function(a){a.preventDefault();if($(this).hasClass("active")){return;}else{$(this).addClass("active");shelfController.ClearErrors();shelfController.OpenShelf();}},BtnLoginInClick:function(a){if($(this).hasClass("active")){return;}else{$(this).addClass("active");imgLoader.addClass("show");}},ForEachItem:function(a){a.each(function(c,b){var e=$(this).find("label span");var d=$(this).find('input[type!="checkbox"]');d.val("");e.bind("mouseup focus",function(f){e.addClass("light");d.focus();});d.bind("keyup",function(f){if($.trim($(this).val())===""){e.removeClass("hide");}else{e.addClass("hide");}});d.bind("blur",function(f){e.removeClass("light");});d.bind("focus",function(f){e.addClass("light");});});},OpenShelf:function(){if(shelfState==="close"){Shelf.animate({height:this.GetScrollHeight()+"px"},800,function(a){});shelfState="open";}},CloseShelf:function(){if(shelfState==="open"){Shelf.animate({height:0},800,function(a){});shelfState="close";shelfController.ResetForm();}},ResetForm:function(){imgLoader.removeClass("show");btnLoginIn.removeClass("active");Notifications.Notify("clear-unishelf-errors",null);},ClearErrors:function(){var a=SpectrumRegistrationCore.SignInController;if(a){a.ClearErrors();}},GetScrollHeight:function(){return Shelf[0].scrollHeight;}};(function(a){if(!a.fn.on){a.fn.on=function(c,e,b,d){if(typeof e!=="string"){return this.bind.apply(this,arguments);}return this.delegate(e,c,b,d);};}if(!a.fn.off){a.fn.off=function(c,e,b,d){if(typeof e!=="string"){return this.unbind.apply(this,arguments);}return this.delegate(e,c,b,d);};}})(jQuery);+function(a){var b=function(d,e){this.options=e;this.$element=a(d);this.$backdrop=this.isShown=null;if(this.options.remote){this.$element.find(".modal-content").load(this.options.remote,a.proxy(function(){this.$element.trigger("loaded.bs.modal");},this));}};b.DEFAULTS={backdrop:true,keyboard:true,show:true};b.prototype.toggle=function(d){return this[!this.isShown?"show":"hide"](d);};b.prototype.show=function(d){var g=this;var f=a.Event("show.bs.modal",{relatedTarget:d});this.$element.trigger(f);if(this.isShown||f.isDefaultPrevented()){return;}this.isShown=true;this.escape();this.$element.on("click.dismiss.bs.modal",'[data-dismiss="modal"]',a.proxy(this.hide,this));this.backdrop(function(){var i=a.support.transition&&g.$element.hasClass("fade");if(!g.$element.parent().length){g.$element.appendTo(document.body);}g.$element.show().scrollTop(0);if(i){g.$element[0].offsetWidth;}g.$element.addClass("in").attr("aria-hidden",false);g.enforceFocus();var h=a.Event("shown.bs.modal",{relatedTarget:d});i?g.$element.find(".modal-dialog").one(a.support.transition.end,function(){g.$element.focus().trigger(h);}).emulateTransitionEnd(300):g.$element.focus().trigger(h);});};b.prototype.hide=function(d){if(d){d.preventDefault();}d=a.Event("hide.bs.modal");this.$element.trigger(d);if(!this.isShown||d.isDefaultPrevented()){return;}this.isShown=false;this.escape();a(document).off("focusin.bs.modal");this.$element.removeClass("in").attr("aria-hidden",true).off("click.dismiss.bs.modal");a.support.transition&&this.$element.hasClass("fade")?this.$element.one(a.support.transition.end,a.proxy(this.hideModal,this)).emulateTransitionEnd(300):this.hideModal();};b.prototype.enforceFocus=function(){a(document).off("focusin.bs.modal").on("focusin.bs.modal",a.proxy(function(d){if(this.$element[0]!==d.target&&!this.$element.has(d.target).length){this.$element.focus();}},this));};b.prototype.escape=function(){if(this.isShown&&this.options.keyboard){this.$element.on("keyup.dismiss.bs.modal",a.proxy(function(d){d.which==27&&this.hide();},this));}else{if(!this.isShown){this.$element.off("keyup.dismiss.bs.modal");}}};b.prototype.hideModal=function(){var d=this;this.$element.hide();this.backdrop(function(){d.removeBackdrop();d.$element.trigger("hidden.bs.modal");});};b.prototype.removeBackdrop=function(){this.$backdrop&&this.$backdrop.remove();this.$backdrop=null;};b.prototype.backdrop=function(e){var d=this.$element.hasClass("fade")?"fade":"";if(this.isShown&&this.options.backdrop){var f=a.support.transition&&d;this.$backdrop=a('<div class="modal-backdrop '+d+'" />').appendTo(document.body);this.$element.on("click.dismiss.bs.modal",a.proxy(function(g){if(g.target!==g.currentTarget){return;}this.options.backdrop=="static"?this.$element[0].focus.call(this.$element[0]):this.hide.call(this);},this));if(f){this.$backdrop[0].offsetWidth;}this.$backdrop.addClass("in");if(!e){return;}f?this.$backdrop.one(a.support.transition.end,e).emulateTransitionEnd(150):e();}else{if(!this.isShown&&this.$backdrop){this.$backdrop.removeClass("in");a.support.transition&&this.$element.hasClass("fade")?this.$backdrop.one(a.support.transition.end,e).emulateTransitionEnd(150):e();}else{if(e){e();}}}};var c=a.fn.modal;a.fn.modal=function(e,d){return this.each(function(){var f=a(this);var g=f.data("bs.modal");var h=a.extend({},b.DEFAULTS,f.data(),typeof e=="object"&&e);if(!g){f.data("bs.modal",(g=new b(this,h)));}if(typeof e=="string"){g[e](d);}else{if(h.show){g.show(d);}}});};a.fn.modal.Constructor=b;a.fn.modal.noConflict=function(){a.fn.modal=c;return this;};a(document).on("click.bs.modal.data-api",'[data-toggle="modal"]',function(g){var f=a(this);var h=f.attr("href");var d=a(f.attr("data-target")||(h&&h.replace(/.*(?=#[^\s]+$)/,"")));var i=d.data("bs.modal")?"toggle":a.extend({remote:!/#/.test(h)&&h},d.data(),f.data());if(f.is("a")){g.preventDefault();}d.modal(i,this).one("hide",function(){f.is(":visible")&&f.focus();});});a(document).on("show.bs.modal",".modal",function(){a(document.body).addClass("modal-open");}).on("hidden.bs.modal",".modal",function(){a(document.body).removeClass("modal-open");});}(jQuery);+function(a){function b(){var c=document.createElement("bootstrap");var e={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};for(var d in e){if(c.style[d]!==undefined){return{end:e[d]};}}return false;}a.fn.emulateTransitionEnd=function(f){var e=false,c=this;a(this).one(a.support.transition.end,function(){e=true;});var d=function(){if(!e){a(c).trigger(a.support.transition.end);}};setTimeout(d,f);return this;};a(function(){a.support.transition=b();});}(jQuery);SpectrumRegistrationCore.N1MessageController={IsProcessing:false,Email:null,Initialize:function(){SpectrumRegistrationCore.Logger.LogInformation("Initializing N1MessageController...");var b=window.SpectrumRegistrationCore.N1MessageController;var a=window.SpectrumRegistrationCore.N1MessagePresenter;a.AttachToContinueButtonClick(b.OnContinueClick);a.AttachToCancelButtonClick(b.OnCancelClick);b.InitializeSpectrumRegistrationService();if(a.IsMobile){b.Email=SpectrumRegistrationCore.Utils.GetUserEmail();b.PopulateEMail();if(window.SpectrumAnalyticsHelper){SpectrumAnalyticsHelper.InitAnalyticsForMyAccount();}b.RaiseUserIdentityEvent("View","EmailExists");}return true;},OnContinueClick:function(){var a=SpectrumRegistrationCore.N1MessageController;if(!a.StartProcessing()){return;}a.RaiseUserIdentityEvent("Click","EmailExists");a.MandatePassword();},OnCancelClick:function(){var a=SpectrumRegistrationCore.N1MessagePresenter;var b=SpectrumRegistrationCore.N1MessageController;a.HideN1MessageLightbox(b.SignalUserIdentityFlowComplete);},ShowN1Message:function(a){var c=SpectrumRegistrationCore.N1MessageController;c.Email=a;c.PopulateEMail();var b=window.SpectrumRegistrationCore.N1MessagePresenter;b.ShowN1MessageLightbox();c.RaiseUserIdentityEvent("View","EmailExists");return;},InitializeSpectrumRegistrationService:function(){var b=SpectrumRegistrationCore.Utils.InitializeSpectrumRegistrationService();if(!b){return;}var a=SpectrumRegistrationCore.N1MessageController;b.Handlers.OnMandatePassword=a.OnMandatePassword;b.Handlers.OnMandatePasswordFailure=a.OnMandatePasswordFailure;},StartProcessing:function(){var a=SpectrumRegistrationCore.N1MessageController;if(a.IsProcessing){SpectrumRegistrationCore.Logger.LogWarning("An AJAX request is already under progress... Aborting.");return false;}a.IsProcessing=true;document.body.style.cursor="wait";return true;},FinishProcessing:function(){SpectrumRegistrationCore.N1MessageController.IsProcessing=false;document.body.style.cursor="default";},MandatePassword:function(){var b=SpectrumRegistrationCore.Logger;var d=SpectrumRegistrationCore.N1MessageController;b.LogInformation("N1MessageControler preparing request for manadate password...");try{var e=SpectrumRegistrationCore.Utils;var c=e.CreateRequestDto();c.SpectrumCustomer.User={Email:d.Email};b.LogInformation("N1MessageControler sending request for mandate password...");SpectrumRegistrationService.MandatePassword(c);}catch(a){b.LogError("N1MessageControler.MandatePassword failed",a);}},OnMandatePassword:function(b){var c=SpectrumRegistrationCore.N1MessageController;c.FinishProcessing();if(!b){c.OnMandatePasswordFailure();return;}var a=SpectrumRegistrationCore.N1MessagePresenter;if(a.IsMobile){c.RedirectToN2Message1();}else{a.HideN1MessageLightbox(c.ProceedToNextStep);}},OnMandatePasswordFailure:function(){SpectrumRegistrationCore.Utils.RedirectToApiErrorPage();},ProceedToNextStep:function(){var a=window.SpectrumRegistrationCore.N2Message1Controller;var b=window.SpectrumRegistrationCore.N1MessageController;a.ShowN2Message1(b.Email);},SignalUserIdentityFlowComplete:function(){var a=SpectrumRegistrationCore.Utils;a.SignalUserIdentityFlowComplete();},PopulateEMail:function(){var b=SpectrumRegistrationCore.N1MessageController;var a=window.SpectrumRegistrationCore.N1MessagePresenter;if(b.Email&&b.Email.length>0){a.PopulateEmail(b.Email,true);}},RedirectToN2Message1:function(){var a=window.SpectrumUtils.GetUrlParams();if(!a.pu){a.pu=window.document.referrer;}SpectrumRegistrationCore.Utils.RedirectTo(window.spectrumMyAccountUrl+SpectrumRegistrationCore.Utils.Constants.M_N2MESSAGE1,a);},RaiseUserIdentityEvent:function(a,b){if(typeof(Notifications)==="object"){var c=SpectrumRegistrationCore.N1MessageController;Notifications.Notify("on-user-identity-event",c,{eventType:a,messageType:b});}}};SpectrumRegistrationCore.N1MessagePresenter={Lightbox:null,IsMobile:window.N1MessageIsMobile?true:false,Initialize:function(){SpectrumRegistrationCore.Logger.LogInformation("Initializing N1MessagePresenter...");var a=SpectrumRegistrationCore.N1MessagePresenter;a.InitializeControls();a.HandleEnterKey();},InitializeControls:function(){var a=SpectrumRegistrationCore.N1MessagePresenter;a.FieldsContainer=$("#FieldsContainerDiv");a.Controls={Email:$("#n1MessagetxtEmail")};},AttachToContinueButtonClick:function(a){$("#n1MessageContinueButton").click(function(b){if(b&&b.preventDefault){b.preventDefault();}a.call(this);});},AttachToCancelButtonClick:function(a){$("#n1MessageCancelButton").click(function(b){if(b&&b.preventDefault){b.preventDefault();}a.call(this);});},HandleEnterKey:function(){var a=SpectrumRegistrationCore.N1MessagePresenter;var c=SpectrumRegistrationCore.Utils;var b=$("#n1MessageContinueButton");c.WhenEnterKeyPressedClickControl(a.Controls,b);},ShowN1MessageLightbox:function(){var b=SpectrumRegistrationCore.N1MessagePresenter;var a=$("#dvN1Message");if(!a||a.length<=0){SpectrumRegistrationCore.Logger.LogError("Could not locate N1Message content on the page");return;}b.Lightbox={content:a,displaySettings:{top:20,closeOnOverlayClick:false}};SpectrumLightbox.ShowLightbox(b.Lightbox);},HideN1MessageLightbox:function(a){var b=SpectrumRegistrationCore.N1MessagePresenter;if(!b.Lightbox){return;}b.Lightbox.hideCallback=function(){b.Lightbox=null;if(a){a.call(this);}};SpectrumLightbox.HideLightbox(b.Lightbox);},PopulateEmail:function(a,b){var c=SpectrumRegistrationCore.N1MessagePresenter;c.Controls.Email.safeVal(a);if(b){c.Controls.Email.attr("readonly",true);}}};SpectrumRegistrationCore.N2Message1Controller={IsProcessing:false,Email:null,Initialize:function(){SpectrumRegistrationCore.Logger.LogInformation("Initializing N2Message1Controller...");var b=SpectrumRegistrationCore.N2Message1Controller;var a=SpectrumRegistrationCore.N2Message1Presenter;a.AttachToContinueButtonClick(b.OnContinueClick);a.AttachToCancelButtonClick(b.OnCancelClick);if(a.IsMobile){b.Email=SpectrumRegistrationCore.Utils.GetUserEmail();if(window.SpectrumAnalyticsHelper){SpectrumAnalyticsHelper.InitAnalyticsForMyAccount();}b.RaiseUserIdentityEvent("View","SetPassword");}return true;},OnContinueClick:function(){var a=SpectrumRegistrationCore.N2Message1Controller;a.RaiseUserIdentityEvent("Click","SetPassword");a.CheckPassword();},OnCancelClick:function(){var a=SpectrumRegistrationCore.N2Message1Presenter;var b=SpectrumRegistrationCore.N2Message1Controller;a.HideN2Message1Lightbox(b.SignalUserIdentityFlowComplete);},ShowN2Message1:function(a){var c=SpectrumRegistrationCore.N2Message1Controller;c.Email=a;var b=SpectrumRegistrationCore.N2Message1Presenter;b.ShowN2Message1Lightbox();c.RaiseUserIdentityEvent("View","SetPassword");},StartProcessing:function(){var a=SpectrumRegistrationCore.N2Message1Controller;if(a.IsProcessing){SpectrumRegistrationCore.Logger.LogWarning("An AJAX request is already under progress... Aborting.");return false;}a.IsProcessing=true;document.body.style.cursor="wait";return true;},FinishProcessing:function(){SpectrumRegistrationCore.N2Message1Controller.IsProcessing=false;document.body.style.cursor="default";},CheckPassword:function(){var b=SpectrumRegistrationCore.Logger;var c=SpectrumRegistrationCore.N2Message1Controller;if(!c.StartProcessing()){return;}if(!c.Email||c.Email<=0){return;}try{var d=SpectrumRegistrationCore.Utils;b.LogInformation("N2Message1Controler sending request for check password...");d.CheckPassword(c.OnCheckPasswordSuccess,c.OnCheckPasswordFailure,c.Email);}catch(a){b.LogError("N2Message1Controler.CheckPassword failed!",a);}},OnCheckPasswordSuccess:function(b){var c=SpectrumRegistrationCore.N2Message1Controller;c.FinishProcessing();if(!b){c.OnCheckPasswordFailure();return;}var a=b.SpectrumCustomer.UserInternal.HasPasswordOnAccount;if(a){c.ProceedToEditAccount();return;}c.ProceedToNextStep();return;},OnCheckPasswordFailure:function(){SpectrumRegistrationCore.Utils.RedirectToApiErrorPage();},SignalUserIdentityFlowComplete:function(){var a=SpectrumRegistrationCore.Utils;a.SignalUserIdentityFlowComplete();},ProceedToEditAccount:function(){var a=SpectrumRegistrationCore.N2Message1Presenter;var b=SpectrumRegistrationCore.N2Message1Controller;if(a.IsMobile){b.GotoEditInfoPage();return;}b.SignalUserIdentityFlowComplete();a.HideN2Message1Lightbox(function(){var c=SpectrumRegistrationCore.Controller;c.ShowMiniMyAccount();});},ProceedToNextStep:function(){var a=SpectrumRegistrationCore.N2Message1Presenter;var b=SpectrumRegistrationCore.N2Message1Controller;if(a.IsMobile){b.RedirectToN2Message2();return;}a.HideN2Message1Lightbox(function(){b.ProcessNextStep();});},ProcessNextStep:function(){var b=SpectrumRegistrationCore.N2Message1Controller;var a=SpectrumRegistrationCore.N2Message2Controller;a.ShowN2Message2(b.Email);},GotoEditInfoPage:function(){var a=window.SpectrumUtils.GetUrlParams();if(!a.pu){a.pu=document.referrer;}SpectrumRegistrationCore.Utils.RedirectTo(window.spectrumMyAccountUrl+SpectrumRegistrationCore.Utils.Constants.M_EDITINFO,a);},RedirectToN2Message2:function(){var a=window.SpectrumUtils.GetUrlParams();if(!a.pu){a.pu=document.referrer;}SpectrumRegistrationCore.Utils.RedirectTo(window.spectrumMyAccountUrl+SpectrumRegistrationCore.Utils.Constants.M_N2MESSAGE2,a);},RaiseUserIdentityEvent:function(a,b){if(typeof(Notifications)==="object"){var c=SpectrumRegistrationCore.N2Message1Controller;Notifications.Notify("on-user-identity-event",c,{eventType:a,messageType:b});}}};SpectrumRegistrationCore.N2Message1Presenter={IsMobile:window.n2Message1IsMobile?true:false,Lightbox:null,Initialize:function(){SpectrumRegistrationCore.Logger.LogInformation("Initializing N2Message1Presenter...");var a=SpectrumRegistrationCore.N2Message1Presenter;a.HandleEnterKey();},AttachToContinueButtonClick:function(a){$("#n2Message1ContinueButton").click(function(b){if(b&&b.preventDefault){b.preventDefault();}a.call(this);});},AttachToCancelButtonClick:function(a){$("#n2Message1CloseButton").click(function(b){if(b&&b.preventDefault){b.preventDefault();}a.call(this);});},HandleEnterKey:function(){var a=SpectrumRegistrationCore.N2Message1Presenter;var c=SpectrumRegistrationCore.Utils;var b=$("#n2Message1ContinueButton");c.WhenEnterKeyPressedClickControl(a.Controls,b);},ShowN2Message1Lightbox:function(){var a=SpectrumRegistrationCore.N2Message1Presenter;a.Lightbox={content:$("#dvN2Message1"),displaySettings:{top:20,closeOnOverlayClick:false}};SpectrumLightbox.ShowLightbox(a.Lightbox);},HideN2Message1Lightbox:function(a){var b=SpectrumRegistrationCore.N2Message1Presenter;if(!b.Lightbox){return;}b.Lightbox.hideCallback=function(){b.Lightbox=null;if(a){a.call(this);}};SpectrumLightbox.HideLightbox(b.Lightbox);}};SpectrumRegistrationCore.N2Message2Controller={Email:null,IsProcessing:false,Initialize:function(){SpectrumRegistrationCore.Logger.LogInformation("Initializing N2Message2Controller...");var b=SpectrumRegistrationCore.N2Message2Controller;var a=SpectrumRegistrationCore.N2Message2Presenter;a.AttachToContinueButtonClick(b.OnContinueClick);a.AttachToCancelButtonClick(b.OnCancelClick);if(a.IsMobile){b.Email=SpectrumRegistrationCore.Utils.GetUserEmail();a.PopulateEmail(b.Email);if(window.SpectrumAnalyticsHelper){SpectrumAnalyticsHelper.InitAnalyticsForMyAccount();}b.RaiseUserIdentityEvent("View","PasswordReminder");}return true;},OnContinueClick:function(){var a=SpectrumRegistrationCore.N2Message2Controller;a.RaiseUserIdentityEvent("Click","PasswordReminder");a.CheckPassword();},OnCancelClick:function(){var b=SpectrumRegistrationCore.N2Message2Controller;var a=SpectrumRegistrationCore.N2Message2Presenter;a.HideN2Message2Lightbox(b.SignalUserIdentityFlowComplete);},ShowN2Message2:function(a){var c=SpectrumRegistrationCore.N2Message2Controller;c.Email=a;var b=SpectrumRegistrationCore.N2Message2Presenter;b.ShowN2Message2Lightbox();c.RaiseUserIdentityEvent("View","PasswordReminder");return;},StartProcessing:function(){var a=SpectrumRegistrationCore.N2Message2Controller;if(a.IsProcessing){SpectrumRegistrationCore.Logger.LogWarning("An AJAX request is already under progress... Aborting.");return false;}a.IsProcessing=true;document.body.style.cursor="wait";return true;},FinishProcessing:function(){SpectrumRegistrationCore.N2Message2Controller.IsProcessing=false;document.body.style.cursor="default";},CheckPassword:function(){var b=SpectrumRegistrationCore.Logger;var c=SpectrumRegistrationCore.N2Message2Controller;if(!c.StartProcessing()){return;}if(!c.Email||c.Email<=0){return;}try{var d=SpectrumRegistrationCore.Utils;b.LogInformation("N2Message2Controler sending request for check password...");d.CheckPassword(c.OnCheckPasswordSuccess,c.OnCheckPasswordFailure,c.Email);}catch(a){b.LogError("N2Message2Controler.CheckPassword failed",a);}},OnCheckPasswordSuccess:function(b){var c=SpectrumRegistrationCore.N2Message2Controller;c.FinishProcessing();if(!b){c.OnCheckPasswordFailure();return;}var a=b.SpectrumCustomer.UserInternal.HasPasswordOnAccount;if(a){c.ProceedToEditAccount();}return;},OnCheckPasswordFailure:function(){SpectrumRegistrationCore.Utils.RedirectToApiErrorPage();},SignalUserIdentityFlowComplete:function(){var a=SpectrumRegistrationCore.Utils;a.SignalUserIdentityFlowComplete();},ProceedToEditAccount:function(){var a=SpectrumRegistrationCore.N2Message2Presenter;var b=SpectrumRegistrationCore.N2Message2Controller;if(a.IsMobile){b.GotoEditInfoPage();return;}b.SignalUserIdentityFlowComplete();a.HideN2Message2Lightbox(function(){var c=SpectrumRegistrationCore.Controller;c.ShowMiniMyAccount();});},GotoEditInfoPage:function(){var a=window.SpectrumUtils.GetUrlParams();if(!a.pu){a.pu=document.referrer;}SpectrumRegistrationCore.Utils.RedirectTo(window.spectrumMyAccountUrl+SpectrumRegistrationCore.Utils.Constants.M_EDITINFO,a);},RaiseUserIdentityEvent:function(a,b){if(typeof(Notifications)==="object"){var c=SpectrumRegistrationCore.N2Message2Controller;Notifications.Notify("on-user-identity-event",c,{eventType:a,messageType:b});}}};SpectrumRegistrationCore.N2Message2Presenter={IsMobile:window.n2Message2IsMobile?true:false,Lightbox:null,Initialize:function(){SpectrumRegistrationCore.Logger.LogInformation("Initializing N2Message2Presenter...");var a=SpectrumRegistrationCore.N2Message2Presenter;a.InitializeControls();a.HandleEnterKey();},InitializeControls:function(){var a=SpectrumRegistrationCore.N2Message2Presenter;a.FieldsContainer=$("#pN2M2Email");a.Controls={Email:$("#boldN2M2EMail")};},AttachToContinueButtonClick:function(a){$("#n2Message2ContinueButton").click(function(b){if(b&&b.preventDefault){b.preventDefault();}a.call(this);});},AttachToCancelButtonClick:function(a){$("#n2Message2CloseButton").click(function(b){if(b&&b.preventDefault){b.preventDefault();}a.call(this);});},HandleEnterKey:function(){var a=SpectrumRegistrationCore.N2Message2Presenter;var c=SpectrumRegistrationCore.Utils;var b=$("#n2Message2ContinueButton");c.WhenEnterKeyPressedClickControl(a.Controls,b);},ShowN2Message2Lightbox:function(){var a=SpectrumRegistrationCore.N2Message2Presenter;a.Lightbox={content:$("#dvN2Message2"),displaySettings:{top:20,closeOnOverlayClick:false}};SpectrumLightbox.ShowLightbox(a.Lightbox);return;},HideN2Message2Lightbox:function(a){var b=SpectrumRegistrationCore.N2Message2Presenter;if(!b.Lightbox){return;}b.Lightbox.hideCallback=function(){b.Lightbox=null;if(a){a.call(this);}};SpectrumLightbox.HideLightbox(b.Lightbox);},PopulateEmail:function(a){var b=SpectrumRegistrationCore.N2Message2Presenter;b.Controls.Email.text(a);}};