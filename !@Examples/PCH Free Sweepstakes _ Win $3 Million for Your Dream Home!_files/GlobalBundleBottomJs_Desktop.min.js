(function($){$.toJSON=function(o){if(typeof(JSON)=="object"&&JSON.stringify){return JSON.stringify(o);}var type=typeof(o);if(o===null){return"null";}if(type=="undefined"){return undefined;}if(type=="number"||type=="boolean"){return o+"";}if(type=="string"){return $.quoteString(o);}if(type=="object"){if(typeof o.toJSON=="function"){return $.toJSON(o.toJSON());}if(o.constructor===Date){var month=o.getUTCMonth()+1;if(month<10){month="0"+month;}var day=o.getUTCDate();if(day<10){day="0"+day;}var year=o.getUTCFullYear();var hours=o.getUTCHours();if(hours<10){hours="0"+hours;}var minutes=o.getUTCMinutes();if(minutes<10){minutes="0"+minutes;}var seconds=o.getUTCSeconds();if(seconds<10){seconds="0"+seconds;}var milli=o.getUTCMilliseconds();if(milli<100){milli="0"+milli;}if(milli<10){milli="0"+milli;}return'"'+year+"-"+month+"-"+day+"T"+hours+":"+minutes+":"+seconds+"."+milli+'Z"';}if(o.constructor===Array){var ret=[];for(var i=0;i<o.length;i++){ret.push($.toJSON(o[i])||"null");}return"["+ret.join(",")+"]";}var pairs=[];for(var k in o){var name;var type=typeof k;if(type=="number"){name='"'+k+'"';}else{if(type=="string"){name=$.quoteString(k);}else{continue;}}if(typeof o[k]=="function"){continue;}var val=$.toJSON(o[k]);pairs.push(name+":"+val);}return"{"+pairs.join(", ")+"}";}};$.evalJSON=function(src){if(typeof(JSON)=="object"&&JSON.parse){return JSON.parse(src);}return eval("("+src+")");};$.secureEvalJSON=function(src){if(typeof(JSON)=="object"&&JSON.parse){return JSON.parse(src);}var filtered=src;filtered=filtered.replace(/\\["\\\/bfnrtu]/g,"@");filtered=filtered.replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]");filtered=filtered.replace(/(?:^|:|,)(?:\s*\[)+/g,"");if(/^[\],:{}\s]*$/.test(filtered)){return eval("("+src+")");}else{throw new SyntaxError("Error parsing JSON, source is not valid.");}};$.quoteString=function(string){if(string.match(_escapeable)){return'"'+string.replace(_escapeable,function(a){var c=_meta[a];if(typeof c==="string"){return c;}c=a.charCodeAt();return"\\u00"+Math.floor(c/16).toString(16)+(c%16).toString(16);})+'"';}return'"'+string+'"';};var _escapeable=/["\\\x00-\x1f\x7f-\x9f]/g;var _meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};})(jQuery);var PathContests={IsInitialized:false,CookieName:"",Settings:null,Groups:null,IsCurrentVersionOfServer:function(){if(window._hasNewPathContestsCookieFormat){return true;}return false;},Init:function(){if(this.IsCurrentVersionOfServer()){this.InitForCurrentVersion();}else{this.InitForOlderVersion();}},InitForCurrentVersion:function(){if(this.IsInitialized){return;}this.InitWithJson(_spectrumPathContests);this.CookieName="pathcontests_"+giPathID;var a=GetCookie(this.CookieName);if(a&&a!=null&&a!=""){this.LoadStateFromCookie(this.Groups);}},InitForOlderVersion:function(){if(this.IsInitialized){return;}this.CookieName="pathcontests_"+giPathID;var b=GetCookie(this.CookieName);var a=$.parseJSON(b);this.InitWithJson(a);},InitWithJson:function(a){if(this.IsInitialized){return;}this.LoadWithJson(a);this.IsInitialized=true;},Load:function(){var b=GetCookie(this.CookieName);var a=$.parseJSON(b);this.LoadWithJson(a);},LoadWithJson:function(a){this.Settings=a;this.Groups=null;if(this.Settings&&this.Settings!=""){this.Groups=this.Settings.Groups;}},Save:function(){if(this.IsCurrentVersionOfServer()){this.SaveToNewFormat();}else{this.SaveToOldFormat();}},SaveToNewFormat:function(){var a=this.ToCookieFormat(this.Groups);SetCookie(this.CookieName,a,null,"/");},SaveToOldFormat:function(){var a=$.toJSON(this.Settings);SetCookie(this.CookieName,a,null,"/");},TotalGroups:function(){this.Init();if(this.Groups==null){return 0;}return this.Groups.length;},ActivateByIndex:function(d,b){this.Init();if(this.Groups==null){return;}if(this.Groups.length<=d){return;}var a=this.Settings.Groups[d].Contests[b];a.IsActive=true;},ToggleByIndex:function(b,a){this.Init();this.DeactivateGroup(b);this.ActivateByIndex(b,a);},DeactivateGroup:function(e){this.Init();if(this.Groups==null){return;}var d=this.Groups[e];for(var a=0;a<d.Contests.length;a++){var b=d.Contests[a];b.IsActive=false;}},ActivateByName:function(b,a){this.Init();var d=this;d.GetByNames(b,a,function(f,e){e.IsActive=true;});},GetGroup:function(b){this.Init();var a=null;var d=this;d.GetByNames(b,null,function(f,e){a=f;});return a;},GetContest:function(d,b){this.Init();if(this.Groups==null){return null;}if(this.Groups.length<=d){return null;}if(this.Groups[d].Contests.length<=b){return null;}var a=this.Settings.Groups[d].Contests[b];return a;},GetIndexOfPrimary:function(){this.Init();if(this.Groups==null){return -1;}var b=0;for(var a=0;a<this.Groups.length;a++){if(this.Groups[a].IsPrimary){return a;}}return -1;},GetActivatedContestByGroupIndex:function(f){this.Init();if(this.Groups==null){return;}var e=this.Groups[f];var d=null;for(var b=0;b<e.Contests.length;b++){var a=e.Contests[b];if(a.IsActive){d=a;break;}}return d;},GetContestByNames:function(d,b){this.Init();var a=null;var e=this;e.GetByNames(d,b,function(g,f){a=f;});return a;},Validate:function(){this.Init();var g={IsValid:true,InActivatedGroups:[]};if(!this.HasPrizeChoice()){return g;}for(var e=0;e<this.Groups.length;e++){var f=this.Groups[e];if(f.IsAutoActivated){continue;}var a=false;for(var b=0;b<f.Contests.length;b++){var d=f.Contests[b];if(d.IsActive){a=true;}}if(!a){g.IsValid=false;g.InActivatedGroups.push(f.Name);}}return g;},HasContests:function(){if(this.Groups==null||this.Groups.length==0){return false;}return true;},IsGroupActivated:function(b){var a=this.GetActivatedContestByGroupIndex(b);return a!=null;},IsDefaultContest:function(){if(this.Groups.length==1&&this.Groups[0].Contests.length==1&&this.Groups[0].IsAutoActivated&&this.Groups[0].IsPrimary){return true;}return false;},IsDefaultMultiGroup:function(){var d=true;for(var b=0;b<this.Settings.Groups.length;b++){var a=this.Settings.Groups[b];if(a.Contests.length>1||!a.IsAutoActivated){d=false;}}return d;},HasPrizeChoice:function(){var a=this.HasContests()&&!PathContests.IsDefaultContest()&&!PathContests.IsDefaultMultiGroup();return a;},SetContestLabelCss:function(d,b,e){var a=this.GetContest(d,b);if(a!=null){a.LabelClass=e;}},GetByNames:function(h,e,a){var f=false;for(var i=0;i<this.Settings.Groups.length;i++){var g=this.Settings.Groups[i];if(g.Name==h){if(e==null){a(g,null);f=true;}else{for(var b=0;b<g.Contests.length;b++){var d=g.Contests[b];if(d.Promotion==e){a(g,d);f=true;break;}}}}if(f){break;}}},GetSpectrumContest:function(b,a){return spectrumContest[b][a];},ToCookieFormat:function(h){var b="";for(var k=0;k<h.length;k++){var g=h[k];var f="g"+k;for(var j=0;j<g.Contests.length;j++){var e=g.Contests[j];var d=f+"c"+j;var i=e.IsActive?1:0;var a=d+"a~"+i+"^";b+=a;if(typeof e.LabelClass!="undefined"){b+=d+"l~"+e.LabelClass+"^";}}}return b;},LoadStateFromCookie:function(i,e){var l=SpectrumUtils.GetCookieValueAsMap(this.CookieName);for(var o=0;o<i.length;o++){var h=i[o];var g="g"+o;for(var n=0;n<h.Contests.length;n++){var f=h.Contests[n];var d=g+"c"+n;var a=d+"a";var b=d+"l";var j=l[a];var k="";if(typeof l[b]!="undefined"){k=l[b];}f.IsActive=j==1?true:false;f.LabelClass=k;}}}};var MiniMyAccountsLauncher=(function(){var h,f,b,a,k=false;function d(){if($("miniMyAccountsIframe").length>0){return;}f=$(document.createElement("iframe"));f.attr("id","miniMyAccountsIframe");f.attr("name","miniMyAccountsIframe");f.attr("frameBorder","0");f.attr("src",a);f.width("678px");f.height("650px");f.css("z-index","16777280");f.css("position","absolute");f.attr("allowTransparency","true");f.attr("scrolling","no");f.ready(i);$(b).append(f);}function i(){var l={content:f,hideCallback:j};SpectrumLightbox.ShowLightbox(l);f.css("top","20px");}function e(l){var n=function(){f.empty().remove();h=null;if(typeof l==="function"){l();}};if(k){n();return;}var o={content:f,hideCallback:n};SpectrumLightbox.HideLightbox(o);}function g(l,n){if(arguments.length!==2){console.log("pass in two args");return undefined;}a=n;b=document.getElementsByTagName("body")[0];return{create:d,destroy:e};}function j(){k=true;if(window.OnMiniMyAccountCancelClick){window.OnMiniMyAccountCancelClick();}}return{getInstance:function(l,n){if(!h){h=g(l,n);}return h;}};})();var SpectrumRegistrationService={AjaxRequestInProgress:false,Config:{BaseUrl:""},Urls:{GetCustomerByGmtAndEmail_Url:"?methodName=GetCustomerByGmtAndEmail",ValidateAndRegisterCustomer_Url:"?methodName=ValidateAndRegisterCustomer",ProcessOptins_Url:"?methodName=ProcessOptins",ForgotPassword_Url:"?methodName=ForgotPassword",ResetPassword_Url:"?methodName=ResetPassword",ProcessLogin_Url:"?methodName=ProcessLogin",MandatePassword_Url:"?methodName=MandatePassword",CheckPassword_Url:"?methodName=CheckPassword",SetPassword_Url:"?methodName=SetPassword",SetSiteActivity_Url:"?methodName=SetSiteActivity",SuggestCityAndState_Url:"?methodName=SuggestCityAndState"},Handlers:{OnValidateAndRegisterCustomer:null,OnValidateAndRegisterCustomerFailure:null,OnProcessOptins:null,OnProcessOptinsFailure:null,OnForgotPassword:null,OnForgotPasswordFailure:null,OnProcessLogin:null,OnProcessLoginFailure:null,OnMandatePassword:null,OnMandatePasswordFailure:null,OnCheckPassword:null,OnCheckPasswordFailure:null,OnSuggestCityAndState:null,OnSuggestCityAndStateFailure:null},ValidateAndRegisterCustomer:function(a){var b=SpectrumRegistrationService;b._MakeAjaxRequest(a,"ValidateAndRegisterCustomer");},ProcessOptins:function(a){var b=SpectrumRegistrationService;b._MakeAjaxRequest(a,"ProcessOptins");},ForgotPassword:function(a){var b=SpectrumRegistrationService;b._MakeAjaxRequest(a,"ForgotPassword");},ResetPassword:function(a){var b=SpectrumRegistrationService;b._MakeAjaxRequest(a,"ResetPassword");},ProcessLogin:function(a){var b=SpectrumRegistrationService;b._MakeAjaxRequest(a,"ProcessLogin");},MandatePassword:function(a){var b=SpectrumRegistrationService;b._MakeAjaxRequest(a,"MandatePassword");},CheckPassword:function(a){var b=SpectrumRegistrationService;b._MakeAjaxRequest(a,"CheckPassword");},SetPassword:function(b){var a=SpectrumRegistrationService;a._MakeAjaxRequest(b,"SetPassword");},SetSiteActivity:function(b){var a=SpectrumRegistrationService;a._MakeAjaxRequest(b,"SetSiteActivity");},SuggestCityAndState:function(a){var b=SpectrumRegistrationService;b._MakeAjaxRequest(a,"SuggestCityAndState");},_MakeUrl:function(urlName){return eval("SpectrumRegistrationService.Urls."+urlName+"_Url");},_MakeSuccessHandler:function(handlerName){return function(data){SpectrumRegistrationService._InvokeHandler(eval("SpectrumRegistrationService.Handlers.On"+handlerName),data);};},_MakeFailureHandler:function(handlerName){return function(jqXhr,textStatus,errorThrown){SpectrumRegistrationService._InvokeHandler(eval("SpectrumRegistrationService.Handlers.On"+handlerName+"Failure"),errorThrown,jqXhr.status);};},_MakeAjaxRequest:function(d,b){var e=SpectrumRegistrationService;var g=e._MakeUrl(b);var f=e._MakeSuccessHandler(b);var a=e._MakeFailureHandler(b);if(e.AjaxRequestInProgress){alert("An Ajax request is already in progress cannot start another one. Please wait and try again later");return;}e._RemoveUnnecessaryFieldsFromRequest(d);$.ajax({url:e.Config.BaseUrl+g,success:f,data:$.toJSON(d),type:"POST",contentType:"application/json",error:a,beforeSend:function(h){h.setRequestHeader("originatingUrl",window.location.href);},headers:{SpecPathName:window.pathData?window.pathData.Name:null,SpecStepName:window.pathData?window.pathData.CurrentStep.Name:null}});},_InvokeHandler:function(a,b,d){if(typeof a==="function"){a(b,d);}},_RemoveUnnecessaryFieldsFromRequest:function(a){a.SpectrumCustomer.AdditionalAttributes=null;a.SpectrumCustomer.System.Created="";a.SpectrumCustomer.UserInternal.FirstEverRegDate="";}};var windowProxy1,windowProxy2;var SpectrumRegistrationCore={GetDefaultConfig:function(){return{Default:{ShouldInitializePorthole:true,Controller:SpectrumRegistrationCore.Controller,Presenter:SpectrumRegistrationCore.Presenter}};},Initialize:function(a){var b=SpectrumRegistrationCore;b.Logger.ErrorLogEnabled=b.Logger.InfoLogEnabled=b.Logger.WarningLogEnabled=true;a=a||b.GetDefaultConfig();b.DeletePrismSessionCookie();if(b.ShouldInitializePorthole(a)){b.InitializePortHoleProxy();}var d=false;b.ForEachConfig(a,function(e){if(e.Presenter){e.Presenter.Initialize();}if(e.Controller){d=e.Controller.Initialize();}return(d)?true:false;});return d;},DeletePrismSessionCookie:function(){var b=SpectrumRegistrationCore.Logger;b.LogInformation("Deleting Prism Session cookie...");try{if(window.strPrismUserInfoCookie&&typeof DeleteCookie==="function"){DeleteCookie(window.strPrismUserInfoCookie,"/",window.globalDomainName);}}catch(a){b.LogError("Failed to delete Prism Session cookie",a);}},IsUserRecognized:function(){return(window.SpectrumRegistrationResponseDto&&window.SpectrumRegistrationResponseDto.SpectrumCustomer&&window.SpectrumRegistrationResponseDto.SpectrumCustomer.User)?true:false;},GetUserSubscriptions:function(){var b=window.SpectrumRegistrationResponseDto;var a=b?b.SpectrumCustomer:null;var d=a?a.OptIns:null;return d?window.SpectrumUtils.CloneObject(d.Subscriptions):null;},GetOrderLimit:function(){return(window.SpectrumRegistrationResponseDto&&window.SpectrumRegistrationResponseDto.SpectrumCustomer&&window.SpectrumRegistrationResponseDto.SpectrumCustomer.ScoringVariables)?window.SpectrumRegistrationResponseDto.SpectrumCustomer.ScoringVariables.TotalOrderLimit:null;},PersonalizeUI:function(){SpectrumRegistrationCore.Presenter.PersonalizeUI();},HandleNotYouLink:function(){var b=SpectrumRegistrationCore.Logger;b.LogInformation("HandleNotYouLink()... Clearing cookies and redirecting...");window.showAlert="false";var a=SpectrumRegistrationCore;a.DeleteUserIdentificationAndCartCookies();a.DeleteEvergageCookie();if(window.Notifications){Notifications.Notify("on-registration-page-view",a,{viewCode:"Not You"});}window.setTimeout(a.RedirectToNotYouUrl,500);return false;},RedirectToNotYouUrl:function(){var b=window.SpectrumRegistrationCore.Utils;switch(window.tokenSourceType){case"Acquisition":b.RedirectTo(window.location.protocol+"//"+window.location.host+window.location.pathname);break;case"Main Path":b.RedirectTo(window.mainNotYouUrl);break;default:var a=window.spectrumUrlsAreRelative?window.baseUrl:"";b.RedirectTo(a+window.houseNotYouUrl);break;}},DeleteDomainCookie:function(a){if(a&&window.DeleteCookie){window.DeleteCookie(a,"/",window.globalDomainName);}},DeleteUserIdentificationAndCartCookies:function(){var a=SpectrumRegistrationCore;a.DeleteDomainCookie(window.strUserInfoCookie);a.DeleteDomainCookie(window.strPrismUserInfoCookie);a.DeleteDomainCookie(window.custDataSessionCookieName);a.DeleteDomainCookie(window.ssoCookieName);a.DeleteDomainCookie(window.ssoTicketCookieName);a.DeleteDomainCookie(window.ssoAuthTicketCookieName);if(!window.pathData||window.pathData.Id<=0){return;}var b="mpCart_"+window.pathData.Id;a.DeleteDomainCookie(b);},DeleteEvergageCookie:function(){var b=(window.analyticsSettings&&window.analyticsSettings.Evergage&&window.analyticsSettings.Evergage.Domain&&window.analyticsSettings.Evergage.Domain.length>0)?window.analyticsSettings.Evergage.Domain:null;if(!b){return;}var a="_at_id.pch."+b+".a1c9";window.DeleteCookie(a,"/","pch.com");},IsRegistrationControlPresent:function(){var a=SpectrumRegistrationCore.Presenter;return a.IsRegistrationControlPresent();},InitializePortHoleProxy:function(){windowProxy1=new Porthole.WindowProxy("http://about:blank","");windowProxy2=new Porthole.WindowProxy("http://about:blank","miniMyAccountsIframe");windowProxy1.addEventListener(OnMiniMyAccountMessage);windowProxy2.addEventListener(OnMiniMyAccountMessage);},ShouldInitializePorthole:function(a){var b=false;SpectrumRegistrationCore.ForEachConfig(a,function(d){if(d&&d.ShouldInitializePorthole){b=true;return false;}return true;});return b;},IsIdentPage:function(){if(typeof window.isIdentPage!=="undefined"){return window.isIdentPage;}return $("div.inlineReg,div.mobileReg").length?true:false;},IsGoldUser:function(){return(SpectrumRegistrationCore.IsUserRecognized()&&window.SpectrumRegistrationResponseDto.SpectrumCustomer.User.AddressId>0&&window.SpectrumRegistrationResponseDto.SpectrumCustomer.UserInternal.HasPasswordOnAccount)?true:false;},ForEachConfig:function(d,a,f){if(!d){return;}if(typeof a!=="function"){return;}for(var e in d){if(!e){continue;}var b=d[e];if(!b){continue;}var g=a(b,e);if(g===false){break;}}},ClearCoreErrors:function(){var a=SpectrumRegistrationCore.Controller.SSOController;if(a){a.clearErrors();}return true;},ClearSignInErrors:function(){var a=SpectrumRegistrationCore.SignInController;if(b){var b=a.SSOController;if(b){b.SSOController.clearErrors();}}return true;}};SpectrumRegistrationCore.UserInfoCategories={None:0,RegFieldsOnly:1,OptinsOnly:2,RegFieldsAndOptins:3};function OnMiniMyAccountUpdateSuccess(){var a=SpectrumRegistrationCore.Controller;a.OnMiniMyAccountUpdateSuccess();}function OnMiniMyAccountCancelClick(){var a=SpectrumRegistrationCore.Controller;a.OnMiniMyAccountCancelClick();}function OnMiniMyAccountNotYouClick(){var a=SpectrumRegistrationCore.Controller;a.OnMiniMyAccountNotYouClick();}function OnMiniMyAccountRedirect(b){var d=SpectrumRegistrationCore.Utils;var a=d.CreateRfProxy(SpectrumRegistrationCore.Controller,SpectrumRegistrationCore.Presenter);a.redirect(b);}function OnMiniMyAccountMessage(e){var b=SpectrumRegistrationCore.Logger;b.LogInformation("OnMiniMyAccountMessage: "+e.data);var d=$.parseJSON(e.data);var a=d.functionName;var f=d.url;window[a].call(this,f);}function OnMiniMyAccountLoginMiniRegSuccess(){var a=SpectrumRegistrationCore.Controller;a.OnMiniMyAccountLoginSuccess();}SpectrumRegistrationCore.Utils={Constants:{M_SIGNIN:"SignIn.aspx",M_EDITINFO:"EditInfo.aspx",M_FORGOTPWD:"ForgotPassword.aspx",M_CREATEPWD:"CreatePassword.aspx",M_RESETPWD:"ResetPassword.aspx",M_RESETPWDCONF:"ResetPasswordConfirmation.aspx",M_N1MESSAGE:"N1Message.aspx",M_N2MESSAGE1:"N2Message1.aspx",M_N2MESSAGE2:"N2Message2.aspx"},CloneObject:function(a){return $.extend(true,{},a);},InitializeSpectrumRegistrationService:function(){var a=SpectrumRegistrationCore.Logger;a.LogInformation("Initializing Spectrum registration service...");if(!window.baseUrl){a.LogError("baseUrl not defined");return null;}if(!window.SpectrumRegistrationService){a.LogError("Must include SpectrumRegistrationService.js");return null;}var b=window.SpectrumRegistrationService;b.Config.BaseUrl=window.baseUrl+"Registration/RegisterAndValidateProxy.aspx";return b;},CreateRequestDto:function(){var b=SpectrumRegistrationCore.Utils;var a={};if(window.SpectrumRegistrationResponseDto&&window.SpectrumRegistrationResponseDto.SpectrumCustomer){a.SpectrumCustomer=b.CloneObject(window.SpectrumRegistrationResponseDto.SpectrumCustomer);return a;}a.SpectrumCustomer={System:{TrackingToken:window.defaultToken},UserInternal:{}};return a;},LoadCustomerFromCookies:function(){var g=SpectrumRegistrationCore.Utils;if(!window.strUserInfoCookie||!window.custDataSessionCookieName||!window.ssoCookieName){return null;}var e=GetCookie(window.strUserInfoCookie);var a=GetCookie(window.custDataSessionCookieName);if(a&&a.length){a=g.DecodePchEncodingA(a);}var f=GetCookie(window.ssoCookieName);if(f&&f.length){f=g.DecodePchEncodingA(f);}var h={};SpectrumUtils.ParseValueAsHashtable(f,h);SpectrumUtils.ParseValueAsHashtable(e,h);SpectrumUtils.ParseValueAsHashtable(a,h);if($.isEmptyObject(h)){return null;}var d={User:{},UserInternal:{},ScoringVariables:{},System:{},ValidationVariables:{AddressValidationStatusCode:"VALIDOK",EmailValidationStatusCode:"VALIDOK",FieldValidationStatusCode:"VALIDOK"},OptIns:{Subscriptions:{}},Registrations:{PropertyCodes:[]},SessionProfile:{ProfileDataInUse:{}},Segments:{}};for(var b in h){g.SetCustomerProperty(d,b,h[b]);}if(g.ShouldOverrideOrderLimit(d.ScoringVariables.SegmentName)){g.OverrideCustomerOrderLimit(d);}return d;},CreateMiniRegTempCookie:function(d){var a=SpectrumUtils.ConvertHashtableToDelimitedString(d,"&","=",true);var b="specMR";if(a&&window.SetCookie){window.SetCookie(b,a,null,"/",window.globalDomainName);}},GetMiniRegTempCookie:function(){return window.GetCookie("specMR");},DeleteMiniRegTempCookie:function(){window.DeleteCookie("specMR","/",window.globalDomainName);},ShouldOverrideOrderLimit:function(a){if(!window.pathData){return false;}if(!window.pathData.OrderLimitOverrides){return false;}if(!window.pathData.OrderLimitOverrides[a]){return false;}return true;},OverrideCustomerOrderLimit:function(e){var d=window.pathData.OrderLimitOverrides[e.ScoringVariables.SegmentName];var a=e.ScoringVariables.LiveOrderCount;var b=d-a;e.ScoringVariables.TotalOrderLimit=b>0?b:0;},DecodePchEncodingA:function(a){return(a!=null&&a.length>0)?Base64.decode(a.substring(3)):"";},SetCustomerProperty:function(a,b,h){var g=SpectrumRegistrationCore.Utils;var f=g.PropertySetters[b];if(f){f(a,h);return;}var d="o_";if(b.indexOf(d)!=0){return;}var e=g.PropertySetters[d];e(a,b.substr(d.length),h);},PropertySetters:{ti:function(a,b){a.User.Title=b;},fn:function(a,b){a.User.FirstName=b;},ln:function(a,b){a.User.LastName=b;},aid:function(a,b){a.User.AddressId=b&&b.length?parseInt(b):0;},a1:function(a,b){a.User.Address1=b;},a2:function(a,b){a.User.Address2=b;},ci:function(a,b){a.User.City=b;},st:function(a,b){a.User.State=b?b.toUpperCase():b;},zi:function(a,b){a.User.Zip=b;},em:function(a,b){a.User.Email=b;},emh:function(a,b){a.User.EmailHash=b;},dob:function(a,b){a.User.DateOfBirth=b;},ol:function(a,b){a.ScoringVariables.MagOrderLimit=a.ScoringVariables.TotalOrderLimit=parseInt(b);},mol:function(a,b){a.ScoringVariables.MerchOrderLimit=parseInt(b);},seg:function(a,b){a.ScoringVariables.SegmentName=b;},segs:function(a,b){a.Segments.SegCodes=b?b.split(","):null;},tid:function(a,b){a.System.TrackingToken=b;},e:function(a,b){a.UserInternal.GlobalMemberToken=b;},gmt:function(a,b){a.UserInternal.GlobalMemberToken=b;},segid:function(a,b){a.System.AudienceId=b;},inu:function(a,b){a.UserInternal.IsNewUser=(parseInt(b)!=0);},isi:function(a,b){a.UserInternal.IsSignedIn=(parseInt(b)!=0);},poa:function(a,b){a.UserInternal.HasPasswordOnAccount=(parseInt(b)!=0);},rm:function(a,b){a.System.IsRememberMeChecked=(parseInt(b)!=0);},isa:function(a,b){a.System.IsSiteActivityCallMade=(parseInt(b)!=0);},vs:function(a,d){for(var b=0;b<d.length;b++){switch(d[b]){case"A":a.ValidationVariables.AddressValidationStatusCode="VALIDFAIL";break;case"E":a.ValidationVariables.EmailValidationStatusCode="VALIDFAIL";break;case"N":a.ValidationVariables.FieldValidationStatusCode="VALIDFAIL";break;}}},osc:function(a,b){a.OptIns.OptInStatusCode=parseInt(b);},o_:function(a,b,d){if(!d||!d.length){return;}a.OptIns.Subscriptions[b]=parseInt(d);},regs:function(a,b){a.Registrations.PropertyCodes=(b)?b.split(","):null;},led:function(a,b){a.SessionProfile.ProfileDataInUse.LastEntryDate=b;},loc:function(a,b){a.ScoringVariables.LiveOrderCount=parseInt(b);},frd:function(a,b){a.UserInternal.FirstEverRegDate=b;}},InitializeRegistrationResponseDto:function(){var b=SpectrumRegistrationCore.Utils;var a=b.LoadCustomerFromCookies();if(!a){window.SpectrumRegistrationResponseDto=undefined;return;}window.SpectrumRegistrationResponseDto={SpectrumCustomer:a};if(!b.ShouldCallValidationService(a)){return;}if(window.spectrumDeviceType==="MOBILE"){return;}b.CallValidationService(a);},ShouldCallValidationService:function(d){var e=SpectrumRegistrationCore.Utils;var a=typeof window.nameAndAddressValidationFlag!="undefined"?window.nameAndAddressValidationFlag:true;var b=a&&e.IsNameAddressValidationStatusInacceptable(d);return b;},CallValidationService:function(b){if(b.UserInternal&&b.UserInternal.HasPasswordOnAccount){if(!SpectrumRegistrationService.Handlers||!SpectrumRegistrationService.Handlers.OnValidateAndRegisterCustomer){return;}SpectrumRegistrationService.Handlers.OnValidateAndRegisterCustomer({SpectrumCustomer:b});return;}var a={SpectrumCustomer:b};SpectrumRegistrationService.ValidateAndRegisterCustomer(a);},ShouldCallSiteAcitivityApi:function(){if(window.SpectrumRegistrationResponseDto&&window.SpectrumRegistrationResponseDto.SpectrumCustomer&&window.SpectrumRegistrationResponseDto.SpectrumCustomer.System){return !window.SpectrumRegistrationResponseDto.SpectrumCustomer.System.IsSiteActivityCallMade;}return false;},IsNameAddressValidationStatusInacceptable:function(a){var b=SpectrumRegistrationCore.Utils;return b.IsStatusCodeValidFail(a.ValidationVariables.AddressValidationStatusCode)||b.IsStatusCodeValidFail(a.ValidationVariables.FieldValidationStatusCode);},IsStatusCodeValidFail:function(a){return a==="VALIDFAIL";},Pad:function(d,b,a){var e=""+d;while(e.length<b){e=a+e;}return e;},Array_Any:function(a,d){if(!a){return false;}if(!a.length){return false;}if(typeof d!="function"){return true;}for(var b=0;b<a.length;b++){if(d(a[b])){return true;}}return false;},Dictionary_Any:function(a,d){if(!a){return false;}for(var b in a){if(typeof d!="function"){return true;}if(d(b,a[b])){return true;}}return false;},IsGoldUserMismatchScenario:function(a){var b=SpectrumRegistrationCore.Utils;return(a&&a.ValidationResponse&&a.ValidationResponse.ValidationResponses&&a.ValidationResponse.ValidationResponses.FieldOrDatabaseValidationResponse&&a.ValidationResponse.ValidationResponses.FieldOrDatabaseValidationResponse.Responses&&b.Array_Any(a.ValidationResponse.ValidationResponses.FieldOrDatabaseValidationResponse.Responses,function(d){return d.Code===window.goldUserMismatchStatusCode;}))?true:false;},IsSilverUserMismatchScenario:function(a){var b=SpectrumRegistrationCore.Utils;return(a&&a.ValidationResponse&&a.ValidationResponse.ValidationResponses&&a.ValidationResponse.ValidationResponses.FieldOrDatabaseValidationResponse&&a.ValidationResponse.ValidationResponses.FieldOrDatabaseValidationResponse.Responses&&b.Array_Any(a.ValidationResponse.ValidationResponses.FieldOrDatabaseValidationResponse.Responses,function(d){return d.Code===window.silverUserMistmatchCode;}))?true:false;},IsFbUserRegistrationFailureCode:function(a){var b=SpectrumRegistrationCore.Utils;return(a&&a.ValidationResponse&&a.ValidationResponse.ValidationResponses&&a.ValidationResponse.ValidationResponses.FieldOrDatabaseValidationResponse&&a.ValidationResponse.ValidationResponses.FieldOrDatabaseValidationResponse.Responses&&b.Array_Any(a.ValidationResponse.ValidationResponses.FieldOrDatabaseValidationResponse.Responses,function(d){return d.Code===window.fbUserRegistrationFailureCode;}))?true:false;},IsMiniRegUser:function(a){var b=SpectrumRegistrationCore.Utils;return(a&&a.ValidationResponse&&a.ValidationResponse.ValidationResponses&&a.ValidationResponse.ValidationResponses.FieldOrDatabaseValidationResponse&&a.ValidationResponse.ValidationResponses.FieldOrDatabaseValidationResponse.Responses&&b.Array_Any(a.ValidationResponse.ValidationResponses.FieldOrDatabaseValidationResponse.Responses,function(d){return d.Code===window.miniRegUserFailureCode;}))?true:false;},IsFieldOrDbValidationScenario:function(a){var b=SpectrumRegistrationCore.Utils;return(a&&a.ValidationResponse&&a.ValidationResponse.ValidationResponses&&a.ValidationResponse.ValidationResponses.FieldOrDatabaseValidationResponse&&a.ValidationResponse.ValidationResponses.FieldOrDatabaseValidationResponse.Responses&&b.IsStatusCodeValidFail(a.ValidationResponse.ValidationResponses.FieldOrDatabaseValidationResponse.Responses.DbResponseCode))?true:false;},GetErrorCodeFromResponseAndErrorType:function(b,a){if(a==="blank"){return"Field";}if(!b||!b.ValidationResponse||!b.ValidationResponse.ValidationResponses){return null;}return PCH.SSO.interpreter.getErrorType(b.ValidationResponse.ValidationResponses);},GetSubmitEventTarget:function(a){if(a){var b=a.originalEvent?a.originalEvent.explicitOriginalTarget:null;if(!b){b=a.originalEvent?document.elementFromPoint(a.originalEvent.x,a.originalEvent.y):null;}if(b&&!$(b).is("form")){return $(b);}}return null;},CreateRfProxy:function(a,b){var d=new SpectrumRegistrationCore.RfProxy();d.Initialize({Controller:a,Presenter:b});return d;},InitializeSsoController:function(h,g,d,f,i){var b=SpectrumRegistrationCore.Logger;b.LogInformation("Initializing PCH.SSO lib...");try{if(!window.PCH||!PCH.SSO||!PCH.SSO.Controller){b.LogError("PCH.SSO library not found. Please include appropriate JS files");return false;}var j=Object.create(PCH.SSO.Controller);j.init({elements:h.GetElementsForSsoLib(),proxy:i,ui:h.IsMobile?"mobile":"desktop",success:g,failure:d,env:window.environmentName,skip:f});return j;}catch(a){b.LogError("Failed to initialize PCH.SSO.Controller",a);return null;}},RedirectTo:function(d,a){var b=a?SpectrumUtils.ConvertHashtableToDelimitedString(a,"&","=",true):null;if(b){d=d+"?"+b;}window.showAlert="false";window.location.href=d;return;},ReturnUserToPathUrl:function(a){a=a||window.SpectrumUtils.GetUrlParams();var b=a.pu||document.referrer;SpectrumRegistrationCore.Utils.RedirectTo(b);},RedirectToApiErrorPage:function(){if(typeof window.pchErrorPageSorry==="string"){SpectrumRegistrationCore.Utils.RedirectTo(window.pchErrorPageSorry);}},RedirectToEditInfo:function(a){var d=SpectrumRegistrationCore.Utils;var b=window.spectrumMyAccountUrl+d.Constants.M_EDITINFO;d.RedirectTo(b,a);return false;},GetUserEmail:function(a){a=a||window.SpectrumUtils.GetUrlParams();if(a.em){return a.em;}if(window.SpectrumRegistrationResponseDto&&window.SpectrumRegistrationResponseDto.SpectrumCustomer&&window.SpectrumRegistrationResponseDto.SpectrumCustomer.User){return window.SpectrumRegistrationResponseDto.SpectrumCustomer.User.Email;}return null;},HistoryBack:function(a){window.showAlert="false";history.back(a);},ShouldShowMyAccountForGoldUser:function(b){var e=SpectrumRegistrationCore.Utils;if(e.IsGoldUserMismatchScenario(b)){return true;}var d=b.SpectrumCustomer;var a=d.UserInternal.HasPasswordOnAccount;return a&&e.ShouldCallValidationService(d);},ShouldShowN1Message:function(d){var f=SpectrumRegistrationCore.Utils;var a=f.IsSilverUserMismatchScenario(d);var e=d?d.SpectrumCustomer:null;var b=e&&e.UserInternal&&!e.UserInternal.HasPasswordOnAccount;return b&&a;},ShouldShowPasswordFields:function(a){var b=SpectrumRegistrationCore.Utils;return b.IsFbUserRegistrationFailureCode(a);},ShouldAskMiniRegUserToSignIn:function(a){var b=SpectrumRegistrationCore.Utils;return b.IsUnrecognizedMiniRegUser(a);},UpdateOrderLimits:function(){if(typeof window.mpCalculateOrderLimit==="function"){window.mpCalculateOrderLimit();}if(typeof window.fChangeOrderLimit==="function"){window.fChangeOrderLimit();}if(typeof(Notifications)==="object"){var a=SpectrumRegistrationResponseDto.SpectrumCustomer.ScoringVariables.TotalOrderLimit;Notifications.Notify("on-regupdate-completed",null,a);}},WhenEnterKeyPressedClickControl:function(e,f){var b=function(g){if(g.which!=13){return;}if(g&&g.preventDefault){g.preventDefault();}f.click();};for(var a in e){if(!a){continue;}var d=e[a];d.keypress(b);}},CheckPassword:function(f,b,a){var g=SpectrumRegistrationCore.Utils;var e=g.InitializeSpectrumRegistrationService();if(!e){return;}e.Handlers.OnCheckPassword=f;e.Handlers.OnCheckPasswordFailure=b;var d=g.CreateRequestDto();d.SpectrumCustomer.User={Email:a};e.CheckPassword(d);},SignalUserIdentityFlowComplete:function(){var a=SpectrumRegistrationCore.Controller;if(!a){return;}if(SpectrumRegistrationCore.IsIdentPage()){a.StopSubmitProcessing(false);}if(a.IsRegLightboxOnScreen){if(a.IsUpdateButtonClicked){a.OnRegLightboxCancelClick();a.StopUpdateProcessing();}}return true;}};(function(d){function b(){this.Config=null;}b.prototype={GetDefaultConfig:function(){return{Presenter:SpectrumRegistrationCore.Presenter};},Initialize:function(e){var f=SpectrumRegistrationCore.Logger;f.LogInformation("Initializing SpectrumRegCore RfProxy...");var g=this;g.Config=e||g.GetDefaultConfig();return g;},register:function(){var g=SpectrumRegistrationCore.Logger;var h=a(this);try{g.LogInformation("RfProxy preparing request for registering user...");var e=SpectrumRegistrationCore.Controller;var j=SpectrumRegistrationCore.UserInfoCategories;var i=h.Config.Presenter.PrepareRequestDto(e.IsUpdateButtonClicked?j.RegFieldsOnly:j.RegFieldsAndOptins);g.LogInformation("RfProxy sending request for registering user...");SpectrumRegistrationService.ValidateAndRegisterCustomer(i);}catch(f){g.LogError("RfProxy.register failed",f);}},forgotPassword:function(){var f=SpectrumRegistrationCore.Logger;var g=a(this);try{f.LogInformation("RfProxy preparing request for forgot password...");var i=SpectrumRegistrationCore.UserInfoCategories;var h=g.Config.Presenter.PrepareRequestDto(i.RegFieldsOnly);f.LogInformation("RfProxy sending request for forgot password...");SpectrumRegistrationService.ForgotPassword(h);}catch(e){f.LogError("RfProxy.forgotPassword failed",e);}},login:function(){var f=SpectrumRegistrationCore.Logger;var g=a(this);try{f.LogInformation("RfProxy preparing request for sign In...");var i=SpectrumRegistrationCore.UserInfoCategories;var h=g.Config.Presenter.PrepareRequestDto(i.RegFieldsOnly);f.LogInformation("RfProxy sending request for sign In...");SpectrumRegistrationService.ProcessLogin(h);}catch(e){f.LogError("RfProxy.SignIn failed",e);}},update:function(){var f=SpectrumRegistrationCore.Logger;var g=a(this);try{f.LogInformation("RfProxy preparing request for update...");var i=SpectrumRegistrationCore.UserInfoCategories;var h=g.Config.Presenter.PrepareRequestDto(i.RegFieldsOnly);f.LogInformation("RfProxy sending request for update...");SpectrumRegistrationService.ValidateAndRegisterCustomer(h);}catch(e){f.LogError("RfProxy.update failed",e);}},resetPassword:function(){var f=SpectrumRegistrationCore.Logger;var g=a(this);try{f.LogInformation("RfProxy preparing request for reset password...");var i=SpectrumRegistrationCore.UserInfoCategories;var h=g.Config.Presenter.PrepareRequestDto(i.RegFieldsOnly);f.LogInformation("RfProxy sending request for reset password...");SpectrumRegistrationService.ResetPassword(h);}catch(e){f.LogError("RfProxy.resetPassword failed",e);}},createPassword:function(){var f=SpectrumRegistrationCore.Logger;var g=a(this);try{f.LogInformation("RfProxy preparing request for create password...");var i=SpectrumRegistrationCore.UserInfoCategories;var h=g.Config.Presenter.PrepareRequestDto(i.RegFieldsOnly);f.LogInformation("RfProxy sending request for create password...");SpectrumRegistrationService.SetPassword(h);}catch(e){f.LogError("RfProxy.createPassword failed",e);}},redirect:function(e){if(!e||!e.length){return;}window._globalSubmit=true;top.location.href=e;},performAnalytics:function(g){var f=SpectrumRegistrationCore.Logger;if(!g){f.LogError("tagObject is null or undefined","PCH.SSO");return;}if(typeof g.success!="function"){f.LogError("tagObject.success is not a function","PCH.SSO");}var h=SpectrumRegistrationCore.Utils;var e=g.reason;if(e==="failure"){e=g.errorCode;}if(window.Notifications){Notifications.Notify("on-registration-page-view",h,{viewCode:e});}if(typeof g.success==="function"){window.setTimeout(g.success,250);}},logout:function(e){SpectrumRegistrationCore.DeleteUserIdentificationAndCartCookies();if(typeof e==="function"){e();}},skipEmailVal:function(f,e){SpectrumRegistrationCore.Logger.LogInformation("skipEmailVal called with these params..."+f+", "+e);var g=a(this);if(!g){return;}g.Config.Presenter.SkipEmailValidation={Email:e,ErrorCode:f};}};function a(e){return(e instanceof SpectrumRegistrationCore.RfProxy)?e:e._externalProxy;}d.SpectrumRegistrationCore.RfProxy=b;})(window);SpectrumRegistrationCore.Presenter={IsInlineRegPresent:false,IsMobile:false,FieldsContainer:null,RememberMeCheckbox:$("#chkRememberMe"),Controls:null,Labels:null,RegLightbox:null,SkipEmailValidation:null,Initialize:function(){var a=SpectrumRegistrationCore.Logger;a.LogInformation("Initializing SpectrumRegCore presenter...");var b=SpectrumRegistrationCore.Presenter;b.IsInlineRegPresent=SpectrumRegistrationCore.IsIdentPage();b.IsMobile=$("div.mobileReg").length?true:false;b.InitializeControls();},FillRequestDtoUsingFrontEnd:function(e,i){var f=e.SpectrumCustomer;f.OptIns={Subscriptions:{}};var d=SpectrumRegistrationCore.Presenter;var g=SpectrumRegistrationCore.UserInfoCategories;if((i&g.RegFieldsOnly)===g.RegFieldsOnly){f.User=d.GetUserInfoUsingFrontEnd(true);var b=$(".DOBDate").length;if(b){var a=d.Controls.Month.safeVal()+"/"+d.Controls.Day.safeVal()+"/"+d.Controls.Year.safeVal();f.User.DateOfBirth=(a==="00/00/0000")?"":a;}var h=SpectrumRegistrationCore.Utils;if(!f.User.Email&&window.SpectrumRegistrationResponseDto&&window.SpectrumRegistrationResponseDto.SpectrumCustomer){f.User=h.CloneObject(window.SpectrumRegistrationResponseDto.SpectrumCustomer.User);}}if((i&g.OptinsOnly)===g.OptinsOnly){f.OptIns.Subscriptions=d.GetOptinsFromUI(true);}f.System.IsRememberMeChecked=d.RememberMeCheckbox.is(":checked");if(window.isEmailValidationOn){f.System.IsEmailValidationOnAtPathLevel=true;}if(!f.ValidationVariables){f.ValidationVariables={};}f.ValidationVariables.SkipEmailValidation=d.SkipEmailValidation;},GetUserInfoUsingFrontEnd:function(b){var a=SpectrumRegistrationCore.Presenter;var d={Title:a.Controls.Title.safeVal(),FirstName:a.Controls.FirstName.safeVal(),LastName:a.Controls.LastName.safeVal(),Address1:a.Controls.Address1.safeVal(),Address2:a.Controls.Address2.safeVal(),City:a.Controls.City.safeVal(),State:a.Controls.State.safeVal(),Zip:a.Controls.ZipCode.safeVal(),Email:a.Controls.Email.safeVal(),ConfirmEmail:a.Controls.ConfirmEmail.safeVal(),Password:b?a.Controls.Password.safeVal():null,ConfirmPassword:b?a.Controls.ConfirmPassword.safeVal():null};if(window.SpectrumRegistrationResponseDto&&window.SpectrumRegistrationResponseDto.SpectrumCustomer&&window.SpectrumRegistrationResponseDto.SpectrumCustomer.User){d.AddressId=window.SpectrumRegistrationResponseDto.SpectrumCustomer.User.AddressId;}return d;},IsOptinDevicePresent:function(){return $(".SpectrumOptinList").length>0;},GetOptinsFromUI:function(a){var d={};var b=a?":checked":":not(:checked)";$(".SpectrumOptinList input"+b).each(function(e,f){var g=$(f).attr("id").substr(3);d[g]=0;});return d;},PersonalizeUI:function(){var a=SpectrumRegistrationCore.Logger;a.LogInformation("Personalizing UI...");var b=SpectrumRegistrationCore.Presenter;b.PopulateRegistrationControl();b.HideEmailControlsOnInlineRegForGoldUser();if(typeof window.fUpdatePersonalization==="function"){window.fUpdatePersonalization();}},PopulateRegistrationControl:function(){var b=SpectrumRegistrationCore;if(!b.IsUserRecognized()){return;}var k=SpectrumRegistrationCore.Utils;var g=SpectrumRegistrationCore.Presenter;if(g.IsMobile){var a=k.GetMiniRegTempCookie();if(a&&a.length>1){g.PopulateRegistrationControlFromCookie(a);k.DeleteMiniRegTempCookie();return;}}var h=window.SpectrumRegistrationResponseDto.SpectrumCustomer.User;g.Controls.Title.safeVal(h.Title);g.Controls.FirstName.safeVal(h.FirstName);g.Controls.LastName.safeVal(h.LastName);g.Controls.Address1.safeVal(h.Address1);g.Controls.Address2.safeVal(h.Address2);g.Controls.City.safeVal(h.City);g.Controls.State.safeVal(h.State);$(".State").safeVal(h.State);g.Controls.ZipCode.safeVal(h.Zip);g.Controls.Email.safeVal(h.Email);g.Controls.ConfirmEmail.safeVal((h.ConfirmEmail&&h.ConfirmEmail.length)?h.ConfirmEmail:h.Email);var i=window.SpectrumRegistrationResponseDto.SpectrumCustomer.UserInternal;if(h.AddressId==0&&i.IsSignedIn){g.DisableFormField("Email");g.DisableFormField("ConfirmEmail");}var e=g.Controls.Day.length;if(e){var d="00",f="00",l="0000";var j=(h.DateOfBirth&&h.DateOfBirth.length)?new Date(h.DateOfBirth):null;if(j){d=k.Pad(j.getDate(),2,"0");f=k.Pad(j.getMonth()+1,2,"0");l=j.getFullYear();}g.Controls.Day.safeVal(d);g.Controls.Month.safeVal(f);g.Controls.Year.safeVal(l);}if(window.SpectrumRegistrationResponseDto.SpectrumCustomer.System.IsRememberMeChecked){g.RememberMeCheckbox.attr("checked","checked");}else{g.RememberMeCheckbox.removeAttr("checked");}if(!g.Controls.State.val()){g.Controls.State.safeVal("");}},PopulateRegistrationControlFromCookie:function(a){var d={};SpectrumUtils.ParseValueAsHashtable(unescape(a),d,"&","=");var b=SpectrumRegistrationCore.Presenter;b.Controls.Title.safeVal(d.Title);b.Controls.FirstName.safeVal(d.FirstName);b.Controls.LastName.safeVal(d.LastName);b.Controls.Address1.safeVal(d.Address1);b.Controls.Address2.safeVal(d.Address2);b.Controls.City.safeVal(d.City);b.Controls.State.safeVal(d.State);$(".State").safeVal(d.State);b.Controls.ZipCode.safeVal(d.Zip);b.Controls.Email.safeVal(d.Email);b.Controls.ConfirmEmail.safeVal((d.ConfirmEmail&&d.ConfirmEmail.length)?d.ConfirmEmail:d.Email);b.DisableFormField("Email");b.DisableFormField("ConfirmEmail");},Find:function(b){if(!b||!b.length){return null;}var d=SpectrumRegistrationCore.Presenter;var a=d.FieldsContainer.find(b);if(!a||!a.length){return null;}return a;},InitializeControls:function(){var e=SpectrumRegistrationCore.Presenter;e.FieldsContainer=$("#spectrumRegForm");e.Controls={Title:e.FieldsContainer.find("#TI"),FirstName:e.FieldsContainer.find("#FN"),LastName:e.FieldsContainer.find("#LN"),Address1:e.FieldsContainer.find("#A1"),Address2:e.FieldsContainer.find("#A2"),City:e.FieldsContainer.find("#CI"),State:e.FieldsContainer.find("#ST"),ZipCode:e.FieldsContainer.find("#ZI"),Month:e.FieldsContainer.find("#MN"),Day:e.FieldsContainer.find("#DY"),Year:e.FieldsContainer.find("#YR"),Email:e.FieldsContainer.find("#EM"),ConfirmEmail:e.FieldsContainer.find("#CE"),Password:e.FieldsContainer.find("#PW"),ConfirmPassword:e.FieldsContainer.find("#CP")};e.Labels={Email:e.IsMobile?e.FieldsContainer.find("fieldset.email"):e.FieldsContainer.find("label[for*='EM']"),ConfirmEmail:e.FieldsContainer.find("label[for*='CE']")};e.Controls.ConfirmEmail.bind("paste",function(g){g.preventDefault();});e.Controls.State.html($(".State").html());var d=SpectrumRegistrationCore.Controller;if(!e.IsInlineRegPresent){var a=e.FieldsContainer.find("div.submit-container a.cancel-btn");var b=a.find("img");a.click(d.OnRegLightboxCancelClick);b.bind({mouseover:function(){$(this).attr("src",window.mediaPath+"Spectrum/images/btn_cancel_hover.png");},mouseout:function(){$(this).attr("src",window.mediaPath+"Spectrum/images/btn_cancel.png");},mousedown:function(){$(this).attr("src",window.mediaPath+"Spectrum/images/btn_cancel_pressed.png");},mouseup:function(){$(this).attr("src",window.mediaPath+"Spectrum/images/btn_cancel.png");}});var f=$("#spectrumRegLightboxUpdateBtn");f.click(d.OnRegLightboxUpdateClick);f.bind({mouseover:function(){$(this).attr("src",window.mediaPath+"Spectrum/images/btn_update_hover.png");},mouseout:function(){$(this).attr("src",window.mediaPath+"Spectrum/images/btn_update.png");},mousedown:function(){$(this).attr("src",window.mediaPath+"Spectrum/images/btn_update_pressed.png");},mouseup:function(){$(this).attr("src",window.mediaPath+"Spectrum/images/btn_update_hover.png");}});}window.flbReg_Show=d.OnEditInfoButtonClick;},GetElementsForSsoLib:function(){var a=SpectrumRegistrationCore.Presenter;return{container:a.FieldsContainer,title:a.Controls.Title.length?a.Controls.Title:null,firstName:a.Controls.FirstName.length?a.Controls.FirstName:null,lastName:a.Controls.LastName.length?a.Controls.LastName:null,address1:a.Controls.Address1.length?a.Controls.Address1:null,address2:a.Controls.Address2.length?a.Controls.Address2:null,city:a.Controls.City.length?a.Controls.City:null,state:a.Controls.State.length?a.Controls.State:null,zipcode:a.Controls.ZipCode.length?a.Controls.ZipCode:null,month:a.Controls.Month.length?a.Controls.Month:null,day:a.Controls.Day.length?a.Controls.Day:null,year:a.Controls.Year.length?a.Controls.Year:null,email:a.Controls.Email.length?a.Controls.Email:null,confirmEmail:a.Controls.ConfirmEmail.length?a.Controls.ConfirmEmail:null,password:a.Controls.Password.length?a.Controls.Password:null,confirmPassword:a.Controls.ConfirmPassword.length?a.Controls.ConfirmPassword:null};},IsRegistrationControlPresent:function(){var a=SpectrumRegistrationCore.Presenter;return a.FieldsContainer.length?true:false;},ReloadOptins:function(){if(typeof window.Optin_DeviceRender==="function"){window.Optin_DeviceRender();}if(!window.SpectrumDeviceManager){return;}var a={DeviceType:"Optin",PresentationStyle:DevicePresentationStyles.InPage,renderAsHidden:false,forceDisplay:false};SpectrumDeviceManager.ForEachStepDeviceInstance(a,function(b){SpectrumDeviceManager.RefreshDevice(b,a);});},PrepareRequestDto:function(e){var d=SpectrumRegistrationCore.Utils;var b=d.CreateRequestDto();var a=SpectrumRegistrationCore.Presenter;a.FillRequestDtoUsingFrontEnd(b,e);return b;},HideEmailControlsOnInlineRegForGoldUser:function(){var b=SpectrumRegistrationCore.Presenter;var a=SpectrumRegistrationCore.IsGoldUser();if(!b.IsInlineRegPresent||!a){return;}b.Labels.Email.hide();b.Controls.Email.hide();b.Labels.ConfirmEmail.hide();b.Controls.ConfirmEmail.hide();},ShowRegLightbox:function(a){var d=SpectrumRegistrationCore.Presenter;var b=SpectrumRegistrationCore.Controller;d.RegLightbox={overlay:$("#regLightbox_overlay"),content:$("#registration"),showCallback:a,onOverlayClick:b.OnRegLightboxCancelClick};SpectrumLightbox.ShowLightbox(d.RegLightbox);},HideRegLightbox:function(){var a=SpectrumRegistrationCore.Presenter;if(!a.RegLightbox){return;}SpectrumLightbox.HideLightbox(a.RegLightbox);a.RegLightbox=null;},ShouldSuggestCityAndState:function(){return(SpectrumRegistrationCore.IsIdentPage()&&!SpectrumRegistrationCore.IsUserRecognized()&&window.isCityStateSuggestionOn);},TakeoverFieldsBlur:function(a){var b=SpectrumRegistrationCore.Presenter;b.Controls.Address1.bind("blur",a);b.Controls.ZipCode.bind("blur",a);return true;},UnbindFieldsBlur:function(){var a=SpectrumRegistrationCore.Presenter;a.Controls.Address1.unbind("blur");a.Controls.ZipCode.unbind("blur");},AreZipCodeAndA1Populated:function(){var b=SpectrumRegistrationCore.Presenter;var a=b.Controls.Address1.safeVal();var d=b.Controls.ZipCode.safeVal();return a.length>0&&d.length>0;},ShowPasswordFields:function(){var b=SpectrumRegistrationCore.Presenter;if(b.IsInlineRegPresent){b.Controls.Password.addClass("required");b.Controls.ConfirmPassword.addClass("required");var a=$("label[for=PW],label[for=CP]");b.Controls.Password.slideDown("fast",function(){$(this).removeAttr("style").show();});b.Controls.ConfirmPassword.slideDown("fast",function(){$(this).removeAttr("style").show();});a.removeClass("rf-hidden").css({height:"1px"}).animate({height:14});}else{b.Controls.Password.addClass("required");b.Controls.ConfirmPassword.addClass("required");$("#passwordDiv").show();}},DisableFormField:function(a){var b=SpectrumRegistrationCore.Presenter;if(!b.Controls[a]){return;}b.Controls[a].attr("disabled","disabled");},HideFormField:function(a){var e=SpectrumRegistrationCore.Presenter;if(!e.Controls[a]){return;}if(!e.Controls[a].is(":visible")){return;}e.Controls[a].hide();e.Controls[a].removeClass("required");e.Controls[a].removeClass("required");var d=e.Controls[a].attr("id");var b=$("label[for="+d+"]");if(!b){return;}b.hide();}};SpectrumRegistrationCore.Logger={InfoLogEnabled:false,WarningLogEnabled:true,ErrorLogEnabled:true,LogInformation:function(b){var a=SpectrumRegistrationCore.Logger;if(a.InfoLogEnabled&&window.console&&typeof console.info==="function"){console.info(b);}},LogError:function(b,d){var a=SpectrumRegistrationCore.Logger;if(a.ErrorLogEnabled&&window.console&&typeof console.error==="function"){console.error(b+(d?". Root cause -> "+d:""));}},LogWarning:function(b,d){var a=SpectrumRegistrationCore.Logger;if(a.WarningLogEnabled&&window.console&&typeof console.warn==="function"){console.warn(b+(d?". Root cause -> "+d:""));}}};SpectrumRegistrationCore.Controller={ShouldWaitForAnalyticsToComplete:false,SSOController:null,MiniMyAccountInstance:null,IsProcessingSubmit:false,SubmitElement:null,OriginalResponseDto:null,IsUpdateButtonClicked:false,IsEOFormOrProductAdminSummaryPage:false,IsRegLightboxOnScreen:false,IsSubmitClickTracked:false,IsFormSubmitInitiated:false,AreAddressFieldsExpanded:false,MiniRegUserRegistrationInfo:null,Initialize:function(){var d=SpectrumRegistrationCore.Logger;d.LogInformation("Initializing SpectrumRegCore controller...");var e=SpectrumRegistrationCore.Presenter;var a=SpectrumRegistrationCore.Controller;a.InitializeSpectrumRegistrationService();if(!a.InitializeSsoLib()){return false;}if(!a.TakeoverPageSubmit()){return false;}a.HookupAnalytics();var g=SpectrumRegistrationCore.Utils;g.InitializeRegistrationResponseDto();a.TakeoverFieldsBlurForCityState();e.PersonalizeUI();var b=$("body.eo").length?true:false;if(b&&window.spectrumDeviceType=="MOBILE"){Notifications.Subscribe("on-eoform-after-execute",function(i,h){g.UpdateOrderLimits();});}var f=(window.OrderMode=="SummaryTab");a.IsEOFormOrProductAdminSummaryPage=(b||f);return true;},InitializeSpectrumRegistrationService:function(){var b=SpectrumRegistrationCore.Utils.InitializeSpectrumRegistrationService();if(!b){return;}var a=SpectrumRegistrationCore.Controller;b.Handlers.OnValidateAndRegisterCustomer=a.OnValidateAndRegisterCustomer;b.Handlers.OnValidateAndRegisterCustomerFailure=a.OnValidateAndRegisterCustomerFailure;b.Handlers.OnProcessOptins=a.OnProcessOptins;b.Handlers.OnProcessOptinsFailure=a.OnProcessOptinsFailure;b.Handlers.OnSetSiteActivity=a.OnSetSiteActivity;b.Handlers.OnSetSiteActivityFailure=a.OnSetSiteActivity;b.Handlers.OnSuggestCityAndState=a.OnSuggestCityAndState;b.Handlers.OnSuggestCityAndStateFailure=a.OnSuggestCityAndStateFailure;},InitializeSsoLib:function(){var a=SpectrumRegistrationCore.Controller;var b=SpectrumRegistrationCore.Presenter;var d=SpectrumRegistrationCore.Utils;a.SSOController=d.InitializeSsoController(b,a.OnValidationSuccessful,a.OnValidationErrors,a.OnSkip,d.CreateRfProxy(a,b));return a.SSOController?true:false;},TakeoverPageSubmit:function(a){var d=SpectrumRegistrationCore.Logger;d.LogInformation("Taking over page submits..."+(a?"SuppliedCallback":"OnSpectrumFormSubmit"));var b=SpectrumRegistrationCore.Controller;if(!a){a=b.OnSpectrumFormSubmit;}$("#submitButton,#sub-btn").unbind("click").removeAttr("onclick");$("form").unbind("submit");if(!window.Notifications){d.LogError("Notifications library not found. Please include appropriate javascript file");return false;}$(":submit").bind("click",a);if(window.Notifications){Notifications.Subscribe("on-before-form-submit",a,true);}return true;},HookupAnalytics:function(){var a=SpectrumRegistrationCore.Controller;a.ShouldWaitForAnalyticsToComplete=(window.SpectrumAnalyticsHelper&&window.SpectrumAnalyticsHelper.IsAnalyticsCompleteEventEnabled())?true:false;if(window.Notifications){Notifications.Subscribe("on-analytics-complete",a.OnAnalyticsComplete);}},OnAnalyticsComplete:function(){var a=SpectrumRegistrationCore.Controller;if(a.IsProcessingSubmit){a.SubmitForm();a.StopSubmitProcessing(true);}},OnSpectrumFormSubmit:function(d){if(d&&d.preventDefault){d.preventDefault();}var f=SpectrumRegistrationCore.Logger;f.LogInformation("Received form submit notification...");var a=SpectrumRegistrationCore.Controller;var l=SpectrumRegistrationCore.Utils;var i=a.StartSubmitProcessing(l.GetSubmitEventTarget(d));if(!i){return NotificationResults.Cancel;}var h=SpectrumRegistrationCore.Presenter;if(!a.AreAddressFieldsExpanded){a.ShowCityAndState();}if(!a.IsSubmitClickTracked&&h.IsInlineRegPresent){Notifications.Notify("on-registration-page-view",a,{viewCode:"FTSubmit"});a.IsSubmitClickTracked=true;}i=Notifications.Notify("on-spectrum-form-submit",null);if(i===NotificationResults.Cancel){a.StopSubmitProcessing(false);return NotificationResults.Cancel;}if(h.IsInlineRegPresent){a.Register();}else{var k=SpectrumRegistrationCore.UserInfoCategories;var g=h.PrepareRequestDto(k.RegFieldsAndOptins);if(g.SpectrumCustomer&&g.SpectrumCustomer.OptIns&&l.Dictionary_Any(g.SpectrumCustomer.OptIns.Subscriptions)){a.ProcessOptins(g);}else{if(window.spectrumDeviceType!="MOBILE"){var b=SpectrumRegistrationCore;if(b.IsUserRecognized()&&l.ShouldCallValidationService(window.SpectrumRegistrationResponseDto.SpectrumCustomer)){a.OnEditInfoButtonClick();a.StopSubmitProcessing(false);return window.NotificationResults.Cancel;}}if(l.ShouldCallSiteAcitivityApi()){var j=h.PrepareRequestDto(k.RegFieldsOnly);a.SetSiteActivity(j);return window.NotificationResults.Cancel;}a.NotifyPageSubmitting();if(!a.ShouldWaitForAnalyticsToComplete){a.SubmitForm();}else{a.DelayFormSubmit();}}}return window.NotificationResults.Cancel;},OnValidateAndRegisterCustomer:function(i){var h=SpectrumRegistrationCore.Logger;var a=SpectrumRegistrationCore.Controller;var k=SpectrumRegistrationCore.Utils;h.LogInformation("Received response from ValidateAndRegisterCustomer API...");try{window.SpectrumRegistrationResponseDto=i;if(k.ShouldShowN1Message(i)){a.ShowN1Message(i);return;}if(k.ShouldShowMyAccountForGoldUser(i)){a.ShowMyAccount(true);return;}if(k.ShouldShowPasswordFields(i)){a.ShowPasswordFields();}if(k.IsMiniRegUser(i)){a.SaveMiniRegUserInfo();a.ShowMyAccount(false);a.StopSubmitProcessing(false);return;}var g=i.ValidationResponse&&i.ValidationResponse.ValidationResponses;var d=g&&!i.ValidationResponse.ValidationResponses.IsValid;var f=g&&i.ValidationResponse.ValidationResponses.IsSkip;var j=d||f;if(j){a.ShowValidationErrors(i.ValidationResponse.ValidationResponses);}else{a.OnValidationSuccessful();}}catch(b){h.LogError("Failed to process ValidateAndRegisterCustomer service response with customer information",b);}},SaveMiniRegUserInfo:function(){var a=SpectrumRegistrationCore.Controller;var b=SpectrumRegistrationCore.Presenter;if(b.IsMobile){SpectrumRegistrationCore.Utils.CreateMiniRegTempCookie(b.GetUserInfoUsingFrontEnd(false));}else{a.MiniRegUserRegistrationInfo=b.GetUserInfoUsingFrontEnd();}},ShowMyAccount:function(d){var a=SpectrumRegistrationCore.Controller;var b=SpectrumRegistrationCore.Presenter;var e=SpectrumRegistrationCore.Utils;if(b.IsMobile){a.RedirectToMyAccountUrl(e.Constants.M_SIGNIN,d);}else{a.ShowMiniMyAccount();}return;},ShowValidationErrors:function(e){if(!e){return;}var b=SpectrumRegistrationCore.Controller;var a=function(){b.SSOController.onRegister(e);};var d=SpectrumRegistrationCore.Presenter;if(!d.IsInlineRegPresent){b.ShowRegLightbox(a);}else{a();}},OnProcessOptins:function(h){var f=SpectrumRegistrationCore.Logger;f.LogInformation("Received response from ProcessOptins...");try{window.SpectrumRegistrationResponseDto=h;var b=SpectrumRegistrationCore;Notifications.Notify("on-optin-changed",b);var a=SpectrumRegistrationCore.Controller;a.NotifyPageSubmitting();var g=SpectrumRegistrationCore.Presenter;var i=!g.IsInlineRegPresent&&!a.ShouldWaitForAnalyticsToComplete;if(i){a.SubmitForm();a.StopSubmitProcessing(true);}else{if(!g.IsInlineRegPresent){a.DelayFormSubmit();}}}catch(d){f.LogError("Failed to process ProcessOptins service response with customer information",d);}},OnSetSiteActivity:function(f){var d=SpectrumRegistrationCore.Logger;d.LogInformation("Received response from SetSiteActivity...");try{var a=SpectrumRegistrationCore.Controller;a.NotifyPageSubmitting();if(!a.ShouldWaitForAnalyticsToComplete){a.SubmitForm();}else{a.DelayFormSubmit();}}catch(b){d.LogError("Failed to process SetSiteActivity service response with customer information",b);}},OnValidateAndRegisterCustomerFailure:function(b,d){var e=SpectrumRegistrationCore.Logger;e.LogError("Validate and register API call failed: jqXhrStatus",d+", errorThrown: "+b);var a=SpectrumRegistrationCore.Controller;a.StopSubmitProcessing(false);if(d==418||d==419||d==403){a.SaveMiniRegUserInfo();a.ShowMyAccount(false);return;}var f=SpectrumRegistrationCore.Utils;f.RedirectToApiErrorPage();},OnProcessOptinsFailure:function(a){var b=SpectrumRegistrationCore.Logger;b.LogError("Process Optins API call failed",a);var d=SpectrumRegistrationCore.Utils;d.RedirectToApiErrorPage();},OnSkip:function(){var a=SpectrumRegistrationCore.Controller;if(a.IsRegLightboxOnScreen){a.IsUpdateButtonClicked=true;}a.OnValidationSuccessful();},OnValidationSuccessful:function(){var g=SpectrumRegistrationCore.Logger;g.LogInformation("User information validated successfully");var a=SpectrumRegistrationCore.Controller;var h=SpectrumRegistrationCore.Presenter;if(a.IsUpdateButtonClicked||a.IsProcessingSubmit){var f=h.IsInlineRegPresent?"Inline":"LB1";Notifications.Notify("on-registration-lightbox-event",a,{eventName:"LBComplete",lightboxName:f});}a.RefreshOrderLimitsAndUI();try{Notifications.Notify("on-user-info-changed",null);}catch(b){g.LogError("Notification handler for 'on-user-info-changed' failed",b);}var d=h.IsInlineRegPresent;if(d){a.NotifyPageSubmitting();}var i=d&&!a.ShouldWaitForAnalyticsToComplete;if(i){a.SubmitForm();a.StopSubmitProcessing(true);}else{if(d){a.DelayFormSubmit();}}if(a.IsUpdateButtonClicked){a.OriginalResponseDto=null;a.SSOController.clearErrors();a.HideRegLightbox();a.StopUpdateProcessing();}},OnValidationErrors:function(d){var f=SpectrumRegistrationCore.Logger;f.LogInformation("Validation errors found in user information");var a=SpectrumRegistrationCore.Controller;a.StopSubmitProcessing(false);a.StopUpdateProcessing();var g=SpectrumRegistrationCore.Presenter;var e=g.IsInlineRegPresent?"Inline":"LB1";var h=SpectrumRegistrationCore.Utils;var b=h.GetErrorCodeFromResponseAndErrorType(window.SpectrumRegistrationResponseDto,d);if(b&&b.length){Notifications.Notify("on-registration-lightbox-event",a,{eventName:"LBFail",lightboxName:e,errorCode:b});}},SubmitForm:function(){var a=SpectrumRegistrationCore.Controller;if(a.IsFormSubmitInitiated){return;}$("form").unbind("submit",a.OnSpectrumFormSubmit);if(window.DeleteOptinsHiddenField){window.DeleteOptinsHiddenField();}window._globalSubmit=true;$("form").submit();a.IsFormSubmitInitiated=true;},DelayFormSubmit:function(){window.setTimeout("SpectrumRegistrationCore.Controller.SubmitForm()",window.maxAnalyticsWaitTime);},NotifyPageSubmitting:function(){if(typeof(Notifications)==="object"){Notifications.Notify("on-page-submitting",null,null);}},ShowRegLightbox:function(a){var d=SpectrumRegistrationCore.Logger;var b=SpectrumRegistrationCore.Controller;if(b.IsRegLightboxOnScreen){d.LogInformation("Reg lightbox already on screen, ignoring request to show it again...");if(typeof a==="function"){a();}return;}d.LogInformation("Showing registration lightbox...");var f=SpectrumRegistrationCore.Utils;if(window.SpectrumRegistrationResponseDto){b.OriginalResponseDto=f.CloneObject(window.SpectrumRegistrationResponseDto);}var e=SpectrumRegistrationCore.Presenter;e.ShowRegLightbox(a);b.IsRegLightboxOnScreen=true;},HideRegLightbox:function(){var b=SpectrumRegistrationCore.Presenter;b.HideRegLightbox();var a=SpectrumRegistrationCore.Controller;a.IsRegLightboxOnScreen=false;},ShowMiniMyAccount:function(){var e=SpectrumRegistrationCore.Logger;if(!window.MiniMyAccountsLauncher){e.LogError("Please include MiniMyAccountsLauncher.js");return;}var b=SpectrumRegistrationCore.Controller;if(b.MiniMyAccountInstance){e.LogInformation("MMA instance already exists... Ignoring request to show another one");return;}e.LogInformation("Showing Mini MyAccount...");if(!window.miniMyAccountUrl||!window.miniMyAccountUrl.length){return;}var d=null;if(SpectrumRegistrationCore.IsUserRecognized()){d=window.SpectrumRegistrationResponseDto.SpectrumCustomer.User.Email;}var a="SPECTRUM";var f=b.PrepareMmaUrl("&spEm="+d+"&app="+a);b.MiniMyAccountInstance=window.MiniMyAccountsLauncher.getInstance(null,f);b.MiniMyAccountInstance.create();},PrepareMmaUrl:function(b){var a=window.miniMyAccountUrl;if(window.spectrumUrlsAreRelative){a=a+"?proxyUrl="+window.baseUrl+window.miniMyAccountSpectrumProxyUrl;}a=a+b;return a;},HideMiniMyAccount:function(a){var d=SpectrumRegistrationCore.Logger;d.LogInformation("Closing Mini MyAccount...");var b=SpectrumRegistrationCore.Controller;b.MiniMyAccountInstance.destroy(function(){b.MiniMyAccountInstance=null;if(typeof a==="function"){a();}});},OnMiniMyAccountUpdateSuccess:function(){var b=SpectrumRegistrationCore.Logger;b.LogInformation("Mini MyAccount > Update was successful");var a=SpectrumRegistrationCore.Controller;Notifications.Notify("on-registration-lightbox-event",a,{eventName:"LBComplete",lightboxName:a.GetMiniMyAccountLightboxName()});a.RefreshCookiesAndUIPostMMA();a.HideMiniMyAccount();if(a.IsUpdateButtonClicked){a.OriginalResponseDto=null;a.HideRegLightbox();a.StopUpdateProcessing();}a.StopSubmitProcessing(false);},OnMiniMyAccountLoginSuccess:function(){var b=SpectrumRegistrationCore.Logger;b.LogInformation("Mini MyAccount > Login was successful");var a=SpectrumRegistrationCore.Controller;a.RefreshCookiesAndUIPostMMA(a.MiniRegUserRegistrationInfo);var d=SpectrumRegistrationCore.Presenter;a.DisableEmailFields();d.HideFormField("Password");d.HideFormField("ConfirmPassword");a.HideMiniMyAccount(function(){if(a.IsUpdateButtonClicked){a.StopUpdateProcessing();}});},OnMiniMyAccountCancelClick:function(){var b=SpectrumRegistrationCore.Logger;b.LogInformation("Mini MyAccount > Cancel button or overlay was clicked");var a=SpectrumRegistrationCore.Controller;a.HideMiniMyAccount(function(){if(a.IsUpdateButtonClicked){a.OnRegLightboxCancelClick();a.StopUpdateProcessing();}var d=SpectrumRegistrationCore;if(d.IsUserRecognized()){a.RefreshCookiesAndUIPostMMA();}a.StopSubmitProcessing(false);Notifications.Notify("on-registration-lightbox-event",a,{eventName:"LBCancel",lightboxName:a.GetMiniMyAccountLightboxName()});});},OnMiniMyAccountNotYouClick:function(){SpectrumRegistrationCore.HandleNotYouLink();var a=SpectrumRegistrationCore.Controller;a.StopSubmitProcessing(false);},StartSubmitProcessing:function(d){var b=SpectrumRegistrationCore.Logger;var a=SpectrumRegistrationCore.Controller;if(a.IsProcessingSubmit){b.LogInformation("Submit processing already in progress... Ignoring button click");return false;}a.IsProcessingSubmit=true;if(d&&d.length&&!$.browser.msie){a.SubmitElement=d;a.SubmitElement.attr("disabled","disabled");}document.body.style.cursor="wait";return true;},StopSubmitProcessing:function(b){var d=SpectrumRegistrationCore.Logger;var a=SpectrumRegistrationCore.Controller;if(!a.IsProcessingSubmit){d.LogInformation("Request to stop submit processing received when submit processing was not underway!");return false;}a.IsProcessingSubmit=false;if(a.SubmitElement){if(!b){a.SubmitElement.removeAttr("disabled");}a.SubmitElement=null;}document.body.style.cursor="default";return true;},OnRegLightboxCancelClick:function(b){if(b){b.preventDefault();}var d=SpectrumRegistrationCore.Logger;d.LogInformation("Cancel clicked... Closing lightbox");var a=SpectrumRegistrationCore.Controller;if(a.OriginalResponseDto){window.SpectrumRegistrationResponseDto=a.OriginalResponseDto;a.OriginalResponseDto=null;var f=SpectrumRegistrationCore.Presenter;f.PersonalizeUI();a.SSOController.clearErrors();}a.HideRegLightbox();Notifications.Notify("on-registration-lightbox-event",a,{eventName:"LBCancel",lightboxName:"LB1"});},OnRegLightboxUpdateClick:function(b){if(b){b.preventDefault();}var a=SpectrumRegistrationCore.Controller;var f=a.StartUpdateProcessing();if(!f){return;}Notifications.Notify("on-registration-lightbox-event",a,{eventName:"LBUpdate",lightboxName:"LB1"});var d=SpectrumRegistrationCore.Logger;d.LogInformation("Update clicked... Processing customer information");a.Register();},OnEditInfoButtonClick:function(d){if(d){d.preventDefault();}var g=SpectrumRegistrationCore.Logger;g.LogInformation("EditInfo button clicked... Checking if MMA or regular lightbox should be shown");var h=SpectrumRegistrationCore.Presenter;var f=(h&&h.IsMobile);if(f){var i=SpectrumRegistrationCore.Utils;i.RedirectToEditInfo();return false;}if(window.Notifications){Notifications.Notify("need-video-stopped",null,null);}var b=SpectrumRegistrationCore.Controller;if(b.HasPasswordOnAccount(window.SpectrumRegistrationResponseDto)){b.ShowMiniMyAccount();}else{var a=function(){if(window.SpectrumRegistrationResponseDto&&window.SpectrumRegistrationResponseDto.ValidationResponse&&window.SpectrumRegistrationResponseDto.ValidationResponse.ValidationResponses){b.SSOController.onRegister(window.SpectrumRegistrationResponseDto.ValidationResponse.ValidationResponses);}};b.ShowRegLightbox(a);b.DisableEmailFields();}return false;},StartUpdateProcessing:function(){var a=SpectrumRegistrationCore.Controller;if(a.IsUpdateButtonClicked){var b=SpectrumRegistrationCore.Logger;b.LogInformation("Update button has already been clicked before... Ignoring another click!");return false;}a.IsUpdateButtonClicked=true;document.body.style.cursor="wait";return true;},StopUpdateProcessing:function(){var a=SpectrumRegistrationCore.Controller;a.IsUpdateButtonClicked=false;document.body.style.cursor="default";},Register:function(){var b=SpectrumRegistrationCore.Logger;var a=SpectrumRegistrationCore.Controller;b.LogInformation("Calling register on SSOController for client side validations...");a.SSOController.register(false);},ProcessOptins:function(b){var a=SpectrumRegistrationCore.Logger;var d=SpectrumRegistrationService;a.LogInformation("Sending request to process optins");d.ProcessOptins(b);},SetSiteActivity:function(d){var a=SpectrumRegistrationCore.Logger;var b=SpectrumRegistrationService;a.LogInformation("Sending request to set site activity");b.SetSiteActivity(d);},HasPasswordOnAccount:function(a){return(a&&a.SpectrumCustomer&&a.SpectrumCustomer.UserInternal&&a.SpectrumCustomer.UserInternal.HasPasswordOnAccount);},GetMiniMyAccountLightboxName:function(){if(!SpectrumRegistrationCore.IsUserRecognized()){return null;}var b=SpectrumRegistrationCore.Utils;if(b.IsGoldUserMismatchScenario(window.SpectrumRegistrationResponseDto)){return"LB4";}var a;if(b.ShouldCallValidationService(window.SpectrumRegistrationResponseDto.SpectrumCustomer)){a="LB9";}else{a="LB4";}switch(window.tokenSourceType){case"Main Path":a=a+"a";break;case"Acquisition":a=a+"b";break;default:a=a+"c";break;}return a;},RefreshCookiesAndUIPostMMA:function(d){var b=SpectrumRegistrationCore;b.DeleteDomainCookie(window.strUserInfoCookie);var e=document.location.protocol+"//"+document.location.host+document.location.pathname;$.ajax({url:e,async:false});var f=SpectrumRegistrationCore.Utils;f.InitializeRegistrationResponseDto();var a=SpectrumRegistrationCore.Controller;if(d&&!$.isEmptyObject(d)){a.UpdateSpectrumCustomerForMiniRegUser(d);}if(!b.IsUserRecognized()){return;}a.RefreshOrderLimitsAndUI();Notifications.Notify("on-registration-response-dto-update",null);},RefreshOrderLimitsAndUI:function(){var b=SpectrumRegistrationCore.Utils;b.UpdateOrderLimits();var a=SpectrumRegistrationCore.Presenter;a.PersonalizeUI();a.ReloadOptins();},UpdateSpectrumCustomerForMiniRegUser:function(a){if(!a){return;}if(!window.SpectrumRegistrationResponseDto){return;}if(!window.SpectrumRegistrationResponseDto.SpectrumCustomer){window.SpectrumRegistrationResponseDto.SpectrumCustomer={};}if(!window.SpectrumRegistrationResponseDto.SpectrumCustomer.User){window.SpectrumRegistrationResponseDto.SpectrumCustomer.User={};}window.SpectrumRegistrationResponseDto.SpectrumCustomer.User=SpectrumRegistrationCore.Utils.CloneObject(a);},RedirectToMyAccountUrl:function(b,e){window.showAlert="false";var d=window.location.href;var a=SpectrumRegistrationCore.Presenter.Controls.Email.safeVal();if(e){location.href=window.spectrumMyAccountUrl+b+"?pu="+escape(d)+"&em="+a;return;}location.href=window.spectrumMyAccountUrl+b+"?em="+a;},ShowN1Message:function(e){var a=SpectrumRegistrationCore.Controller;var d=SpectrumRegistrationCore.Presenter;var f=SpectrumRegistrationCore.Utils;if(d.IsMobile){a.RedirectToMyAccountUrl(f.Constants.M_N1MESSAGE,true);}else{var b=window.SpectrumRegistrationCore.N1MessageController;b.ShowN1Message(e.SpectrumCustomer.User.Email);}},ShowPasswordFields:function(){var a=SpectrumRegistrationCore.Controller;var b=SpectrumRegistrationCore.Presenter;a.DisableEmailFields();b.ShowPasswordFields();},DisableEmailFields:function(){var a=SpectrumRegistrationCore.Presenter;a.DisableFormField("Email");a.DisableFormField("ConfirmEmail");},TakeoverFieldsBlurForCityState:function(){var a=SpectrumRegistrationCore.Controller;var b=SpectrumRegistrationCore.Presenter;if(!b.ShouldSuggestCityAndState()){a.ShowCityAndState();return false;}return SpectrumRegistrationCore.Presenter.TakeoverFieldsBlur(a.SuggestCityState);},SuggestCityState:function(a){if(a&&a.preventDefault){a.preventDefault();}var d=SpectrumRegistrationCore.Presenter;if(!d.AreZipCodeAndA1Populated()){return;}var f=d.PrepareRequestDto(SpectrumRegistrationCore.UserInfoCategories.RegFieldsOnly);var g=SpectrumRegistrationService;var b=SpectrumRegistrationCore.Logger;b.LogInformation("Sending request to get CityStateSuggestion");g.SuggestCityAndState(f);},OnSuggestCityAndState:function(b){var a=SpectrumRegistrationCore.Logger;a.LogInformation("CityStateSuggestion API call succeded");SpectrumRegistrationCore.Controller.ShowCityAndState(b);},OnSuggestCityAndStateFailure:function(a){var b=SpectrumRegistrationCore.Logger;b.LogError("CityStateSuggestion API call failed",a);SpectrumRegistrationCore.Controller.ShowCityAndState();},ShowCityAndState:function(d){var a=SpectrumRegistrationCore.Controller;var b=SpectrumRegistrationCore.Presenter;b.UnbindFieldsBlur();if(!b.IsInlineRegPresent){return;}if(d&&d.CityAndStateSuggestionResponse){a.SSOController.showCityState(d.CityAndStateSuggestionResponse);}else{a.SSOController.showCityState();}a.AreAddressFieldsExpanded=true;}};SpectrumRegistrationCore.SignInController={IsProcessing:false,SSOController:null,Initialize:function(){var b=SpectrumRegistrationCore.Logger;var d=SpectrumRegistrationCore.SignInPresenter;var a=SpectrumRegistrationCore.SignInController;var e=SpectrumRegistrationCore.Utils;b.LogInformation("Initializing signIn controller...");a.InitializeSpectrumRegistrationService();if(typeof window.SpectrumRegistrationResponseDto==="undefined"){e.InitializeRegistrationResponseDto();}a.SSOController=e.InitializeSsoController(d,a.OnProcessLogin,a.OnProcessLoginErrors,null,e.CreateRfProxy(a,d));if(!a.SSOController){return false;}d.AttachToSignInButton(a.OnSignInButtonClicked);d.AttachToSignOutLink(a.OnSignOutLinkClicked);d.AttachToForgotPasswordLink(a.OnForgotPasswordClicked);d.PopulateControls();if(d.IsMobile){window.SpectrumAnalyticsHelper.InitAnalyticsForMyAccount();}return true;},InitializeSpectrumRegistrationService:function(){var b=SpectrumRegistrationCore.Utils.InitializeSpectrumRegistrationService();if(!b){return;}var a=SpectrumRegistrationCore.SignInController;b.Handlers.OnProcessLogin=a.OnProcessLogin;b.Handlers.OnProcessLoginFailure=a.OnProcessLoginFailure;},OnForgotPasswordClicked:function(){var d=SpectrumRegistrationCore.SignInPresenter;var a=SpectrumRegistrationCore.SignInController;if(d.IsMobile){a.RedirectToForgotPassword();}else{a.SSOController.clearErrors();var b=SpectrumRegistrationCore.ForgotPasswordPresenter;b.PopulateEmail(d.Controls.Email.safeVal());b.ShowForgotPasswordLightbox();}return false;},OnSignOutLinkClicked:function(){SpectrumRegistrationCore.HandleNotYouLink();return false;},OnSignInButtonClicked:function(){var a=SpectrumRegistrationCore.SignInController;if(!a.StartSignInProcessing()){return;}$(".loader-icon").css("display","inline-block");var b=SpectrumRegistrationCore.Logger;b.LogInformation("Starting to process signIn request..");b.LogInformation("Calling SignIn on SSOController for client side validations...");a.SSOController.login(false);},StartSignInProcessing:function(){var a=SpectrumRegistrationCore.SignInController;if(a.IsProcessing){SpectrumRegistrationCore.Logger.LogWarning("A sign In request is already under progress... Aborting.");return false;}a.IsProcessing=true;document.body.style.cursor="wait";return true;},FinishSignInProcessing:function(a){if(a){return;}$(".loader-icon").css("display","none");SpectrumRegistrationCore.SignInController.IsProcessing=false;document.body.style.cursor="default";},OnProcessLogin:function(b){var a=SpectrumRegistrationCore.SignInController;a.FinishSignInProcessing(false);a.ClearErrors();window.SpectrumRegistrationResponseDto=b;a.IsLoginSuccessful(b)?a.PostLoginProcessHandler():a.ShowValidationErrors(b);},ShowValidationErrors:function(b){if(!b){return;}var a=SpectrumRegistrationCore.SignInController;a.SSOController.onLogin(b.FieldDatabaseValidationResponse);},OnProcessLoginFailure:function(a){var b=SpectrumRegistrationCore.Logger;b.LogInformation("SignIn API call failed!",a);var d=SpectrumRegistrationCore.Utils;d.RedirectToApiErrorPage();},OnProcessLoginErrors:function(d){$(".loader-icon").css("display","none");if(!d){return;}var b=SpectrumRegistrationCore.Logger;b.LogInformation("SignIn API call was sucessful but we got validation errors..");var a=SpectrumRegistrationCore.SignInController;a.FinishSignInProcessing(false);},IsLoginSuccessful:function(b){if(!b){return false;}if(b.FieldDatabaseValidationResponse==null){return false;}if(!b.FieldDatabaseValidationResponse.IsValid){return false;}var a=SpectrumRegistrationCore.Logger;a.LogInformation("isLoginSuccessful is true");return true;},PostLoginProcessHandler:function(){var b=SpectrumRegistrationCore.SignInPresenter;var a=SpectrumRegistrationCore.SignInController;if(b.IsMobile){a.PostLoginRedirect();}else{a.ManagePostLoginUI();}},ManagePostLoginUI:function(){Notifications.Notify("sign-in-successful",null,{"sign-in":"successful"});},ClearErrors:function(){var a=SpectrumRegistrationCore.SignInController;a.SSOController.clearErrors();var b=SpectrumRegistrationCore.Controller.SSOController;if(b){b.clearErrors();}},RedirectToForgotPassword:function(){var a=SpectrumRegistrationCore.SignInPresenter;var b=window.SpectrumUtils.GetUrlParams();b.em=a.Controls.Email.safeVal();if(!b.pu){b.pu=window.document.referrer;}SpectrumRegistrationCore.Utils.RedirectTo(window.spectrumMyAccountUrl+SpectrumRegistrationCore.Utils.Constants.M_FORGOTPWD,b);},PostLoginRedirect:function(){var a=window.SpectrumUtils.GetUrlParams();if(!a.pu){SpectrumRegistrationCore.Utils.RedirectTo(window.document.referrer);return;}if(window.document.referrer.indexOf(SpectrumRegistrationCore.Utils.Constants.M_FORGOTPWD)!=-1){SpectrumRegistrationCore.Utils.ReturnUserToPathUrl(a);}else{SpectrumRegistrationCore.Utils.RedirectTo(window.spectrumMyAccountUrl+SpectrumRegistrationCore.Utils.Constants.M_EDITINFO,a);}}};SpectrumRegistrationCore.SignInPresenter={IsMobile:window.spectrumSignInIsMobile?true:false,Initialize:function(){var a=SpectrumRegistrationCore.Logger;a.LogInformation("Initializing Sign In presenter...");var b=SpectrumRegistrationCore.SignInPresenter;b.InitializeControls();b.HandleEnterKey();},InitializeControls:function(){var a=SpectrumRegistrationCore.SignInPresenter;a.FieldsContainer=$("#FignInControlsContainerDiv");a.Controls={Email:$("#txtEmailAddress"),Password:$("#txtPassword")};},AttachToForgotPasswordLink:function(a){$("#hypForgotPassword").click(a);},AttachToSignOutLink:function(a){$("#hypSignOut").click(a);},AttachToSignInButton:function(a){$("#btnSignIn").click(a);},HandleEnterKey:function(){var a=SpectrumRegistrationCore.SignInPresenter;var d=SpectrumRegistrationCore.Utils;var b=$("#btnSignIn");d.WhenEnterKeyPressedClickControl(a.Controls,b);},GetElementsForSsoLib:function(){var a=SpectrumRegistrationCore.SignInPresenter;return{container:a.FieldsContainer,email:a.Controls.Email.length?a.Controls.Email:null,password:a.Controls.Password.length?a.Controls.Password:null};},PrepareRequestDto:function(e){var d=SpectrumRegistrationCore.Utils;var b=d.CreateRequestDto();var a=SpectrumRegistrationCore.SignInPresenter;a.FillRequestDtoUsingFrontEnd(b,e);return b;},FillRequestDtoUsingFrontEnd:function(b){var d=b.SpectrumCustomer;var a=SpectrumRegistrationCore.SignInPresenter;d.User={Email:a.Controls.Email.safeVal(),Password:a.Controls.Password.safeVal()};},PopulateControls:function(){var g=SpectrumRegistrationCore.SignInPresenter;var e=SpectrumRegistrationCore.IsUserRecognized();var b=SpectrumUtils.GetUrlParams().em;var d=(typeof b!=="string"||b.length<=0);if(d&&!e){return;}if(e&&d){b=window.SpectrumRegistrationResponseDto.SpectrumCustomer.User.Email;}var h=SpectrumRegistrationCore.Utils;var f=h.GetMiniRegTempCookie();var a=e||(f&&f.length);g.PopulateEmail(b,a);},PopulateEmail:function(a,b){var d=SpectrumRegistrationCore.SignInPresenter;d.Controls.Email.safeVal(a);if(b){d.Controls.Email.attr("readonly",true);}}};SpectrumRegistrationCore.ForgotPasswordController={IsProcessing:false,SSOController:null,Initialize:function(){var b=SpectrumRegistrationCore.Logger;var d=SpectrumRegistrationCore.ForgotPasswordPresenter;var a=SpectrumRegistrationCore.ForgotPasswordController;var e=SpectrumRegistrationCore.Utils;b.LogInformation("Initializing forgot password controller...");a.InitializeSpectrumRegistrationService();if(typeof window.SpectrumRegistrationResponseDto==="undefined"){e.InitializeRegistrationResponseDto();}a.SSOController=e.InitializeSsoController(d,a.OnForgotPassword,a.OnForgotPasswordErrors,null,e.CreateRfProxy(a,d));if(!a.SSOController){return false;}d.AttachToForgotPasswordButton(a.OnForgotPasswordButtonClicked);d.AttachToForgotPasswordContinueButton(a.OnContinueButtonClicked);d.PopulateControls();if(d.IsMobile){window.SpectrumAnalyticsHelper.InitAnalyticsForMyAccount();}return true;},InitializeSpectrumRegistrationService:function(){var b=SpectrumRegistrationCore.Utils.InitializeSpectrumRegistrationService();if(!b){return;}var a=SpectrumRegistrationCore.ForgotPasswordController;b.Handlers.OnForgotPassword=a.OnForgotPassword;b.Handlers.OnForgotPasswordFailure=a.OnForgotPasswordFailure;},OnForgotPasswordButtonClicked:function(){var a=SpectrumRegistrationCore.ForgotPasswordController;if(!a.StartForgotPasswordProcessing()){return false;}var b=SpectrumRegistrationCore.Logger;b.LogInformation("Starting to process forgot password request..");b.LogInformation("Calling forgotPassword on SSOController for client side validations...");a.SSOController.forgotPassword(false);return false;},StartForgotPasswordProcessing:function(){var a=SpectrumRegistrationCore.ForgotPasswordController;if(a.IsProcessing){SpectrumRegistrationCore.Logger.LogWarning("A forgot password request is already in progress... Aborting.");return false;}a.IsProcessing=true;document.body.style.cursor="wait";return true;},FinishForgotPasswordProcessing:function(a){if(a){return;}SpectrumRegistrationCore.ForgotPasswordController.IsProcessing=false;document.body.style.cursor="default";},OnForgotPassword:function(b){var f=SpectrumRegistrationCore.Logger;f.LogInformation("Forgot password API call sucessful..");var a=SpectrumRegistrationCore.ForgotPasswordController;var e=b.FieldDatabaseValidationResponse;var d=e&&!b.FieldDatabaseValidationResponse.IsValid;if(d){a.OnForgotPasswordErrors(b.FieldDatabaseValidationResponse);}else{a.OnValidationSuccessful();}},OnForgotPasswordFailure:function(a){var b=SpectrumRegistrationCore.Logger;b.LogError("Forgot password API call failed!",a);var d=SpectrumRegistrationCore.Utils;d.RedirectToApiErrorPage();},OnForgotPasswordErrors:function(b){var a=SpectrumRegistrationCore.ForgotPasswordController;if(!b||b=="blank"){a.FinishForgotPasswordProcessing(false);return;}var d=SpectrumRegistrationCore.Logger;d.LogInformation("Handling validation errors..");a.SSOController.onForgotPassword(b);a.FinishForgotPasswordProcessing(false);},OnValidationSuccessful:function(){var b=SpectrumRegistrationCore.ForgotPasswordPresenter;b.ShowSuccessMessage();if(b.IsMobile){window.setTimeout(function(){b.ClickOnContinueButton();},5000);}var a=SpectrumRegistrationCore.ForgotPasswordController;a.FinishForgotPasswordProcessing(false);},ClearErrors:function(){SpectrumRegistrationCore.ForgotPasswordController.SSOController.clearErrors();},OnContinueButtonClicked:function(){var a=window.SpectrumUtils.GetUrlParams();if(!a.pu){a.pu=document.referrer;}SpectrumRegistrationCore.Utils.RedirectTo(window.spectrumMyAccountUrl+SpectrumRegistrationCore.Utils.Constants.M_SIGNIN,a);return false;}};SpectrumRegistrationCore.ForgotPasswordPresenter={IsMobile:window.spectrumForgotPasswordIsMobile?true:false,Initialize:function(){var a=SpectrumRegistrationCore.Logger;a.LogInformation("Initializing forgot password presenter...");var b=SpectrumRegistrationCore.ForgotPasswordPresenter;b.InitializeControls();b.HandleEnterKey();},InitializeControls:function(){var a=SpectrumRegistrationCore.ForgotPasswordPresenter;a.FieldsContainer=$("#FieldsContainerDiv");a.Controls={Email:$("#EmailAddressTextBox")};},PopulateControls:function(){var e=SpectrumRegistrationCore.ForgotPasswordPresenter;var d=SpectrumRegistrationCore.IsUserRecognized();var a=SpectrumUtils.GetUrlParams().em;var b=(typeof a!=="string"||a.length<=0);if(b&&!d){return;}if(d&&b){a=window.SpectrumRegistrationResponseDto.SpectrumCustomer.User.Email;}e.PopulateEmail(a,d);},HandleEnterKey:function(){var b=SpectrumRegistrationCore.ForgotPasswordPresenter;var d=SpectrumRegistrationCore.Utils;var a=$("#ForgotPasswordButton");d.WhenEnterKeyPressedClickControl(b.Controls,a);},AttachToForgotPasswordButton:function(a){$("#ForgotPasswordButton").live("click",a);},AttachToForgotPasswordContinueButton:function(a){$("#forgotPasswordContinueButton").click(a);},GetElementsForSsoLib:function(){var a=SpectrumRegistrationCore.ForgotPasswordPresenter;return{container:a.FieldsContainer,email:a.Controls.Email.length?a.Controls.Email:null};},PrepareRequestDto:function(e){var d=SpectrumRegistrationCore.Utils;var b=d.CreateRequestDto();var a=SpectrumRegistrationCore.ForgotPasswordPresenter;a.FillRequestDtoUsingFrontEnd(b,e);return b;},FillRequestDtoUsingFrontEnd:function(b){var d=b.SpectrumCustomer;var a=SpectrumRegistrationCore.ForgotPasswordPresenter;d.User={Email:a.Controls.Email.safeVal()};},ShowSuccessMessage:function(){$("#spectrumForgotPasswordLightboxContainer").height($("[id$=forgotPasswordSuccessDiv]").height());$("[id$=enterEmailDiv]").hide("fast",function(){$("[id$=forgotPasswordSuccessDiv]").show();});},ShowForgotPasswordLightbox:function(){var d=$("#spectrumForgotPasswordLightboxContainer");var e=$("#spectrumForgotPasswordDiv");if(!e||e.length<=0){SpectrumRegistrationCore.Logger.LogError("Could not locate forgot password content on the page");return;}d.append(e);var b={content:d,overlay:$("#spectrumForgotPasswordLightboxOverlay"),displaySettings:{top:20,closeOnOverlayClick:false}};e.show("fast",function(){SpectrumLightbox.ShowLightbox(b);});var a=e.find("input.close-x");a.unbind();a.click(function(){SpectrumRegistrationCore.ForgotPasswordPresenter.ResetUI();SpectrumLightbox.HideLightbox(b);return false;});},ResetUI:function(){SpectrumRegistrationCore.ForgotPasswordController.ClearErrors();$("[id$=forgotPasswordSuccessDiv]").hide("fast",function(){$("[id$=enterEmailDiv]").show();SpectrumRegistrationCore.ForgotPasswordPresenter.Controls.Email.safeVal("");});},ClickOnContinueButton:function(){$("#forgotPasswordContinueButton").click();},PopulateEmail:function(a,b){var d=SpectrumRegistrationCore.ForgotPasswordPresenter;d.Controls.Email.safeVal(a);if(b){d.Controls.Email.attr("readonly",true);}}};var Porthole=(typeof Porthole=="undefined")||!Porthole?{}:Porthole;Porthole={trace:function(b){try{console.log("Porthole: "+b);}catch(a){}},error:function(b){try{console.error("Porthole: "+b);}catch(a){}}};Porthole.WindowProxy=function(){};Porthole.WindowProxy.prototype={postMessage:function(){},addEventListener:function(a){},removeEventListener:function(a){}};Porthole.WindowProxyLegacy=function(a,b){if(b===undefined){b="";}this.targetWindowName=b;this.eventListeners=[];this.origin=window.location.protocol+"//"+window.location.host;if(a!==null){this.proxyIFrameName=this.targetWindowName+"ProxyIFrame";this.proxyIFrameLocation=a;this.proxyIFrameElement=this.createIFrameProxy();}else{this.proxyIFrameElement=null;}};Porthole.WindowProxyLegacy.prototype={getTargetWindowName:function(){return this.targetWindowName;},getOrigin:function(){return this.origin;},createIFrameProxy:function(){var a=document.createElement("iframe");a.setAttribute("id",this.proxyIFrameName);a.setAttribute("name",this.proxyIFrameName);a.setAttribute("src",this.proxyIFrameLocation);a.setAttribute("frameBorder","1");a.setAttribute("scrolling","auto");a.setAttribute("width",30);a.setAttribute("height",30);a.setAttribute("style","position: absolute; left: -100px; top:0px;");if(a.style.setAttribute){a.style.setAttribute("cssText","position: absolute; left: -100px; top:0px;");}document.body.appendChild(a);return a;},postMessage:function(a,b){if(b===undefined){b="*";}if(this.proxyIFrameElement===null){Porthole.error("Can't send message because no proxy url was passed in the constructor");}else{sourceWindowName=window.name;this.proxyIFrameElement.setAttribute("src",this.proxyIFrameLocation+"#"+a+"&sourceOrigin="+escape(this.getOrigin())+"&targetOrigin="+escape(b)+"&sourceWindowName="+sourceWindowName+"&targetWindowName="+this.targetWindowName);this.proxyIFrameElement.height=this.proxyIFrameElement.height>50?50:100;}},addEventListener:function(a){this.eventListeners.push(a);return a;},removeEventListener:function(b){try{var d=this.eventListeners.indexOf(b);this.eventListeners.splice(d,1);}catch(a){this.eventListeners=[];Porthole.error(a);}},dispatchEvent:function(a){for(var d=0;d<this.eventListeners.length;d++){try{this.eventListeners[d](a);}catch(b){Porthole.error("Exception trying to call back listener: "+b);}}}};Porthole.WindowProxyHTML5=function(a,b){if(b===undefined){b="";}this.targetWindowName=b;};Porthole.WindowProxyHTML5.prototype={postMessage:function(a,b){if(b===undefined){b="*";}if(this.targetWindowName===""){targetWindow=top;}else{targetWindow=parent.frames[this.targetWindowName];}targetWindow.postMessage(a,b);},addEventListener:function(a){window.addEventListener("message",a,false);return a;},removeEventListener:function(a){window.removeEventListener("message",a,false);},dispatchEvent:function(a){var b=document.createEvent("MessageEvent");b.initMessageEvent("message",true,true,a.data,a.origin,1,window,null);window.dispatchEvent(b);}};if(typeof window.postMessage!="function"){Porthole.trace("Using legacy browser support");Porthole.WindowProxy=Porthole.WindowProxyLegacy;Porthole.WindowProxy.prototype=Porthole.WindowProxyLegacy.prototype;}else{Porthole.trace("Using built-in browser support");Porthole.WindowProxy=Porthole.WindowProxyHTML5;Porthole.WindowProxy.prototype=Porthole.WindowProxyHTML5.prototype;}Porthole.WindowProxy.splitMessageParameters=function(d){if(typeof d=="undefined"||d===null){return null;}var a=[];var f=d.split(/&/);for(var b in f){var e=f[b].split("=");if(typeof(e[1])=="undefined"){a[e[0]]="";}else{a[e[0]]=e[1];}}return a;};Porthole.MessageEvent=function MessageEvent(a,b,d){this.data=a;this.origin=b;this.source=d;};Porthole.WindowProxyDispatcher={forwardMessageEvent:function(a){var b=document.location.hash;if(b.length>0){b=b.substr(1);m=Porthole.WindowProxyDispatcher.parseMessage(b);if(m.targetWindowName===""){targetWindow=top;}else{targetWindow=parent.frames[m.targetWindowName];}var d=Porthole.WindowProxyDispatcher.findWindowProxyObjectInWindow(targetWindow,m.sourceWindowName);if(d){if(d.origin==m.targetOrigin||m.targetOrigin=="*"){a=new Porthole.MessageEvent(m.data,m.sourceOrigin,d);d.dispatchEvent(a);}else{Porthole.error("Target origin "+d.origin+" does not match desired target of "+m.targetOrigin);}}else{Porthole.error("Could not find window proxy object on the target window");}}},parseMessage:function(e){if(typeof e=="undefined"||e===null){return null;}params=Porthole.WindowProxy.splitMessageParameters(e);var b={targetOrigin:"",sourceOrigin:"",sourceWindowName:"",data:""};b.targetOrigin=unescape(params.targetOrigin);b.sourceOrigin=unescape(params.sourceOrigin);b.sourceWindowName=unescape(params.sourceWindowName);b.targetWindowName=unescape(params.targetWindowName);var a=e.split(/&/);if(a.length>3){a.pop();a.pop();a.pop();a.pop();b.data=a.join("&");}return b;},findWindowProxyObjectInWindow:function(f,d){if(f.RuntimeObject){f=f.RuntimeObject();}if(f){for(var b in f){try{if(f[b]!==null&&typeof f[b]=="object"&&f[b] instanceof f.Porthole.WindowProxy&&f[b].getTargetWindowName()==d){return f[b];}}catch(a){}}}return null;},start:function(){if(window.addEventListener){window.addEventListener("resize",Porthole.WindowProxyDispatcher.forwardMessageEvent,false);}else{if(document.body.attachEvent){window.attachEvent("onresize",Porthole.WindowProxyDispatcher.forwardMessageEvent);}else{Porthole.error("Can't attach resize event");}}}};(function(a,s){if(a.fn.dotdotdot){return;}a.fn.dotdotdot=function(w){if(a.browser&&a.browser.msie&&parseInt(a.browser.version)<9){a.noData["#text"]=true;}if(this.length==0){a.fn.dotdotdot.debug('No element found for "'+this.selector+'".');return this;}if(this.length>1){return this.each(function(){a(this).dotdotdot(w);});}var t=this;if(t.data("dotdotdot")){t.trigger("destroy.dot");}t.data("dotdotdot-style",t.attr("style")||"");t.css("word-wrap","break-word");if(t.css("white-space")==="nowrap"){t.css("white-space","normal");}t.bind_events=function(){t.bind("update.dot",function(D,C){D.preventDefault();D.stopPropagation();x.maxHeight=(typeof x.height=="number")?x.height:p(t);x.maxHeight+=x.tolerance;if(typeof C!="undefined"){if(typeof C=="string"||C instanceof HTMLElement){C=a("<div />").append(C).contents();}if(C instanceof a){y=C;}}u=t.wrapInner('<div class="dotdotdot" />').children();u.contents().detach().end().append(y.clone(true)).find("br").replaceWith(" <br /> ").end().css({height:"auto",width:"auto",border:"none",padding:0,margin:0});var B=false,E=false;if(v.afterElement){B=v.afterElement.clone(true);B.show();v.afterElement.detach();}if(r(u,x)){if(x.wrap=="children"){E=f(u,x,B);}else{E=h(u,t,u,x,B);}}u.replaceWith(u.contents());u=null;if(a.isFunction(x.callback)){x.callback.call(t[0],E,y);}v.isTruncated=E;return E;}).bind("isTruncated.dot",function(B,C){B.preventDefault();B.stopPropagation();if(typeof C=="function"){C.call(t[0],v.isTruncated);}return v.isTruncated;}).bind("originalContent.dot",function(B,C){B.preventDefault();B.stopPropagation();if(typeof C=="function"){C.call(t[0],y);}return y;}).bind("destroy.dot",function(B){B.preventDefault();B.stopPropagation();t.unwatch().unbind_events().contents().detach().end().append(y).attr("style",t.data("dotdotdot-style")||"").data("dotdotdot",false);});return t;};t.unbind_events=function(){t.unbind(".dot");return t;};t.watch=function(){t.unwatch();if(x.watch=="window"){var B=a(window),D=B.width(),C=B.height();B.bind("resize.dot"+v.dotId,function(){if(D!=B.width()||C!=B.height()||!x.windowResizeFix){D=B.width();C=B.height();if(z){clearInterval(z);}z=setTimeout(function(){t.trigger("update.dot");},10);}});}else{A=n(t);z=setInterval(function(){var E=n(t);if(A.width!=E.width||A.height!=E.height){t.trigger("update.dot");A=n(t);}},100);}return t;};t.unwatch=function(){a(window).unbind("resize.dot"+v.dotId);if(z){clearInterval(z);}return t;};var y=t.contents(),x=a.extend(true,{},a.fn.dotdotdot.defaults,w),v={},A={},z=null,u=null;if(!(x.lastCharacter.remove instanceof Array)){x.lastCharacter.remove=a.fn.dotdotdot.defaultArrays.lastCharacter.remove;}if(!(x.lastCharacter.noEllipsis instanceof Array)){x.lastCharacter.noEllipsis=a.fn.dotdotdot.defaultArrays.lastCharacter.noEllipsis;}v.afterElement=k(x.after,t);v.isTruncated=false;v.dotId=g++;t.data("dotdotdot",true).bind_events().trigger("update.dot");if(x.watch){t.watch();}return t;};a.fn.dotdotdot.defaults={ellipsis:"... ",wrap:"word",fallbackToLetter:true,lastCharacter:{},tolerance:0,callback:null,after:null,height:null,watch:false,windowResizeFix:true};a.fn.dotdotdot.defaultArrays={lastCharacter:{remove:[" ","\u3000",",",";",".","!","?"],noEllipsis:[]}};a.fn.dotdotdot.debug=function(t){};var g=1;function f(u,A,x){var v=u.children(),y=false;u.empty();for(var w=0,z=v.length;w<z;w++){var t=v.eq(w);u.append(t);if(x){u.append(x);}if(r(u,A)){t.remove();y=true;break;}else{if(x){x.detach();}}}return y;}function h(u,t,v,A,w){var x=false;var y="table, thead, tbody, tfoot, tr, col, colgroup, object, embed, param, dl, blockquote, select, optgroup, option, textarea, script, style";var z="script";u.contents().detach().each(function(){var C=this,B=a(C);if(typeof C=="undefined"||(C.nodeType==3&&a.trim(C.data).length==0)){return true;}else{if(B.is(z)){u.append(B);}else{if(x){return true;}else{u.append(B);if(w){u[u.is(y)?"after":"append"](w);}if(r(v,A)){if(C.nodeType==3){x=i(B,t,v,A,w);}else{x=h(B,t,v,A,w);}if(!x){B.detach();x=true;}}if(!x){if(w){w.detach();}}}}}});return x;}function i(u,t,v,D,x){var z=u[0];if(!z){return false;}var J=o(z),G=(J.indexOf(" ")!==-1)?" ":"\u3000",F=(D.wrap=="letter")?"":G,I=J.split(F),E=-1,C=-1,H=0,A=I.length-1;if(D.fallbackToLetter&&H==0&&A==0){F="";I=J.split(F);A=I.length-1;}while(H<=A&&!(H==0&&A==0)){var B=Math.floor((H+A)/2);if(B==C){break;}C=B;q(z,I.slice(0,C+1).join(F)+D.ellipsis);if(!r(v,D)){E=C;H=C;}else{A=C;if(D.fallbackToLetter&&H==0&&A==0){F="";I=I[0].split(F);E=-1;C=-1;H=0;A=I.length-1;}}}if(E!=-1&&!(I.length==1&&I[0].length==0)){J=e(I.slice(0,E+1).join(F),D);q(z,J);}else{var w=u.parent();u.detach();var y=(x&&x.closest(w).length)?x.length:0;if(w.contents().length>y){z=j(w.contents().eq(-1-y),t);}else{z=j(w,t,true);if(!y){w.detach();}}if(z){J=e(o(z),D);q(z,J);if(y&&x){a(z).parent().append(x);}}}return true;}function r(t,u){return t.innerHeight()>u.maxHeight;}function e(u,t){while(a.inArray(u.slice(-1),t.lastCharacter.remove)>-1){u=u.slice(0,-1);}if(a.inArray(u.slice(-1),t.lastCharacter.noEllipsis)<0){u+=t.ellipsis;}return u;}function n(t){return{width:t.innerWidth(),height:t.innerHeight()};}function q(u,t){if(u.innerText){u.innerText=t;}else{if(u.nodeValue){u.nodeValue=t;}else{if(u.textContent){u.textContent=t;}}}}function o(t){if(t.innerText){return t.innerText;}else{if(t.nodeValue){return t.nodeValue;}else{if(t.textContent){return t.textContent;}else{return"";}}}}function l(t){do{t=t.previousSibling;}while(t&&t.nodeType!==1&&t.nodeType!==3);return t;}function j(t,u,w){var v=t&&t[0],x;if(v){if(!w){if(v.nodeType===3){return v;}if(a.trim(t.text())){return j(t.contents().last(),u);}}x=l(v);while(!x){t=t.parent();if(t.is(u)||!t.length){return false;}x=l(t[0]);}if(x){return j(a(x),u);}}return false;}function k(u,t){if(!u){return false;}if(typeof u==="string"){u=a(u,t);return(u.length)?u:false;}return !u.jquery?false:u;}function p(t){var v=t.innerHeight(),u=["paddingTop","paddingBottom"];for(var y=0,w=u.length;y<w;y++){var x=parseInt(t.css(u[y]),10);if(isNaN(x)){x=0;}v-=x;}return v;}var b=a.fn.html;a.fn.html=function(t){if(t!=s&&!a.isFunction(t)&&this.data("dotdotdot")){return this.trigger("update",[t]);}return b.apply(this,arguments);};var d=a.fn.text;a.fn.text=function(t){if(t!=s&&!a.isFunction(t)&&this.data("dotdotdot")){t=a("<div />").text(t).html();return this.trigger("update",[t]);}return d.apply(this,arguments);};})(jQuery);"use strict";(function(d,a){function b(g){var e=a.getElementsByTagName("body")[0],f=a.createElement("script");f.src=g;e.appendChild(f);}if(typeof Object.create!=="function"){Object.create=function(f){function e(){}e.prototype=f;return new e();};}if(typeof d.PCH==="undefined"){d.PCH={};}if(typeof d.PCH.SSO==="undefined"){d.PCH.SSO={};}})(window,document);PCH.SSO.utils={isJQueryObjectAndNotEmpty:function isJQueryObjectAndNotEmpty(a){return a&&a.selector&&a.length;},isEmptyObject:function isEmptyObject(a){var b;for(b in a){if(a.hasOwnProperty(b)){return false;}}return true;}};PCH.SSO.Controller={_cfg:null,_elements:{},_optins:[],_addressCounter:0,_environment:"",_errorCollection:[],_externalProxy:null,_internalProxy:{register:function register(a){throw new Error("_internalProxy: You must pass in a valid register function.");},update:function update(a){throw new Error("_internalProxy: You must pass in a valid update function.");},login:function login(a){throw new Error("_internalProxy: You must pass in a valid login function.");},updatePassword:function updatePassword(a){throw new Error("_internalProxy: You must pass in a valid updatePassword function.");},createPassword:function createPassword(a){throw new Error("_internalProxy: You must pass in a valid createPassword function.");},forgotPassword:function forgotPassword(a){throw new Error("_internalProxy: You must pass in a valid forgotPassword function.");},resetPassword:function resetPassword(a){throw new Error("_internalProxy: You must pass in a valid resetPassword function.");},miniRegister:function miniRegister(a){throw new Error("_internalProxy: You must pass in a valid miniRegister function.");},FBwithEmail:function FBwithEmail(a){throw new Error("_internalProxy: You must pass in a valid FBwithEmail function.");},registerWithMandatoryDOB:function registerWithMandatoryDOB(a){throw new Error("_internalProxy: You must pass in a valid registerWithMandatoryDOB function.");},updateWithMandatoryDOB:function updateWithMandatoryDOB(a){throw new Error("_internalProxy: You must pass in a valid updateWithMandatoryDOB function.");},addScreenNameAndDOB:function addScreenNameAndDOB(a){throw new Error("_internalProxy: You must pass in a valid addScreenNameAndDOB function.");},skipEmailVal:function skipEmailVal(b,a){throw new Error("_internalProxy: You must pass in a valid skipEmailVal function.");},redirect:function redirect(a){if(typeof a==="string"){this._sendToURL(a);}},performAnalytics:function performAnalytics(a){if(typeof a.success==="function"){a.success();}}},_uiSelection:"default",_uiCollection:{},_loadingGraphic:null,_failureCallback:function(a){},_successCallback:function(a){},_skipCallback:function(a){},init:function init(a){this._cfg=a;this._setElements(a.elements);this._setOptins(a.optins);this._setProxy(a.proxy);this._setUI(a.ui);this._setEnvironment(a.env);this._setLoadingGraphic(a.loadingGraphic);this._setSuccessCallback(a.success);this._setFailureCallback(a.failure);this._setSkipCallback(a.skip);},register:function register(a){this._sharedMethod(a,"register");},update:function update(a){this._sharedMethod(a,"update");},login:function login(a){this._sharedMethod(a,"login");},updatePassword:function updatePassword(a){this._sharedMethod(a,"updatePassword");},createPassword:function createPassword(a){this._sharedMethod(a,"createPassword");},forgotPassword:function forgotPassword(a){this._sharedMethod(a,"forgotPassword");},resetPassword:function resetPassword(a){this._sharedMethod(a,"resetPassword");},miniRegister:function miniRegister(a){this._sharedMethod(a,"miniRegister");},FBwithEmail:function FBwithEmail(a){this._sharedMethod(a,"FBwithEmail");},registerWithMandatoryDOB:function registerWithMandatoryDOB(a){this._sharedMethod(a,"registerWithMandatoryDOB");},updateWithMandatoryDOB:function updateWithMandatoryDOB(a){this._sharedMethod(a,"updateWithMandatoryDOB");},addScreenNameAndDOB:function addScreenNameAndDOB(a){this._sharedMethod(a,"addScreenNameAndDOB");},onRegister:function onRegister(a){this._sharedOnMethod(a);},onUpdate:function onUpdate(a){this._sharedOnMethod(a);},onLogin:function onLogin(a){this._sharedOnMethod(a);},onCreatePassword:function onCreatePassword(a){this._sharedOnMethod(a);},onUpdatePassword:function onUpdatePassword(a){this._sharedOnMethod(a);},onForgotPassword:function onForgotPassword(a){this._sharedOnMethod(a);},onResetPassword:function onResetPassword(a){this._sharedOnMethod(a);},onMiniRegister:function onMiniRegister(a){this._sharedOnMethod(a);},onFBwithEmail:function onFBwithEmail(a){this._sharedOnMethod(a);},onRegisterWithMandatoryDOB:function onRegisterWithMandatoryDOB(a){this._sharedOnMethod(a);},onUpdateWithMandatoryDOB:function onUpdateWithMandatoryDOB(a){this._sharedOnMethod(a);},onAddScreenNameAndDOB:function onAddScreenNameAndDOB(a){this._sharedOnMethod(a);},_setElements:function _setElements(a){var f={},b=PCH.SSO.utils.isJQueryObjectAndNotEmpty;if(a&&typeof a==="object"){for(var d in a){if(b(a[d])){f[d]=a[d];}}this._elements=f;}else{throw new Error("_setElements(): Pass in a valid object of elements.");}},_getElements:function _getElements(){return this._elements;},_setOptins:function _setOptins(a){if(a instanceof Array){this._optins=a;}},_getOptins:function _getOptins(){return this._optins;},_resetAddressCounter:function _resetAddressCounter(){this._addressCounter=0;},_addToAddressCounter:function _addToAddressCounter(){this._addressCounter+=1;},_getAddressCounter:function _getAddressCounter(){return this._addressCounter;},_setProxy:function _setProxy(a){if(a&&typeof a==="object"){this._externalProxy=a;}},_getProxy:function _getProxy(a){return(this._externalProxy&&typeof this._externalProxy[a]==="function")?this._externalProxy[a]:this._internalProxy[a];},_setUI:function _setUI(a){if(a.length&&typeof a==="string"){this._uiSelection=a;}},_getUI:function _getUI(){return this._uiSelection;},_setEnvironment:function _setEnvironment(a){if(a&&(a.length&&typeof a==="string")){this._environment=a.toLowerCase();}else{throw new Error("_setEnvironment(): Pass in an Environment string.");}},_getEnvironment:function _getEnvironment(){var a;if(this._environment){if(this._environment==="prod"){a="http://www.pch.com";}else{a="http://www."+this._environment+".pch.com";}return a;}else{throw new Error("_getEnvironment(): Pass in an environment.");}},_setLoadingGraphic:function _setLoadingGraphic(a){if(a){if(PCH.SSO.utils.isJQueryObjectAndNotEmpty(a)){this._loadingGraphic=a;}}},_getloadingGraphic:function _getloadingGraphic(){return this._loadingGraphic;},_addErrorToCollection:function _addErrorToCollection(a){this._errorCollection.push(a);},_clearErrorCollection:function _clearErrorCollection(){this._errorCollection=[];},_getErrorFromCollection:function _getErrorFromCollection(a){return this._errorCollection[a];},_getErrorCollection:function _getErrorCollection(){return this._errorCollection;},_setFailureCallback:function _setFailureCallback(a){if(typeof a==="function"){this._failureCallback=a;}},_getFailureCallback:function _getFailureCallback(){return this._failureCallback;},_setSuccessCallback:function _setSuccessCallback(a){if(typeof a==="function"){this._successCallback=a;}else{throw new Error("_setSuccessCallback(): Pass in a valid success callback function.");}},_getSuccessCallback:function _getSuccessCallback(){return this._successCallback;},_setSkipCallback:function _setSkipCallback(a){if(typeof a==="function"){this._skipCallback=a;}},_getSkipCallback:function _getSkipCallback(){return this._skipCallback;},_addUiModule:function _addUiModule(a){this._uiCollection[a.name]=a.module;},_getUiModule:function _getUiModule(a){return this._uiCollection[a];},_sharedMethod:function _sharedMethod(e,d){this.clearErrors();var a=this._checkForEmpty(this._getElements()),f=this._getProxy(d);if(PCH.SSO.utils.isEmptyObject(a)){if(e){f.call(this);}else{var b=PCH.SSO.interpreter.createJSON(this._getElements(),this._getOptins(),d);f.call(this,b);}}else{this._getFailureCallback()("blank");this._handleProcessedResponse({type:"blank",errorFields:a});}},_handleProcessedResponse:function _handleProcessedResponse(e){var d,a,h=this,b=this._getElements(),k=this._getUI(),g=PCH.SSO,i=(k.toLowerCase()==="mobile")?g.SpecialAlertMobile:g.SpecialAlertDesktop;function f(l){this._getProxy("performAnalytics")({reason:"failure",errorCode:l,success:function(){h._getProxy("redirect").call(h);}});}function j(){var l=[];for(var n in e.errorFields){l.push(n);}e=new i(b,"Please enter a valid email","<p>Our records show this email address may be undeliverable. You may be missing out on additional winning opportunities.</p><span class='sml'>If the email supplied is correct, please contact customer service at 1-800-476-4724.</span>",["email","confirmEmail"],{text:"Skip now, remind me later",callback:this._getSkipCallback()});this._addErrorToCollection(e);}if((e.type==="failure"||e.type==="softFailure")&&e.errorMessages.length===1){a=e.errorMessages[0].code;switch(a){case 60310:f.call(this,"bademail/"+a);break;case 60352:f.call(this,"bademail/"+a);break;case 61310:f.call(this,"bademail/"+a);break;case 61352:f.call(this,"bademail/"+a);break;case 61350:f.call(this,"badpassword/"+a);break;}}if(this._getAddressCounter()===3){e=new i(b,"This address is not valid","<p>Please make sure you are using a deliverable mailing address, which may include a P.O. Box.</p><span class='sml'>If you need further assistance, please call customer service at 1-800-476-4724.</span>",["address1","city","state","zipcode"]);this._addErrorToCollection(e);this._resetAddressCounter();}if(e.type){d=Object.create(this._getUiModule(this._getUI()));d.init(e,this._getElements().container,this);this._addErrorToCollection(d);}},_sharedOnMethod:function _sharedOnMethod(d){var e=PCH.SSO.interpreter.processJSON(d,this._getElements());var b=e.type;var a=e.emailVal?e.emailVal.type:"success";if((b==="success"||b==="autoCorrect")&&a==="success"){this._handleProcessedResponse(e);this._getSuccessCallback()();return;}if(b==="addressFailure"||b==="suggestion"){this._addToAddressCounter();}if(b==="failure"||b==="addressFailure"||b==="suggestion"||b==="softFailure"||a==="failure"||a==="emailFailure"||a==="suggestion"||a==="softFailure"){this._getFailureCallback()();this._handleProcessedResponse(e);return;}if(b==="underAge"){this._onUnderAge();return;}if(b==="obscene"||a==="obscene"){this._onObscene();return;}if(b==="suppress"||a==="suppress"){this._onSuppress();return;}if(b==="bot"||a==="bot"){this._onBot();return;}if(b==="spamTrap"||a==="spamTrap"){this._onSpamTrap();return;}if(b==="techFailure"||a==="techFailure"){this._onTechFailure(e);return;}this._getSuccessCallback()();},_checkForEmpty:function _checkForEmpty(d){var b=false,a={};$.extend(a,d);for(var e in a){if(e==="container"){delete a[e];continue;}if(e!=="month"&&e!=="day"&&e!=="year"){if(a[e].hasClass("required")){if(a[e][0].nodeName.toLowerCase()==="input"){if($.trim(a[e].val())!==""){delete a[e];}}else{if(a[e][0].nodeName.toLowerCase()==="select"){if(a[e][0].selectedIndex!==0){delete a[e];}}}}else{delete a[e];}}else{if(a[e].hasClass("required")){b=true;}}}if(b){if(a.month&&a.day&&a.year){if(a.month[0].selectedIndex!==0){delete a.month;}if(a.day[0].selectedIndex!==0){delete a.day;}if(a.year[0].selectedIndex!==0){delete a.year;}}else{throw new Error("_checkForEmpty(): You have not supplied all the DOB fields.");}}else{if(a.month&&a.day&&a.year){if((a.month[0].selectedIndex===0)&&(a.day[0].selectedIndex===0)&&(a.year[0].selectedIndex===0)){delete a.month;delete a.day;delete a.year;}else{if(a.month[0].selectedIndex!==0){delete a.month;}if(a.day[0].selectedIndex!==0){delete a.day;}if(a.year[0].selectedIndex!==0){delete a.year;}}}}return a;},_doJSONP:function _doJSONP(f,b,a){var d={obj:b},e=this;$.ajax({type:"GET",url:f,contentType:"application/json; charset=utf-8",data:JSON.stringify(d),dataType:"jsonp",jsonp:false,jsonpCallback:"cor",success:function(h,i,g){a.call(e,h);},error:function(h,i,g){},complete:function(){}});},_doXHR:function _doXHR(e,b,a){var d=this;$.ajax({type:"POST",url:e,contentType:"application/json; charset=utf-8",data:JSON.stringify(b),dataType:"json",success:function(g,h,f){a.call(d,g);},error:function(g,h,f){},complete:function(){}});},showLoaderGraphic:function showLoaderGraphic(a){if(this._getloadingGraphic()){if(a){this._getloadingGraphic().addClass("show");}else{this._getloadingGraphic().removeClass("show");}}},clearErrors:function clearErrors(){var b=this._getErrorCollection().length;if(b>0){for(var a=b-1;a>=0;a-=1){this._getErrorFromCollection([a]).clear();}}this._clearErrorCollection();},_sendToURL:function _sendToURL(a){top.location.href=a;},_onUnderAge:function _onUnderAge(){var b=this,a=this._getEnvironment()+"/errorpages/we_are_sorry.html";this._getProxy("logout")(function(){b._getProxy("performAnalytics").call(b,{reason:"underage",errorCode:null,success:function(){b._getProxy("redirect").call(b,a);}});});},_onObscene:function _onObscene(){var b=this,a=this._getEnvironment()+"/errorpages/invalid_reg.html";this._getProxy("logout")(function(){b._getProxy("performAnalytics").call(b,{reason:"obscene",errorCode:null,success:function(){b._getProxy("redirect").call(b,a);}});});},_onTechFailure:function _onTechFailure(a){var d=this,b;if(a.code){b="/errorpages/noreg.html?trn="+a.code;if(a.message){b+="&trm="+a.message;}}else{b="/errorpages/noreg.html";}this._getProxy("performAnalytics").call(this,{reason:"techfailure",errorCode:null,success:function(){d._getProxy("redirect").call(d,b);}});},_onSuppress:function _onSuppress(){var b=this,a=this._getEnvironment()+"/errorpages/invalid_reg.html";this._getProxy("logout")(function(){b._getProxy("performAnalytics").call(b,{reason:"suppress",errorCode:null,success:function(){b._getProxy("redirect").call(b,a);}});});},_onBot:function _onBot(){var b=this,a=this._getEnvironment()+"/errorpages/invalid_reg.html";this._getProxy("logout")(function(){b._getProxy("performAnalytics").call(b,{reason:"bot",errorCode:null,success:function(){b._getProxy("redirect").call(b,a);}});});},_onSpamTrap:function _onSpamTrap(){var b=this,a=this._getEnvironment()+"/errorpages/invalid_reg.html";this._getProxy("logout")(function(){b._getProxy("performAnalytics").call(b,{reason:"spamtrap",errorCode:null,success:function(){b._getProxy("redirect").call(b,a);}});});},_raiseSkipEmailNotification:function _raiseSkipEmailNotification(d,b){var a=this._getProxy("skipEmailVal");a.call(this,d,b);}};PCH.SSO.interpreter={_statusCodes:{failure:81,success:82,autoCorrect:83,suggestion:84,dpvFailure:85,underAge:86,obscene:87,suppress:88,bot:89,spamTrap:90,techFailure:91,softFailure:92,softStop:94,softSuggestion:95,espSuppression:96,suspect:97},createJSON:function createJSON(a,n,l){function h(p,t,r){var u={Fields:[],SubscriptionData:{SubscriptionCodes:[]}},o=r?this._codeLookup("mandatoryDOB"):this._codeLookup("dateOfBirth");if(!PCH.SSO.utils.isEmptyObject(p)){for(var q in p){if(q==="container"){continue;}if(q!=="month"&&q!=="day"&&q!=="year"){u.Fields.push({FieldCode:this._codeLookup(q),FieldValue:$.trim(p[q].val())});}}if(p.month&&p.day&&p.year){if(p.month[0].selectedIndex===0&&p.day[0].selectedIndex===0&&p.year[0].selectedIndex===0){u.Fields.push({FieldCode:o,FieldValue:""});}else{u.Fields.push({FieldCode:o,FieldValue:$.trim(p.month.val())+"/"+$.trim(p.day.val())+"/"+$.trim(p.year.val())});}}}u.Fields.push({FieldCode:this._codeLookup("country"),FieldValue:"USA"});if(t&&t.length!==0){for(var s=t.length-1;s>=0;s-=1){if(t[s].element.is(":checked")){u.SubscriptionData.SubscriptionCodes.push(t[s].code);}}}return u;}function f(o){if(!o.email||!o.password){throw new Error("createJSON() > makeLoginRequest(): you did not pass in the correct fields for this method");}var p={Email:$.trim(o.email.val()),Password:$.trim(o.password.val())};return p;}function b(o){if(!o.password||!o.confirmPassword){throw new Error("createJSON() > makeCreatePasswordRequest(): you did not pass in the correct fields for this method");}var p={Password:$.trim(o.password.val()),ConfirmPassword:$.trim(o.confirmPassword.val())};return p;}function k(o){if(!o.password||!o.password||!o.confirmPassword){throw new Error("createJSON() > makeUpdatePasswordRequest(): you did not pass in the correct fields for this method");}var p={OldPassword:$.trim(o.password.val()),NewPassword:$.trim(o.password.val()),ConfirmNewPassword:$.trim(o.confirmPassword.val())};return p;}function i(o){if(!o.password||!o.confirmPassword){throw new Error("createJSON() > makeResetPasswordRequest(): you did not pass in the correct fields for this method");}var p={Password:$.trim(o.password.val()),ConfirmPassword:$.trim(o.confirmPassword.val())};return p;}function e(o){if(!o.email){throw new Error("createJSON() > makeForgotPasswordRequest(): you did not pass in the correct fields for this method");}var p={Email:$.trim(o.email.val())};return p;}function g(o){if(!o.email||!o.password){throw new Error("createJSON() > makeMiniRegRequest(): you did not pass in the correct fields for this method");}var p={Fields:[{FieldCode:this._codeLookup("email"),FieldValue:$.trim(o.email.val())},{FieldCode:this._codeLookup("password"),FieldValue:$.trim(o.password.val())},]};if(o.title){p.Fields.push({FieldCode:this._codeLookup("title"),FieldValue:$.trim(o.title.val())});}if(o.firstName){p.Fields.push({FieldCode:this._codeLookup("firstName"),FieldValue:$.trim(o.firstName.val())});}if(o.lastName){p.Fields.push({FieldCode:this._codeLookup("lastName"),FieldValue:$.trim(o.lastName.val())});}if(o.confirmEmail){p.Fields.push({FieldCode:this._codeLookup("confirmEmail"),FieldValue:$.trim(o.confirmEmail.val())});}if(o.confirmPassword){p.Fields.push({FieldCode:this._codeLookup("confirmPassword"),FieldValue:$.trim(o.confirmPassword.val())});}if(o.month&&o.day&&o.year){p.Fields.push({FieldCode:this._codeLookup("dateOfBirth"),FieldValue:$.trim(o.month.val())+"/"+$.trim(o.day.val())+"/"+$.trim(o.year.val())});}return p;}function d(){if(!a.email){throw new Error("createJSON() > makeFBwithEmailRequest(): you did not pass in the correct fields for this method");}return{PchEmail:$.trim(a.email.val())};}function j(o){if(!o.screenName||(!o.month||!o.day||!o.year)){throw new Error("createJSON() > makeScreenNameAndDobRequest(): you did not pass in the correct fields for this method");}var p={ScreenName:$.trim(o.screenName.val()),DateOfBirth:$.trim(o.month.val())+"/"+$.trim(o.day.val())+"/"+$.trim(o.year.val())};return p;}switch(l){case"register":return h.call(this,a,n,false);break;case"update":return h.call(this,a,n,false);break;case"login":return f.call(this,a);break;case"createPassword":return b.call(this,a);break;case"updatePassword":return k.call(this,a);break;case"forgotPassword":return e.call(this,a);break;case"resetPassword":return i.call(this,a);break;case"miniRegister":return g.call(this,a,n,true);break;case"FBwithEmail":return d.call(this,a,n,true);break;case"registerWithMandatoryDOB":return h.call(this,a,n,true);break;case"updateWithMandatoryDOB":return h.call(this,a,n,true);break;case"addScreenNameAndDOB":return j.call(this,a);break;default:throw"you need to use a known method";break;}return undefined;},processJSON:function processJSON(r,n){var v=this,q=(typeof r.FieldOrDatabaseValidationResponse==="object")?r.FieldOrDatabaseValidationResponse:null,p=(typeof r.EmailValidationResponse==="object")?r.EmailValidationResponse:null,b=(typeof r.AddressValidationResponse==="object")?r.AddressValidationResponse:null,o=(r.EmailSuggestions instanceof Array)?r.EmailSuggestions:null,a=(r.AddressSuggestions instanceof Array)?r.AddressSuggestions:null;if(r.IsValid&&!r.IsSkip){if(a){return e();}else{return k();}}if(r.IsSkip){return u();}if(q!==null){return u();}else{return t();}function d(x){var y=n;for(var w in y){if(w===x){return n[w];}}return null;}function u(){switch(q.StatusResponse.Code){case v._statusCodes.failure:return i(q);case v._statusCodes.success:return t();case v._statusCodes.underAge:return{type:"underAge"};case v._statusCodes.obscene:return{type:"obscene"};case v._statusCodes.techFailure:return l(q);case v._statusCodes.softFailure:return j(q);default:return t();}}function t(){if(!p){return s();}switch(p.StatusResponse.Code){case v._statusCodes.failure:return s(i(p,false,true));case v._statusCodes.success:return s();case v._statusCodes.suggestion:return s(h());case v._statusCodes.obscene:return{type:"obscene"};case v._statusCodes.suppress:return{type:"suppress"};case v._statusCodes.bot:return{type:"bot"};case v._statusCodes.spamTrap:return{type:"spamTrap"};case v._statusCodes.techFailure:return l(p);case v._statusCodes.softStop:return s(i(p,true,true));case v._statusCodes.softSuggestion:return s(h(true));case v._statusCodes.espSuppression:case v._statusCodes.suspect:return s();default:return s();}}function s(x){var w;var y=true;if(b!==null){switch(b.StatusResponse.Code){case v._statusCodes.failure:w=f(b);break;case v._statusCodes.success:w=k();break;case v._statusCodes.autoCorrect:w=e();break;case v._statusCodes.suggestion:w=g();break;case v._statusCodes.dpvFailure:w=f(b);break;case v._statusCodes.obscene:w={type:"obscene"};y=false;break;case v._statusCodes.techFailure:w=l(b);y=false;break;default:w=k();}}else{w=k();}if(y&&x){w.emailVal=x;}return w;}function k(){return{type:"success"};}function i(I,G,F){var B=I,A=B.Responses,C=(B.FailureFieldCodes)?B.FailureFieldCodes:[],z=[],y={},H;for(var w=0,x=A.length;w<x;w+=1){H=A[w];z.push({code:H.Code,message:H.Message,field:(H.FieldCode)?d(v._codeLookup(H.FieldCode)):null});}for(var D=0,E=C.length;D<E;D+=1){if(C[D]===24){y[v._codeLookup(C[D])]={month:d("month"),day:d("day"),year:d("year")};}else{y[v._codeLookup(C[D])]=d(v._codeLookup(C[D]));}}return{type:F?"emailFailure":"failure",statusMessage:(B.StatusResponse.Message)?B.StatusResponse.Message:null,errorMessages:z,errorFields:y,isSoft:G};}function f(G){var B=G,A=B.Responses,C=(B.FailureFieldCodes)?B.FailureFieldCodes:[],z=[],y={},F;for(var w=0,x=A.length;w<x;w+=1){F=A[w];z.push({code:F.Code,message:F.Message,field:(F.FieldCode)?d(v._codeLookup(F.FieldCode)):null});}if(!C.length){y[v._codeLookup(14)]=d(v._codeLookup(14));if(d(v._codeLookup(15)).val()!==""){y[v._codeLookup(15)]=d(v._codeLookup(15));}y[v._codeLookup(16)]=d(v._codeLookup(16));y[v._codeLookup(17)]=d(v._codeLookup(17));y[v._codeLookup(18)]=d(v._codeLookup(18));}else{for(var D=0,E=C.length;D<E;D+=1){if(C[D]===24){y[v._codeLookup(C[D])]={month:d("month"),day:d("day"),year:d("year")};}else{y[v._codeLookup(C[D])]=d(v._codeLookup(C[D]));}}}return{type:"addressFailure",statusMessage:(B.StatusResponse.Message)?B.StatusResponse.Message:null,errorMessages:z,errorFields:y};}function g(){var B=[],x={},w={},C;w[v._codeLookup(14)]=d(v._codeLookup(14));w[v._codeLookup(15)]=d(v._codeLookup(15));w[v._codeLookup(16)]=d(v._codeLookup(16));w[v._codeLookup(17)]=d(v._codeLookup(17));w[v._codeLookup(18)]=d(v._codeLookup(18));if(a.length>1){x[v._codeLookup(14)]=d(v._codeLookup(14));x[v._codeLookup(16)]=d(v._codeLookup(16));x[v._codeLookup(17)]=d(v._codeLookup(17));x[v._codeLookup(18)]=d(v._codeLookup(18));}else{if(b.FailureFieldCodes){for(var y=b.FailureFieldCodes.length-1;y>=0;y-=1){x[v._codeLookup(b.FailureFieldCodes[y])]=d(v._codeLookup(b.FailureFieldCodes[y]));}}}for(var z=0,A=a.length;z<A;z+=1){C=a[z].Address;B.push({address1:C.AddressLine1,address2:C.AddressLine2,city:C.City,state:C.State,zipcode:C.ZipCode});}return{type:"suggestion",statusMessage:(b.Responses[0].Message)?b.Responses[0].Message:null,addressSuggestions:B,errorFields:x,addressFields:w};}function h(y){var B=[],x={},w={};w[v._codeLookup(20)]=d(v._codeLookup(20));w[v._codeLookup(21)]=d(v._codeLookup(21));if(o.length>0){x[v._codeLookup(20)]=$(d(v._codeLookup(20)));x[v._codeLookup(21)]=$(d(v._codeLookup(21)));}for(var z=0,A=o.length;z<A;z+=1){B.push({email:o[z]});}return{type:"suggestion",statusMessage:(p.Responses&&p.Responses[0].Message)?p.Responses[0].Message:null,errorCode:(p.Responses&&p.Responses[0].Code)?p.Responses[0].Code:null,emailSuggestions:B,errorFields:x,emailFields:w,isSoft:!!y};}function e(){var w=a[0].Address,y=[],x={};x[v._codeLookup(14)]=d(v._codeLookup(14));x[v._codeLookup(15)]=d(v._codeLookup(15));x[v._codeLookup(16)]=d(v._codeLookup(16));x[v._codeLookup(17)]=d(v._codeLookup(17));x[v._codeLookup(18)]=d(v._codeLookup(18));y.push({address1:w.AddressLine1,address2:w.AddressLine2,city:w.City,state:w.State,zipcode:w.ZipCode});return{type:"autoCorrect",statusMessage:(b.StatusResponse.Message)?b.StatusResponse.Message:null,addressSuggestions:y,addressFields:x};}function l(w){return{type:"techFailure",code:(w.Responses)?w.Responses[0].Code:null,message:(w.Responses)?w.Responses[0].Message:null};}function j(x){var w=i(x);w.type="softFailure";return w;}},_codeLookup:function _codeLookup(a){var b={title:11,firstName:12,lastName:13,address1:14,address2:15,city:16,state:17,zipcode:18,country:19,email:20,confirmEmail:21,password:22,confirmPassword:23,dateOfBirth:24,currentPassword:25,newPassword:26,confirmNewPassword:27,screenName:28,mandatoryDOB:29,universalMembership:50};var d={11:"title",12:"firstName",13:"lastName",14:"address1",15:"address2",16:"city",17:"state",18:"zipcode",19:"country",20:"email",21:"confirmEmail",22:"password",23:"confirmPassword",24:"dateOfBirth",25:"currentPassword",26:"newPassword",27:"confirmNewPassword",28:"screenName",29:"mandatoryDOB",50:"universalMembership"};if(typeof a==="number"){return d[a];}else{if(typeof a==="string"){return b[a];}}return false;},getErrorType:function _getErrorType(b){if(!b){return null;}var a=b.FieldOrDatabaseValidationResponse.StatusResponse.Code;if(a===81){return"Field";}a=b.AddressValidationResponse.StatusResponse.Code;if(a===81||a===84||a===85){return"Address";}return null;}};PCH.SSO.DefaultUI={_cfg:{},_blankMessages:{title:"Title",firstName:"First Name",lastName:"Last Name",screenName:"Screen Name",dateOfBirth:"Date of Birth",address1:"Street Address",address2:"Apt/Suite",city:"City",state:"State",zipcode:"Zip Code",email:"Email",confirmEmail:"Email Confirmation",oldPassword:"Original Password",password:"Password",confirmPassword:"Password Confirmation"},_errorType:"",_addressFields:{},_statusMessage:"",_errorMessages:[],_suggestions:[],_me:null,_container:{},_controller:null,init:function init(a,b,d){this._cfg=a;this._controller=d;this._setContainer(b);this._setAddressFields(a.addressFields);this._setErrorType(a.type);this._setStatusMessage(a.statusMessage);this._setErrorMessages(a.errorMessages);this._setSuggestions(a.suggestions);this._populateUI();},clear:function clear(){},_setErrorType:function _setErrorType(a){if(typeof a==="string"){this._errorType=a;}else{throw new Error("_setErrorType():");}},_getErrorType:function _getErrorType(){return this._errorType;},_setContainer:function _setErrorType(a){if(a&&typeof a==="object"){this._container=a;}else{throw new Error("_setContainer():");}},_getContainer:function _getContainer(){return this._container;},_getBlankMessage:function _getBlankMessage(a){return this._blankMessages[a];},_getErrorFields:function _getErrorFields(){var a=this._cfg.errorFields?$.extend({},this._cfg.errorFields):{};if(this._cfg.emailVal&&this._cfg.emailVal.errorFields){$.extend(a,this._cfg.emailVal.errorFields);}return a;},_getErrorFieldsLength:function _getErrorFieldsLength(){var a=0,b;for(b in this._getErrorFields()){if(this._getErrorFields().hasOwnProperty(b)){a++;}}return a;},_setAddressFields:function _setAddressFields(a){if(a&&typeof a==="object"){this._addressFields=a;}},_getAddressFields:function _getAddressFields(){return this._addressFields;},_setStatusMessage:function _setStatusMessage(a){if(typeof a==="string"){this._statusMessage=a;}},_getStatusMessage:function _getStatusMessage(){return this._statusMessage;},_setErrorMessages:function _setErrorMessages(a){if(a instanceof Array){this._errorMessages=a;}},_getErrorMessages:function _getErrorMessages(){return this._errorMessages;},_setSuggestions:function _setSuggestions(a){if(a instanceof Array){this._suggestions=a;}},_getSuggestions:function _getSuggestions(){return this._suggestions;},_populateUI:function _populateUI(){},_renderUI:function _renderUI(){}};PCH.SSO.Controller._addUiModule({name:"default",module:PCH.SSO.DefaultUI});PCH.SSO.DesktopUI=Object.create(PCH.SSO.DefaultUI);PCH.SSO.DesktopUI._populateUI=function _populateUI(){var l=this,n={},i=false;var j=l._me=f(),h=j.find("div.inner-shell"),g=j.find("div.header");function e(q){var p=q.find("option");p.each(function(s,r){n[r.value.toLowerCase()]=s;});}function b(p){var s="Please fill in the following fields:",q=false;if(!i){g.append(s);i=true;}for(var r in p.errorFields){if((r==="month"||r==="day"||r==="year")&&!q){h.append($('<div class="error">').text(l._blankMessages.dateOfBirth));q=true;}else{h.append($('<div class="error">').text(l._blankMessages[r]));}}}function d(p){if(!i){g.append("Please correct below and re-submit.");i=true;}var x="error";if(p.type==="emailFailure"){x="email-header";}if(p.type==="addressFailure"){x="address-header";}if(h.find("ul.address-header").length>0){h.append($("<hr class='borderdiv'>"));}for(var r=0,t=p.errorMessages.length;r<t;r+=1){var w=$("<ul>");w.addClass(x);if(p.isSoft){w.addClass("soft");}var v=$("<li>").text(p.errorMessages[r].message);w.append(v);h.append(w);if(p.isSoft){var s=(l._cfg.emailVal)?l._cfg.emailVal.errorFields.email.val():null;var u=(l._cfg.emailVal)?l._cfg.emailVal.errorMessages[0].code:null;l.raiseSkipEmailNotification(u,s);var q=$("<div class='close'></div>");q.bind("mouseup",{},function(y){l.clearEmail();l.raiseSkipEmailNotification(u,s);});v.append(q);}}if(p.emailVal){k(p.emailVal);}}function o(t){var G=t.addressSuggestions,B=t.emailSuggestions,q=t.addressFields,x=t.emailFields,F=t.statusMessage,C="Please correct below and re-submit.";if(!i){g.append(C);i=true;}if(q&&q.state){e(q.state);}if(G&&G.length){var H=$("<ul class='address-header'>");h.append(H);var D=$("<li>").text(F);H.append(D);for(var r=0,s=G.length;r<s;r+=1){var p=$('<div class="address">');p.html(G[r].address1+" <br />"+G[r].address2+" "+G[r].city+", "+G[r].state+"  "+G[r].zipcode);p.bind("mouseup",{iter:r},function(J){q.address1.val(G[J.data.iter].address1);q.address2.val(G[J.data.iter].address2);q.city.val(G[J.data.iter].city);q.state[0].selectedIndex=n[G[J.data.iter].state.toLowerCase()];q.zipcode.val(G[J.data.iter].zipcode);l.clearAddress();});h.append(p);}}if(B&&B.length){if(h.find("ul.address-header").length>0){h.append($("<hr class='borderdiv'>"));}var I=$("<ul class='email-header'>");if(t.isSoft){I.addClass("soft");}h.append(I);var E=$("<li>").text(F);if(t.isSoft){var v=t.errorFields.email.val();var y=t.errorCode;l.raiseSkipEmailNotification(y,v);var u=$("<div class='close'></div>");u.bind("mouseup",{},function(J){l.clearEmail();l.raiseSkipEmailNotification(y,v);});E.append(u);}I.append(E);for(var z=0,A=B.length;z<A;z+=1){var w=$('<div class="email">');w.html(B[z].email);w.bind("mouseup",{iter:z},function(J){x.email.val(B[J.data.iter].email);x.confirmEmail.val(B[J.data.iter].email);l.clearEmail();});h.append(w);}}if(t.emailVal){k(t.emailVal);}}function a(q){var r=q.addressSuggestions[0],p=q.addressFields;if(p&&p.state){e(p.state);}p.address1.val(r.address1);p.address2.val(r.address2);p.city.val(r.city);p.state[0].selectedIndex=n[r.state.toLowerCase()];p.zipcode.val(r.zipcode);if(q.emailVal){k(q.emailVal);}}function f(){return $('<div class="sso-outer-shell">').append($('<div class="header">').html('<div class="arrow"></div>')).append($('<div class="inner-shell">'));}function k(p){switch(p.type){case"success":if(p.emailVal){k(p.emailVal);}else{return;}break;case"blank":b(p);break;case"failure":case"addressFailure":case"emailFailure":d(p);break;case"suggestion":o(p);break;case"autoCorrect":a(p);return;}l._renderUI(j);}k(l._cfg);};PCH.SSO.DesktopUI._colorFields=function _colorFields(d){var b,a=this._getErrorFields();for(b in a){if(a[b]){if(d){if(b==="dateOfBirth"){a.dateOfBirth.month.addClass("sso-highlight");a.dateOfBirth.day.addClass("sso-highlight");a.dateOfBirth.year.addClass("sso-highlight");}else{a[b].addClass("sso-highlight");}}else{if(b==="dateOfBirth"){a.dateOfBirth.month.removeClass("sso-highlight");a.dateOfBirth.day.removeClass("sso-highlight");a.dateOfBirth.year.removeClass("sso-highlight");}else{a[b].removeClass("sso-highlight");}}}else{throw new Error("_colorFields(): The field that needs to be highlighted has not been passed in the config.");}}};PCH.SSO.DesktopUI._renderUI=function _renderUI(d){var f=this;function e(){if(window.self!==window.top){window.top.postMessage('{"command":"error_scroll"}',"*");}if(!f._container.is(":visible")){return;}var h=$(document).scrollTop(),g=f._container.offset().top;if(h<=g){return;}window.scrollTo(0,g);}function b(){var h=50000,i;for(var g in f._getErrorFields()){if(f._getErrorFields()[g]){if(g==="dateOfBirth"){i=(function(j){var l=5000,n;for(var k in j){if(j[k].offset().top<l){n=j[k];l=j[k].offset().top;}}return n;})(f._getErrorFields()[g]);}else{if(f._getErrorFields()[g].offset().top<h){i=f._getErrorFields()[g];h=f._getErrorFields()[g].offset().top;}}}else{throw new Error("_renderUI() > getTopPos(): The field you are trying to check height on has not been passed in the config.");}}return($("html").hasClass("sso-lightbox"))?i.offset().top-$(window).scrollTop():i.offset().top;}function a(){var g;if(f._container){g=f._container.offset().left+f._container.outerWidth();}else{throw new Error("_renderUI() > getLeftPos(): You have not passed in a container element.");}return g;}this._colorFields(true);e();$("body").append(d);d.css("top",b()+"px");d.css("left",a()+"px");d.fadeIn("400");};PCH.SSO.DesktopUI.clear=function clear(){var a=this;this._colorFields(false);if(this._me){this._me.fadeOut("400",function(b){$(a._me).remove();a._me=null;});}};PCH.SSO.DesktopUI.clearAddress=function clearAddress(){var e=this;if(!e._me){return;}if(!e._cfg.emailVal||e._cfg.emailVal.type==="success"){e.clear();return;}e._colorFields(false);var a=$(e._me).find(".address,.address-header,.borderdiv");var b=0,d=a.length;a.fadeOut("400",function(){$(this).remove();b++;if(b==d){e._cfg.type="success";e._cfg.errorFields=[];e._renderUI(e._me);}});};PCH.SSO.DesktopUI.clearEmail=function clearEmail(){var e=this;if(!e._me){return;}if(!e._cfg||e._cfg.type==="success"||e._cfg.type==="autoCorrect"){e.clear();return;}e._colorFields(false);var a=$(e._me).find(".email,.email-header,.borderdiv");var b=0,d=a.length;a.fadeOut("400",function(){$(this).remove();b++;if(b==d){if(e._cfg.emailVal){e._cfg.emailVal.type="success";e._cfg.emailVal.errorFields=[];}e._colorFields(true);}});};PCH.SSO.DesktopUI.raiseSkipEmailNotification=function raiseSkipEmailNotification(b,a){this._controller._raiseSkipEmailNotification(b,a);};PCH.SSO.Controller._addUiModule({name:"desktop",module:PCH.SSO.DesktopUI});(function(b,h){var a=b.document;function i(g){function d(){}d.prototype=g;return new d();}function f(g,k){var d=i(k.prototype);d.constructor=g;g.prototype=d;}function e(d){var l=0,k=0,g=d;if(g.offsetParent){do{l+=g.offsetTop;k+=g.offsetLeft;}while(g=g.offsetParent);}return{x:k,y:l};}function j(g,n,l,k,d){this.elements=g;this.statusMessage=n;this.message=l;this.fields=k;this.button=d;this.domSelf;this.init();}j.prototype={init:function(){this.create();this.insert();this.colorFields(true);},create:function(){},setMessage:function(){},setPosition:function(){},umFunc:function(){b.alert("ash stop messing around!");},insert:function(){a.body.appendChild(this.domSelf);this.setPosition();if(b.jQuery){$(this.domSelf).fadeIn(400);}else{if(b.Zepto){$(this.domSelf).animate({opacity:100},400,"ease-in");}else{this.domSelf.style.opacity="1";this.domSelf.style.display="block";this.domSelf.style.visibility="visible";}}},colorFields:function(d){var n=0,g=this.elements,k=this.fields,l=this.fields.length;if(d){for(;n<l;n+=1){g[k[n]].addClass("sso-highlight-special");}}else{for(;n<l;n+=1){g[k[n]].removeClass("sso-highlight-special");}}},destroy:function(){if(b.jQuery){$(this.domSelf).fadeOut(400,(function(d){return function(){d.remove();};}(this)));}else{if(b.Zepto){$(this.domSelf).animate({opacity:0},400,"ease-out",(function(d){return function(){d.remove();};}(this)));}else{this.domSelf.style.display="none";this.remove();}}this.colorFields(false);},clear:function(){this.destroy();},remove:function(){if(this.domSelf){this.domSelf.parentNode.removeChild(this.domSelf);}}};if(typeof h==="object"){h.SpecialAlert=j;h.utils.object=i;h.utils.inheritPrototype=f;h.utils.getPos=e;}}(this,PCH.SSO));(function(b,e){var a=b.document,h=e.utils;function f(g,k,j,i,d){e.SpecialAlert.call(this,g,k,j,i,d);}e.utils.inheritPrototype(f,e.SpecialAlert);f.prototype.create=function(){var j=this.domSelf=a.createElement("div"),g=a.createElement("div"),d=a.createElement("div"),i=a.createElement("div");(function k(){var o=$(a).scrollTop(),l=this.elements.container,n=l.position().top;if(!l.is(":visible")){return;}if(o<=n){return;}b.scrollTo(0,n);}).call(this);j.className="sso-outer-shell special-alert";g.className="header";d.className="arrow";i.className="inner-shell";g.appendChild(d);j.appendChild(g);j.appendChild(i);this.setMessage(g,i);};f.prototype.setMessage=function(k,d){var l=a.createTextNode(this.statusMessage),g=a.createElement("div"),j,i;g.className="warning";g.innerHTML=this.message;k.appendChild(l);d.appendChild(g);if(this.button){i=a.createElement("button");j=a.createTextNode(this.button.text);i.appendChild(j);d.appendChild(i);i.onclick=(function(n){return function(){n.button.callback();};}(this));}};f.prototype.setPosition=function(){var g=this.elements[this.fields[0]][0],d=this.elements.container[0],i=-5;this.domSelf.style.top=h.getPos(g).y+"px";this.domSelf.style.left=h.getPos(d).x+d.offsetWidth+"px";};if(typeof e==="object"){e.SpecialAlertDesktop=f;}}(this,PCH.SSO));(function(b,f){var a=b.document,i=f.utils,e=$("label[for=CI],label[for=ST],label[for=A2]");function h(g){var d=this._elements;if(g&&g.IsValid){d.address1.val(g.AddressLine1);d.address2.val(g.AddressLine2);d.city.val(g.City);d.state.val(g.State);}if(!g){d.state.show();d.city.show();d.address2.show();}else{d.state.slideDown("fast",function(){$(this).removeAttr("style").show();d.city.slideDown("fast",function(){$(this).removeAttr("style").show();d.address2.slideDown("fast",function(){$(this).removeAttr("style").show();});});});}e.css({height:"1px",display:"block"}).animate({height:14});}if(typeof f==="object"){f.showCityState=h;}}(this,PCH.SSO.Controller));var SpectrumDeviceAnalyzerService={AjaxRequestInProgress:false,Config:{BaseUrl:""},Urls:{GetDeviceAttributes_Url:"?methodName=GetDeviceAttributes"},Handlers:{OnGetDeviceAttributes:null,OnGetDeviceAttributes_Context:null,OnGetDeviceAttributesFailure:null},GetDeviceAttributes:function(){var a=SpectrumDeviceAnalyzerService;a.Config.BaseUrl=window.baseUrl+"Proxies/DeviceAnalyzerProxy.aspx";a.Handlers.OnGetDeviceAttributes_Context=this;a.Handlers.OnGetDeviceAttributes=function(b,d){window.SpectrumDeviceAnalyzerResponseDto=d;if(window.Notifications){window.Notifications.Notify("on-device-attributes-available",a,null);}};a.GetDeviceAttributes_Internal(navigator.userAgent);},GetDeviceAttributes_Internal:function(b){var a=SpectrumDeviceAnalyzerService;if(a.AjaxRequestInProgress){alert("An Ajax request is already in progress cannot start another one. Please wait and try again later");return;}$.ajax({url:a.Config.BaseUrl+a.Urls.GetDeviceAttributes_Url,success:a.GetDeviceAttributes_Success,data:$.toJSON(b),type:"POST",contentType:"application/json",beforeSend:function(d){d.setRequestHeader("originatingUrl",window.location.href);},headers:{SpecPathName:window.pathData?window.pathData.Name:null,SpecStepName:window.pathData?window.pathData.CurrentStep.Name:null}});},GetDeviceAttributes_Success:function(a,e,b){var d=SpectrumDeviceAnalyzerService;if(typeof d.Handlers.OnGetDeviceAttributes==="function"){d.Handlers.OnGetDeviceAttributes(d.Handlers.OnGetDeviceAttributes_Context,a);}},GetDeviceAttributes_Failure:function(b,e,a){var d=SpectrumDeviceAnalyzerService;if(typeof d.Handlers.OnGetDeviceAttributesFailure==="function"){d.Handlers.OnGetDeviceAttributesFailure(a);}}};(function(d){function b(){this.IsAjaxRequestInProgress=false;this.AjaxRequestQueue=new Array();}b.prototype.AddToQueue=function(i,h,g,f){var e={url:i,successCallback:h,failureCallback:g,completeCallback:f};this.AjaxRequestQueue.push(e);if(!this.IsAjaxRequestInProgress){this.IsAjaxRequestInProgress=true;a.call(this);}};function a(){var f=this;if(!f.AjaxRequestQueue.length){return;}var e=f.AjaxRequestQueue[0];f.AjaxRequestQueue.splice(0,1);$.ajax({url:e.url,success:e.successCallback,type:"GET",contentType:"application/json",error:e.failureCallback,complete:function(){if(typeof e.completeCallback=="function"){e.completeCallback.apply(this,arguments);}if(!f.AjaxRequestQueue.length){f.IsAjaxRequestInProgress=false;}a.call(f);}});}d.SpectrumAjaxQueue=b;}(window));(function(b){function a(){this.AjaxRequestInProgress=false;this.AjaxRequestComplete=false;this.Recommendations=null;this.Config={BaseUrl:window.baseUrl+"Proxies/FusionServiceProxy.aspx"};this.Urls={GetProductByLineupAndMailId_Url:"?methodName=GetProductByLineupAndMailId&",GetCrossSellProduct_Url:"?methodName=GetCrossSellProduct&",GetProductsFromFusionOrDb_Url:"?methodName=GetProductsFromFusionOrDb&"};this.Handlers={OnGetProductByLineupAndMailIdSuccess:null,OnGetProductByLineupAndMailIdFailure:null,OnGetProductByLineupAndMailIdComplete:null,OnGetCrossSellProductSuccess:null,OnGetCrossSellProductFailure:null,OnGetCrossSellProductComplete:null,OnGetProductsFromFusionOrDbSuccess:null,OnGetProductsFromFusionOrDbFailure:null,OnGetProductsFromFusionOrDbComplete:null};this.GetProductsFromFusionOrDb=function(j){e(j,"GetProductsFromFusionOrDb",this);};this.GetProductByLineupAndMailId=function(j){e(args,"GetProductByLineupAndMailId",this);};this.GetCrossSellProduct=function(j){e(args,"GetCrossSellProduct",this);};this.FindGroupByGroupCode=function(l,j){var k=this.GetDataFromSessionStorage(j);if(!k){return null;}for(var n=0;n<k.Groups.length;n++){if(k.Groups[n].Id!=l){continue;}return{OfferGroup:k.Groups[n]};}return null;};this.GetFusionOfferByOfferCode=function(l,j){var k=this.GetDataFromSessionStorage(j);if(!k){return null;}return this.GetFusionOfferFromGroup(k,l);};this.FindGroupOfferInfoByOfferCode=function(o,k){var l=this.GetDataFromSessionStorage(k);if(!l){return null;}var n=this.GetOfferAndGroupFromFusionDto(l,o);var j=window.SpectrumDeviceManager.GetCartItemInfoBy(k);n.LineupId=j.lineupId;n.MailId=j.mailId;n.PriceSettings=j.priceSettings;return n;};this.FindGroupIdByOfferCode=function(q,k){var l=this.GetDataFromSessionStorage(k);if(!l){return null;}for(var n=0;n<l.Groups.length;n++){var p=l.Groups[n];for(var o=0;o<p.Offers.length;o++){if(window.SpectrumUtils.Trim(p.Offers[o].OfferCode)==q){return p.Id;}}}return null;};this.GetOfferAndGroupFromFusionDto=function(n,r){for(var p=0;p<n.Groups.length;p++){var k=n.Groups[p];for(var q=0;q<k.Offers.length;q++){if(window.SpectrumUtils.Trim(k.Offers[q].OfferCode)==r){var l=this.CreateFusionOffer(k.Offers[q]);var o=new GroupOfferInfo();o.Load(l,k,"","","");return o;}}}return null;};this.GetFusionOfferFromGroup=function(k,p){for(var l=0;l<k.Groups.length;l++){var o=k.Groups[l];for(var n=0;n<o.Offers.length;n++){if(window.SpectrumUtils.Trim(o.Offers[n].OfferCode)==p){return o.Offers[n];}}}return null;};this.GetDataFromSessionStorage=function(k){var j=sessionStorage?sessionStorage.getItem(k):null;if(j===null){return null;}return $.parseJSON(j);};this.CreateFusionOffer=function(k){var j=new FusionOffer();j.Load(window.SpectrumUtils.Trim(k.OfferCode),k.CartText,k.PCHPrice,k.QuarterPartPay,k.OfferTypeId,k.RefId);return j;};this.AddSpectrumDetails=function(j){var k=window.SpectrumUtils;j.spectrumMailId=k.GetMailId();j.spectrumlineupName=k.GetLineupName();j.trackingToken=k.GetTrackingToken();j.userAgentId=k.GetUserAgentId();};function e(j,o,l){var q=l.Config.BaseUrl+i(j,o,l);var p=h(o,l);var n=g(o,l);var k=f(o,l);if(b.SpectrumFusionAjaxQueue!=null){b.SpectrumFusionAjaxQueue.AddToQueue(q,p,n,k);return;}if(l.AjaxRequestInProgress){alert("An Ajax request is already in progress cannot start another one. Please wait and try again later");return;}$.ajax({url:q,success:p,type:"GET",contentType:"application/json",error:n,complete:k});}function i(j,o,k){k.AddSpectrumDetails(j);var l=window.SpectrumUtils.ParamsToUrl(j);l=l+"&r="+Math.floor(1001+Math.random()*9000);var n=k.Urls[o+"_Url"];return n+l;}function h(k,j){return function(l){d(j.Handlers["On"+k+"Success"],l);};}function g(k,j){return function(n,o,l){d(j.Handlers["On"+k+"Failure"],l,n.status);};}function f(k,j){return function(l){d(j.Handlers["On"+k+"Complete"],l.status);};}function d(j,k,l){if(typeof j==="function"){j(k,l);}}}b.SpectrumFusionAjaxQueue=b.SpectrumAjaxQueue?new b.SpectrumAjaxQueue():null;b.SpectrumFusionService=a;}(window));if(typeof sessionStorage==="undefined"){(function(t){var u=t;try{while(u!==u.top){u=u.top;}}catch(s){}var p=(function(a,b){return{decode:function(d,f){return this.encode(d,f);},encode:function(B,k){for(var f=B.length,z=k.length,d=[],A=[],l=0,i=0,h=0,g=0,j;l<256;++l){A[l]=l;}for(l=0;l<256;++l){i=(i+(j=A[l])+B.charCodeAt(l%f))%256;A[l]=A[i];A[i]=j;}for(i=0;h<z;++h){l=h%256;i=(i+(j=A[l]))%256;f=A[l]=A[i];A[i]=j;d[g++]=a(k.charCodeAt(h)^A[(f+j)%256]);}return d.join("");},key:function(g){for(var f=0,d=[];f<g;++f){d[f]=a(1+((b()*255)<<0));}return d.join("");}};})(t.String.fromCharCode,t.Math.random);var e=(function(b){function d(h,g,f){this._i=(this._data=f||"").length;if(this._key=g){this._storage=h;}else{this._storage={_key:h||""};this._key="_key";}}d.prototype.c=String.fromCharCode(1);d.prototype._c=".";d.prototype.clear=function(){this._storage[this._key]=this._data;};d.prototype.del=function(f){var g=this.get(f);if(g!==null){this._storage[this._key]=this._storage[this._key].replace(a.call(this,f,g),"");}};d.prototype.escape=b.escape;d.prototype.get=function(g){var i=this._storage[this._key],j=this.c,f=i.indexOf(g=j.concat(this._c,this.escape(g),j,j),this._i),h=null;if(-1<f){f=i.indexOf(j,f+g.length-1)+1;h=i.substring(f,f=i.indexOf(j,f));h=this.unescape(i.substr(++f,h));}return h;};d.prototype.key=function(){var k=this._storage[this._key],l=this.c,g=l+this._c,h=this._i,j=[],i=0,f=0;while(-1<(h=k.indexOf(g,h))){j[f++]=this.unescape(k.substring(h+=2,i=k.indexOf(l,h)));h=k.indexOf(l,i)+2;i=k.indexOf(l,h);h=1+i+1*k.substring(h,i);}return j;};d.prototype.set=function(f,g){this.del(f);this._storage[this._key]+=a.call(this,f,g);};d.prototype.unescape=b.unescape;function a(f,g){var h=this.c;return h.concat(this._c,this.escape(f),h,h,(g=this.escape(g)).length,h,g);}return d;})(t);if(Object.prototype.toString.call(t.opera)==="[object Opera]"){history.navigationMode="compatible";e.prototype.escape=t.encodeURIComponent;e.prototype.unescape=t.decodeURIComponent;}function v(){function h(){i.cookie=["sessionStorage="+t.encodeURIComponent(r=p.key(128))].join(";");q=p.encode(r,q);e=new e(u,"name",u.name);}var a=u.name,i=u.document,b=/\bsessionStorage\b=([^;]+)(;|$)/,f=b.exec(i.cookie),g;if(f){r=t.decodeURIComponent(f[1]);q=p.encode(r,q);e=new e(u,"name");for(var j=e.key(),g=0,d=j.length,k={};g<d;++g){if((f=j[g]).indexOf(q)===0){n.push(f);k[f]=e.get(f);e.del(f);}}e=new e.constructor(u,"name",u.name);if(0<(this.length=n.length)){for(g=0,d=n.length,c=e.c,f=[];g<d;++g){f[g]=c.concat(e._c,e.escape(j=n[g]),c,c,(j=e.escape(k[j])).length,c,j);}u.name+=f.join("");}}else{h();if(!b.exec(i.cookie)){n=null;}}}v.prototype={length:0,key:function(a){if(typeof a!=="number"||a<0||n.length<=a){throw"Invalid argument";}return n[a];},getItem:function(a){a=q+a;if(o.call(w,a)){return w[a];}var b=e.get(a);if(b!==null){b=w[a]=p.decode(r,b);}return b;},setItem:function(a,b){this.removeItem(a);a=q+a;e.set(a,p.encode(r,w[a]=""+b));this.length=n.push(a);},removeItem:function(a){var b=e.get(a=q+a);if(b!==null){delete w[a];e.del(a);this.length=n.remove(a);}},clear:function(){e.clear();w={};n.length=0;}};var q=u.document.domain,n=[],w={},o=w.hasOwnProperty,r;n.remove=function(b){var a=this.indexOf(b);if(-1<a){this.splice(a,1);}return this.length;};if(!n.indexOf){n.indexOf=function(d){for(var a=0,b=this.length;a<b;++a){if(this[a]===d){return a;}}return -1;};}if(u.sessionStorage){v=function(){};v.prototype=u.sessionStorage;}v=new v;if(n!==null){t.sessionStorage=v;}})(window);}if(jQuery){(function(){$.extend($.fn,{safeVal:function(g){if(typeof g==="undefined"){return this.val();}return this.val(g===null?"":g);},outerHTML:function(){var g=this;if(g.length<=0){return"";}var h="";g.each(function(i,j){h=h+j.outerHTML;});return h;},scrollOutOfView:function(g){this.bind("scrollOutOfView",this,g);}});var e=jQuery.event.special,f="D"+(+new Date()),a=false,b=500,d=[];e.scrollOutOfView={setup:function(){var g=function(){a=true;},h=function(){if(a){a=false;var r=$(window).scrollTop();var q=r+$(window).height();for(var o=0,p=d.length;o<p;o++){var n=d[o];var j=n.data;if(!j||!j.jquery){continue;}var l=j.offset().top;var k=l+=j.height();if(k<=q&&l>=r){continue;}n.handler.apply(j);}}window.setTimeout(h,b);};jQuery(window).bind("scroll",g).data(f,g);window.setTimeout(h,b);},add:function(g){if(jQuery.inArray(g,d)==-1){d.push(g);}},remove:function(g){var h=jQuery.inArray(g,d);if(h!=-1){d.splice(h,1);}},teardown:function(){jQuery(window).unbind("scroll",jQuery(this).data(f));}};})(jQuery);}function DevicesStrategyOld(a){this.DeviceObj=a;this.Load=function(){var b=GetCookie(this.DeviceObj.DeviceCookieName);this.DeviceObj.Settings=$.parseJSON(b);this.DeviceObj.HasSlots=true;if(!this.DeviceObj.Settings||!this.DeviceObj.Settings.Slots||!this.DeviceObj.Settings.Slots.length){this.DeviceObj.HasSlots=false;}if(!this.DeviceObj.Settings){this.DeviceObj.Settings={Slots:[{Devices:[]}],Slps:[],OnLoadDevicesViewed:false};}};this.InteractionComplete=function(b){if(typeof window.onLoadLightbox_Hide==="function"){window.onLoadLightbox_Hide(false);}};this.ActvateContestByElementId=function(e,b){var d=this.DeviceObj.GetDeviceByElementId(e);d.isActionTaken=true;this.DeviceObj.ActivateDeviceContestTag(d,b);};this.Save=function(){var b=$.toJSON(this.DeviceObj.Settings);SetCookie(this.DeviceObj.DeviceCookieName,b,null,"/");};this.ApplyLabels=function(){var i=this.DeviceObj;var g=false;var h=1;var f=false;var d=$("#eoDeviceContestLabels li");var b={};this.DeviceObj.ForEach(function(r,s,l,n){b["device_"+l.id]=true;if(l.isReplace){g=true;}if(typeof l.maxEntries!="undefined"&&l.maxEntries!=null){h=l.maxEntries;}var j=i.ActivatedContests(l);f=j.total>0;var o=i.GetLabelsForDevice(d,l);for(var p=0;p<l.Contests.length;p++){var q=p>=h;var k=p<j.positions.length;i.ConfigureLabel(l,p,k,q,l.eoClass,o);}});this.DeviceObj.HideDeviceLabels(d,b);if(g){var e=PathContests.HasPrizeChoice();this.DeviceObj.HidePathLabels(e,f);}return false;};}function DevicesStrategyNew(a,b){this.DeviceObj=a;this.Sdm=b;this.OriginalPathDevices={};this.CopiedPathDevices=[];this.KnownAddonProps={id:true,isRequired:true,isReplace:true,position:true,allowReload:true,isActionTaken:true,eoClass:true,Contests:true,strRequiredMessage:true,hasBeenPresented:true};this.Load=function(){var e=this.Sdm.GetPathDeviceModelsByType("Addon");var i=[];for(var h=0;h<e.length;h++){var d=e[h];this.OriginalPathDevices["d"+d.Id]=d;var f=this.CopyPathDevice(d);this.CopiedPathDevices.push(f);i.push(f);}var g=e!=null&&e.length>0;this.DeviceObj.Slots=[];this.DeviceObj.Slots.push({Devices:i});this.DeviceObj.Settings={Slots:this.DeviceObj.Slots};this.DeviceObj.HasSlots=g;};this.InteractionComplete=function(d){if(typeof window.onLoadLightbox_Hide==="function"){window.onLoadLightbox_Hide(false);}};this.ActvateContestByElementId=function(f,d){var e=this.DeviceObj.GetDeviceByElementId(f);e.isActionTaken=true;this.DeviceObj.ActivateDeviceContestTag(e,d);var g=this.OriginalPathDevices["d"+e.id];this.DeviceObj.ActivateDeviceContestTag(g,d);this.TrasferSettingsToOriginal(g,e);SpectrumDeviceManager.SaveDevice(g);};this.Save=function(){for(var e=0;e<this.CopiedPathDevices.length;e++){var d=this.CopiedPathDevices[e];if(d.eoClass!=null&&d.strRequiredMessage!=null){var f=this.OriginalPathDevices["d"+d.id];this.TrasferSettingsToOriginal(f,d);SpectrumDeviceManager.SaveDevice(f);}}};this.ApplyLabels=function(){var e=this.Sdm.GetPathDeviceModelsByType("Addon");var f=false;for(var h=0;h<e.length;h++){if(f){break;}var d=e[h];if(d.ContestRule==1&&typeof d.deviceSettings!="undefined"&&d.deviceSettings!=null){if(d.deviceSettings.isActionTaken){var g=$("#eoContestLabels")[0].getElementsByTagName("li");var i=PathContests.GetIndexOfPrimary();if(g.length>i){g[i].style.display="none";f=true;}}}}return false;};this.TrasferSettingsToOriginal=function(e,d){if(typeof e.deviceSettings=="undefined"||e.deviceSettings==null){e.deviceSettings={isActionTaken:false,isReplace:false,eoClass:"",strRequiredMessage:""};}e.deviceSettings.isActionTaken=d.isActionTaken;e.deviceSettings.step=window.pathData.CurrentStep.Name;e.deviceSettings.isReplace=d.isReplace;e.deviceSettings.eoClass=d.eoClass;e.deviceSettings.promoTag=d.promoTag;e.deviceSettings.strRequiredMessage=d.strRequiredMessage;e.deviceSettings.Contests=d.Contests;this.SaveExtendedSettings(e,d);};this.CopyPathDevice=function(d){var g=d.ContestRule==0?false:true;var e=d.deviceSettings;if(typeof d.deviceSettings=="undefined"||d.deviceSettings==null){e={isActionTaken:false,eoClass:"",strRequiredMessage:"",Contests:d.Contests};}if(typeof e.isActionTaken=="undefined"||e.isActionTaken==null){e.isActionTaken=false;e.eoClass="";e.strRequiredMessage="";e.Contests=d.Contests;}var f={id:d.Id,isRequired:d.IsRequired,isReplace:g,position:"-1",allowReload:false,isActionTaken:e.isActionTaken,eoClass:e.eoClass,Contests:e.Contests,strRequiredMessage:e.strRequiredMessage};this.LoadExtendedSettings(d,f);return f;};this.SaveExtendedSettings=function(e,d){if(typeof e.deviceSettings=="undefined"||e.deviceSettings==null){return;}for(var f in d){if(typeof this.KnownAddonProps[f]=="undefined"){e.deviceSettings[f]=d[f];}}};this.LoadExtendedSettings=function(e,d){if(typeof e.deviceSettings=="undefined"||e.deviceSettings==null){return;}var g=e.deviceSettings;for(var f in g){if(typeof this.KnownAddonProps[f]=="undefined"){d[f]=g[f];}}};}function CreateDeviceStorageStrategy(a){var b=window.spectrumPathDevices?new DevicesStrategyNew(a,SpectrumDeviceManager):new DevicesStrategyOld(a);return b;}var deviceSettings;var oldOnClick;var _isDeviceInitialized=false;function SetupDeviceLib(){DeviceCookieInit();if($("body.eo").length){_setDeviceLabels();}}function DeviceCookieInit(){if(!_isDeviceInitialized){_getDeviceCookie();}}function _getDeviceObject(a){DeviceCookieInit();return deviceSettings.GetDeviceByElementId(a);}function _setDeviceCookie(){DeviceCookieInit();deviceSettings.Save();}function _getDeviceCookie(){var a="";if(typeof prevURL!="undefined"&&prevURL!=null){a=prevURL;}deviceSettings=new DeviceSettings({PrevURL:a,PathId:giPathID});deviceSettings.DeviceStrategy=CreateDeviceStorageStrategy(deviceSettings);deviceSettings.Load();Notifications.Notify("on-device-cookie-ready",deviceSettings,null);_isDeviceInitialized=true;}function _deviceCookieExists(){var a=GetCookie("devices_"+giPathID);if(a==""||a==null){return false;}return true;}function _deviceValidation(){DeviceCookieInit();return deviceSettings.ValidateAll(true);}function _setDeviceLabels(){DeviceCookieInit();return deviceSettings.ApplyLabels();}function DeviceSettings(a){this.Config=a==null?{PrevURL:prevURL,PathId:giPathID}:a;this.PathId=this.Config.PathId;this.DeviceCookieName="devices_"+this.PathId;this.Settings=null;this.PLACEMENT_LIGHTBOX="-1";this.IsEoForm=false;this.IsSummaryTab=false;}DeviceSettings.prototype.Load=function(){this.DeviceStrategy.Load();};DeviceSettings.prototype.Save=function(){this.DeviceStrategy.Save();};DeviceSettings.prototype.Upgrade=function(){if(this.HasSlots){var a=false;this.ForEach(function(e,f,b,d){if(typeof b.position=="undefined"||!b.position){b.allowReload=false;b.position="-2";a=true;}});if(a){this.Save();}}};DeviceSettings.prototype.CanShowOnLoadImage=function(){if(!this.HasSlots){return !this.Settings.OnLoadDevicesViewed;}var b=this;var a=!this.Settings.OnLoadDevicesViewed;this.ForEach(function(f,g,d,e){if(d.position==b.PLACEMENT_LIGHTBOX&&(d.allowReload||(d.isRequired&&!d.isActionTaken))){a=true;}});return a;};DeviceSettings.prototype.HasOnLoadContests=function(){var b=this;var a=false;this.ForEach(function(f,g,d,e){if(d.position==b.PLACEMENT_LIGHTBOX){a=true;}});return a;};DeviceSettings.prototype.GetDeviceByIndex=function(b,a){return this.Settings.Slots[b].Devices[a];};DeviceSettings.prototype.GetDeviceByElementId=function(d){var b=$(d).closest(".device");var a=b.attr("deviceid");var e=null;this.ForEach(function(h,i,f,g){if(f.id==a){e=f;}});return e;};DeviceSettings.prototype.GetAddonContestById=function(a){var b=null;this.ForEach(function(f,g,d,e){if(d.id==a){b=d;}});return b;};DeviceSettings.prototype.GetDeviceTypeFromStepDeviceId=function(e){var a="";if(this.HasAddOnContest()){this.ForEach(function(h,i,f,g){if(f.id==e){a="addon";}});}if(a==""&&this.HasSlps()){for(var b=0;b<this.Settings.Slps.length;b++){var d=this.Settings.Slps[b];if(d.Id==e){a="slp";break;}}}return a;};DeviceSettings.prototype.ActivateDevice=function(d,b){var a=this.GetDeviceByIndex(d,b);a.isActionTaken=true;};DeviceSettings.prototype.ActivateContestByIndexTag=function(e,d,a){var b=this.GetDeviceByIndex(e,d);b.isActionTaken=true;this.ActivateDeviceContestTag(b,a);};DeviceSettings.prototype.ActivateContestByIndexes=function(e,d,a){var b=this.GetDeviceByIndex(e,d);b.isActionTaken=true;b.Contests[a].IsActive=true;};DeviceSettings.prototype.ActvateContestByElementId=function(b,a){this.DeviceStrategy.ActvateContestByElementId(b,a);};DeviceSettings.prototype.ActivateDeviceContestTag=function(d,b){var a=d.Contests;for(var e=0;e<a.length;e++){if(a[e].Tag==b){a[e].IsActive=true;break;}}};DeviceSettings.prototype.SetDeviceRequiredMsg=function(e,b,d){var a=this.GetDevice(e,b);a.RequiredMessage=d;};DeviceSettings.prototype.HasSlps=function(){if(typeof this.Settings!="undefined"&&this.Settings){if(typeof this.Settings.Slps!="undefined"&&this.Settings.Slps&&this.Settings.Slps.length>0){return true;}}return false;};DeviceSettings.prototype.HasAddOnContest=function(){var a=false;this.ForEach(function(e,f,b,d){if(b.deviceName=="Add-On Contest"){a=true;}});return a;};DeviceSettings.prototype.UpdateSLPLightbox2Status=function(a,d){var b=deviceSettings.GetSlpByDeviceId(d);if(b){b.SlpLightbox2Viewed=a;this.Save();}};DeviceSettings.prototype.UpdateSLPLightbox3Status=function(a,d){var b=deviceSettings.GetSlpByDeviceId(d);if(b){b.SlpLightbox3Viewed=a;this.Save();}};DeviceSettings.prototype.IsSLPLigthbox2Viewed=function(b){var a=deviceSettings.GetSlpByDeviceId(b);if(!a){return false;}return a.SlpLightbox2Viewed?true:false;};DeviceSettings.prototype.IsSLPLigthbox3Viewed=function(b){var a=deviceSettings.GetSlpByDeviceId(b);if(!a){return false;}return a.SlpLightbox3Viewed?true:false;};DeviceSettings.prototype.GetSlpByDeviceId=function(d){if(!this.Settings||!this.Settings.Slps||!this.Settings.Slps.length||!d){return null;}for(var a=0;a<this.Settings.Slps.length;a++){var b=this.Settings.Slps[a];if(b.Id===d){return b;}}};DeviceSettings.prototype.ForEach=function(a){if(!this.Settings||!this.Settings.Slots||!this.Settings.Slots.length){return;}for(var e=0;e<this.Settings.Slots.length;e++){var f=this.Settings.Slots[e];for(var d=0;d<f.Devices.length;d++){var b=f.Devices[d];if(typeof a==="function"){a(f,e,b,d);}}}return true;};DeviceSettings.prototype.ValidateAll=function(f){var e="";var h=this;var d=true;var g=this;var a=0;var b=$("#eoDeviceContestLabels li");this.ForEach(function(o,p,j,k){if(j.isRequired&&!j.isActionTaken){if(d){alert(j.strRequiredMessage);d=false;if(f&&g.IsEoForm){_fullOverride=true;var n=h.GetLabelsForDevice(b,j);var i=n[0].children[0];var l=$(i).attr("href");e=l;}else{if(g.IsSummaryTab){e="device_"+j.id;a=j.id;}}}}});if(!d){if(g.IsSummaryTab){DevicesHelper.ScrollToDeviceInSummaryPackage(a);}else{document.location=e;}}return d;};DeviceSettings.prototype.GetDeviceLabel=function(f,b){var a=$("#eoDeviceContestLabels").length>0;var e=a?"eoDeviceContestLabels":"eoContestLabels";var d=$("#"+e+" .deviceLabel");var g=d[f];if(b){g=g.childNodes[0];}return g;};DeviceSettings.prototype.ApplyLabels=function(){return this.DeviceStrategy.ApplyLabels();};DeviceSettings.prototype.HidePathLabels=function(b,d){var a=$("#eoDeviceContestLabels").length>0;var e=PathContests.IsDefaultContest();if(a&&e&&d){$("#eoContestLabels").hide();return;}if(a&&e&&!d){return;}if(d){var f=$("#eoContestLabels")[0].getElementsByTagName("li");var g=PathContests.GetIndexOfPrimary();f[g].style.display="none";}};DeviceSettings.prototype.ConfigureLabel=function(d,h,a,i,g,e){var b="#deviceLabel_"+h;if(e&&e.length){var f=e[h];b="#"+f.id;}if(i){$(b).hide();return;}$(b).addClass(g);if(a){$(b+" a").addClass(g);}};DeviceSettings.prototype.ActivatedContests=function(a){if(a.isActionTaken&&a.Contests.length==1){return{total:1,positions:[0]};}var d={total:0,positions:[]};for(var b=0;b<a.Contests.length;b++){if(a.isActionTaken&&a.Contests[b].IsActive){d.total++;d.positions.push(b);}}return d;};DeviceSettings.prototype.GetLabelsForDevice=function(b,a){var d=[];$(b).each(function(g,f){if(f.children&&f.children.length){var h=f.children[0].href;var e="device_"+a.id;if(h.indexOf(e)>-1){d.push(f);}}});return d;};DeviceSettings.prototype.HideDeviceLabels=function(b,a){$(b).each(function(f,e){if(e.children&&e.children.length){var h=e.children[0].href;var g=h.indexOf("#device_");var d=h.substr(g+1);if(typeof a[d]=="undefined"){$(e).hide();}}});};DeviceSettings.prototype.GetAddOnVariablesBasedOnDeviceId=function(d,f){var a={};if(isNaN(d)){return a;}var e=SpectrumDeviceManager.FindPathDeviceModelById(d);if(!e){return a;}var b=e.Contests;if(!b){return a;}return deviceSettings.ExtractVariablesFromDeviceModel(b,f);};DeviceSettings.prototype.GetContentVariablesBasedOnDeviceId=function(d,f){var b={};if(isNaN(d)){return b;}var e=SpectrumDeviceManager.FindPathDeviceModelById(d);if(!e){return b;}var a=e.ContentVariables;if(!a){return b;}return deviceSettings.ExtractVariablesFromDeviceModel(a,f);};DeviceSettings.prototype.ExtractVariablesFromDeviceModel=function(b,a){var e={};var d={};$.each(b,function(){var f=this;if((a&&f.Tag!=a)||!f.Attributes){return true;}$.each(f.Attributes,function(){e[this.Name]=this.Value;});if(a){return false;}d[f.Tag]=$.extend({},e);return true;});return a?e:d;};var mpCookie={read:function(g,i){var d;d={returnUrl:"",tab:0,offers:[]};var h="mpCart_"+g;if(getNameVal(h,"returnUrl",i)){d.returnUrl=getNameVal(h,"returnUrl",i);}if(getNameVal(h,"tab",i)){d.tab=parseInt(getNameVal(h,"tab",i));}if(GetCookie(h)){var a=GetCookie(h).split(i);a.pop();var b,j;for(var f=2;f<a.length;f++){b=a[f].toString().split("~");var e={cartText:b[0].toString().replace("mpCookieInfo"+(f-2)+"=",""),pchPrice:b[1],qtrPrice:b[2],offerCode:b[3],sortIndex:0,productType:""};if(b.length>4){e.sortIndex=b[4];e.productType=b[5];}d.offers.push(e);}}return d;},write:function(d,e,g,a,f){DeleteCookie("mpCart_"+d);setNameVal("mpCart_"+d,"returnUrl",e,f);setNameVal("mpCart_"+d,"tab",g,f);for(var b=0;b<a.length;b++){setNameVal("mpCart_"+d,"mpCookieInfo"+b,a[b],f);}return false;}};var AbandonedCartServiceHelper={CreateDefaultAbandonedCartRequestDto:function(){var b=window.pathData.Id;if(!b){return null;}var a={PathId:b,OfflineMailingId:0,Application:null,Client:null,IpAddress:null,Source:null,CustomerData:null,Items:null};a.Source=AbandonedCartServiceHelper.GetAbandonedCartSourceData();a.CustomerData=AbandonedCartServiceHelper.GetAbandonedCartCustomerData();a.Items=[];if(!a.Source||!a.CustomerData){return null;}return a;},CreateAbandonedCartRequestDto:function(b,d){var e=window.pathData.Id;if(!e){return null;}var a={PathId:e,OfflineMailingId:window.pathData.CurrentStep.OfflineMailingId,Application:null,Client:null,IpAddress:null,Source:null,CustomerData:null,Items:null};a.Source=AbandonedCartServiceHelper.GetAbandonedCartSourceData();a.CustomerData=AbandonedCartServiceHelper.GetAbandonedCartCustomerData();a.Items=[];b.Action=d;a.Items.push(b);if(!a.Source||!a.CustomerData||!a.Items){return null;}return a;},GetAbandonedCartSourceData:function(){var a={TrackingToken:window.trackingToken,SourceCode:null,ForeignSource:null,EmailVendorId:window.tokenSourceType,OriginatingUrl:window.location.href,PlacementName:null};return a;},GetAbandonedCartCustomerData:function(){if(!window.SpectrumRegistrationResponseDto&&!window.SpectrumRegistrationResponseDto.SpectrumCustomer){return null;}var a={GlobalMemberToken:window.SpectrumRegistrationResponseDto.SpectrumCustomer.UserInternal.GlobalMemberToken,BillingAddressId:window.SpectrumRegistrationResponseDto.SpectrumCustomer.User.AddressId,ShippingAddressId:window.SpectrumRegistrationResponseDto.SpectrumCustomer.User.AddressId,IsTestOrder:null};return a;},GetAbandonedCartItemFromCookie:function(){var b=window.GetCookie("mpCart_"+window.pathData.Id);if(!b){return null;}var a=$.parseJSON(b);if(!a){return null;}return a.Items;}};(function(g){function f(){this.Config={ServiceUrl:window.baseUrl+"Proxies/AbandonedCartServiceProxy.aspx",IsSwitchedOn:window.IsAbandonedCartSwitchOn};this.Urls={SaveCart_Url:"?methodName=SaveCart",FetchAbandonedCartForDeviceByGmt_Url:"?methodName=FetchAbandonedCartForDeviceByGmt"};this.SaveCart=function(l,h,i){if(!this.Config.IsSwitchedOn){return;}var k=this;if(window.SpectrumUtils){window.SpectrumUtils.ShowProcessingLayer();}var j=AbandonedCartServiceHelper.CreateAbandonedCartRequestDto(h,i);if(!j){if(window.SpectrumUtils){window.SpectrumUtils.HideProcessingLayer();}return;}var n=this.Config.ServiceUrl+"?methodName=SaveCart";d(n,j,true,"SaveCart",this.OnSaveCartByGmtSuccess,this.OnSaveCartByGmtFailure,this.OnSaveCartByGmtComplete,k);};this.OnSaveCartByGmtSuccess=function(h){if(window.SpectrumUtils){window.SpectrumUtils.HideProcessingLayer();}};this.OnSaveCartByGmtFailure=function(h,i,j){if(window.SpectrumUtils){window.SpectrumUtils.HideProcessingLayer();}};this.OnSaveCartByGmtComplete=function(h,i){if(window.SpectrumUtils){window.SpectrumUtils.HideProcessingLayer();}};this.FetchAbandonedCartForDeviceByGmt=function(i,h){if(!this.Config.IsSwitchedOn){return;}var j=this;if(window.SpectrumUtils){window.SpectrumUtils.ShowProcessingLayer();}var k=this.Config.ServiceUrl+"?methodName=FetchAbandonedCartForDeviceByGmt";d(k,i,true,"FetchAbandonedCartForDeviceByGmt",h,j.OnFetchAbandonedCartForDeviceByGmtFailure,j.OnFetchAbandonedCartForDeviceByGmtComplete,j);};this.OnFetchAbandonedCartForDeviceByGmtSuccess=function(h){return h;};this.OnFetchAbandonedCartForDeviceByGmtFailure=function(h,i,j){console.log(i+" : "+j);};this.OnFetchAbandonedCartForDeviceByGmtComplete=function(h,i){if(window.SpectrumUtils){window.SpectrumUtils.HideProcessingLayer();}};}function d(q,h,k,l,p,j,i,o){var n=k?q:q+e(h,l,o);k?b(n,h,p,j,i):a(n,p,j,i);}function e(h,l,k){var j=window.SpectrumUtils.ParamsToUrl(h);var i=k.Urls[l+"_Url"];return i+"&"+j;}function b(k,h,l,j,i){$.ajax({url:k,success:l,type:"POST",data:$.toJSON(h),contentType:"application/json",error:j,complete:i});}function a(j,k,i,h){$.ajax({url:j,success:k,type:"GET",contentType:"application/json",error:i,complete:h});}g.SpectrumAbandonedCartService=f;}(window));var CartConstants={PRODUCT_TYPE_SLP:"slp",MAXIMUM_CART_ITEMS:3};function Cart(){this.Path=window.pathData.Id;this.DataProvider=GetSpectrumCartProvider(window.pathData.Id);this.Items.length=0;this.OrderLimit=window.SpectrumRegistrationCore.GetOrderLimit();CartConstants.MAXIMUM_CART_ITEMS=this.OrderLimit;}Cart.prototype.Items=new Array();Cart.prototype.ComponentName="Cart";Cart.prototype.DataProvider=null;Cart.prototype.OnAction=null;Cart.prototype.OnActionCompleted=null;Cart.prototype.OnError=null;Cart.prototype.ReturnUrl=null;Cart.prototype.TabSeen=0;Cart.prototype.Path="";Cart.prototype.UNLIMITEDSIZE=-1;Cart.prototype.HasSeenEO=false;Cart.prototype.OrderLimit=0;Cart.prototype.Init=function(d,e,f,a,b){this.ReturnUrl=e;this.Path=d;this.TabSeen=f;this.HasSeenEO=false;if(b){this.Load();}};Cart.prototype.LoadFromCookie=function(a){var b=this;if(b.DataProvider){b.DataProvider.Load(a,b);}if(IsEo()){b.HasSeenEO=true;}};Cart.prototype.IsEmpty=function(){return this.Count()==0;};Cart.prototype.IsLimitedStorage=function(){return this.OrderLimit!=this.UNLIMITEDSIZE;};Cart.prototype.IsAtLimit=function(){if(!this.IsLimitedStorage()){return false;}return this.CountOrderable()>=this.OrderLimit;};Cart.prototype.Load=function(){this.LoadWithOptions(true,this.Path);};Cart.prototype.LoadFromVariable=function(b){var a=this;this.TryLog(function(){a.DataProvider.LoadFromVariable(a.Path,a,b);});};Cart.prototype.LoadWithOptions=function(a,d){var b=this;this.TryLog(function(){var e=b.ReturnUrl;b.DataProvider.Load(d,b);if(a){if(b.ReturnUrl==null||b.ReturnUrl==""||b.ReturnUrl==undefined||b.ReturnUrl=="undefined"){b.ReturnUrl=e;b.Save();}}b.Sort();});};Cart.prototype.Save=function(){var a=this;this.TryLog(function(){a.Sort();a.DataProvider.Save(a.Path,a);});};Cart.prototype.Sort=function(){if(!this.Items||this.Items.length==0){return;}this.Items.sort(function(d,e){return d.SortIndex-e.SortIndex;});};Cart.prototype.Add=function(a){this.AddItem(this.ToItem(a));};Cart.prototype.AddItem=function(a){if(this.IsAtLimit()&&a.IsAddedToCartTotal()){if(this.OnError!=null){this.OnError(this,"LIMIT_SIZE_REACHED;"+a);}return;}this.Items.push(a);this.Sort();this.Save();if(this.OnActionCompleted!=null){this.OnActionCompleted(this,"added");}};Cart.prototype.Remove=function(){this.RemoveAt(this.Items.length-1);};Cart.prototype.RemoveAll=function(){this.Items.length=0;this.Save();if(this.OnActionCompleted!=null){this.OnActionCompleted(this,"removed");}};Cart.prototype.RemoveAt=function(a){if(a<0||a>=this.Items.length){return;}this.Items.splice(a,1);this.Sort();this.Save();if(this.OnActionCompleted!=null){this.OnActionCompleted(this,"removed");}};Cart.prototype.RemoveExtra=function(e){var a=this.HasSlps();if(!a){this.Items.splice(e,this.Items.length-e);return;}var b=this.Items.length-1;var d=e;this.Items.splice(d,b-e);};Cart.prototype.HasSlps=function(){var b=this.TotalProductTypes(CartConstants.PRODUCT_TYPE_SLP);var a=b>0;return a;};Cart.prototype.IsSlp=function(a){if(a.ProductType==CartConstants.PRODUCT_TYPE_SLP){return true;}return false;};Cart.prototype.RemoveById=function(a){var b=this.ToItem(a);this.RemoveItem(b);};Cart.prototype.RemoveItem=function(d){var a=typeof d=="string"?this.ToItem(d):d;var b=this.GetIndexOfItem(a);this.RemoveAt(b);};Cart.prototype.Count=function(){return this.Items.length;};Cart.prototype.CountOrderable=function(){if(this.Items.length==0){return 0;}var d=0;for(var b=0;b<this.Items.length;b++){var a=this.Items[b];if(!this.IsSlp(a)){d++;}}return d;};Cart.prototype.GetTotalOrderableItems=function(){return this.CountOrderable();};Cart.prototype.TotalProductTypes=function(d){if(!this.Items||this.Items.length==0){return 0;}var e=0;for(var b=0;b<this.Items.length;b++){var a=this.Items[b];if(a.ProductType==d){e++;}}return e;};Cart.prototype.SubTotal=function(){var a=0;this.ForEachItem(true,function(b){a+=b.Price;});return a;};Cart.prototype.ForEachItem=function(e,a){if(this.Items.length==0){return;}for(var d=0;d<this.Items.length;d++){var b=this.Items[d];if(!e){a(b);}else{if(b.IsAddedToCartTotal()){a(b);}}}};Cart.prototype.Contains=function(a){var b=this.GetIndexOfItemUsingId(a);return b>=0;};Cart.prototype.GetIndexOfItem=function(a){return this.GetIndexOfItemUsingId(a.Id);};Cart.prototype.GetIndexOfItemUsingId=function(a){var b=-1;for(var d=0;d<this.Items.length;d++){if(this.Items[d].Id==a){b=d;break;}}return b;};Cart.prototype.GetItemUsingId=function(a){var b=this.GetIndexOfItemUsingId(a);if(b==-1){return null;}return this.Items[b];};Cart.prototype.ToItem=function(b){if(b==null){return null;}var d=b.split(",");var a=new CartItem();a.Id=d.length>=1?d[0]:"";a.Name=d.length>=2?d[1]:"";a.Price=d.length>=3?d[2]:0;a.QPrice=d.length>=4?d[3]:0;return a;};Cart.prototype.GetState=function(){var a=this.IsLimitedStorage()?this.OrderLimit:"Unlimited";var d="Count : "+this.Items.length+"<br/>Path : "+this.Path+"<br/>ReturnUrl : "+this.ReturnUrl+"<br/>TabSeen   : "+this.TabSeen+"<br/>LimitSize : "+a+"<br/>Items : <br/>";for(var b=0;b<this.Items.length;b++){d+=this.Items[b].toString()+"<br/>";}return d;};Cart.prototype.HandleAction=function(b){var g=b.split(";");var a=g[0];if(a=="add"){var e=g[1];this.Add(e);}else{if(a=="removebyid"){var d=g[1];this.RemoveById(d);}else{if(a=="removeat"){var f=g[1];this.RemoveAt(f);}else{if(a=="remove"){this.RemoveItem(g[1]);}}}}};Cart.prototype.TryLog=function(a){try{a();}catch(b){try{console.error(b);}catch(d){}}};function GroupOfferInfo(){}GroupOfferInfo.prototype.LineupId=0;GroupOfferInfo.prototype.MailId=0;GroupOfferInfo.prototype.Offer="";GroupOfferInfo.prototype.Group="";GroupOfferInfo.prototype.PriceSettings=null;GroupOfferInfo.prototype.Load=function(e,a,b,d,f){this.LineupId=b;this.MailId=d;this.Offer=e;this.Group=a;this.PriceSettings=f;};function CartItem(){}CartItem.prototype.Id="";CartItem.prototype.Name="";CartItem.prototype.Description="";CartItem.prototype.Price=0;CartItem.prototype.QPrice=0;CartItem.prototype.ProductType="";CartItem.prototype.SortIndex=0;CartItem.prototype.Shipping=0;CartItem.prototype.Step="";CartItem.prototype.Tab="";CartItem.prototype.TabName="";CartItem.prototype.OfferTypeId=0;CartItem.prototype.Source="";CartItem.prototype.Quantity=1;CartItem.prototype.ShouldShowQuantity=false;CartItem.prototype.MailId=0;CartItem.prototype.RefId=0;CartItem.prototype.GroupOfferInfo=new GroupOfferInfo();CartItem.prototype.PriceSettings=null;CartItem.prototype.GroupId=0;CartItem.prototype.GroupSource="";CartItem.prototype.IsAddedToCartTotal=function(){return(this.ProductType!=CartConstants.PRODUCT_TYPE_SLP);};CartItem.prototype.toString=function(){return this.Id+", "+this.Name+", "+this.Description+this.Price+", "+this.QPrice;};function CartDataProviderCookieBasedJsonFormat(b,a){this.PathId=b;this.CookieName=a;this.Save=function(j,d){var l={ReturnUrl:d.ReturnUrl,TabSeen:d.TabSeen,Items:[],Ct:d.Ct||window.SERVER_UXTIMESTAMP,HasSeenEO:d.HasSeenEO};if(d.StepSeen){l.StepSeen=d.StepSeen;}for(var i=0;i<d.Items.length;i++){var k=d.Items[i];var g=k.Name.replace("<br />","");g=g.replace("<br/>","");var h=[k.Id,g,k.Price,k.ProductType,k.QPrice,k.Shipping,k.SortIndex,k.Step,k.Tab,k.TabName,k.OfferTypeId,k.Quantity,k.ShouldShowQuantity,k.RefId,k.MailId];l.Items.push(h);}var e=$.toJSON(l);var f="/";document.cookie="mpCart_"+d.Path+"=;expires=Thu, 01 Jan 1970 00:00:01 GMT";SpectrumCookies.Set("mpCart_"+d.Path,e,null,f,window.globalDomainName);};this.Load=function(f,d){var g=SpectrumCookies.Get("mpCart_"+d.Path);var e=null;if(g==null||g==""){e={ReturnUrl:"",TabSeen:0,Items:[],Ct:0,HasSeenEO:false};}else{e=$.parseJSON(g);}return this.LoadFromVariable(f,d,e);};this.LoadFromVariable=function(l,d,g){d.ReturnUrl=g.ReturnUrl;d.StepSeen=g.StepSeen;d.TabSeen=g.TabSeen;d.Path=l;d.Items.length=0;d.Ct=g.Ct;d.HasSeenEO=g.HasSeenEO;var f={Id:0,Name:1,Price:2,Type:3,QPrice:4,Shipping:5,Sort:6,Step:7,Tab:8,TabName:9,OfferTypeId:10,Quantity:11,ShouldShowQuantity:12,RefId:13,MailId:14};var e=[];for(var j=0;j<g.Items.length;j++){var h=new CartItem();h.Id=g.Items[j][f.Id];h.Name=g.Items[j][f.Name];var n=g.Items[j][f.Price];h.Price=(n&&typeof n==="string")?parseFloat(n):n;h.ProductType=g.Items[j][f.Type];var o=g.Items[j][f.QPrice];h.QPrice=(o&&typeof o==="string")?parseFloat(o):o;var r=g.Items[j][f.Shipping];h.Shipping=(r&&typeof r==="string")?parseFloat(r):r;var t=g.Items[j][f.Sort];h.SortIndex=(t&&typeof t==="string")?parseInt(t):t;h.Step=g.Items[j][f.Step];h.Tab=g.Items[j][f.Tab];if(g.Items[j][f.TabName]){h.TabName=g.Items[j][f.TabName];}var k=g.Items[j][f.OfferTypeId];if(k){h.OfferTypeId=(k&&typeof k==="string")?parseInt(k):k;}var p=g.Items[j][f.Quantity];if(p){h.Quantity=(p&&typeof p==="string")?parseInt(p):p;}var s=g.Items[j][f.ShouldShowQuantity];if(s){h.ShouldShowQuantity=(s&&typeof s==="string")?s=="true"?true:false:s;}var q=g.Items[j][f.RefId];if(q){h.RefId=(q&&typeof q==="string")?parseInt(q):q;}var i=g.Items[j][f.MailId];if(i){h.MailId=(i&&typeof i==="string")?parseInt(i):i;}e.push(h);}d.Items=e;return d;};this.DecodeEscapedUnicode=function(e){var d=/\\u([\d\w]{4})/gi;e=e.replace(d,function(g,f){return String.fromCharCode(parseInt(f,16));});return e;};}var CartControllerFactory={CreateDefault:function(){var a={DisplayPriceText:"PCH Price"};window._cartStore=window._cartStore||new Cart();window._cartRenderer=new CartRenderer(window._cartStore,a,"mpCartSubWrap","mpCartCount");window._cart=new CartController(a,null,window._cartStore,window._cartRenderer);return window._cart;},CreateEoCart:function(){window._cartStore=new Cart();window._cart=new window.EoCartController(window._cartStore);return window._cart;},CreateAbandonedCartDeviceController:function(f,b,d,h){var g={DisplayPriceText:"PCH Price"};window._cartStore=window._cartStore||new Cart();var i=window.spectrumDeviceType==="MOBILE"?"itemOrderedList":"abndCartSubWrap";var a=window.spectrumDeviceType==="MOBILE"?"AbnCrtMblCartItems":"abndCartCount";window._cartRenderer=new f(g,window._cartStore,i,a,d,h);var e=new b(g,window._cartStore,new CartController(g,null,window._cartStore,window._cartRenderer),window._cartRenderer);window._cart=e;return window._cart;}};function EoCartController(a){var b={DisplayPriceText:"PCH Price"};this.Cart=a;this.CartController=new CartController(b,null,window._cartStore,new CartRenderer(window._cartStore,b,"mpCartSubWrap","mpCartCount"));this.AbandonedCartService=this.CartController.AbandonedCartService;}EoCartController.prototype.ComponentName="EoCartController";EoCartController.prototype.DisplayItems=function(){if(!this.CartRenderer){return;}var a=this.Cart;this.CartRenderer.DisplayItemsAndCount(a);};EoCartController.prototype.ReturnUrl=function(){var a=this;return a.Cart.ReturnUrl;};EoCartController.prototype.TabSeen=function(){var a=this;return a.Cart.TabSeen;};EoCartController.prototype.Items=function(){var a=this;return a.Cart.Items;};EoCartController.prototype.GetTotalOrderableItems=function(){var a=this;return a.Cart.CountOrderable();};EoCartController.prototype.RemoveExtra=function(a){var b=this;b.Cart.RemoveExtra(a);};EoCartController.prototype.RemoveAt=function(b,a){var d=this;d.Cart.RemoveAt(b);if(d.AbandonedCartService){d.AbandonedCartService.SaveCart(d,a,"Delete");}};EoCartController.prototype.Save=function(a){var b=this;b.Cart.Save();if(b.AbandonedCartService&&a){b.AbandonedCartService.SaveCart(b,a,"Update");}};EoCartController.prototype.HasSlps=function(){var a=this;return a.Cart.HasSlps();};EoCartController.prototype.AddNativeOffer=function(b,a){return this.CartController.AddNativeOffer(b,a);};EoCartController.prototype.RefreshEoFormCart=function(){this.CartController.RefreshEoFormCart();};EoCartController.prototype.RemoveById=function(d,a,b){this.CartController.RemoveById(d,a,b);};function CartController(f,e,d,b){this.Settings=f;this.Products=e;this.Cart=d;this.Resx=new Resources(MultiPageResourceStrings.Cart);this.CartRenderer=b;this.AbandonedCartService=window.SpectrumAbandonedCartService?new window.SpectrumAbandonedCartService():null;this.SpectrumFusionService=window.SpectrumFusionService?new window.SpectrumFusionService():null;var a=this;this.CartRenderer.TemplateFetcher=function(g){return a.CartItemTemplates[g];};this.Cart.OnError=function(h,g){a.OnCartError(h,g);};}CartController.prototype.ComponentName="CartController";CartController.prototype.Settings={};CartController.prototype.Products=null;CartController.prototype.Cart=null;CartController.prototype.Resx=null;CartController.prototype.CartRenderer=null;CartController.prototype.OnError=null;CartController.prototype.OnActionCompleted=null;CartController.prototype.OnActionRequested=null;CartController.prototype.OnClickCartItemCallbacks={};CartController.prototype.CartItemTemplates={};CartController.prototype.Init=function(d,e,g,a,b){this.Cart.Init(d,e,g,a,b);var f=this;if(b){Notifications.Notify("on-cart-loaded",f,null);}};CartController.prototype.Save=function(){this.Cart.Save();};CartController.prototype.AddById=function(f,b,h,a){var d;var e=adUnits_getGroupSource(f);if(e=="fusion"){d=this.SpectrumFusionService.FindGroupOfferInfoByOfferCode(f,a);}else{d=this.FindGroupOfferInfoByOfferCode(f);}if(d){d.Offer.Quantity=h;var g=this.AddOffer(d,b);return g;}return false;};CartController.prototype.FindGroupOfferInfoByOfferCode=function(g){var f=this.Products.Offer(g);var i=window.ProductAdminService.FindUiElement(function(n){if(!n||!n.OfferGroup){return false;}if(!n.OfferGroup.Offers){return false;}for(var j=0,k=n.OfferGroup.Offers.length;j<k;j++){var l=n.OfferGroup.Offers[j];if(g===jQuery.trim(l.OfferCode)){return true;}}return false;});var a=i?i.OfferGroup:null;var d=(window.pathData&&window.pathData.CurrentStep&&window.pathData.CurrentStep.LineupId)?window.pathData.CurrentStep.LineupId:null;var e=(window.pathData&&window.pathData.CurrentStep&&window.pathData.CurrentStep.OfflineMailingId)?window.pathData.CurrentStep.OfflineMailingId:null;var h=window.ProductAdminService.getPriceSettingsFromRuntimeDto();if(!f||!a){return null;}var b=new GroupOfferInfo();b.Load(f,a,d,e,h);return b;};CartController.prototype.AddNativeOffer=function(b,a){if(!b.Offer){return;}b.Offer.Code=SpectrumUtils.Trim(b.Offer.OfferCode);b.Offer.Name=b.Offer.CartText;b.Offer.Price=b.Offer.PCHPrice;b.Offer.QPrice=b.Offer.QuarterPartPay;return this.AddOffer(b,a);};CartController.prototype.AddOffer=function(e,d){var b=new CartItem();b.Id=e.Offer.Code;b.Name=e.Offer.Name;b.Price=e.Offer.Price;b.QPrice=e.Offer.QPrice;b.OfferTypeId=e.Offer.OfferTypeId;b.Quantity=e.Offer.Quantity?e.Offer.Quantity:1;b.Source=e.Offer.Source;e.Offer.PCHPrice=e.Offer.Price;b.ShouldShowQuantity=adUnits_shouldDisplayQuantity(e.Offer,e.Group);var f=e.Group.GroupSource?e.Group.GroupSource:adUnits_getGroupSource(e.Offer.Code);b.RefId=e.Offer.RefId?e.Offer.RefId:0;b.LineupId=e.LineupId;b.MailId=e.MailId;b.PriceSettings=e.PriceSettings;b.GroupId=e.Group.Id;b.GroupSource=e.Group.GroupSource;b.MajorCategory=adUnits_GetMajorCategory(e);var g=this.AddItem(b,d);if(g&&f=="fusion"){var a={eventLabel:" AddToCart/"+e.Offer.Name,eventType:"buttonClick"};Notifications.Notify("on-fusion-product-tab-render-or-item-added",self,a);}return g;};CartController.prototype.AddItem=function(cartItem,doNotReassignHandler){var self=this;try{if(this.Cart.IsAtLimit()&&cartItem.IsAddedToCartTotal()){alert(this.Resx.Get("OrderLimitReached"));Notifications.Notify("onCartLimitReached",null,null);return false;}if(window.pathData){cartItem.Step=window.pathData.CurrentStep.Name;if(window._tab){cartItem.Tab="tab"+this.GetTabIndexOfProduct(cartItem.Id);if(window._tab.TabLinksTop&&window._tab.TabLinksTop.CurrentTabName){cartItem.TabName=window._tab.TabLinksTop.CurrentTabName;}}}var optimizedCartItem=this.OptimizeCartItemForCookie(jQuery.extend(true,{},cartItem));this.Cart.AddItem(optimizedCartItem);var func=null;if(!doNotReassignHandler){eval("func = function() { _cart.RemoveById('"+cartItem.Id+"', false, null); return false; };");}AdUnitHelper.UpdateCartLink("Add",cartItem.Id,func);this.SetQuantityDropdownVisibility(cartItem,false);if(this.AbandonedCartService){this.AbandonedCartService.SaveCart(self,cartItem,"Insert");}this.Notify("added",cartItem);Notifications.Notify("on-cart-item-added",self,cartItem);return true;}catch(e){alert(e.message);return false;}};CartController.prototype.OptimizeCartItemForCookie=function(a){if(a.GroupSource=="fusion"){if(a.RefId>0){a.MailId=0;}}else{a.MailId=0;a.RefId=0;}return a;};CartController.prototype.Remove=function(b){var a=this.Cart.ToItem(b);return this.RemoveById(a.Id,true);};CartController.prototype.RemoveById=function(offerId,confirmRemoval,doNotReassignHandler){try{var cartItem=this.Cart.GetItemUsingId(offerId);if(cartItem==null){return false;}var cartText=MpUtils.ConvertCharEntities(cartItem.Name);if(confirmRemoval){var msg=this.Resx.Format("ConfirmRemove",[cartText]);if(!confirm(msg)){return false;}}this.Cart.RemoveItem(cartItem);var func=null;if(!doNotReassignHandler){eval("func = function() { _cart.AddById('"+offerId+"', false, adUnits_getQuantityValue($('#offerQuantity_"+offerId+"')), adUnits_getDeviceplacementId('cartItemLink_"+cartItem.Id+"')); return false; };");}AdUnitHelper.UpdateCartLink("Remove",offerId,func);this.SetQuantityDropdownVisibility(cartItem,true,confirmRemoval);var self=this;if(this.AbandonedCartService){this.AbandonedCartService.SaveCart(self,cartItem,"Delete");}this.Notify("removed",cartItem);Notifications.Notify("on-cart-item-removed",self,cartItem);return true;}catch(e){alert(e.message);}};CartController.prototype.GetTabIndexOfProduct=function(e){var g=$(".offer");var a=0;if(!g||g.length==0){return a;}var h=null;for(var b=0;b<g.length;b++){var d=g[b];var f=$(d).attr("offercode");if(e==f){h=$(d).closest("div .tab");break;}}if(h==null||h.length==0){return a;}var i=h[0].id;var k="tabcontent_";var j=i.substring(i.indexOf(k)+k.length);return parseInt(j)-1;};CartController.prototype.GoToItem=function(b){if(this.OnClickCartItemCallbacks[b]!=null){var a=this.OnClickCartItemCallbacks[b];a(b);return;}this.RequestAction("goToItem",{offerId:b});};CartController.prototype.RegisterOnCartItemClickCallback=function(b,a){this.OnClickCartItemCallbacks[b]=a;};CartController.prototype.RegisterCartItemTemplate=function(a,b){this.CartItemTemplates[a]=b;};CartController.prototype.RefreshEoFormCart=function(){if(IsEo()&&window.EOHelper){fCartCount();}};CartController.prototype.OnCartError=function(b,a){if(this.OnError!=null){this.OnError(this,a);}};CartController.prototype.Notify=function(a,b){if(this.OnActionCompleted!=null){this.OnActionCompleted(this,a);}};CartController.prototype.RequestAction=function(a,b){if(this.OnActionRequested!=null){this.OnActionRequested(this,a,b);}};CartController.prototype.Display=function(a){this.CartRenderer.Display();};CartController.prototype.ChangeOrderLimit=function(a){};CartController.prototype.Count=function(){return this.Cart.Count();};CartController.prototype.GetIndexOfItemUsingId=function(a){return this.Cart.GetIndexOfItemUsingId(a);};CartController.prototype.ModifyOffer=function(k,b,e){var d=this;var a=d.Cart.GetItemUsingId(b);if(a==null){return;}var h=$(k);var i=h.data("orgValue");var j=parseInt(h.safeVal());if(j<=0){setTimeout(function(){var l=_cart.RemoveById(b,true);if(!l){h.safeVal(i);}else{h.data("orgValue",null);}},300);return;}h.data("orgValue",j.toString());a.Quantity=j;if(!e){e=".mpCartItem";}var f=h.closest(e).next("input[name^='OrderItem_']");var g=a.Id+"^"+a.Name+"^"+a.Price+"^"+a.Quantity+"^"+a.RefId+"^"+a.MailId;f.safeVal(g);this.Save();if(this.AbandonedCartService){this.AbandonedCartService.SaveCart(self,a,"Update");}};CartController.prototype.SetQuantityDropdownVisibility=function(a,d,b){var e=$("#offerQuantity_"+a.Id);var f=e.closest(".offercap-middle");d?f.removeClass("hidden"):f.addClass("hidden");e.safeVal((a.Quantity&&!b)?a.Quantity.toString():"1");};function CartRenderer(a,e,d,b){this.Cart=a;this.Settings=e;this.CartDivId=d;this.CartCountDivId=b;this.HasEoForm=false;this.HtmlTemplateEmpty="";this.TemplateFetcher=null;this.StrFrmHidden="";this.StrFrmHiddenNoRefId="";this.HtmlTemplateItemWithQuantity='<div id="mpCart_${item.Id}" class="mpCartItem"><div class="mpCartItemLeft"><h4><a href="javascript:void(0)" onclick="javascript:${item.GotoItemJs}" title="${item.Name}">${item.Name}</a></h4><div class="mpCartItemInner"><p class="mpCartPCHPrice">'+this.Settings.DisplayPriceText+' <span>$${item.Price}*</span></p><p class="mpCartFourPay">4 Payments Each Only: <span>$${item.QPrice}*</span></p></div></div><div class="mpCartItemRight"><span class="styled-select-title">QUANTITY:</span><span class="styled-select"><select id="quantity_${item.Id}" onfocus="${item.RecordOrgQty}" onchange="${item.ModifyJs}"><option value="0">0</option><option value="1" {{if item.Quantity == 1 }} selected="selected" {{/if}}>1</option><option value="2" {{if item.Quantity == 2 }} selected="selected" {{/if}}>2</option><option value="3" {{if item.Quantity == 3 }} selected="selected" {{/if}}>3</option></select></span></div></div>';this.HtmlTemplateItem='<div id="mpCart_${item.Id}" class="mpCartItem"><p class="mpCartRemove"><a href="${item.RemoveLink}" onclick="${item.RemoveJs}">remove</a></p><h4><a href="javascript:void(0)" onclick="javascript:${item.GotoItemJs}" title="${item.Name}">${item.Name}</a></h4><p class="mpCartPCHPrice">'+this.Settings.DisplayPriceText+' <span>$${item.Price}*</span></p><p class="mpCartFourPay">4 Payments Each Only: <span>$${item.QPrice}*</span></p></div>';this.BuildRows=function(){var j=this;if(!j.Settings.HasEOForm){j.StrFrmHidden='<input type="hidden" name="OrderItem_${item.Id}" value="${item.Id}^${item.Name}^${item.Price}^${item.Quantity}^${item.RefId}^${item.MailId}"></input>';j.StrFrmHiddenNoRefId='<input type="hidden" name="OrderItem_${item.Id}" value="${item.Id}^${item.Name}^${item.Price}^${item.Quantity}"></input>';}var g="";var f=j.Settings.DisplayPriceText;for(var i=0;i<j.Cart.Items.length;i++){var h=j.Cart.Items[i];var k={};k.QPrice=MpUtils.FormatPrice(h.QPrice);k.Price=MpUtils.FormatPrice(h.Price);k.Id=h.Id;k.Name=h.Name;k.DisplayPriceText=f;k.RemoveLink="javascript:void(0)";k.RemoveJs="_cart.RemoveById('"+h.Id+"', true);return false;";k.RecordOrgQty="if($(this).safeVal() !== '0') $(this).data('orgValue', $(this).safeVal());";k.ModifyJs="_cart.ModifyOffer(this, '"+h.Id+"');return false;";k.GotoItemJs="_cart.GoToItem('"+h.Id+"');return false;";k.Quantity=h.Quantity;k.RefId=h.RefId;k.mailId=h.MailId;var n=j.GetTemplate(i);n="<script type='text/html'>"+n+"</script>";var l=$(n).render({item:k});var o=l.outerHTML();g=g+o;}return g;};this.GetTemplate=function(h){var f=this.Cart.Items[h];if(!f.RefId&&!f.MailId){this.StrFrmHidden=this.StrFrmHiddenNoRefId;}if(this.TemplateFetcher==null){return this.HtmlTemplateItem+this.StrFrmHidden;}var g=this.TemplateFetcher(f.Id);if(g){return g+this.StrFrmHidden;}if(window.isItemQuantityOn&&f.ShouldShowQuantity){return this.HtmlTemplateItemWithQuantity+this.StrFrmHidden;}return this.HtmlTemplateItem+this.StrFrmHidden;};this.Display=function(){if(this.Cart.IsEmpty()){document.getElementById(this.CartDivId).className="mpCartSubWrap mpEmptyCart";document.getElementById(this.CartDivId).innerHTML=this.HtmlTemplateEmpty;document.getElementById(this.CartCountDivId).innerHTML="No Items In Cart";return;}var h=this.Cart.CountOrderable();var f=this.BuildRows();document.getElementById(this.CartDivId).className="mpCartSubWrap";document.getElementById(this.CartDivId).innerHTML=f;var g=h>1?h+" Items In Cart":h+" Item In Cart";document.getElementById(this.CartCountDivId).innerHTML=g;};}function GetSpectrumCartProvider(b){var a="mpCart_"+b;var d=new CartDataProviderCookieBasedJsonFormat(b,a);return d;}function FusionOffer(){}FusionOffer.prototype.Code="";FusionOffer.prototype.Name="";FusionOffer.prototype.Price="";FusionOffer.prototype.QPrice="";FusionOffer.prototype.OfferTypeId="";FusionOffer.prototype.RefId="";FusionOffer.prototype.Load=function(a,b,e,f,d,g){this.Code=a;this.Name=b;this.Price=e;this.QPrice=f;this.OfferTypeId=d;this.RefId=g;};(function(a){var b=a.fn.domManip;a.fn.extend({render:function(d){return this.map(function(e,f){return a.render(f,d);});},domManip:function(d){if(d.length>1&&d[0].nodeType){arguments[0]=[a.makeArray(d)];}if(d.length===2&&typeof d[0]==="string"&&typeof d[1]!=="string"){arguments[0]=[a.render(d[0],d[1])];}return b.apply(this,arguments);}});a.extend({render:function(h,d){var f;if(a.templates[h]){f=a.templates[h];}else{if(h.nodeType){var g=h,e=a.data(g);f=e.tmpl||a.tmpl(g.innerHTML);}}f=f||a.tmpl(h);if(a.isArray(d)){return a.map(d,function(j,k){return f.call(j,a,j,k);});}else{return f.call(d,a,d,0);}},templates:{},tmplcmd:{each:{_default:[null,"$i"],prefix:"jQuery.each($1,function($2){with(this){",suffix:"}});"},"if":{prefix:"if($1){",suffix:"}"},"else":{prefix:"}else{"},html:{prefix:"_.push(typeof $1==='function'?$1.call(this):$1);"},"=":{_default:["this"],prefix:"_.push($.encode(typeof $1==='function'?$1.call(this):$1));"}},encode:function(e){try{return e!=null?document.createTextNode(e.toString()).nodeValue:"";}catch(d){return e;}},tmpl:function(g,d,f){var e=new Function("jQuery","$data","$i","var $=jQuery,_=[];_.data=$data;_.index=$i;with($data){_.push('"+g.replace(/[\r\t\n]/g," ").replace(/\${([^}]*)}/g,"{{= $1}}").replace(/{{(\/?)(\w+|.)(?:\((.*?)\))?(?: (.*?))?}}/g,function(h,l,o,k,i){var n=a.tmplcmd[o];if(!n){throw"Template not found: "+o;}var j=n._default||"";return"');"+n[l?"suffix":"prefix"].split("$1").join(i||j[0]).split("$2").join(k||j[1])+"_.push('";})+"');}return $(_.join('')).get();");return d?e.call(this,a,d,f):e;}});})(jQuery);var SpectrumEvents={IsSpectrumInitialized:false,IsCartInitialized:false,IsUsingNewStyleDevices:false,OnInit:function(b,a){if(!this.IsSpectrumInitialized){if(window.spectrumPathDevices){this.IsUsingNewStyleDevices=true;}if(window.pathData.CurrentStep.IsContestEntry){this.OnContestEntryPage_Init(b,a);}else{this.OnPage_Init(b,a);}SpectrumEvents.CompleteOrderProcessing();SpectrumEvents.DeletePathCookiesIfRequired();this.IsSpectrumInitialized=true;Notifications.Notify("OnInit");}},OnPage_Init:function(e,a){$(window).load(SpectrumEvents.DocumentLoadCompleteHandler);if(window.SpectrumDeviceAnalyzerService){window.SpectrumDeviceAnalyzerService.GetDeviceAttributes();}SpectrumEvents.InitializeSpectrumRegCore();window.pathData.CurrentStep.HasRegistrationControl=window.SpectrumRegistrationCore.IsRegistrationControlPresent();SpectrumUtils.InitializeUniNav();this.InitializeCookies();PathContests.Init();if(typeof window.mpInitVariables==="function"){window.mpInitVariables();}if(window.SpectrumUtils){window.SpectrumUtils.ScrollEvent.Init();}if(window.SpectrumDeviceManager){SpectrumDeviceManager.Initialize();}SetupDeviceLib();var b=IsEo();var d=IsSummaryTab();deviceSettings.IsEoForm=b;deviceSettings.IsSummaryTab=d;if(this.IsUsingNewStyleDevices){this.SubscribeToEventsForNewStyleDevices(b,d);}else{this.SubscribeToEventsForOldStyleDevices(b,d);}if(window.SpectrumAnalyticsHelper){SpectrumAnalyticsHelper.InitAnalytics();}},DocumentLoadCompleteHandler:function(){if(window._multipage&&!window._multipage.MpLoadCompleteNotificationCalled){Notifications.Subscribe("onafter-mpload",function(){NavigationHelper.Navigate();});}else{NavigationHelper.Navigate();}},InitializeSpectrumRegCore:function(){var a={Reg:{Presenter:window.SpectrumRegistrationCore.Presenter,Controller:window.SpectrumRegistrationCore.Controller,ShouldInitializePorthole:true},SignIn:{Presenter:window.SpectrumRegistrationCore.SignInPresenter,Controller:window.SpectrumRegistrationCore.SignInController,ShouldInitializePorthole:false},ForgotPassword:{Presenter:window.SpectrumRegistrationCore.ForgotPasswordPresenter,Controller:window.SpectrumRegistrationCore.ForgotPasswordController,ShouldInitializePorthole:false},N1Message:{Presenter:window.SpectrumRegistrationCore.N1MessagePresenter,Controller:window.SpectrumRegistrationCore.N1MessageController,ShouldInitializePorthole:false},N2Message1:{Presenter:window.SpectrumRegistrationCore.N2Message1Presenter,Controller:window.SpectrumRegistrationCore.N2Message1Controller,ShouldInitializePorthole:false},N2Message2:{Presenter:window.SpectrumRegistrationCore.N2Message2Presenter,Controller:window.SpectrumRegistrationCore.N2Message2Controller,ShouldInitializePorthole:false}};SpectrumRegistrationCore.Initialize(a);},SubscribeToEventsForNewStyleDevices:function(b,d){if(window.SLP){if(b){var a=SpectrumUtils.GetCart();SLP.OnEOInit(this,{cart:a});}else{Notifications.Subscribe("onafter-mpload",function(){SLP.OnProductsPageInit(this,{cart:window._cart});});}}},SubscribeToEventsForOldStyleDevices:function(b,d){var a=(b||d);if(deviceSettings.HasSlps()){if(!b&&window._cart){SLP.Init(window._cart,deviceSettings);}if(a){Notifications.Subscribe("on-spectrum-form-submit",function(){return SLP.OnEOSubmit();},true);}}if(deviceSettings.HasAddOnContest()){if(a){Notifications.Subscribe("on-spectrum-form-submit",function(){return _deviceValidation();},true);}}},OnContestEntryPage_Init:function(b,a){SpectrumRegistrationCore.Initialize();window.pathData.CurrentStep.HasRegistrationControl=window.SpectrumRegistrationCore.IsRegistrationControlPresent();if(window.SpectrumAnalyticsHelper){SpectrumAnalyticsHelper.InitAnalytics();}if(window._billmeEntryId&&window._billmeEntryId>0){window.SpectrumAnalytics.OnContestEntry(SpectrumEvents,{BillmeEntryId:window._billmeEntryId});}},CompleteOrderProcessing:function(){var a=SpectrumUtils.GetBillMeOrderId();if(!SpectrumUtils.HasCartItems()||isNaN(a)){return;}window.SpectrumAnalytics.OnCartOrderComplete(SpectrumEvents,null);try{var d=window.pathData.Id;SpectrumCookies.Delete("order_"+d,"/",window.globalDomainName);SpectrumCookies.Delete("mpCart_"+d,"/",window.globalDomainName);}catch(b){}},OnMultiPage_AfterExecute:function(b,a){Notifications.Notify("on-multipage-after-execute");},OnEOForm_BeforeExecute:function(e,a){this.OnInit();var d=this;if(deviceSettings.HasSlps()){var b=new Cart();b.LoadWithOptions(false,giPathID);SLP.Init(b,deviceSettings);}Notifications.Notify("on-eoform-before-execute",d,null);},OnEOForm_AfterExecute:function(d,a){var b=this;Notifications.Notify("on-eoform-after-execute",b,null);if(window.deviceSettings&&window.spectrumPathDevices&&window.deviceSettings.DeviceStrategy){window.deviceSettings.ApplyLabels();}},OnEOForm_CartItemRemoved:function(e,a){var b=a;var d=this;if(window.SLP&&(deviceSettings.HasSlps()||this.IsUsingNewStyleDevices)){SLP.OnEOFormCartItemRemoved(b);}Notifications.Notify("on-eoform-cart-item-removed",d,b);},OnEOForm_CartItemClicked:function(d,a){var b=a;if(window.SLP&&(deviceSettings.HasSlps()||this.IsUsingNewStyleDevices)){SLP.OnEOFormCartItemClicked(b);}},OnEOForm_OrderLimitChanged:function(d,a){var b=this;Notifications.Notify("on-eoform-orderlimit-changed",b,null);},OnOrder_Submit:function(e,a){var b=e;if(!b||b==null||b.Items==null||b.Items.length==0){return;}var d=[];for(cartItem in b.Items){d.push({OfferCode:cartItem.Id,Name:cartItem.Name,Price:cartItem.Price});}var f=ServiceHelper(url,function(g){if(g.Success){Notifications.Notify("on-order-submitted",b,g);}});f.InvokeMethod("SubmitOrder",cartitems);},InitializeCookies:function(){if(window.SpectrumCookieManager){window.SpectrumCookieManager.Initialize();}if(window.SpectrumPathSession){SpectrumPathSession.Initialize();}if(window._spectrumPathContests){if(window._hasNewPathContestsCookieFormat){var a=PathContests.ToCookieFormat(_spectrumPathContests.Groups);this.InitializeCookie("pathcontests_",window._hasPathContests,function(){return a;});}else{this.InitializeCookie("pathcontests_",window._hasPathContests,function(){return $.toJSON(_spectrumPathContests);});}}if(!this.IsUsingNewStyleDevices){this.InitializeCookie("devices_",window._hasDevices,this.SerializeDevicesObject,true);}this.InitializeCookie("spectrumAnalytics_",true,function(){return $.toJSON({Dfa:[],Ga:[]});});},InitializeCookie:function(h,i,e,a){var g=h+giPathID;var b=GetCookie(g);var f=false;if(b&&b!=null&&b!==""){f=true;}var j=!f&&i;if(a){j=true;}if(j){var d=e();SetCookie(g,d,null,"/");}},SerializeDevicesObject:function(){var a=GetCookie("devices_"+window.giPathID);if(a&&a.length){var b=$.parseJSON(a);if(window._spectrumDevices){if(window._spectrumDevices.Slots&&window._spectrumDevices.Slots.length){if(b&&b.Slots&&!SpectrumEvents.ContainsDevices(b.Slots,_spectrumDevices.Slots)){b.Slots=window._spectrumDevices.Slots;}}if(window._spectrumDevices.Slps&&window._spectrumDevices.Slps.length){if(b&&b.Slps.length==0){b.Slps=window._spectrumDevices.Slps;return $.toJSON(b);}if(b&&b.Slps&&b.Slps.length&&window._spectrumDevices.Slps&&window._spectrumDevices.Slps.length&&SpectrumEvents.ContainsSlpDevice(b.Slps,_spectrumDevices.Slps)){return $.toJSON(b);}b.Slps=window._spectrumDevices.Slps;}}return $.toJSON(b);}return $.toJSON(window._spectrumDevices);},ContainsDevices:function(g,f){var d=this.GetUniqueDeviceIds(g);var e=this.GetUniqueDeviceIds(f);var a=true;for(var b in e){if(!(d[b])){a=false;break;}}return a;},GetUniqueDeviceIds:function(h){var b={};if(!h||h==null){return b;}var f=this;for(var e=0;e<h.length;e++){var g=h[e];for(var d=0;d<g.Devices.length;d++){var a=g.Devices[d];b["d_"+a.id]=a.id;}}return b;},ContainsSlpDevice:function(d,f){var e=this.GetUniqueSlpDeviceId(d);var g=this.GetUniqueSlpDeviceId(f);var a=true;for(var b in g){if(!(e[b])){a=false;break;}}return a;},GetUniqueSlpDeviceId:function(f){var a={};if(!f||f==null){return a;}var d=this;for(var b=0;b<f.length;b++){var e=f[b];a["d_"+e.Id]=e.Id;}return a;},DeletePathCookiesIfRequired:function(){var b=window.pathData.CurrentStep.IsContestEntry;if(b&&window.SpectrumDeviceManager){window.SpectrumDeviceManager.DeletePathDeviceCookies();}var f=b||SpectrumEvents.IsMapCartCookieExpired();if(!f){return;}try{var d=window.pathData.Id;SpectrumCookies.Delete("mpCart_"+d,"/",window.globalDomainName);SpectrumUtils.ClearInMemoryCart();}catch(a){}},IsMapCartCookieExpired:function(){if(typeof window.mpCartCookieTTL==="undefined"){return false;}var d=SpectrumCookies.Get("mpCart_"+window.giPathID);var b;if(d==null||d==""){b={ReturnUrl:"",TabSeen:0,Items:[],Ct:0,HasSeenEO:false};}else{b=$.parseJSON(d);}if(!b.Ct){return false;}var a=(b.Ct+window.mpCartCookieTTL);return(a<=window.SERVER_UXTIMESTAMP);}};var SpectrumCookies={Exists:function(d,e,b){var a=this.Get(d);if(a&&a!=""){return true;}return false;},Set:function(d,g,b,e,a,f){document.cookie=d+"="+escape(g)+((b)?"; expires="+b.toGMTString():"")+((e)?"; path="+e:"")+((a)?"; domain="+a:"")+((f)?"; secure":"");},Get:function(k,f){var b=k+"=";var a=b.length;var d=document.cookie.length;var g=0;while(g<d){var h=g+a;if(document.cookie.substring(g,h)==b){var e=this.GetVal(h);return(f)?this.Decode64(e).replace(/[\u0000-\u0001]+/g,""):e;}g=document.cookie.indexOf(" ",g)+1;if(g==0){break;}}return null;},GetVal:function(d,b){if(arguments.length<2){b=";";}var a=document.cookie.indexOf(b,d);if(a==-1){a=document.cookie.length;}return unescape(document.cookie.substring(d,a));},Delete:function(d,e,b){var a=document.cookie.match(d+"=");if(a&&a.length){document.cookie=d+"="+((e)?"; path="+e:"")+((b)?"; domain="+b:"")+"; expires=Thu, 01-Jan-70 00:00:01 GMT";}},SetNameVal:function(d,i,k,g){if(arguments.length<4){g=";";}var f;var a;var e="";var b=false;f=this.Get(d);if(f!=null){a=f.split(g);for(var h=0;h<a.length;h++){var l=a[h].split("=");if(l.length>0&&l[0]==i){e+=i+"="+k+g;b=true;}else{if(a[h]!=""){e+=a[h]+g;}}}}if(!b){e+=i+"="+k+g;}this.Set(d,e);},GetNameVal:function(b,n,g,l,e){if(arguments.length<3){g=";";}if(arguments.length<4){l="=";}if(arguments.length<5){e=false;}var d;var a;var h;var k;var j;var f;d=this.Get(b,e);if(d==null){return false;}a=this.GetStringArr(d,g);if(a.length==0){return false;}k=this.SetArrayStr(a,l);h=this.GetStringArr(k,l);if(h==0){return false;}j=h.length;for(f=0;f<j;){if(h[f].toLowerCase()==n.toLowerCase()){return unescape(h[f+1]);}f=f+1;}return false;},SetArrayStr:function(e,b){if(e.length==0){return false;}if(arguments.length<2){b=";";}var d="";for(var a=0;a<e.length;a++){d+=e[a]+b;}return d;},GetStringArr:function(b,a){if(arguments.length<2){a=";";}return b.split(a);},Decode64:function(l){if(typeof noBase64Decode!="undefined"&&noBase64Decode==true){return l;}var n="";var b,d,e="";var f,g,h,j="";var k=0;var a=/[^A-Za-z0-9\+\/\=]/g;if(a.exec(l)){if(console){console.log("There were invalid base64 characters in the input text.\nValid base64 characters are A-Z, a-z, 0-9, ?+?, ?/?, and ?=?\nExpect errors in decoding.");}}l=l.replace(/[^A-Za-z0-9\+\/\=]/g,"");do{f=keyStr.indexOf(l.charAt(k++));g=keyStr.indexOf(l.charAt(k++));h=keyStr.indexOf(l.charAt(k++));j=keyStr.indexOf(l.charAt(k++));b=(f<<2)|(g>>4);d=((g&15)<<4)|(h>>2);e=((h&3)<<6)|j;n=n+String.fromCharCode(b);if(h!=64){n=n+String.fromCharCode(d);}if(j!=64){n=n+String.fromCharCode(e);}b=d=e="";f=g=h=j="";}while(k<l.length);return n;}};var SpectrumAnalyticsHelper={CookieData:null,CookieName:null,IsContestEntryStep:false,AnalyticsCookie:null,IsAnalyticsCompleteEventEnabled:function(){if(window.analyticsSettings){return window.analyticsSettings.DFA.IsEnabled||window.analyticsSettings.GA.IsEnabled;}return false;},InitAnalytics:function(){if(window.pathData){this.CookieName="spectrumAnalytics_"+window.pathData.Id;if(window.pathData.CurrentStep.IsContestEntry){this.IsContestEntryStep=window.pathData.CurrentStep.IsContestEntry;}this.LoadCookie();window.pathData.SegId="";if(window.SpectrumRegistrationResponseDto&&window.SpectrumRegistrationResponseDto.SpectrumCustomer&&window.SpectrumRegistrationResponseDto.SpectrumCustomer.System&&window.SpectrumRegistrationResponseDto.SpectrumCustomer.System.AudienceId){window.pathData.SegId=window.SpectrumRegistrationResponseDto.SpectrumCustomer.System.AudienceId;}window.pathData.CurrentStep.FullName=window.pathData.Name+"-"+window.pathData.CurrentStep.Name;var a=this.CreateData(window.pathData);if(this.IsAnalyticsEnabled()){window.SpectrumAnalytics=new MultiAnalyticsProvider(a,window.pathData);this.RegisterAllProviders(a);window.SpectrumAnalytics.Init();window.SpectrumAnalytics.OnPageView(SpectrumAnalyticsHelper,window.pathData);this.SubscribeToUserIdentityEvent();this.SubscribeSSOClickEvent();Notifications.Subscribe("on-multipage-tab-changed",function(d,b){SpectrumAnalytics.OnMultiPageTabChanged(d,b);});Notifications.Subscribe("on-user-info-changed",function(d,b){SpectrumAnalytics.OnUserInfoChanged(d,b);});Notifications.Subscribe("on-optin-changed",function(d,b){SpectrumAnalytics.OnOptinsChanged(d,b);});Notifications.Subscribe("on-optins-available-for-analytics",function(d,b){SpectrumAnalytics.OnOptinsRendered(d,b);});this.ForAnyRenderedOptinDevice(function(){Notifications.Notify("on-optins-available-for-analytics");});Notifications.Subscribe("on-page-submitting",function(d,b){SpectrumAnalytics.OnPageSubmitting(d,b);});Notifications.Subscribe("on-registration-lightbox-event",function(d,b){SpectrumAnalytics.OnRegLightboxEvent(d,b);});Notifications.Subscribe("on-registration-page-view",function(d,b){SpectrumAnalytics.OnRegistrationPageView(d,b);});Notifications.Subscribe("on-continue-shopping-event",function(d,b){SpectrumAnalytics.OnContinueShoppingEvent(d,b);});Notifications.Subscribe("on-product-recommendation-visible",function(d,b){SpectrumAnalytics.OnProductRecommendationVisible(d,b);});Notifications.Subscribe("on-fusion-product-tab-render-or-item-added",function(d,b){SpectrumAnalytics.OnFusionProductTabRenderOrItemAdded(d,b);});Notifications.Subscribe("on-sag-popup-view",function(){SpectrumAnalytics.OnSAGPopupView();});Notifications.Subscribe("on-sag-takeanotherlookbutton-click-event",function(d,b){SpectrumAnalytics.OnSAGTakeAnotherLookButtonClick(d,b);});Notifications.Subscribe("on-sag-nothanksbutton-click-event",function(d,b){SpectrumAnalytics.OnSAGNoThanksButtonClick(d,b);});Notifications.Subscribe("on-cart-item-added",function(d,b){SpectrumAnalytics.OnCartItemAdded(d,b);});Notifications.Subscribe("on-cart-item-removed",function(d,b){SpectrumAnalytics.OnCartItemRemoved(d,b);});}}},InitAnalyticsForMyAccount:function(){var a=this.CreateData();a.DisableDefaultPageView=true;if(this.IsAnalyticsEnabled(window.analyticsSettings.GA)){var b={CurrentToken:{}};window.SpectrumAnalytics=new MultiAnalyticsProvider(a,b);window.SpectrumAnalytics.Register(new GaProvider(window.webAnalyticsMode,window.analyticsSettings.GA,a,b));window.SpectrumAnalytics.Init();this.SubscribeToUserIdentityEvent();this.SubscribeSSOClickEvent();}},SubscribeToUserIdentityEvent:function(){Notifications.Subscribe("on-user-identity-event",function(b,a){SpectrumAnalytics.OnUserIdentityEvent(b,a);});},SubscribeSSOClickEvent:function(){Notifications.Subscribe("sso-click-event",function(b,a){SpectrumAnalytics.OnElementClick(b,a);});},CreateData:function(d){var a={IsMobile:false,IsUserRecognized:false,Sources:"houseemail",CampaignType:"",AppName:"Spectrum",DeviceType:"desktop",Recognized:"unrecognized",NewUserStatus:"newuser",ShopId:"",ScoreGroup:"",Age:0,Gender:"",Email:"",EmailHash:"",City:"",State:"",Zip:"",Country:"usa",LastEntryDate:"",FirstName:"",LastName:""};if(d){a.Prod=d.CurrentStep.HasOffering?"prod":"nonprod";}a.Sources=this.GetTokenSource(d);a.CampaignType=this.GetCampaignType(d);if(window.SpectrumRegistrationResponseDto&&window.SpectrumRegistrationResponseDto.SpectrumCustomer){a.IsUserRecognized=true;}a.IsMobile=window.SpectrumUtils.IsMobile();a.DeviceType=window.SpectrumUtils.GetSpectrumDeviceType();a.UserAgentId=window.SpectrumUtils.GetSpectrumUserAgentId();if(a.IsUserRecognized){var j=window.SpectrumRegistrationResponseDto.SpectrumCustomer.User;var k=window.SpectrumRegistrationResponseDto.SpectrumCustomer.UserInternal;var f=window.SpectrumRegistrationResponseDto.SpectrumCustomer.ScoringVariables;var g=window.SpectrumRegistrationResponseDto.SpectrumCustomer.Segments;var l=window.SpectrumRegistrationResponseDto.SpectrumCustomer.ValidationVariables;var h=window.SpectrumRegistrationResponseDto.SpectrumCustomer.SessionProfile;var e=window.SpectrumRegistrationResponseDto.SpectrumCustomer.Registrations;var b=window.SpectrumRegistrationResponseDto.SpectrumCustomer.OptIns;var i=window.SpectrumRegistrationResponseDto.SpectrumCustomer.System;a.Title=j.Title;a.FirstName=j.FirstName;a.LastName=j.LastName;a.NewUserStatus=k.IsNewUser?"newuser":"existinguser";a.IsNewUser=k.IsNewUser;a.Recognized="recognized";a.ScoreGroup=f.SegmentName;a.SegCodes=(g&&g.SegCodes)?g.SegCodes:null;a.Age=window.SpectrumUtils.GetAgeOrDefault(j.DateOfBirth,0);a.Gender=this.GetGender();a.Email=j.Email;a.EmailHash=j.EmailHash;a.EmailDomain=window.SpectrumUtils.GetEmailDomain(j.Email);a.ShopId=k.GlobalMemberToken;a.City=j.City;a.State=j.State;a.Zip=j.Zip;a.AddressId=(j.AddressId)?j.AddressId:0;a.AddressStatusCode=l.AddressValidationStatusCode;a.EmailStatusCode=l.EmailValidationStatusCode;a.NameStatusCode=l.FieldValidationStatusCode;a.FirstEverRegDate=k.FirstEverRegDate;a.LastEntryDate=h.ProfileDataInUse.LastEntryDate;a.DaysSinceLastEntry=window.SpectrumUtils.GetDaysBetween(h.ProfileDataInUse.LastEntryDate);if(isNaN(a.DaysSinceLastEntry)){a.DaysSinceLastEntry=null;delete a.DaysSinceLastEntry;}if(a.ScoreGroup!=null){a.ScoreGroup=a.ScoreGroup.replace("Group","G");}a.MagOrderLimit=f.MagOrderLimit;a.MerchOrderLimit=f.MerchOrderLimit;a.LiveOrderCount=f.LiveOrderCount;a.TotalOrderLimit=f.TotalOrderLimit;a.Registrations=(e&&e.PropertyCodes)?e.PropertyCodes:null;a.Optins=(b&&b.Subscriptions)?b.Subscriptions:null;a.AudienceId=i.AudienceId;a.HasPasswordOnAccount=(k&&k.HasPasswordOnAccount)?k.HasPasswordOnAccount:false;}a.TrackingToken=window.trackingToken;return a;},GetGender:function(){if(window.SpectrumRegistrationResponseDto.SpectrumCustomer.User.Title==null){return"male";}if(window.SpectrumRegistrationResponseDto.SpectrumCustomer.User.Title.toUpperCase()!="MR."){return"female";}return"male";},GetTokenSource:function(a){var b="";if(!a){return null;}if(a.CurrentToken.Source&&a.CurrentToken.Source!=""){b=this.GetSource(a.CurrentToken.Source,a.CurrentToken.Placement);}return b;},GetCampaignType:function(b){var a="";if(!b){return null;}if(b.CurrentToken.CampaignType&&b.CurrentToken.CampaignType!=""){a=b.CurrentToken.CampaignType;}return a;},GetSource:function(d,b){var a=d.replace(" ","").toLowerCase();if(b&&b!=""){b=b.substr(0,3);if(a=="acquisition"&&(b=="PC_"||b=="SA_"||b=="MC_")){a="multichannel";}}return a;},LoadCookie:function(){this.AnalyticsCookie=new SpectrumAnalyticsCookie();this.AnalyticsCookie.CookieName=this.CookieName;this.AnalyticsCookie.IsContestEntryStep=this.IsContestEntryStep;this.AnalyticsCookie.Load();this.AnalyticsCookie.Upgrade();this.CookieData=this.AnalyticsCookie.CookieData;},SaveCookie:function(){this.AnalyticsCookie.Save();},HasTrigger:function(a,b){return this.AnalyticsCookie.HasTrigger(a,b);},AddTrigger:function(a,b){return this.AnalyticsCookie.AddTrigger(a,b);},HasTag:function(a,b){return this.AnalyticsCookie.HasTag(a,b);},AddTag:function(a,b){return this.AnalyticsCookie.AddTag(a,b);},IsAnalyticsEnabled:function(b){if(b){return b.IsEnabled;}if(!window.analyticsSettings){return false;}for(var a in window.analyticsSettings){if(!a){continue;}if(this.IsAnalyticsEnabled(window.analyticsSettings[a])){return true;}}return false;},RegisterAllProviders:function(a){for(var b in window.analyticsSettings){if(!b){continue;}var d=window.analyticsSettings[b];if(!d||!this.IsAnalyticsEnabled(d)){continue;}switch(b){case"CM":if(this.IsContestEntryStep){continue;}window.SpectrumAnalytics.Register(new CoreMetricsProvider(window.webAnalyticsMode,d,a,window.pathData));break;case"DFA":if(this.IsContestEntryStep){continue;}window.SpectrumAnalytics.Register(new DfaProvider(window.pathData.CurrentToken.Source,d,a,window.pathData));break;case"GA":window.SpectrumAnalytics.Register(new GaProvider(window.webAnalyticsMode,d,a,window.pathData));break;case"GTM":window.SpectrumAnalytics.Register(new GtmProvider(d,a,window.pathData));break;case"Evergage":window.SpectrumAnalytics.Register(new EvergageProvider(d,a,window.pathData));break;case"Tealium":window.SpectrumAnalytics.Register(new TealiumProvider(d,a,window.pathData));break;default:if(window.console&&window.console.error){window.console.error("Unknown analytics provider: "+b,d);}break;}}},ForAnyRenderedOptinDevice:function(b){if(!window.SpectrumDeviceManager){return;}var d=window.SpectrumDeviceManager;var a={DeviceType:"Optin",PresentationStyle:DevicePresentationStyles.InPage};d.ForEachStepDeviceInstance(a,function(e){b();return;});}};function SpectrumAnalyticsCookie(){this.Group="";this.IsContestEntryStep=false;this.CookieName="";this.CookieData=null;this.Upgrade=function(){if(this.CookieData==null){return;}var d=false;if(typeof this.CookieData.Dfa!="undefined"&&typeof this.CookieData.Dfa.Trgs=="undefined"){var a=this.CookieData.Dfa;this.CookieData.Dfa={Trgs:a,Tags:[]};d=true;}if(typeof this.CookieData.Ga!="undefined"&&typeof this.CookieData.Ga.Trgs=="undefined"){var b=this.CookieData.Ga;this.CookieData.Ga={Trgs:b,Tags:[]};d=true;}if(d){this.Save();}};this.GetState=function(a){var b={Trgs:[],Tags:[]};if(a=="dfa"){b=this.CookieData.Dfa;}else{if(a=="ga"){b=this.CookieData.Ga;}}return b;};this.HasTrigger=function(a,g){if(this.IsContestEntryStep){return true;}var d=this.GetState(a);var f=d.Trgs;for(var b=0;b<f.length;b++){var e=f[b];if(e==g){return true;}}return false;},this.AddTrigger=function(a,e){if(this.IsContestEntryStep){return;}if(this.HasTrigger(a,e)){return;}var b=this.GetState(a);var d=b.Trgs;d.push(e);this.Save();};this.HasTag=function(a,f){if(this.IsContestEntryStep){return true;}var d=this.GetState(a);for(var b=0;b<d.Tags.length;b++){var e=d.Tags[b];if(e==f){return true;}}return false;},this.AddTag=function(a,d){if(this.IsContestEntryStep){return;}if(this.HasTag(a,d)){return;}var b=this.GetState(a);b.Tags.push(d);this.Save();};this.Load=function(){if(this.IsContestEntryStep){return;}var a=GetCookie(this.CookieName);this.CookieData=$.parseJSON(a);};this.Save=function(){if(this.IsContestEntryStep){return;}var a=$.toJSON(this.CookieData);SetCookie(this.CookieName,a,null,"/");};}var SpectrumLightbox={Config:{SPECTRUM_LIGHTBOX_CONTENT:"spectrumLightbox_content2",SPECTRUM_LIGHTBOX_OVERLAY:"spectrumLightbox_overlay",SPECTRUM_LIGHTBOX_TRY_COUNT_LIMIT:20},Overlay:null,ContentLoadTimeOut:null,ContentLoadTryCount:0,ShowLightboxOnPageLoad:function(a){},ShowLightbox:function(d){if(!d){d={};}if(!d.displaySettings){d.displaySettings={};}if(typeof d.displaySettings.scrollToTop==="undefined"||d.displaySettings.scrollToTop===null){d.displaySettings.scrollToTop=true;}if(typeof d.displaySettings.closeOnOverlayClick==="undefined"||d.displaySettings.closeOnOverlayClick===null){d.displaySettings.closeOnOverlayClick=true;}if(!d.content){d.content=$("div."+SpectrumLightbox.Config.SPECTRUM_LIGHTBOX_CONTENT);}SpectrumLightbox.EnsureOverlayLoaded(d.overlay);var a=d.content.find("img.pchLightboxAsset");var b=checkImageLoaded(a);if(a&&a.length>0&&!b){d.waitForImageToLoad=true;}a.bind("load",function(){d.waitForImageToLoad=false;});SpectrumLightbox.EnsureContentLoaded(d,SpectrumLightbox.OnContentLoaded,d);var e=d.overlay||SpectrumLightbox.Overlay;e.unbind("click");return false;},HideLightbox:function(a){if(!a){a={};}if(!a.content){a.content=$("div."+SpectrumLightbox.Config.SPECTRUM_LIGHTBOX_CONTENT);}a.content.fadeOut("fast",function(){var b=a.overlay||SpectrumLightbox.Overlay;b.fadeOut("fast",function(){if(a.hideCallback){a.hideCallback(a.data);}});});},OnContentLoaded:function(b){if(!b){return false;}var f=b.displaySettings;if(f.scrollToTop){window.scrollTo(0,0);}var a=b.content;var d=(isNaN(f.top)?0:f.top);d=SpectrumLightbox.EnsureContentFitsTheScreen(a,d);a.css("top",d+"px");var g=b.overlay||SpectrumLightbox.Overlay;g[0].style.filter="progid:DXImageTransform.Microsoft.Alpha(Opacity=80)";var h=b.showCallback;var e=b.data;g.css("filter","alpha(opacity=80)").fadeIn("normal",function(){a.fadeIn("normal",function(){if(b.displaySettings.closeOnOverlayClick){g.click(function(){if((b.onOverlayClick!=undefined)&&(typeof(b.onOverlayClick)==="function")){b.onOverlayClick();}else{SpectrumLightbox.HideLightbox(b);}});}if(h){h(e);}});});return false;},EnsureOverlayLoaded:function(b){b=b||SpectrumLightbox.Overlay;if(b){b.css({height:$(document).height()+"px",width:$(document).width()+"px"});return false;}var a=$("form");if(a.length<=0){return false;}a.append("<div class='"+SpectrumLightbox.Config.SPECTRUM_LIGHTBOX_OVERLAY+"'></div>");SpectrumLightbox.Overlay=$("div."+SpectrumLightbox.Config.SPECTRUM_LIGHTBOX_OVERLAY);SpectrumLightbox.Overlay.css({height:$(document).height()+"px",width:$(document).width()+"px"});return false;},EnsureContentLoaded:function(g,b,d){clearTimeout(SpectrumLightbox.ContentLoadTimeOut);g.ContentLoadTryCount=g.ContentLoadTryCount||0;g.ContentLoadTryCount++;if(g.ContentLoadTryCount>SpectrumLightbox.Config.SPECTRUM_LIGHTBOX_TRY_COUNT_LIMIT){return false;}var f=SpectrumLightbox.GetLightboxDimensions(g.content);var a=SpectrumLightbox.GetBrowserDimensions();if(!f.Width||!f.Height||g.waitForImageToLoad){ContentLoadTimeOut=window.setTimeout(function(){SpectrumLightbox.EnsureContentLoaded(g,b,d);},555);return false;}if(f.Width.toString().indexOf("px")==-1){f.Width+="px";}if(f.Height.toString().indexOf("px")==-1){f.Height+="px";}g.content.css({width:f.Width,height:f.Height});var e=SpectrumLightbox.CalculateCenterOffset(a,f.Width);g.content.css({left:e+"px",display:"none"});if(b){b(d);}return false;},EnsureContentFitsTheScreen:function(d,a){var f=$(window).height();var g=$(window).scrollTop();var e=d.height();var b=a+e;if(b>f){d.addClass("bigLightbox");a=a+g;}return a;},GetLightboxDimensions:function(b){var e,d;var a=$("iframe,object,embed,img.pchLightboxAsset",b);if(a.length){e=a.prevObject[0].clientWidth||a.width()||a.attr("width");d=a.prevObject[0].clientHeight||a.height()||a.attr("height");}else{if(b.length){e=b.width()||b.attr("width")||b[0].scrollWidth;d=b.height()||b.attr("height");if(((e==0)||(typeof(e)==="undefined")||(d==0)||(typeof(d)==="undefined"))&&(b.is(":hidden"))){b.show();e=b.width()||b.attr("width")||b[0].scrollWidth;d=b.height()||b.attr("height");b.hide();}}}return{Width:e,Height:d};},GetBrowserDimensions:function(){var d=630,b=460;var a=document.documentElement;b=Math.max(Math.max(document.body.scrollHeight,document.documentElement.scrollHeight),Math.max(document.body.offsetHeight,document.documentElement.offsetHeight),Math.max(document.body.clientHeight,document.documentElement.clientHeight));d=window.innerWidth||self.innerWidth||(a&&a.clientWidth)||document.body.clientWidth;return{winW:d,winH:b};},CalculateCenterOffset:function(a,b){var d=(a.winW/2)-(b.toString().replace("px","")/2);return d;}};function checkImageLoaded(a){if(!a||a.length<=0){return false;}if(!a[0].complete){return false;}if(a[0].naturalWidth==0){return false;}return true;}var OptinCookie={Set:function(b,d){if(!b||!b.length){OptinCookie.Delete(d);return false;}if(!d){return false;}var a=b.join("^");if(typeof window.SetCookie!="function"){return false;}window.SetCookie(OptinCookie.GetCookieName(d),a);return true;},Get:function(b){if(!b){return[];}if(typeof window.GetCookie!="function"){return[];}var a=window.GetCookie(OptinCookie.GetCookieName(b));if(!a||!a.length){return[];}return a.split("^");},Delete:function(a){if(!a){return false;}if(typeof window.DeleteCookie!="function"){return false;}window.DeleteCookie(OptinCookie.GetCookieName(a));return true;},GetCookieName:function(a){return"SpectrumOptinResponses_"+a;}};function MultiAnalyticsProvider(a,b){this.Metrics=a;this.PathData=b;this.Providers=[];this.ProvidersByName={};this.OnPageSubmitCompleteCallbacks=[];this.Register=function(d){if(d.HasOnCompleteCallbackOnPageSubmit){this.OnPageSubmitCompleteCallbacks.push({provider:d.Name,completed:false});}this.Providers.push(d);this.ProvidersByName[d.Name]=d;};this.Init=function(){this.ForEach(function(d){d.Init();});};this.OnPageSubmitCompleted=function(g,h,d){for(var f=0;f<this.OnPageSubmitCompleteCallbacks.length;f++){if(g==this.OnPageSubmitCompleteCallbacks[f].provider){this.OnPageSubmitCompleteCallbacks[f].completed=true;}}var e=0;for(var j=0;j<this.OnPageSubmitCompleteCallbacks.length;j++){if(this.OnPageSubmitCompleteCallbacks[j].completed==true){e=e+1;}}if(e==this.OnPageSubmitCompleteCallbacks.length){Notifications.Notify("on-analytics-complete",h,d);}};this.OnPageView=function(e,d){this.ExecuteCallbackForEachProvider("OnPageView",e,d);};this.OnUserInfoChanged=function(e,d){var f=SpectrumAnalyticsHelper.CreateData(b);this.ForEach(function(g){g.Metrics=f;if(typeof(g.OnUserInfoChanged)==="function"){g.OnUserInfoChanged(e,d);}});};this.OnMultiPageTabChanged=function(e,d){this.ExecuteCallbackForEachProvider("OnMultiPageTabChanged",e,d);};this.OnOptinsChanged=function(e,d){this.ExecuteCallbackForEachProvider("OnOptinsChanged",e,d);};this.OnOptinsRendered=function(e,d){this.ExecuteCallbackForEachProvider("OnOptinsRendered",e,d);};this.OnPageSubmitting=function(e,d){this.ExecuteCallbackForEachProvider("OnPageSubmitting",e,d);};this.OnContestEntry=function(e,d){this.ExecuteCallbackForEachProvider("OnContestEntry",e,d);};this.OnCartOrderComplete=function(g,d){var f=this.BuildCartOrder();if(!f.HasOrder){return;}var e=SpectrumUtils.GetBillMeOrderId();if(isNaN(e)){return;}if(d==null){d={};}d.Order=f.Order;d.Order.OrderId=e;this.ExecuteCallbackForEachProvider("OnCartOrderComplete",g,d);};this.OnRegLightboxEvent=function(e,d){this.ExecuteCallbackForEachProvider("OnRegLightboxEvent",e,d);};this.OnRegistrationPageView=function(e,d){this.ExecuteCallbackForEachProvider("OnRegistrationPageView",e,d);};this.OnUserIdentityEvent=function(e,d){this.ExecuteCallbackForEachProvider("OnUserIdentityEvent",e,d);};this.OnContinueShoppingEvent=function(e,d){this.ExecuteCallbackForEachProvider("OnContinueShoppingEvent",e,d);};this.OnSAGPopupView=function(e,d){this.ExecuteCallbackForEachProvider("OnSAGPopupView",e,d);};this.OnSAGTakeAnotherLookButtonClick=function(e,d){this.ExecuteCallbackForEachProvider("OnSAGTakeAnotherLookButtonClick",e,d);};this.OnSAGNoThanksButtonClick=function(e,d){this.ExecuteCallbackForEachProvider("OnSAGNoThanksButtonClick",e,d);};this.OnCartItemAdded=function(e,d){this.ExecuteCallbackForEachProvider("OnCartItemAdded",e,d);};this.OnCartItemRemoved=function(e,d){this.ExecuteCallbackForEachProvider("OnCartItemRemoved",e,d);};this.ExecuteCallbackForEachProvider=function(e,f,d){if(!e||!e.length){return;}this.ForEach(function(g){var h=g[e];if(typeof h==="function"){h.call(g,f,d);}});};this.ForEach=function(d){if(this.Providers.length==0){return;}for(var e=0;e<this.Providers.length;e++){d(this.Providers[e]);}};this.BuildCartOrder=function(){var e={HasOrder:false,Order:null};if(!SpectrumUtils.HasCartItems()){return e;}e.HasOrder=true;var d=this.PathData.Name;e.Order={GMT:this.Metrics.ShopId,PathStepName:d,TotalOrderPrice:0,TaxAmount:0,ShippingFees:0,Address:{City:this.Metrics.City,State:this.Metrics.State,Country:this.Metrics.Country},Items:[]};SpectrumUtils.PopulateOrder(d,e.Order);return e;};this.OnElementClick=function(e,d){this.ExecuteCallbackForEachProvider("OnElementClick",e,d);};this.OnProductRecommendationVisible=function(e,d){this.ExecuteCallbackForEachProvider("OnProductRecommendationVisible",e,d);};this.OnFusionProductTabRenderOrItemAdded=function(e,d){this.ExecuteCallbackForEachProvider("OnFusionProductTabRenderOrItemAdded",e,d);};}function DfaProvider(e,a,b,d){this.Name="dfa";this.Ctx=null;this.Config=a;this.Metrics=b;this.PathData=d;this.OnCompleteWaitTime=this.Config&&this.Config.OnCompleteWaitTimeInMilliseconds?this.Config.OnCompleteWaitTimeInMilliseconds:1000;this.TokenSource=e;this.NEWOPTIN="NewOptin";this.REOPTIN="ReOptin";this.EXISTINGOPTIN="ExistingOptin";this.IFramesToAppendToBody=[];this.TagsFired=0;this.IsPathVisitTagFired=false;this.IsOptinsChangedFired=false;this.IsUserInfoChangedFired=false;this.TriggerPathVisit="PATH_VISIT";this.TriggerUserInfo="USER_INFO";this.TriggerPageSubmit="PAGE_SUBMIT";this.HasOnCompleteCallbackOnPageSubmit=true;this.PageSubmitNotificationReceived=false;this.CookieName="specDfa";this.Subscriptions={};this.RFCodes=window.spectrumSubscriptionStatuses;this.CookiePropertyCode="PC";this.RFCodeGroupNewOptinAccountNA=[this.RFCodes.NoAccNewOptin,this.RFCodes.NewAccNewOptin,this.RFCodes.ExAccNewOptin];this.RFCodeGroupNewOptinAccountEx=[this.RFCodes.NoAccNewOptin,this.RFCodes.NewAccNewOptin,this.RFCodes.ExAccNewOptin];this.RFCodeGroupTermOptinAccountEx=[this.RFCodes.ExAccTermUnsub,this.RFCodes.ExAccTermReject,this.RFCodes.ExAccPermUnsub,this.RFCodes.ExAccPermReject];this.RFCodeGroup5a4=[this.RFCodes.ExAccExOptin,this.RFCodes.ExAccRedunOptin];this.Scenarios=[{id:"1",trigger:this.TriggerUserInfo,isMatch:false,token:"Acquisition",hasRegComp:"NA",userStatus:[this.RFCodes.NewAccNewOptin],optin:"PCHCOM",gender:"NA",isAgeOver:"NA",group:"NA",fireMode:"1_PER_SESSION",tags:["tag1"]},{id:"2a",trigger:this.TriggerUserInfo,isMatch:false,token:"Acquisition",hasRegComp:"NA",userStatus:[this.RFCodes.NewAccNewOptin],optin:"PCHCOM",gender:"FEMALE",isAgeOver:"YES",group:"5a",fireMode:"1_PER_SESSION",tags:["tag2a"]},{id:"2b",trigger:this.TriggerUserInfo,isMatch:false,token:"Acquisition",hasRegComp:"NA",userStatus:[this.RFCodes.NewAccNewOptin],optin:"PCHCOM",gender:"MALE",isAgeOver:"YES",group:"5a",fireMode:"1_PER_SESSION",tags:["tag2b"]},{id:"2c",trigger:this.TriggerUserInfo,isMatch:false,token:"Acquisition",hasRegComp:"NA",userStatus:[this.RFCodes.NewAccNewOptin],optin:"PCHCOM",gender:"NA",isAgeOver:"NO",group:"5a",fireMode:"1_PER_SESSION",tags:["tag2c"]},{id:"2d",trigger:this.TriggerUserInfo,isMatch:false,token:"Acquisition",hasRegComp:"NA",userStatus:[this.RFCodes.NewAccNewOptin],optin:"PCHCOM",gender:"FEMALE",isAgeOver:"YES",group:"5b",fireMode:"1_PER_SESSION",tags:["tag2d"]},{id:"2e",trigger:this.TriggerUserInfo,isMatch:false,token:"Acquisition",hasRegComp:"NA",userStatus:[this.RFCodes.NewAccNewOptin],optin:"PCHCOM",gender:"MALE",isAgeOver:"YES",group:"5b",fireMode:"1_PER_SESSION",tags:["tag2e"]},{id:"2f",trigger:this.TriggerUserInfo,isMatch:false,token:"Acquisition",hasRegComp:"NA",userStatus:[this.RFCodes.NewAccNewOptin],optin:"PCHCOM",gender:"NA",isAgeOver:"NO",group:"5b",fireMode:"1_PER_SESSION",tags:["tag2f"]},{id:"2g",trigger:this.TriggerUserInfo,isMatch:false,token:"Acquisition",hasRegComp:"NA",userStatus:[this.RFCodes.NewAccNewOptin],optin:"PCHCOM",gender:"FEMALE",isAgeOver:"YES",group:"5c",fireMode:"1_PER_SESSION",tags:["tag2g"]},{id:"2h",trigger:this.TriggerUserInfo,isMatch:false,token:"Acquisition",hasRegComp:"NA",userStatus:[this.RFCodes.NewAccNewOptin],optin:"PCHCOM",gender:"MALE",isAgeOver:"YES",group:"5c",fireMode:"NA",tags:["tag2h"]},{id:"2i",trigger:this.TriggerUserInfo,isMatch:false,token:"Acquisition",hasRegComp:"NA",userStatus:[this.RFCodes.NewAccNewOptin],optin:"PCHCOM",gender:"NA",isAgeOver:"NO",group:"5c",fireMode:"1_PER_SESSION",tags:["tag2i"]},{id:"2j",trigger:this.TriggerUserInfo,isMatch:false,token:"Acquisition",hasRegComp:"NA",userStatus:[this.RFCodes.NewAccNewOptin],optin:"PCHCOM",gender:"FEMALE",isAgeOver:"YES",group:"5d",fireMode:"1_PER_SESSION",tags:["tag2j"]},{id:"2k",trigger:this.TriggerUserInfo,isMatch:false,token:"Acquisition",hasRegComp:"NA",userStatus:[this.RFCodes.NewAccNewOptin],optin:"PCHCOM",gender:"MALE",isAgeOver:"YES",group:"5d",fireMode:"1_PER_SESSION",tags:["tag2k"]},{id:"2l",trigger:this.TriggerUserInfo,isMatch:false,token:"Acquisition",hasRegComp:"NA",userStatus:[this.RFCodes.NewAccNewOptin],optin:"PCHCOM",gender:"NA",isAgeOver:"NO",group:"5d",fireMode:"1_PER_SESSION",tags:["tag2l"]},{id:"2m1",trigger:this.TriggerUserInfo,isMatch:false,token:"Acquisition",hasRegComp:"NA",userStatus:[this.RFCodes.NewAccNewOptin],optin:"PCHCOM",gender:"NA",isAgeOver:"NA",group:"1",fireMode:"1_PER_SESSION",tags:["tag2m"]},{id:"2m2",trigger:this.TriggerUserInfo,isMatch:false,token:"Acquisition",hasRegComp:"NA",userStatus:[this.RFCodes.NewAccNewOptin],optin:"PCHCOM",gender:"NA",isAgeOver:"NA",group:"2",fireMode:"1_PER_SESSION",tags:["tag2m"]},{id:"2m3",trigger:this.TriggerUserInfo,isMatch:false,token:"Acquisition",hasRegComp:"NA",userStatus:[this.RFCodes.NewAccNewOptin],optin:"PCHCOM",gender:"NA",isAgeOver:"NA",group:"3",fireMode:"1_PER_SESSION",tags:["tag2m"]},{id:"2m4",trigger:this.TriggerUserInfo,isMatch:false,token:"Acquisition",hasRegComp:"NA",userStatus:[this.RFCodes.NewAccNewOptin],optin:"PCHCOM",gender:"NA",isAgeOver:"NA",group:"4",fireMode:"1_PER_SESSION",tags:["tag2m"]},{id:"3a",trigger:this.TriggerPageSubmit,isMatch:false,token:"Acquisition",hasRegComp:"YES",userStatus:["NA"],optin:"NA",gender:"MALE",isAgeOver:"NA",group:"1",fireMode:"1_PER_SESSION",tags:["tag3a"]},{id:"3b",trigger:this.TriggerPageSubmit,isMatch:false,token:"Acquisition",hasRegComp:"YES",userStatus:["NA"],optin:"NA",gender:"FEMALE",isAgeOver:"NA",group:"1",fireMode:"1_PER_SESSION",tags:["tag3b"]},{id:"3c",trigger:this.TriggerPageSubmit,isMatch:false,token:"Acquisition",hasRegComp:"YES",userStatus:["NA"],optin:"NA",gender:"MALE",isAgeOver:"NA",group:"2",fireMode:"1_PER_SESSION",tags:["tag3c"]},{id:"3d",trigger:this.TriggerPageSubmit,isMatch:false,token:"Acquisition",hasRegComp:"YES",userStatus:["NA"],optin:"NA",gender:"FEMALE",isAgeOver:"NA",group:"2",fireMode:"1_PER_SESSION",tags:["tag3d"]},{id:"3e1",trigger:this.TriggerPageSubmit,isMatch:false,token:"Acquisition",hasRegComp:"YES",userStatus:["NA"],optin:"NA",gender:"MALE",isAgeOver:"NA",group:"3",fireMode:"1_PER_SESSION",tags:["tag3e"]},{id:"3e2",trigger:this.TriggerPageSubmit,isMatch:false,token:"Acquisition",hasRegComp:"YES",userStatus:["NA"],optin:"NA",gender:"MALE",isAgeOver:"NA",group:"4",fireMode:"1_PER_SESSION",tags:["tag3e"]},{id:"3f1",trigger:this.TriggerPageSubmit,isMatch:false,token:"Acquisition",hasRegComp:"YES",userStatus:["NA"],optin:"NA",gender:"FEMALE",isAgeOver:"NA",group:"3",fireMode:"1_PER_SESSION",tags:["tag3f"]},{id:"3f2",trigger:this.TriggerPageSubmit,isMatch:false,token:"Acquisition",hasRegComp:"YES",userStatus:["NA"],optin:"NA",gender:"FEMALE",isAgeOver:"NA",group:"4",fireMode:"1_PER_SESSION",tags:["tag3f"]},{id:"4",trigger:this.TriggerPathVisit,isMatch:true,token:"Acquisition",hasRegComp:"YES",userStatus:["NA"],optin:"NA",gender:"NA",isAgeOver:"NA",group:"NA",fireMode:"NA",tags:["tag4"]},{id:"5a1",trigger:this.TriggerPageSubmit,isMatch:false,token:"Acquisition",hasRegComp:"NA",userStatus:[this.RFCodes.ExAccNewOptin],optin:"PCHCOM",gender:"NA",isAgeOver:"NA",group:"NA",fireMode:"1_PER_SESSION",tags:["tag5"]},{id:"5a2",trigger:this.TriggerUserInfo,isMatch:false,token:"Acquisition",hasRegComp:"NA",userStatus:[this.RFCodes.NewAccNewOptin],optin:"PCHCOM",gender:"NA",isAgeOver:"NA",group:"NA",fireMode:"1_PER_SESSION",tags:["tag5"]},{id:"5a3",trigger:this.TriggerPageSubmit,isMatch:false,token:"Acquisition",hasRegComp:"NA",userStatus:[this.RFCodes.ExAccReOptin],optin:"PCHCOM",gender:"NA",isAgeOver:"NA",group:"NA",fireMode:"1_PER_SESSION",tags:["tag5"]},{id:"5a4",trigger:this.TriggerPageSubmit,isMatch:false,token:"Acquisition",hasRegComp:"NA",userStatus:this.RFCodeGroup5a4,optin:"PCHCOM",gender:"NA",isAgeOver:"NA",group:"NA",fireMode:"1_PER_SESSION",tags:["tag5"]},{id:"5a5",trigger:this.TriggerPageSubmit,isMatch:false,token:"Acquisition",hasRegComp:"NA",userStatus:this.RFCodeGroupTermOptinAccountEx,optin:"PCHCOM",gender:"NA",isAgeOver:"NA",group:"NA",fireMode:"1_PER_SESSION",tags:["tag5"]},{id:"6a",trigger:this.TriggerUserInfo,isMatch:false,token:"Acquisition",hasRegComp:"NA",userStatus:this.RFCodeGroupNewOptinAccountNA,optin:"LOTTO",gender:"NA",isAgeOver:"NA",group:"NA",fireMode:"1_PER_SESSION",tags:["tag6a"]},{id:"6c",trigger:this.TriggerUserInfo,isMatch:false,token:"Acquisition",hasRegComp:"NA",userStatus:this.RFCodeGroupNewOptinAccountNA,optin:"BLINGO",gender:"NA",isAgeOver:"NA",group:"NA",fireMode:"1_PER_SESSION",tags:["tag6c"]},{id:"6d",trigger:this.TriggerUserInfo,isMatch:false,token:"Acquisition",hasRegComp:"NA",userStatus:this.RFCodeGroupNewOptinAccountNA,optin:"SURVEYS",gender:"NA",isAgeOver:"NA",group:"NA",fireMode:"1_PER_SESSION",tags:["tag6d"]},{id:"6e",trigger:this.TriggerUserInfo,isMatch:false,token:"Acquisition",hasRegComp:"NA",userStatus:this.RFCodeGroupNewOptinAccountNA,optin:"WINWAYS",gender:"NA",isAgeOver:"NA",group:"NA",fireMode:"1_PER_SESSION",tags:["tag6e"]},{id:"6f",trigger:this.TriggerUserInfo,isMatch:false,token:"Acquisition",hasRegComp:"NA",userStatus:this.RFCodeGroupNewOptinAccountNA,optin:"FRONTPAGE",gender:"NA",isAgeOver:"NA",group:"NA",fireMode:"1_PER_SESSION",tags:["tag6f"]},{id:"7",trigger:this.TriggerUserInfo,isMatch:false,token:"Acquisition",hasRegComp:"NA",userStatus:[this.RFCodes.ExAccReOptin],optin:"PCHCOM",gender:"NA",isAgeOver:"NA",group:"NA",fireMode:"1_PER_SESSION",tags:["tag7"]},{id:"8",trigger:this.TriggerUserInfo,isMatch:false,token:"Main Path",hasRegComp:"NA",userStatus:[this.RFCodes.NewAccNewOptin],optin:"PCHCOM",gender:"NA",isAgeOver:"NA",group:"NA",fireMode:"1_PER_SESSION",tags:["tag8"]},{id:"9",trigger:this.TriggerUserInfo,isMatch:false,token:"Acquisition",hasRegComp:"NA",userStatus:[this.RFCodes.ExAccNewOptin],optin:"PCHCOM",gender:"NA",isAgeOver:"NA",group:"NA",fireMode:"1_PER_SESSION",tags:["tag9"]},{id:"10a",trigger:this.TriggerPageSubmit,isMatch:false,token:"Acquisition",hasRegComp:"YES",userStatus:["NA"],optin:"NA",gender:"NA",isAgeOver:"NA",group:"NA",fireMode:"1_PER_PATH",tags:["tag10"]},{id:"10b",trigger:this.TriggerPageSubmit,isMatch:false,token:"Acquisition",hasRegComp:"YES",userStatus:["NA"],optin:"NA",gender:"NA",isAgeOver:"NA",group:"NA",fireMode:"1_PER_PATH",tags:["tag10"]},{id:"11",trigger:this.TriggerUserInfo,isMatch:false,token:"Main Path",hasRegComp:"NA",userStatus:[this.RFCodes.ExAccNewOptin],optin:"PCHCOM",gender:"NA",isAgeOver:"NA",group:"NA",fireMode:"1_PER_SESSION",tags:["tag11"]},{id:"12",trigger:this.TriggerUserInfo,isMatch:false,token:"Main Path",hasRegComp:"NA",userStatus:[this.RFCodes.ExAccReOptin],optin:"PCHCOM",gender:"NA",isAgeOver:"NA",group:"NA",fireMode:"1_PER_SESSION",tags:["tag12"]}];this.Tags={tag1:"type=optin098;cat=first870;",tag2a:"type=optin098;cat=group394;",tag2b:"type=optin098;cat=group012;",tag2c:"type=optin098;cat=group038;",tag2d:"type=optin098;cat=group908;",tag2e:"type=optin098;cat=group132;",tag2f:"type=optin098;cat=5bdef285;",tag2g:"type=optin098;cat=5cfem191;",tag2h:"type=optin098;cat=5cmal430;",tag2i:"type=optin098;cat=5cdef458;",tag2j:"type=optin098;cat=5dfem947;",tag2k:"type=optin098;cat=5dmal418;",tag2l:"type=optin098;cat=5ddef670;",tag2m:"type=optin098;cat=ftopt248;",tag3a:"type=conte292;cat=group303;",tag3b:"type=conte292;cat=group558;",tag3c:"type=conte292;cat=group632;",tag3d:"type=conte292;cat=group861;",tag3e:"type=conte292;cat=group251;",tag3f:"type=conte292;cat=group936;",tag4:"type=pagev405;cat=landi006;",tag5:"type=optin098;cat=total106;",tag6a:"type=pchlo273;cat=lotto160;",tag6b:"type=pchga656;cat=games563;",tag6c:"type=searc751;cat=searc607;",tag6d:"type=surve639;cat=surve343;",tag6e:"type=playa454;cat=playa818;",tag6f:"type=front997;cat=front132;",tag7:"type=optin098;cat=reopt596;",tag8:"type=mainp068;cat=ftopt402;",tag9:"type=optin098;cat=reopt857;",tag10:"type=pagev405;cat=regis175;",tag11:"type=mainp068;cat=mainp164;",tag12:"type=mainp068;cat=mainp027;"};this.Init=function(){this.Ctx={Path:this.PathData,Token:{Source:this.TokenSource},User:{IsNew:"YES",Gender:"FEMALE",IsAgeOver45:"NO",Age:0,Group:"NA",Status:"-1",IsOptinPchBefore:false}};this.UpdateContextualData();this.IsPathVisitTagFired=SpectrumAnalyticsHelper.HasTrigger("dfa",this.TriggerPathVisit);};this.UpdateContextualData=function(){if(window.SpectrumRegistrationResponseDto){var g=window.SpectrumRegistrationResponseDto.SpectrumCustomer.User;var h=window.SpectrumRegistrationResponseDto.SpectrumCustomer.UserInternal;var f=window.SpectrumRegistrationResponseDto.SpectrumCustomer.ScoringVariables;if(g.DateOfBirth&&g.DateOfBirth!=null&&g.DateOfBirth!=""){this.Ctx.User.Age=SpectrumUtils.GetAgeOrDefault(g.DateOfBirth,0);}if(f.SegmentName&&f.SegmentName!=null&&f.SegmentName!=""){this.Ctx.User.Group=f.SegmentName.replace("Group","");}this.Ctx.User.Gender=g.Title!=null&&g.Title.toLowerCase()=="mr."?"MALE":"FEMALE";this.Ctx.User.IsNew=h.IsNewUser?"YES":"NO";if(this.Ctx.User.Age>45){this.Ctx.User.IsAgeOver45="YES";}}};this.NotifyCompletion=function(){if(window.console&&console.log){console.log("DfaProvider -> Waiting a bit and notifying Reg. Core to continue...");}setTimeout("SpectrumAnalytics.OnPageSubmitCompleted('dfa', null, null)",this.OnCompleteWaitTime);};this.OnPageView=function(h,f){if(!this.IsPathVisitTagFired){var g=false;if(window.SpectrumRegistrationResponseDto){g=true;}this.UpdateContextualData();this.ProcessScenarios(this.TriggerPathVisit);if(g){this.ProcessScenarios(this.TriggerUserInfo);}this.FireDfa();SpectrumAnalyticsHelper.AddTrigger("dfa",this.TriggerPathVisit);}};this.OnMultiPageTabChanged=function(g,f){};this.OnUserInfoChanged=function(g,f){this.UpdateContextualData();this.ProcessScenarios(this.TriggerUserInfo);this.FireDfa();this.IsUserInfoChangedFired=true;};this.OnOptinsChanged=function(g,f){this.UpdateContextualData();this.ProcessScenarios(this.TriggerUserInfo);this.FireDfa();this.IsOptinsChangedFired=true;};this.OnOptinsRendered=function(g,f){};this.OnPageSubmitting=function(g,f){if(this.IsOptinsChangedFired||this.IsUserInfoChangedFired){this.ResetCounters();}this.ProcessScenarios(this.TriggerPageSubmit);this.FireDfa();if(window.console&&console.log){console.log("DfaProvider -> Page submitting notification received...");}if(this.TagsFired>=this.IFramesToAppendToBody.length){this.NotifyCompletion();}else{this.PageSubmitNotificationReceived=true;}};this.ProcessScenarios=function(h){this.Subscriptions=this.GetSubscriptions();for(var f=0;f<this.Scenarios.length;f++){var g=this.Scenarios[f];if(g.trigger==h){this.ProcessScenario(g);}}};this.ProcessScenario=function(h){if(this.IsMatchingScenario(h)){h.isMatch=true;for(var g=0;g<h.tags.length;g++){var i=h.tags[g];var j=i.substr("tag".length);if(h.fireMode=="1_PER_SESSION"&&this.HasTagBeenFiredAlready(i)){continue;}else{if(h.fireMode=="1_PER_PATH"&&SpectrumAnalyticsHelper.HasTag("dfa",j)){continue;}}var k=this.Tags[i];var f=this.BuildIFrameWithParamHtml(k);this.IFramesToAppendToBody.push(f);this.SaveFiredTagInCookie(h,i);}}};this.FireDfa=function(){if(this.IFramesToAppendToBody.length==0){return;}var f="";for(var h=0;h<this.IFramesToAppendToBody.length;h++){var g=this.IFramesToAppendToBody[h];f+=g+"<br />";}$("body").append(f);};this.IsMatchingScenario=function(g){if(g.token!=this.Ctx.Token.Source){return false;}if(!this.IsMatchingStatusCode(g)){return false;}if(g.gender!="NA"&&g.gender!=this.Ctx.User.Gender){return false;}if(g.isAgeOver!="NA"&&g.isAgeOver!=this.Ctx.User.IsAgeOver45){return false;}if(g.group!="NA"&&g.group!=this.Ctx.User.Group){return false;}var f=this.PathData.CurrentStep.HasRegistrationControl?"YES":"NO";if(g.hasRegComp!="NA"&&g.hasRegComp!=f){return false;}return true;};this.IsMatchingStatusCode=function(i){if(i.userStatus==null||i.userStatus.length==0){return false;}if(i.userStatus.length==1&&i.userStatus[0]=="NA"){return true;}if(i.optin=="NA"){return true;}var f=false;var h=this.GetOptinStatusCode(this.Subscriptions,i);if(h==-1){return false;}for(var g=0;g<i.userStatus.length;g++){var j=i.userStatus[g];if(j==h){f=true;break;}}return f;};this.GetSubscriptions=function(){var g=window.SpectrumRegistrationResponseDto;var f=g?g.SpectrumCustomer:null;var h=f?f.OptIns:null;var i=h?h.Subscriptions:null;return i;};this.GetOptinStatusCode=function(i,g){var f=g.optin;if(typeof i[f]=="undefined"){return -1;}var h=i[f];return h;};this.CreateRandomNumber=function(){var g=Math.random()+"";var f=g*10000000000000;return f;};this.BuildIFrameWithParamHtml=function(i){var h=this.CreateRandomNumber();var g=("https:"==document.location.protocol?"https://fls":"http://fls")+".doubleclick.net/activityi;src=2258832;"+i+"ord="+h+"?";var f=this.BuildIFrameHtml(g);return f;};this.BuildIFrameHtml=function(g){var f='<iframe src="'+g+'" width="1" height="1" frameborder="0" style="display:none" onload="SpectrumAnalytics.ProvidersByName.dfa.OnTagLoadComplete()"></iframe>';return f;};this.HasTagBeenFiredAlready=function(f){if(!f||!f.length){return true;}var g=f.substr("tag".length);return window.AnalyticsCookieHelper.HasTagBeenFiredAlready(g,this.CookieName,this.CookiePropertyCode);};this.SaveFiredTagInCookie=function(f,g){if(!g){return;}var h=g.substr("tag".length);if(f.fireMode=="1_PER_PATH"){window.SpectrumAnalyticsHelper.AddTag("dfa",h);}else{window.AnalyticsCookieHelper.SaveFiredTagInCookie(h,this.CookieName,this.CookiePropertyCode);}};this.OnTagLoadComplete=function(){var f=this;f.TagsFired=f.TagsFired+1;if(f.TagsFired>=f.IFramesToAppendToBody.length){if(window.console&&console.log){console.log("DfaProvider -> All tags fired, resetting counters...");}if(f.PageSubmitNotificationReceived){f.NotifyCompletion();f.PageSubmitNotificationReceived=false;}f.ResetCounters();}};this.ResetCounters=function(){this.IFramesToAppendToBody.length=0;this.TagsFired=0;};}var _gaq=_gaq||[];(function(){var a=document.createElement("script");a.type="text/javascript";a.async=true;a.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var b=document.getElementsByTagName("script")[0];b.parentNode.insertBefore(a,b);})();function GaProvider(b,a,d,e){this.Name="ga";this.Environment=b;this.Config=a;this.Metrics=d;this.PathData=e;this.AllowLinker=false;this.TriggerUserInfo="user_info";this.TriggerPageSubmit="PAGE_SUBMIT";this.TokenSourceAcq="Acquisition";this.TokenSourceMain="Main Path";this.TokenSourceHouse="House Email";this.ActionTypeSubmit="submit";this.ActionTypeUpdate="update";this.NEWOPTIN="NewOptin";this.REOPTIN="ReOptin";this.REACTIVATE="ReActivate";this.ACTIVEANDMAILABLE="MailableActive";this.OPTINUNCHECK="OptinUncheck";this.FTOPTIN="FTOptin";this.OTHER="Others";this.CookieName="SpecGA";this.CookieContent=null;this.OptinStatus=window.spectrumSubscriptionStatuses;this.optinTagCustomVarName="PCHMailableStatus";this.SubscriptionCodeCustomerNum=[{SubscriptionCode:"PCHCOM",CustomVariableNum:14,PropertyCode:"PC"},{SubscriptionCode:"BLINGO",CustomVariableNum:19,PropertyCode:"BL"},{SubscriptionCode:"LOTTO",CustomVariableNum:20,PropertyCode:"LO"},{SubscriptionCode:"WINWAYS",CustomVariableNum:21,PropertyCode:"WI"},{SubscriptionCode:"SAVEWIN",CustomVariableNum:22,PropertyCode:"SA"},{SubscriptionCode:"SURVEYS",CustomVariableNum:23,PropertyCode:"SU"},{SubscriptionCode:"FRONTPAGE",CustomVariableNum:40,PropertyCode:"FR"}];this.isRecognizedUser=false;this.Index_AccountType=1;this.Index_ScoreGroup=2;this.Index_RegistrantAge=3;this.Index_RegistrantGender=4;this.Index_TrafficSource=5;this.Index_DeviceType=6;this.Index_LoginStatus=7;this.Index_ShopperId=8;this.Index_MailID=9;this.Index_AudID=10;this.Index_TrackingToken=24;this.Index_UserAgentId=25;this.Index_CampaignType=35;this.TagForUserParam=[this.Index_AccountType,this.Index_ScoreGroup,this.Index_RegistrantAge,this.Index_RegistrantGender,this.Index_ShopperId];this.TagForHouseSourceParam=[this.Index_TrafficSource,this.Index_DeviceType,this.Index_LoginStatus,this.Index_MailID,this.Index_AudID,this.Index_TrackingToken,this.Index_UserAgentId,this.Index_CampaignType];this.TagForAcqOrMainSourceParam=[this.Index_TrafficSource,this.Index_DeviceType,this.Index_LoginStatus,this.Index_TrackingToken,this.Index_UserAgentId,this.Index_CampaignType];this.InitialPreCheckOptins=[];this.InitialNotPreCheckOptins=[];this.UserSubscriptions={};this.HasOnCompleteCallbackOnPageSubmit=true;this.OnCompleteWaitTime=this.Config&&this.Config.OnCompleteWaitTimeInMilliseconds?this.Config.OnCompleteWaitTimeInMilliseconds:500;this.PchOptinScenarios=[{id:"1",hasRegComp:"NA",isUserRecognized:"NA",trigger:this.TriggerPageSubmit,userOptinStatus:[this.OptinStatus.NewAccNewOptin],lastEntry91DaysOrOlder:"NA",optinStatusText:this.NEWOPTIN,trackEventSuffix:"",fireOnlyOnce:true},{id:"2",hasRegComp:"NA",isUserRecognized:"NA",trigger:this.TriggerPageSubmit,userOptinStatus:[this.OptinStatus.NewAccNoOptin],lastEntry91DaysOrOlder:"NA",optinStatusText:this.OPTINUNCHECK,trackEventSuffix:"New",fireOnlyOnce:true},{id:"3",hasRegComp:"NA",isUserRecognized:"NA",trigger:this.TriggerPageSubmit,userOptinStatus:[this.OptinStatus.ExAccNewOptin],lastEntry91DaysOrOlder:"NA",optinStatusText:this.FTOPTIN,trackEventSuffix:"",fireOnlyOnce:true},{id:"4",hasRegComp:"NA",isUserRecognized:"NA",trigger:this.TriggerPageSubmit,userOptinStatus:[this.OptinStatus.ExAccNoOptin],lastEntry91DaysOrOlder:"NA",optinStatusText:this.OPTINUNCHECK,trackEventSuffix:"ExistingNeverOpt",fireOnlyOnce:true},{id:"5",hasRegComp:"NA",isUserRecognized:"NA",trigger:this.TriggerPageSubmit,userOptinStatus:[this.OptinStatus.ExAccReOptin],lastEntry91DaysOrOlder:"NA",optinStatusText:this.REOPTIN,trackEventSuffix:"",fireOnlyOnce:true},{id:"6",hasRegComp:"NA",isUserRecognized:"NA",trigger:this.TriggerPageSubmit,userOptinStatus:[this.OptinStatus.ExAccEligReOptin],lastEntry91DaysOrOlder:"NA",optinStatusText:this.OPTINUNCHECK,trackEventSuffix:"ExistingReOpt",fireOnlyOnce:true},{id:"7a",hasRegComp:"YES",isUserRecognized:"NO",trigger:this.TriggerPageSubmit,userOptinStatus:[this.OptinStatus.ExAccExOptin],lastEntry91DaysOrOlder:"YES",optinStatusText:this.REACTIVATE,trackEventSuffix:"Unchecked",fireOnlyOnce:true},{id:"7b",hasRegComp:"YES",isUserRecognized:"NO",trigger:this.TriggerPageSubmit,userOptinStatus:[this.OptinStatus.ExAccRedunOptin],lastEntry91DaysOrOlder:"YES",optinStatusText:this.REACTIVATE,trackEventSuffix:"Redun",fireOnlyOnce:true},{id:"7c",hasRegComp:"YES",isUserRecognized:"YES",trigger:this.TriggerPageSubmit,userOptinStatus:[this.OptinStatus.ExAccExOptin],lastEntry91DaysOrOlder:"YES",optinStatusText:this.REACTIVATE,trackEventSuffix:"NoOptinBox",fireOnlyOnce:true},{id:"7d",hasRegComp:"YES",isUserRecognized:"NO",trigger:this.TriggerPageSubmit,userOptinStatus:[this.OptinStatus.ExAccExOptin],lastEntry91DaysOrOlder:"NO",optinStatusText:this.ACTIVEANDMAILABLE,trackEventSuffix:"Unchecked",fireOnlyOnce:true},{id:"7e",hasRegComp:"YES",isUserRecognized:"NO",trigger:this.TriggerPageSubmit,userOptinStatus:[this.OptinStatus.ExAccRedunOptin],lastEntry91DaysOrOlder:"NO",optinStatusText:this.ACTIVEANDMAILABLE,trackEventSuffix:"Redun",fireOnlyOnce:true},{id:"7f",hasRegComp:"YES",isUserRecognized:"YES",trigger:this.TriggerPageSubmit,userOptinStatus:[this.OptinStatus.ExAccExOptin],lastEntry91DaysOrOlder:"NO",optinStatusText:this.ACTIVEANDMAILABLE,trackEventSuffix:"NoOptinBox",fireOnlyOnce:true},{id:"8",hasRegComp:"NA",isUserRecognized:"NA",trigger:this.TriggerPageSubmit,userOptinStatus:[this.OptinStatus.ExAccTermUnsub],lastEntry91DaysOrOlder:"NA",optinStatusText:this.OTHER,trackEventSuffix:"TermUnsub",fireOnlyOnce:true},{id:"9",hasRegComp:"NA",isUserRecognized:"NA",trigger:this.TriggerPageSubmit,userOptinStatus:[this.OptinStatus.ExAccTermReject],lastEntry91DaysOrOlder:"NA",optinStatusText:this.OTHER,trackEventSuffix:"TermReject",fireOnlyOnce:true},{id:"10",hasRegComp:"NA",isUserRecognized:"NA",trigger:this.TriggerPageSubmit,userOptinStatus:[this.OptinStatus.ExAccLockedUnsub],lastEntry91DaysOrOlder:"NA",optinStatusText:this.OTHER,trackEventSuffix:"LockedUnsub",fireOnlyOnce:true},{id:"11",hasRegComp:"NA",isUserRecognized:"NA",trigger:this.TriggerPageSubmit,userOptinStatus:[this.OptinStatus.ExAccLockedReject],lastEntry91DaysOrOlder:"NA",optinStatusText:this.OTHER,trackEventSuffix:"LockedReject",fireOnlyOnce:true},{id:"-1",hasRegComp:"NA",isUserRecognized:"NA",trigger:this.TriggerPageSubmit,userOptinStatus:["NA"],lastEntry91DaysOrOlder:"NA",optinStatusText:this.OTHER,trackEventSuffix:"Misc",fireOnlyOnce:true}];this.NonPchOptinScenarios=[{id:"1",hasRegComp:"NA",isUserRecognized:"NA",trigger:this.TriggerPageSubmit,userOptinStatus:[this.OptinStatus.NewAccNewOptin],lastEntry91DaysOrOlder:"NA",optinStatusText:this.NEWOPTIN,trackEventSuffix:"",fireOnlyOnce:true},{id:"2",hasRegComp:"NA",isUserRecognized:"NA",trigger:this.TriggerPageSubmit,userOptinStatus:[this.OptinStatus.NewAccNoOptin],lastEntry91DaysOrOlder:"NA",optinStatusText:this.OPTINUNCHECK,trackEventSuffix:"New",fireOnlyOnce:true},{id:"3",hasRegComp:"NA",isUserRecognized:"NA",trigger:this.TriggerPageSubmit,userOptinStatus:[this.OptinStatus.ExAccNewOptin],lastEntry91DaysOrOlder:"NA",optinStatusText:this.FTOPTIN,trackEventSuffix:"",fireOnlyOnce:true},{id:"4",hasRegComp:"NA",isUserRecognized:"NA",trigger:this.TriggerPageSubmit,userOptinStatus:[this.OptinStatus.ExAccNoOptin],lastEntry91DaysOrOlder:"NA",optinStatusText:this.OPTINUNCHECK,trackEventSuffix:"ExistingPropertyAcctNeverOpt",fireOnlyOnce:true},{id:"5",hasRegComp:"NA",isUserRecognized:"NA",trigger:this.TriggerPageSubmit,userOptinStatus:[this.OptinStatus.NoAccNewOptin],lastEntry91DaysOrOlder:"NA",optinStatusText:this.NEWOPTIN,trackEventSuffix:"ExistingPropertyAcctNewOpt",fireOnlyOnce:true},{id:"6",hasRegComp:"NA",isUserRecognized:"NA",trigger:this.TriggerPageSubmit,userOptinStatus:[this.OptinStatus.NoAccNoOptin],lastEntry91DaysOrOlder:"NA",optinStatusText:this.OPTINUNCHECK,trackEventSuffix:"ExistingPropertyAcctNeverOpt",fireOnlyOnce:true},{id:"7",hasRegComp:"NA",isUserRecognized:"NA",trigger:this.TriggerPageSubmit,userOptinStatus:[this.OptinStatus.ExAccReOptin],lastEntry91DaysOrOlder:"NA",optinStatusText:this.REOPTIN,trackEventSuffix:"",fireOnlyOnce:true},{id:"8",hasRegComp:"NA",isUserRecognized:"NA",trigger:this.TriggerPageSubmit,userOptinStatus:[this.OptinStatus.ExAccEligReOptin],lastEntry91DaysOrOlder:"NA",optinStatusText:this.OPTINUNCHECK,trackEventSuffix:"ExistingPropertyAcctReOpt",fireOnlyOnce:true},{id:"9",hasRegComp:"NA",isUserRecognized:"NA",trigger:this.TriggerPageSubmit,userOptinStatus:[this.OptinStatus.NoAccReOptin],lastEntry91DaysOrOlder:"NA",optinStatusText:this.REOPTIN,trackEventSuffix:"NoPropertyAcct",fireOnlyOnce:true},{id:"10",hasRegComp:"NA",isUserRecognized:"NA",trigger:this.TriggerPageSubmit,userOptinStatus:[this.OptinStatus.NoAccEligReOptin],lastEntry91DaysOrOlder:"NA",optinStatusText:this.OPTINUNCHECK,trackEventSuffix:"NoPropertyAcctReOpt",fireOnlyOnce:true},{id:"11",hasRegComp:"NA",isUserRecognized:"NA",trigger:this.TriggerPageSubmit,userOptinStatus:[this.OptinStatus.ExAccExOptin],lastEntry91DaysOrOlder:"NO",optinStatusText:this.ACTIVEANDMAILABLE,trackEventSuffix:"",fireOnlyOnce:true},{id:"12",hasRegComp:"NA",isUserRecognized:"NA",trigger:this.TriggerPageSubmit,userOptinStatus:[this.OptinStatus.ExAccRedunOptin],lastEntry91DaysOrOlder:"NO",optinStatusText:this.ACTIVEANDMAILABLE,trackEventSuffix:"Redun",fireOnlyOnce:true},{id:"13",hasRegComp:"NA",isUserRecognized:"NA",trigger:this.TriggerPageSubmit,userOptinStatus:[this.OptinStatus.NoAccExOptin],lastEntry91DaysOrOlder:"NO",optinStatusText:this.ACTIVEANDMAILABLE,trackEventSuffix:"NoPropertyAcct",fireOnlyOnce:true},{id:"14",hasRegComp:"NA",isUserRecognized:"NA",trigger:this.TriggerPageSubmit,userOptinStatus:[this.OptinStatus.NoAccRedunOptin],lastEntry91DaysOrOlder:"NO",optinStatusText:this.ACTIVEANDMAILABLE,trackEventSuffix:"NoPropertyAcctRedun",fireOnlyOnce:true},{id:"15",hasRegComp:"NA",isUserRecognized:"NA",trigger:this.TriggerPageSubmit,userOptinStatus:[this.OptinStatus.ExAccTermUnsub],lastEntry91DaysOrOlder:"NO",optinStatusText:this.OTHER,trackEventSuffix:"TermUnsub",fireOnlyOnce:true},{id:"16",hasRegComp:"NA",isUserRecognized:"NA",trigger:this.TriggerPageSubmit,userOptinStatus:[this.OptinStatus.ExAccTermReject],lastEntry91DaysOrOlder:"NO",optinStatusText:this.OTHER,trackEventSuffix:"TermReject",fireOnlyOnce:true},{id:"17",hasRegComp:"NA",isUserRecognized:"NA",trigger:this.TriggerPageSubmit,userOptinStatus:[this.OptinStatus.ExAccLockedUnsub],lastEntry91DaysOrOlder:"NA",optinStatusText:this.OTHER,trackEventSuffix:"LockedUnsub",fireOnlyOnce:true},{id:"18",hasRegComp:"NA",isUserRecognized:"NA",trigger:this.TriggerPageSubmit,userOptinStatus:[this.OptinStatus.ExAccLockedReject],lastEntry91DaysOrOlder:"NA",optinStatusText:this.OTHER,trackEventSuffix:"LockedReject",fireOnlyOnce:true},{id:"19",hasRegComp:"NA",isUserRecognized:"NA",trigger:this.TriggerPageSubmit,userOptinStatus:[this.OptinStatus.NoAccTermUnsub],lastEntry91DaysOrOlder:"NO",optinStatusText:this.OTHER,trackEventSuffix:"NoPropertyAcctTermUnsub",fireOnlyOnce:true},{id:"20",hasRegComp:"NA",isUserRecognized:"NA",trigger:this.TriggerPageSubmit,userOptinStatus:[this.OptinStatus.NoAccTermReject],lastEntry91DaysOrOlder:"NO",optinStatusText:this.OTHER,trackEventSuffix:"NoPropertyAcctTermReject",fireOnlyOnce:true},{id:"21",hasRegComp:"NA",isUserRecognized:"NA",trigger:this.TriggerPageSubmit,userOptinStatus:[this.OptinStatus.NoAccLockedUnsub],lastEntry91DaysOrOlder:"NA",optinStatusText:this.OTHER,trackEventSuffix:"NoPropertyAcctLockedUnsub",fireOnlyOnce:true},{id:"22",hasRegComp:"NA",isUserRecognized:"NA",trigger:this.TriggerPageSubmit,userOptinStatus:[this.OptinStatus.NoAccLockedReject],lastEntry91DaysOrOlder:"NA",optinStatusText:this.OTHER,trackEventSuffix:"NoPropertyAcctLockedReject",fireOnlyOnce:true},{id:"-1",hasRegComp:"NA",isUserRecognized:"NA",trigger:this.TriggerPageSubmit,userOptinStatus:["NA"],lastEntry91DaysOrOlder:"NA",optinStatusText:this.OTHER,trackEventSuffix:"Misc",fireOnlyOnce:true}];this.OnPageView=function(){this.isRecognizedUser=window.SpectrumRegistrationCore.IsUserRecognized();};this.Init=function(){if(this.Environment=="prod"){this.AllowLinker=true;}this.SubscribeForDeviceAttributes();var f=window.GetCookie(this.CookieName);this.CookieContent=(f&&f.length)?window.AnalyticsCookieHelper.ConvertStringToHash(f):{};};this.OnUserInfoChanged=function(g,f){if(g&&!g.IsSubmitButtonClicked){this.UserInfoUpdatOrSubmit(this.ActionTypeUpdate,this.TriggerUserInfo);}};this.OnPageSubmitting=function(h,f){this.UserInfoUpdatOrSubmit(this.ActionTypeSubmit,this.TriggerUserInfo);if(!SpectrumAnalyticsHelper.HasTrigger(this.Name,this.ActionTypeSubmit)){SpectrumAnalyticsHelper.AddTrigger(this.Name,this.ActionTypeSubmit);}var g=this;this.TryExecute(function(){g.UserSubscriptions=window.SpectrumRegistrationCore.GetUserSubscriptions();g.SetRFAPICodeForNotFoundProperties();g.ProcessOptinScenarios(g.TriggerPageSubmit);});if(window.console&&console.log){console.log("GaProvider -> Waiting a bit and notifying Reg. Core to continue...");}setTimeout("if(window.SpectrumAnalytics) window.SpectrumAnalytics.OnPageSubmitCompleted('ga', null, null)",this.OnCompleteWaitTime);};this.OnElementClick=function(i,f){var h=this;var g=h.GetPageNameEx();this.LogInfo("GaProvider.OnElementClick "+h.Metrics.DeviceType+", "+g+", "+f.linkLabel);_gaq.push(["_trackPageview","/vp/PCHCOM/"+h.Metrics.DeviceType+g+"/"+f.linkLabel]);};this.UserInfoUpdatOrSubmit=function(f,h){if(f==this.ActionTypeSubmit&&SpectrumAnalyticsHelper.HasTrigger(this.Name,this.ActionTypeSubmit)){return;}var g=this;this.TryExecute(function(){if(window.SpectrumRegistrationResponseDto&&g.PathData.CurrentStep.HasRegistrationControl){g.BuildAccountParams();g.BuildParams(g.TagForUserParam);_gaq.push(["_trackPageview","/vp"+g.GetPageName()+"/"+f]);}});};this.OnOptinsChanged=function(){};this.OnOptinsRendered=function(h,f){var g=this;this.TryExecute(function(){if(!window.SpectrumDeviceManager){return;}var k=g.CreateOptinInstanceFilter();var n=window.SpectrumDeviceManager;n.ForEachStepDeviceInstance(k,function(i){g.InitialPreCheckOptins=g.ConvertDicToArray(i.GetOptinsFromModel(true));g.InitialNotPreCheckOptins=g.ConvertDicToArray(i.GetOptinsFromModel(false));});g.BuildAccountParams();if(g.isRecognizedUser){g.UserSubscriptions=window.SpectrumRegistrationCore.GetUserSubscriptions();}var l;for(var j=0;j<g.InitialPreCheckOptins.length;j++){l=g.InitialPreCheckOptins[j];if(g.IsOptinAlreadySubscribed(l)){continue;}_gaq.push(["_trackEvent",l,"OptinView",g.GetPageName()+"/Prechecked",0,true]);}for(var o=0;o<g.InitialNotPreCheckOptins.length;o++){l=g.InitialNotPreCheckOptins[o];if(g.IsOptinAlreadySubscribed(l)){continue;}_gaq.push(["_trackEvent",l,"OptinView",g.GetPageName()+"/NotPrechecked",0,true]);}});};this.OnMultiPageTabChanged=function(h,f){var g=this;this.TryExecute(function(){g.BuildAccountParams();var i=f.tabName;_gaq.push(["_trackPageview",g.GetPageName()+"/"+i]);});};this.OnCartOrderComplete=function(h,f){var g=this;this.TryExecute(function(){var k=f.Order;var l=f.Order.OrderId.toString();if(k.Items.length==0){return;}g.BuildAccountParams();_gaq.push(["_addTrans",l,k.PathStepName,k.TotalOrderPrice.toString(),k.TaxAmount.toString(),k.ShippingFees.toString(),k.Address.City,k.Address.State,k.Address.Country]);for(var j=0;j<k.Items.length;j++){var i=k.Items[j];var n=g.ConvertOfferTypeIdtoProdCategory(i.OfferTypeId);_gaq.push(["_addItem",l,i.ProductId,i.ProdName,n,i.UnitPrice.toString(),i.Quantity.toString()]);}_gaq.push(["_trackTrans"]);});};this.OnContestEntry=function(h,f){var g=this;this.TryExecute(function(){var i=""+f.BillmeEntryId+"";var j=g.GetPageName();g.BuildAccountParams();_gaq.push(["_setCustomVar",26,"ContestEntry",i,2]);_gaq.push(["_trackPageview",j]);});};this.BuildAccountParams=function(){_gaq.push(["_setAccount",this.Config.AccountId]);_gaq.push(["_setDomainName",this.Config.Domain]);if(this.AllowLinker){_gaq.push(["_setAllowLinker",true]);}_gaq.push(["_setCampaignCookieTimeout",0]);};this.BuildParams=function(h){for(var f=0;f<h.length;f++){var g=h[f];if(g===this.Index_AccountType){_gaq.push(["_setCustomVar",this.Index_AccountType,"AccountType",this.Metrics.NewUserStatus,1]);}else{if(g===this.Index_ScoreGroup){_gaq.push(["_setCustomVar",this.Index_ScoreGroup,"ScoreGroup",this.Metrics.ScoreGroup,1]);}else{if(g===this.Index_RegistrantAge){_gaq.push(["_setCustomVar",this.Index_RegistrantAge,"RegistrantAge",this.Metrics.Age,1]);}else{if(g===this.Index_RegistrantGender){_gaq.push(["_setCustomVar",this.Index_RegistrantGender,"RegistrantGender",this.Metrics.Gender,1]);}else{if(g===this.Index_TrafficSource){_gaq.push(["_setCustomVar",this.Index_TrafficSource,"TrafficSource",this.Metrics.Sources,2]);}else{if(g===this.Index_DeviceType){_gaq.push(["_setCustomVar",this.Index_DeviceType,"DeviceType",this.Metrics.DeviceType,2]);}else{if(g===this.Index_LoginStatus){_gaq.push(["_setCustomVar",this.Index_LoginStatus,"LoginStatus","",2]);}else{if(g===this.Index_ShopperId){_gaq.push(["_setCustomVar",this.Index_ShopperId,"GMT",this.Metrics.ShopId,1]);}else{if(g===this.Index_MailID){_gaq.push(["_setCustomVar",this.Index_MailID,"MailID",this.PathData.CurrentStep.MailId,1]);}else{if(g===this.Index_AudID){_gaq.push(["_setCustomVar",this.Index_AudID,"AudID",this.PathData.SegId,1]);}else{if(g===this.Index_TrackingToken){_gaq.push(["_setCustomVar",this.Index_TrackingToken,"TrackingToken",this.Metrics.TrackingToken,2]);}else{if(g===this.Index_UserAgentId){_gaq.push(["_setCustomVar",this.Index_UserAgentId,"UserAgent",this.Metrics.UserAgentId,2]);}else{if(g===this.Index_CampaignType){_gaq.push(["_setCustomVar",this.Index_CampaignType,"CampaignType",this.Metrics.CampaignType,2]);}}}}}}}}}}}}}}};this.ConvertDicToArray=function(f){var h=[];for(var g in f){if(f.hasOwnProperty(g)){h.push(g);}}return h;};this.TryExecute=function(f){try{f();}catch(g){this.LogError(g);}};this.ProcessOptinScenarios=function(n){var l=this;for(var f=0;f<l.SubscriptionCodeCustomerNum.length;f++){var j=l.SubscriptionCodeCustomerNum[f];if(!l.IsOptinPresentInUserSubcscription(j.SubscriptionCode)){continue;}if(j.SubscriptionCode=="PCHCOM"){for(var h=0;h<this.PchOptinScenarios.length;h++){var k=this.PchOptinScenarios[h];if(k.trigger==n){k.optin=j.SubscriptionCode;k.optinTagCustomVarNum=j.CustomVariableNum;k.propertyCode=j.PropertyCode;if(this.IsOptinScenarioValidToProcess(k)){this.ProcessOptinScenario(k);}}}}else{for(var g=0;g<this.NonPchOptinScenarios.length;g++){var i=this.NonPchOptinScenarios[g];if(i.trigger==n){i.optin=j.SubscriptionCode;i.optinTagCustomVarNum=j.CustomVariableNum;i.propertyCode=j.PropertyCode;if(this.IsOptinScenarioValidToProcess(i)){this.ProcessOptinScenario(i);}}}}}window.AnalyticsCookieHelper.SaveTagsInCookie(this.CookieName,this.CookieContent);};this.IsOptinScenarioValidToProcess=function(g){var f=window.AnalyticsCookieHelper.HasTagBeenFiredAlready(g.id,this.CookieName,g.propertyCode,this.CookieContent);if(g.fireOnlyOnce&&f){return false;}if(window.AnalyticsCookieHelper.HasAnyTagFiredAlready(this.CookieName,g.propertyCode,this.CookieContent)&&g.id==-1){return false;}return true;};this.ProcessOptinScenario=function(f){if(this.IsMatchingScenario(f)){_gaq.push(["_setCustomVar",f.optinTagCustomVarNum,this.optinTagCustomVarName,f.optinStatusText,2]);var g=f.trackEventSuffix==""?"":"-"+f.trackEventSuffix;_gaq.push(["_trackEvent",f.optin,f.optinStatusText,this.GetPageName()+g]);if(f.fireOnlyOnce&&window.AnalyticsCookieHelper){window.AnalyticsCookieHelper.AppendTagIdToHash(f.id,f.propertyCode,this.CookieContent);}else{this.SaveFiredTagInCookie(f.id,this.CookieName,f.propertyCode);}}};this.IsMatchingScenario=function(j){var k=this;var g=k.isRecognizedUser?"YES":"NO";if(j.isUserRecognized!="NA"&&j.isUserRecognized!=g){return false;}var l=k.UserSubscriptions;if(j.optin!="NA"&&!k.IsMatchingStatusCode(j,l)){return false;}var f=k.PathData.CurrentStep.HasRegistrationControl?"YES":"NO";if(j.hasRegComp!="NA"&&j.hasRegComp!=f){return false;}if(!k.isOptinConfiguredToBeDisplayedInPage(j.optin)){return false;}var i=new Date();if(window.SpectrumRegistrationResponseDto&&window.SpectrumRegistrationResponseDto.SpectrumCustomer&&window.SpectrumRegistrationResponseDto.SpectrumCustomer.SessionProfile&&window.SpectrumRegistrationResponseDto.SpectrumCustomer.SessionProfile&&window.SpectrumRegistrationResponseDto.SpectrumCustomer.SessionProfile.ProfileDataInUse&&window.SpectrumRegistrationResponseDto.SpectrumCustomer.SessionProfile.ProfileDataInUse.LastEntryDate){i=window.SpectrumRegistrationResponseDto.SpectrumCustomer.SessionProfile.ProfileDataInUse.LastEntryDate;if(typeof i!=="string"){i=i.value;}}var h=this.IsDateOlderThanOrEqual(i,91)?"YES":"NO";if(j.lastEntry91DaysOrOlder!="NA"&&j.lastEntry91DaysOrOlder!=h){return false;}return true;};this.isOptinConfiguredToBeDisplayedInPage=function(f){if(this.InitialPreCheckOptins&&this.InitialPreCheckOptins.length&&$.inArray(f,this.InitialPreCheckOptins)>=0){return true;}if(this.InitialNotPreCheckOptins&&this.InitialNotPreCheckOptins.length&&$.inArray(f,this.InitialNotPreCheckOptins)>=0){return true;}return false;};this.OnRegLightboxEvent=function(h,f){var g="'"+f.eventName+"' '"+f.lightboxName+"'";if(f.errorCode&&f.errorCode.length){g=g+" '"+f.errorCode+"'";}this.LogInfo("GaProvider.OnRegLightboxEvent "+g);_gaq.push(["_trackEvent",f.lightboxName,f.eventName,this.GetPageName()+(f.errorCode?"/"+f.errorCode:"")]);};this.OnRegistrationPageView=function(g,f){this.LogInfo("GaProvider.OnRegistrationPageView '"+f.viewCode+"'");_gaq.push(["_trackPageview","/vp"+this.GetPageName()+(f.viewCode?"/"+f.viewCode:"")]);};this.OnContinueShoppingEvent=function(g,f){this.LogInfo("GaProvider.OnContinueShoppingEvent '"+f.buttonName+"'");_gaq.push(["_trackPageview","/vp"+this.GetPageName()+(f.buttonName?"/"+f.buttonName:"")]);};this.OnDeviceTypeKnown=function(f,h){var g=f;g.TryExecute(function(){g.BuildAccountParams();g.Metrics.DeviceType=h.UserAgentProperties.DeviceType.toLowerCase();var i=h.UserAgentProperties.UserAgentId;g.Metrics.UserAgentId=isNaN(i)?null:i.toString();if(g.PathData.CurrentToken.Source===g.TokenSourceAcq||g.PathData.CurrentToken.Source===g.TokenSourceMain){g.BuildParams(g.TagForAcqOrMainSourceParam);}if(g.PathData.CurrentToken.Source===g.TokenSourceHouse){g.BuildParams(g.TagForHouseSourceParam);}if(!g.Metrics.DisableDefaultPageView){_gaq.push(["_trackPageview",g.GetPageName()]);}});};this.OnUserIdentityEvent=function(h,f){var g=this;this.LogInfo("GaProvider.OnUserIdentityEvent "+f.eventType+", "+f.messageType+", "+g.Metrics.DeviceType);_gaq.push(["_trackEvent","UserIdentity/"+g.Metrics.DeviceType,f.eventType,f.messageType,0,true]);if(f.eventType==="Click"){if(window.console&&console.log){console.log("GaProvider -> Waiting a bit and notifying User Identity subscribers to continue...");}setTimeout("if(window.SpectrumAnalytics) window.SpectrumAnalytics.OnPageSubmitCompleted('ga', null, null)",this.OnCompleteWaitTime);}};this.OnProductRecommendationVisible=function(g,f){this.LogInfo("GaProvider.OnProductRecommendationVisible "+f.path);if(f&&f.Products){$.each(f.Products,function(i,h){_gaq.push(["_trackEvent","Spectrum/Fusion","ProductView",f.path+"/"+h,0,true]);});}};this.OnFusionProductTabRenderOrItemAdded=function(g,f){if(!f){return;}this.LogInfo("GaProvider.OnFusionProductTabRenderOrItemAdded "+f.eventType+", "+f.eventLabel);_gaq.push(["_trackEvent","Spectrum/Fusion",f.eventType,f.eventLabel,0,true]);};this.OnSAGPopupView=function(){this.LogInfo("GaProvider.OnSAGPopupView");_gaq.push(["_trackEvent","Spectrum/StopandGoPopUp","View",this.GetPageName(),0,true]);};this.OnSAGTakeAnotherLookButtonClick=function(g,f){if(!f){return;}this.LogInfo("GaProvider.OnSAGTakeAnotherLookButtonClick");_gaq.push(["_trackEvent","Spectrum/StopandGoPopUp ",f.buttonName+"Clk",this.GetPageName(),0,true]);};this.OnSAGNoThanksButtonClick=function(g,f){if(!f){return;}this.LogInfo("GaProvider.OnSAGNoThanksButtonClick");_gaq.push(["_trackEvent"," Spectrum/StopandGoPopUp ",f.buttonName+"Clk",this.GetPageName(),0,true]);};this.LogInfo=function(f){if(window.console&&typeof window.console.info==="function"){window.console.info(f);}};this.LogError=function(f){if(window.console&&typeof window.console.error==="function"){window.console.error("GA provider -> "+f);}};this.LogWarn=function(f){if(window.console&&typeof window.console.warn==="function"){window.console.warn("GA provider -> "+f);}};this.GetPageNameEx=function(){if(this.PathData.CurrentStep){return this.GetPageName();}else{var g=window.location.pathname.match(/[/]([^/^?]*)+?/g);var f=g.length-1;return g[f-1]+g[f].replace(/[.][^.]+/,"");}};this.GetPageName=function(){return SpectrumUtils.GetPathAndStepName();};this.SubscribeForDeviceAttributes=function(){if(!window.SpectrumDeviceAnalyzerService){this.LogWarn("Include SpectrumDeviceAnalyzerService.js");return;}if(!window.Notifications){this.LogWarn("Include Notifications.js");return;}var g=this;var f=function(){g.OnDeviceTypeKnown(g,window.SpectrumDeviceAnalyzerResponseDto);};if(!window.SpectrumDeviceAnalyzerResponseDto){window.Notifications.Subscribe("on-device-attributes-available",f,false);}else{f();}};this.ConvertOfferTypeIdtoProdCategory=function(f){if(window.isNaN(f)||f===0){return"";}return(f==1)?"Mag":"Merch";};this.IsDateOlderThanOrEqual=function(f,h){if(!f||f==""){return false;}var g=SpectrumUtils.GetDaysBetween(f);if(isNaN(g)){return false;}return g>=h;};this.IsMatchingStatusCode=function(h,k){if(h.userOptinStatus==null||h.userOptinStatus.length==0){return false;}if(h.userOptinStatus.length==1&&h.userOptinStatus[0]=="NA"){return true;}var f=false;for(var j in k){if(j==""||j!=h.optin){continue;}for(var g=0;g<h.userOptinStatus.length;g++){var i=h.userOptinStatus[g];if(i==k[j]){f=true;break;}}}return f;};this.SetRFAPICodeForNotFoundProperties=function(){var h=this;var g=h.InitialPreCheckOptins;g=g.concat(h.InitialNotPreCheckOptins);for(var f=0;f<g.length;f++){if(h.UserSubscriptions[g[f]]==null){h.UserSubscriptions[g[f]]=1;}}};this.CreateOptinInstanceFilter=function(){var f={DeviceType:"Optin",PresentationStyle:DevicePresentationStyles.InPage};return f;};this.IsOptinPresentInUserSubcscription=function(g){var f=this;if(f.UserSubscriptions[g]){return true;}return false;};this.IsOptinAlreadySubscribed=function(g){var f=this;if(f.UserSubscriptions[g]&&f.UserSubscriptions[g]!=1){return true;}return false;};}function GtmProvider(a,b,d){this.Name="Gtm";this.Config=a;this.Metrics=b;this.PathData=d;this.TokenSource=d.CurrentToken.Source;this.SubscriptionCode_PCHCOM="PCHCOM";this.EventNames={Optin:"Optin"};this.OptinStatus=window.spectrumSubscriptionStatuses;}GtmProvider.prototype.Init=function(){this.CreateDataLayer();if(!this.Config||!this.Config.Snippet||!this.Config.Snippet.length){return;}$("form").append(this.Config.Snippet);};GtmProvider.prototype.CreateDataLayer=function(){window.spectrumGtmDataLayer=[{TokenSource:this.TokenSource}];this.AddSubscriptionsToDataLayer();this.AddQueryParams();var a=SpectrumGtmCookie.GetPendingEvents();if(!a||!a.length){return;}this.AddPendingEventsToDataLayer(a);SpectrumGtmCookie.MoveAllPendingEventsToProcessed();};GtmProvider.prototype.OnUserInfoChanged=function(){if(!SpectrumRegistrationCore.Presenter.IsOptinDevicePresent()){return;}if(SpectrumGtmCookie.IsEventProcessed(this.EventNames.Optin)){return;}SpectrumGtmCookie.AddPendingEvent(this.EventNames.Optin);};GtmProvider.prototype.AddSubscriptionsToDataLayer=function(){var d=this;var a={};var f=this.GetUserSubscriptions();if(!f||$.isEmptyObject(f)){return;}for(var e in f){var b=this.CalculateSubscriptionStatus(e);var g=d.GetOptinEventName(e);a[g]=b;}spectrumGtmDataLayer.push(a);};GtmProvider.prototype.CalculateSubscriptionStatus=function(e){var d=this;var f=this.GetUserSubscriptions();var g=f[e];var a=parseInt(g);var b;switch(a){case d.OptinStatus.NewAccNewOptin:b="NewAccountNewOptin";break;case d.OptinStatus.ExAccNewOptin:b="ExistingAccountNewOptin";break;case d.OptinStatus.ExAccReOptin:b="ExistingAccountReOptin";break;default:b="Unknown";}return b;};GtmProvider.prototype.GetUserSubscriptions=function(){var b=window.SpectrumRegistrationResponseDto;var a=b?b.SpectrumCustomer:null;var d=a?a.OptIns:null;return d?d.Subscriptions:null;};GtmProvider.prototype.IsNewUser=function(){if(!window.SpectrumRegistrationResponseDto||!SpectrumRegistrationResponseDto.SpectrumCustomer.UserInternal){return null;}return SpectrumRegistrationResponseDto.SpectrumCustomer.UserInternal.IsNewUser;};GtmProvider.prototype.AddPendingEventsToDataLayer=function(b){if(!b||!b.length){return;}for(var a=0;a<b.length;a++){spectrumGtmDataLayer.push({event:b[a]});}};GtmProvider.prototype.GetOptinEventName=function(a){return"OptinStatus_"+a;};GtmProvider.prototype.AddQueryParams=function(){var f=SpectrumCookieManager.GetExtraQueryParams();for(var b in f){if(!b){return;}var d=f[b];var e="QP_"+b;var a={};a[e]=d;spectrumGtmDataLayer.push(a);}};function EvergageProvider(a,b,d){this.Config=a;this.Metrics=b;this.PathData=d;}EvergageProvider.prototype.Init=function(){};EvergageProvider.prototype.OnPageView=function(){var a=this;a.CreateEvergageUserProviderObj();if(!a.Config||!a.Config.Snippet||!a.Config.Snippet.length){return;}var b=(a.Config.Snippet.indexOf("{{= CustomTags }}")>-1)?a.Config.Snippet.replace("{{= CustomTags }}",""):a.Config.Snippet;$("head").append(b);};EvergageProvider.prototype.CreateEvergageUserProviderObj=function(){var a=this;window.EvergageUserProvider={userID:a.Metrics.ShopId,email:a.Metrics.EmailHash,title:a.Metrics.Title,fullName:a.Metrics.FirstName+" "+a.Metrics.LastName,firstName:a.Metrics.FirstName,lastName:a.Metrics.LastName,age:a.Metrics.Age,state:a.Metrics.State,propertyMembership:SpectrumUtils.SortCollection(a.Metrics.Registrations),segmentMembership:SpectrumUtils.SortCollection(a.Metrics.SegCodes),daysSinceLastEntry:a.Metrics.DaysSinceLastEntry,firstEverRegDate:a.Metrics.FirstEverRegDate};};(function(b){var a={SaveFiredTagInCookie:function(i,e,f){if(!i||!i.length){return;}if(!f){return;}var d=window.GetCookie(e);var h=this;var g=h.ConvertStringToHash(d);g=h.AppendTagIdToHash(i,f,g);h.SaveTagsInCookie(e,g);},SaveTagsInCookie:function(f,d){var g=this;var e=g.ConvertHashToString(d);window.SetCookie(f,e,null,"/",window.globalDomainName);},HasTagBeenFiredAlready:function(i,f,g,d){if(!i||!i.length){return true;}if(!g){return true;}var j;var h=this;if(!d){var e=window.GetCookie(f);if(!e||!e.length){return false;}j=h.GetTagsByPropertyCode(e,g);}else{j=d[g];}if(!j||j.length<=0){return false;}return h.HasItemInArray(i,j);},HasAnyTagFiredAlready:function(f,g,d){var i;if(!d){var e=window.GetCookie(f);if(!e||!e.length){return false;}var h=this;i=h.GetTagsByPropertyCode(e,g);}else{i=d[g];}return(i&&i.length>0)?true:false;},ConvertHashToString:function(d){var e=window.SpectrumUtils;return e.ConvertHashtableToDelimitedString(d,"^","~");},ConvertStringToHash:function(g){if(!g||g.length<=0){return new Object();}var f=window.SpectrumUtils;var e=f.ParseValueAsHashtable(g,null,"^","~");if(!e){return null;}for(var d in e){if(!d||!e[d]){continue;}e[d]=e[d].split(",");}return e;},AppendTagIdToHash:function(g,d,e){if(!g||g.length<=0||!d){return e;}var h=e[d]||new Array();var f=this;if(!f.HasItemInArray(g,h)){h.push(g);}e[d]=h;return e;},GetTagsByPropertyCode:function(d,e){var g=this;var f=g.ConvertStringToHash(d);return f[e];},HasItemInArray:function(e,d){return $.inArray(e,d)>=0;}};b.AnalyticsCookieHelper=a;}(window));var SpectrumGtmCookie={CookieName:"specGtm",PairDelimiter:"^",KeyValueDelimiter:"~",PendingEventKey:"e",ProcessedEventKey:"p",CookieDetails:null,GetPendingEvents:function(){var a=this;if(!a.CookieDetails){a.CookieDetails=a.LoadCookieDetails();}return a.CookieDetails.PendingEvents;},GetProcessedEvents:function(){var a=this;if(!a.CookieDetails){a.CookieDetails=a.LoadCookieDetails();}return a.CookieDetails.ProcessedEvents;},IsEventProcessed:function(a){var b=this;return $.inArray(a,b.GetProcessedEvents())!=-1;},AddPendingEvent:function(a){var b=this;if(!b.CookieDetails){b.CookieDetails=b.LoadCookieDetails();}if($.inArray(a,b.CookieDetails.PendingEvents)!=-1){return;}b.CookieDetails.PendingEvents.push(a);b.SaveCookieDetails(b.CookieDetails);},MoveAllPendingEventsToProcessed:function(){var e=this;if(!e.CookieDetails){e.CookieDetails=e.LoadCookieDetails();}var a=e.CookieDetails;for(var b=0;b<a.PendingEvents.length;b++){var d=a.PendingEvents[b];if($.inArray(d,a.ProcessedEvents)!=-1){continue;}a.ProcessedEvents.push(d);}a.PendingEvents=[];e.SaveCookieDetails(a);},LoadCookieDetails:function(){var e=this;var b={ProcessedEvents:[],PendingEvents:[]};var a=window.GetCookie(e.CookieName);if(!a||!a.length){return b;}var d=SpectrumUtils.GetCookieValueAsMap(e.CookieName);b.PendingEvents=e.ConvertDelimitedStringToArray(SpectrumUtils.Trim(d[e.PendingEventKey]));b.ProcessedEvents=e.ConvertDelimitedStringToArray(SpectrumUtils.Trim(d[e.ProcessedEventKey]));return b;},SaveCookieDetails:function(b){if(!b){return;}var e=this;var a=e.ConvertArrayToDelimitedString(b.PendingEvents,e.PendingEventKey+e.KeyValueDelimiter);var d=e.ConvertArrayToDelimitedString(b.ProcessedEvents,e.ProcessedEventKey+e.KeyValueDelimiter);if(d&&d.length&&a&&a.length){a+="^";}a+=d;if(a&&window.SetCookie){window.SetCookie(e.CookieName,a,null,"/",window.globalDomainName);}},ConvertArrayToDelimitedString:function(a,f){var b="";var e=a.length;for(var d=0;d<e;d++){if(d==0&&f){b+=f;}b+=a[d];if(d<e-1){b+=",";}}return b;},ConvertDelimitedStringToArray:function(b){var a=[];if(b&&b.length>0){a=b.split(",");}return a;}};var Base64={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(k){var l="";var a,b,d,e,f,g,h;var j=0;k=Base64._utf8_encode(k.toString());while(j<k.length){a=k.charCodeAt(j++);b=k.charCodeAt(j++);d=k.charCodeAt(j++);e=a>>2;f=((a&3)<<4)|(b>>4);g=((b&15)<<2)|(d>>6);h=d&63;if(isNaN(b)){g=h=64;}else{if(isNaN(d)){h=64;}}l=l+this._keyStr.charAt(e)+this._keyStr.charAt(f)+this._keyStr.charAt(g)+this._keyStr.charAt(h);}return l;},decode:function(k){var l="";var a,b,d;var e,f,g,h;var j=0;k=k.replace(/[^A-Za-z0-9\+\/\=]/g,"");while(j<k.length){e=this._keyStr.indexOf(k.charAt(j++));f=this._keyStr.indexOf(k.charAt(j++));g=this._keyStr.indexOf(k.charAt(j++));h=this._keyStr.indexOf(k.charAt(j++));a=(e<<2)|(f>>4);b=((f&15)<<4)|(g>>2);d=((g&3)<<6)|h;l=l+String.fromCharCode(a);if(g!=64){l=l+String.fromCharCode(b);}if(h!=64){l=l+String.fromCharCode(d);}}l=Base64._utf8_decode(l);return l;},_utf8_encode:function(d){d=d.replace(/\r\n/g,"\n");var e="";for(var b=0;b<d.length;b++){var a=d.charCodeAt(b);if(a<128){e+=String.fromCharCode(a);}else{if((a>127)&&(a<2048)){e+=String.fromCharCode((a>>6)|192);e+=String.fromCharCode((a&63)|128);}else{e+=String.fromCharCode((a>>12)|224);e+=String.fromCharCode(((a>>6)&63)|128);e+=String.fromCharCode((a&63)|128);}}}return e;},_utf8_decode:function(g){var f="";var e=0;var a,b,d;while(e<g.length){a=g.charCodeAt(e);if(a<128){f+=String.fromCharCode(a);e++;}else{if((a>191)&&(a<224)){b=g.charCodeAt(e+1);f+=String.fromCharCode(((a&31)<<6)|(b&63));e+=2;}else{b=g.charCodeAt(e+1);d=g.charCodeAt(e+2);f+=String.fromCharCode(((a&15)<<12)|((b&63)<<6)|(d&63));e+=3;}}}return f;}};(function(h){var f=h,d=f.document,b={},i=100001;function k(g,o){if(g.hasMoved||g.transitionActive){g.hasMoved=false;return;}g.transitionActive=true;n.call(g);}function n(o){var g=(typeof o==="number");if(g&&this.currentState===o){return;}if(g){this.previousState=this.currentState;this.currentState=o;}else{var p=this[this.stateOrder[this.currentState]]();if(!p){this.transitionActive=false;return;}this.previousState=this.currentState;if(this.currentState<this.stateOrder.length-1){this.currentState+=1;}else{this.currentState=0;}}this.render();}function a(){var g=e(this);g.transitionActive=false;this.removeEventListener("animationend",a,false);this.removeEventListener("webkitAnimationEnd",a,false);this.className=this.className+" gone";l(g);}function e(o){var g=o.parentElement;return b[g.id];}function l(g){if(!g||!g.stateChangeQueue||!g.stateChangeQueue.length){return;}var o=g.stateChangeQueue.pop();n.call(g,o);g.stateChangeQueue=[];}function j(r,q,p,o){if(!(this instanceof j)){return new j(r,p);}var g=this;b[r]=this;this.findGroupInstance=q;this.findGroup=p;this.hasMoved=false;this.currentState=0;this.previousState=0;this.stateOrder=["order","remove"];this.transitionActive=false;this.stateChangeQueue=[];this.parentElm=d.getElementById(r);this.devicePlacementId=o;if(this.parentElm===null){}this.orderElm=this.parentElm.querySelector("div.order");this.removeElm=this.parentElm.querySelector("div.remove");this.elms=[this.orderElm,this.removeElm];this.removeElm.style.zIndex=zIndex=i;this.orderElm.style.zIndex=zIndex=100003;this.cartID=r.split("_")[1];this.parentElm.addEventListener("touchend",function(s){k(g);},true);this.parentElm.addEventListener("touchmove",function(s){g.hasMoved=true;},true);return this;}j.prototype={order:function(){var g={parentElem:this.parentElm,offercode:this.cartID};var o=Notifications.Notify("mobile-adunit-oncart-order",this,g);if(o==NotificationResults.Continue){return this.handleOrder();}},handleOrder:function(){var p=this.findGroup||_cart.FindGroupOfferInfoByOfferCode;var r=this.findGroupInstance||_cart;var q=SpectrumUtils.ForwardFunctionCall(r,p);var s=q(this.cartID,this.devicePlacementId);if(!s){return false;}var g=s.Offer.isNative?_cart.AddNativeOffer:_cart.AddOffer;var o=SpectrumUtils.ForwardFunctionCall(_cart,g);return o(s,true);},add:function(){return true;},remove:function(){var g={parentElem:this.parentElm,offercode:this.cartID};var o=Notifications.Notify("mobile-adunit-oncart-remove",this,g);if(o==NotificationResults.Cancel){return true;}_cart.RemoveById(this.cartID,false,true);return true;},render:function(){var g=this.elms[this.currentState],t=this.elms[this.previousState],o=this;if(this.previousState>this.currentState){g.style.zIndex=t.style.zIndex;t.style.zIndex=g.style.zIndex-1;}else{t.style.zIndex=g.style.zIndex;g.style.zIndex=t.style.zIndex-1;}for(var r=0,s=this.elms.length;r<s;r++){var q=this.elms[r];if(q!==g&&q!==t){q.style.zIndex=i;}}g.className=g.className.replace(new RegExp("(\\s|^)hide(\\s|$)")," ").replace(/^\s+|\s+$/g,"");g.className=g.className.replace(new RegExp("(\\s|^)gone(\\s|$)")," ").replace(/^\s+|\s+$/g,"");t.className=t.className+" hide";t.addEventListener("animationend",a,false);t.addEventListener("webkitAnimationEnd",a,false);},setState:function(g){if(typeof g!=="string"){return;}if(this.transitionActive){this.stateChangeQueue.push(this.stateOrder.indexOf(g));return;}if(this.stateOrder.indexOf(g)!==-1&&this.stateOrder.indexOf(g)!==this.currentState){n.call(this,this.stateOrder.indexOf(g));}}};f.MultiStateButton=j;}(this));function DeviceAnchor(){this.QueryStrings=null;DeviceAnchor.AnchorParamName="devanc";this.HasAnchorTagInUrl=function(){if(!this.QueryStrings){this.QueryStrings=this.GetQueryStrings();}if(!this.QueryStrings||!this.QueryStrings[DeviceAnchor.AnchorParamName]){return false;}return true;};this.GetDeviceAnchorId=function(){if(!this.HasAnchorTagInUrl()){return null;}return this.QueryStrings[DeviceAnchor.AnchorParamName].toString();};this.GetDeviceIdFromAnchorId=function(){if(!this.HasAnchorTagInUrl()){return null;}var b=this.QueryStrings[DeviceAnchor.AnchorParamName].indexOf("_");return this.QueryStrings[DeviceAnchor.AnchorParamName].substr(b+1);};this.GetDeviceTabIndexUsingAnchorId=function(b,d){return this.GetDeviceTabIndexUsingTheDeviceElement($("#"+b),d);};this.GetDeviceTabIndexUsingPlacement=function(b){if(!b){return -1;}var d=$("#spectrumProductAdminDevice_"+b.Id);return this.GetDeviceTabIndexUsingTheDeviceElement(d,-1);};this.GetDeviceTabIndexUsingTheDeviceElement=function(b,h){var d=b.closest("div .tab");if(d==null||d.length==0){return h;}var e=d[0].id;var g="tabcontent_";var f=e.substring(e.indexOf(g)+g.length);return parseInt(f)-1;};this.HasAnchorTagInUrlForTabAndOffer=function(){var b=document.URL.indexOf("#t_");if(b==-1){return false;}return true;};this.GetTabIndexFromAnchor=function(){var b=this;var d=b.GetTabAndOfferValue();var f=d.match(/t_(\d+)(_o_([0-9A-Za-z]+))?/)[1];var e=f-1;return e;};this.GetOfferCodeFromAnchor=function(){var b=this;var d=b.GetTabAndOfferValue();var e=d.match(/t_(\d+)(_o_([0-9A-Za-z]+))?/)[3];return e;};this.GetTabAndOfferValue=function(){var b=document.URL.indexOf("#");return document.URL.substr(b+("#").length);};this.ValidateTabBasedOnOffer=function(e,d){if($("'div[offercode='"+d+"']").length<=0){return a(e);}var b=$("'div[offercode='"+d+"']").closest(".tab").attr("id");return parseInt(b.substr(b.length-1))-1;};this.GetQueryStrings=function(){var f=null;var g=window.location.search.toString();if(g!=""){g=g.substring(1);f=new Array();var e=g.split("&");for(var b=0;b<e.length;b++){var d=e[b].split("=");f[d[0]]=d[1];}}return f;};function a(e){if($("div.tab:not([id$='summary']):last").length>0){var b=$("div.tab:not([id$='summary']):last").attr("id");var d=parseInt(b.substr(b.length-1))-1;if(d<e){e=d;}}return e;}}var NavigationHelper={Navigate:function(){var a=this.GetCurrentLocation();this.NavigateToLocation(a);},GetCurrentLocation:function(){var b=this.GetDefaultLocation();var a=new DeviceAnchor();if(a.HasAnchorTagInUrl()){b.DeviceId=a.GetDeviceIdFromAnchorId();this.ApplyPlacementInfo(b,b.DeviceId);}if(a.HasAnchorTagInUrlForTabAndOffer()){b.TabIndex=a.GetTabIndexFromAnchor();b.OfferCode=a.GetOfferCodeFromAnchor();b.TabIndex=a.ValidateTabBasedOnOffer(b.TabIndex,b.OfferCode);b.PositionName=window.DevicePositions.WithinOfferingArea;}return b;},NavigateToDevice:function(a){var b=this.GetDefaultLocation();b.DeviceId=a;this.ApplyPlacementInfo(b,a);this.NavigateToLocation(b);},NavigateToLocation:function(k){var b="device_"+k.DeviceId;if(window.DevicePresentationStyles&&k.PresentationStyle==window.DevicePresentationStyles.Lightbox){var d=parseInt(k.DeviceId);SpectrumDeviceManager.ShowDevice(d,null,null);if(k.TabIndex>=0){this.NavigateToTab(k.TabIndex);}return;}var j=(typeof window.DevicePositions!=="undefined");var i=j&&k.PositionName!=null&&k.PositionName!=window.DevicePositions.None;var h=i||k.PresentationStyle!=-1;var f=(k.TabIndex!=null&&k.TabIndex!=-1);if(!h&&!f){NavigationHelper.ScrollToMultipage();return;}if(window.DevicePositions&&k.PositionName==window.DevicePositions.WithinOfferingArea){var a=(k.OfferCode!=null)?$("'div[offercode='"+k.OfferCode+"']").closest("[productelementid]").attr("id"):null;var e=(b=="device_0");if(e&&!a){var l="mpPageNavTop_"+parseInt(k.TabIndex);b=$("a[id$='"+l+"' ]").attr("id");}NavigationHelper.NavigateToTabAndScrollToWithinOfferArea(k.TabIndex,a?a:b);if(a&&MpBlinker){var g=$("#"+a).find("div[id^='adgroup_img']").attr("id");MpBlinker.Blink(g);}}else{NavigationHelper.ScrollToAnchorId(b);}},GetDefaultLocation:function(){var a={DeviceId:0,IsDefaultPackageSlot:false,IsPackageSlot:false,PositionName:window.DevicePositions?window.DevicePositions.None:null,PresentationStyle:-1,TabIndex:-1,OfferCode:null};return a;},ScrollToMultipage:function(){if(!window._multipage||_multipage.GetMaxTabSeen()<=0&&!_multipage.HasUserSeenEO()){return;}MpUtils.ScrollTo("mpWrap");},ScrollToAnchorId:function(a){MpUtils.ScrollTo(a);},NavigateToTabAndScrollToWithinOfferArea:function(d,a){if(d<0||!window._tab){return;}if(d==window._tab.CurrentTabIndex){if(a){MpUtils.ScrollTo(a);}return;}var b=this;b.NavigateToTab(d,function(){if(a){MpUtils.ScrollTo(a);}});},NavigateToTab:function(b,a){if(typeof a==="function"){Notifications.Subscribe("on-multipage-tab-changed",a);}window._tab.OnClick(b);},ApplyPlacementInfo:function(f,b){var a=new DeviceAnchor();for(var d=0;d<window.spectrumStepDevicePlacements.length;d++){var e=window.spectrumStepDevicePlacements[d];if(e.DeviceModelId==b){f.IsDefaultPackageSlot=e.Position.IsDefaultPackageSlot;f.IsPackageSlot=e.Position.IsPackageSlot;f.PositionName=e.Position.PositionName;f.PresentationStyle=e.PresentationStyle;if(window.DevicePositions&&f.PositionName==window.DevicePositions.WithinOfferingArea){f.TabIndex=a.GetDeviceTabIndexUsingPlacement(e);}break;}}}};var SpectrumCookieManager={Initialize:function(){SpectrumCookieManager.RefreshQueryParamsCookie();},RefreshQueryParamsCookie:function(){var b=SpectrumCookieManager.GetExtraQueryParams();var a=SpectrumUtils.ConvertHashtableToDelimitedString(b);SetCookie("specEQP",a,null,"/",window.globalDomainName,false);},GetExtraQueryParams:function(){var b="specEQP";var a=GetCookie(b);var d={};if(a&&a.length>0){SpectrumUtils.ParseValueAsHashtable(a,d);}SpectrumUtils.GetUrlParams(d);if(window.spectrumRecognizedQueryParams){$.each(window.spectrumRecognizedQueryParams,function(e,f){if(!d[f]){return;}delete d[f];});}return d;}};function ServiceHelper(b,d){this.ServiceUrl=b;this.SuccessHandler=d;var a=this;this.AjaxSuccess=function(e,g,f){if(a.SuccessHandler!=null){a.SuccessHandler(e,g,f);}};this.AjaxFailure=function(f,g,e){alert("Ajax request failed with error: "+e);};}ServiceHelper.prototype.ComponentName="ServiceHelper";ServiceHelper.prototype.ServiceUrl="";ServiceHelper.prototype.SuccessHandler=null;ServiceHelper.prototype.Init=function(){};ServiceHelper.prototype.InvokeMethod=function(a,d){if(this.ServiceUrl==null||this.ServiceUrl.length<=0){return;}var f=this.ServiceUrl;if(a){f=f+"/"+a;}if(d){f=f+"?";var b,e="";for(b in d){e=e+escape(b)+"="+escape(d[b])+"&";}e=e.substring(0,e.length-1);f=f+e;}$.ajax({url:f,success:this.AjaxSuccess,error:this.AjaxFailure,headers:{SpecPathName:window.pathData?window.pathData.Name:null,SpecStepName:window.pathData?window.pathData.CurrentStep.Name:null}});};var ProductAdminService={serviceUrl:"",productAdminRuntimeDto:null,successCallback:null,getProductAdminRuntimeDto:function(){var a=ProductAdminService;if(!a.productAdminRuntimeDto){if(a.serviceUrl!=null&&a.serviceUrl.length>0&&typeof ServiceHelper!="undefined"){var b=new ServiceHelper(a.serviceUrl,a.onGetProductAdminDto);b.InvokeMethod();}}},onGetProductAdminDto:function(a,d,b){ProductAdminService.productAdminRuntimeDto=a;if(ProductAdminService.successCallback){ProductAdminService.successCallback();}},Config:{BaseUrl:""},Urls:{GetProductAdminRuntimeDto_Url:"/GetProductAdminRuntimeDto?",GetGroupOffersForProductElement_Url:"/GetGroupOffersForProductElement?"},Handlers:{OnGetProductAdminRuntimeDto:null,OnGetProductAdminRuntimeDtoFailure:null,OnGetGroupOffersForProductElement:null,OnGetGroupOffersForProductElementFailure:null},GetProductAdminRuntimeDto:function(b,a){var d=ProductAdminService;var f=d.Config.BaseUrl+d.Urls.GetProductAdminRuntimeDto_Url+window.SpectrumUtils.ParamsToUrl({pathStepId:b,flexplateZoneId:a});if(f.length>0&&typeof ServiceHelper!="undefined"){var e=new ServiceHelper(f,d.Handlers.OnGetProductAdminRuntimeDto);e.InvokeMethod(methodName,params);}},GetGroupOffersForProductElement:function(b,d,a,e){var f=ProductAdminService;var g=f.Config.BaseUrl+f.Urls.GetGroupOffersForProductElement_Url+window.SpectrumUtils.ParamsToUrl({lineupId:b,mailId:d,groupId:a,offerCode:e});$.ajax({url:g,success:f.Handlers.OnGetGroupOffersForProductElement,type:"GET",headers:{SpecPathName:window.pathData?window.pathData.Name:null,SpecStepName:window.pathData?window.pathData.CurrentStep.Name:null}});},FindUiElement:function(a){return this.findUiElement(this.productAdminRuntimeDto.UiElements,a);},getSlpOfferCode:function(){var b=this;var a="";this.findUiElement(this.productAdminRuntimeDto.UiElements,function(d){if(b.isSlp(d)){a=d.OfferGroup.Offers[0].OfferCode;return true;}return false;});if(a!=""){a=a.replace(/^\s+|\s+$/g,"");}return a;},findProductElementByElementId:function(a){return this.findUiElementByElementId(this.productAdminRuntimeDto.UiElements,a);},forEachOfferCode:function(f,a){for(var b=0;b<f.OfferGroup.Offers.length;b++){var d=f.OfferGroup.Offers[b];var e=jQuery.trim(d.OfferCode);a(e);}},findUiElementByElementId:function(e,a){if(e==null||e.length<=0){return null;}var d;for(d=0;d<e.length;d++){if(e[d].Id==a){return e[d];}var b=this.findUiElementByElementId(e[d].Children,a);if(b!=null){return b;}}return null;},findUiElement:function(f,a){if(f==null||f.length<=0){return null;}if(a==null){return null;}var d;for(d=0;d<f.length;d++){var e=f[d];if(a(e)){return e;}var b=this.findUiElement(f[d].Children,a);if(b!=null){return b;}}return null;},isSlp:function(a){if(a.OfferGroup&&a.OfferGroup.Offers&&a.OfferGroup.Offers.length>0&&a.OfferGroup.Offers[0].MajorCategory=="SELF"){return true;}return false;},getPriceSettingsFromRuntimeDto:function(){var a=ProductAdminService;if(!a.productAdminRuntimeDto){return null;}if(!a.productAdminRuntimeDto.PriceSettings){return null;}return a.productAdminRuntimeDto.PriceSettings;}};defaultAdUnit=null;function findUiElement(e,a){if(e==null||e.length<=0){return null;}var d;for(d=0;d<e.length;d++){if(e[d].Id==a){return e[d];}var b=findUiElement(e[d].Children,a);if(b!=null){return b;}}return null;}function adUnits_getTrimmedEllipseText(a){if(a.length>43){return a.substring(0,43)+"...";}return a;}function adUnits_getTrimmedEllipseTextGivenLength(a,b){a=jQuery.trim(a);if(a.length>b){return a.substring(0,b)+"...";}return a;}function adUnits_mobileCenterCssClass(a){if(a.Offers[0].OfferTypeId!=1&&jQuery.trim(a.MainSavings).length===0&&jQuery.trim(a.SubSavings).length===0){return"noSavingsInfo";}return"";}function adunits_getTwoAcrossMainImageUrl(a){for(var d=0;d<a.length;d++){var b=a[d];if(adUnits_isMainImage(b)){var e=b.Url;if(e&&e.indexOf("http://")==-1){e=window.mediaPath+e;}return e;}}return"";}function adUnits_getMobileTieredPricingHtml(e,d,b,a){var g="";if(!e){return"";}var h=e;if(h.OfferTypeId===1){g=adUnits_getMobileTieredPricingHtmlFromOffer(h,d);}else{var f=adUnits_getPriceSettingsForOffer(b,a,e.OfferCode);g=adUnits_getMobileTieredPricingHtmlFromOffer(h,d,f);}return g;}function adUnits_getMobileIssueHtml(b){if(!b){return"";}var d=b;var a=d.IssueCount+" issues / ";return a;}function adUnits_getMobileDurationHtml(b){if(!b){return"";}var d=b;var a=d.Duration;return a;}function adUnits_getMobileTieredPricingHtmlFromOffer(h,b,f){if(typeof h=="undefined"||h==null){return"";}var g="";if(h.OfferTypeId===1){if(h.NewsstandPrice==0||h.NewsstandPrice<=h.PCHPrice){if(b){g='<span class="pch_price">PCH Price: $'+adUnits_FormatPrice(h.PCHPrice)+"*</span>";}else{g='<span class="pchPriceLabel">PCH Price: </span><span class="pchPrice"><span>$'+adUnits_FormatPrice(h.PCHPrice)+"*</span>";}}else{if(h.NewsstandPrice>h.PCHPrice&&(h.RetailPrice==0||h.RetailPrice<=h.PCHPrice)){if(b){g='<span class="coverPrice strikedOut"><b>Cover Price:</b> $'+adUnits_FormatPrice(h.NewsstandPrice)+'</span><span class="pch_price">PCH Price: $'+adUnits_FormatPrice(h.PCHPrice)+"*</span>";}else{g=g+'<span class="pchPriceLabel">PCH Price: </span><span class="pchPrice">$'+adUnits_FormatPrice(h.PCHPrice)+"*</span>";}}else{if(h.NewsstandPrice>=h.RetailPrice&&h.RetailPrice>h.PCHPrice){if(b){g='<span class="coverPrice strikedOut">Cover Price: $'+adUnits_FormatPrice(h.NewsstandPrice)+'</span><span class="pch_price strikedOut">PCH Price: $'+adUnits_FormatPrice(h.RetailPrice)+'</span><span class="nowOnlyPrice">Now Only: $'+adUnits_FormatPrice(h.PCHPrice)+"*</span>";}else{g=g+'<span class="pchPriceLabel">Now Only: </span><span class="pchPrice">$'+adUnits_FormatPrice(h.PCHPrice)+"*</span></p>";}}}}}else{if(f==null||!(f.Discount)){if(!b){g=g+'<span class="pchPriceLabel">PCH Price:</span><span class="pchPrice">$'+adUnits_FormatPrice(h.PCHPrice)+"*</span>";}}else{var e=(f.PriceLabel==null||f.PriceLabel.length<=0)?"PCH Price":f.PriceLabel;var d=adUnits_CalculatePrice(f.PriceOperator,h.PCHPrice,f.PriceFactor);var a=f.StrikeAcross?"pch_price strikedOut":"pch_price";if(b){g=g+'<span class="'+a+'">'+e+": <span>$"+adUnits_FormatPrice(d)+"</span></span>";}else{g=g+'<span class="pchPriceLabel">Now Only:&nbsp;</span><span class="pchPrice"> $'+adUnits_FormatPrice(h.PCHPrice)+"*</span>";}}}return g;}function adUnits_getDeviceplacementId(a){return $("#"+a).parents("div[id^=fusionOfferFeatureDiv]").attr("deviceplacementid");}function adUnits_getGroupSource(e){var d=SpectrumUtils.IsMobile();var b=d?$("div[id^=cartItemLink_"+e+"]").parents(".mainAdWrap"):$("#cartItemLink_"+e).parents(".mainAdWrap");if(d&&b.length==0){b=$("option[value="+e+"]").parents(".mainAdWrap");}var a=b.attr("groupSource");return(typeof a!==typeof undefined&&a!==false)?a:"spectrum";}function adUnits_getPreLoadImage(){if(!window.mediaPath){return null;}return window.mediaPath+"Spectrum/AdUnit/Large/images/loader-small.gif";}function adUnits_getPriceSettingsForOffer(b,a,d){var e=null;if(b=="spectrum"){if(ProductAdminService&&ProductAdminService.productAdminRuntimeDto&&ProductAdminService.productAdminRuntimeDto.PriceSettings){e=ProductAdminService.productAdminRuntimeDto.PriceSettings;}else{e=SpectrumDeviceManager.GetPriceSettingsForDevice(a,d);}}if(b=="fusion"){e=SpectrumDeviceManager.GetPriceSettingsForDevice(a,d);}return e;}function adUnits_getTieredPricingHtml(d,b,a){if(!d){return"";}var f="";if(d.OfferTypeId===1){f=adUnits_getTieredPricingHtmlFromOffer(d);}else{var e=adUnits_getPriceSettingsForOffer(b,a,d.OfferCode);f=adUnits_getTieredPricingHtmlFromOffer(d,e);}return f;}function adUnits_getRefId(b,a){var e=b;if(typeof e=="undefined"||e==null||(!e.RefId)){return 0;}var d=0;if(a=="fusion"){d=parseInt(e.RefId);}return d;}function adUnits_CalculatePrice(b,d,a){if(b==1){return d+a;}else{if(b==2){return d*a;}}return d.toFixed(2);}function adUnits_FormatPrice(a){return a.toFixed(2);}function adUnits_getOfferType(a){if(!a){return"";}if(a.OfferTypeId===1){return"mag";}else{return"merch";}}function adUnits_getTieredPricingHtmlFromOffer(g,e){if(typeof g=="undefined"||g==null){return"";}var f="";if(g.OfferTypeId===1){if(g.NewsstandPrice==0||g.NewsstandPrice<=g.PCHPrice){f='<p class="mpPCHPrice">PCH Price: <span>$'+adUnits_FormatPrice(g.PCHPrice)+"*</span></p>";}else{if(g.NewsstandPrice>g.PCHPrice&&(g.RetailPrice==0||g.RetailPrice<=g.PCHPrice)){f='<p class="mpOrderStrike">Cover Price: <span>$'+adUnits_FormatPrice(g.NewsstandPrice)+'</span></p><p class="mpPCHPrice">PCH Price: <span>$'+adUnits_FormatPrice(g.PCHPrice)+"*</span></p>";}else{if(g.NewsstandPrice>=g.RetailPrice&&g.RetailPrice>g.PCHPrice){f='<p class="mpOrderStrike">Cover Price: <span>$'+adUnits_FormatPrice(g.NewsstandPrice)+'</span></p><p class="mpOrderStrike">PCH Price: <span>$'+adUnits_FormatPrice(g.RetailPrice)+'</span></p><p class="mpPCHPrice">Now Only: <span>$'+adUnits_FormatPrice(g.PCHPrice)+"*</span></p>";}}}}else{if(e==null||!(e.Discount)){f=f+'<p class="mpPCHPrice">PCH Price: <span>$'+adUnits_FormatPrice(g.PCHPrice)+"*</span></p>";}else{var d=(e.PriceLabel==null||e.PriceLabel.length<=0)?"PCH Price":e.PriceLabel;var b=adUnits_CalculatePrice(e.PriceOperator,g.PCHPrice,e.PriceFactor);var a=e.StrikeAcross?"mpDiscountPrice":"mpPurchacePrice";f=f+'<p class="'+a+'">'+d+": <span>$"+adUnits_FormatPrice(b)+"</span></p>";f=f+'<p class="mpPurchacePrice">Now Only: <span>$'+adUnits_FormatPrice(g.PCHPrice)+"*</span></p>";}}return f;}function dealPop_getTieredPricingHtmlFromOffer(g,e){if(typeof g=="undefined"||g==null){return"";}var f="";if(g.OfferTypeId===1){if(g.NewsstandPrice==0||g.NewsstandPrice<=g.PCHPrice){f='<p class="mpPCHPrice">PCH Price: <span>$'+adUnits_FormatPrice(g.PCHPrice)+"*</span></p>";}else{if(g.NewsstandPrice>g.PCHPrice&&(g.RetailPrice==0||g.RetailPrice<=g.PCHPrice)){f='<p class="mpOrderStrike">Cover Price: <span>$'+adUnits_FormatPrice(g.NewsstandPrice)+'</span></p><p class="mpPCHPrice">PCH Price: <span>$'+adUnits_FormatPrice(g.PCHPrice)+"*</span></p>";}else{if(g.NewsstandPrice>=g.RetailPrice&&g.RetailPrice>g.PCHPrice){f='<p class="mpOrderStrike">Cover Price: <span>$'+adUnits_FormatPrice(g.NewsstandPrice)+'</span></p><p class="mpOrderStrike">PCH Price: <span>$'+adUnits_FormatPrice(g.RetailPrice)+'</span></p><p class="mpPCHPrice">Now Only: <span>$'+adUnits_FormatPrice(g.PCHPrice)+"*</span></p>";}}}}else{if(e==null||!(e.Discount)){f=f+'<p class="mpPCHPrice">PCH Price: <span>$'+adUnits_FormatPrice(g.PCHPrice)+"*</span></p>";}else{var d=(e.PriceLabel==null||e.PriceLabel.length<=0)?"PCH Price":e.PriceLabel;var b=adUnits_CalculatePrice(e.PriceOperator,g.PCHPrice,e.PriceFactor);var a=e.StrikeAcross?"mpDiscountPrice":"mpPurchacePrice";f=f+'<p class="'+a+'">'+d+": <span>$"+adUnits_FormatPrice(b)+"</span></p>";f=f+'<p class="mpPurchacePrice">Now Only: <span>$'+adUnits_FormatPrice(g.PCHPrice)+"*</span></p>";}}return f;}function adUnits_FormatPrice(a){return a.toFixed(2);}function adUnits_filterOutLogos(a){var b=adUnits_filterObjects(a,adUnits_isLogo,"Url");return adUnits_filterImagesBasedOnBrowser(b);}function adUnits_filterObjects(a,d,h){var e=new Array();if(!a||a.length==0){return e;}for(var f=0;f<a.length;f++){var b=a[f];if(typeof d=="function"&&d(b)){if(!h){e.push(b);continue;}var g=adUnits_getFieldValue(b,h);if(g&&g.indexOf("http://")==-1){g=window.mediaPath+g;}e.push(g);}}return e;}function adUnits_filterImagesBasedOnBrowser(d){var a=new Array();if(!d||!(d.length)){return a;}for(var b=0;b<d.length;b++){var e=d[b];if($.browser.msie&&e.lastIndexOf(".png")<0){a.push(e);}else{if(!$.browser.msie&&e.lastIndexOf(".png")>0){a.push(e);}}}return a;}function adUnits_filterVideoBasedOnBrowser(){var a=navigator.userAgent.toLowerCase(),b;if(a.indexOf("msie")!=-1){var f=a.indexOf("msie")+5,e=a.indexOf(";",f),d=a.substring(f,e);b=d;}else{if(a.indexOf("firefox")!=-1){var f=a.indexOf("firefox")+8,e=a.length,d=a.substring(f,e);b=(d<=22)?"playflash":false;}}return b;}function adUnits_isLogo(a){if(!a){return false;}return(a.TypeId==2);}function adUnits_isSuperImage(a){if(!a){return false;}return(a.DimensionId==14);}function adUnits_isSmallImage(a){if(!a){return false;}var b=(a.TypeId===3&&a.DimensionText=="156x214");var d=(a.TypeId===4&&a.DimensionText=="220x220");return(b||d);}function adUnits_getFieldValue(obj,fieldName){if(!obj){return null;}return eval("obj."+fieldName);}function adUnits_filterOutAllMainImages(b,a){if(a===null){adUnitId=defaultAdUnit;}else{adUnitId=a.Id;}if(adUnitId===3){return adUnits_filterOutSmallImages(b);}if(adUnitId===6){var d=adUnits_filterOutMobileImages(b);if(d.length>0){return d[0];}return d;}else{return adUnits_filterOutMainImages(b);}}function adUnits_selectMobileSingleImage(a){if(a==null||a.length==0){return"";}var b=adUnits_filterOutMobileImages(a);if(b.length>0){return b[0];}return b;}function adUnits_filterOutMobileImages(a){return adUnits_filterObjects(a,adUnits_isMainImage,"Url");}function adUnits_filterOutMainImages(a){return adUnits_filterObjects(a,adUnits_isMainImage,"Url");}function adUnits_filterOutMainMedia(a){var b=adUnits_filterObjects(a,adUnits_isMainImageOrVideo);b.sort(function(d,e){return d.Rank-e.Rank;});return b;}function adUnits_filterOutSmallImages(a){return adUnits_filterObjects(a,adUnits_isSmallImage,"Url");}function adUnits_filterOutSuperFeatureImage(a){return adUnits_filterObjects(a,adUnits_isSuperImage,"Url");}function adUnits_areBurstImagesPresent(a){if(!a){return false;}for(var b=0;b<a.length;b++){var d=a[b];if(d.TypeId==1){return true;}}return false;}function adUnits_filterOutBursts(a){var b=adUnits_filterObjects(a,adUnits_isBurst,"Url");return adUnits_filterImagesBasedOnBrowser(b);}function adUnits_getHazardUrl(e){if(typeof e=="undefined"||e==null||e.length<=0){return null;}for(var d=0;d<e.length;d++){var a=parseInt(e[d].Hazard);if(isNaN(a)){continue;}if(a!=1&&a!=6){continue;}if(typeof mediaPath=="undefined"||mediaPath==null){return null;}if(typeof hazardWarning1=="undefined"||hazardWarning1==null){return null;}if(typeof hazardWarning6=="undefined"||hazardWarning6==null){return null;}var b="";if(a===1){b=hazardWarning1;}else{if(a===6){b=hazardWarning6;}}return mediaPath+b;}return null;}function adUnits_isMainImage(a){if(!a){return false;}var b=(a.TypeId===3&&a.DimensionId===7);var d=(a.TypeId===4&&a.DimensionId===3);return(b||d);}function adUnits_isMainImageOrVideo(a){if(!a){return false;}return(adUnits_isMainImage(a)||adUnits_isVideo(a));}function adUnits_isBurst(a){if(!a){return false;}return(a.TypeId==1);}function adUnits_isLogo(a){if(!a){return false;}return(a.TypeId==2);}function adUnits_isVideo(a){if(!a){return false;}return(a.TypeId==6);}function adUnits_getQppHtml(a){if(typeof a=="undefined"||a==null||a.length<=0){return null;}var b=(a.length===1)?a[0].QuarterPartPay:adUnits_getLowestQpp(a);return adUnits_convertQppToHtml(b);}function adUnits_convertQppToHtml(a){if(isNaN(a)){return"";}return'<strong><span class="sup">$</span>'+adUnits_getDollarPart(a)+'<span class="sup">'+adUnits_getCentPart(a)+"*</span></strong>";}function adUnits_getTwoAcrossQppHtml(a){if(typeof a=="undefined"||a==null||a.length<=0){return null;}var b=(a.length===1)?a[0].QuarterPartPay:adUnits_getLowestQpp(a);return adUnits_convertTwoAcrossQppToHtml(b);}function adUnits_convertTwoAcrossQppToHtml(a){if(isNaN(a)){return"";}return"<strong><sup>$</sup>"+adUnits_getDollarPart(a)+"<sup>"+adUnits_getCentPart(a)+"*</sup></strong>";}function adUnits_convertMobileQppToHtml(a){if(isNaN(a)){return"";}return"<sup>$</sup>"+adUnits_getDollarPart(a)+"<sup>"+adUnits_getCentPart(a)+"*</sup>";}function adUnits_convertMobileQppToHtmlNoSup(a){if(isNaN(a)){return"";}return"$"+adUnits_getDollarPart(a)+"."+adUnits_getCentPart(a)+"*";}function adUnits_getDollarPart(a){a=adUnits_FormatPrice(a);a=a.substr(0,a.indexOf("."));return a;}function adUnits_getCentPart(a){a=adUnits_FormatPrice(a);a=a.substr(a.indexOf(".")+1,a.length);return a;}function adUnits_getLowestQpp(d){if(typeof d=="undefined"||d==null||d.length<=0){return null;}var b=99999;for(var a=0;a<d.length;a++){if(d[a].QuarterPartPay<b){b=d[a].QuarterPartPay;}}return b;}function get4PaymentsImageUrl(a){theFirstImgObjUrl=a[0].Url;if($.browser.msie){return theFirstImgObjUrl.match(/^(.*[\\\/])/)[1];+"4_pay_each_only.gif";}else{return theFirstImgObjUrl.match(/^(.*[\\\/])/)[1];+"4_pay_each_only.png";}}function adUnits_calculateQppHtml(d){if(typeof d=="undefined"||d==null||d.length<=0){return null;}var b="<span>4 PAYMENTS EACH ONLY</span>";var a="<span>4 PAYMENTS AS LOW AS</span>";if(d.length===1){return b+adUnits_convertQppToHtml(d[0].QuarterPartPay);}var e=adUnits_calculateLowestQpp(d);if(e.areAllValuesSame){return b+adUnits_convertQppToHtml(e.lowestQpp);}else{return a+adUnits_convertQppToHtml(e.lowestQpp);}}function adUnits_calculateLowestQpp(b){var d={lowestQpp:b[0].QuarterPartPay,areAllValuesSame:true};for(var a=1;a<b.length;a++){if(b[a].QuarterPartPay!==d.lowestQpp){d.areAllValuesSame=false;}if(b[a].QuarterPartPay<d.lowestQpp){d.lowestQpp=b[a].QuarterPartPay;}}return d;}function adUnits_shouldDisplayQuantity(d,e){if(!d||d.OfferTypeId===1){return false;}if(!e||!e.Offers){return false;}var f=d.PCHPrice;for(var b=0;b<e.Offers.length;b++){var a=e.Offers[b];if(a.PCHPrice!==f){return false;}}return true;}function adUnits_getQuantityValue(a){return parseInt(a.safeVal());}function adUnits_makeFullUrl(b){var a=adUnits_isVideo(b)?window.videoBaseUrl:window.mediaPath;var d=b?b.Url:"";return d.indexOf("http://")==-1?a+d:d;}function adUnits_initializeVideo(g,h){var d=g.find("li:eq("+h+")");if(!d.hasClass("videoLi")){return;}if(d.hasClass("initialized")){return;}var r=d.find("div");var q=r.attr("data-video-id");if(d.parents(".dealPopPlaceholder").length==1){var e="FDP";r.attr("id","countdown_FDP_"+q);}var f=(d.index()===0)?g.find("li:eq(1) img").attr("src"):g.find("li:first-child img").attr("src");if(!f){f="";}var p=(e)?"countdown_FDP_"+q:"countdown_"+q;var j=(e)?"playvid_FDP_"+q:"playvid_"+q;var n=(e)?"replayvid_FDP_"+q:"replayvid_"+q;var s=r.attr("data-video-url");var i=window.mediaPath+"Spectrum/scripts/jwplayer/";var k=$("<div></div>").addClass("playoverlay").attr("id",j).css("display","none");$("#"+p).after(k);jwplayer.key="8cBvvCBKXdTyf0BJ1e5ypIJot/ZnSS5ovJDRPOSBHhY=";var l={};l[i+"countdown.js"]={};var o=jwplayer(p);var a=adUnits_filterVideoBasedOnBrowser();var b;if(a&&!isNaN(parseFloat(a))){b=parseInt(a,10);}if(b&&(b==="playflash"||b===8)){o.setup({file:s,image:f,primary:window.mediaPath+"flash",height:330,width:330});}else{if(b&&(b===9||b===10)){o.setup({file:s,image:f,primary:window.mediaPath+"html5",skin:i+"nofullscr.xml",height:330,width:330,plugins:l}).onReady(function(){$("#"+j).css("display","block");var t=$("#"+p);t.scrollOutOfView(function(){SpectrumUtils.ScrollEvent.PauseVideo(p);});}).onPause(function(t){this.setControls(true);$("#"+n).remove();$("#"+j).remove();}).onFullscreen(function(t){$("#"+j).remove();}).onComplete(function(t){adUnits_OnVideoComplete(p,e);}).onPlay(function(t){if(SpectrumUtils.ScrollEvent.CurrentlyPlayingVideo!=p){SpectrumUtils.ScrollEvent.PauseCurrentlyPlayingVideo();}SpectrumUtils.ScrollEvent.SetCurrentlyPlayingVideo(p);});$("#"+j).click(function(){var t=$(this);t.fadeOut("slow",function(){t.remove();});jwplayer(p).play();});}else{o.setup({file:s,image:f,primary:window.mediaPath+"html5",skin:i+"six.xml",height:330,width:330,plugins:l}).onReady(function(){$("#"+j).css("display","block");var t=$("#"+p);t.scrollOutOfView(function(){SpectrumUtils.ScrollEvent.PauseVideo(p);});}).onPause(function(t){this.setControls(true);$("#"+n).remove();$("#"+j).remove();}).onFullscreen(function(t){$("#"+j).remove();}).onComplete(function(t){adUnits_OnVideoComplete(p);}).onPlay(function(t){if(SpectrumUtils.ScrollEvent.CurrentlyPlayingVideo!=p){SpectrumUtils.ScrollEvent.PauseCurrentlyPlayingVideo();}SpectrumUtils.ScrollEvent.SetCurrentlyPlayingVideo(p);});$("#"+j).click(function(){var t=$(this);t.fadeOut("slow",function(){t.remove();});jwplayer(p).play();});}}d.addClass("initialized");}function adUnits_PauseVideo(a){if(!a){return;}jwplayer(a).pause(true);}function adUnits_OnVideoComplete(d,a){if(!d){return;}var b=d.split("_")[1];var g=(a)?"replayvid_FDP_"+b:"replayvid_"+b;var f=(a)?"playvid_FDP_"+b:"playvid_"+b;var e=$("<div></div>").addClass("replayoverlay").attr("id",g);if($("#"+g).length===0&&$("#"+f).length===0){$("#"+d).after(e);$("#"+g).click(function(){var h=$(this);h.fadeOut("slow",function(){h.remove();});jwplayer(d).play();});}}function adUnits_GetMajorCategory(a){if(!a||!a.Group||!a.Group.Offers){return;}for(var b=0;b<a.Group.Offers.length;b++){var d=a.Group.Offers[b];if(d.OfferCode&&d.OfferCode.trim()!=a.Offer.Code.trim()){continue;}return d.MajorCategory;}}(function(a){a.fn.textfill=function(d){var b={maxFontPixels:40,innerTag:"span"};var e=jQuery.extend(b,d);return this.each(function(){var f=e.maxFontPixels;var i=a(e.innerTag+":visible:first",this);var g=a(this).height();var h=a(this).width();var j;var k;do{i.css("font-size",f);j=i.height();k=i.width();f=f-1;}while((j>g||k>h)&&f>3);});};})(jQuery);if(typeof String.prototype.trim!=="function"){String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"");};}function truncateHTML(o,d){if(o.length<=d){return o;}var p=o.substring(0,d);p=p.replace(/(\r\n|\n|\r)/gm,"").trim();p=p.replace(/<(\w*)(?:(?:\s\w+(?:={0,1}(["']{0,1})\w*\2{0,1})))*$/g,"");var r=/<\/((?:\w*))$/g;var s=r.exec(p);if(s!=null){var q=s[1];if(q.length>0){var h=new RegExp("<("+q+"\\w?)(?:(?:\\s\\w+(?:=([\"'])\\w*\\2)))*>");var n=p;var i=h.exec(n);var g=null;while(i!=null){g=i[1];n=n.replace(h,"");i=h.exec(n);}if(g!=null){p=p.replace(r,"</"+g+">");}}else{p=p.replace(r,"");}}var n=reverseHtml(p);var e=/<(?:(["'])\w*\1=\w+ )*(\w*)>/;var k=e.exec(n);while(k!=null){var j=k[0];var l=k[2];var f=k.index;var a=f+j.length;var b=n.substring(0,a);if(!new RegExp("<"+l+"/>").test(b)){p+="</"+reverseHtml(l)+">";}n=n.replace(b,"");k=e.exec(n);}return p+"...";}function reverseHtml(d){var a=String.fromCharCode(206);var b=d.split("").reverse().join("");while(b.indexOf("<")>-1){b=b.replace("<",a);}while(b.indexOf(">")>-1){b=b.replace(">","<");}while(b.indexOf(a)>-1){b=b.replace(a,">");}return b;}var sliderExist=false;function adUnitSetup(){applySuperFeatureToggleBar();_dropdownInit();$(".mpBurst, .prodLogo").pngFix();applySuperFeatureScrollPane($(".superFeatureProdDescription"));}function applySuperFeatureScrollPane(a){if(!a||a.length<=0){return;}a.jScrollPane({showArrows:true});}function applySuperFeatureToggleBar(){$(".toggleBar").unbind("click").click(function(){var a=$(this),d="\u25B2",b="\u25BC",e=a.parent().find(".mainContent, .productDetail");a.toggleClass("up");var h=a.hasClass("up")?"Close <span>"+b+"</span>":"More <span>"+d+"</span>";var f=a.hasClass("mag");a.find(".toggletarget").html(h);if(!f){var g=(!a.hasClass("up"))?"388px":"400px";e.animate({height:g},"slow");}a.parent().find(".productOverview").slideToggle("slow",function(){$(this).toggleClass("closed");});if(!a.hasClass("up")){if(window.Notifications){Notifications.Notify("need-video-stopped",null,null);}}});}function applyImageNav(b,a){b.carousel({pagination:true,btnsPosition:"outside"});b.each(function(h,i){var e=$(i).find("li").length;var f=$(i).parents().hasClass("merch");var g=$(i).parents().hasClass("small");if(a||(f==true&&g!=true)){var l=6;var k=4;var n="carousel-setSlideMerch";}else{var l=4;var k=2;var n="carousel-setSlideMag";}if(e<=l&&e!=1){var d=l-e;$(i).parent().find("a.carousel-control").hide();}else{if(e>=l){$(i).find("div.carousel-pagination").addClass(n);$(i).find("div.carousel-pagination div").addClass("carousel-slide");$(".carousel-slide p a").click(function(){var j=$("a").index(this);count=j+1-10;});}else{if(e==1){$(i).parent().find("a.carousel-control").hide();$(i).find("div.center-wrap").hide();}}}});}function applyScrollPane(b,a){if(!a){a=295;}b.each(function(e,f){var d=$(f).height();if(d>=a){$(f).height(a);$(f).jScrollPane({showArrows:true});}else{$(f).height(d);}});}function applyFourPaymentsLabel(a){if(!($.browser.msie)){$(".tab"+a+" img.four_pay_each_only, .tab"+a+" img.four_pay_as_low_as").each(function(b,d){changeImageExtension(d,".gif",".png");});}}function changeImageExtension(a,e,b){var f=$(a).attr("src");if(!f||f.length<=0){return;}var d=f.replace(e,b);$(a).attr("src",d);}function navigateButtons(b){var h="",g=$(b).parent().find(".carousel-slide p a").index($(b).parent().find(".carousel-slide p a.active")),f=$(b).closest(".mainAdWrap").hasClass("superFeature");var a=$(b).parents().hasClass("twoAcross");if($(b).is(".next")){var d=$(b).parents().hasClass("merch");var e=$(b).parents().hasClass("small");if(a||(e!=true&&d==true)){if(g%6==0){h="-=271";}}else{if(g%2==0){h="-=100";}}}else{g++;if(a||$(b).parents().hasClass("merch")){if(g%6==0){h="+=271";}}else{if(g%2==0){h="+=100";}}}if(h!=""){$(b).parent().find(".slideshow .center-wrap .carousel-slide").animate({left:h});}}function _dropdownInit(){$(".dropdown select.offerSelect").bind("focus",_dropdownStopBlinkClear);$(".dropdown select.offerSelect").bind("change",_dropdownChange);$(".dropdown a").bind("click",_dropDownAddCart);if(parseFloat($().jquery)<parseFloat("1.6")){$(".dropdown select.offerSelect").attr("selectedIndex",0);}else{$(".dropdown select.offerSelect").prop("selectedIndex",0);}$(".dropdown select.offerSelect").each(function(){$(this).find("option").each(function(b,a){if(!this.attributes.value||!this.attributes.value.value){$(this).val(b);}});});}function _dropDownAddCart(){if(_cart.Cart.IsAtLimit()){alert(_cart.Resx.Get("OrderLimitReached"));return false;}var a=$(this);var b=a.parent().parent().parent();var e=b.find("select.offerSelect");var f=null;if(parseFloat($().jquery)<parseFloat("1.6")){f=e.attr("selectedIndex");}else{f=e.prop("selectedIndex");}if(!f){_dropdownBlink(e);}else{var k=parseInt(e.val());var h=b.find(".offer:eq("+(k-1)+")");var i=h.attr("offerCode");var j=a.parents("div[id^=fusionOfferFeatureDiv_]");var g=j.attr("groupsource");var d=j.attr("deviceplacementid");if(g&&d){_cart.AddById(i,false,adUnits_getQuantityValue(b.find(".quantitySelect")),d);}else{_cart.AddById(i,false,adUnits_getQuantityValue(b.find(".quantitySelect")),d);}var l=adUnits_getTrimmedEllipseTextGivenLength(h.find("h4").text(),53);h.find("h4").text(l);h.show();_dropdownReset(b);}b.find(".offercap-middle").addClass("hidden");_dropDownBuild(b,e);return false;}function _dropDownAutoAdd(d){container=$("#"+d).parent().parent().parent();var b=$(container).find(".offer").index($("#"+d).parent().parent());var a=container.find(".offer:eq("+b+")");a.show();_dropdownReset(container);_dropDownBuild(container);}function _dropDownBuild(a){objDropdown=a.find(".dropdown select.offerSelect");objDropdown.find("option").remove();objDropdown.append('<option value="0">OPTIONS: Click here to select the offer you\'d like...</option>');var b=0;a.find(".offer:not(.dropdown)").each(function(f,d){if($(d).is(":hidden")){b++;objDropdown.append('<option value="'+(f+1)+'">'+_dropdownEllipsis($(d).find("h4").text())+"</option>");}});if(b==0){a.find(".dropdown").hide();a.find(".offer:not(.dropdown):last").addClass("offerCap");}}function _dropdownReset(a){_dropdownStopBlink();a.find(".dropdown h5,.dropdown .mpOrderStrike,.dropdown .mpPCHPrice,.dropdown .mpDiscountPrice,.dropdown .mpPurchacePrice, .dropdown .mpQtrPay:not(.ddQtrPay)").remove();a.find(".dropdown a").addClass("orderOptions");a.find(".ddQtrPay").show();}function _dropdownClick(b){var a=$(b);a.find("option").each(function(){$(this).text(_dropdownEllipsis($(this).text()));});}function _dropdownEllipsis(b){if(!b){return"";}var d=b.trim();var a=43;if(d.length>a){d=d.substring(0,a)+"...";}return d;}function _dropdownChange(){var a=$(this).closest(".subAdWrap");var b=$(this);var d=null;if(parseFloat($().jquery)<parseFloat("1.6")){d=b.attr("selectedIndex");}else{d=b.prop("selectedIndex");}_dropdownReset(a);if(parseInt(d)){var f=parseInt(b.val());var g=a.find(".offer"),e=$(g[f-1]);a.find("a.orderOptions").removeClass("orderOptions");e.find("h5").clone().appendTo(a.find(".dropdown"));e.find(".mpOrderStrike").clone().appendTo(a.find(".dropdown"));e.find(".mpPCHPrice").clone().appendTo(a.find(".dropdown"));e.find(".mpDiscountPrice").clone().appendTo(a.find(".dropdown"));e.find(".mpPurchacePrice").clone().appendTo(a.find(".dropdown"));if(e.find(".mpQtrPay").length){e.find(".mpQtrPay").clone().appendTo(a.find(".dropdown"));a.find(".ddQtrPay").hide();}a.find(".offercap-middle").removeClass("hidden");a.find(".quantitySelect").safeVal("1");}else{a.find(".offercap-middle").addClass("hidden");}return false;}function _dropdownRemoveCart(b){$("#"+b).parent().parent().hide();var a=$("#"+b).parent().parent().parent().parent();a.find(".offer.offerCap:not(.dropdown)").removeClass("offerCap");a.find(".dropdown").show();_dropDownBuild(a);_dropdownReset(a);return false;}var _dropdownBlinkTimer;var _dropdownBlinkCnt=0;function _dropdownBlink(a){clearTimeout(_dropdownBlinkTimer);if($(a).hasClass("highlight")){$(a).removeClass("highlight");}else{$(a).addClass("highlight");}_dropdownBlinkCnt++;if(_dropdownBlinkCnt>=9){_dropdownStopBlink(a);}else{_dropdownBlinkTimer=window.setTimeout(function(){_dropdownBlink(a);},555);}}function _dropdownStopBlinkClear(){_dropdownStopBlink(this);$(this).removeClass("highlight");}function _dropdownStopBlink(a){clearTimeout(_dropdownBlinkTimer);_dropdownBlinkCnt=0;}(function(e,d,f){e.fn.jScrollPane=function(b){function a(bj,bE){var bg,bI=this,bX,a2,bQ,a4,bN,bZ,bW,bH,aK,aU,bc,br,bs,bp,bt,aJ,bP,a8,bV,bM,s,a9,aT,a5,bo,bx,bb,bf,bU,bd,a0,bl,by,a1=true,bG=true,aY=false,bv=false,a7=bj.clone(false,false).empty(),aN=e.fn.mwheelIntent?"mwheelIntent.jsp":"mousewheel.jsp";a0=bj.css("paddingTop")+" "+bj.css("paddingRight")+" "+bj.css("paddingBottom")+" "+bj.css("paddingLeft");bl=(parseInt(bj.css("paddingLeft"),10)||0)+(parseInt(bj.css("paddingRight"),10)||0);function ba(p){var j,l,k,h,g,o,n=false,i=false;bg=p;if(bX===f){g=bj.scrollTop();o=bj.scrollLeft();bj.css({overflow:"hidden",padding:0});a2=bj.innerWidth()+bl;bQ=bj.innerHeight();bj.width(a2);bX=e('<div class="jspPane" />').css("padding",a0).append(bj.children());a4=e('<div class="jspContainer" />').css({width:a2+"px",height:bQ+"px"}).append(bX).appendTo(bj);}else{bj.css("width","");n=bg.stickToBottom&&bw();i=bg.stickToRight&&bh();h=bj.innerWidth()+bl!=a2||bj.outerHeight()!=bQ;if(h){a2=bj.innerWidth()+bl;bQ=bj.innerHeight();a4.css({width:a2+"px",height:bQ+"px"});}if(!h&&by==bN&&bX.outerHeight()==bZ){bj.width(a2);return;}by=bN;bX.css("width","");bj.width(a2);a4.find(">.jspVerticalBar,>.jspHorizontalBar").remove().end();}bX.css("overflow","auto");if(p.contentWidth){bN=p.contentWidth;}else{bN=bX[0].scrollWidth;}bZ=bX[0].scrollHeight;bX.css("overflow","");bW=bN/a2;bH=bZ/bQ;aK=bH>1;aU=bW>1;if(!(aU||aK)){bj.removeClass("jspScrollable");bX.css({top:0,width:a4.width()-bl});bB();bk();bK();bS();aZ();}else{bj.addClass("jspScrollable");j=bg.maintainPosition&&(bs||aJ);if(j){l=aQ();k=aM();}aW();bY();bm();if(j){bC(i?(bN-a2):l,false);bA(n?(bZ-bQ):k,false);}bu();aV();a6();if(bg.enableKeyboardNavigation){bL();}if(bg.clickOnTrack){bF();}bi();if(bg.hijackInternalLinks){bz();}}if(bg.autoReinitialise&&!bd){bd=setInterval(function(){ba(bg);},bg.autoReinitialiseDelay);}else{if(!bg.autoReinitialise&&bd){clearInterval(bd);}}g&&bj.scrollTop(0)&&bA(g,false);o&&bj.scrollLeft(0)&&bC(o,false);bj.trigger("jsp-initialised",[aU||aK]);}function aW(){if(aK){a4.append(e('<div class="jspVerticalBar" />').append(e('<div class="jspCap jspCapTop" />'),e('<div class="jspTrack" />').append(e('<div class="jspDrag" />').append(e('<div class="jspDragTop" />'),e('<div class="jspDragBottom" />'))),e('<div class="jspCap jspCapBottom" />')));bP=a4.find(">.jspVerticalBar");a8=bP.find(">.jspTrack");bc=a8.find(">.jspDrag");if(bg.showArrows){a9=e('<a class="jspArrow jspArrowUp" />').bind("mousedown.jsp",aS(0,-1)).bind("click.jsp",aO);aT=e('<a class="jspArrow jspArrowDown" />').bind("mousedown.jsp",aS(0,1)).bind("click.jsp",aO);if(bg.arrowScrollOnHover){a9.bind("mouseover.jsp",aS(0,-1,a9));aT.bind("mouseover.jsp",aS(0,1,aT));}a3(a8,bg.verticalArrowPositions,a9,aT);}bM=bQ;a4.find(">.jspVerticalBar>.jspCap:visible,>.jspVerticalBar>.jspArrow").each(function(){bM-=e(this).outerHeight();});bc.hover(function(){bc.addClass("jspHover");},function(){bc.removeClass("jspHover");}).bind("mousedown.jsp",function(g){e("html").bind("dragstart.jsp selectstart.jsp",aO);bc.addClass("jspActive");var h=g.pageY-bc.position().top;e("html").bind("mousemove.jsp",function(i){bR(i.pageY-h,false);}).bind("mouseup.jsp mouseleave.jsp",be);return false;});bD();}}function bD(){a8.height(bM+"px");bs=0;bV=bg.verticalGutter+a8.outerWidth();bX.width(a2-bV-bl);try{if(bP.position().left===0){bX.css("margin-left",bV+"px");}}catch(g){}}function bY(){if(aU){a4.append(e('<div class="jspHorizontalBar" />').append(e('<div class="jspCap jspCapLeft" />'),e('<div class="jspTrack" />').append(e('<div class="jspDrag" />').append(e('<div class="jspDragLeft" />'),e('<div class="jspDragRight" />'))),e('<div class="jspCap jspCapRight" />')));a5=a4.find(">.jspHorizontalBar");bo=a5.find(">.jspTrack");bp=bo.find(">.jspDrag");if(bg.showArrows){bf=e('<a class="jspArrow jspArrowLeft" />').bind("mousedown.jsp",aS(-1,0)).bind("click.jsp",aO);bU=e('<a class="jspArrow jspArrowRight" />').bind("mousedown.jsp",aS(1,0)).bind("click.jsp",aO);if(bg.arrowScrollOnHover){bf.bind("mouseover.jsp",aS(-1,0,bf));bU.bind("mouseover.jsp",aS(1,0,bU));}a3(bo,bg.horizontalArrowPositions,bf,bU);}bp.hover(function(){bp.addClass("jspHover");},function(){bp.removeClass("jspHover");}).bind("mousedown.jsp",function(g){e("html").bind("dragstart.jsp selectstart.jsp",aO);bp.addClass("jspActive");var h=g.pageX-bp.position().left;e("html").bind("mousemove.jsp",function(i){bT(i.pageX-h,false);}).bind("mouseup.jsp mouseleave.jsp",be);return false;});bx=a4.innerWidth();aX();}}function aX(){a4.find(">.jspHorizontalBar>.jspCap:visible,>.jspHorizontalBar>.jspArrow").each(function(){bx-=e(this).outerWidth();});bo.width(bx+"px");aJ=0;}function bm(){if(aU&&aK){var g=bo.outerHeight(),h=a8.outerWidth();bM-=g;e(a5).find(">.jspCap:visible,>.jspArrow").each(function(){bx+=e(this).outerWidth();});bx-=h;bQ-=h;a2-=g;bo.parent().append(e('<div class="jspCorner" />').css("width",g+"px"));bD();aX();}if(aU){bX.width((a4.outerWidth()-bl)+"px");}bZ=bX.outerHeight();bH=bZ/bQ;if(aU){bb=Math.ceil(1/bW*bx);if(bb>bg.horizontalDragMaxWidth){bb=bg.horizontalDragMaxWidth;}else{if(bb<bg.horizontalDragMinWidth){bb=bg.horizontalDragMinWidth;}}bp.width(bb+"px");bt=bx-bb;aR(aJ);}if(aK){s=Math.ceil(1/bH*bM);if(s>bg.verticalDragMaxHeight){s=bg.verticalDragMaxHeight;}else{if(s<bg.verticalDragMinHeight){s=bg.verticalDragMinHeight;}}bc.height(s+"px");br=bM-s;aP(bs);}}function a3(h,j,g,n){var l="before",i="after",k;if(j=="os"){j=/Mac/.test(navigator.platform)?"after":"split";}if(j==l){i=j;}else{if(j==i){l=j;k=g;g=n;n=k;}}h[l](g)[i](n);}function aS(g,i,h){return function(){bq(g,i,this,h);this.blur();return false;};}function bq(j,i,n,l){n=e(n).addClass("jspActive");var k,h,g=true,o=function(){if(j!==0){bI.scrollByX(j*bg.arrowButtonSpeed);}if(i!==0){bI.scrollByY(i*bg.arrowButtonSpeed);}h=setTimeout(o,g?bg.initialDelay:bg.arrowRepeatFreq);g=false;};o();k=l?"mouseout.jsp":"mouseup.jsp";l=l||e("html");l.bind(k,function(){n.removeClass("jspActive");h&&clearTimeout(h);h=null;l.unbind(k);});}function bF(){bS();if(aK){a8.bind("mousedown.jsp",function(l){if(l.originalTarget===f||l.originalTarget==l.currentTarget){var j=e(this),n=j.offset(),k=l.pageY-n.top-bs,h,g=true,o=function(){var r=j.offset(),t=l.pageY-r.top-s/2,p=bQ*bg.scrollPagePercent,q=br*p/(bZ-bQ);if(k<0){if(bs-q>t){bI.scrollByY(-p);}else{bR(t);}}else{if(k>0){if(bs+q<t){bI.scrollByY(p);}else{bR(t);}}else{i();return;}}h=setTimeout(o,g?bg.initialDelay:bg.trackClickRepeatFreq);g=false;},i=function(){h&&clearTimeout(h);h=null;e(document).unbind("mouseup.jsp",i);};o();e(document).bind("mouseup.jsp",i);return false;}});}if(aU){bo.bind("mousedown.jsp",function(l){if(l.originalTarget===f||l.originalTarget==l.currentTarget){var j=e(this),n=j.offset(),k=l.pageX-n.left-aJ,h,g=true,o=function(){var r=j.offset(),t=l.pageX-r.left-bb/2,p=a2*bg.scrollPagePercent,q=bt*p/(bN-a2);if(k<0){if(aJ-q>t){bI.scrollByX(-p);}else{bT(t);}}else{if(k>0){if(aJ+q<t){bI.scrollByX(p);}else{bT(t);}}else{i();return;}}h=setTimeout(o,g?bg.initialDelay:bg.trackClickRepeatFreq);g=false;},i=function(){h&&clearTimeout(h);h=null;e(document).unbind("mouseup.jsp",i);};o();e(document).bind("mouseup.jsp",i);return false;}});}}function bS(){if(bo){bo.unbind("mousedown.jsp");}if(a8){a8.unbind("mousedown.jsp");}}function be(){e("html").unbind("dragstart.jsp selectstart.jsp mousemove.jsp mouseup.jsp mouseleave.jsp");if(bc){bc.removeClass("jspActive");}if(bp){bp.removeClass("jspActive");}}function bR(h,g){if(!aK){return;}if(h<0){h=0;}else{if(h>br){h=br;}}if(g===f){g=bg.animateScroll;}if(g){bI.animate(bc,"top",h,aP);}else{bc.css("top",h);aP(h);}}function aP(g){if(g===f){g=bc.position().top;}a4.scrollTop(0);bs=g;var j=bs===0,h=bs==br,i=g/br,k=-i*(bZ-bQ);if(a1!=j||aY!=h){a1=j;aY=h;bj.trigger("jsp-arrow-change",[a1,aY,bG,bv]);}bO(j,h);bX.css("top",k);bj.trigger("jsp-scroll-y",[-k,j,h]).trigger("scroll");}function bT(g,h){if(!aU){return;}if(g<0){g=0;}else{if(g>bt){g=bt;}}if(h===f){h=bg.animateScroll;}if(h){bI.animate(bp,"left",g,aR);}else{bp.css("left",g);aR(g);}}function aR(g){if(g===f){g=bp.position().left;}a4.scrollTop(0);aJ=g;var j=aJ===0,i=aJ==bt,h=g/bt,k=-h*(bN-a2);if(bG!=j||bv!=i){bG=j;bv=i;bj.trigger("jsp-arrow-change",[a1,aY,bG,bv]);}bJ(j,i);bX.css("left",k);bj.trigger("jsp-scroll-x",[-k,j,i]).trigger("scroll");}function bO(g,h){if(bg.showArrows){a9[g?"addClass":"removeClass"]("jspDisabled");aT[h?"addClass":"removeClass"]("jspDisabled");}}function bJ(g,h){if(bg.showArrows){bf[g?"addClass":"removeClass"]("jspDisabled");bU[h?"addClass":"removeClass"]("jspDisabled");}}function bA(i,g){var h=i/(bZ-bQ);bR(h*br,g);}function bC(g,i){var h=g/(bN-a2);bT(h*bt,i);}function aL(v,p,h){var l,i,j,w=0,u=0,g,o,n,r,q,t;try{l=e(v);}catch(k){return;}i=l.outerHeight();j=l.outerWidth();a4.scrollTop(0);a4.scrollLeft(0);while(!l.is(".jspPane")){w+=l.position().top;u+=l.position().left;l=l.offsetParent();if(/^body|html$/i.test(l[0].nodeName)){return;}}g=aM();n=g+bQ;if(w<g||p){q=w-bg.verticalGutter;}else{if(w+i>n){q=w-bQ+i+bg.verticalGutter;}}if(q){bA(q,h);}o=aQ();r=o+a2;if(u<o||p){t=u-bg.horizontalGutter;}else{if(u+j>r){t=u-a2+j+bg.horizontalGutter;}}if(t){bC(t,h);}}function aQ(){return -bX.position().left;}function aM(){return -bX.position().top;}function bw(){var g=bZ-bQ;return(g>20)&&(g-aM()<10);}function bh(){var g=bN-a2;return(g>20)&&(g-aQ()<10);}function aV(){a4.unbind(aN).bind(aN,function(j,k,i,g){var h=aJ,l=bs;bI.scrollBy(i*bg.mouseWheelSpeed,-g*bg.mouseWheelSpeed,false);return h==aJ&&l==bs;});}function bB(){a4.unbind(aN);}function aO(){return false;}function bu(){bX.find(":input,a").unbind("focus.jsp").bind("focus.jsp",function(g){aL(g.target,false);});}function bk(){bX.find(":input,a").unbind("focus.jsp");}function bL(){var j,g,i=[];aU&&i.push(a5[0]);aK&&i.push(bP[0]);bX.focus(function(){bj.focus();});bj.attr("tabindex",0).unbind("keydown.jsp keypress.jsp").bind("keydown.jsp",function(n){if(n.target!==this&&!(i.length&&e(n.target).closest(i).length)){return;}var l=aJ,k=bs;switch(n.keyCode){case 40:case 38:case 34:case 32:case 33:case 39:case 37:j=n.keyCode;h();break;case 35:bA(bZ-bQ);j=null;break;case 36:bA(0);j=null;break;}g=n.keyCode==j&&l!=aJ||k!=bs;return !g;}).bind("keypress.jsp",function(k){if(k.keyCode==j){h();}return !g;});if(bg.hideFocus){bj.css("outline","none");if("hideFocus" in a4[0]){bj.attr("hideFocus",true);}}else{bj.css("outline","");if("hideFocus" in a4[0]){bj.attr("hideFocus",false);}}function h(){var l=aJ,k=bs;switch(j){case 40:bI.scrollByY(bg.keyboardSpeed,false);break;case 38:bI.scrollByY(-bg.keyboardSpeed,false);break;case 34:case 32:bI.scrollByY(bQ*bg.scrollPagePercent,false);break;case 33:bI.scrollByY(-bQ*bg.scrollPagePercent,false);break;case 39:bI.scrollByX(bg.keyboardSpeed,false);break;case 37:bI.scrollByX(-bg.keyboardSpeed,false);break;}g=l!=aJ||k!=bs;return g;}}function bK(){bj.attr("tabindex","-1").removeAttr("tabindex").unbind("keydown.jsp keypress.jsp");}function bi(){if(location.hash&&location.hash.length>1){var i,g,h=escape(location.hash);try{i=e(h);}catch(j){return;}if(i.length&&bX.find(h)){if(a4.scrollTop()===0){g=setInterval(function(){if(a4.scrollTop()>0){aL(h,true);e(document).scrollTop(a4.position().top);clearInterval(g);}},50);}else{aL(h,true);e(document).scrollTop(a4.position().top);}}}}function aZ(){e("a.jspHijack").unbind("click.jsp-hijack").removeClass("jspHijack");}function bz(){aZ();e("a[href^=#]").addClass("jspHijack").bind("click.jsp-hijack",function(){var h=this.href.split("#"),g;if(h.length>1){g=h[1];if(g.length>0&&bX.find("#"+g).length>0){aL("#"+g,true);return false;}}});}function a6(){var h,g,j,i,k,l=false;a4.unbind("touchstart.jsp touchmove.jsp touchend.jsp click.jsp-touchclick").bind("touchstart.jsp",function(n){var o=n.originalEvent.touches[0];h=aQ();g=aM();j=o.pageX;i=o.pageY;k=false;l=true;}).bind("touchmove.jsp",function(q){if(!l){return;}var p=q.originalEvent.touches[0],o=aJ,n=bs;bI.scrollTo(h+j-p.pageX,g+i-p.pageY);k=k||Math.abs(j-p.pageX)>5||Math.abs(i-p.pageY)>5;return o==aJ&&n==bs;}).bind("touchend.jsp",function(n){l=false;}).bind("click.jsp-touchclick",function(n){if(k){k=false;return false;}});}function bn(){var h=aM(),g=aQ();bj.removeClass("jspScrollable").unbind(".jsp");bj.replaceWith(a7.append(bX.children()));a7.scrollTop(h);a7.scrollLeft(g);}e.extend(bI,{reinitialise:function(g){g=e.extend({},bg,g);ba(g);},scrollToElement:function(h,g,i){aL(h,g,i);},scrollTo:function(h,i,g){bC(h,g);bA(i,g);},scrollToX:function(g,h){bC(g,h);},scrollToY:function(h,g){bA(h,g);},scrollToPercentX:function(g,h){bC(g*(bN-a2),h);},scrollToPercentY:function(g,h){bA(g*(bZ-bQ),h);},scrollBy:function(g,i,h){bI.scrollByX(g,h);bI.scrollByY(i,h);},scrollByX:function(j,h){var g=aQ()+Math[j<0?"floor":"ceil"](j),i=g/(bN-a2);bT(i*bt,h);},scrollByY:function(j,h){var g=aM()+Math[j<0?"floor":"ceil"](j),i=g/(bZ-bQ);bR(i*br,h);},positionDragX:function(h,g){bT(h,g);},positionDragY:function(g,h){bR(g,h);},animate:function(g,j,k,i){var h={};h[j]=k;g.animate(h,{duration:bg.animateDuration,easing:bg.animateEase,queue:false,step:i});},getContentPositionX:function(){return aQ();},getContentPositionY:function(){return aM();},getContentWidth:function(){return bN;},getContentHeight:function(){return bZ;},getPercentScrolledX:function(){return aQ()/(bN-a2);},getPercentScrolledY:function(){return aM()/(bZ-bQ);},getIsScrollableH:function(){return aU;},getIsScrollableV:function(){return aK;},getContentPane:function(){return bX;},scrollToBottom:function(g){bR(br,g);},hijackInternalLinks:function(){bz();},destroy:function(){bn();}});ba(bE);}b=e.extend({},e.fn.jScrollPane.defaults,b);e.each(["mouseWheelSpeed","arrowButtonSpeed","trackClickSpeed","keyboardSpeed"],function(){b[this]=b[this]||b.speed;});return this.each(function(){var h=e(this),i=h.data("jsp");if(i){i.reinitialise(b);}else{i=new a(h,b);h.data("jsp",i);}});};e.fn.jScrollPane.defaults={showArrows:false,maintainPosition:true,stickToBottom:false,stickToRight:false,clickOnTrack:true,autoReinitialise:false,autoReinitialiseDelay:500,verticalDragMinHeight:0,verticalDragMaxHeight:99999,horizontalDragMinWidth:0,horizontalDragMaxWidth:99999,contentWidth:f,animateScroll:false,animateDuration:300,animateEase:"linear",hijackInternalLinks:false,verticalGutter:4,horizontalGutter:4,mouseWheelSpeed:0,arrowButtonSpeed:0,arrowRepeatFreq:50,arrowScrollOnHover:false,trackClickSpeed:0,trackClickRepeatFreq:70,verticalArrowPositions:"split",horizontalArrowPositions:"split",enableKeyboardNavigation:true,hideFocus:false,keyboardSpeed:0,initialDelay:300,speed:30,scrollPagePercent:0.8};})(jQuery,this);(function(l){l.fn.carousel=function(a){var a=l.extend({direction:"horizontal",loop:false,dispItems:1,pagination:false,paginationPosition:"inside",nextBtn:'<a role="button">Next</a>',prevBtn:'<a role="button">Previous</a>',btnsPosition:"inside",nextBtnInsert:"appendTo",prevBtnInsert:"appendTo",nextBtnInsertFn:false,prevBtnInsertFn:false,autoSlide:false,autoSlideInterval:3000,delayAutoSlide:false,combinedClasses:false,effect:"slide",slideEasing:"swing",animSpeed:"normal",equalWidths:"true",verticalMargin:0,callback:function(){},useAddress:false,adressIdentifier:"carousel",tabLabel:function(b){return b;},showEmptyItems:true},a);if(a.btnsPosition=="outside"){a.prevBtnInsert="insertAfter";a.nextBtnInsert="insertAfter";}a.delayAutoSlide=a.delayAutoSlide||a.autoSlideInterval;return this.each(function(){var b={$elts:{},params:a,launchOnLoad:[]};b.$elts.carousel=l(this).addClass("js");b.$elts.content=l(this).children().css({position:"absolute",top:0});b.$elts.wrap=b.$elts.content.wrap('<div class="carousel-wrap"></div>').parent().css({overflow:"hidden",position:"relative"});b.steps={first:0,count:b.$elts.content.children().length};b.steps.last=b.steps.count-1;if(l.isFunction(b.params.prevBtnInsertFn)){b.$elts.prevBtn=b.params.prevBtnInsertFn(b.$elts);}else{b.$elts.prevBtn=l(a.prevBtn)[a.prevBtnInsert](b.$elts.carousel);}if(l.isFunction(b.params.nextBtnInsertFn)){b.$elts.nextBtn=b.params.nextBtnInsertFn(b.$elts);}else{b.$elts.nextBtn=l(a.nextBtn)[a.nextBtnInsert](b.$elts.carousel);}b.$elts.nextBtn.addClass("carousel-control next carousel-next");b.$elts.prevBtn.addClass("carousel-control previous carousel-previous");j(b);if(b.params.pagination){s(b);}r(b);l(function(){var f=b.$elts.content.children();var e=0;f.each(function(){$item=l(this);$itemHeight=$item.outerHeight();if($itemHeight>e){e=$itemHeight;}});if(b.params.verticalMargin>0){e=e+b.params.verticalMargin;}f.height(e);var d=b.$elts.content.children(":first");b.itemWidth=d.outerWidth();if(a.direction=="vertical"){b.contentWidth=b.itemWidth;}else{if(a.equalWidths){b.contentWidth=b.itemWidth*b.steps.count;}else{b.contentWidth=(function(){var g=0;b.$elts.content.children().each(function(){g+=l(this).outerWidth();});return g;})();}}b.$elts.content.width(b.contentWidth);b.itemHeight=e;if(a.direction=="vertical"){b.$elts.content.css({height:b.itemHeight*b.steps.count+"px"});b.$elts.content.parent().css({height:b.itemHeight*b.params.dispItems+"px"});}else{b.$elts.content.parent().css({height:b.itemHeight+"px"});}n(b);l.each(b.launchOnLoad,function(g,h){h();});if(b.params.autoSlide){window.setTimeout(function(){b.autoSlideInterval=window.setInterval(function(){k(b,o(b,"next"));},b.params.autoSlideInterval);},b.params.delayAutoSlide);}});});};function j(a){a.$elts.nextBtn.add(a.$elts.prevBtn).bind("enable",function(){var b=l(this).unbind("click").bind("click",function(){k(a,o(a,(b.is(".next")?"next":"prev")));q(a);navigateButtons(this);}).removeClass("disabled");if(a.params.combinedClasses){b.removeClass("next-disabled previous-disabled");}}).bind("disable",function(){var b=l(this).unbind("click").addClass("disabled");if(a.params.combinedClasses){if(b.is(".next")){b.addClass("next-disabled");}else{if(b.is(".previous")){b.addClass("previous-disabled");}}}}).hover(function(){l(this).toggleClass("hover");});}function s(a){a.$elts.pagination=l('<div class="center-wrap"><div class="carousel-pagination"><div><p></p></div></div></div>')[((a.params.paginationPosition=="outside")?"insertAfter":"appendTo")](a.$elts.carousel).find("p");a.$elts.paginationBtns=l([]);a.$elts.content.find("li").each(function(b){if(b%a.params.dispItems==0){a.$elts.paginationBtns=a.$elts.paginationBtns.add(l('<a role="button"><span>'+a.params.tabLabel(a.$elts.paginationBtns.length+1)+"</span></a>").data("firstStep",b));}});a.$elts.paginationBtns.each(function(){l(this).appendTo(a.$elts.pagination);});a.$elts.paginationBtns.slice(0,1).addClass("active");a.launchOnLoad.push(function(){a.$elts.paginationBtns.click(function(b){k(a,l(this).data("firstStep"));q(a);});});a.$elts.content.closest(".bgBottom").find(".prodDescription").height();}function r(a){if(a.params.useAddress&&l.isFunction(l.fn.address)){l.address.init(function(d){var b=l.address.pathNames();if(b[0]===a.params.adressIdentifier&&!!b[1]){k(a,b[1]-1);}else{l.address.value("/"+a.params.adressIdentifier+"/1");}}).change(function(d){var b=l.address.pathNames();if(b[0]===a.params.adressIdentifier&&!!b[1]){k(a,b[1]-1);}});}else{a.params.useAddress=false;}}function k(a,b){a.params.callback(b);p(a,b);a.steps.first=b;n(a);if(a.params.useAddress){l.address.value("/"+a.params.adressIdentifier+"/"+(b+1));}}function o(b,a){if(a=="prev"){if(!b.params.showEmptyItems){if(b.steps.first==0){return((b.params.loop)?(b.steps.count-b.params.dispItems):false);}else{return Math.max(0,b.steps.first-b.params.dispItems);}}else{if((b.steps.first-b.params.dispItems)>=0){return b.steps.first-b.params.dispItems;}else{return((b.params.loop)?(b.steps.count-b.params.dispItems):false);}}}else{if(a=="next"){if((b.steps.first+b.params.dispItems)<b.steps.count){if(!b.params.showEmptyItems){return Math.min(b.steps.first+b.params.dispItems,b.steps.count-b.params.dispItems);}else{return b.steps.first+b.params.dispItems;}}else{return((b.params.loop)?0:false);}}}}function p(d,e){var f=$(d.$elts.content).find("li:eq("+e+")"),a=f.hasClass("videoLi"),b=f.find("img");if(a){adUnits_initializeVideo(d.$elts.content,e);}else{b.attr("src",b.attr("sourceUrl"));}switch(d.params.effect){case"no":if(d.params.direction=="vertical"){d.$elts.content.css("top",-(d.itemHeight*e)+"px");}else{d.$elts.content.css("left",-(d.itemWidth*e)+"px");}break;case"fade":if(d.params.direction=="vertical"){d.$elts.content.hide().css("top",-(d.itemHeight*e)+"px").fadeIn(d.params.animSpeed);}else{d.$elts.content.hide().css("left",-(d.itemWidth*e)+"px").fadeIn(d.params.animSpeed);}break;default:if(d.params.direction=="vertical"){d.$elts.content.stop().animate({top:-(d.itemHeight*e)+"px"},d.params.animSpeed,d.params.slideEasing);}else{d.$elts.content.stop().animate({left:-(d.itemWidth*e)+"px"},d.params.animSpeed,d.params.slideEasing);}break;}}function n(a){if(o(a,"prev")!==false){a.$elts.prevBtn.trigger("enable");}else{a.$elts.prevBtn.trigger("disable");}if(o(a,"next")!==false){a.$elts.nextBtn.trigger("enable");}else{a.$elts.nextBtn.trigger("disable");}if(a.params.pagination){a.$elts.paginationBtns.removeClass("active").filter(function(){return(l(this).data("firstStep")==a.steps.first);}).addClass("active");}}function q(a){if(!!a.autoSlideInterval){window.clearInterval(a.autoSlideInterval);}}})(jQuery);(function(a){jQuery.fn.pngFix=function(e){e=jQuery.extend({blankgif:"blank.gif"},e);var b=(navigator.appName=="Microsoft Internet Explorer"&&parseInt(navigator.appVersion)==4&&navigator.appVersion.indexOf("MSIE 5.5")!=-1);var d=(navigator.appName=="Microsoft Internet Explorer"&&parseInt(navigator.appVersion)==4&&navigator.appVersion.indexOf("MSIE 6.0")!=-1);if(jQuery.browser.msie&&(b||d)){jQuery(this).each(function(){jQuery(this).attr("width",jQuery(this).width());jQuery(this).attr("height",jQuery(this).height());var n="";var o="";var j=(jQuery(this).attr("id"))?'id="'+jQuery(this).attr("id")+'" ':"";var h=(jQuery(this).attr("class"))?'class="'+jQuery(this).attr("class")+'" ':"";var l=(jQuery(this).attr("title"))?'title="'+jQuery(this).attr("title")+'" ':"";var g=(jQuery(this).attr("alt"))?'alt="'+jQuery(this).attr("alt")+'" ':"";var f=(jQuery(this).attr("align"))?"float:"+jQuery(this).attr("align")+";":"";var i=(jQuery(this).parent().attr("href"))?"cursor:hand;":"";if(this.style.border){n+="border:"+this.style.border+";";this.style.border="";}if(this.style.padding){n+="padding:"+this.style.padding+";";this.style.padding="";}if(this.style.margin){n+="margin:"+this.style.margin+";";this.style.margin="";}var k=(this.style.cssText);o+="<span "+j+h+l+g;o+='style="position:relative;white-space:pre-line;display:inline-block;background:transparent;'+f+i;o+="width:"+jQuery(this).width()+"px;height:"+jQuery(this).height()+"px;";o+="filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+jQuery(this).attr("src")+"', sizingMethod='scale');";o+=k+'"></span>';if(n!=""){o='<span style="position:relative;display:inline-block;'+n+i+"width:"+jQuery(this).width()+"px;height:"+jQuery(this).height()+'px;">'+o+"</span>";}jQuery(this).hide();jQuery(this).after(o);});jQuery(this).find("input[src$=.png]").each(function(){var f=jQuery(this).attr("src");jQuery(this).get(0).runtimeStyle.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+f+"', sizingMethod='scale');";jQuery(this).attr("src",e.blankgif);});}return jQuery;};})(jQuery);var Resource={Groups:{},Get:function(d,b){var a=this.Groups[d];if(a==null){return"";}return a.Get(b);},Format:function(e,d,a){var b=this.Groups[e];if(b==null){return"";}return b.Format(d,a);},Register:function(a,b){this.Groups[a]=new Resources(b);}};function Resources(a){this.Messages=a;}Resources.prototype.Messages={};Resources.prototype.Get=function(a){var b=this.Messages[a];return b;};Resources.prototype.Format=function(b,a){var d=this.Messages[b];if(a==null||a.length==0){return d;}for(var e=0;e<a.length;e++){d=d.replace(new RegExp("\\{"+e+"\\}","gm"),a[e]);}return d;};var MultiPageResourceStrings={Cart:{OrderLimitReached:"You exceeded the maximum number of products allowed.\nPlease review your selections.",ConfirmRemove:"Are you sure you want to remove the following item from your shopping cart:\n\n{0}\n\nClick OK to continue with remove.\nClick CANCEL to keep item in shopping cart."}};var AdUnitHelper={UpdateCartLink:function(a,f,b){var e="cartItemLink_"+f;var d=document.getElementById(e);if(!d){return;}AdUnitHelper.ApplyClassNameForAction(a,d);if(b){d.onclick=b;}if(a=="Remove"){var g=$("#"+e).parent().parent().parent();if(g.find(".dropdown").length){_dropdownRemoveCart(e,true);}}},ResetCartLinks:function(cart){var linkPrefix="cartItemLink_";for(var ndx=0;ndx<cart.Items.length;ndx++){var item=cart.Items[ndx];var linkId=linkPrefix+item.Id;var link=document.getElementById(linkId);if(link!=null&&link!=undefined){AdUnitHelper.ApplyClassNameForAction("Add",link);var codeBlock=null;eval("codeBlock = function() { _cart.RemoveById('"+item.Id+"', false); return false; };");link.onclick=codeBlock;var wrapper=$("#"+linkId).parent().parent().parent();if(wrapper.find(".dropdown").length){_dropDownAutoAdd(linkId);}var quantityPanel=$("#offerQuantity_"+item.Id).closest(".offercap-middle");quantityPanel.addClass("hidden");}else{if(!window._multipage||!window._multipage.Tabs||!window._multipage.Tabs.MobileAddToCartButtons){return;}var msb=window._multipage.Tabs.MobileAddToCartButtons[item.Id];if(!msb){return;}msb.setState("remove");}}},ApplyClassNameForAction:function(a,f){var b="Add";var d="added";var i=f.className;var g=(i&&i.length?i.indexOf(d):-1);var h=(g!=-1);if(a==b&&h){return;}if(a==b&&!h){var e=(i&&i.length?" ":"")+d;f.className=i+e;return;}if(a!=b&&h){f.className=i.replace(d,"");}}};var MpUtils={ScrollToMultipage:function(a){MpUtils.ScrollToMultipageArea(true,a);},ScrollToMultipageArea:function(a,b){if(!b&&_multipage.GetMaxTabSeen()<=0){return;}if(a){if(typeof DevicesHelper!="undefined"&&DevicesHelper.HasAnchorTagInUrl()){return;}}MpUtils.ScrollTo("mpWrap");},ReplaceAll:function(d,e,b){var f=d;var a=f.indexOf(e);while(a!=-1){f=f.replace(e,b);a=f.indexOf(e);}return f;},FormatPrice:function(d){var e=new String(d);var a=e.indexOf(".");if(a==-1){return e+".00";}var b=e.substr(a+1).length;if(b==1){return e+"0";}return e.substr(0,a+3);},GetOrderLimit:function(){iOrderLimit=0;if(window.SpectrumRegistrationCore&&window.SpectrumRegistrationCore.GetOrderLimit){var a=window.SpectrumRegistrationCore.GetOrderLimit();iOrderLimit=parseInt(a);iOrderLimit=isNaN(iOrderLimit)?0:iOrderLimit;}return iOrderLimit;},DisplaySubmit:function(b,e){var d=e?"block":"none";var f=document.getElementById("submitButton");if(f){f.className="mpEntryOnlyButton";}if(b>0){$(".submitWrap p input").removeClass("mpEntryOnlyButton");$(".submitWrap p input").addClass("mpOrderEntryButton");}else{$(".submitWrap p input").removeClass("mpOrderEntryButton");$(".submitWrap p input").addClass("mpEntryOnlyButton");}var a=document.getElementById("continueButtonWrap");if(a){a.style.display=d;}},SubmitForm:function(){if(Notifications.Notify("on-before-form-submit",this,null)===NotificationResults.Cancel){return false;}_globalSubmit=true;document.forms[0].submit();return true;},FindPos:function(b){var a=-1;if(!b){return a;}if(b.offsetParent){a=b.offsetTop;while(b=b.offsetParent){a+=b.offsetTop;}}return a;},ScrollTo:function(b){var a=document.getElementById(b);if(!a){return;}var d=MpUtils.FindPos(a);if(d==-1){return;}window.scrollTo(0,d);},TryLog:function(a){try{a();}catch(b){try{console.error(b);}catch(d){}}},ConvertCharEntities:function(b){for(var a=0;a<arrCharEnt.length;a++){b=b.replace(arrCharEnt[a][0],arrCharEnt[a][1]);}b=MpUtils.CharRefToUnicode(b);var d=/<\S[^>]*>/g;b=b.replace(d,"");return b;},CharRefToUnicode:function(a){return a.replace(/&#(([0-9]{1,7})|(x[0-9a-f]{1,6}));?/gi,function(b,e,f,g,d,h){return String.fromCharCode(f||("0"+g));});}};var MpBlinker={OriginalBorder:"",CurrentId:"",NumberTimesToBlink:6,CurrentBlink:0,Color1:"#cccccc",Color2:"#0099cc",BaseBorder:"3px solid ",TimeDelay:500,Init:function(a){this.Clear();this.CurrentId=a;this.OriginalBorder=document.getElementById(a).style.border;},Clear:function(){if(this.CurrentId!=null&&this.CurrentId!=""){document.getElementById(this.CurrentId).style.border=this.OriginalBorder;}this.CurrentBlink=0;this.CurrentId=null;},Blink:function(e){if(e!=this.CurrentId){this.Init(e);}this.CurrentBlink++;var a=this.CurrentBlink%2==0?this.Color1:this.Color2;var d=document.getElementById(e);var f=false;if(typeof d.getAttribute("type")!=="undefined"&&d.getAttribute("type")==="twoAcross"){var b=this.CurrentBlink%2==0?"#ffffff":this.Color2;d.style.color=b;f=true;}else{d.style.border=this.BaseBorder+a;}if(this.CurrentBlink>=this.NumberTimesToBlink){if(f){d.style.color="#ffffff";}else{d.style.border=this.OriginalBorder;}this.Clear();}else{window.setTimeout("MpBlinker.Blink('"+e+"')",this.TimeDelay);}}};(function(i){var f={StopAndGoActionCancel:function(){Notifications.Notify("on-sag-nothanksbutton-click-event",this,{buttonName:"NoThanksLink"});i.SpectrumDeviceManager.HideCurrentlyActiveLightbox();return false;},StopAndGoActionContinue:function(n,k){var l=$("#"+n).closest("div[deviceid]");if(!l.length){return;}var p=parseInt(l.attr("deviceid"));if(!i.SpectrumDeviceManager){return;}var o=i.SpectrumDeviceManager.FindPathDeviceModelById(p);if(!o||!o.StopAndGoButtons){return;}var u=null;var w=null;var s=null;for(var r=0;r<o.StopAndGoButtons.length;r++){var j=o.StopAndGoButtons[r];if(!j||j.Name!=k){continue;}u=j.StepName;if(j.TabNumber!=0){w=j.TabNumber;}if(j.OfferCode!=null){s=j.OfferCode;}break;}if(!u||u.length<=0){return;}Notifications.Notify("on-sag-takeanotherlookbutton-click-event",this,{buttonName:k});var q=i.baseUrl+"Path/"+i.pathData.Name+"/";var v=this.PrepareAnchorForTabAndOffer(w,s);var x=(v!=null)?q+u+".aspx"+v:q+u+".aspx";if(!SpectrumRegistrationCore||!SpectrumRegistrationCore.Utils){return;}SpectrumRegistrationCore.Utils.RedirectTo(x);var t=window.location.protocol+"//"+window.location.host+window.location.pathname;if(x.indexOf(t)>-1){i.location.reload();return false;}},GetOrderLimits:function(){if(!window.SpectrumRegistrationCore.IsUserRecognized()){return{TotalOrderLimit:0};}return{TotalOrderLimit:SpectrumRegistrationResponseDto.SpectrumCustomer.ScoringVariables.TotalOrderLimit};},PrepareAnchorForTabAndOffer:function(l,j){var k=null;if(l!=null){k="#t_"+l;}if(j!=null){k=k+"_o_"+j;}return k;},FireGaTagsInEoForm:function(j,k){Notifications.Notify("on-continue-shopping-event",null,{buttonName:j});if(typeof k==="function"){setTimeout(k,1000);}},GetAddOnVariables:function(n,p){var j={};var k=$(n);var o=k.closest("[deviceid]");if(!k.length||!o.length){return j;}var l=parseInt(o.attr("deviceid"));if(window.deviceSettings&&window.deviceSettings.GetAddOnVariablesBasedOnDeviceId){j=window.deviceSettings.GetAddOnVariablesBasedOnDeviceId(l,p);}return j;},GetContentVariables:function(n,p){var j={};var k=$(n);var o=k.closest("[deviceid]");if(!k.length||!o.length){return j;}var l=parseInt(o.attr("deviceid"));if(window.deviceSettings&&window.deviceSettings.GetContentVariablesBasedOnDeviceId){j=window.deviceSettings.GetContentVariablesBasedOnDeviceId(l,p);}return j;},RegisterOnDeviceVisibleCallback:function(j,l,k){l=l||0;k=k||"onTabLoad";if(!i.SpectrumDeviceManager||j==null){return;}i.SpectrumDeviceManager.RegisterDeviceVisibleCallback(j,l,k);}};var g={RegisterRecommendationsManager:function(j){if(!i.SpectrumDeviceManager){return;}i.SpectrumDeviceManager.ForEachStepDeviceInstance({DeviceType:"TargetedProducts"},function(k){k.SetRecommendationsManager(j);});},AreRecommendationsAvailable:function(){return true;}};var e={ShowHiddenAreas:function(j){i.SpectrumDeviceManager.ForEachStepDeviceInstance({DeviceType:"Reveal"},function(k){k.ShowAreas(j);});}};var a={RegisterSetOrderEntryButtonCallback:function(j){if(!j){return;}if(!window._cart||!window._cart.Renderer){return;}window._cart.Renderer.SubmitButtonCallback=j;}};var d={GetSegments:function(){if(!window.pathSegmentsInformation){return;}var j=window.pathSegmentsInformation.split(",");return j;}};var h={GetSegments:function(){return SpectrumRegistrationResponseDto.SpectrumCustomer.Segments.SegCodes;}};var b={GetAbandonedCartInfo:function(j){if(typeof j!=="function"){return;}var n={gmt:window.SpectrumRegistrationResponseDto.SpectrumCustomer.UserInternal.GlobalMemberToken,pathId:window.pathData.Id};var l=function(o){if(!o||!o.Titles){j(null);return;}j({ItemCount:o.Titles.length,Titles:o.Titles});};var k=function(p,o){console.log("Abandoned Cart service failed with error "+p+". Ajax Call Status "+o);j({});};$.ajax({url:window.baseUrl+"Proxies/AbandonedCartServiceProxy.aspx?methodName=GetAbandonedCartInfo",success:l,type:"POST",data:$.toJSON(n),contentType:"application/json",error:k});}};i.SpectrumPackageFacade=f;i.SpectrumPackageFacade.TargetedProductsDevice=g;i.SpectrumPackageFacade.RevealDevice=e;i.SpectrumPackageFacade.AbandonedCartDevice=a;i.SpectrumPackageFacade.PathInfo=d;i.SpectrumPackageFacade.UserInfo=h;i.SpectrumPackageFacade.AbandonedCartInfo=b;})(window);