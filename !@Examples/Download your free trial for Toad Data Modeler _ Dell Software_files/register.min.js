var asking=true,dbDataSet="",dbDataSrc="",foundCompany=false,companyOpen=false,enterincopany=false;var alreadyPickUpDemanBase=true;$(document).ready(function(){chklicenseClick();chklicenseClickII();CrawledchklicenseClick();$("#chklicense").change(chklicenseClick);$("#chklicenseII").change(chklicenseClickII);$("#Crawledchklicense").change(CrawledchklicenseClick);$("#registersubmit").click(function(){if(!isSubmitButtonActive("#registersubmit")){return false}$("#isAlreadyReadLandingPage").val("1");ProspectProcess()});if($("#registersubmit").length){var d=$("#registersubmit"),c=d.width(),f=$("<div>").css({position:"absolute",left:-9999,top:-9999}).html(d.val()),b=parseInt(d.css("fontSize"));f.css({fontSize:b,fontFamily:d.css("fontFamily")});f.appendTo("body");while(f.width()>c){b-=0.1;f.css("fontSize",b)}$("#registersubmit").css("fontSize",b);f.remove()}$("#registersubmitII").click(function(){if(!isSubmitButtonActive("#registersubmitII")){return false}if($("#IsEventSeries").val()=="1"){var g="";$('input[name="events[]"]').each(function(){if($(this).is(":checked")){g+=$(this).val()+","}});if(g==""){$("#errorNoEvenSelected").show();return false}}ProspectProcess()});$("#Crawledregistersubmit").click(function(){if(!isSubmitButtonActive("#Crawledregistersubmit")){return false}CrawledProspectProcess(false)});if($("#frmRegister").length>0){var e="#frmRegister";SetFunctionnalityByForm(e);if(demandbasecall==true&&$(e).find("#Company").length>0){$("#Email").keyup(function(){$("#dumbEmail").val($("#Email").val())});$("#Email").blur(function(){$("#dumbEmail").val($("#Email").val())});dbDataSet="";dbDataSrc="";foundCompany=false;var a=[];$("tr[firstscreen=0]").each(function(h,g){var i=$(g).attr("id");if(i!=undefined&&i!=null){a.push(i.replace("tr_",""))}});DemandBaseInitialize(e,"#registersubmit","Company",a,{form:document.forms.frmManageAccount});CountryChange(e)}else{$(e).find("tr[firstscreen=0]").show()}}noLicenseAgreeForms()});function ProspectProcess(){DefineValx();var m="#frmRegister";var e={};var o="";var c="";var g=true;var i=$("#regadditionalinfo").val();if(!ValidFieldsForms("#frmRegister")){return false}$("#body-container").find("> article").hide();$("#downloadfiles").show();if($("#ProfileFields").val()!=undefined){if($("#ProfileFields").val()!=""){var l=$("#ProfileFields").val().split(",");$.each(l,function(q,p){e[p]=$(m).find("#"+p).val();g=false})}if($("#PredefinedFields").val()!=undefined&&$("#PredefinedFields").val()!=""){o="<Fields>";var d=$("#PredefinedFields").val().split(",");$.each(d,function(q,p){o+="<Field>";o+="<Name>"+p+"</Name>";o+="<Value>";if($(m).find("#"+p).val()!=undefined){o+=encodeXml($(m).find("#"+p).val())}else{o+="$$"+p+"$$"}o+="</Value>";o+="</Field>"});o+="</Fields>"}if($("#CustomFields").val()!=undefined&&$("#CustomFields").val()!=""){c="<Fields>";var a=$("#CustomFields").val().split(",");$.each(a,function(q,p){c+="<Field>";c+="<Name>"+p+"</Name>";c+="<Value>"+encodeXml($("#"+p).valx())+"</Value>";c+="</Field>"});c+="</Fields>"}if(e.comments!=undefined){i=e.comments+";"+i}e.comments=i;e.predefinedAnswers_XML=o;e.customAnswers_XML=c;g=false}e.AssetCodeID=$("#AssetCodeID").val();e.LandingPageID=$("#LandingPageID").val();e.formFillType=$("#FormFillType").val();if($(m).find("#chkOptIn").is(":visible")){e.OptIn=$(m).find("#chkOptIn").is(":checked")}e.AssetEmployeeCountFieldName=$("#AssetEmployeeCountFieldName").val();e.AssetEmployeeCountOption=$("#AssetEmployeeCountOption").val();var n="";if($("#EventID").val()!=""){$('input[name="events[]"]').each(function(){if($(this).is(":checked")){n+=$(this).val()+","}});e.EventAssetCodeIDs=n;e.EventID=$("#EventID").val()}ctrl=$("#registersubmit");ctrl.prop("disabled","disabled");ctrl.prop("value",siteTags.SiteRegPleaseWait);ctrl=$("#registersubmitII");ctrl.prop("disabled","disabled");ctrl.prop("value",siteTags.SiteRegPleaseWait);var b=true;if(IsLandingPage(currentpage)){b=false}e.returnDF=b;e.industrySIC=$("#DBIndustrySIC").val();e.dbLatitude=$("#DB_Latitude").val();e.dbLongitude=$("#DB_Longitude").val();e.dbIndustry=$("#DB_Industry").val();e.dbSubIndustry=$("#DB_SubIndustry").val();if(employeecount!=undefined&&employeecount!=null){e.demandbase_employeecount=employeecount}if(location.pathname=="/register/55006/"){var f=["74469","74468","74467"],k=new oPostDataset(e,f[0]),j=new oPostDataset(e,f[1]),h=new oPostDataset(e,f[2]);$.when($.ajax({url:DomainPath+RootPath+"sso/CLProspectProcess",contentType:"application/json; charset=utf-8",type:"POST",data:JSON.stringify(k),success:function(p){},error:function(){console.log("Cannot Insert prospect at this moment please try again later ")},async:true}),$.ajax({url:DomainPath+RootPath+"sso/CLProspectProcess",contentType:"application/json; charset=utf-8",type:"POST",data:JSON.stringify(j),success:function(p){},error:function(){console.log("Cannot Insert prospect at this moment please try again later ")},async:true}),$.ajax({url:DomainPath+RootPath+"sso/CLProspectProcess",contentType:"application/json; charset=utf-8",type:"POST",data:JSON.stringify(h),success:function(p){},error:function(){console.log("Cannot Insert prospect at this moment please try again later ")},async:true})).done(function(){$.ajax({url:DomainPath+RootPath+"Register/ProspectProcess",contentType:"application/json; charset=utf-8",type:"POST",data:JSON.stringify(e),success:function(r){if(!r.InternalError){$("#registersubmit").removeAttr("disabled");$("#isAlreadyReadLandingPage").val("1");if(r.islogged){if(!b){var p="";var u=true;var v="true";var t="true";var s="";s=GetParameterEncrypted(v,t,$("#AssetCodeID").val(),"false",$("#EventID").val(),n);if(s!=""){p="?param="+s}if(currentpage.indexOf("?")>=0){currentpage=Left(currentpage,currentpage.indexOf("?"))}var q=ThankYouPage(currentpage);window.location.href=q+p;return}else{$("#body-container").parent().removeClass("has-right-form");$("#right-form").hide();$("#right-form-partialreg").hide();if(r.assetTypeID!=73){$("#body-container").html(r.data)}else{$("#content-container").html(r.data)}}}else{window.location.href=currentpage}}else{window.location.href="/internalservererror/"}},error:function(){console.log("Cannot Insert prospect at this moment please try again later ")},async:true})})}else{$.ajax({url:DomainPath+RootPath+"Register/ProspectProcess",contentType:"application/json; charset=utf-8",type:"POST",data:JSON.stringify(e),success:function(r){if(!r.InternalError){if(r.rURL!=""){window.location.href=r.rURL;return}$("#registersubmit").removeAttr("disabled");$("#isAlreadyReadLandingPage").val("1");if(r.islogged){if(!b){var p="";var u=true;var v="true";var t="true";var s="";s=GetParameterEncrypted(v,t,$("#AssetCodeID").val(),"false",$("#EventID").val(),n);if(s!=""){p="?param="+s}if(currentpage.indexOf("?")>=0){currentpage=Left(currentpage,currentpage.indexOf("?"))}var q=ThankYouPage(currentpage);window.location.href=q+p;return}else{$("#body-container").parent().removeClass("has-right-form");$("#right-form").hide();$("#right-form-partialreg").hide();if(r.assetTypeID!=73){$("#body-container").html(r.data)}else{$("#content-container").html(r.data)}}}else{window.location.href=currentpage}}else{window.location.href="/internalservererror/"}},error:function(){console.log("Cannot Insert prospect at this moment please try again later ")},async:true})}}function oPostDataset(a,b){this.AssetCodeID=b;this.FirstName=a.FirstName;this.LastName=a.LastName;this.Email=a.Email;this.Title=a.Title;this.Company=a.Company;this.CountryCode=a.CountryCode;this.Address1=a.Address1;this.Address2=a.Address2;this.City=a.City;this.State_Province=a.State_Province;this.PostalCode=a.PostalCode;this.EmployeeCount=a.EmployeeCount;this.Phone=a.Phone;this.PublicSector=a.PublicSector;this.comments=a.comments;this.predefinedAnswers_XML=a.predefinedAnswers_XML;this.customAnswers_XML=a.customAnswers_XML;this.LandingPageID=a.LandingPageID;this.formFillType=a.formFillType;this.AssetEmployeeCountFieldName=a.AssetEmployeeCountFieldName;this.AssetEmployeeCountOption=a.AssetEmployeeCountOption;this.returnDF=a.returnDF;this.industrySIC=a.industrySIC;this.dbLatitude=a.dbLatitude;this.dbLongitude=a.dbLongitude;this.dbIndustry=a.dbIndustry;this.dbSubIndustry=a.dbSubIndustry;this.demandbase_employeecount=a.demandbase_employeecount}function FieldMapping(b,a){$(a).find("select[demandbasefield]").each(function(c,f){var e=$(f).attr("demandbasefield"),h=b[e]!=undefined?b[e]:-1,g=false;$(f).find("option").each(function(m,k){var j=parseInt($(k).attr("mapmax")),l=parseInt($(k).attr("mapmin"));if(h>=l&&h<=j){$(k).prop("selected",true);g=true}});var d="#tr_"+$(f).attr("id")})}function PopulateDBFieldsWebFormConnector(g,l,a,m){var b=g,c,k=["#Address1","#Address2","#City","#CountryCode","#PostalCode","#State_Province","#EmployeeCount"];if(g!=null&&g.company_name!=undefined&&a!="ip"&&a!="domain"){if(g!=undefined&&g!=null){toggleSubmitButton("#registersubmit",true);$("input[id=FormFillType]").val("Data Append");employeecount=g.employee_count;$("input[name=DBIndustrySIC]").val(g.primary_sic);if(g.company_name!=undefined){$(l).find("#Companydb").val(g.company_name).trigger("change")}if(g.country!=undefined){$(l).find("#CountryCode option:selected").removeAttr("selected");$(l).find("#CountryCode option[dbcountrycode='"+g.country+"']").prop("selected",true).trigger("change");CountryChange(l)}if(g.state!=undefined){$(l).find("#State_Province").val(g.state)}if($(l).find("#EmployeeCount:not([demandbasefield])")&&g.employee_count!=undefined){$(l).find("#EmployeeCount").val(MapCompanySize(g.employee_count))}FieldMapping(g,l);$(l).find("select[demandbasefield='industry']").each(function(o,i){if(i!=undefined&&i!=null){MapSIC(l,g.primary_sic,i.id)}});$.each(k,function(i,o){$(l).find(o).css({"background-color":"#F8FEBE"})});if($(l).find("#EmployeeCount").val()!=""){$(l).find("#tr_EmployeeCount").hide()}if($(l).find("[demandbasefield='employee_count']").val()!=""){$(l).find("[demandbasefield='employee_count']").parent().parent().hide()}c=$(l).find(":input:not([type='hidden']):not([id='HiddenCompany']):input:not([id='Address1']):not([id=Address2]):not([id=City]):not([id=CountryCode]):not([id=PostalCode]):not([id=State_Province]):not([id=EmployeeCount])");$(l).find("#Phone").val("");alreadyPickUpDemanBase=true}}else{var e=["#Address1","#Address2","#City","#PostalCode","#State_Province","#EmployeeCount","#DB_Latitude","#DB_Longitude","#DB_Industry","#DB_SubIndustry"];$.each(e,function(i,o){$(l).find(o).val("")});$("input[id=FormFillType]").val("None");$(l).find("#PublicSector").val("Commercial");$(l).find("[demandbasefield='employee_count']").val("");if($(l).find("#CountryCodeUser").val()!=""&&$(l).find("#CountryCodeUser").val()!=undefined){$(l).find("#CountryCode").val($(l).find("#CountryCodeUser").val())}else{if($("#CountryCodeValue").val()!=""){$(l).find("#CountryCode").val($("#CountryCodeValue").val())}else{$(l).find("#CountryCode option:first").attr("selected","selected")}}CountryChange(l);$.each(k,function(i,o){$(l).find(o).css({"background-color":""})});if(a!="ip"&&a!="domain"&&g!=null){$(l).find("#tr_EmployeeCount").show()}c=$(l).find(":input");if(a!="ip"&&a!="domain"){alreadyPickUpDemanBase=true}}var n=$(l).find("#Company").length>0?"#Company":"#Companydb",h=c.index($(l).find(n));try{$(c.get(h+1)).focus()}catch(d){if($("#registersubmit").length>0){$(l).find("#registersubmit").focus()}else{if($("#btnSave").length>0){$("#btnSave").focus()}}}if(a=="Company"||a=="Companydb"){var j=[];if($("#frmRegister").length>0){$("tr[firstscreen=0]").each(function(o,i){var p=$(i).attr("id");if(p!=undefined&&p!=null){j.push(p.replace("tr_",""))}})}else{j=["Address1","CountryCode","Address2","City","State_Province","PostalCode","Phone","EmployeeCount","PublicSector","State_Province"]}for(var f=0;f<j.length;f++){if($("#tr_"+j[f]).is(":not(:visible)")){$("#tr_"+j[f]).show()}}}if(typeof m=="function"){m.apply(this)}}function MapSIC(c,a,d){var b={};b.SIC=a;b.field=d;$.ajax({url:DomainPath+RootPath+"Register/GetIndustryMappingDB",contentType:"application/json; charset=utf-8",data:JSON.stringify(b),type:"POST",success:function(e){if(e.error==""){var g=e.data;var f=$(c).find("#tr_"+d);if(g==undefined||g==null||g==""){if(f.attr("firstscreen")=="1"||$(c).find("#tr_CountryCode").is(":visible")){f.show()}}else{if($(c).find("#"+d+" option[value='"+g+"']").length>0){$(c).find("#"+d+" option[value='"+g+"']").prop("selected",true);f.hide()}else{$(c).find("#tr_"+d);if(f.attr("firstscreen")=="1"||$(c).find("#tr_CountryCode").is(":visible")){f.show()}}}}else{console.log(e.error)}},error:function(){console.log("Cannot map industry at this moment please try again later ")}})}function MapCompanySize(a){if(a<=1000){return"1-1,000"}if(a>1000&&a<=2000){return"1,001-2,000"}if(a>2000&&a<=5000){return"2,001-5,000"}if(a>5000&&a<=15000){return"5,001-15,000"}if(a>15000){return"15,001 or more"}}function DemandBaseInitialize(e,c,a,b,d,f){$(e).find(":visible:input").each(function(){if($(this).attr("type")!="button"&&$(this).attr("type")!="submit"){$(this).val("")}});if(siteTags.DemandBaseUp!="false"){toggleSubmitButton(c,false)}$("#"+a).on("input",function(){if($(this).val().length>=2){testAutocompleteWidget(e,a)}});window.dbAsyncInit=function(){if(typeof d=="undefined"){d={}}var g={emailID:"dumbEmail",companyID:a,key:"96b804f998aaf4409cf333efdb2a3b3c",toggleFieldList:b,getToggleElement:function(h){return this.djq("#tr_"+h)},autocompletePlaceholder:siteTags.LabelToSelectBeginTyping,priorityMap:{domain:2,ip:1,company:3},fieldMap:{company_name:"HiddenCompany",demandbase_sid:"",industry:"Industry",sub_industry:"SubIndustry",revenue_range:"",employee_range:"NumberOfEmployees",street_address:"Address1",city:"City",state:"State",zip:"PostalCode",country:"Country",country_name:"",data_source:"",watch_list_account_status:"",longitude:"DB_Longitude",latitude:"DB_Latitude",industry:"DB_Industry",sub_industry:"DB_SubIndustry"}};dbf=Demandbase.Connectors.WebForm;dbf.connect($.extend({},g,d));if(typeof f=="function"){f.apply(this)}};if(siteTags.DemandBaseUp!="false"){(function(){var h=document.createElement("script");h.type="text/javascript";h.async=true;h.id="demandbase-form";h.onload=function(){var i=$().jquery.split(".");if(i[0]==1&&i[1]<9){$.noConflict()}Demandbase.jQuery.ajaxSetup({beforeSend:function(){var l=this.url,j=/demandbase\.com\/autocomplete\?callback/g,k=l.match(j);if(k!==null){startAjaxCallTracker(e,a)}}})};h.onerror=function(){PopulateDBFieldsWebFormConnector({},e,a)};h.src=("https:"==document.location.protocol?"https://":"http://")+"scripts.demandbase.com/formWidget.js";var g=document.getElementsByTagName("script")[0];g.parentNode.insertBefore(h,g);alreadyPickUpDemanBase=false})()}db_hook_init=function(){var g=setInterval(function(){if($("#demandbase-company-autocomplete-widget").find("> ul").length){clearInterval(g);DemandBaseOnComplete(e,c,a,b)}},10)};db_hook_after_parse=function(h,g){PopulateDBFieldsWebFormConnector(h,e,g,function(){$.each(b,function(i,j){if($("#"+j).is(":visible")){toggleSubmitButton(c,true);return false}})})};db_hook_before_parse=function(h,g){if(g=="ip"||g=="domain"){Demandbase.Connectors.WebForm.CompanyProfile=null;return false}}}function DemandBaseOnComplete(d,c,e,b){var a=setInterval(function(){if(Demandbase.CompanyAutocomplete.initialized){var h=Demandbase.jQuery(Demandbase.CompanyAutocomplete.textField);var k=$("#"+e).outerWidth(true);Demandbase.jQuery.ui.autocomplete.prototype._resizeMenu=function(){var l=this.menu.element};h.data("selected",false);h.data("mouseenter",false);h.data("key13_9clicked",false);h.data("destroyed",false);$("#"+e).data("close-link-clicked",false).on("keydown",function(l){if(h.data("selected")){return true}if((l.keyCode==13||l.keyCode==9)&&!$(this).hasClass("ui-autocomplete-loading")){h.data("key13_9clicked",true);setTimeout(function(){h.data("key13_9clicked",false)},500);dbDataSet="";PopulateDBFieldsWebFormConnector({},d,e,function(){g();f()})}}).on("blur",function(){var l=this;setTimeout(function(){if(!h.data("destroyed")){if($(l).val()!=""&&!h.data("selected")&&!h.data("mouseenter")&&!$("#demandbase-company-autocomplete-widget").find("> ul").is(":visible")&&!h.data("key13_9clicked")){PopulateDBFieldsWebFormConnector({},d,e,function(){g();f()})}}},200)});var j=$('<div class="dbwrapper"><div>Select your company<div>Don\'t see your company? <a href="#" id="use-input-value">Close List &gt;</a></div></div></div>').appendTo($("body"));var i=$("#demandbase-company-autocomplete-widget").find("> ul:last-child");$("#use-input-value").on("mouseenter",function(){$("#"+e).data("close-link-clicked",true)}).on("mouseout",function(){$("#"+e).data("close-link-clicked",false)}).on("click",function(l){l.preventDefault();l.stopPropagation();PopulateDBFieldsWebFormConnector({},d,e,function(){f()});setTimeout(function(){$("#"+e).parents("form").find(":input:visible").each(function(m){if($(this).css("background-color")=="rgb(248, 254, 190)"){$(this).css("background-color","transparent")}});$("#demandbase-autocomplete").hide();j.css("display","none")},200)});h.autocomplete({position:{my:"left top",at:"left bottom",offset:"0 24",collision:"none"}});j.css({"box-sizing":"border-box","line-height":"24px",position:"absolute",background:"#c0c0c0","font-weight":700,height:24,display:"none","z-index":9999,border:"1px solid #c0c0c0","box-sizing":"border-box"}).find("> div").css({position:"relative",height:"100%",padding:"0 0 0 5px"}).find("> div").css({position:"absolute",width:"100%",bottom:0,left:0,background:"#fff",padding:"0 0 0 5px","box-sizing":"border-box","font-weight":400});h.bind("autocompleteselect",function(l,m){h.data("selected",true)});h.bind("autocompleteopen",function(n,o){companyOpen=true;if($(d).data("isFrmOpen")){return}$("#demandbase-autocomplete").show();h.data("selected",false);i.css({width:"auto",height:"auto"});var m=i.outerWidth(true)-i.width(),l=(i.outerWidth(true)<k)?k:i.outerWidth(true);if(i.height()>170){i.css("height",170);l+=20}i.css("width",l-m);j.css({top:$("#"+e).offset().top+$("#"+e).outerHeight(true),left:$("#"+e).offset().left,width:l,height:i.outerHeight(true)+24+24,display:"block",zIndex:i.css("zIndex")-1})});h.bind("autocompleteclose",function(l,m){if($("#"+e).data("close-link-clicked")){dbDataSet="";h.autocomplete("destroy");h.data("destroyed",true);g()}j.css("display","none")});function f(){$.each(b,function(l,m){if($("#"+m).is(":visible")){toggleSubmitButton(c,true);return false}})}function g(){setTimeout(function(){var l=$("#"+e).parents("form").find(":input:visible");l.each(function(n,m){if(m==$("#"+e).get(0)){$(l.get(n+1)).focus();return false}})},500)}clearInterval(a)}},100)}function applyMasks(c){var b=$(c).find("#CountryCode").val();if(b==undefined){if($("#RegDBCountryCode").val()!=undefined&&$("#RegDBCountryCode").val()!=""){b=$("#RegDBCountryCode").val()}}if(b=="CA"||b=="US"){try{$(c).find("#Phone").mask("(999) 999-9999? x99999")}catch(a){}}else{$(c).find("#Phone").unmask()}}function chklicenseClick(){if($("#chklicense").length&&alreadyPickUpDemanBase){var b=$("#registersubmit"),e=b.parent().parent(),d=$("html").hasClass("ie8")||$("html").hasClass("ie7"),c=true,a=["btn-active","btn-inactive"];if($("#chklicense").is(":checked")){c=false;a=["btn-inactive","btn-active"]}b.prop("class","btn btn-lrg "+a[1])}}function CrawledchklicenseClick(){var f=$("#Crawledchklicense");if(f.length){var b=$("#Crawledregistersubmit");var e=b.parent().parent();var d=true;var c=$("html").hasClass("ie8")||$("html").hasClass("ie7");var a=["blue","grey"];if(f.is(":checked")){d=false,a=["grey","blue"]}if(c){e.removeClass(a[0]).addClass(a[1])}else{b.prop("class","button "+a[1])}}}function chklicenseClickII(){var f=$("#chklicenseII");if(f.length&&alreadyPickUpDemanBase){var e=$("#registersubmitII"),d=$("#lnkSignInNowII"),c=$("html").hasClass("ie8")||$("html").hasClass("ie7"),b=true,a=["btn-active","btn-inactive"];if(f.is(":checked")){b=false;a=["btn-inactive","btn-active"]}e.prop("class","btn btn-lrg "+a[1]);d.prop("disabled",b);if(c){d.parent().parent().removeClass(a[0]).addClass(a[1])}else{d.prop("class","btn btn-lrg "+a[1])}}}function CountryChange(a){if(a=="#frmRegister"){showOptIn(a)}populateState(a);showPublicSector(a);GetCountryTitles(a);applyMasks(a);if(typeof CountryStateOFF=="function"){CountryStateOFF(a,$(a).find("#CountryCode").val())}}function GetCountryTitles(a){lblpostalcode=$(a).find("#lbl_PostalCode");lblstate=$(a).find("#lbl_State_Province");country=$(a).find("#CountryCode").val();if($(a).find("#CountryCode").length==0){return false}$.ajax({url:DomainPath+RootPath+"Register/GetCountryTitles",contentType:"application/json; charset=utf-8",type:"POST",data:"{ countrycode:'"+country+"'}",success:function(b){if(b.error==""){if(b.PostalCodeTag!=null&&b.PostalCodeTag!=""){lblpostalcode.html(b.PostalCodeTag);$(a).find("#PostalCode").attr("title",b.PostalCodeTag)}if(b.StateProvinceTag!=null&&b.StateProvinceTag!=""){lblstate.html(b.StateProvinceTag);$(a).find("#State_Province").attr("title",b.StateProvinceTag)}if(b.displaycity!=null){if(!b.displaycity){$(a).find("#tr_City").hide();if($(a).find("#City").hasClass("fieldrequired")){$(a).find("#City").removeClass("fieldrequired").addClass("fieldnonrequired")}}else{if($(a).find("#tr_City").attr("firstscreen")=="1"||$(a).find("#tr_CountryCode").is(":visible")){$(a).find("#tr_City").show()}if($(a).find("#City").hasClass("fieldnonrequired")){$(a).find("#City").removeClass("fieldnonrequired").addClass("fieldrequired")}}}if(b.displaystate!=null){if(!b.displaystate){$(a).find("#tr_State_Province").hide();if($(a).find("#State_Province").hasClass("fieldrequired")){$(a).find("#State_Province").removeClass("fieldrequired").addClass("fieldnonrequired")}}else{if($(a).find("#tr_State_Province").attr("firstscreen")=="1"||$(a).find("#tr_CountryCode").is(":visible")){$(a).find("#tr_State_Province").show()}if($(a).find("#State_Province").hasClass("fieldnonrequired")){$(a).find("#State_Province").removeClass("fieldnonrequired").addClass("fieldrequired")}}}if(b.PostalCodeIsMandatory){$(a).find("#PostalCode").attr("class","fieldrequired");$(a).find("#tr_PostalCode").find(".required").html("*")}else{$(a).find("#PostalCode").removeAttr("class");$(a).find("#tr_PostalCode").find(".required").html("")}if(b.StateProvinceIsMandatory){$(a).find("#State_Province").attr("class","fieldrequired");$(a).find("#tr_State_Province").find(".required").html("*")}else{$(a).find("#State_Province").removeAttr("class");$(a).find("#tr_State_Province").find(".required").html("")}}else{console.log(b.error)}},error:function(){console.log("Cannot populate job/titles at this moment please try again later ")},async:false})}function populateContries(a){if($(a).find("#CountryCode").length==0){return false}$.ajax({url:DomainPath+RootPath+"Register/GetCountries",contentType:"application/json; charset=utf-8",type:"POST",success:function(b){if(b.error==""){country=$(a).find("#CountryCode");country.empty();countryprofile=$(a).find("#CountryCodeProfile").val();if(siteTags.RegLabelDefaultDropdown!=undefined){country.append("<option value=''>"+siteTags.RegLabelDefaultDropdown+"</option>")}$.each(b.data,function(d,c){if(c.Name=="-------------------------"){country.append("<optgroup label='"+c.Name+"' />")}else{country.append("<option "+((countryprofile!=undefined&&countryprofile==c.CountryCode)?"selected":"")+" DBCountryCode='"+c.DB_CountryCode+"' value='"+c.CountryCode+"'>"+c.Name+"</option>")}})}else{console.log(b.error)}},error:function(){console.log("Cannot populate countries at this moment please try again later ")},async:false})}function populateJobTitles(a){if($(a).find("#Title").length==0){return false}$.ajax({url:DomainPath+RootPath+"Register/GetJobTitles",contentType:"application/json; charset=utf-8",type:"POST",success:function(b){if(b.error==""){Title=$(a).find("#Title");var c=$(a).find("#JobTitleProfile").val();Title.empty();if(siteTags.RegLabelDefaultDropdown!=undefined){Title.append("<option value=''>"+siteTags.RegLabelDefaultDropdown+"</option>")}$.each(b.data,function(e,d){Title.append("<option value='"+d.ID+"'"+((c!=undefined&&c==d.ID)?"selected":"")+">"+d.Name+"</option>")})}else{console.log(b.error)}},error:function(){console.log("Cannot populate job/titles at this moment please try again later ")},async:false})}function populateState(d){var a="";if($(d).find("#CountryCode").length==0){if($("#RegDBCountryCode").val()!=undefined&&$("#RegDBCountryCode").val()!=""){a=$("#RegDBCountryCode").val()}else{return false}}else{a=$(d).find("#CountryCode").val()}var b="{";b+="countrycode:'"+a+"'";b+="}";var c=$(d).find("#State_Province");if(c==undefined||c[0]==undefined){return false}$.ajax({url:DomainPath+RootPath+"Register/DropDownStateProvinceGet",contentType:"application/json; charset=utf-8",type:"POST",data:b,success:function(e){if(e.error==""){if(e.data!=null&&e.data.length>0){stateprofile=$(d).find("#State_ProvinceProfile").val();if(c[0].nodeName!="SELECT"){var f="";if(c.attr("required")!=undefined){f=" required"}c.replaceWith('<select id="State_Province"'+f+">");c=$(d).find("#State_Province")}c.attr("title",e.title).find("option").remove();if(siteTags.RegLabelDefaultDropdown!=undefined){c.append("<option value=''>"+siteTags.RegLabelDefaultDropdown+"</option>")}$.each(e.data,function(h,g){if(stateprofile==undefined){c.append("<option value='"+g.StateCode+"'>"+g.Name+"</option>")}else{c.append("<option "+(stateprofile==g.StateCode?"selected":"")+" value='"+g.StateCode+"'>"+g.Name+"</option>")}})}else{var f="";if(c.attr("required")!=undefined){f=" required"}if(c[0].nodeName!="INPUT"){c.replaceWith("<input type='text' id='State_Province' title = '"+e.title+"'"+f+">");c=$(d).find("#State_Province")}else{c.attr("title",e.title);if(f==""){c.attr("required",false)}else{c.attr("required",true)}}}$(d).find("#State_Province").change(function(){ValidSingleField(this,d)})}else{console.log(e.error)}},error:function(){console.log("Cannot load states/province at this moment")},async:false})}function showPublicSector(a){country=$(a).find("#CountryCode").val();if((country=="US"||country=="CA")&&($(a).find("#tr_PublicSector").attr("firstscreen")=="1"||$(a).find("#tr_CountryCode").is(":visible"))){$(a).find("#tr_PublicSector").show()}else{$(a).find("#tr_PublicSector").hide()}}function SetFunctionnalityByForm(a){populateContries(a);if($(a).find("#CountryCodeUser").val()!=""&&$(a).find("#CountryCodeUser").val()!=undefined){$(a).find("#CountryCode").val($(a).find("#CountryCodeUser").val())}else{var b=$(a).find("#CountryCodeProfile").val();if($("#CountryCodeValue").val()!=""&&b==undefined){$(a).find("#CountryCode").val($("#CountryCodeValue").val())}else{$(a).find("#CountryCode option:first").attr("selected","selected")}}showPublicSector(a);populateState(a);populateJobTitles(a);GetCountryTitles(a);applyMasks(a);if($(a).data("init")==undefined){$(a).on("change","#CountryCode",function(){CountryChange(a)});$(a).on("change","input, select, textarea",function(){ValidSingleField(this,a)});$(a).data("init",true)}}function toggleSubmitButton(d,c){if(($("#chklicenseII").length>0&&!$("#chklicenseII").is(":checked"))||($("#chklicense").length>0&&!$("#chklicense").is(":checked"))||($("#Crawledchklicense").length>0&&!$("#Crawledchklicense").is(":checked"))){return false}var b=$(d),a=["grey","blue"];if(b.hasClass("btn")){a=["btn-inactive","btn-active"]}c=(typeof c=="boolean"&&c)?1:0;if(c){b.removeAttr("disabled")}if($("html").hasClass("ie8")||$("html").hasClass("ie7")){if(b.hasClass("btn")){b.removeClass("btn-active btn-inactive").addClass(a[c])}else{b.parents(".button-wrapper").removeClass("blue grey");b.parents(".button-wrapper").addClass(a[c])}}else{if(b.hasClass("btn")){b.removeClass("btn-active btn-inactive").addClass(a[c])}else{b.removeClass("blue grey");b.addClass(a[c])}}}function isSubmitButtonActive(b){if($(b).get(0).nodeName=="A"){return true}var a=0;if($(b).hasClass("blue")){return true}if($(b).hasClass("btn-active")){return true}return false}function CrawledProspectProcess(b){var i="#frmRegister";var e={};var j="";var c="";var f=true;var g=$("#regadditionalinfo").val();if(!ValidFieldsForms("#frmRegister")){return false}if($("#ProfileFields").val()!=undefined){if($("#ProfileFields").val()!=""){var h=$("#ProfileFields").val().split(",");$.each(h,function(l,k){e[k]=$(i).find("#"+k).val();f=false})}if($("#PredefinedFields").val()!=undefined&&$("#PredefinedFields").val()!=""){j="<Fields>";var d=$("#PredefinedFields").val().split(",");$.each(d,function(m,l){var k=null;if($(i).find("#"+l)!=undefined){k=encodeXml($(i).find("#"+l).val())}else{k="$$"+l+"$$"}j+="<Field>";j+="<Name>"+l+"</Name>";j+="<Value>"+k+"</Value>";j+="</Field>"});j+="</Fields>"}if($("#CustomFields").val()!=undefined&&$("#CustomFields").val()!=""){c="<Fields>";var a=$("#CustomFields").val().split(",");$.each(a,function(l,k){c+="<Field>";c+="<Name>"+k+"</Name>";c+="<Value>"+encodeXml($("#"+k).valx())+"</Value>";c+="</Field>"});c+="</Fields>"}if(e.comments!=undefined){g=e.comments+";"+g}e.comments=g;e.predefinedAnswers_XML=j;e.customAnswers_XML=c;e.industrySIC=$("#DBIndustrySIC").val();f=false}e.formFillType=$("#FormFillType").val();e.assetCodeID=$("#AssetCodeID").val();e.LandingPageID=$("#LandingPageID").val();if(e.CountryCode!=undefined&&e.CountryCode=="CA"&&$(i).find("#chkOptIn")!=undefined){e.OptIn=$(i).find("#chkOptIn").is(":checked")}ctrl=$("#Crawledregistersubmit");ctrl.prop("value",siteTags.SiteRegPleaseWait);if(b){document.getElementById("hdnSecureForm").contentWindow.UpdateForm(e)}else{$.ajax({url:DomainPath+RootPath+"sso/CLProspectProcess",contentType:"application/json; charset=utf-8",type:"POST",data:JSON.stringify(e),success:function(k){CLProspectProcessCallBack(k)},error:function(){console.log("Cannot Insert prospect at this moment please try again later ")},async:true})}}function CLProspectProcessCallBack(a){var b="#frmRegister";if(!a.InternalError){sc_ThankYou_RegBlank();$(b).html(a.data);triggerSCDSGSet()}else{window.location.href="/internalservererror/"}}function ParseRegFormCrawledLandingPage(c,a,b){if(c==null||c==undefined||c==""){return false}$div=$("#"+c);$.ajax({url:RootPath+"SSO/_RegisterCrawledLandingPage?AssetCode_ID="+a+"&useOneColumnQA="+b,type:"POST",contentType:"application/json; charset=utf-8",success:function(d){d=stripScripts(d);$div.html(d);SetFunctionnalityByForm("#frmRegister");SetValuesFromProfile("#frmRegister");if(typeof processButtons=="function"){processButtons()}initinterstitial=false;$("#Crawledregistersubmit").click(function(){if(!isSubmitButtonActive("#Crawledregistersubmit")){return false}CrawledProspectProcess(true)});CrawledchklicenseClick();$("#Crawledchklicense").change(CrawledchklicenseClick)},async:false})}function SetValuesFromProfile(a){$.ajax({url:DomainPath+RootPath+"SSO/GetProfileInfo",contentType:"application/json; charset=utf-8",type:"POST",success:function(b){var c=false;if(b.data!=null&&b.data!=undefined){$.each($(a).find("INPUT"),function(){id=$(this).attr("id");if(b.data[id]!=undefined){$("#"+id).val(b.data[id]);c=true}})}if(c){$(a).trigger("GetProfileInfo")}},error:function(){console.log("Cannot Load Profile Information at this moment please try again later ")},async:true})}function stripScripts(c){var d=document.createElement("div");d.innerHTML=c;var a=d.getElementsByTagName("script");var b=a.length;while(b--){a[b].parentNode.removeChild(a[b])}return d.innerHTML}function showOptIn(a){country=$(a).find("#CountryCode").val();if((country=="CA")&&$(a).find("#tr_CountryCode").is(":visible")){$(a).find("#tr_OptInAccept").show();$(a).find("#tr_OptInPrivacy").show()}else{$(a).find("#tr_OptInAccept").hide();$(a).find("#tr_OptInPrivacy").hide()}}function SendRequestOptIn(){ctrl=$("#btnOptIn");ctrl.prop("disabled","disabled");ctrl.prop("value",siteTags.SiteRegPleaseWait);var a={};a.OptInValue=$("#frmOptIn").find("#chkOptIn").is(":checked");$.ajax({type:"POST",url:RootPath+"account/optinform",data:JSON.stringify(a),contentType:"application/json; charset=utf-8",success:function(b){if(b!=undefined&&b.complete==1){SendRequestOptInCallBack(b.error,b.buttontitle)}},error:function(){console.log("Cannot reach method (account/optinform) at this moment please try again later ")}})}function SendRequestOptInCallBack(){if(PostLoginFunction!=undefined){PostLoginFunction()}else{if($("#frmRegister").length>0){RefreshPage(false)}else{if(getmicrositedata()==""){window.location.href=geturlback()==""?"/":geturlback()}else{LogInDialogMicroSiteCBASS(getmicrositedata())}}}}function testAutocompleteWidget(a,b){setTimeout(function(){if(!$("#demandbase-company-autocomplete-widget").find("> ul").length>0){PopulateDBFieldsWebFormConnector({},a,b);$(a).find("[type=submit]").prop("disabled",false)}},1500)}function startAjaxCallTracker(a,b){if(companyOpen===false){setTimeout(function(){if(companyOpen===false){PopulateDBFieldsWebFormConnector({},a,b);$("#"+b).removeClass("ui-autocomplete-loading");var c=Demandbase.jQuery(Demandbase.CompanyAutocomplete.textField);c.autocomplete("destroy");$(a).find("[type=submit]").prop("disabled",false);$(a).data("isFrmOpen","true")}},1800)}}function noLicenseAgreeForms(){var a=["/register/69154","/register/73635","/register/69388","/register/69295","/register/69308"];var b=new RegExp(location.pathname,"i");$.each(a,function(d,c){if(b.test(c)){$("#registersubmit").removeAttr("disabled").removeClass("btn-inactive").addClass("btn-active");$("#tr_SoniWALLIndustry").next().remove()}})};