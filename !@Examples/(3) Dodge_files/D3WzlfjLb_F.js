/*!CK:4071661000!*//*1437526765,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["KanRJ"]); }

__d("PageVoiceDropdownSelector.react",["AdsAssetSectionType","AdsLoadState","AdsPageAssetSelector.react","BizSiteIdentifier.brands","BusinessAssetGrouping.brands","ContextualLayer.react","Image.react","ImageBlock.react","LayerAutoFocus","LayerHideOnBlur","LayerHideOnEscape","React","ReactLayeredComponentMixin","XUIPopoverButton.react","underscore.ads","cx","emptyFunction","fbt","invariant","ix"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z){b.__markCompiled&&b.__markCompiled();'use strict';var aa=r,ba=aa.PropTypes,ca=300,da=12,ea=r.createClass({displayName:"PageVoiceDropdownSelector",propTypes:{covered:ba.bool,permissions:ba.object,pages:ba.object.isRequired,selectedActorID:ba.string,showBusinessPages:ba.bool,showPersonalPageInRoot:ba.bool,showPageName:ba.bool,showUserInPersonalVoices:ba.bool,suppressed:ba.bool.isRequired,user:ba.object.isRequired,onChange:ba.func.isRequired,onClick:ba.func.isRequired},mixins:[s],getDefaultProps:function(){return {searchBarVisible:false,showBusinessPages:true,showPageName:false,showUserInPersonalVoices:true,covered:true};},getInitialState:function(){var fa=k.NULL_BIZ_ID;if(this.props.pages[this.props.selectedActorID]&&this.props.pages[this.props.selectedActorID].businessID)fa=""+this.props.pages[this.props.selectedActorID].businessID;var ga=fa;if(!j.isBizSite())ga=null;return {dialogShown:false,defaultBusinessID:ga,textDisplay:this._getActorName(this.props.selectedActorID),selectedActorID:this.props.selectedActorID,selectedBusinessID:fa,searchQuery:"",shownBusinessID:ga};},componentDidMount:function(){if(this.props.focusOnInit&&this.refs['open-menu-button'])r.findDOMNode(this.refs['open-menu-button']).focus();},componentWillReceiveProps:function(fa){this.setState({selectedActorID:fa.selectedActorID});},componentWillUnmount:function(){this.setState=w;},renderLayers:function(){return {contextualDialog:r.createElement(l,{alignment:"right",behaviors:{LayerAutoFocus:o,LayerHideOnBlur:p,LayerHideOnEscape:q},contextRef:function(){return this.refs['open-menu-button'];}.bind(this),position:"below",shown:this.state.dialogShown,onToggle:this._onToggle},this._renderLayerContent())};},render:function(){return (r.createElement(t,{className:"_4z8-",haschevron:!this.props.covered,image:r.createElement(m,{width:16,height:16,src:this.props.covered?z('images/pages/voice/flag.png'):this._getSelectedImageSource()}),label:this.props.showPageName?this._getSelectedActorName():"",ref:"open-menu-button",suppressed:this.props.suppressed,type:"button",onClick:this._onButtonClick}));},_renderLayerContent:function(){if(u.isEmpty(this.props.user))return null;var fa=this._getPageSelectorPages(),ga=null;if(this.props.selectedActorID===this.props.user.id)ga=(r.createElement("div",{className:"_55fc"}));var ha=null;if(this.props.user.id&&(this.state.shownBusinessID===k.NULL_BIZ_ID||this.state.shownBusinessID===null&&this.props.showUserInPersonalVoices))ha=(r.createElement(n,{className:(("_5dsl")+(' '+"_alf")+(this.props.selectedActorID===this.props.user.id?' '+"_2246":'')+(' '+"_alg")),onClick:function(){this._updateSelectedActor(this.props.user.id);}.bind(this)},r.createElement(m,{className:"_4-rj",width:30,height:30,src:this.props.user.thumbSrc}),r.createElement("div",{className:"_1wcv"},r.createElement("div",{className:(("_2sl4")+(' '+"_4c71"))},this.props.user.name,"Â ",r.createElement("span",{className:"_uyb"},x._("(You)")),ga))));return r.createElement("div",{className:(("_21wq")+(' '+"_70b"))},ha,fa.length===0?null:r.createElement(i,{bookmarkedPages:[],compactLayout:true,listItemHoverStyle:"dark-blue",maxListHeight:ca,pages:fa,searchedPages:[],searchQuery:this.state.searchQuery,searchState:h.NOT_LOADED,selectedPageID:this.props.selectedActorID,selectedBusinessID:this.state.selectedBusinessID,selectedSectionType:g.OWNED,showBookmarks:false,showBottomBorder:false,showBusinessPages:this.props.showBusinessPages,showNonBizGroupTitle:true,showPageCount:false,showPersonalPagesInRoot:this.props.showPersonalPagesInRoot||false,showSectionPageCount:true,shownBusinessID:this.state.shownBusinessID,sortPages:false,unownedPages:[],onBusinessSelected:this._onBusinessSelected,onPageSelected:this._onPageSelected,onPageRemoved:function(){},onPageBookmarked:function(){},onSearch:this._onSearch,searchBarVisible:fa.length>=da}));},_onBusinessSelected:function(fa){this.setState({shownBusinessID:fa});},_onPageSelected:function(fa,ga,ha){this.setState({selectedBusinessID:ga},function(){return this._updateSelectedActor(fa);}.bind(this));},_onSearch:function(fa){this.setState({searchQuery:fa});},_onButtonClick:function(){this.setState({dialogShown:!this.state.dialogShown,shownBusinessID:this.state.defaultBusinessID},this.props.onClick);},_onToggle:function(fa){this.setState({dialogShown:fa});},_getSelectedImageSource:function(){var fa=this.state.selectedActorID;if(!fa)return "";if(fa===this.props.user.id){if(!this.props.user.thumbSrc)return "";return this.props.user.thumbSrc;}else{if(!this.props.pages[fa].thumbSrc)return "";return this.props.pages[fa].thumbSrc;}},_getSelectedActorName:function(){var fa=this.state.selectedActorID;if(!fa)return "";if(fa===this.props.user.id){if(!this.props.user.name)return "";return this.props.user.name;}else{if(!this.props.pages[fa].name)return "";return this.props.pages[fa].name;}},_getPageSelectorPages:function(){var fa=u.map(this.props.pages,function(ga,ha){var ia={id:ha,name:ga.name,picture:{data:{url:ga.thumbSrc}},userpermissions:{data:[]},sectionType:g.OWNED};if(ga.allBusinessData)ga.allBusinessData.forEach(function(ja){if(ja.businessID)ia.userpermissions.data.push({business:{name:ja.businessName,id:ja.businessID}});});return ia;},this);if(this.props.user.id){y(fa[0].id===this.props.user.id);return fa.slice(1);}return fa;},_getActorName:function(fa){if(fa===this.props.user.id){return this.props.user.name;}else return this.props.pages[fa].name;},_updateSelectedActor:function(fa){if(!fa||fa===this.state.selectedActorID)return;this.setState({selectedActorID:fa,dialogShown:false,searchQuery:""});if(fa===this.props.user.id){this.setState({textDisplay:this.props.user.name});this.props.onChange({label:this.props.user.name,value:this.props.user.id});}else{this.setState({textDisplay:this.props.pages[fa].name});this.props.onChange({label:this.props.pages[fa].name,value:fa});}}});e.exports=ea;},null);