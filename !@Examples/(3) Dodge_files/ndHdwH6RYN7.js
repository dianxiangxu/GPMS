/*!CK:1791603555!*//*1437083263,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["L52FX"]); }

__d("SpotlightViewerLoggingEvents",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports={LOADED:"loaded",LOADING:"loading",ERROR:"error",ABORT:"abort",OPEN_BEGIN:"open_begin",OPEN_COMPLETE:"open_complete",CLOSE_BEGIN:"close_begin",CLOSE_COMPLETE:"close_complete",PAGE_BEGIN:"page_begin",PAGE_COMPLETE:"page_complete",PHOTO_CHANGE_BEGIN:"photo_change_begin",PHOTO_CHANGE_COMPLETE:"photo_change_complete",DATA_FETCH_BEGIN:"data_fetch_begin",DATA_FETCH_COMPLETE:"data_fetch_complete",PHOTO_FETCH:"photo_fetch"};},null);
__d("XPhotosetSearchPivotController",["XController"],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports=b("XController").create("\/search-pivot\/photoset\/",{fbid:{type:"Int",required:true},tags:{type:"IntToIntMap"}});},null);
__d("PhotosetSearchPivotData",["AsyncRequest","PhotoStreamCache","Promise","XPhotosetSearchPivotController"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();var k=/^(perm:)?tag:(\d+)/,l={},m={fetch:function(n,o){if(!(n in l)){var p=(j.getURIBuilder()).setInt('fbid',n);if(o){var q={};o.fbidList.forEach(function(r){var s=o.getCacheContent(r,h.EXTRA);if(s)Object.keys(s.tagRects).forEach(function(t){if(k.test(t)){var u=RegExp.$2;if(u in q){q[u]++;}else q[u]=1;}});});p.setIntToIntMap('tags',q);}l[n]=new i(function(r,s){(new g()).setURI(p.getURI()).setHandler(function(t){r(t.getPayload());}).setErrorHandler(s).setAllowCrossPageTransition(true).send();});}return l[n]["catch"](function(r){delete l[n];throw r;});}};e.exports=m;},null);
__d("tickerPhoteSnowLiftOpenStatus",["ArbiterMixin"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();var h='CheckIsOpen',i={registerOpenChecker:function(j){return i.subscribe(h,function(k,l){if(j())l.is_Open=true;});},checkIsOpen:function(){var j={is_Open:false};i.inform(h,j);return j.is_Open;}};Object.assign(i,g);e.exports=i;},null);
__d("PhotoLogger",["Event","BanzaiScuba","SpotlightViewerLoggingEvents","SubscriptionsHandler"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();function k(l){"use strict";this.$PhotoLogger0=l;this.$PhotoLogger1={};}k.prototype.log=function(l){"use strict";if(!this.$PhotoLogger1[l]){this.$PhotoLogger2(l);this.$PhotoLogger1[l]=true;}};k.prototype.$PhotoLogger2=function(l){"use strict";this.$PhotoLogger3(i.LOADING,{uri:l});var m=new j(),n=new Image();m.addSubscriptions(g.listen(n,'load',function(){this.$PhotoLogger3(i.LOADED,{uri:l});m.release();}.bind(this)),g.listen(n,'error',function(){this.$PhotoLogger3(i.ERROR,{uri:l});m.release();}.bind(this)),g.listen(n,'abort',function(){this.$PhotoLogger3(i.ABORT,{uri:l});m.release();}.bind(this)));n.src=l;};k.prototype.logEvent=function(l){"use strict";this.$PhotoLogger3(l);};k.prototype.$PhotoLogger3=function(l,m){"use strict";var n=new h('photos_client_loading',null,{addBrowserFields:true});n.addNormal('event',l);n.addNormal('viewer',this.$PhotoLogger0);for(var o in m)n.addNormal(o,m[o]);n.post();};e.exports=k;},null);
__d("PhotosetSearchPivot.react",["LeftRight.react","PhotoTagSearchPivotLogger","PhotosetSearchPivotData","React","XUISpinner.react","XUIText.react","cx","fbt","joinClasses"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){b.__markCompiled&&b.__markCompiled();var p=j,q=p.PropTypes,r=j.createClass({displayName:"PhotosetSearchPivotItem",propTypes:{normalized:q.string,title:q.object,uri:q.string,images:q.array},onClick:function(){h.logMorePhotosNavigation(this.props.normalized);},render:function(){return (j.createElement("div",{className:"_25r"},j.createElement("a",{onClick:this.onClick,href:this.props.uri,className:"_25t _3-8t"},j.createElement("div",{className:"_25u"},j.createElement("div",{className:"_25v _25w",style:{backgroundImage:'url('+this.props.images[0].uri+')'}}),j.createElement("div",{className:"_25x"},j.createElement("div",{className:"_25y"},j.createElement("div",{className:"_25z"}),j.createElement("div",{className:"_26r"},j.createElement("div",{className:"_273 _25w",style:{backgroundImage:'url('+this.props.images[1].uri+')'}}))),j.createElement("div",{className:"_274"},j.createElement("div",{className:"_25z"}),j.createElement("div",{className:"_26r"},j.createElement("div",{className:"_273 _25w",style:{backgroundImage:'url('+this.props.images[2].uri+')'}}))))),j.createElement(l,{display:"block",className:"_27f _2pi4",dangerouslySetInnerHTML:{__html:this.props.title.__html}}))));}}),s=j.createClass({displayName:"PhotosetSearchPivot",propTypes:{fbid:q.string,endofalbum:q.bool,withBackground:q.bool,linesAroundHeader:q.bool,onclose:q.func},fetchPivots:function(t){i.fetch(t).then(function(u){setTimeout(this.onFetchSuccess.bind(this,t,u.pivots),0);}.bind(this),function(u){setTimeout(this.onFetchError.bind(this,t),0);}.bind(this));},onFetchSuccess:function(t,u){if(!this.isMounted()||this.props.fbid!==t)return;u=u||[];var v='show';if(u.length===0)v='hide';this.setState({pivots:u,action:v});},onFetchError:function(t){if(!this.isMounted()||this.props.fbid!==t)return;this.setState({pivots:[],action:'hide'});},getInitialState:function(){this.fetchPivots(this.props.fbid);return {pivots:[],action:'loading'};},componentWillReceiveProps:function(t){if(t.fbid){this.setState({action:'loading'});this.fetchPivots(t.fbid);}else this.setState({action:'hide',pivots:[]});},onExitClicked:function(){this.props.onclose();},render:function(){if(this.state.action==='loading')return (j.createElement("div",{className:o(this.props.className,"_27h _2ph_")},j.createElement(k,{size:"large"})));if(this.state.action==='hide')return j.createElement("span",null);var t=this.state.pivots.map(function(x){return j.createElement(r,{normalized:x.normalized,title:x.title,uri:x.uri,images:x.images});}),u=this.props.endofalbum?j.createElement("span",{className:"_2pij"},n._("End of album")):null,v=(("_27m")+(' '+"_2pi3")+(' '+"_2pib")+(this.props.linesAroundHeader?' '+"_3-te":'')),w=j.createElement("span",null,u,j.createElement("span",{className:"_4ptz"},n._("Other photos you may like")));if(this.props.onclose){w=j.createElement(g,{className:v},w,j.createElement("a",{href:"#",onClick:this.onExitClicked,className:"_27n"}));}else w=j.createElement("div",{className:v},w);return (j.createElement("div",{className:o(this.props.className,((this.state.action==='hide'?"_27j":'')+(this.state.action==='show'?' '+"_27k":'')))},j.createElement("div",{className:(("_27l")+(this.props.withBackground?' '+"_3-tf":''))},w,j.createElement("div",{className:"_27o _2pi8 clearfix"},t))));}});e.exports=s;},null);
__d("PhotosetPivotSlide.react",["Image.react","Link.react","PhotosetSearchPivot.react","React","XUIText.react","cx","fbt","xuiglyph"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){b.__markCompiled&&b.__markCompiled();var o=j,p=o.PropTypes,q=j.createClass({displayName:"PhotosetPivotSlide",propTypes:{fbid:p.string,isAlbum:p.bool,albumOwnerName:p.string,visible:p.bool,onReturn:p.func},render:function(){return (j.createElement("div",{className:(("_1_ap")+(this.props.visible?' '+"_1_aq":''))},j.createElement("div",{className:"_1_ar"},j.createElement(k,{display:"block"},this._getEndOfAlbumTitle()),j.createElement(h,{className:"_1_as",onClick:this.props.onReturn},j.createElement(g,{className:"_1_at",src:n({name:'arrow-right',shade:'white',size:'small'})}),m._("Return to Beginning"))),j.createElement(i,{className:"_1_au",fbid:this.props.visible?this.props.fbid:null,linesAroundHeader:true})));},_getEndOfAlbumTitle:function(){if(this.props.albumOwnerName){if(this.props.isAlbum){return (m._("End of {user_name}'s album",[m.param("user_name",j.createElement(k,{weight:"bold"},this.props.albumOwnerName))]));}else return (m._("End of {user_name}'s photos",[m.param("user_name",j.createElement(k,{weight:"bold"},this.props.albumOwnerName))]));}else if(this.props.isAlbum){return (m._("End of album"));}else return (m._("End of photos"));}});e.exports=q;},null);
__d("XPhotosSnowliftProfilePicXOutAsyncController",["XController"],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports=b("XController").create("\/photos\/profilepic\/xout\/",{});},null);
__d("SnowliftProfilePhotoNUX",["AsyncRequest","CSS","Event","XPhotosSnowliftProfilePicXOutAsyncController"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();var k={registerXOut:function(l,m){i.listen(l,'click',function(n){h.hide(n);var o=(j.getURIBuilder()).getURI();new g().setURI(o).setMethod('POST').send();}.bind(this,m));}};e.exports=k;},null);
__d("PhotoSnowliftAds",["Arbiter","Event","CSS","csx","DataStore","DOM","PhotoSessionLog","UIPagelet","URI","Vector"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){b.__markCompiled&&b.__markCompiled();var q={REFRESH_RATE:30000,UNITS_REGISTER_DELAY:1000,root:null,availableDimensions:null,loadQuery:null,lastLoadTime:0,minAds:100,units:null,isLogAdData:null,displayedCallback:null,position:null,adsStatus:'null',adsEvents:{},resetEvents:function(){this.adsStatus='reset';this.adsEvents={};},addEvent:function(r,s){if(s)this.adsStatus=r;var t=Date.now();this.adsEvents[r+'_'+t]=t;},init:function(r,s,t,u){this.reset();this.root=r;this.snowlift=s;this.minAds=t.min_ads;this.displayedCallback=u;this.addEvent('init',true);},reset:function(){this.lastLoadTime=0;this.position=0;this.units=[];this.resetEvents();this.addEvent('reset',true);},resize:function(r){this.availableDimensions=r;this.loadQuery=this.snowlift.getLoadQuery();this.processResize();},calculateUnitSizes:function(r,s,t){var u={};r.forEach(function(v){var w=v.root.firstChild.offsetHeight;v.units.forEach(function(y){if(!i.hasClass(y,'hidden')&&!this.getIsHoldout(y)&&!this.getIsShadow(y)){var z=this.getHeight(y.firstChild,s);w-=z;}}.bind(this));var x={height:w,visible:false};v.units.forEach(function(y){var z=this.getIsAds(y),aa=this.getHeight(y.firstChild,s),ba=this.getUnitId(y),ca=this.getIsHoldout(y);if(ca&&t)return;u[ba]={height:aa,visible:false,priority:0,is_ads:z,is_holdout:ca,section_ref:x};}.bind(this));}.bind(this));return u;},calculateVisibleUnits:function(r,s,t){var u=0,v=this.getUnitPriority(s);v.forEach(function(w){if(s.hasOwnProperty(w)){var x=s[w],y=x.height;if(!x.section_ref.visible)y+=x.section_ref.height;x.height_below=t-y;x.visible=x.height_below>=0&&y>0;if(x.visible){x.section_ref.visible=true;t-=y;u++;}}}.bind(this));return s;},displayUnits:function(r,s){r.forEach(function(t){var u=false,v=true;t.units.forEach(function(w){var x=this.getUnitId(w),y=s[x];if(!y)return;var z=y.visible,aa=y.height_below,ba=y.is_ads;i.conditionClass(w,'hidden',!z);if(ba&&z&&v){var ca=l.find(w,'div.ego_unit');i.addClass(ca,'ego_unit_no_top_border');v=false;}u=u||z;this.calcUnitStats(this.units[ba][x],z,aa);}.bind(this));i.conditionClass(t.root,'hidden',!u);}.bind(this));g.inform('PhotoSnowliftAds/displayUnits');},getUnitsDisplayed:function(r,s){var t=0;r.forEach(function(u){u.units.forEach(function(v){var w=this.getUnitId(v),x=s[w];if(!x||!x.visible)return;t++;}.bind(this));}.bind(this));return t;},getHeightsRequired:function(r,s){var t=0,u=[];r.forEach(function(v){var w=false;v.units.forEach(function(x){var y=this.getUnitId(x),z=s[y];if(!z)return;t+=z.height;if(!w){t+=z.section_ref.height;w=true;}u.push(t);}.bind(this));}.bind(this));return u;},getUnitPriority:function(r){var s=[],t=0,u=0;for(var v in r){var w=r[v];s.push(v);var x=this.minAds+t+u;if(w.is_ads){if(u<this.minAds)x=u;u++;}else t++;w.priority=x;}s=s.sort(function(y,z){var aa=r[y],ba=r[z];return aa.priority-ba.priority;}.bind(this));return s;},updateUnitsStatus:function(){var r=this.availableDimensions.x,s=this.availableDimensions.y,t=this.calculateUnitSizes(this.sections,r);t=this.calculateVisibleUnits(this.sections,t,s);for(var u in t){if(!t.hasOwnProperty(u))continue;var v=t[u];if(!v.is_holdout||!v.visible)continue;var w=this.units[1][u];this.calcUnitStats(w,v.visible,v.height_below);}t=this.calculateUnitSizes(this.sections,r,true);t=this.calculateVisibleUnits(this.sections,t,s);this.displayUnits(this.sections,t);if(this.displayedCallback){var x=this.getUnitsDisplayed(this.sections,t),y=this.getHeightsRequired(this.sections,t);this.displayedCallback(x,y);}},calcUnitStats:function(r,s,t){var u=Date.now();if(r.visible)r.totalTime+=u-r.lastShowTime;if(r.trackingCode!==null&&r.totalTime>=this.UNITS_REGISTER_DELAY){var v=r.trackingCode;r.trackingCode=null;this.registerImpression(v,r.registerUrl);}r.visible=s;r.heightBelow=t;r.lastShowTime=u;},prepareResize:function(){var r=function(s){var t=l.create('div',{className:'inner'}),u=l.create('div',{className:'wrapper'},t);l.replace(s,u);l.setContent(t,s);return u;};this.sections=l.scry(this.root,'div.ego_section').map(function(s){return {root:r(s),units:l.scry(s,'div.ego_unit').map(r)};});},processResize:function(){if(this.isLoading||this.lastLoadTime===0||this.availableDimensions===null){this.setLogData();return;}this.updateUnitsStatus();this.setLogData();var r=this.nextRegisterTime();if(r!==Infinity)setTimeout(this.processResize.bind(this),r);},setIsLogAdData:function(r){this.isLogAdData=r;this.addEvent('setIsLogAdData',false);this.setLogData();},setLogData:function(){var r=this.snowlift.getImageId();if(this.isLogAdData&&r){var s=p.getElementDimensions(this.snowlift.getImage()),t=p.getElementDimensions(this.snowlift.getRHCHeader()),u=p.getElementDimensions(this.snowlift.getRHCBody()),v=p.getElementDimensions(this.snowlift.getRHCFooter()),w={query_set:this.snowlift.getLoadQuery().set,window_x:window.innerWidth,window_y:window.innerHeight,image_x:s.x,image_y:s.y,header_x:t.x,header_y:t.y,body_x:u.x,body_y:u.y,footer_x:v.x,footer_y:v.y,ads_below_space:this.getAdsBelowSpace(),time:Date.now(),adsStatus:this.adsStatus,adsEvents:this.adsEvents,refreshRate:this.refreshUnitsRate,position:this.position};m.updateAdData(r,w);}},getAdsBelowSpace:function(){var r=[],s=this.units[1];for(var t in s)if(s.hasOwnProperty(t)&&!this.getIsHoldout(this.getAdUnit(t)))r.push(s[t].heightBelow);return r;},getIsAds:function(r){var s=l.scry(r,"div._4u8");return s.length;},getUnitId:function(r){if(this.getIsAds(r)){return this.getAdId(r);}else return this.getEgoId(r);},getEgoId:function(r){var s=l.find(r,'div.ego_unit');return s.getAttribute('data-ego-fbid');},getAdData:function(r){var s=l.find(r,"div._4u8"),t=s.getAttribute('data-ad');return t&&JSON.parse(t)||{};},getAdId:function(r){return this.getAdData(r).adid;},getIsHoldout:function(r){return r&&this.getIsAds(r)&&this.getAdData(r).holdout;},getIsShadow:function(r){return r&&this.getIsAds(r)&&this.getAdData(r).shadow;},getAdUnit:function(r){if(!this.sections)return null;var s=[];this.sections.forEach(function(u){var v;(v=s).push.apply(v,u.units);});for(var t=0;t<s.length;t++)if(this.getIsAds(s[t])&&this.getAdId(s[t])==r)return s[t];return null;},nextRegisterTime:function(){var r=Infinity,s=Object.assign({},this.units[0],this.units[1]);for(var t in s)if(s.hasOwnProperty(t)){var u=s[t];if(u.trackingCode!==null&&u.visible)r=Math.min(r,this.UNITS_REGISTER_DELAY-u.totalTime);}return r;},getHeight:function(r,s){var t=k.get(r,'height');if(t&&t.x===s)return t.y;return this.cacheHeight(r,s);},cacheHeight:function(r,s){var t={x:s,y:r.offsetHeight};k.set(r,'height',t);return t.y;},loadAdsAndEgo:function(){this.resetEvents();this.addEvent('adsRequested',true);this.position++;var r=this.getCursorFBID(this.loadQuery);n.loadFromEndpoint('WebEgoPane',this.root,{pid:34,data:[this.loadQuery.set,r,false,this.snowlift.getOpaqueCursor(r)]},{crossPage:true,bundle:false});},getCursorFBID:function(r){if(r.v!==(void 0))return r.v;if(r.fbid!==(void 0))return r.fbid;return '0';},unitsLoaded:function(r,s){var t;if(s){t='/ai.php';this.addEvent('adsLoaded',true);}else{t='/ajax/ei.php';this.addEvent('egoLoaded',true);}var u={};for(var v in r)if(r.hasOwnProperty(v))u[v]={trackingCode:r[v],totalTime:0,lastShowTime:0,heightBelow:-10000,visible:false,registerUrl:t};this.units[s]=u;if(s)this.waitForImages(this.imagesLoaded.bind(this));},imagesLoaded:function(){this.prepareResize();this.addEvent('imagesLoaded',true);this.lastLoadTime=Date.now();this.isLoading=false;this.processResize();i.removeClass(this.root,'loading');},loadAdsFromUserActivity:function(){var r=Date.now()-this.lastLoadTime;if(!this.isLoading&&r>q.REFRESH_RATE){i.addClass(this.root,'loading');this.isLoading=true;this.loadAdsAndEgo();}},registerImpression:function(r,s){var t=l.create('iframe',{src:new o(s).addQueryData({aed:r}),width:0,height:0,frameborder:0,scrolling:'no',className:'fbEmuTracking'});t.setAttribute('aria-hidden','true');l.appendContent(this.root,t);},waitForImages:function(r){var s=l.scry(this.root,'img.img'),t=s.length,u=t;if(u===0)r();var v=function(){u--;if(u===0)setTimeout(r,0);};for(var w=0;w<t;w++){var x=s[w];if(x.complete){v();}else h.listen(x,{load:v,error:v,abort:v});}}};e.exports=q;},null);
__d("SnowliftVideoPivotsCarouselController",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();var g={setPivotsCarousel:function(h,i){this._pivotsCarousel=h;this.adjustCarousel(i);},adjustCarousel:function(h){if(this._pivotsCarousel)this._pivotsCarousel.pageTo(h);},adjustCarouselOnAutoPlay:function(){if(this._pivotsCarousel)this._pivotsCarousel.page();}};e.exports=g;},null);
__d("XPhotosSnowliftProfilePicAsyncController",["XController"],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports=b("XController").create("\/photos\/profilepic\/",{uri:{type:"String",required:true}});},null);
__d("XSnowliftSuggestedLocationRejectController",["XController"],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports=b("XController").create("\/photos\/location\/suggestion\/snowlift\/reject\/",{media_id:{type:"Int",required:true},location_id:{type:"Int",required:true}});},null);
__d("PhotoSnowlift",["Arbiter","AsyncRequest","Bootloader","CSS","DataStore","Dialog","DisplaySnowliftProfilePhotoNux","DOM","DOMQuery","DOMControl","Event","fbt","FullScreen","GraphicPhotoWarning","GraphicPhotoWarningMixin","ImageUtils","Input","Keys","Layer","LayerHideOnEscape","LikeConfirmer","LinkController","LitestandStoryInsertionStatus","tickerPhoteSnowLiftOpenStatus","Locale","PageTransitions","Parent","PhotoLogger","PhotoPermalinkURI","PhotosConst","PhotoSessionLog","PhotosetPivotSlide.react","PhotosetSearchPivot.react","PhotosetSearchPivotData","PhotoSnowliftAds","PhotoSnowliftActionsGating","PhotoStreamCache","PhotosUtils","PhotoTagSearchPivotLogger","PhotoViewer","ReactComponentRenderer","Rect","ScriptPath","ScrollableArea","SnowliftVideoPivotsCarouselController","XPhotosSnowliftProfilePicAsyncController","XSnowliftSuggestedLocationRejectController","Style","Toggler","Tooltip","UFIFeedbackTargets","UIPagelet","URI","UserAgent_DEPRECATED","Vector","VideoPermalinkURI","VideoPlayerReason","$","arrayContains","classWithMixins","computeRelativeURI","createArrayFromMixed","csx","cx","emptyFunction","ge","getActiveElement","goURI","invariant","mixin","setTimeoutAcrossTransitions","GraphicPhotoWarningConfig"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la,ma,na,oa,pa,qa,ra,sa,ta,ua,va,wa,xa,ya,za,ab,bb,cb,db,eb,fb,gb,hb,ib,jb,kb,lb,mb,nb,ob,pb,qb,rb,sb,tb,ub,vb,wb,xb,yb){b.__markCompiled&&b.__markCompiled();var zb=b('GraphicPhotoWarningConfig').Events,ac=74,bc=75,cc=70,dc=76,ec=315,fc=new RegExp('\\/posts\\/(\\d+)\\/?$'),gc=nb(ta,xb(u));for(var hc in gc)if(gc.hasOwnProperty(hc))jc[hc]=gc[hc];var ic=gc===null?null:gc.prototype;jc.prototype=Object.create(ic);jc.prototype.constructor=jc;jc.__superConstructor__=gc;function jc(){"use strict";gc.call(this);this._seenTags={};this._navCount=0;this._isZoomOn=false;this.clearAlbumBoundaries();}jc.prototype.preload=function(kc,lc){"use strict";i.loadModules(["PhotoTagger","Live","PhotoTagApproval","PhotoTags","TagTokenizer","css:fb-photos-snowlift-fullscreen-css"],function(nc){this.PhotoTagger=nc;}.bind(this));this.checkProfilePhotoNUX(kc);var mc=this.getImageSrc(new gb(kc).getQueryData());if(mc)if(!this._log(mc))(new Image()).src=mc;};jc.prototype.checkProfilePhotoNUX=function(kc){"use strict";if(!m.display)return;var lc=o.scry(this.root,'#profile_photo_snowlift_nux');if(lc.length>0)j.hide(lc[0]);var mc=(za.getURIBuilder()).setString('uri',kc).getURI();new h().setURI(mc).setHandler(function(nc){if(nc&&nc.payload){var oc=o.scry(this.root,'#profile_photo_snowlift_nux');if(oc.length>0)j.show(oc[0]);}}.bind(this)).send();};jc.prototype.bootstrap=function(kc,lc){"use strict";this.preload(kc,lc);this._href=kc;this._elem=lc;if(this.closeDirty){setTimeout(this.bootstrap.bind(this,kc,lc),0);return;}oa.reset();this.resetUriStack=true;if(this.isOpen)if(this.openExplicitly){this.closeCleanup();this.resetUriStack=false;}else return;this._dataFt=null;var mc=ga.byAttribute(lc,'data-cursor');if(mc){try{var oc=JSON.parse(mc.getAttribute('data-ft'));this._dataFt={qid:oc.qid,mf_story_key:oc.mf_story_key};}catch(nc){}}else try{mc=ga.byAttribute(lc,'data-ad');var pc=JSON.parse(mc.getAttribute('data-ad'));this._dataFt={ad_id:pc.adid};}catch(nc){}wa.openOverlayView('snowlift');this.returningToStart=false;this.loading&&j.removeClass(this.loading,'loading');if(lc){j.addClass((this.loading=lc),'loading');var qc=ga.byClass(lc,'uiStreamStory')||ga.byClass(lc,"_5jmm");if(qc){this.storyID=qc.id;}else{var rc=ga.byClass(lc,"_5b9c");if(rc)this.storyID=rc.getAttribute('data-ownerid');}this._updateContainerOwnerID();this.getThumbAndSize(lc);}else this.loading=null;g.inform('PhotoSnowlift.GO',kc,g.BEHAVIOR_STATE);this.loadFrameIfUninitialized();this._setupNextItemUI();};jc.prototype._updateContainerOwnerID=function(){"use strict";if(this.container)if(this.storyID){this.container.setAttribute('data-ownerid',this.storyID);}else this.container.removeAttribute('data-ownerid');};jc.prototype.setupFromSnowflake=function(kc,lc){"use strict";this.extraClasses=kc;this.snowflake=true;this.firstInSet=lc;if(this.root){j.addClass(this.root,"snowflake");this.extraClasses.forEach(function(mc){j.addClass(this.root,mc);},this);}};jc.prototype.getCurrentImageServerSizeDimensions=function(){"use strict";var kc=this.stream.getCurrentImageData();return kc.originalDimensions||kc.dimensions;};jc.prototype.getEventPrefix=function(){"use strict";return 'PhotoSnowlift';};jc.prototype.getRoot=function(){"use strict";return this.root;};jc.prototype.getSourceString=function(){"use strict";return 'snowlift';};jc.prototype.getViewerSource=function(){"use strict";return this.source;};jc.prototype.getViewerSet=function(){"use strict";return this.stream.getPhotoSet();};jc.prototype.getVersionConst=function(){"use strict";return ja.VIEWER_SNOWLIFT;};jc.prototype.getImage=function(){"use strict";return this.image;};jc.prototype.getImageId=function(){"use strict";return this.stream.getCursor();};jc.prototype.getRHCHeader=function(){"use strict";return this.rhcHeader;};jc.prototype.getRHCBody=function(){"use strict";return this.ufiForm;};jc.prototype.getRHCFooter=function(){"use strict";return this.rhcFooter;};jc.prototype.getLoadQuery=function(){"use strict";return this.loadQuery;};jc.prototype.getCurrentPhotoInfo=function(){"use strict";var kc=this.stream.getCurrentImageData();if(kc)return kc.info;return null;};jc.prototype.getOwnerId=function(){"use strict";var kc=this.stream.getCurrentImageData();if(kc)return kc.info.owner;return null;};jc.prototype.getThumbAndSize=function(kc){"use strict";this.currentImageSize=null;this.thumbSrc=null;var lc=new gb(kc.getAttribute('ajaxify')).getQueryData();if(!lc.size)return;var mc=ib.deserialize(lc.size);if(!mc.x||!mc.y)return;this.currentImageSize=mc;if(kc.getAttribute('data-cropped'))return;var nc=n.scry(kc,'img')[0],oc=n.scry(kc,'i')[0],pc=ga.byAttribute(kc,'data-size');this.shouldStretch=pc&&this.currentImageSize&&nc&&pc.getAttribute('data-size')==="2"&&this.currentImageSize.x>this.currentImageSize.y&&this.currentImageSize.x<=jc.TIMELINE_STRETCH_WIDTH&&nc.offsetWidth===jc.TIMELINE_STRETCH_WIDTH;var qc;if(nc){qc=nc.src;}else if(oc){qc=bb.get(oc,'backgroundImage').replace(/.*url\("?([^"]*)"?\).*/,'$1');}else return;this.thumbSrc=qc;};jc.prototype.loadFrameIfUninitialized=function(){"use strict";if(this.root)return;new h('/ajax/photos/snowlift/init.php').setAllowCrossPageTransition(true).setMethod('GET').setReadOnly(true).send();};jc.prototype.init=function(kc,lc){"use strict";this.init=sb;this._shouldLog=lc.photos_client_loading;this._logger=null;if(this._shouldLog)this._logger=new ha(ja.VIEWER_SNOWLIFT_STRING);this._showHover=lc.pivot_hover;this._showMorePhotos=lc.show_more_photos;this._extraSlidePivot=lc.extra_slide_pivot;ka.setEndMetrics(lc.pivot_end_metric);this.startingMousePos=null;this.haveLeftBufferRegion=false;this.showingTypeaheadSuggestions=false;this.fullscreen=s.isSupportedWithKeyboardInput();this.showOGVideos=lc.og_videos;this.resizeCommentsForAds=lc.resize_comments_for_ads;this._canSeeGraphicWarning=!!lc.can_see_graphic_warning;this.initGraphicWarningDOM(lc.graphic_warning_markup);this.spotlight=kc;this.spotlight.subscribe('blur',function(){this.closingAction=ka.OUTSIDE;}.bind(this));this.spotlight.subscribe('hide',this.closeHandler.bind(this));this.spotlight.subscribe('key',this.keyHandler.bind(this));this.initializeNodes(this.spotlight.getRoot());oa.init(this.sideAdUnit,this,lc,this.adsDisplayedCallback.bind(this));this.inAdsDisplayedCallback=false;this.lastAdsHeight=0;if(!this.subscription){ba.registerHandler(this.handleNavigateAway.bind(this));this.subscription=g.subscribe('PhotoSnowlift.GO',function(mc,nc){this.openExplicitly=true;this.loading&&j.removeClass(this.loading,'loading');this.open(nc);}.bind(this));}this.transitionHandlerRegistered=false;this.returningToStart=false;fa.registerHandler(this.openHandler.bind(this));this.openHandlerRegistered=true;g.subscribe('PhotoTagApproval.HILITE_TAG',this.onHiliteTag.bind(this));g.subscribe('PhotoTagApproval.UPDATE_TAG_BOX',this.onUpdateTagBox.bind(this));if(this.fullscreen)s.subscribe('changed',this.onFullScreenChange.bind(this));this.slideshowGk=lc.snowlift_slideshow;this.buttonTruncateGk=lc.snowlift_button_truncate;this._hasZoomCapability=this._hasZoomCapability&&lc.www_panorama_viewer;this.allowIrrelevantRequests=!!lc.snowlift_allow_irrelevant_requests;if(this.snowflake){j.addClass(this.root,"snowflake");this.extraClasses.forEach(function(mc){j.addClass(this.root,mc);},this);}this._setupNextItemUI();};jc.prototype.onFullScreenChange=function(){"use strict";if(!this.isOpen)return;var kc=s.isFullScreen();j.conditionClass(document.body,'fbPhotoSnowliftFullScreenMode',kc);if(kc){if(!j.hasClass(this.root,'fbPhotoSnowliftEditMode'))this.collapseRHC();var lc=this.stream.getCurrentImageData();if(lc&&lc.url&&this.image.src!==lc.url&&this.shouldShowHiRes(lc))this.switchImage(lc.url);this.adjustForResize();if(!this._isZoomOn)this._conditionDisplayZoomInButton();}else{if(!this._isZoomOn)this.uncollapseRHC();if(hb.chrome()&&!j.hasClass(this.root,'fbPhotoSnowliftEditMode'))this.page(0,false);g.inform('reflow');}cb.hide();};jc.prototype.initializeNodes=function(kc){"use strict";this.root=kc;this.container=n.find(kc,'div.fbPhotoSnowliftContainer');this._updateContainerOwnerID();this.snowliftPopup=n.find(this.container,'div.fbPhotoSnowliftPopup');this.rhc=n.find(this.snowliftPopup,'div.rhc');this.rhcHeader=n.find(this.rhc,'div.rhcHeader');this.rhcFooter=n.find(this.rhc,'div.rhcFooter');this.taglist=n.find(this.rhc,'span.fbPhotoTagList');this.ufiForm=n.find(this.rhc,'form.fbPhotosSnowliftFeedbackForm');this.ufiInputContainer=n.find(this.rhc,'div.fbPhotosSnowboxFeedbackInput');this.scroller=n.find(this.ufiForm,'div.rhcScroller');this.scrollerBody=n.find(this.scroller,'div.uiScrollableAreaBody');this.stageWrapper=n.find(this.snowliftPopup,'div.stageWrapper');this.overlay=n.find(this.snowliftPopup,'div.snowliftOverlay');this.errorBox=n.find(this.stageWrapper,'div.stageError');this.image=n.find(this.stageWrapper,'img.spotlight');this.stage=n.find(this.stageWrapper,'div.stage');this.showZoomInButton=n.scry(this.stageWrapper,"._5qmg").pop();this.showZoomOutButton=n.scry(this.stageWrapper,"._5qmh").pop();this.zoomedImage=n.scry(this.stage,"._10zw").pop();this.outerImageSlider=n.scry(this.stage,"._10zx").pop();this.innerImageSlider=n.scry(this.stage,"._10zv").pop();this._hasZoomCapability=this.showZoomInButton&&this.showZoomOutButton&&this.zoomedImage&&this.outerImageSlider&&this.innerImageSlider;if(this._hasZoomCapability){j.hide(this.showZoomInButton);j.hide(this.showZoomOutButton);j.hide(this.zoomedImage);j.hide(this.outerImageSlider);}this.videoStage=n.find(this.stageWrapper,'div.videoStage');this.prevPager=n.find(this.snowliftPopup,'a.snowliftPager.prev');this.nextPager=n.find(this.snowliftPopup,'a.snowliftPager.next');this.upPager=n.find(this.container,'a.snowliftPager.up');this.downPager=n.find(this.container,'a.snowliftPager.down');this.stageActions=n.find(kc,'div.stageActions');this.buttonActions=n.find(this.stageActions,'div.fbPhotosPhotoButtons');this.placeInfo=n.find(this.rhc,'div.fbPhotosSnowliftPlaceInfo');this.sideAdUnit=n.find(kc,"._5ciw");j.conditionClass(this.root,'fullScreenAvailable',this.fullscreen);};jc.prototype.getGraphicWarningContainer=function(){"use strict";return this.stageWrapper;};jc.prototype.getGraphicWarningHiddenContent=function(){"use strict";return this.stage;};jc.prototype.initializeScroller=function(){"use strict";this.initializeScroller=sb;j.addClass(this.scroller,"_467y");this.scrollableArea=xa.fromNative(this.scroller,{fade:true,persistent:true});var kc=function(event){var lc=q.$E(event).getTarget();if(n.contains(this.ufiInputContainer,lc)){var mc=p.getInstance(lc);if(mc){this.scrollableArea.scrollToBottom();var nc=mc.subscribe('resize',function(){var pc=this.scrollableArea.isScrolledToBottom();this.adjustScroller();pc&&this.scrollableArea.scrollToBottom();}.bind(this)),oc=q.listen(lc,'blur',function(){mc.unsubscribe(nc);oc.remove();});}}if(lc.classList.contains('UFIPagerLink')||lc.classList.contains('UFICommentLink'))if(this.autoplayOptionScreenConfig&&this.autoplayOptionScreenConfig.enabled)this.haltAutoplay=true;}.bind(this);g.subscribe('ufi/inputHeightChanged',function(lc,mc){if(n.contains(this.ufiInputContainer,mc.node))this.adjustScroller();}.bind(this));g.subscribe('ufi/addCommentFacepileRendered',function(){this.adjustScroller();}.bind(this));g.subscribe('ufi/changed',function(lc,mc){if(this.ufiForm===mc.form)this.adjustScrollerIfNecessary();}.bind(this));g.subscribe('ufi/comment',function(lc,mc){if(this.ufiForm===mc.form){this.adjustScrollerIfNecessary();if(mc.isinverted){this.scrollableArea.scrollToTop();}else this.scrollableArea.scrollToBottom();}}.bind(this));q.listen(this.rhc,'click',function(event){var lc=event.getTarget();if(ga.byTag(lc,'a')||ga.byTag(lc,'button')||n.isNodeOfType(lc,'input'))this.adjustScrollerIfNecessary();}.bind(this));g.subscribe(['reflow','CommentUFI.Pager'],function(){if(this.isOpen)this.adjustScrollerIfNecessary();}.bind(this));g.subscribe('ufi/translationRendered',function(){this.adjustScrollerIfNecessary();}.bind(this));q.listen(this.ufiForm,'focusin',kc);};jc.prototype.openHandler=function(kc){"use strict";if(this.isOpen||!ia.isValid(kc)||this.returningToStart||kc.getQueryData().closeTheater||kc.getQueryData().permPage){this.openHandlerRegistered=false;return false;}this.open(kc);this._uriStack.push(new gb(kc).getQualifiedURI().toString());fa.transitionComplete(true);return true;};jc.prototype.addHaltAutoplaySubscription=function(){"use strict";g.subscribe(['ufi/focus'],function(){this.haltAutoplay=true;}.bind(this));g.subscribe(['ufi/blur'],function(kc,lc){this.haltAutoplay=lc.hasEnteredText;}.bind(this));};jc.prototype.getImageSrc=function(kc){"use strict";if(kc.smallsrc){if(!kc.size)return kc.smallsrc;var lc=ib.deserialize(kc.size),mc=this.getStageSize(lc);mc=this._adjustStageSizeForPixelRatio(mc);if(mc.x<=jc.STAGE_NORMAL_MAX.x&&mc.y<=jc.STAGE_NORMAL_MAX.y)return kc.smallsrc;}return kc.src;};jc.prototype.open=function(kc){"use strict";var lc=new gb(kc),mc=lc.getQueryData(),nc=ia.parse(lc);if(nc!==null){mc.fbid=nc.photo_id;mc.set=nc.set_token;}var oc=jb.parse(lc);if(oc!==null){mc.v=oc.video_id;mc.set=oc.set_token;}if(!mc.fbid&&!mc.v&&!mc.pid){var pc=fc.exec(lc.getPath());if(pc)mc.v=pc[1];}var qc=this.getImageSrc(mc);if(qc){delete mc.src;delete mc.smallsrc;}if(this.resetUriStack)this._uriStack=[];if(!this.initialLoad){mc.firstLoad=true;this.initialLoad=true;ca.registerBlocker(function(){return this.isOpen;}.bind(this));da.registerOpenChecker(function(){return this.isOpen;}.bind(this));}this.sessionID=Date.now();this.loadQuery=Object.assign(mc,{ssid:this.sessionID});if(this._dataFt)this.loadQuery.data_ft=this._dataFt;this.isOpen=true;this.pagersShown=false;this.refreshOnClose=false;this.hilitedTag=null;this.loadingStates={image:false,html:false};this.replaceUrl=false;this.movementDelta=0;this.pivotsCarouselElement=null;this.autoplayOptionScreenConfig=null;this.haltAutoplay=false;this.shouldRenderVideoPivots=false;j.show(this.nextPager);j.show(this.prevPager);this.source=null;this.saveTagSubscription=g.subscribe('PhotoTagger.SAVE_TAG',this.onTagSaved.bind(this));this.taggedPhotoIds=[];this.stream=new qa();this.stream.init(ja.VIEWER_SNOWLIFT,'PhotoViewerPagelet','pagelet_photo_viewer',this._shouldLog?this._logger:null,mc.tagSuggestionMode||'everyone');if(!!gb.getMostRecentURI().getQueryData().viewas)this.stream.setViewAs(gb.getMostRecentURI().getQueryData().viewas+'');this.fetchInitialData();this.setLoadingState(jc.STATE_HTML,true);this.rhcCollapsed=false;this._open(kc,qc);i.loadModules(["PhotosButtonTooltips"],function(rc){rc.init();});};jc.prototype._open=function(kc,lc){"use strict";this.createLoader(lc);this.spotlight.show();g.inform('layer_shown',{type:'PhotoSnowlift'});g.inform('PhotoSnowlift.OPEN');this.stageHandlers=[q.listen(window,'resize',this.adjustForResize.bind(this)),q.listen(this.stageWrapper,'click',this.buttonListener.bind(this)),q.listen(this.stageWrapper,'mouseleave',function(event){var oc=event.getTarget();if(!(ga.byClass(oc,'snowliftOverlay')||ga.byClass(oc,'fbPhotoSnowliftTagApproval')||ga.byClass(oc,'tagPointer')||ga.byClass(oc,'arrow')||ga.byClass(oc,'faceboxSuggestion')||ga.byClass(oc,'typeaheadWrapper')||ga.byClass(oc,'photoTagTypeahead')||ga.byClass(oc,'fbPhotoTagger')))this.unhiliteAllTags();this.hidePagers();}.bind(this)),q.listen(this.stageWrapper,'mousemove',this.hilitePager.bind(this)),q.listen(this.root,'mousemove',this.hiliteProductItemPager.bind(this)),q.listen(this.stageWrapper,'mousemove',this.hiliteTagsOnMouseMove.bind(this)),q.listen(this.overlay,'mouseenter',this.unhiliteAllTags.bind(this)),q.listen(this.container,'mousemove',this._enableMouseOver.bind(this)),q.listen(this.container,'mouseover',this._interceptMouseOver.bind(this)),q.listen(this.stageWrapper,'focusin',this.hilitePager.bind(this)),q.listen(this.root,'focusin',this.hiliteProductItemPager.bind(this)),q.listen(this.rhc,'focusin',this.hidePagers.bind(this))];if(this._hasZoomCapability){this.stageHandlers.push(q.listen(this.stage,'mousedown',this._zoomedImageMouseDown.bind(this)));this.stageHandlers.push(q.listen(this.root,'mouseup',this._zoomedImageMouseUp.bind(this)));}this.stageHandlers.push(q.listen(this.container,'click',function(event){var oc=event.getTarget();if(ga.byClass(oc,'rotateRight')){this.rotate('right');}else if(ga.byClass(oc,'rotateLeft')){this.rotate('left');}else if(ga.byClass(oc,'closeTheater')){if(s.isFullScreen()){s.toggleFullScreen();return;}this.closingAction=ka.X;this.spotlight.hide();return false;}else if(ga.byClass(oc,"_32_l")){var pc=ga.byClass(oc,"_32_l"),qc=pc.getAttribute('data-fbid'),rc=this.stream.getCursor(),sc=this.stream.calculateDistance(rc,qc),tc=this.stream.fbidList.indexOf(qc);ya.adjustCarousel(tc);this.page(sc,false);this.haltAutoplay=false;this.removeAutoplayOptionScreen();}else if(this.fullscreen)if(ga.byClass(oc,'fbPhotoSnowliftFullScreen')){this.toggleFullScreen();}else if(ga.byClass(oc,'fbPhotoSnowliftCollapse'))this.toggleCollapse();}.bind(this)));var mc=tb('fbPhotoSnowliftFeedback');if(mc)this.stageHandlers.push(q.listen(mc,'click',function(event){var oc=event.getTarget();if(ga.byClass(oc,'like_link')||(ga.byClass(oc,'UFILikeLink')&&ga.byClass(oc,'UIActionLinks')))this.toggleLikeButton();var pc=ga.byClass(event.getTarget(),'uiUfiCollapsedComment');if(pc)j.addClass(pc,'uiUfiCollapsedCommentToggle');}.bind(this)));var nc=tb('fbPhotoSnowliftOnProfile');if(nc)this.stageHandlers.push(q.listen(nc,'click',function(event){if(ga.byClass(event.getTarget(),'fbPhotoRemoveFromProfileLink'))this.refreshOnClose=true;}.bind(this)));if(this.resetUriStack)this.startingURI=gb.getMostRecentURI().addQueryData({closeTheater:1}).getUnqualifiedURI();if(!lc)this.setLoadingState(jc.STATE_IMAGE_DATA,true);if(!this.transitionHandlerRegistered){fa.registerHandler(this.transitionHandler.bind(this));this.transitionHandlerRegistered=true;}ka.initLogging(ka.SNOWLIFT);if(this.pivots)ka.setRelevantCount(this.pivots.relevantCount);};jc.prototype.toggleFullScreen=function(){"use strict";var kc=s.toggleFullScreen(document.documentElement);if(kc){var lc=this.stream.getCurrentImageData();if(lc&&lc.url&&this.image.src!==lc.url&&this.shouldShowHiRes(lc))if(!this._log(lc.url))(new Image()).src=lc.url;ka.logEnterFullScreen(this.stream.getCursor());}};jc.prototype.getStream=function(){"use strict";return this.stream;};jc.prototype.fetchInitialData=function(){"use strict";this.stream.waitForInitData();fb.loadFromEndpoint('PhotoViewerInitPagelet',tb('pagelet_photo_viewer_init',this.root),this.loadQuery,{actorID:eb.getActorIDForFeedbackTargetIfExists(this.loadQuery.fbid),usePipe:true,jsNonblock:true,crossPage:true,allowIrrelevantRequests:this.allowIrrelevantRequests});};jc.prototype.toggleCollapse=function(){"use strict";if(this.rhcCollapsed){this.uncollapseRHC();}else this.collapseRHC();};jc.prototype.collapseRHC=function(){"use strict";this.rhcCollapsed=true;j.addClass(this.root,'collapseRHC');this.adjustForResize();};jc.prototype.uncollapseRHC=function(){"use strict";this.rhcCollapsed=false;j.removeClass(this.root,'collapseRHC');this.adjustForResize();};jc.prototype.closeHandler=function(){"use strict";if(!this.isOpen)return;this.closingAction=this.closingAction||ka.ESC;if(gb.getMostRecentURI().addQueryData({closeTheater:1}).getUnqualifiedURI().toString()==this.startingURI.toString()){this.close();return;}this.returnToStartingURI(this.refreshOnClose);this.close();};jc.prototype.returnToStartingURI=function(kc,lc){"use strict";if(!kc)if(lc){this.squashNextTransition(vb.bind(null,lc));}else this.squashNextTransition();this.returningToStart=true;var mc=g.subscribe('page_transition',(function(){this.returningToStart=false;mc.unsubscribe();}).bind(this)),nc=kc||isNaN(hb.opera()),oc=this._uriStack.length;if(nc&&oc<window.history.length){window.history.go(-oc);}else{var pc=this.startingURI,qc=new gb(pc).removeQueryData('closeTheater');if(pc.getQueryData().sk=='approve'&&pc.getPath()=='/profile.php'){qc.removeQueryData('highlight');qc.removeQueryData('notif_t');}vb(qc);}};jc.prototype.squashNextTransition=function(kc){"use strict";this.squashNext=true;fa.registerHandler(function lc(){if(this.squashNext){this.squashNext=false;if(kc)setTimeout(kc,0);fa.transitionComplete(true);return true;}return false;}.bind(this),7);};jc.prototype.handleNavigateAway=function(kc){"use strict";var lc=ob(fa._most_recent_uri.getQualifiedURI(),kc.getAttribute('href'));if(this.isOpen&&(lc instanceof gb)&&lc.getUnqualifiedURI().toString()!=this.startingURI.toString()&&lc.getPath()!='/photo.php'){if(!this.closingAction)this.closingAction=ka.NAVIGATE;this.returnToStartingURI(false,lc);this.close();return false;}return true;};jc.prototype.postProcessTaggedPhotos=function(){"use strict";if(this.taggedPhotoIds&&this.taggedPhotoIds.length>0){var kc=null;if(this.source===jc.COLLECTIONS_UNTAGGED_PHOTOS){kc='/ajax/photos/photo/edit/skiptag/';}else if(this.source===jc.PHOTOS_OF_YOU_SUGGESTIONS||this.source===jc.FRIENDS_IN_PHOTOS_SUGGESTIONS)kc='/ajax/photos/photo/add_to_star_grid/';if(kc)new h().setURI(kc).setAllowCrossPageTransition(true).setData({media_id:this.taggedPhotoIds,source:this.source}).send();}};jc.prototype.onTagSaved=function(kc,lc){"use strict";if(this.taggedPhotoIds){if(this.source===jc.PHOTOS_OF_YOU_SUGGESTIONS&&!lc.self_tag)return;this.taggedPhotoIds.push(lc.photo_fbid);}};jc.prototype.clearAlbumBoundaries=function(){"use strict";this._albumBoundaries={start:0,end:0,dir:0};};jc.prototype.close=function(){"use strict";if(!this.isOpen)return;this._albumFBID=null;this.hideMorePhotos();this.hidePivotSlide();this._pauseVideoIfNeeded();this.isOpen=false;this._navCount=0;this.clearAlbumBoundaries();if(this.fullscreen)s.disableFullScreen();wa.closeOverlayView('snowlift');this.spotlight.hide();this.openExplicitly=false;this.postProcessTaggedPhotos();g.unsubscribe(this.saveTagSubscription);this.taggedPhotoIds=[];this.closeDirty=true;yb(this.closeCleanup.bind(this),0);if(this.snowflake){j.removeClass(this.root,"snowflake");this.extraClasses.forEach(function(kc){j.removeClass(this.root,kc);},this);}this.extraClasses=[];this.snowflake=false;this.firstInSet=null;this.movementDelta=0;};jc.prototype.closeCleanup=function(){"use strict";this.closeDirty=false;j.removeClass(this.root,'dataLoading');ka.logPhotoViews(this.closingAction);this.destroy();j.hide(this.errorBox);j.hide(this.image);this.currentImageSize=null;this.thumbSrc=null;this.shouldStretch=false;this.resetUriStack=true;var kc=this.stream.getCursor();j.removeClass(this.stageWrapper,'showVideo');n.empty(this.videoStage);this.uncollapseRHC();this.currentMinSize=null;this.setStagePagersState('reset');this.recacheData();n.empty(this.sideAdUnit);this.stream.destroy();this.root.setAttribute('aria-busy','true');var lc=this.closingAction===ka.NAVIGATE;this.closingAction=null;if(!this.openHandlerRegistered){fa.registerHandler(this.openHandler.bind(this));this.openHandlerRegistered=true;}g.inform('layer_hidden',{type:'PhotoSnowlift'});g.inform('PhotoSnowlift.CLOSE',{is_navigating:lc,fbid:kc});this._setZoomOut();this._previousZoomScrollPercent=null;};jc.prototype.createLoader=function(kc){"use strict";if(this.currentImageSize===null){this.adjustStageSize(jc.STAGE_MIN);}else{var lc=this.getStageSize(this.currentImageSize);lc=new ib(Math.max(lc.x,this.getMinimumStageWidth()),Math.max(lc.y,jc.STAGE_MIN.y));var mc=this.getImageSizeInStage(this.currentImageSize,lc);if(this.thumbSrc===null){this.adjustStageSize(mc);}else this.useImage(n.create('img',{className:'spotlight',alt:'',src:this.thumbSrc,style:{width:mc.x+'px',height:mc.y+'px'}}),mc,false);}this.setLoadingState(this.STATE_IMAGE_PIXELS,true);if(kc)setTimeout((function(){var nc=new Image(),oc=function(){if(!this.isOpen)return;if(!this.stream||!this.stream.errorInCurrent()){this.switchImage(kc,this.currentImageSize);this.setLoadingState(jc.STATE_IMAGE_DATA,false);}}.bind(this),pc=q.listen(nc,'load',oc),qc=function(){if(pc){pc.remove();pc=null;}};g.subscribeOnce('PhotoSnowlift.SWITCH_IMAGE',qc);g.subscribeOnce('PhotoSnowlift.CLOSE',qc);this._log(kc);nc.src=kc;}).bind(this),0);j.hide(this.stageActions);this.setStagePagersState('disabled');};jc.prototype.initDataFetched=function(kc){"use strict";ka.setPhotoSet(this.stream.getPhotoSet());ka.setLogFbids(kc.logids);this._albumBoundaries.start=this.stream.getCursor();var lc=this.stream.getCurrentImageData();ka.addPhotoView(lc.info,this.shouldShowHiRes(lc),this.fullscreen&&s.isFullScreen());var mc=this.stream.getCurrentExtraData();if(this._showHover&&mc)sa.logImageImpression('snowlift',String(this.stream.getCursor()),Object.keys(mc.tagRects));if(mc&&mc.source!==(void 0)){this.source=parseInt(mc.source,10);ka.setSource(this.source);}if(!this.pageHandlers)this.pageHandlers=[q.listen(this.root,'click',this.pageListener.bind(this)),q.listen(this.root,'mouseleave',this.mouseLeaveListener.bind(this))];j.show(this.stageActions);this.root.setAttribute('aria-busy','false');this.isLoggedInViewer=kc.loggedin;this.disableAds=!this.isLoggedInViewer||kc.fromad||this.stream.isInViewAsMode();this.loadAds();if(this._isZoomAvailable(lc)){ka.addPanoramaImpression();var nc=new ib(this.stage.clientWidth,this.stage.clientHeight);this._displayZoomInButton(nc);}else if(this._hasZoomCapability)j.hide(this.showZoomInButton);};jc.prototype.adjustScrollerIfNecessary=function(){"use strict";clearTimeout(this.scrollerTimeout);this.scrollerTimeout=setTimeout(this.adjustScroller.bind(this),0);};jc.prototype.adjustScroller=function(kc){"use strict";clearTimeout(this.scrollerTimeout);this.initializeScroller();this.scrollableArea.resize();var lc=ib.getElementDimensions(this.rhc),mc=lc.y;mc-=ib.getElementDimensions(this.rhcHeader).y;mc-=ib.getElementDimensions(this.ufiInputContainer).y;if(this.placeInfo){var nc=ib.getElementDimensions(this.placeInfo);mc-=nc.y;bb.set(this.sideAdUnit,'bottom',nc.y+'px');}if(kc==null)kc=this.resizeCommentsForAds?this.lastAdsHeight:0;this.lastAdsHeight=kc;mc=Math.max(0,mc);var oc=ib.getElementDimensions(this.scrollerBody).y,pc=Math.max(jc.MIN_UFI_HEIGHT,mc-kc);if(oc>=pc){if(mc>pc){j.removeClass(this.rhc,'pinnedUfi');mc-=pc;}else{j.addClass(this.rhc,'pinnedUfi');mc=0;}bb.set(this.scroller,'height',pc+'px');}else{bb.set(this.scroller,'height','auto');j.removeClass(this.rhc,'pinnedUfi');mc-=oc;}var qc=ib.getElementDimensions(this.ufiInputContainer).y;bb.set(this.ufiForm,'padding-bottom',qc+'px');oa.resize(new ib(lc.x,mc));this.scrollableArea.adjustGripper();};jc.prototype.adjustForResize=function(){"use strict";this.currentMinSize=null;this.adjustStageSize();this.adjustForNewData();if(this._hasZoomCapability){if(!this._isZoomOn)this._conditionDisplayZoomInButton();this._scrollZoomedImageToPercent(this._previousZoomScrollPercent);}};jc.prototype.shouldShowHiRes=function(kc){"use strict";if(!kc||!kc.smallurl)return false;var lc=this.getStageSize(kc.dimensions);lc=this._adjustStageSizeForPixelRatio(lc);var mc=this.getImageSizeInStage(kc.dimensions,lc);return (mc.x>jc.STAGE_NORMAL_MAX.x||mc.y>jc.STAGE_NORMAL_MAX.y);};jc.prototype._adjustStageSizeForPixelRatio=function(kc){"use strict";if(window.devicePixelRatio&&window.devicePixelRatio>1)kc=new ib(kc.x*window.devicePixelRatio,kc.y*window.devicePixelRatio);return kc;};jc.prototype.getImageURL=function(kc){"use strict";if(kc.video){return null;}else if(kc.smallurl&&!this.shouldShowHiRes(kc))return kc.smallurl;return kc.url;};jc.prototype.getImageOrVideoDimensions=function(kc){"use strict";if(kc.video){var lc=this.getVideoElement(kc.video);if(lc)return this.getVideoSize(lc);}return this.getImageDimensions(kc);};jc.prototype.getImageDimensions=function(kc){"use strict";if(this._isZoomOn)return kc.originalDimensions;if(kc.smalldims&&(!this.shouldShowHiRes(kc)||this.image.src===kc.smallurl))return kc.smalldims;return kc.dimensions;};jc.prototype.getStageSize=function(kc,lc){"use strict";var mc=ib.getViewportDimensions(),nc=new ib(kc.x,kc.y+this.getExtraVerticalSpace());if(lc)nc=new ib(Math.max(kc.x,lc.x),Math.max(kc.y,lc.y));var oc,pc;if(this.fullscreen&&s.isFullScreen()){pc=screen.height-jc.FULL_SCREEN_PADDING*2;return new ib(this.rhcCollapsed?screen.width:screen.width-jc.SIDEBAR_SIZE_MAX,this._isItemPagerEnabled()?pc-jc.PRODUCT_ITEM_PAGER_HEIGHT_OFFSET:pc);}else{oc=Math.min(nc.x,(mc.x-jc.SIDEBAR_SIZE_MAX-jc.STAGE_CHROME.x));var qc=mc.y-jc.STAGE_CHROME.y;pc=Math.min(nc.y,this._isItemPagerEnabled()?qc-jc.PRODUCT_ITEM_PAGER_HEIGHT_OFFSET:qc);}if(oc===0&&pc===0)return new ib(0,0);var rc=oc/pc,sc=nc.x/nc.y;if(rc<sc)return new ib(oc,Math.round(oc/sc));return new ib(Math.round(pc*sc),pc);};jc.prototype.getExtraVerticalSpace=function(){"use strict";if(this.getVideoOnStage())return jc.VIDEO_BOTTOM_BAR_SPACE*2;return 0;};jc.prototype.getComponentsHeight=function(){"use strict";var kc=this.getVideoOnStage();if(kc)return this.getVideoComponentsHeight(tb(kc));return 0;};jc.prototype.getMinimumStageWidth=function(){"use strict";var kc=jc.STAGE_MIN.x;if(this.getVideoOnStage())return kc;if(pa.ALLOW_MAKE_COVER_PHOTO_BUTTON)kc+=jc.COVER_PHOTO_BUTTON_WIDTH;if(pa.ALLOW_MAKE_PROFILE_PICTURE_BUTTON)kc+=jc.PROFILE_PICTURE_BUTTON_WIDTH;return kc;};jc.prototype.getImageSizeInStage=function(kc,lc){"use strict";var mc=kc.x,nc=kc.y,oc=this.getComponentsHeight(),pc=this.getExtraVerticalSpace();nc-=oc;lc=new ib(lc.x,lc.y-oc-pc);if(mc>=lc.x||nc>=lc.y){var qc=lc.x/lc.y,rc=mc/nc;if(qc<rc){mc=lc.x;nc=Math.round(mc/rc);}else if(qc>rc){nc=lc.y;mc=Math.round(nc*rc);}else{mc=lc.x;nc=lc.y;}}return new ib(mc,nc+oc);};jc.prototype.getStageSizeForZoomedImage=function(kc,lc){"use strict";if(this.fullscreen&&s.isFullScreen()){var mc=this.rhcCollapsed?screen.width:screen.width-jc.SIDEBAR_SIZE_MAX,nc=screen.height-jc.FULL_SCREEN_PADDING*2;return new ib(mc,nc);}var oc=ib.getViewportDimensions();if(lc===null)lc=new ib(0,0);var pc=new ib(Math.max(kc.x,this.getMinimumStageWidth(),lc.x),Math.max(kc.y,jc.STAGE_MIN.y,lc.y)),qc=oc.x-jc.STAGE_CHROME.x;if(!this.rhcCollapsed)qc-=jc.SIDEBAR_SIZE_MAX;mc=Math.min(pc.x,qc);nc=Math.min(pc.y,oc.y-jc.STAGE_CHROME.y);return new ib(mc,nc);};jc.prototype.adjustStageSize=function(kc){"use strict";var lc=this.currentImageSize;if(kc){lc=kc;}else{var mc=this.stream&&this.stream.getCurrentImageData();if(mc)lc=this.getImageOrVideoDimensions(mc);}if(!lc)return;this.currentImageSize=lc;var nc=this.getExtraVerticalSpace();if(this.shouldStretch&&!this.getVideoOnStage()&&lc.x>lc.y&&lc.x<=jc.TIMELINE_STRETCH_WIDTH&&lc.x>=jc.TIMELINE_STRETCH_MIN){lc.y=Math.round(lc.y*jc.TIMELINE_STRETCH_WIDTH/lc.x);lc.x=jc.TIMELINE_STRETCH_WIDTH;}var oc;if(this._isZoomOn){oc=this.getStageSizeForZoomedImage(lc,this.currentMinSize);}else oc=this.getStageSize(lc,this.currentMinSize);if(!this.currentMinSize)this.currentMinSize=new ib(0,0);this.currentMinSize=new ib(Math.max(oc.x,this.getMinimumStageWidth(),this.currentMinSize.x),Math.max(oc.y,jc.STAGE_MIN.y,this.currentMinSize.y));var pc=this.getImageSizeInStage(lc,this.currentMinSize),qc=this.currentMinSize.x-pc.x,rc=this.currentMinSize.y-pc.y;if(qc>0&&qc<jc.PADDING_MIN){this.currentMinSize.x-=qc;}else if(rc>0&&rc<jc.PADDING_MIN)this.currentMinSize.y-=rc;var sc=this.currentMinSize.x+jc.SIDEBAR_SIZE_MAX;if(this.rhcCollapsed)sc=this.currentMinSize.x;var tc=this.getVideoOnStage()&&this.pivotsCarouselElement,uc=0,vc=this.currentMinSize.y;if(tc){var wc=this.pivotsCarouselElement.clientHeight;uc=Math.ceil(wc/100)*100;vc=vc+uc;}this.snowliftPopup.style.cssText='width:'+sc+'px;'+'height:'+vc+'px;';var xc=this.currentMinSize.y-nc,yc=xc+uc;if(hb.firefox()){var zc=bb.get(this.stageWrapper,'font-size');xc=(xc/parseFloat(zc))+'em';yc=(yc/parseFloat(zc))+'em';}else{xc=xc+'px';yc=yc+'px';}this.stageWrapper.style.cssText='width:'+this.currentMinSize.x+'px;'+'line-height:'+xc+';';if(this.getVideoOnStage())this.videoStage.style.cssText='width:'+this.currentMinSize.x+'px;'+'height:'+yc+';';if(this._isZoomOn){var ad=this.currentMinSize.y-nc;if(lc.y>ad){var bd=(lc.x/lc.y)*ad;bb.apply(this.zoomedImage,{width:bd+"px",height:ad+"px"});}else bb.apply(this.zoomedImage,{width:lc.x+"px",height:lc.y+"px"});}else{pc.y-=this.getComponentsHeight();this.setMediaElementSize(pc);}if(tc)this.setPivotCarouselElementWidth(zc);var cd=this.getTagger();if(cd)cd.repositionTagger();this.adjustScrollerIfNecessary();};jc.prototype.setMediaElementSize=function(kc){"use strict";var lc=this.image;if(this.getVideoOnStage())if(this._videoPlayerStateManager&&this._videoPlayerStateManager.setDimensions){this._videoPlayerStateManager.setDimensions(kc.x,kc.y);}else lc=n.scry(this.videoStage,"._53j5")[0]||lc;lc.style.cssText='width:'+kc.x+'px;'+'height:'+kc.y+'px;';};jc.prototype.setPivotCarouselElementWidth=function(kc){"use strict";var lc=this.videoStage.clientWidth;if(hb.firefox()){lc=(lc/parseFloat(kc))+'em';}else lc=lc+'px';this.pivotsCarouselElement.style.width=lc;};jc.prototype.adjustForNewData=function(){"use strict";if(!this.image)return;var kc=n.scry(this.stage,'div.tagsWrapper')[0],lc=ib.getElementDimensions(this.image);if(kc){bb.set(kc,'width',lc.x+'px');bb.set(kc,'height',lc.y+'px');}};jc.prototype.adsDisplayedCallback=function(kc,lc){"use strict";var mc=this.resizeCommentsForAds&&!this.inAdsDisplayedCallback&&!this.disableAds&&kc<jc.MIN_ADS_VISIBLE&&lc.length>=jc.MIN_ADS_VISIBLE;if(mc){this.inAdsDisplayedCallback=true;var nc=lc[jc.MIN_ADS_VISIBLE-1];this.adjustScroller(nc);this.inAdsDisplayedCallback=false;}};jc.prototype.setLoadingState=function(kc,lc){"use strict";switch(kc){case jc.STATE_IMAGE_PIXELS:j.conditionClass(this.root,'imagePixelsLoading',lc);break;case jc.STATE_IMAGE_DATA:this.loadingStates[kc]=lc;j.conditionClass(this.root,'imageLoading',lc);break;case jc.STATE_HTML:this.loadingStates[kc]=lc;j.conditionClass(this.root,'dataLoading',lc);this.rhc.setAttribute('aria-busy',lc?'true':'false');break;}};jc.prototype.destroy=function(){"use strict";this.stageHandlers.forEach(function(kc){kc.remove();});if(this.pageHandlers){this.pageHandlers.forEach(function(kc){kc.remove();});this.pageHandlers=null;}this._slideshowToken&&clearInterval(this._slideshowToken);this._slideshowToken=null;this._videoPlayerStateManager=null;};jc.prototype.checkState=function(kc){"use strict";if(kc!=jc.STATE_ERROR&&!this.loadingStates[kc])return;switch(kc){case jc.STATE_IMAGE_DATA:var lc=this.stream.getCurrentImageData();if(lc){var mc=this.getImageURL(lc);if(mc){this.switchImage(mc,null,true);}else if(lc.video)this.switchVideo(lc.video,true);this.setLoadingState(kc,false);}break;case jc.STATE_HTML:if(this.stream.getCurrentHtml()){this.swapData();this.setLoadingState(kc,false);}break;default:if(this.stream.errorInCurrent()){j.hide(this.image);j.show(this.errorBox);}break;}};jc.prototype.buttonListener=function(event){"use strict";var kc=event.getTarget(),lc=Date.now();if(ga.byClass(kc,"_5qmg")){ka.addPanoramaClick();this.switchIntoZoomedImage();return;}if(ga.byClass(kc,"_5qmh")){this._setZoomOut();this.switchImage(this.getImageURL(this.stream.getCurrentImageData()));return false;}if(ga.byClass(kc,'fbPhotoTagApprovalBox'))return;if(lc-this.lastPage<350)return;if(ga.byClass(kc,'fbPhotosPhotoLike')){this.likePhoto();}else if(ga.byClass(kc,'tagApproveIgnore')){this.updateTagBox(event,kc);}else if(ga.byClass(kc,"_5ge9")){this.hideMorePhotos();this.toggleSlideshow();return false;}else if(ga.byClass(kc,"_5ymu")){if(!this._showingMorePhotos){sa.logShowMorePhotos();var mc=this.stream.getCursor();if(mc)this.showMorePhotos(String(mc));if(this._hasZoomCapability)j.hide(this.showZoomInButton);}else{sa.logHideMorePhotos();this._conditionDisplayZoomInButton();this.hideMorePhotos();}return;}else if(ga.byClass(kc,"_27n"))this._conditionDisplayZoomInButton();this.hideMorePhotos();};jc.prototype.toggleSlideshow=function(){"use strict";if(!this.slideshowGk)return;if(this._slideshowToken){this.stopSlideshow();}else this.startSlideshow();};jc.prototype.startSlideshow=function(){"use strict";this._slideshowToken=window.setInterval(this.page.bind(this,1,hb.chrome()&&s.isFullScreen()),jc.SLIDESHOW_TIME);j.addClass(this.root,'slideshowStarted');j.removeClass(this.root,'slideshowAvailable');};jc.prototype.stopSlideshow=function(){"use strict";this._slideshowToken&&clearInterval(this._slideshowToken);this._slideshowToken=null;j.addClass(this.root,'slideshowAvailable');j.removeClass(this.root,'slideshowStarted');};jc.prototype.likePhoto=function(){"use strict";ka.addButtonLike();var kc=lb('fbPhotoSnowliftFeedback'),lc=n.scry(kc,'button.like_link')[0];if(!lc)lc=n.scry(kc,'a.UFILikeLink')[0];var mc=lc.getAttribute('href');if(s.isFullScreen())if(hb.chrome())lc.setAttribute('href','javascript:;');lc.click();lc.setAttribute('href',mc);};jc.prototype.toggleLikeButton=function(){"use strict";var kc=n.scry(this.buttonActions,'a.fbPhotosPhotoLike')[0];if(kc){var lc=n.find(this.root,'.likeCount'),mc=n.find(lc,'.likeCountNum');if(lc)if(j.hasClass(kc,'viewerLikesThis')){n.setContent(mc,parseInt(mc.textContent,10)-1);}else n.setContent(mc,parseInt(mc.textContent,10)+1);j.toggleClass(kc,'viewerLikesThis');j.removeClass(kc,'viewerAlreadyLikedThis');}};jc.prototype.likePhotoWithKey=function(){"use strict";return aa.like(this.likePhoto.bind(this),ub());};jc.prototype.updateTagBox=function(kc,lc){"use strict";this.unhiliteAllTags();var mc=tb(kc);if(!mc)return;j.addClass(mc,'tagBox');j.addClass(mc,'tagBoxPendingResponse');j.removeClass(mc,'tagBoxPending');j.hide(n.find(mc,'span.tagForm'));if(lc){j.show(n.find(mc,'span.tagApproved'));}else j.show(n.find(mc,'span.tagIgnored'));};jc.prototype.rotate=function(kc){"use strict";var lc=this.stream.getCursor();if(this.getVideoOnStage()){var mc=(kc=='left')?270:90;wb(!!this.videoRotateURI);i.loadModules(["VideoRotate"],function(oc){new oc(lc,this.videoRotateURI).motionRotate(mc);}.bind(this));return;}var nc=Object.assign({fbid:lc,opaquecursor:this.stream.getOpaqueCursor(lc),cs_ver:ja.VIEWER_SNOWLIFT},this.stream.getPhotoSetQuery());nc[kc]=1;this.setLoadingState(jc.STATE_IMAGE_DATA,true);this.setLoadingState(this.STATE_IMAGE_PIXELS,true);j.hide(this.image);new h('/ajax/photos/photo/rotate/').setAllowCrossPageTransition(true).setData(nc).setErrorHandler(this.rotationError.bind(this,lc)).setFinallyHandler(this.rotationComplete.bind(this,lc)).setMethod('POST').setReadOnly(false).send();};jc.prototype.rotationComplete=function(kc,lc){"use strict";if(kc==this.stream.getCursor()){this.setLoadingState(jc.STATE_IMAGE_DATA,false);this.switchImage(this.getImageURL(this.stream.getCurrentImageData()));this.swapData();}};jc.prototype.rotationError=function(kc,lc){"use strict";if(kc==this.stream.getCursor()){this.setLoadingState(jc.STATE_IMAGE_DATA,false);this.switchImage(this.getImageURL(this.stream.getCurrentImageData()));i.loadModules(["AsyncResponse"],function(mc){mc.defaultErrorHandler(lc);});}};jc.prototype.saveTagsFromPayload=function(kc){"use strict";this.storeFromData(kc);if('data' in kc&&this.stream.getCursor() in kc.data)this.swapData();};jc.prototype.saveEdit=function(){"use strict";if(!j.hasClass(this.root,'fbPhotoSnowliftEditMode'))return;i.loadModules(["PhotoInlineEditor","Form"],function(kc,lc){var mc=kc.getInstance(this.getViewerConst());mc&&lc.bootstrap(mc.getForm().controller);}.bind(this));};jc.prototype.mouseLeaveListener=function(event){"use strict";this.unhiliteAllTags();this.reHilitePendingTag();};jc.prototype.hiliteProductItemPager=function(event){"use strict";var kc=ib.getEventPosition(event),lc=ib.getElementDimensions(this.root),mc=lc.y-kc.y;if(mc>jc.PRODUCT_ITEM_PAGER_HILIGHT_DISTANCE&&kc.y>jc.PRODUCT_ITEM_PAGER_HILIGHT_DISTANCE){j.conditionClass(this.upPager,'hilightPager',false);j.conditionClass(this.downPager,'hilightPager',false);return;}var nc=mc<jc.PRODUCT_ITEM_PAGER_HILIGHT_DISTANCE;j.conditionClass(this.upPager,'hilightPager',!nc);j.conditionClass(this.downPager,'hilightPager',nc);};jc.prototype.hilitePager=function(event){"use strict";var kc=ib.getEventPosition(event),lc=ib.getElementPosition(this.stage),mc=ib.getElementDimensions(this.stage);if(ea.isRTL()){this.stagePagerPrev=mc.x-(kc.x-lc.x)<jc.GOPREV_AREA;}else this.stagePagerPrev=kc.x-lc.x<jc.GOPREV_AREA;j.conditionClass(this.prevPager,'hilightPager',this.stagePagerPrev);j.conditionClass(this.nextPager,'hilightPager',!this.stagePagerPrev);var nc,oc=event.getTarget();if(!ga.byClass(oc,'snowliftOverlay')&&!ga.byClass(oc,'bottomBarActions')&&!ga.byClass(oc,'snowliftPager'))nc=jc.PAGER_FADE;this.showPagers(nc);};jc.prototype.showPagers=function(kc){"use strict";clearTimeout(this.fadePagerTimer);this.setStagePagersState('active');if(typeof kc!=='undefined')this.fadePagerTimer=setTimeout(this.hidePagers.bind(this),kc);};jc.prototype.hidePagers=function(){"use strict";var kc=n.scry(this.getRoot(),'.fbPhotosPhotoActionsMenu')[0];if(kc)return;clearTimeout(this.fadePagerTimer);this.setStagePagersState('inactive');};jc.prototype.getTagger=function(){"use strict";return (this.PhotoTagger&&this.PhotoTagger.getInstance(ja.VIEWER_SNOWLIFT));};jc.prototype.unhiliteAllTags=function(){"use strict";clearTimeout(this.unhiliteTimer);n.scry(this.stage,'div.tagsWrapper div.hover').forEach(function(lc){j.removeClass(lc,'hover');});n.scry(this.stage,'div.tagsWrapper div.otherActive').forEach(function(lc){j.removeClass(lc,'otherActive');});this.hilitedTag=null;this.showingTypeaheadSuggestions=false;if(!j.hasClass(this.root,'taggingMode')){var kc=this.getTagger();if(kc){kc.hideTagger();kc.setCurrentFacebox(null);}}};jc.prototype.onCancelSaveRejectedLocation=function(event){"use strict";var kc=o.find(this.root,"#locationSuggestionDialogForm").childNodes,lc=null,mc=null;for(var nc=0;nc<kc.length;nc++){var oc=kc[nc];switch(oc.name){case 'media_id':lc=oc.value;break;case 'location_id':mc=oc.value;break;}}if(lc){var pc=ab.getURIBuilder().setInt('media_id',lc).setInt('location_id',mc).getURI(),qc=new h(pc).setMethod("POST");qc.send();}};jc.prototype.switchHilitedTags=function(kc,lc){"use strict";if(this.switchTimer!==null){clearTimeout(this.switchTimer);this.switchTimer=null;}this.unhiliteAllTags();this.hiliteAllBoxes();var mc=tb(kc);if(mc){this.hilitedTag=kc;if(!j.hasClass(this.root,'taggingMode')&&ra.isFacebox(this.hilitedTag)){var nc=this.getTagger();if(nc){j.addClass(mc,'hover');var oc=nc.getFacebox(kc);nc.setCurrentFacebox(oc);if(oc)nc.addTagFromFacebox(oc);}}else j.addClass(mc,'hover');if(j.hasClass(mc,'tagBoxPending')&&!j.hasClass(mc,'showPendingTagName')&&lc===true){n.scry(this.stage,'div.tagsWrapper div.showPendingTagName').forEach(function(pc){j.removeClass(pc,'showPendingTagName');});j.addClass(mc,'showPendingTagName');}}};jc.prototype.reHilitePendingTag=function(){"use strict";var kc=tb(this.hilitedTag);if(kc&&j.hasClass(kc,'showPendingTagName'))return;var lc=n.scry(this.stage,'div.tagsWrapper div.showPendingTagName')[0];if(lc)this.switchHilitedTags(lc.id);};jc.prototype.hiliteTagsOnMouseMove=function(event){"use strict";if(!this.stream.getCurrentExtraData()||this.getVideoOnStage())return;if(this.switchTimer!==null)return;var kc=event.getTarget();if(ga.byClass(kc,'snowliftOverlay')||ga.byClass(kc,'fbPhotoSnowliftTagApproval')||ga.byClass(kc,'tagPointer')||ga.byClass(kc,'arrow')||ga.byClass(kc,'faceboxSuggestion')||ga.byClass(kc,'typeaheadWrapper')||ga.byClass(kc,'photoTagTypeahead'))return;var lc=ga.byClass(kc,'tagBoxPending'),mc=false;if(this.hilitedTag){var nc=tb(this.hilitedTag);mc=nc&&j.hasClass(nc,'tagBoxPending');}var oc=((!this.hilitedTag&&lc)||(!mc&&lc));if(oc){this.switchHilitedTags(lc.id);return;}if(lc&&(lc.id==this.hilitedTag))return;var pc=250,qc=15,rc=ib.getEventPosition(event);if(!this.startingMousePos)this.startingMousePos=rc;var sc=ra.absoluteToNormalizedPosition(this.image,rc);if(!this.haveLeftBufferRegion&&this.startingMousePos.distanceTo(rc)<qc){return;}else this.haveLeftBufferRegion=true;if(this.currentTagHasPrecedence(sc))return;var tc=ra.getNearestBox(this.stream.getCurrentExtraData().tagRects,sc);if(!tc){if(!mc){this.unhiliteAllTags();this.reHilitePendingTag();}return;}var uc=null;if(mc){var vc={};vc[this.hilitedTag]=this.stream.getCurrentExtraData().tagRects[this.hilitedTag];uc=ra.getNearestBox(vc,sc);}if(uc!==null&&mc)return;if(this.hilitedTag!=tc)if(mc){this.switchTimer=setTimeout(this.switchHilitedTags.bind(this,tc),pc);}else{if(this._showHover&&!this._seenTags[tc]){this._seenTags[tc]=true;sa.logPivotImpression('snowlift',tc);}this.switchHilitedTags(tc);}};jc.prototype.currentTagHasPrecedence=function(kc){"use strict";if(!this.hilitedTag)return false;if(this.stream.getCurrentExtraData().tagRects[this.hilitedTag]===(void 0)){this.hilitedTag=null;return false;}var lc=this.stream.getCurrentExtraData().tagRects[this.hilitedTag],mc=new va(lc.t+(lc.h()/2),lc.r,lc.b+(ra.isFacebox(this.hilitedTag)?10:0),lc.l,lc.domain);return mc.contains(kc);};jc.prototype.getVideoOnStage=function(){"use strict";var kc=this.stream&&this.stream.getCurrentImageData();return kc&&kc.video;};jc.prototype.shouldPageOnAction=function(kc,lc){"use strict";if(!this.isOpen||aa.isShowingConfirmation())return false;var mc=n.isNode(lc)&&(ga.byClass(lc,'snowliftPager')||ga.byClass(lc,'stagePagers')||ga.byClass(lc,'pivotPageColumn')),nc=n.isNode(lc)&&ga.byClass(lc,'stage'),oc=j.hasClass(lc,'faceBox'),pc=(!j.hasClass(this.root,'taggingMode')&&oc&&!mc);if(pc){if(!this.showingTypeaheadSuggestions){this.getTagger().updateWithSuggestions();setTimeout((function(){n.find(this.getTagger().tagger,'input.textInput').focus();}).bind(this),0);}this.showingTypeaheadSuggestions=!this.showingTypeaheadSuggestions;return false;}var qc=((nc&&j.hasClass(this.root,'taggingMode'))||ga.byClass(lc,'tagBoxPending')||ga.byClass(lc,'tagBoxPendingResponse')||ga.byClass(lc,'fbPhotoTagApprovalBox')||ga.byClass(lc,'tag'));if(qc)return false;if(nc&&this._isZoomOn)nc=false;return kc==x.LEFT||kc==x.RIGHT||kc==x.UP||kc==x.DOWN||kc==ac||kc==bc||mc||pc||nc;};jc.prototype.keyHandler=function(kc,event){"use strict";if(event.getModifiers().any||y.getTopmostLayer()!==this.spotlight)return true;switch(q.getKeyCode(event)){case x.LEFT:case x.RIGHT:case x.UP:case x.DOWN:case ac:case bc:this.pageListener(event);return false;case cc:return this.toggleFullScreen();case dc:return this.likePhotoWithKey();case x.SPACE:this.toggleSlideshow();this.showPagers(jc.PAGER_FADE);return false;case x.ESC:if(this._isZoomOn){this._setZoomOut();this.switchImage(this.getImageURL(this.stream.getCurrentImageData()));return false;}break;}};jc.prototype._isItemPagerEnabled=function(){"use strict";var kc=this._scrapProductItemSnowLiftLinks();return kc!==null&&kc.length>1;};jc.prototype._setupNextItemUI=function(){"use strict";if(!this.upPager||!this.downPager)return;var kc=this._scrapProductItemSnowLiftLinks();if(!kc||kc.length<2){j.hide(this.upPager);j.hide(this.downPager);}else{var lc=ib.getElementDimensions(this.stage),mc=ib.getElementDimensions(this.root),nc=(mc.y-lc.y)/2-jc.PRODUCT_ITEM_PAGER_MARGIN;this.upPager.style.marginTop="-"+nc+"px";this.downPager.style.marginTop=(nc-jc.PRODUCT_ITEM_PAGER_HEIGHT)+"px";j.show(this.upPager);j.show(this.downPager);}};jc.prototype._scrapProductItemSnowLiftLinks=function(){"use strict";if(!this._elem)return null;var kc=tb('pagelet_group_forsaleposts');if(!kc)kc=tb('group_commerce_cross_group_feed_stories');if(!kc)return null;var lc=n.scry(kc,'a[name="snowlift"]').filter(function(oc){return n.scry(oc,'img').length==1;}),mc=lc.map(function(oc){return oc.href;}),nc=mb(mc,this._elem.href);return nc?lc:[];};jc.prototype._loadNextItem=function(kc){"use strict";var lc=this._scrapProductItemSnowLiftLinks();if(!lc)return;var mc=lc[0];lc.every(function(nc,oc){if(nc.href===this._elem.href){var pc=kc?++oc:--oc;if(pc<0){mc=lc[lc.length-1];}else if(pc<lc.length)mc=lc[pc];return false;}return true;}.bind(this));mc.click();};jc.prototype.shouldHandlePendingTag=function(event){"use strict";var kc=this.getTagger();if(!kc||!kc.tags.length)return false;var lc=ra.absoluteToNormalizedPosition(this.getImage(),ib.getEventPosition(event)),mc=kc.findNearestTag(lc);if(!mc||!j.hasClass(mc.node,'tagBoxPending'))return false;g.inform('PhotoTagApproval.PENDING_TAG_PHOTO_CLICK',{id:mc.id,version:this.getVersionConst()});return true;};jc.prototype.pageListener=function(event){"use strict";var kc=q.getKeyCode(event),lc=event.getTarget();if(this._slideshowToken){this.stopSlideshow();return;}if(!this.shouldPageOnAction(kc,lc))return;if(this.shouldHandlePendingTag(event))return;var mc=0,nc=null,oc=null;if(kc==x.RIGHT||kc==bc){mc=1;ka.setPagingAction('key_right');this._disableMouseOver=true;}else if(kc==x.LEFT||kc==ac){mc=-1;ka.setPagingAction('key_left');this._disableMouseOver=true;}else if(kc==x.UP){ka.setPagingAction('key_up');this._disableMouseOver=true;nc=false;}else if(kc==x.DOWN){ka.setPagingAction('key_down');this._disableMouseOver=true;nc=true;}else if(ga.byClass(lc,'next')){mc=1;ka.setPagingAction('click_next');}else if(ga.byClass(lc,'prev')){mc=-1;ka.setPagingAction('click_prev');}else if(ga.byClass(lc,'down')){nc=true;ka.setPagingAction('click_down');}else if(ga.byClass(lc,'up')){nc=false;ka.setPagingAction('click_up');}else if(oc=ga.byClass(lc,'seek')){var pc=k.get(oc,'seek-fbid');mc=this.stream.getRelativeMovement(pc);ka.setPagingAction('seek');}else if(!this.stagePagerPrev){mc=1;ka.setPagingAction('click_stage');}else{mc=-1;ka.setPagingAction('click_stage_back');}var qc=n.scry(this.ufiForm,'input.mentionsHidden'),rc=false;for(var sc=0;sc<qc.length;sc++)if(!w.isEmpty(qc[sc])){rc=true;break;}if(rc||j.hasClass(this.root,'fbPhotoSnowliftEditMode')){this.warnLeavePage(this.page.bind(this,mc));}else{this.page(mc,hb.chrome()&&s.isFullScreen());this._previousZoomScrollPercent=null;}if(null!==nc)this._loadNextItem(nc);};jc.prototype.warnLeavePage=function(kc){"use strict";new l().setTitle(r._("Are You Sure You Want To Leave This Page?")).setBody(r._("You have unsaved changes that will be lost if you leave the page.")).setButtons([{name:'leave_page',label:r._("Leave This Page"),handler:kc},{name:'continue_editing',label:r._("Stay on This Page"),className:'inputaux'}]).setModal(true).show();};jc.prototype.getUsesOpaqueCursor=function(){"use strict";return this.stream.getUsesOpaqueCursor();};jc.prototype.getOpaqueCursor=function(kc){"use strict";return this.stream.getOpaqueCursor(kc);};jc.prototype.setReachedLeftEnd=function(){"use strict";this.stream.setReachedLeftEnd();};jc.prototype.setReachedRightEnd=function(){"use strict";this.stream.setReachedRightEnd();};jc.prototype.page=function(kc,lc,mc){"use strict";if(!this.stream.isValidMovement(kc)||!this.stream.nonCircularPhotoSetCanPage(kc)){this.showPagers(jc.PAGER_FADE);return;}var nc=this.stream.getCursorAt(this.stream.calculatePositionForMovement(kc));if(this.snowflake&&((this.stream.getCursor()==this.firstInSet&&kc<0)||(this.firstInSet==nc&&kc>0))){this.showPagers(jc.PAGER_FADE);return;}this.lastPage=Date.now();this.unhiliteAllTags();this.startingMousePos=null;this.haveLeftBufferRegion=false;this._seenTags={};this._navCount+=kc;var oc=this.stream.allLoaded?Math.abs(this._navCount)-this.stream.getLength():null;if(this._extraSlidePivot&&this._albumFBID){if(!this._albumBoundaries.end&&oc===0){this._albumBoundaries.end=this.stream.getCursor();this._albumBoundaries.dir=kc;}else if(oc===-1)na.fetch(this._albumFBID,this.stream);if(!this.onExtraSlide){if(this.stream.getCursor()===this._albumBoundaries.end&&nc===this._albumBoundaries.start&&kc===this._albumBoundaries.dir){this.showPivotSlide(this._albumFBID,lc);return;}else if(this.stream.getCursor()===this._albumBoundaries.start&&nc===this._albumBoundaries.end&&kc===-this._albumBoundaries.dir)this.showPivotSlide(this._albumFBID,lc);}else{this.hidePivotSlide();if(kc===-this._albumBoundaries.dir)return;}}var pc=this.getVideoOnStage();if(pc)this.switchVideo(pc,false);if(this.pivots&&this.pivots.page(kc))return;g.inform('PhotoSnowlift.PAGE');cb.hide();this.recacheData();this.stream.moveCursor(kc);j.hide(this.image);if(kc!==0){this.storyID=null;this._updateContainerOwnerID();}if(kc!==0&&this._isZoomOn)this._setZoomOut();if(this.stream.errorInCurrent()){this.setLoadingState(jc.STATE_HTML,true);j.show(this.errorBox);return;}this.movementDelta+=kc;var qc=this.stream.getCurrentImageData();if(qc){var rc=this.getImageURL(qc);if(rc){if(qc.info.isgraphic){if(this._canSeeGraphicWarning){this.showGraphicWarning();t.log(zb.GRAPHIC_PHOTO_SHOWN_WITH_WARNING);}else{this.hideGraphicWarning();t.log(zb.GRAPHIC_PHOTO_SHOWN_NO_WARNING);}}else this.hideGraphicWarning();this.switchImage(rc,null,true);}else if(qc.video)this.switchVideo(qc.video,true,mc);if(!lc){this.replaceUrl=true;vb(qc.info.permalink);}this.setLoadingState(jc.STATE_IMAGE_DATA,false);}else{this.setLoadingState(jc.STATE_IMAGE_PIXELS,true);this.setLoadingState(jc.STATE_IMAGE_DATA,true);}if(this.stream.getCurrentHtml()){this.swapData();}else this.setLoadingState(jc.STATE_HTML,true);this.disableAds=!this.isLoggedInViewer||this.stream.isInViewAsMode();this.loadAds();this.setLeftAndRightPagersState();if(this._slideshowToken){j.addClass(this.root,'slideshowStarted');}else if(this.slideshowAvailable)j.addClass(this.root,'slideshowAvailable');if(!this._extraSlidePivot&&this._showMorePhotos&&this._albumFBID)if(oc===-1){na.fetch(this._albumFBID,this.stream);}else if(oc===0){sa.logSuggestMorePhotos();this.showMorePhotos(this._albumFBID,true);this.showPagers();this._navCount=0;}else{this.hideMorePhotos();this.hidePagers();}};jc.prototype.showMorePhotos=function(kc,lc){"use strict";if(this._showingMorePhotos)return;this._showingMorePhotos=true;if(!this.searchPivot)this.searchPivot=this.overlay.appendChild(document.createElement('div'));j.addClass(this.stageWrapper,"_5ymv");this.searchPivotComponent=new ua(ma,this.searchPivot);this.searchPivotComponent.setProps({className:"_27g",fbid:kc,onclose:this.hideMorePhotos.bind(this),endofalbum:lc||false,withBackground:true});};jc.prototype.hideMorePhotos=function(){"use strict";if(this.searchPivotComponent&&this._showingMorePhotos){this._showingMorePhotos=false;j.removeClass(this.stageWrapper,"_5ymv");this.searchPivotComponent.setProps({fbid:null});}};jc.prototype.showPivotSlide=function(kc,lc){"use strict";if(this.onExtraSlide)return;this.onExtraSlide=true;j.addClass(this.stageWrapper,"_3tvf");if(!this.pivotSlide){this.pivotSlide=n.create('div');n.insertBefore(this.stageActions,this.pivotSlide);}this.pivotSlideComponent=new ua(la,this.pivotSlide);this.pivotSlideComponent.setProps({fbid:kc,isAlbum:this._isAlbum,albumOwnerName:this._albumOwnerName,visible:true,onReturn:this.page.bind(this,this._albumBoundaries.dir,lc)});};jc.prototype.hidePivotSlide=function(){"use strict";if(this.pivotSlideComponent&&this.onExtraSlide){this.pivotSlideComponent.setProps({visible:false});j.removeClass(this.stageWrapper,"_3tvf");}this.onExtraSlide=false;};jc.prototype.logImpressionDetailsForPhoto=function(){"use strict";var kc=[].concat(n.scry(lb('fbPhotoSnowliftTagList'),'input.photoImpressionDetails'),n.scry(lb('fbPhotoSnowliftFeedback'),'input.photoImpressionDetails'));if(kc.length===0)return;var lc={};for(var mc=0;mc<kc.length;mc++)lc[kc[mc].name]=kc[mc].value;if(this.getVideoOnStage()){lc.width=0;lc.height=0;}else{var nc=this.getImageDimensions(this.stream.getCurrentImageData());lc.width=nc.x;lc.height=nc.y;}ka.addDetailData(this.stream.getCursor(),lc);oa.setIsLogAdData(true);};jc.prototype.loadAds=function(){"use strict";if(this.disableAds)return;oa.loadAdsFromUserActivity();};jc.prototype.transitionHandler=function(kc){"use strict";if(kc.getQueryData().closeTheater||kc.getQueryData().permPage||this.returningToStart){if(this.isOpen)this.close();this.transitionHandlerRegistered=false;return false;}if(this.replaceUrl){this.replaceUrl=false;this._uriStack.push(kc.getQualifiedURI().toString());fa.transitionComplete(true);return true;}var lc=this._uriStack.length;if(lc>=2&&this._uriStack[lc-2]==kc.getQualifiedURI().toString())this._uriStack.pop();var mc=this.stream.getCursorForURI(kc.getUnqualifiedURI().toString());if(mc){var nc=this.stream.getRelativeMovement(mc);this.page(nc,true);fa.transitionComplete(false);return true;}if(this.isOpen){fa.transitionComplete(true);this.close();return true;}this.transitionHandlerRegistered=false;return false;};jc.prototype.recacheData=function(){"use strict";if(!this.loadingStates.html){var kc=this.stream.getCurrentHtml();for(var lc in kc){kc[lc]=pb(lb(lc).childNodes);n.empty(lb(lc));}}};jc.prototype.reloadIfTimeout=function(){"use strict";if(!v.hasLoaded(this.image)){var kc=this.makeNewImage(this.image.src,true);q.listen(kc,'load',this.useImage.bind(this,kc,null,true));this._log(kc.src);}};jc.prototype.useImage=function(kc,lc,mc){"use strict";if(mc&&v.hasLoaded(this.image))return;n.replace(this.image,kc);this.image=kc;this.adjustStageSize(lc);};jc.prototype.makeNewImage=function(kc,lc){"use strict";if(this.imageLoadingTimer){clearTimeout(this.imageLoadingTimer);this.imageLoadingTimer=null;}else if(!lc)this.imageRefreshTimer=setTimeout(this.reloadIfTimeout.bind(this),jc.LOADING_TIMEOUT);var mc=n.create('img',{className:'spotlight',alt:''});mc.setAttribute('aria-describedby','fbPhotosSnowliftCaption');mc.setAttribute('aria-busy','true');var nc=function(){clearTimeout(this.imageRefreshTimer);this.image.setAttribute('aria-busy','false');this.setLoadingState(this.STATE_IMAGE_PIXELS,false);setTimeout((function(){if(this.isOpen){this.adjustStageSize();this.adjustForNewData();}}).bind(this),0);}.bind(this);q.listen(mc,'load',nc);this._log(kc);mc.src=kc;return mc;};jc.prototype.switchImage=function(kc,lc,mc){"use strict";j.hide(this.image);j.hide(this.errorBox);this.setLoadingState(this.STATE_IMAGE_PIXELS,true);var nc=this.stream&&this.stream.getCurrentImageData();if(nc){ka.addPhotoView(nc.info,this.shouldShowHiRes(nc),this.fullscreen&&s.isFullScreen());if(this._showHover){var oc=this.stream.getCurrentExtraData();if(oc)sa.logImageImpression('snowlift',String(this.stream.getCursor()),Object.keys(oc.tagRects));}}this.useImage(this.makeNewImage(kc,false),lc,false);if(mc)this.stream.preloadImages(this.shouldShowHiRes.bind(this));if(!this._isZoomOn&&this._isZoomAvailable(nc)){ka.addPanoramaImpression();var pc=new ib(this.stage.clientWidth,this.stage.clientHeight);this._displayZoomInButton(pc);}else if(this._hasZoomCapability)j.hide(this.showZoomInButton);if(this._isZoomOn)this.switchIntoZoomedImage();g.inform('PhotoSnowlift.SWITCH_IMAGE');};jc.prototype._conditionDisplayZoomInButton=function(){"use strict";if(!this._hasZoomCapability)return;if(this._isZoomAvailable()){var kc=new ib(this.stage.clientWidth,this.stage.clientHeight);this._displayZoomInButton(kc);}else j.hide(this.showZoomInButton);};jc.prototype._displayZoomInButton=function(kc){"use strict";var lc=parseInt(this.image.style.height,10),mc=(kc.y-lc)/2;if(mc>=jc.ZOOM_BUTTON_TOP_PAD+jc.ZOOM_BUTTON_BOT_PAD+jc.ZOOM_BUTTON_HEIGHT){var nc=mc-jc.ZOOM_BUTTON_HEIGHT-jc.ZOOM_BUTTON_TOP_PAD;bb.set(this.showZoomInButton,'bottom',nc+'px');}else bb.set(this.showZoomInButton,'bottom','60px');j.show(this.showZoomInButton);};jc.prototype._isZoomAvailable=function(kc){"use strict";if(typeof kc==="undefined")kc=this.stream&&this.stream.getCurrentImageData();if(!this._hasZoomCapability||!kc||!kc.originalDimensions)return false;var lc=new ib(this.stage.clientWidth,this.stage.clientHeight),mc=kc.originalDimensions,nc=mc.x/mc.y,oc=Math.min(lc.y*nc,mc.x);if(!isNaN(nc)&&nc>2&&mc.y>jc.MIN_PANORAMA_Y&&lc.x*jc.MIN_PANO_TO_STAGE_RATIO<oc){return true;}else return false;};jc.prototype._setZoomIn=function(){"use strict";this._isZoomOn=true;j.hide(this.showZoomInButton);j.hide(this.stageActions);j.show(this.showZoomOutButton);bb.set(this.stage,'overflow','hidden');this.spotlight.disableBehavior(z);this.collapseRHC();};jc.prototype._setZoomOut=function(){"use strict";if(!this._hasZoomCapability)return;this._isZoomOn=false;this.spotlight.enableBehavior(z);bb.set(this.stage,'overflow','visible');j.hide(this.showZoomInButton);j.hide(this.showZoomOutButton);j.hide(this.zoomedImage);j.hide(this.outerImageSlider);j.show(this.stageActions);this.uncollapseRHC();};jc.prototype.switchIntoZoomedImage=function(kc){"use strict";this._setZoomIn();j.hide(this.zoomedImage);j.hide(this.outerImageSlider);var lc=this.stream.getCurrentImageData(),mc=lc.originalDimensions;this.zoomedImage.src=lc.url;this.adjustStageSize(mc);this._initializeZoomedImagePositions(new ib(parseInt(bb.get(this.zoomedImage,'width'),10),parseInt(bb.get(this.zoomedImage,'height'),10)));j.hide(this.image);};jc.prototype._adjustInnerImageSlider=function(kc){"use strict";var lc=this.stage.clientWidth,mc=Math.min(100,(lc/kc.x)*100);bb.set(this.innerImageSlider,'width',mc+'%');return mc;};jc.prototype._getSliderSizeForZoomedImage=function(kc){"use strict";var lc=jc.MAX_SLIDER_HEIGHT*this.stage.clientHeight/kc.y,mc=jc.MAX_SLIDER_WIDTH*this.stage.clientWidth/kc.x,nc=Math.min(lc,mc);return new ib(100*kc.x*nc/this.stage.clientWidth,100*kc.y*nc/this.stage.clientHeight);};jc.prototype._initializeZoomedImagePositions=function(kc){"use strict";this._scrollZoomedImageToPercent(this._previousZoomScrollPercent);var lc=this._getSliderSizeForZoomedImage(kc);bb.set(this.outerImageSlider,'width',lc.x+'%');bb.set(this.outerImageSlider,'height',lc.y+'%');bb.set(this.outerImageSlider,'left',(50-lc.x/2)+'%');bb.set(this.showZoomOutButton,'bottom',lc.y*this.stage.clientHeight/100+parseInt(bb.get(this.outerImageSlider,'bottom'),10)+20+'px');j.show(this.zoomedImage);j.show(this.outerImageSlider);};jc.prototype._zoomedImageMouseDown=function(event){"use strict";if(!this._isZoomOn)return;j.addClass(this.stage,'showSlider');if(this._zoomedImageMouseMoveHandle)this._zoomedImageMouseMoveHandle.remove();var kc=false,lc=event.getTarget();if(ga.byClass(lc,"_10zv")){this.startSliderMargins=new ib(parseFloat(bb.get(this.innerImageSlider,'marginLeft')),parseFloat(bb.get(this.innerImageSlider,'marginTop')));this.startImageMargins=null;this.mouseDownStartPosition=new ib(event.clientX,event.clientY);}else if(ga.byClass(lc,"_10zx")){this.startSliderMargins=new ib(parseInt(bb.get(this.innerImageSlider,'marginLeft'),10),parseInt(bb.get(this.innerImageSlider,'marginTop'),10));this.startImageMargins=null;var mc=parseInt(bb.get(this.innerImageSlider,'width'),10);this.mouseDownStartPosition=new ib(this.innerImageSlider.getBoundingClientRect().left+mc/2,event.clientY);kc=true;}else if(ga.byClass(lc,"_10zw")){this.startImageMargins=new ib(parseInt(bb.get(this.zoomedImage,'marginLeft'),10),parseInt(bb.get(this.zoomedImage,'marginTop'),10));this.startSliderMargins=null;this.mouseDownStartPosition=new ib(event.clientX,event.clientY);}this._zoomedImageMouseMoveHandle=q.listen(this.stage,'mousemove',this._zoomedImagePan.bind(this));if(kc){this._zoomedImagePan(event);}else event.kill();};jc.prototype._zoomedImageMouseUp=function(event){"use strict";if(this._zoomedImageMouseMoveHandle){j.removeClass(this.stage,'showSlider');this._zoomedImageMouseMoveHandle.remove();this._zoomedImageMouseMoveHandle=null;var kc=parseFloat(bb.get(this.zoomedImage,'marginLeft')),lc=-this.zoomedImage.width+this.stage.clientWidth;this._previousZoomScrollPercent=kc/lc;}};jc.prototype._zoomedImagePan=function(event){"use strict";var kc;if(this.startSliderMargins){kc=event.clientX-this.mouseDownStartPosition.x;var lc=parseFloat(bb.get(this.outerImageSlider,'width')),mc=parseFloat(bb.get(this.innerImageSlider,'width')),nc=Math.max(0,Math.min(lc-mc,this.startSliderMargins.x+kc))/lc;bb.set(this.innerImageSlider,'marginLeft',100*nc+"%");bb.set(this.zoomedImage,'marginLeft',-1*nc*this.zoomedImage.width+'px');event.kill();}else if(this.startImageMargins){kc=1.75*(this.mouseDownStartPosition.x-event.clientX);var oc=Math.min(0,Math.max(this.startImageMargins.x-kc,-this.zoomedImage.width+this.stage.clientWidth));bb.set(this.zoomedImage,'marginLeft',oc+'px');bb.set(this.innerImageSlider,'marginLeft',(-oc/this.zoomedImage.width*100)+"%");event.kill();}};jc.prototype._scrollZoomedImageToPercent=function(kc){"use strict";if(kc===(void 0)||kc===null)kc=.5;var lc=new ib(parseInt(bb.get(this.zoomedImage,'width'),10),parseInt(bb.get(this.zoomedImage,'height'),10));bb.set(this.innerImageSlider,'marginLeft',((100-this._adjustInnerImageSlider(lc))*kc)+'%');bb.set(this.zoomedImage,'marginLeft',((this.stage.clientWidth-lc.x)*kc)+'px');};jc.prototype.switchVideo=function(kc,lc,mc){"use strict";this._pauseVideoIfNeeded();var nc='swf_'+kc;n.empty(this.videoStage);if(lc){j.addClass(this.stageWrapper,'showVideo');var oc=this.stream.getCurrentImageData();if(this.shouldRenderVideoPivots){j.hide(this.nextPager);j.hide(this.prevPager);}var pc=oc.video_element;n.find(pc,"._ox1").style.cssText='';var qc=null;if(this.pivotsCarouselElement)qc=o.scry(this.pivotsCarouselElement,"._32_l");if(qc)qc.forEach(function(uc){var vc=uc.getAttribute('data-fbid'),wc=this.stream.getCursor(),xc=n.find(uc,"._1pqn");if(vc===wc){j.show(xc);}else j.hide(xc);}.bind(this));j.addClass(pc,'videoStageContainer');n.appendContent(this.videoStage,pc);n.appendContent(this.videoStage,this.pivotsCarouselElement);if(window[nc]&&!tb(nc))window[nc].write(kc);var rc='video_warning_'+kc,sc=tb(kc);if(!this.videoWarnings)this.videoWarnings=[];if(sc&&this.videoWarnings[rc])n.setContent(sc,this.videoWarnings[rc]);this._videoPlayerStateManager=oc.controller;this._videoPlayerStateManager.reset();this._videoPlayerStateManager.collectFeedTrackingData();if(this._autoplayVideos){var tc=mc||kb.USER;this._videoPlayerStateManager.play(tc);}if(this._autoplayNextVideo)this._videoPlayerStateManager.addListener('finishPlayback',function(){var uc=oc.info.fbid.toString();if(this.haltAutoplay&&uc!==this.stream.fbidList[this.stream.fbidList.length-1]){if(this.autoplayOptionScreenConfig){var vc=this.autoplayOptionScreenConfig.controller;vc.registerCallbacks(pc,this.chooseToReplayVideo.bind(this,this._videoPlayerStateManager),this.handleAutoplay.bind(this,oc));}}else this.handleAutoplay(oc);}.bind(this));setTimeout(this.adjustStageSizeForVideo.bind(this,kc),0);}else{window[nc]&&window[nc].addVariable('video_autoplay',0);this.videoLoadTimer&&clearTimeout(this.videoLoadTimer);j.removeClass(this.stageWrapper,'showVideo');}};jc.prototype.removeAutoplayOptionScreen=function(){"use strict";if(this.autoplayOptionScreenConfig)this.autoplayOptionScreenConfig.controller.removeSelf();};jc.prototype.chooseToReplayVideo=function(kc){"use strict";kc.play(kb.USER);this.removeAutoplayOptionScreen();this.haltAutoplay=false;};jc.prototype.handleAutoplay=function(kc){"use strict";var lc=kc.info.fbid.toString();if(lc===this.stream.getCursor()&&lc!==this.stream.fbidList[this.stream.fbidList.length-1]){ya.adjustCarouselOnAutoPlay();this.page(1,false,kb.AUTOPLAY);}this.removeAutoplayOptionScreen();this.haltAutoplay=false;};jc.prototype.checkVideoStatus=function(kc){"use strict";if(this.videoLoadTimer)clearTimeout(this.videoLoadTimer);var lc=this.getVideoOnStage();if(!lc){return;}else{if(lc!==kc)return;this.adjustStageSizeForVideo(kc);}};jc.prototype.getVideoSize=function(kc){"use strict";return new ib(kc.getAttribute('data-video-width'),+kc.getAttribute('data-video-height')+this.getVideoComponentsHeight(kc));};jc.prototype.getVideoElement=function(kc){"use strict";return n.scry(this.videoStage,"._ox1")[0];};jc.prototype.getVideoComponentsHeight=function(kc){"use strict";var lc=0,mc=ga.byClass(kc,"_1c_u");if(!mc)return 0;var nc=n.scry(mc,"._2i84");if(nc.length){var oc=nc[0].getBoundingClientRect();lc=oc.bottom-oc.top;}return lc;};jc.prototype.adjustStageSizeForVideo=function(kc){"use strict";var lc=this.getVideoElement(kc);if(!lc){this.videoLoadTimer=setTimeout(this.checkVideoStatus.bind(this,kc),200);}else this.adjustStageSize(this.getVideoSize(lc));};jc.prototype.handleServerError=function(kc,lc){"use strict";n.setContent(this.errorBox,kc);this.storeFromData(lc);};jc.prototype.fixButtonText=function(kc){"use strict";if(!this.buttonTruncateGk)return;var lc=n.scry(kc,".photosTruncatingUIButton"),mc=parseInt(bb.get(kc,'width'),10);if(mc>ec){var nc={tagPhoto:r._("Tag Photo"),doneTagPhoto:r._("Done Tagging"),addLocation:r._("Add Location"),editPhoto:r._("Edit")};for(var oc=0;oc<lc.length;oc++){var pc=lc[oc];j.addClass(pc,"_2n0k");db.set(pc,nc[pc.getAttribute('data-buttonname')],'below','center');}}};jc.prototype.swapData=function(){"use strict";var kc,lc=this.stream.getCurrentHtml();if(lc){this.setLoadingState(jc.STATE_HTML,false);for(var mc in lc){kc=tb(mc);kc&&n.setContent(kc,lc[mc]);}var nc=tb('photosTruncatingUIButtonGroup');nc&&this.fixButtonText(nc);g.inform('PhotoSnowlift.DATA_CHANGE',Object.assign(this.stream.getCurrentImageData().info,{movement:this.movementDelta}),g.BEHAVIOR_STATE);this.movementDelta=0;if(this.stream.getCurrentExtraData())g.inform('PhotoSnowlift.EXTRA_DATA_CHANGE',this.stream.getCurrentExtraData(),g.BEHAVIOR_STATE);}this.adjustScroller();this.scrollableArea.showScrollbar(false);this.adjustForNewData();this.logImpressionDetailsForPhoto();};jc.prototype.updateTotalCount=function(kc,lc,mc){"use strict";var nc=this.stream.getCurrentHtml();if(nc){var oc=lb('fbPhotoSnowliftPositionAndCount');n.replace(oc,mc);oc=mc;j.show(oc);var pc='fbPhotoSnowliftPositionAndCount';nc[pc]=pb(oc.childNodes);}this.stream.setTotalCount(kc);this.stream.setFirstCursorIndex(lc);};jc.prototype.addPhotoFbids=function(kc,lc,mc,nc){"use strict";if(nc&&this.sessionID&&nc!=this.sessionID)return;var oc=this.stream.getCursor()===null;if(this.shouldRenderVideoPivots&&!this._videoSameAsSource)this.stream.fbidList=[];this.stream.attachToFbidsList(kc,lc,mc);if(mc&&oc)this.page(0,true);if(this.pivots&&mc)this.pivots.setCycleCount(this.stream.calculateDistance(this.stream.getCursor(),this.stream.firstCursor));if(!this.pagersShown&&this.stream.canPage())this.setStagePagersState('ready');if(!this.slideshowAvailable&&this.stream.canPage()){this.slideshowAvailable=true;j.addClass(this.root,'slideshowAvailable');}this.setLeftAndRightPagersState();if(this.shouldRenderVideoPivots&&!this._videoSameAsSource){var pc=this.stream.getCursor(),qc=this.stream.calculateDistance(pc,this._mediaFBID);this.stream.moveCursor(qc);}};jc.prototype.attachTagger=function(kc,lc){"use strict";n.appendContent(this.stageActions,kc);if(lc)lc.setTokenarea(this.taglist);};jc.prototype.storeFromData=function(kc){"use strict";if(!this.isOpen)return;if(kc.pivots)this.pivotsCarouselElement=kc.pivots;if(kc.autoplay_option_screen_config){this.autoplayOptionScreenConfig=kc.autoplay_option_screen_config;if(this.autoplayOptionScreenConfig&&this.autoplayOptionScreenConfig.enabled)this.addHaltAutoplaySubscription();}this.shouldRenderVideoPivots=kc.should_render_pivots;if(kc.ssid&&this.sessionID&&this.sessionID!=kc.ssid)return;var lc=this.stream.storeToCache(kc);if('error' in lc){this.checkState(jc.STATE_ERROR);return;}if('init' in kc){if(this.shouldRenderVideoPivots)this._videoSameAsSource=kc.init.videoSameAsSource;this._mediaFBID=kc.init.fbid;this._albumFBID=kc.init.album_fbid;this._isAlbum=kc.init.is_album;this._albumOwnerName=kc.init.album_owner_name;this._autoplayVideos=kc.init.autoplay_videos;this._autoplayNextVideo=kc.init.autoplay_next_video;}if('init' in lc){this.initDataFetched(lc.init);if(this.openExplicitly){this.replaceUrl=true;vb(this.stream.getCurrentImageData().info.permalink);}if(this.stream.canPage())this.setStagePagersState('ready');this.setLeftAndRightPagersState();}if('image' in lc)this.checkState(jc.STATE_IMAGE_DATA);if('data' in lc)this.checkState(jc.STATE_HTML);};jc.prototype.setLeftAndRightPagersState=function(){"use strict";if(this.stream.isNonCircularPhotoSet()){j.conditionClass(this.root,'disableLeft',!this.stream.nonCircularPhotoSetCanPage(-1));j.conditionClass(this.root,'disableRight',!this.stream.nonCircularPhotoSetCanPage(1));}if(this.snowflake){j.conditionClass(this.root,'disableLeft',this.stream.getCursor()==this.firstInSet);var kc=this.stream.getCursorAt(this.stream.calculatePositionForMovement(1));j.conditionClass(this.root,'disableRight',kc==this.firstInSet);}};jc.prototype.setStagePagersState=function(kc){"use strict";switch(kc){case 'ready':j.addClass(this.root,'pagingReady');this.pagersShown=true;this._setupNextItemUI();return;case 'active':j.addClass(this.root,'pagingActivated');return;case 'inactive':j.removeClass(this.root,'pagingActivated');return;case 'disabled':case 'reset':j.removeClass(this.root,'pagingReady');return;}};jc.prototype.deletePhoto=function(kc){"use strict";this.closeRefresh();};jc.prototype.closeRefresh=function(){"use strict";this.refreshOnClose=true;this.spotlight.hide();};jc.prototype.onHiliteTag=function(kc,lc){"use strict";if(lc.version!=ja.VIEWER_SNOWLIFT)return;var mc=lc.tag;if(mc)this.switchHilitedTags(mc,true);};jc.prototype.onUpdateTagBox=function(kc,lc){"use strict";if(lc.version==ja.VIEWER_SNOWLIFT)this.updateTagBox(lc.id,lc.approve);};jc.prototype._log=function(kc){"use strict";if(this._shouldLog){this._logger&&this._logger.log(kc);return true;}return false;};jc.prototype._enableMouseOver=function(){"use strict";this._disableMouseOver=false;};jc.prototype._interceptMouseOver=function(event){"use strict";if(this._disableMouseOver)event.kill();};jc.prototype.isReturningToStart=function(){"use strict";return !!this.returningToStart;};jc.prototype._pauseVideoIfNeeded=function(){"use strict";if(this._videoPlayerStateManager)this._videoPlayerStateManager.pause('unloaded');};jc.getInstance=function(){"use strict";if(!jc._instance)jc._instance=new jc();return jc._instance;};jc.initWithSpotlight=function(kc,lc){"use strict";jc.getInstance().init(kc,lc);};jc.addPhotoFbids=function(kc,lc,mc,nc){"use strict";jc.getInstance().addPhotoFbids(kc,lc,mc,nc);};jc.setReachedLeftEnd=function(){"use strict";jc.getInstance().setReachedLeftEnd();};jc.setReachedRightEnd=function(){"use strict";jc.getInstance().setReachedRightEnd();};jc.attachFollowFlyout=function(kc){"use strict";n.insertAfter(lb('fbPhotoSnowliftSubscribe'),kc);};jc.attachSubscribeFlyout=function(kc){"use strict";n.insertAfter(lb('fbPhotoSnowliftSubscribe'),kc);};jc.attachTagger=function(kc,lc){"use strict";jc.getInstance().attachTagger(kc,lc);};jc.preload=function(kc,lc){"use strict";jc.getInstance().preload(kc,lc);};jc.bootstrap=function(kc,lc){"use strict";var mc=kc&&new gb(kc).getQueryData();if(mc&&mc.hasOwnProperty('share_id')){i.loadModules(["SpotlightShareViewer"],function(nc){nc.bootstrap(kc,lc);});return;}jc.getInstance().bootstrap(kc,lc);};jc.closeRefresh=function(){"use strict";jc.getInstance().closeRefresh();};jc.deletePhoto=function(kc){"use strict";jc.getInstance().deletePhoto(kc);};jc.getImage=function(){"use strict";return jc.getInstance().getImage();};jc.getImageId=function(){"use strict";return jc.getInstance().getImageId();};jc.getLoadQuery=function(){"use strict";return jc.getInstance().getLoadQuery();};jc.getRHCBody=function(){"use strict";return jc.getInstance().getRHCBody();};jc.getRHCFooter=function(){"use strict";return jc.getInstance().getRHCFooter();};jc.getRHCHeader=function(){"use strict";return jc.getInstance().getRHCHeader();};jc.getRoot=function(){"use strict";return jc.getInstance().getRoot();};jc.likePhotoSkipConfirmation=function(kc){"use strict";jc.getInstance().likePhotoSkipConfirmation(kc);};jc.onCancelSaveRejectedLocation=function(event){"use strict";jc.getInstance().onCancelSaveRejectedLocation(event);};jc.saveTagsFromPayload=function(kc){"use strict";jc.getInstance().saveTagsFromPayload(kc);};jc.saveTagsFromPayloadDelayed=function(kc){"use strict";setTimeout(jc.saveTagsFromPayload.bind(null,kc),2000);};jc.handleServerError=function(kc,lc){"use strict";jc.getInstance().handleServerError(kc,lc);};jc.setVideoWarning=function(kc,lc){"use strict";var mc=jc.getInstance(),nc='video_warning_'+kc;if(!mc.videoWarnings)mc.videoWarnings=[];mc.videoWarnings[nc]=lc;};jc.storeFromData=function(kc){"use strict";jc.getInstance().storeFromData(kc);};jc.swapData=function(){"use strict";jc.getInstance().swapData();};jc.updateTotalCount=function(kc,lc,mc){"use strict";jc.getInstance().updateTotalCount(kc,lc,mc);};jc.setVideoRotateURI=function(kc){"use strict";jc.getInstance().videoRotateURI=kc;};Object.assign(jc,{STATE_ERROR:'error',STATE_HTML:'html',STATE_IMAGE_PIXELS:'image_pixels',STATE_IMAGE_DATA:'image',LOADING_TIMEOUT:2000,PAGER_FADE:3000,FULL_SCREEN_PADDING:10,STAGE_NORMAL_MAX:{x:960,y:960},STAGE_MIN:{x:520,y:520},COVER_PHOTO_BUTTON_WIDTH:130,PROFILE_PICTURE_BUTTON_WIDTH:140,SIDEBAR_SIZE_MAX:360,MIN_PANORAMA_Y:240,ZOOM_BUTTON_HEIGHT:52,ZOOM_BUTTON_BOT_PAD:60,ZOOM_BUTTON_TOP_PAD:16,MAX_SLIDER_HEIGHT:.075,MAX_SLIDER_WIDTH:.75,MIN_PANO_TO_STAGE_RATIO:1.2,STAGE_CHROME:{x:82,y:42},VIDEO_BOTTOM_BAR_SPACE:40,GOPREV_AREA:120,TIMELINE_STRETCH_WIDTH:843,TIMELINE_STRETCH_MIN:480,MIN_TAG_DISTANCE:83,PADDING_MIN:40,MIN_UFI_HEIGHT:250,COLLECTIONS_UNTAGGED_PHOTOS:3,PHOTOS_OF_YOU_SUGGESTIONS:28,FRIENDS_IN_PHOTOS_SUGGESTIONS:31,MIN_ADS_VISIBLE:1,PINNED_UFI_ADJUSTMENT:11,ADD_COMMENT_HEIGHT:54,SLIDESHOW_TIME:3000,_instance:null,touch:sb,touchMarkup:sb,PRODUCT_ITEM_PAGER_HILIGHT_DISTANCE:100,PRODUCT_ITEM_PAGER_HEIGHT_OFFSET:70,PRODUCT_ITEM_PAGER_HEIGHT:21,PRODUCT_ITEM_PAGER_MARGIN:20});Object.assign(jc.prototype,{switchTimer:null,imageRefreshTimer:null,imageLoadingTimer:null,lastPage:0,currentMinSize:null,currentImageSize:null,resetUriStack:true,thumbSrc:null,shouldStretch:false,stageMax:jc.STAGE_NORMAL_MAX,stageChrome:jc.STAGE_CHROME,stagePagerPrev:null,ua:null,PhotoTagger:null});e.exports=jc;},null);