/*!CK:3949879818!*//*1437526755,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["aSzxp"]); }

__d("MercuryActionStatus",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports={UNSENT:0,SUCCESS:1,UNCONFIRMED:3,FAILED_UNKNOWN_REASON:4,UNABLE_TO_CONFIRM:5,RESENT:6,RESENDING:7,ERROR:10};},null);
__d("MercuryActionType",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports={LOG_MESSAGE:"ma-type:log-message",USER_GENERATED_MESSAGE:"ma-type:user-generated-message",CHANGE_READ_STATUS:"ma-type:change_read_status",MARK_THREAD_SEEN:"ma-type:mark_thread_seen",CHANGE_MUTE_SETTINGS:"ma-type:change-mute-settings",SEND_MESSAGE:"ma-type:send-message",UPDATE_ACTION_ID:"ma-type:update-action-id",DELETE_MESSAGES:"ma-type:delete-messages",MARK_MESSAGES_SPAM:"ma-type:mark-messages-spam",DELETE_THREAD:"ma-type:delete-thread",CHANGE_ARCHIVED_STATUS:"ma-type:change-archived-status",CHANGE_FOLDER:"ma-type:change-folder",ADD_PARTICIPANTS:"ma-type:add-participants",CANCEL_ATTACHMENT_PLACEHOLDER:"ma-type:cancel-attachment-placeholder",CONFIRM_ATTACHMENT_PLACEHOLDER:"ma-type:confirm-attachment-placeholder",UNPIN_THREAD:"ma-type:unpin-thread",CHANGE_FLAG:"ma-type:change_flag",MOVE_PENDING_TO_INBOX:"ma-type:move_pending_to_inbox",UPDATE_BLOCKER_STATUS:"ma-type:update-blocker-status",UPDATE_BLOCKEE_STATUS:"ma-type:update-blockee-status"};},null);
__d("MercuryAPIArgsSource",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports={CHAT:"chat",JEWEL:"jewel",MERCURY:"mercury",MERCURYSYNC:"mercury_sync",WEBMESSENGER:"web_messenger",MESSENGER:"messenger"};},null);
__d("MercuryAttachmentContentType",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports={PHOTO:"attach:image",VIDEO:"attach:video",MUSIC:"attach:music",VOICE:"attach:voice",TEXT:"attach:text",MSWORD:"attach:ms:word",MSXLS:"attach:ms:xls",MSPPT:"attach:ms:ppt",ORION:"attach:orion",SHOERACK_INVITATION:"attach:shoerackinvite",UNKNOWN:"attach:unknown"};},null);
__d("MercuryAttachmentType",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports={ERROR:"error",FILE:"file",PHOTO:"photo",STICKER:"sticker",SHARE:"share",UNKNOWN:"unknown",VIDEO:"video",ANIMATED_IMAGE:"animated_image"};},null);
__d("MercuryAudioType",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports={AudioClip:"fb_voice_message",VoiceMessageWithTranscript:"fb_voice_message_with_transcript"};},null);
__d("MercuryErrorType",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports={SERVER:1,TRANSPORT:2,TIMEOUT:3};},null);
__d("MercuryGlobalActionType",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports={MARK_ALL_READ:"mga-type:mark-all-read"};},null);
__d("MercuryLogMessageType",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports={SUBSCRIBE:"log:subscribe",UNSUBSCRIBE:"log:unsubscribe",VIDEO_CALL:"log:video-call",PHONE_CALL:"log:phone-call",THREAD_NAME:"log:thread-name",THREAD_IMAGE:"log:thread-image",SERVER_ERROR:"log:error-msg",LIVE_LISTEN:"log:live-listen",WALLPAPER:"log:wallpaper",ORION:"log:orion",SWITCH_TO_WORK:"log:switch",PAGE_REPLY:"log:page-reply",GENERIC_ADMIN_TEXT:"log:generic-admin-text"};},null);
__d("MercuryMessageSourceTags",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports={CHAT:"source:chat",EMAIL:"source:email",MESSENGER:"source:messenger",MOBILE:"source:mobile"};},null);
__d("MercuryParticipantTypes",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports={USER:"user",THREAD:"thread",EVENT:"event",PAGE:"page",FRIEND:"friend",FB4C:"fb4c",NON_FRIEND:"non_friend"};},null);
__d("MercuryPayloadSource",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports={UNKNOWN:"unknown",CLIENT_CHANNEL_MESSAGE:"client_channel_message",CLIENT_SEND_MESSAGE:"client_send_message",CLIENT_CHANGE_ARCHIVED_STATUS:"client_change-archived_status",CLIENT_CHANGE_FOLDER:"client_change_folder",CLIENT_CHANGE_MUTE_SETTINGS:"client_change_mute_settings",CLIENT_CHANGE_READ_STATUS:"client_change_read_status",CLIENT_MARK_THREAD_SEEN:"client_mark_thread_seen",CLIENT_ADD_PARTICIPANTS:"client_add_participants",CLIENT_FETCH_PARTICIPANTS:"client_fetch_participants",CLIENT_DELETE_MESSAGES:"client_delete_messages",CLIENT_MARK_MESSAGES_SPAM:"client_mark_messages_spam",CLIENT_DELETE_THREAD:"client_delete_thread",CLIENT_HANDLE_ERROR:"client_handle_error",CLIENT_UNPIN_THREAD:"client_unpin_thread",CLIENT_CHANGE_FLAG:"client_change_flag",CLIENT_MOVE_PENDING_TO_INBOX:"client_move_pending_to_inbox",SERVER_INITIAL_DATA:"server_initial_data",SERVER_SEND_MESSAGE:"server_send_message",SERVER_CHANGE_ARCHIVED_STATUS:"server_change_archived_status",SERVER_CHANGE_READ_STATUS:"server_change_read_status",SERVER_MARK_FOLDER_READ:"server_mark_folder_read",SERVER_MARK_SEEN:"server_mark_seen",SERVER_FETCH_PARTICIPANTS:"server_fetch_participants",SERVER_FETCH_THREAD_INFO:"server_fetch_thread_info",SERVER_FETCH_THREADLIST_INFO:"server_fetch_threadlist_info",SERVER_STANDALONE_NOTIFICATIONS:"server_standalone_notifications",SERVER_THREAD_SYNC:"server_thread_sync",SERVER_TAB_PRESENCE:"server_tab_presence",SERVER_UNREAD_THREADS:"server_unread_threads",SERVER_SEARCH:"server_search",SERVER_CHANGE_FLAG:"server_change_flag"};},null);
__d("MercurySourceType",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports={CHAT_ORCA:"source:chat:orca",CHAT_IPHONE:"source:chat:iphone",CHAT_JABBER:"source:chat:jabber",CHAT_MEEBO:"source:chat:meebo",CHAT_WEB:"source:chat:web",CHAT_TEST:"source:chat:test",CHAT_FORWARD_DIALOG:"source:chat:forward",CHAT:"source:chat",EMAIL:"source:email",EVENT_MESSAGE_BLAST:"source:event_message_blast",GIGABOXX_API:"source:gigaboxx:api",GIGABOXX_BLAST:"source:gigaboxx:blast",GIGABOXX_EMAIL_REPLY:"source:gigaboxx:emailreply",GIGABOXX_MOBILE:"source:gigaboxx:mobile",GIGABOXX_WAP:"source:gigaboxx:wap",GIGABOXX_WEB:"source:gigaboxx:web",LEIA:"source:leia",MESSENGER_WEB:"source:messenger:web",SAM_UFI:"source:sam:ufi",SHARE_DIALOG:"source:share:dialog",SEND_PLUGIN:"source:sendplugin",SMS:"source:sms",TEST:"source:test",TITAN_WAP:"source:titan:wap",TITAN_M_BASIC:"source:titan:m_basic",TITAN_M_FREE:"source:titan:m_free_basic",TITAN_M_JAPAN:"source:titan:m_japan",TITAN_M_MINI:"source:titan:m_mini",TITAN_M_TOUCH:"source:titan:m_touch",TITAN_M_APP:"source:titan:m_app",TITAN_M_TABLET:"source:titan:m_tablet",TITAN_M_ZERO:"source:titan:m_zero",TITAN_M_TALK:"source:titan:m_talk",TITAN_WEB:"source:titan:web",TITAN_FACEWEB_ANDROID:"source:titan:faceweb_android",TITAN_FACEWEB_BUFFY:"source:titan:faceweb_buffy",TITAN_FACEWEB_IPAD:"source:titan:faceweb_ipad",TITAN_FACEWEB_IPHONE:"source:titan:faceweb_iphone",TITAN_FACEWEB_UNKNOWN:"source:titan:faceweb_unknown",TITAN_API:"source:titan:api",TITAN_API_MOBILE:"source:titan:api_mobile",TITAN_ORCA:"source:titan:orca",TITAN_EMAIL_REPLY:"source:titan:emailreply",MOBILE:"source:mobile",PAGE_PLATFORM_API:"source:page_platform_api",UNKNOWN:"source:unknown",WEB:"source:web",HELPCENTER:"source:helpcenter",NEW_SHARE_DIALOG:"source:share:dialog:new",PAID_PROMOTION:"source:paid_promotion",BUFFY_SMS:"source:buffy:sms",WEBRTC_MOBILE:"source:webrtc:mobile",MESSENGER_COMMERCE:"source:messenger:commerce"};},null);
__d("MercuryThreadMode",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports={EMAIL_ORIGINATED:1,TITAN_ORIGINATED:2,OBJECT_ORIGINATED:3};},null);
__d("MercuryTimePassed",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports={TODAY:0,WEEK_AGO:1,MONTH_AGO:2,CURRENT_YEAR:3,OTHER_YEAR:4};},null);
__d("MessagingEvent",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports={DELETE:"delete",DELETE_MESSAGES:"delete_messages",DELIVER:"deliver",ERROR:"error",READ:"read",REPORT_SPAM:"report_spam",REPORT_SPAM_MESSAGES:"report_spam_messages",UNMARK_SPAM:"unmark_spam",SUBSCRIBE:"subscribe",CHANGE_MUTE_SETTINGS:"change_mute_settings",TAG:"tag",UNREAD:"unread",UNSUBSCRIBE:"unsubscribe",DELIVER_LOG:"deliver_log",MORE_THREADS:"more_threads",READ_ALL:"read_all",READ_RECEIPT:"read_receipt",DELIVERY_RECEIPT:"delivery_receipt",SENT_PUSH:"sent_push",DELIVER_FAST_PAST:"deliver_fast_path",MESSENGER_STATUS:"messenger_status",UPDATE_PINNED_THREADS:"update_pinned_threads",CHANGE_PAGE_THREAD_FLAG:"change_page_thread_flag",UPDATE_BLOCKER_STATUS:"update_blocker_status",UPDATE_BLOCKEE_STATUS:"update_blockee_status"};},null);
__d("MessagingTag",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports={GROUPS:"groups",UNREAD:"unread",FLAGGED:"flagged",ACTION_ARCHIVED:"action:archived",INBOX:"inbox",OTHER:"other",PENDING:"pending",EVENT:"event",SENT:"sent",SMS_MUTE:"sms_mute",SPAM:"spam",UPDATES:"broadcasts_inbox",BCC:"header:bcc",FILTERED_CONTENT:"filtered_content",FILTERED_CONTENT_BH:"filtered_content_bh",FILTERED_CONTENT_ACCOUNT:"filtered_content_account",UNAVAILABLE_ATTACHMENT:"unavailable_attachment",ARCHIVED:"archived",EMAIL:"email",VOICEMAIL:"voicemail",SPAM_SPOOFING:"spam:spoofing",SPOOF_WARNING:"MTA:spoof_warning",SMS_TAG_ROOT:"SMSShortcode:",APP_ID_ROOT:"app_id:",DOMAIN_AUTH_PASS:"MTA:dmarc:pass",DOMAIN_AUTH_FAIL:"MTA:dmarc:fail",MTA_SYSTEM_MESSAGE:"MTA:system_message",EMAIL_MESSAGE:"source:email"};},null);
__d("PageMessageEnumTag",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports={FLAG:"flag",LOW_VALUE:"low_value"};},null);
__d("ChatImpressionLogger",["AsyncSignal","requireWeak","ChatConfig","ChatVisibility","Poller","PresencePrivacy","PresenceStatus","debounceAcrossTransitions"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){b.__markCompiled&&b.__markCompiled();var o=null;h('AvailableList',function(u){return o=u;});var p=null;function q(){if(!p)return '';return p.getCachedSortedList().toString();}function r(){if(!p||!o)return '';var u=[],v=p.getCachedSortedList();for(var w=0;w<v.length;w++)u[w]=o.get(v[w]);return u.toString();}function s(u){u.setURI('/ajax/chat/imps_logging.php').setData({list_availability:r(),sorted_list:q(),source:'periodical_imps'});}var t={init:function(u){p=u;var v=i.get('chat_impression_logging_periodical',0);if(v){var w=i.get('periodical_impression_logging_config.interval'),x=new k({interval:w,setupRequest:s,clearOnQuicklingEvents:false,dontStart:true});l.subscribe('privacy-user-presence-changed',n(function(){if(j.isOnline()){x.start();}else x.stop();}));}this.init=function(){};},logImpression:function(u,v,w){var x=i.get('chat_impression_logging_with_click'),y={list_availability:x?r():'',sorted_list:x?q():'',source:u,target:v,target_presence:m.get(v),viewport_width:document.body.clientWidth};new g('/ajax/chat/ct.php',Object.assign(y,w)).send();}};e.exports=t;},null);
__d("ChatWelcomeMessage",["ImmutableObject"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();'use strict';function h(){this.$ChatWelcomeMessage0={};}h.prototype.setWelcomeMessage=function(j,k,l){this.$ChatWelcomeMessage0[j]=new g({timestamp:Date.now(),thread_id:j,author:k,body:l});};h.prototype.getWelcomeMessage=function(j){return this.$ChatWelcomeMessage0[j];};var i=new h();e.exports=i;},null);
__d("MercuryIDs",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();var g={isValid:function(h){if(!h||typeof h!=='string')return false;return (/^\w{3,12}:/.test(h));},isValidThreadID:function(h){if(!g.isValid(h))return false;var i=g.tokenize(h);switch(i.type){case 'user':case 'group':case 'thread':case 'root':case 'pending':return true;default:return false;}},tokenize:function(h){if(!this.isValid(h))throw ("bad_id_format "+h);var i=h.indexOf(':');return {type:h.substr(0,i),value:h.substr(i+1)};},getUserIDFromParticipantID:function(h){if(!this.isValid(h))throw ("bad_id_format "+h);var i=g.tokenize(h),j=i.type,k=i.value;if(j!='fbid')return null;return k;},getParticipantIDFromUserID:function(h){if(isNaN(h))throw ("Not a user ID: "+h);return 'fbid:'+h;},getUserIDFromThreadID:function(h){if(!this.isCanonical(h))return null;return this.tokenize(h).value;},getThreadIDFromUserID:function(h){return 'user:'+h;},getThreadIDFromParticipantID:function(h){var i=this.getUserIDFromParticipantID(h);return i?this.getThreadIDFromUserID(i):null;},getParticipantIDFromFromThreadID:function(h){return this.getParticipantIDFromUserID(this.getUserIDFromThreadID(h)||'');},isCanonical:function(h){return this.isValid(h)&&this.tokenize(h).type==='user';},isGroupChat:function(h){return this.isValid(h)&&this.tokenize(h).type!=='user';}};e.exports=g;},null);
__d("MercuryAssert",["MercuryIDs"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();e.exports={isParticipantID:function(h){if(!g.isValid(h))throw ("bad_participant_id "+h);},allParticipantIDs:function(h){h.forEach(this.isParticipantID);},isUserParticipantID:function(h){var i=g.tokenize(h);if(i.type!='fbid')throw ("bad_user_id "+h);},isEmailParticipantID:function(h){var i=g.tokenize(h);if(i.type!='email')throw ("bad_email_id "+h);},allThreadID:function(h){h.forEach(this.isThreadID);},isThreadID:function(h){if(!g.isValid(h))throw ("bad_thread_id "+h);}};},null);
__d("MercuryAttachment",["MercuryAttachmentContentType","MercuryAttachmentType","MercuryAudioType"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();'use strict';var j={getAttachIconClass:function(k){switch(k){case g.PHOTO:return 'MercuryPhotoIcon';case g.VIDEO:return 'MercuryVideoIcon';case g.MUSIC:return 'MercuryMusicIcon';case g.VOICE:return 'MercuryVoiceIcon';case g.TEXT:return 'MercuryTextIcon';case g.MSWORD:return 'MercuryMSWordIcon';case g.MSXLS:return 'MercuryMSXLSIcon';case g.MSPPT:return 'MercuryMSPPTIcon';}return 'MercuryDefaultIcon';},getAttachIconClassByMime:function(k){if(k.startsWith('image')){return 'MercuryPhotoIcon';}else if(k.startsWith('video')){return 'MercuryVideoIcon';}else if(k.startsWith('audio')){return 'MercuryMusicIcon';}else if(k.startsWith('text/plain')){return 'MercuryTextIcon';}else return 'MercuryDefaultIcon';},getAttachTypeByMime:function(k){if(k.startsWith('image')){return g.PHOTO;}else if(k.startsWith('video')){return g.VIDEO;}else if(k.startsWith('audio')){return g.MUSIC;}else if(k.startsWith('text/plain')){return g.TEXT;}else return g.UNKNOWN;},convertRaw:function(k){var l=[];for(var m=0;m<k.length;m++){var n=k[m];if(n.attach_type===h.PHOTO){l.push(n);}else if(n.filename){var o=j.getAttachTypeByMime(n.filetype),p={};p.attach_type=h.FILE;p.name=n.filename;p.icon_type=o;p.url='';l.push(p);}}return l;},get:function(k){var l=[];if(k.attachments){l=k.attachments;}else if(k.raw_attachments)l=this.convertRaw(k.raw_attachments);if(!(k.attachments&&k.attachments.length>0)){if(k.sticker_id)return l.concat([{attach_type:h.STICKER}]);if(k.preview_attachments&&k.preview_attachments.length>0)return l.concat(k.preview_attachments);}return l;},resizeContain:function(k,l){var m=k.width/k.height,n=l.width/l.height;if(n<m){return {width:Math.ceil(Math.min(k.height*n,l.width)),height:Math.ceil(Math.min(k.height,l.height))};}else return {width:Math.ceil(Math.min(k.width,l.width)),height:Math.ceil(Math.min(k.width/n,l.height))};},isBubblePreferred:function(k){return !this.isStickerAttachment(k);},isPhotoAttachment:function(k){return !!(k.attach_type==h.PHOTO||k.attach_type==h.ANIMATED_IMAGE||(k.attach_type==h.FILE&&k.preview_url));},isVideoAttachment:function(k){return k.attach_type==h.VIDEO;},isShareAttachment:function(k){return k.attach_type==h.SHARE;},isFileAttachment:function(k){return k.attach_type==h.FILE;},isErrorAttachment:function(k){return k.attach_type==h.ERROR;},isStickerAttachment:function(k){return k.attach_type==h.STICKER;},isVoiceAttachment:function(k){if(!k.metadata)return false;return (k.metadata.type===i.AudioClip||k.metadata.type===i.VoiceMessageWithTranscript);},hasAttribution:function(k){return !!(k.metadata&&k.metadata.app_attribution);}};e.exports=j;},null);
__d("MercurySingletonMixin",["CurrentUser"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();var h={_getInstances:function(){if(!this._instances)this._instances={};return this._instances;},get:function(){return this.getForFBID(g.getID());},getForFBID:function(i){var j=this._getInstances();if(!j[i])j[i]=new this(i);return j[i];}};e.exports=h;},null);
__d("MercuryMessageClientState",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();var g={DO_NOT_SEND_TO_SERVER:'do_not_send_to_server',SEND_TO_SERVER:'send_to_server'};e.exports=g;},null);
__d("MercurySendErrorLogger",["Banzai","BanzaiLogger"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();var i=h.create({retry:true}),j=g.isEnabled('mercury_send_error_logging'),k={log:function(l){if(!j)return;var m={message_id:l.message_id,timestamp_client:Date.now(),error_type:l.error_data.type,error_code:l.error_data.code,error_description:l.error_data.description,is_transient:l.error_data.is_transient};i.log('MercurySendErrorLoggerConfig',m);}};e.exports=k;},null);
__d("MercuryServerPayloadPreprocessor",["MercuryIDs","MercuryActionStatus","MercuryActionType","MercuryDispatcher","MercurySendErrorLogger","MercurySingletonMixin","MercuryThreadIDMap","invariant"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){b.__markCompiled&&b.__markCompiled();'use strict';function o(p){this.$MercuryServerPayloadPreprocessor0=p;this.$MercuryServerPayloadPreprocessor1=m.getForFBID(this.$MercuryServerPayloadPreprocessor0);this.$MercuryServerPayloadPreprocessor2=j.getForFBID(this.$MercuryServerPayloadPreprocessor0);}o.prototype.handleUpdate=function(p){var q,r,s,t={};n(!p.from_client);(p.threads||[]).forEach(function(ha){this.$MercuryServerPayloadPreprocessor3(ha,t);var ia=this.$MercuryServerPayloadPreprocessor1.getFBIDFromClientIDNow(ha.thread_id);d(['MercuryServerRequests'],function(ja){var ka=ja.getForFBID(this.$MercuryServerPayloadPreprocessor0);ka.markThreadFetched(ha.thread_id);ka.markThreadFetched(ia);ka.updateLastActionTimestamp(ha.timestamp);}.bind(this));}.bind(this));(p.ordered_threadlists||[]).forEach(function(ha){var ia=ha.thread_fbids||[];ia=ia.concat(ha.other_user_fbids||[]);ha.thread_ids=ia.map(function(ja){return this.$MercuryServerPayloadPreprocessor1.getClientIDFromFBIDNow(ja);}.bind(this));}.bind(this));if(p.pinned_threads&&p.pinned_threads.thread_fbids)p.pinned_threads.thread_fbids=p.pinned_threads.thread_fbids.map(function(ha){return this.$MercuryServerPayloadPreprocessor1.getClientIDFromFBIDNow(ha);}.bind(this));if(p.delivery_receipts){var u={},v;for(q=p.delivery_receipts,r=Array.isArray(q),s=0,q=r?q:q[typeof Symbol=="function"?Symbol.iterator:"@@iterator"]();;){if(r){if(s>=q.length)break;v=q[s++];}else{s=q.next();if(s.done)break;v=s.value;}var w=v.other_user_fbid?g.getThreadIDFromUserID(v.other_user_fbid):this.$MercuryServerPayloadPreprocessor1.getClientIDFromFBIDNow(v.thread_fbid);u[w]=v.time;}p.delivery_receipts=u;}p.actions=p.actions||[];p.actions.forEach(function(ha){if(ha.action_type===i.SEND_MESSAGE&&ha.status===h.ERROR)k.log(ha);var ia=ha.thread_fbid;if(ha.other_user_fbid)ia=ha.other_user_fbid;if(ha.status&&ha.status!=h.SUCCESS&&!ia){ha.thread_id=ha.client_thread_id;return;}if(ha.action_type==i.SEND_MESSAGE&&ha.client_thread_id&&ia){var ja=ia.toString(),ka=ha.client_thread_id;this.$MercuryServerPayloadPreprocessor1.setClientIDToFBID(ka,ja);t[ja]=ka;}var la=ha.thread_id;if(ia){ha.thread_id=this.$MercuryServerPayloadPreprocessor1.hasClientIDForFBID(ia)?this.$MercuryServerPayloadPreprocessor1.getClientIDFromFBIDNow(ia):null;}else if(ha.client_thread_id)ha.thread_id=ha.client_thread_id;if(!ha.thread_id)ha.server_thread_id=la;if(!p.payload_source||!p.payload_source.startsWith('server'))d(['MercuryServerRequests'],function(ma){ma.getForFBID(this.$MercuryServerPayloadPreprocessor0).updateLastActionTimestamp(ha.timestamp);}.bind(this));}.bind(this));if(p.end_of_history){var x=[];for(var y=0;y<p.end_of_history.length;y++){var z=p.end_of_history[y];if(z.type=='user'){x.push('user:'+z.fbid);}else if(z.type=='thread'&&this.$MercuryServerPayloadPreprocessor1.hasClientIDForFBID(z.fbid))x.push(this.$MercuryServerPayloadPreprocessor1.getClientIDFromFBIDNow(z.fbid));}p.end_of_history=x;}if(p.roger){var aa={};for(var ba in p.roger){var ca=Object.keys(p.roger[ba]),da;if(ba){da=this.$MercuryServerPayloadPreprocessor1.getClientIDFromFBIDNow(ba);}else if(ca.length===1)da=g.getThreadIDFromUserID(ca[0]);if(da){var ea=p.roger[ba];aa[da]={};for(var fa in ea)if(ea.hasOwnProperty(fa)){var ga=g.getParticipantIDFromUserID(fa);aa[da][ga]=ea[fa];}}}p.roger=aa;}p.newlyAddedClientIDs=t;p.preprocessed=true;this.$MercuryServerPayloadPreprocessor2.handleUpdate(p);};o.prototype.$MercuryServerPayloadPreprocessor3=function(p,q){var r=p.thread_fbid;if(p.canonical_fbid)r=p.canonical_fbid;var s=this.$MercuryServerPayloadPreprocessor1.getClientIDFromFBIDNow(r);if(!s){if(p.canonical_fbid){s='user:'+p.canonical_fbid;}else if(p.root_message_threading_id)s='root:'+p.root_message_threading_id;s=s||'thread:'+r;if(r)r=r.toString();this.$MercuryServerPayloadPreprocessor1.setClientIDToFBID(s,r);q[r]=s;if(p.thread_id){this.$MercuryServerPayloadPreprocessor1.setServerToClientID(p.thread_id,s);q[p.thread_id]=s;}}p.thread_id=s;};Object.assign(o,l);e.exports=o;},null);
__d("MercuryServerSendMessageQueueSimulatedError",["AsyncRequest","AsyncResponse"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();var i=9999,j={create:function(k){var l=new g(this.endpoint_uri).setData({message_batch:[k],client:this.client}),m=new h(l,{});Object.assign(m,{error:i,silentError:false,transientError:true,request:l});return m;}};e.exports=j;},null);
__d("MercuryServerSendMessageQueue",["BanzaiODS","LogHistory","MercuryLoggingHelper","MercuryServerRequestsConfig","MercuryServerDispatcher","MercuryServerSendMessageQueueSimulatedError"],function(a,b,c,d,e,f,g,h,i,j,k,l){b.__markCompiled&&b.__markCompiled();var m='/ajax/mercury/send_messages.php',n=h.getInstance('mercury_server_send_message_queue');function o(p,q,r,s){"use strict";this.sender_id=p;this.queue_id=q;this.$MercuryServerSendMessageQueue0=r.success_handler;this.$MercuryServerSendMessageQueue1=r.error_handler;this.$MercuryServerSendMessageQueue2=r.transport_error_handler;this.$MercuryServerSendMessageQueue3=r.timeout_handler;this.client=s;var t=null;if(j.msgrRegion)t={name:'X-MSGR-Region',value:j.msgrRegion};var u={};u[m]={request_user_id:this.sender_id,endpoint_id:this.queue_id,mode:k.IMMEDIATE,customHeader:t,handler:this.handleSuccess.bind(this),error_handler:this.handleError.bind(this),transport_error_handler:this.handleTransportError.bind(this),timeout:r.timeout,timeout_handler:this.handleTimeout.bind(this),connection_retries:r.connection_retries};k.registerEndpoints(u);this.pending_message=null;this.queue=[];}o.prototype.enqueue=function(p){"use strict";this.queue.push(p);this.$MercuryServerSendMessageQueue5();};o.prototype.$MercuryServerSendMessageQueue5=function(){"use strict";if(this.pending_message||!this.queue.length){if(this.pending_message)this.$MercuryServerSendMessageQueue6();return;}this.pending_message=this.queue.shift();k.trySend(m,{message_batch:[this.pending_message],client:this.client},null,this.sender_id,this.queue_id);};o.prototype.$MercuryServerSendMessageQueue7=function(){"use strict";while(this.queue.length)this.$MercuryServerSendMessageQueue8(this.queue.shift());};o.prototype.$MercuryServerSendMessageQueue8=function(p){"use strict";this.$MercuryServerSendMessageQueue1(l.create(p));n.error('mark_as_failed',{fbid:this.sender_id,queue_id:this.queue_id,message:i.obfuscateMessage(p)});};o.prototype.handleSuccess=function(p,q){"use strict";this.$MercuryServerSendMessageQueue0(p,q);this.pending_message=null;this.$MercuryServerSendMessageQueue5();};o.prototype.handleError=function(p){"use strict";this.$MercuryServerSendMessageQueue1(p);this.$MercuryServerSendMessageQueue7();this.pending_message=null;};o.prototype.handleTransportError=function(p){"use strict";this.$MercuryServerSendMessageQueue2(p);this.$MercuryServerSendMessageQueue7();this.pending_message=null;};o.prototype.handleTimeout=function(p){"use strict";this.$MercuryServerSendMessageQueue3(p);this.$MercuryServerSendMessageQueue7();this.pending_message=null;};o.prototype.$MercuryServerSendMessageQueue6=function(){"use strict";n.debug('maybe_send_next_pending_message',{fbid:this.sender_id,queue_id:this.queue_id,pending_message:i.obfuscateMessage(this.pending_message),queue:this.queue.map(function(q){return i.obfuscateMessage(q);})});var p='send_queue.delayed.queue_length.'+this.queue.length.toString();g.bumpEntityKey('chat.web',p);};e.exports=o;},null);
__d("MercuryServerSendMessageQueueRouter",["BanzaiODS","LogHistory","Map","MercuryServerSendMessageQueue","MercurySingletonMixin"],function(a,b,c,d,e,f,g,h,i,j,k){b.__markCompiled&&b.__markCompiled();var l=h.getInstance('mercury_server_send_message_queue_router'),m='chat.web.send_queue_router';g.setEntitySample(m,.1);function n(o){"use strict";this.fbid=o;this.queues=new i();}n.prototype.enqueue=function(o,p,q,r){"use strict";if(!this.queues.has(o)){this.queues.set(o,new j(this.fbid,o,p,q));l.debug('added queue',{fbid:this.fbid,queue_id:o});g.bumpEntityKey(m,'new_queue');}this.queues.get(o).enqueue(r);};Object.assign(n,k);e.exports=n;},null);
__d("FBID",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();'use strict';var g={isUser:function(h){return h<2.2e+09||(h>=1e+14&&h<=100099999989999)||(h>=8.9e+13&&h<=89999999999999)||(h>=6.000001e+13&&h<=60000019999999);}};e.exports=g;},null);
__d("PagesMessengerThreadUtils",["PageMessageEnumTag"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();var h={isFlagThread:function(i){if(!i)return false;return i.page_thread_info?i.page_thread_info.flagged:false;},isPageSpecficFilter:function(i){if(i===g.FLAG)return true;return false;}};e.exports=h;},null);
__d("MercuryPageServerRequests",["MercuryAPIArgsSource","MercuryAssert","MercuryServerRequests","PageMessageEnumTag","PagesMessengerThreadUtils","MercuryServerDispatcher"],function(a,b,c,d,e,f,g,h,i,j,k,l){b.__markCompiled&&b.__markCompiled();var m=g.MERCURY;for(var n in i)if(i.hasOwnProperty(n))p[n]=i[n];var o=i===null?null:i.prototype;p.prototype=Object.create(o);p.prototype.constructor=p;p.__superConstructor__=i;function p(q){"use strict";i.call(this,q);var r={'/pages/messaging/thread_tag/add/':{request_user_id:q,mode:l.BATCH_SUCCESSIVE,batch_function:this.$MercuryPageServerRequests0,handler:function(s,t){return this.__handleUpdate(s,t);}.bind(this)},'/pages/messaging/thread_tag/remove/':{request_user_id:q,mode:l.BATCH_SUCCESSIVE,batch_function:this.$MercuryPageServerRequests0,handler:function(s,t){return this.__handleUpdate(s,t);}.bind(this)},'/pages/messaging/thread_tag/list/':{request_user_id:q,mode:l.IMMEDIATE,handler:function(s,t){return this.__handleUpdate(s,t);}.bind(this)}};l.registerEndpoints(r);}p.prototype.$MercuryPageServerRequests0=function(q,r){"use strict";var s=q?q.tag_name:r.tag_name,t=q?q.thread_ids:[],u=r?r.thread_ids:[],v=t.concat(u),w={tag_name:s,thread_ids:v};return w;};p.prototype.addThreadFlag=function(q,r){"use strict";h.isThreadID(q);this.__threadIDMap.getFBIDFromClientID(q,function(s){var t={thread_ids:[s],tag_name:j.FLAG};this.__sendRequest('/pages/messaging/thread_tag/add/',t);}.bind(this));};p.prototype.fetchThreadlistInfo=function(q,r,s,t,u){"use strict";if(k.isPageSpecficFilter(t)){u=u||m;var v={folder:s,tag_name:t,offset:q,limit:r};this.__sendRequest('/pages/messaging/thread_tag/list/',v);return;}o.fetchThreadlistInfo.call(this,q,r,s,t,u);};p.prototype.removeThreadFlag=function(q,r){"use strict";h.isThreadID(q);this.__threadIDMap.getFBIDFromClientID(q,function(s){var t={thread_ids:[s],tag_name:j.FLAG};this.__sendRequest('/pages/messaging/thread_tag/remove/',t);}.bind(this));};p.prototype.toString=function(){"use strict";return 'MercuryPageServerRequests';};e.exports=p;},null);
__d("MercuryServerRequestSingletonMixin",["CurrentUser","FBID"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();var i={_getInstances:function(){if(!this._instances)this._instances={};return this._instances;},get:function(){return this.getForFBID(g.getID());},getForFBID:function(j){var k=this._getInstances();if(!k[j])if(h.isUser(j)){k[j]=new this(j);}else{var l;d(['MercuryPageServerRequests'],function(m){l=new m(j);});k[j]=l;}return k[j];}};e.exports=i;},null);
__d("MercuryMessageIDs",["KeyedCallbackManager"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();var h=new g(),i={getServerIDs:function(j,k){var l=j.filter(function(n){return n.indexOf('id')===-1;}),m=function(n){var o=j.map(function(p){return n[p]?n[p]:p;});k(o);};return h.executeOrEnqueue(l,m);},addServerID:function(j,k){h.setResource(j,k);}};e.exports=i;},null);
__d("MercuryServerSendMessageQueueOptions",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();function g(h,i,j,k,l,m){"use strict";this.success_handler=h;this.error_handler=i;this.transport_error_handler=j;this.timeout_handler=k;this.timeout=l;this.connection_retries=m;}e.exports=g;},null);
__d("XNotificationsSettingsDialogController",["XController"],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports=b("XController").create("\/notifications\/settings\/dialog\/",{thread_key_id:{type:"String",required:true},__asyncDialog:{type:"Int"}});},null);
__d("XModifyNotificationSettingsController",["XController"],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports=b("XController").create("\/notifications\/settings\/modify\/",{thread_key_id:{type:"String",required:true},quiet_hours_start:{type:"Int",required:true},quiet_hours_end:{type:"Int",required:true}});},null);
__d("MercuryServerRequests",["Arbiter","AsyncResponse","ChannelConstants","CurrentUser","LogHistory","MercuryActionStatus","MercuryActionType","MercuryAPIArgsSource","MercuryAssert","MercuryDispatcher","MercuryThreadIDMap","MercuryErrorType","MercuryGlobalActionType","MercuryIDs","MercuryLogMessageType","MercuryMessageClientState","MercuryPayloadSource","MercurySendErrorLogger","MercuryServerPayloadPreprocessor","MercuryServerRequestsConfig","MercuryServerSendMessageQueueRouter","MercuryServerRequestSingletonMixin","MercurySourceType","MercuryThreadlistConstants","MercuryMessageIDs","MessagingConfig","MessagingTag","MercuryServerDispatcher","MercuryServerSendMessageQueueOptions","AsyncDialog","AsyncRequest","DOM","XNotificationsSettingsDialogController","XModifyNotificationSettingsController","createObjectFrom","errorCode","setTimeoutAcrossTransitions"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la,ma,na,oa,pa,qa){b.__markCompiled&&b.__markCompiled();'use strict';var ra=k.getInstance('mercury_server'),sa=n.MERCURY;function ta(fb){return fb.thread_fbid||fb.thread_id||fb.client_thread_id;}function ua(fb){return fb.getError()?'_'+fb.getError():'';}function va(fb,gb){var hb=Object.assign({},fb),ib;if(gb.threads){if(!hb.threads)hb.threads={};for(ib in gb.threads)hb.threads[ib]=Object.keys(oa((hb.threads[ib]||[]).concat(gb.threads[ib])));}if(gb.messages){if(!hb.messages)hb.messages={};for(ib in gb.messages){if(!hb.messages[ib])hb.messages[ib]={};for(var jb in gb.messages[ib])if(hb.messages[ib][jb]){hb.messages[ib][jb]=ab(hb.messages[ib][jb],gb.messages[ib][jb]);}else hb.messages[ib][jb]=gb.messages[ib][jb];}}hb.client=fb.client||gb.client;return hb;}function wa(fb,gb){var hb=Object.assign(oa(fb.folders,true),oa(gb.folders,true)),ib=fb.client||gb.client;return {folders:Object.keys(hb),client:ib};}function xa(fb,gb){for(var hb in gb)if(fb[hb]&&typeof fb[hb]==='object'){fb[hb]=ab(fb[hb],gb[hb]);}else if(gb[hb]&&typeof gb[hb]==='object'){var ib={};Object.assign(ib,gb[hb]);fb[hb]=ib;}return fb;}function ya(fb,gb){var hb=Object.assign({},fb.ids,gb.ids),ib=fb.client||gb.client;return {ids:hb,client:ib};}function za(fb,gb){return gb;}function ab(fb,gb){var hb=fb.offset<gb.offset?fb.offset:gb.offset,ib=fb.offset+fb.limit,jb=gb.offset+gb.limit,kb=(ib>jb)?ib:jb,lb=kb-hb,mb=fb.timestamp>gb.timestamp?fb.timestamp:gb.timestamp;return {offset:hb,limit:lb,timestamp:mb};}function bb(fb,gb){var hb=fb.client||gb.client,ib={ids:{},client:hb};Object.assign(ib.ids,fb.ids,gb.ids);return ib;}function cb(fb,gb){var hb={},ib,jb=fb.client||gb.client;delete fb.client;delete gb.client;for(ib in fb)Object.assign(hb,oa(fb[ib],ib));for(ib in gb)Object.assign(hb,oa(gb[ib],ib));var kb={client:jb};for(var lb in hb){ib=hb[lb];if(!kb[ib])kb[ib]=[];kb[ib].push(lb);}return kb;}function db(fb,gb){var hb=fb.client||gb.client,ib=oa(fb.ids,true),jb=oa(gb.ids,true),kb=Object.assign(ib,jb);return {ids:Object.keys(kb),client:hb};}function eb(fb){this._fbid=fb;this._lastActionTimestamp=0;this._fetchingThreads={};this._sentMessagesTimestamp={};this.__threadIDMap=q.getForFBID(this._fbid);this._dispatcher=p.getForFBID(this._fbid);this._payloadPreprocessor=y.getForFBID(this._fbid);this._sendMessageQueueOptions=new ia(function(gb,hb){return this.__handleUpdate(gb,hb);}.bind(this),function(gb){return this._handleSendMessageError(gb);}.bind(this),function(gb){return this._handleSendMessageTransportError(gb);}.bind(this),function(gb){return this._handleSendMessageTimeout(gb);}.bind(this),z.sendMessageTimeout,fa.SEND_CONNECTION_RETRIES);this._registerEndpoints();}Object.assign(eb.prototype,{fetchThreadlistInfo:function(fb,gb,hb,ib,jb){hb=hb||ga.INBOX;jb=jb||sa;var kb=ib?ha.IMMEDIATE:null,lb={client:jb};lb[hb]={offset:fb,limit:gb,filter:ib};this.__sendRequest('/ajax/mercury/threadlist_info.php',lb,kb);},fetchPinnedThreads:function(){this.__sendRequest('/mercury/pinned_threads/',{});},fetchUnseenThreadIDs:function(fb,gb){gb=gb||sa;this.fetchThreadlistInfo(da.RECENT_THREAD_OFFSET,da.JEWEL_THREAD_COUNT,fb,null,gb);},fetchUnreadThreadIDs:function(fb,gb){gb=gb||sa;this.__sendRequest('/ajax/mercury/unread_threads.php',{folders:[fb],client:gb});},fetchMissedMessages:function(fb,gb){gb=gb||sa;var hb={last_action_timestamp:this._lastActionTimestamp,folders:fb,client:gb};hb.last_action_timestamp=this._lastActionTimestamp;this.__sendRequest('/ajax/mercury/thread_sync.php',hb);},fetchThreadData:function(fb,gb){gb=gb||sa;o.allThreadID(fb);var hb={threads:{},client:gb},ib=[],jb=[];fb.forEach(function(lb){if(this._fetchingThreads[lb])return;this._fetchingThreads[lb]=true;var mb=this.__threadIDMap.getFBIDFromClientIDNow(lb),nb=t.tokenize(lb);if(nb.type=='user'){ib.push(nb.value);hb.threads.user_ids=ib;}else if(nb.type=='thread'){if(mb){jb.push(mb);}else jb.push(nb.value);hb.threads.thread_fbids=jb;}else if(nb.type=='root'){if(mb){jb.push(mb);hb.threads.thread_fbids=jb;}}else if(nb.type!='pending')throw new Error('Unknown thread type',nb);}.bind(this));this._dispatcher.inform("fetch-thread-data",hb);for(var kb in hb.threads){this.__sendRequest('/ajax/mercury/thread_info.php',hb);break;}},ensureThreadIsFetched:function(fb,gb){gb=gb||sa;if(!this.__threadIDMap.getClientIDFromFBIDNow(fb)&&!this._fetchingThreads[fb]){this._fetchingThreads[fb]=true;this.__sendRequest('/ajax/mercury/thread_info.php',{threads:{thread_fbids:[fb]},client:gb});}},fetchThreadMessages:function(fb,gb,hb,ib,jb,kb){o.isThreadID(fb);kb=kb||sa;var lb,mb,nb=t.tokenize(fb),ob=this.__threadIDMap.getFBIDFromClientIDNow(fb),pb=false;if(ob){lb=ob;mb=(nb.type=='user')?'user_ids':'thread_fbids';}else{lb=nb.value;switch(nb.type){case 'user':mb='user_ids';pb=true;break;case 'thread':mb='thread_fbids';break;}}var qb={messages:{},threads:{},client:kb};if(mb){qb.messages[mb]={};qb.messages[mb][lb]={offset:gb,timestamp:ib,limit:hb};if(pb)qb.threads[mb]=[lb];this.__sendRequest('/ajax/mercury/thread_info.php',qb,jb);}else this.__threadIDMap.getFBIDFromClientID(fb,function(rb){qb.messages.thread_fbids={};qb.messages.thread_fbids[rb]={offset:gb,timestamp:ib,limit:hb};this.__sendRequest('/ajax/mercury/thread_info.php',qb,jb);}.bind(this));},handleThreadInfoError:function(fb){var gb=fb.getRequest().getData(),hb=[];if(gb.messages){for(var ib in gb.messages.thread_fbids)hb.push(this._createServerErrorLogMessage(this.__threadIDMap.getClientIDFromFBIDNow(ib)));for(var jb in gb.messages.user_ids)hb.push(this._createServerErrorLogMessage('user:'+jb));for(var kb in gb.messages.group_ids)hb.push(this._createServerErrorLogMessage('group:'+kb));}if(hb.length)this._dispatcher.handleUpdate({actions:hb,from_client:true,payload_source:w.CLIENT_CHANNEL_MESSAGE});if(gb.threads&&(gb.threads.user_ids||gb.threads.group_ids||gb.threads.thread_ids)){var lb=5,mb=true;if(!gb.retry_count){gb.retry_count=0;if(gb.messages)delete gb.messages;}else if(gb.retry_count>=lb){mb=false;(gb.threads.thread_ids||[]).forEach(function(ob){if(ob in this._fetchingThreads)delete this._fetchingThreads[ob];}.bind(this));}if(mb){var nb=Math.pow(2,gb.retry_count)*1000;qa(function(){ra.log('retry_thread',gb);this.__sendRequest('/ajax/mercury/thread_info.php',gb);}.bind(this),nb);gb.retry_count++;}}},markFolderAsRead:function(fb){this.__sendRequest('/ajax/mercury/mark_folder_as_read.php',{folder:fb});var gb=[{action_type:s.MARK_ALL_READ,action_id:null,folder:fb}];this._dispatcher.handleUpdate({global_actions:gb,from_client:true,payload_source:w.CLIENT_CHANGE_READ_STATUS});},changeThreadReadStatus:function(fb,gb,hb,ib){o.isThreadID(fb);this.__threadIDMap.getFBIDFromClientID(fb,function(jb){var kb,lb={ids:(kb={},kb[jb]=gb,kb),source:hb,watermarkTimestamp:ib};this.__sendRequest('/ajax/mercury/change_read_status.php',lb);}.bind(this));},changeThreadArchivedStatus:function(fb,gb,hb){o.isThreadID(fb);this.__threadIDMap.getFBIDFromClientID(fb,function(ib){var jb={ids:{},source:hb};jb.ids[ib]=gb;this.__sendRequest('/ajax/mercury/change_archived_status.php',jb);}.bind(this));},changeThreadFolder:function(fb,gb){o.isThreadID(fb);this.__threadIDMap.getFBIDFromClientID(fb,function(hb){var ib={};ib[gb]=[hb];this.__sendRequest('/ajax/mercury/move_thread.php',ib);}.bind(this));},openNotificationSettings:function(fb){o.isThreadID(fb);this.__threadIDMap.getFBIDFromClientID(fb,function(gb){var hb=ma.getURIBuilder().setString('thread_key_id',gb).getURI();ja.send(new ka(hb),function(ib){ib.subscribe('confirm',function(){this.hide();var jb=la.find(this.getRoot(),'input[name="quiet_start"]').value,kb=la.find(this.getRoot(),'input[name="quiet_end"]').value,lb=na.getURIBuilder().setString('thread_key_id',gb).setInt('quiet_hours_start',jb).setInt('quiet_hours_end',kb).getURI();(new ka()).setURI(lb).setMethod('POST').send();}.bind(ib));});});},changeMutingOnThread:function(fb,gb){o.isThreadID(fb);this.__threadIDMap.getFBIDFromClientID(fb,function(hb){this.__sendRequest('/ajax/mercury/change_mute_thread.php',{thread_fbid:hb,mute_settings:gb,payload_source:sa});}.bind(this));},markThreadSpam:function(fb,gb){o.isThreadID(fb);this.__threadIDMap.getFBIDFromClientID(fb,function(hb){this.__sendRequest('/ajax/mercury/mark_spam.php',{id:hb,source:gb});}.bind(this));},markMessagesSpam:function(fb,gb){ea.getServerIDs(gb||[],function(hb){this.__sendRequest('/ajax/mercury/mark_spam_messages.php',{message_ids:hb});}.bind(this));},unmarkThreadSpam:function(fb,gb){o.isThreadID(fb);this.__threadIDMap.getFBIDFromClientID(fb,function(hb){this.__sendRequest('/ajax/mercury/unmark_spam.php',{id:hb,source:gb});}.bind(this));},deleteThread:function(fb,gb){o.isThreadID(fb);this.__threadIDMap.getFBIDFromClientID(fb,function(hb){var ib={ids:[hb],source:gb};this.__sendRequest('/ajax/mercury/delete_thread.php',ib);}.bind(this));},unpinThread:function(fb){o.isThreadID(fb);this.__threadIDMap.getFBIDFromClientID(fb,function(gb){this.__sendRequest('/mercury/unpin_thread/',{id:gb});}.bind(this));},deleteMessages:function(fb,gb){ea.getServerIDs(gb||[],function(hb){this.__sendRequest('/ajax/mercury/delete_messages.php',{message_ids:hb});}.bind(this));},sendDeliveryReceipts:function(fb){ea.getServerIDs(fb||[],function(gb){this.__sendRequest('/ajax/mercury/delivery_receipts.php',{message_ids:gb});}.bind(this));},sendNewMessage:function(fb,gb){gb=gb||sa;if(!fb.client_state||fb.client_state==v.SEND_TO_SERVER){var hb=t.tokenize(fb.thread_id),ib=hb.type,jb=Object.assign({},fb);if((ib=='root'&&hb.value==jb.threading_id)||(ib=='user')){jb.client_thread_id=jb.thread_id;jb.thread_id=null;this._sendNewMessageToServer(jb,gb);}else this.__threadIDMap.getFBIDFromClientID(jb.thread_id,function(kb){hb=t.tokenize(jb.thread_id);if(hb.type=='user'){jb.other_user_fbid=hb.values;}else jb.thread_fbid=kb;jb.thread_id=null;this._sendNewMessageToServer(jb);}.bind(this));}},_sendNewMessageToServer:function(fb,gb){g.inform(i.ATTEMPT_RECONNECT);gb=gb||sa;this._sentMessagesTimestamp[fb.message_id]=Date.now();aa.getForFBID(this._fbid).enqueue(ta(fb),this._sendMessageQueueOptions,gb,fb);},markSeen:function(){var fb=this._lastActionTimestamp;this.__sendRequest('/ajax/mercury/mark_seen.php',{seen_timestamp:fb});},_handleSendMessageErrorCommon:function(fb,gb,hb,ib){ra.debug('handle_send_message_error_common',{reliability_error_status:hb,request_error_status:gb});var jb=fb.getData(),kb=jb.message_batch,lb=kb.map(function(nb){var ob={action_type:m.SEND_MESSAGE,thread_fbid:nb.thread_fbid,client_message_id:nb.message_id,message_id:nb.message_id,client_thread_id:nb.client_thread_id,status:gb,error_data:ib};return ob;});lb.forEach(function(nb){if(nb.action_type===m.SEND_MESSAGE&&nb.status===l.ERROR)x.log(nb);},this);var mb={actions:lb,payload_source:w.CLIENT_HANDLE_ERROR};this._payloadPreprocessor.handleUpdate(mb);},handleSendMessageError:function(fb){var gb=fb.getPayload(),hb=null,ib=null;if(gb&&gb.error_payload){hb=l.UNCONFIRMED;ib='send_error';}else{hb=l.ERROR;ib='request_error'+ua(fb);}var jb=fb.error;if(jb===1404102)h.verboseErrorHandler(fb);var kb=/<.*>/.test(fb.getErrorDescription())?fb.getErrorSummary():fb.getErrorDescription();this._handleSendMessageErrorCommon(fb.getRequest(),hb,ib,{type:r.SERVER,code:fb.getError(),description:kb,is_transient:fb.isTransient()});},handleSendMessageTransportError:function(fb){this._handleSendMessageErrorCommon(fb.getRequest(),l.ERROR,'transport_error'+ua(fb),{type:r.TRANSPORT,code:fb.getError(),is_transient:true});},handleSendMessageTimeout:function(fb){this._handleSendMessageErrorCommon(fb,l.ERROR,'transport_timeout',{type:r.TIMEOUT,is_transient:true});},getLastActionTimestamp:function(){return this._lastActionTimestamp;},updateLastActionTimestamp:function(fb){if(fb)this._lastActionTimestamp=Math.max(this._lastActionTimestamp,fb);},markThreadFetched:function(fb){delete this._fetchingThreads[fb];},_createServerErrorLogMessage:function(fb){return {action_type:m.LOG_MESSAGE,thread_id:fb,message_id:fb,timestamp:Date.now(),timestamp_absolute:'',timestamp_relative:'',is_unread:false,source:ca.UNKNOWN,log_message_type:u.SERVER_ERROR,log_message_data:{}};},_getForAsyncRequest:function(fb){var gb=fb.getData(),hb=gb.request_user_id?gb.request_user_id:j.getID();return eb.getForFBID(hb);},__handleUpdate:function(fb,gb){this._getForAsyncRequest(gb)._payloadPreprocessor.handleUpdate(fb);},_handleThreadInfoError:function(fb){var gb=this._getForAsyncRequest(fb.getRequest());gb.handleThreadInfoError(fb);},_handleSendMessageError:function(fb){var gb=this._getForAsyncRequest(fb.getRequest());gb.handleSendMessageError(fb);},_handleSendMessageTransportError:function(fb){var gb=this._getForAsyncRequest(fb.getRequest());gb.handleSendMessageTransportError(fb);},_handleSendMessageTimeout:function(fb){var gb=this._getForAsyncRequest(fb);gb.handleSendMessageTimeout(fb);},_registerEndpoints:function(){var fb=null;if(z.msgrRegion)fb={name:'X-MSGR-Region',value:z.msgrRegion};var gb={'/ajax/mercury/thread_sync.php':{request_user_id:this._fbid,mode:ha.IDEMPOTENT,customHeader:fb,handler:function(hb,ib){return this.__handleUpdate(hb,ib);}.bind(this)},'/ajax/mercury/thread_info.php':{request_user_id:this._fbid,mode:ha.BATCH_DEFERRED_MULTI,customHeader:fb,batch_function:va,handler:function(hb,ib){return this.__handleUpdate(hb,ib);}.bind(this),error_handler:function(hb){return this._handleThreadInfoError(hb);}.bind(this)},'/ajax/mercury/mark_folder_as_read.php':{request_user_id:this._fbid,mode:ha.IMMEDIATE,customHeader:fb,handler:function(hb,ib){return this.__handleUpdate(hb,ib);}.bind(this)},'/ajax/mercury/change_read_status.php':{request_user_id:this._fbid,mode:ha.BATCH_SUCCESSIVE,customHeader:fb,batch_function:ya,handler:function(hb,ib){return this.__handleUpdate(hb,ib);}.bind(this)},'/ajax/mercury/mark_seen.php':{request_user_id:this._fbid,mode:ha.BATCH_SUCCESSIVE,customHeader:fb,batch_function:za,handler:function(hb,ib){return this.__handleUpdate(hb,ib);}.bind(this)},'/ajax/mercury/threadlist_info.php':{request_user_id:this._fbid,mode:ha.BATCH_SUCCESSIVE_UNIQUE,customHeader:fb,batch_function:xa,handler:function(hb,ib){return this.__handleUpdate(hb,ib);}.bind(this)},'/ajax/mercury/mark_spam.php':{request_user_id:this._fbid,mode:ha.IMMEDIATE,customHeader:fb,handler:function(hb,ib){return this.__handleUpdate(hb,ib);}.bind(this)},'/ajax/mercury/mark_spam_messages.php':{request_user_id:this._fbid,mode:ha.IMMEDIATE,customHeader:fb,handler:function(hb,ib){return this.__handleUpdate(hb,ib);}.bind(this)},'/ajax/mercury/unmark_spam.php':{request_user_id:this._fbid,mode:ha.IMMEDIATE,customHeader:fb,handler:function(hb,ib){return this.__handleUpdate(hb,ib);}.bind(this)},'/ajax/mercury/unread_threads.php':{request_user_id:this._fbid,mode:ha.BATCH_SUCCESSIVE_UNIQUE,customHeader:fb,batch_function:wa,handler:function(hb,ib){return this.__handleUpdate(hb,ib);}.bind(this)},'/ajax/chat/settings.php':{request_user_id:this._fbid,mode:ha.IMMEDIATE,customHeader:fb},'/ajax/mercury/change_archived_status.php':{request_user_id:this._fbid,mode:ha.BATCH_SUCCESSIVE,customHeader:fb,batch_function:bb,handler:function(hb,ib){return this.__handleUpdate(hb,ib);}.bind(this)},'/ajax/mercury/delete_thread.php':{request_user_id:this._fbid,mode:ha.BATCH_SUCCESSIVE,customHeader:fb,batch_function:db,handler:function(hb,ib){return this.__handleUpdate(hb,ib);}.bind(this)},'/ajax/mercury/delete_messages.php':{request_user_id:this._fbid,mode:ha.IMMEDIATE,customHeader:fb,handler:function(hb,ib){return this.__handleUpdate(hb,ib);}.bind(this)},'/ajax/mercury/delivery_receipts.php':{request_user_id:this._fbid,mode:ha.IMMEDIATE,customHeader:fb,handler:function(hb,ib){return this.__handleUpdate(hb,ib);}.bind(this)},'/ajax/mercury/move_thread.php':{request_user_id:this._fbid,mode:ha.BATCH_SUCCESSIVE,customHeader:fb,batch_function:cb,handler:function(hb,ib){return this.__handleUpdate(hb,ib);}.bind(this)},'/ajax/mercury/change_mute_thread.php':{request_user_id:this._fbid,mode:ha.IMMEDIATE,customHeader:fb,handler:function(hb,ib){return this.__handleUpdate(hb,ib);}.bind(this)},'/mercury/pinned_threads/':{request_user_id:this._fbid,mode:ha.BATCH_SUCCESSIVE_UNIQUE,customHeader:fb,handler:function(hb,ib){return this.__handleUpdate(hb,ib);}.bind(this)},'/mercury/unpin_thread/':{request_user_id:this._fbid,mode:ha.IMMEDIATE,customHeader:fb,handler:function(hb,ib){return this.__handleUpdate(hb,ib);}.bind(this)}};ha.registerEndpoints(gb);},__sendRequest:function(fb,gb,hb){ha.trySend(fb,gb,hb,this._fbid);}});Object.assign(eb,ba);e.exports=eb;},null);
__d("MercuryThreadIDMap",["KeyedCallbackManager","MercuryAssert","MercuryIDs","MercurySingletonMixin"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();'use strict';function k(l){this.$MercuryThreadIDMap0=l;this.$MercuryThreadIDMap1=new g();this.$MercuryThreadIDMap2=new g();this.$MercuryThreadIDMap3=new g();}k.prototype.setServerToClientID=function(l,m){this.$MercuryThreadIDMap1.setResource(l,m);};k.prototype.getClientIDFromServerIDNow=function(l){return this.$MercuryThreadIDMap1.getResource(l);};k.prototype.setFBIDToClientID=function(l,m){this.$MercuryThreadIDMap2.setResource(l,m);this.$MercuryThreadIDMap3.setResource(m,l);};k.prototype.getClientIDFromFBIDNow=function(l){return this.$MercuryThreadIDMap2.getResource(l);};k.prototype.getClientIDFromFBID=function(l,m){this.$MercuryThreadIDMap2.executeOrEnqueue(l,m);d(['MercuryServerRequests'],function(n){n.getForFBID(this.$MercuryThreadIDMap0).ensureThreadIsFetched(l);}.bind(this));};k.prototype.setClientIDToFBID=function(l,m){this.$MercuryThreadIDMap3.setResource(l,m);this.$MercuryThreadIDMap2.setResource(m,l);};k.prototype.getFBIDFromClientIDNow=function(l){return this.$MercuryThreadIDMap3.getResource(l);};k.prototype.getFBIDFromClientID=function(l,m){h.isThreadID(l);var n=this.$MercuryThreadIDMap3.executeOrEnqueue(l,m);d(['MercuryServerRequests'],function(o){var p=this.$MercuryThreadIDMap3.getUnavailableResources(n),q=i.tokenize(l);if(p.length&&q.type!='root')o.getForFBID(this.$MercuryThreadIDMap0).fetchThreadData(p);}.bind(this));};k.prototype.hasClientIDForFBID=function(l){return !!this.getClientIDFromFBIDNow(l);};k.prototype.convertThreadIDIfAvailable=function(l){var m=this.getClientIDFromFBIDNow(l);if(m===(void 0)){return l;}else return m;};k.prototype.canLinkExternally=function(l){h.isThreadID(l);var m=i.tokenize(l);return (m.type=='user')||!!this.getFBIDFromClientIDNow(l);};Object.assign(k,j);e.exports=k;},null);
__d("MercuryThreadInformer",["ArbiterMixin","LogHistory","MercuryAssert","MercuryLoggingHelper","MercurySingletonMixin","mapObject","mixin"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){b.__markCompiled&&b.__markCompiled();'use strict';var n=h.getInstance('mercury_informer'),o=m(g);for(var p in o)if(o.hasOwnProperty(p))r[p]=o[p];var q=o===null?null:o.prototype;r.prototype=Object.create(q);r.prototype.constructor=r;r.__superConstructor__=o;function r(t){o.call(this);this.$MercuryThreadInformer0=t;this.$MercuryThreadInformer1={};this.$MercuryThreadInformer2={};this.$MercuryThreadInformer3={};this.$MercuryThreadInformer4=false;this.$MercuryThreadInformer5=false;this.$MercuryThreadInformer6=false;this.$MercuryThreadInformer7={};this.$MercuryThreadInformer8={};this.$MercuryThreadInformer9={};this.$MercuryThreadInformera=0;}r.prototype.updatedThread=function(t){this.$MercuryThreadInformer2[t]=true;this.$MercuryThreadInformerb();};r.prototype.deletedThread=function(t){this.$MercuryThreadInformer1[t]=true;this.$MercuryThreadInformerb();};r.prototype.updatedThreadlist=function(){this.$MercuryThreadInformer4=true;this.$MercuryThreadInformerb();};r.prototype.updatedUnseenState=function(){this.$MercuryThreadInformer5=true;this.$MercuryThreadInformerb();};r.prototype.updatedUnreadState=function(){this.$MercuryThreadInformer6=true;this.$MercuryThreadInformerb();};r.prototype.changedThreadReadState=function(t,u,v){if(!this.$MercuryThreadInformer3[t]||this.$MercuryThreadInformer3[t].timestamp<v)this.$MercuryThreadInformer3[t]={mark_as_read:u,timestamp:v};this.$MercuryThreadInformerb();};r.prototype.receivedMessage=function(t){i.isThreadID(t.thread_id);var u=t.thread_id;if(!this.$MercuryThreadInformer7[u])this.$MercuryThreadInformer7[u]=[];this.$MercuryThreadInformer7[u].push(t);this.updatedThread(u);};r.prototype.reorderedMessages=function(t,u){this.$MercuryThreadInformer8[t]={source:u};this.$MercuryThreadInformerb();};r.prototype.updatedMessage=function(t,u,v){if(!this.$MercuryThreadInformer9[t])this.$MercuryThreadInformer9[t]={};this.$MercuryThreadInformer9[t][u]={source:v};this.updatedThread(t);};r.prototype.synchronizeInforms=function(t){this.$MercuryThreadInformera++;try{t();}catch(u){throw u;}finally{this.$MercuryThreadInformera--;this.$MercuryThreadInformerb();}};r.prototype.listen=function(t,u){return this.subscribe('threads-updated',function(v,w){if(w[t])u(t);});};r.prototype.$MercuryThreadInformerb=function(){if(!this.$MercuryThreadInformera){var t=this.$MercuryThreadInformer1,u=this.$MercuryThreadInformer2,v=this.$MercuryThreadInformer3,w=this.$MercuryThreadInformer4,x=this.$MercuryThreadInformer5,y=this.$MercuryThreadInformer6,z=this.$MercuryThreadInformer7,aa=this.$MercuryThreadInformer8,ba=this.$MercuryThreadInformer9;this.$MercuryThreadInformer1={};this.$MercuryThreadInformer2={};this.$MercuryThreadInformer3={};this.$MercuryThreadInformer4=false;this.$MercuryThreadInformer5=false;this.$MercuryThreadInformer6=false;this.$MercuryThreadInformer7={};this.$MercuryThreadInformer8={};this.$MercuryThreadInformer9={};var ca=Object.keys(u);if(ca.length||w)this.inform('threadlist-updated',ca);if(ca.length)this.$MercuryThreadInformerc('threads-updated',u);for(var da in v){this.$MercuryThreadInformerc('thread-read-changed',v);break;}for(da in t){this.$MercuryThreadInformerc('threads-deleted',t);break;}if(x)this.$MercuryThreadInformerc('unseen-updated',null);if(y)this.$MercuryThreadInformerc('unread-updated',null);for(da in z){this.$MercuryThreadInformerc('messages-received',z);break;}for(da in aa){this.$MercuryThreadInformerc('messages-reordered',aa);break;}for(da in ba){this.$MercuryThreadInformerc('messages-updated',ba);break;}}};r.prototype.$MercuryThreadInformerc=function(t,u){s(t,u);this.inform(t,u);};function s(t,u){var v=u;if(t=='messages-received')v=l(v,function(w){return w.map(function(x){return j.obfuscateMessage(x);});});n.debug(t,v);}Object.assign(r,k);e.exports=r;},null);
__d("MercuryDispatcher",["ArbiterMixin","LogHistory","MercuryLoggingHelper","MercuryPayloadSource","MercurySingletonMixin","MercuryThreadIDMap","MercuryThreadInformer","invariant","isEmpty","mixin"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){b.__markCompiled&&b.__markCompiled();'use strict';var q=h.getInstance('mercury_dispatcher'),r=p(g);for(var s in r)if(r.hasOwnProperty(s))u[s]=r[s];var t=r===null?null:r.prototype;u.prototype=Object.create(t);u.prototype.constructor=u;u.__superConstructor__=r;function u(v){r.call(this);this.$MercuryDispatcher0=v;this.$MercuryDispatcher1=l.getForFBID(this.$MercuryDispatcher0);}u.prototype.handleUpdate=function(v){this.$MercuryDispatcher2(v);n((!!v.from_client)!==(!!v.preprocessed));delete v.preprocessed;if(!o(v))m.getForFBID(this.$MercuryDispatcher0).synchronizeInforms(function(){if(!v.from_client)this.inform('payload-preprocessed',v);this.inform('update-thread-ids',v.newlyAddedClientIDs||{});this.inform('update-participants',v);this.inform('update-threads',v);this.inform('update-unread',v);this.inform('update-threadlist',v);this.inform('update-pinned-threads',v);this.inform('update-messages',v);this.inform('update-unseen',v);this.inform('update-typing-state',v);this.inform('update-delivery',v);this.inform('update-roger',v.roger);this.inform('model-update-completed',null);}.bind(this));};u.prototype.$MercuryDispatcher2=function(v){var w={actions:[],threads:[]};if(v){if(v.actions)w.actions=v.actions.map(function(z){return i.obfuscateMessage(z);});if(v.threads)w.threads=v.threads.map(function(z){return i.obfuscateThread(z);});}var x=Object.assign({},v,w),y=v.payload_source;if(y!==j.CLIENT_CHANGE_READ_STATUS&&y!==j.CLIENT_MARK_THREAD_SEEN)q.debug('update:'+y,{payload:x,from_client:v.from_client});};Object.assign(u,k);e.exports=u;},null);
__d("MercuryThreadInfo",["CurrentUser","MercuryIDs","MercuryThreadMode"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();'use strict';var j={canReply:function(l){return !!(l.is_subscribed&&(l.can_reply===(void 0)||l.can_reply)&&l.mode!=i.OBJECT_ORIGINATED&&!l.has_email_participant&&!l.read_only&&(l.recipients_loadable||l.recipients_loadable===(void 0)));},getMuteSetting:function(l){return (l.mute_settings&&l.mute_settings[k(g.getID())]);},isEmptyLocalThread:function(l){return (h.tokenize(l.thread_id).type==='root'&&!l.timestamp);},isMuted:function(l){return j.getMuteSetting(l)!==(void 0);},isMessageBlocked:function(l){return l.message_blocked;},isNewEmptyLocalThread:function(l){return !!(j.isEmptyLocalThread(l)&&l.participants&&l.participants.length===0);},showComposer:function(l){return !!(l.is_subscribed&&(l.composer_enabled===(void 0)||l.composer_enabled)&&l.mode!=i.OBJECT_ORIGINATED&&!l.has_email_participant&&!l.read_only&&(l.recipients_loadable||l.recipients_loadable===(void 0)));}};function k(l){return l+'@facebook.com';}e.exports=j;},null);
__d("MercuryDisplayTimeFilterMessageRenderer",["fbt"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();'use strict';var h={renderFilteredContent:function(i){if(i.is_filtered_content_bh)return (g._("This message was removed because it contains blocked or harmful links."));if(i.is_filtered_content_account)return (g._("This message has been temporarily removed because the sender's account requires verification."));return (g._("This message has been temporarily removed because the sender's account requires verification, or it was identified as abusive."));}};e.exports=h;},null);
__d("MercuryThreads",["EventEmitter","ImmutableObject","KeyedCallbackManager","LogHistory","Map","MercuryActionType","MercuryAssert","MercuryAttachment","MercuryDispatcher","MercuryGlobalActionType","MercuryIDs","MercuryLogMessageType","MercuryLoggingHelper","MercuryPayloadSource","MercurySingletonMixin","MercuryThreadInfo","MercuryThreadMode","MessagingTag","MercuryDisplayTimeFilterMessageRenderer","MercuryServerRequests","Set","MercuryThreadInformer","setImmediate"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca){b.__markCompiled&&b.__markCompiled();'use strict';var da=new g(),ea=j.getInstance('mercury_threads');function fa(ga){this.$MercuryThreads0=ga;this.$MercuryThreads1=z.getForFBID(this.$MercuryThreads0);this.$MercuryThreads2=ba.getForFBID(this.$MercuryThreads0);this.$MercuryThreads3=q.getParticipantIDFromUserID(this.$MercuryThreads0);this.$MercuryThreads4=o.getForFBID(this.$MercuryThreads0);this.$MercuryThreads5=false;this.$MercuryThreads6=new i();this.$MercuryThreads7=new aa();this.$MercuryThreads8=false;this.$MercuryThreads9=new aa();this.$MercuryThreadsa=new aa();this.$MercuryThreadsb();}fa.prototype.getThreadMetaNow=function(ga){m.isThreadID(ga);return this.$MercuryThreads6.getResource(ga);};fa.prototype.getOrFetch=function(ga){var ha=this.getThreadMetaNow(ga);if(!ha&&!this.$MercuryThreadsa.has(ga))this.$MercuryThreads9.add(ga);if(this.$MercuryThreads9.size>0&&!this.$MercuryThreads8)this.$MercuryThreadsc();return ha;};fa.prototype.$MercuryThreadsc=function(){if(this.$MercuryThreads8)return;this.$MercuryThreads8=true;ca(function(){this.$MercuryThreads8=false;this.$MercuryThreads9.forEach(function(ga){return this.$MercuryThreadsa.add(ga);}.bind(this));this.getMultiThreadMeta(Array.from(this.$MercuryThreads9),function(ga){for(var ha in ga)ga.hasOwnProperty(ha)&&this.$MercuryThreadsa["delete"](ha);}.bind(this));this.$MercuryThreads9.clear();}.bind(this));};fa.prototype.getThreadMeta=function(ga,ha,ia){return this.getMultiThreadMeta([ga],function(ja){return ha(ja[ga]);},ia);};fa.prototype.getMultiThreadMeta=function(ga,ha,ia){m.allThreadID(ga);var ja=this.$MercuryThreads6.executeOrEnqueue(ga,ha),ka=this.$MercuryThreads6.getUnavailableResources(ja);if(ka.length){var la=[];for(var ma=0;ma<ka.length;ma++){var na=ka[ma],oa=q.tokenize(na),pa=oa.type,qa=oa.value;if(pa=='user'){var ra=q.getParticipantIDFromUserID(qa);this.createNewLocalThread(na,ra===this.$MercuryThreads3?[this.$MercuryThreads3]:[this.$MercuryThreads3,ra]);}else la.push(na);}if(la.length)this.$MercuryThreads1.fetchThreadData(la,ia);}return ja;};fa.addListener=function(ga,ha){return da.addListener(ga,ha);};fa.prototype.unsubscribe=function(ga){this.$MercuryThreads6.unsubscribe(ga);};fa.prototype.getCanonicalThreadToParticipant=function(ga,ha,ia,ja){var ka=q.getThreadIDFromParticipantID(ga),la=this.$MercuryThreads6.getResource(ka);if(typeof la=='undefined'){la=this.createNewLocalThread(ka,this.$MercuryThreads3===ga?[this.$MercuryThreads3]:[this.$MercuryThreads3,ga],ha);!ja&&this.$MercuryThreads1.fetchThreadData([ka],ia);}return la;};fa.prototype.createNewLocalThread=function(ga,ha,ia){var ja=this.$MercuryThreads6.getResource(ga);if(!ja){var ka=q.tokenize(ga),la=ka.type,ma=ka.value;ja=new h({thread_id:ga,last_action_id:null,participants:Array.from(ha),name:null,snippet:'',snippet_has_attachment:false,snippet_sender:null,unread_count:ia?ia:0,message_count:0,image_src:null,timestamp_absolute:null,timestamp_relative:null,timestamp:null,canonical_fbid:la==='user'?ma:null,is_canonical_user:la=='user',is_canonical:this.$MercuryThreadsd(ha),is_subscribed:true,root_message_threading_id:null,folder:x.INBOX,is_archived:false,mode:w.TITAN_ORIGINATED});this.$MercuryThreads6.setResource(ga,ja);}return ja;};fa.prototype.isEmptyLocalThread=function(ga){var ha=this.$MercuryThreads6.getResource(ga);if(!ha)return false;return v.isEmptyLocalThread(ha);};fa.prototype.isNewEmptyLocalThread=function(ga){var ha=this.$MercuryThreads6.getResource(ga);if(!ha)return false;return v.isNewEmptyLocalThread(ha);};fa.prototype.$MercuryThreadse=function(ga,ha){if(!ga||!ga.length)return;var ia=new k(),ja=new k(),ka=new k(),la=[];for(var ma=0;ma<ga.length;ma++){var na=ga[ma];if(na.is_forward)continue;var oa=na.action_type;if(oa==l.LOG_MESSAGE&&na.log_message_type==r.SERVER_ERROR)continue;var pa=!!(na.sync_id||na.action_id),qa=na.thread_id;m.isThreadID(qa);var ra=this.$MercuryThreads6.getResource(qa);if(!ra&&!pa&&oa==l.USER_GENERATED_MESSAGE){ra=this.$MercuryThreadsf(na);this.$MercuryThreads6.setResource(qa,ra);}if(!ra)continue;if(oa==l.LOG_MESSAGE||oa==l.USER_GENERATED_MESSAGE)pa=!ha;if(ra.server_timestamp&&na.timestamp<=ra.server_timestamp&&pa)continue;if(!ka.has(qa))ka.set(qa,Object.assign({},ra));this.$MercuryThreadsg(ka.get(qa),na,ha);if(oa==l.USER_GENERATED_MESSAGE)ia.set(qa,na);if(oa==l.USER_GENERATED_MESSAGE||oa==l.LOG_MESSAGE||oa==l.SEND_MESSAGE)if(na&&na.timestamp&&(!ja.has(qa)||na.timestamp>ja.get(qa).timestamp))ja.set(qa,na);}ka.forEach(function(sa,ta){var ua=ja.get(ta),va=ia.get(ta);if(va){this.$MercuryThreadsh(sa,va);}else if(ua&&(ua.log_message_type==r.PHONE_CALL||ua.log_message_type==r.VIDEO_CALL)){var wa=Object.assign({},ua,{body:ua.log_message_body});this.$MercuryThreadsh(sa,wa);}var xa=sa.timestamp;if(ua){if(ua.timestamp>xa)Object.assign(sa,{timestamp_absolute:ua.timestamp_absolute,timestamp_relative:ua.timestamp_relative,timestamp:ua.timestamp});var ya=sa.server_timestamp;if(!ha&&ua.timestamp>ya)sa.server_timestamp=ua.timestamp;}var za=new h(sa);this.$MercuryThreads6.setResource(ta,za);la.push(s.obfuscateThread(za));}.bind(this),this);la.length&&this.$MercuryThreads5&&ea.debug('threads_updated',{threads:la});};fa.prototype.$MercuryThreadsg=function(ga,ha,ia){var ja=ha.action_type;if(ja==l.USER_GENERATED_MESSAGE||ja==l.LOG_MESSAGE){ha.is_unread&&ga.unread_count++;ga.message_count++;ga.is_archived=false;}switch(ja){case l.DELETE_THREAD:ga.message_count=0;this.$MercuryThreadsi(ha.thread_id);break;case l.USER_GENERATED_MESSAGE:if(ga.last_read_timestamp>=ha.timestamp)this.$MercuryThreadsj(ga,ha,true);this.$MercuryThreadsk(ga,ha.author);break;case l.SEND_MESSAGE:var ka=ha.log_message_type;if(ka==r.THREAD_IMAGE){ga.image_src=ha.log_message_data.image?ha.log_message_data.image.preview_url:null;this.$MercuryThreadsl(ha.thread_id);}if(ka!==r.SUBSCRIBE&&ka!==r.UNSUBSCRIBE)ga.snippet_attachments=ha.attachments;break;case l.LOG_MESSAGE:var ka=ha.log_message_type;if(ka==r.SUBSCRIBE){this.$MercuryThreadsm(ga,ha.log_message_data.added_participants);this.$MercuryThreadsl(ha.thread_id);}else if(ka==r.UNSUBSCRIBE){this.$MercuryThreadsn(ga,ha.log_message_data.removed_participants);this.$MercuryThreadsl(ha.thread_id);}else if(ka==r.THREAD_IMAGE){if(!ia)ga.image_src=ha.log_message_data.image?ha.log_message_data.image.preview_url:null;}else if(ka==r.THREAD_NAME){if(ga.name!==ha.log_message_data.name)this.$MercuryThreadsl(ha.thread_id);ga.name=ha.log_message_data.name;}break;case l.CHANGE_READ_STATUS:var la=this.$MercuryThreadsj(ga,ha,ha.mark_as_read);if(la&&ha.timestamp)ga.last_read_timestamp=ha.timestamp;if(la&&ia)this.$MercuryThreads1.changeThreadReadStatus(ga.thread_id,ha.mark_as_read,ha.source,ga.last_read_timestamp);break;case l.CHANGE_ARCHIVED_STATUS:if(ga.is_archived!=ha.archived){ga.is_archived=ha.archived;this.$MercuryThreadsl(ha.thread_id);}break;case l.CHANGE_FOLDER:if(ga.folder!=ha.new_folder){ga.folder=ha.new_folder;this.$MercuryThreadsl(ha.thread_id);}break;case l.DELETE_MESSAGES:if(ia){ga.snippet='...';ga.snippet_has_attachment=false;ga.snippet_attachments=null;ga.snippet_sender=null;ga.is_forwarded_snippet=false;this.$MercuryThreadsl(ha.thread_id);}else if(ha.message_ids)ga.message_count=ga.message_count-ha.message_ids.length;break;case l.UPDATE_BLOCKER_STATUS:ga.message_blocked=ha.is_message_blocked;ga.can_reply=!!(!ha.is_message_blocked&&ga.is_subscribed&&ga.mode!=w.OBJECT_ORIGINATED&&!ga.has_email_participant&&!ga.read_only&&(ga.recipients_loadable||ga.recipients_loadable===(void 0)));this.$MercuryThreadsl(ha.thread_id);break;case l.UPDATE_BLOCKEE_STATUS:ga.can_reply=!!(!ha.got_blocked&&ga.is_subscribed&&ga.mode!=w.OBJECT_ORIGINATED&&!ga.has_email_participant&&!ga.read_only&&(ga.recipients_loadable||ga.recipients_loadable===(void 0)));this.$MercuryThreadsl(ha.thread_id);break;case l.CHANGE_MUTE_SETTINGS:if(ha.mute_settings!==(void 0)){var ma=this.$MercuryThreads0+'@facebook.com';if(ga.mute_settings){if(ha.mute_settings){var na={};na[ma]=ha.mute_settings;ga.mute_settings=Object.assign({},ga.mute_settings,na);}else{ga.mute_settings=Object.assign({},ga.mute_settings);delete ga.mute_settings[ma];}this.$MercuryThreadsl(ga.thread_id);}}break;case l.ADD_PARTICIPANTS:this.$MercuryThreadsm(ga,ha.participants);this.$MercuryThreadsl(ga.thread_id);break;case l.CHANGE_FLAG:this.$MercuryThreadso(ga,ha.mark_as_flag);this.$MercuryThreadsl(ga.thread_id);break;case l.MOVE_PENDING_TO_INBOX:this.$MercuryThreadsp(ga);this.$MercuryThreadsl(ga.thread_id);break;}};fa.prototype.$MercuryThreadsf=function(ga){var ha=q.tokenize(ga.thread_id),ia=ha.type,ja=ha.value,ka=this.$MercuryThreadsd(ga.specific_to_list);return new h({thread_id:ga.thread_id,last_action_id:null,participants:ga.specific_to_list,name:null,snippet:ga.body,snippet_has_attachment:false,snippet_attachments:[],snippet_sender:ga.author,unread_count:0,message_count:0,image_src:null,timestamp_absolute:ga.timestamp_absolute,timestamp_relative:ga.timestamp_relative,timestamp:ga.timestamp,canonical_fbid:ia==='user'?ja:null,is_canonical_user:ia==='user',is_canonical:ka,is_subscribed:true,root_message_threading_id:ga.message_id,folder:x.INBOX,is_archived:false,mode:w.TITAN_ORIGINATED});};fa.prototype.$MercuryThreadsj=function(ga,ha,ia){if(ha.timestamp)this.$MercuryThreadsq(ga.thread_id,ia,ha.timestamp);if(!ga||!ga.thread_id)return false;if(!ga.timestamp){this.$MercuryThreads7.add(ga.thread_id);return false;}var ja=!ga.unread_count;if(ia==ja)return false;ga.unread_count=ia?0:1;this.$MercuryThreadsl(ga.thread_id);return true;};fa.prototype.$MercuryThreadsr=function(ga){var ha=this.$MercuryThreads6.getAllResources();for(var ia in ha)if(ha.hasOwnProperty(ia)){var ja=ha[ia];if(ja.folder==ga){this.$MercuryThreads6.setResource(ia,h.setProperty(ja,'unread_count',0));this.$MercuryThreadsl(ia);}}};fa.prototype.$MercuryThreadsm=function(ga,ha){var ia=new aa(ga.participants);ga.participants=Array.from(ga.participants);ha.forEach(function(ja){if(!ia.has(ja)){ga.participants.push(ja);if(ja===this.$MercuryThreads3)ga.is_subscribed=true;}}.bind(this));};fa.prototype.$MercuryThreadsn=function(ga,ha){var ia=new aa(ha);ga.participants=ga.participants.filter(function(ja){return !ia.has(ja);});if(ia.has(this.$MercuryThreads3))ga.is_subscribed=false;this.$MercuryThreads1.fetchThreadData([ga.thread_id]);};fa.prototype.$MercuryThreadsk=function(ga,ha){if(ga.participants[0]!=ha){ga.participants=ga.participants.filter(function(ia){return ia!=ha;});ga.participants.unshift(ha);}};fa.prototype.$MercuryThreadsh=function(ga,ha){var ia=ha.body,ja=ha.subject,ka='';if(ja){ja=ja.toLowerCase();if(ia.slice(0,ja.length).toLowerCase()==ja){ka=ia;}else if(ia){ka=ja+' \u00B7 '+ia;}else ka=ja;}else ka=ia;if(ha.is_filtered_content)ka=y.renderFilteredContent(ha);ga.snippet=ka;ga.snippet_has_attachment=ha.has_attachment;if(ha.raw_attachments&&ha.raw_attachments.length>0){var la=n.convertRaw(ha.raw_attachments);ga.snippet_attachments=la;}else ga.snippet_attachments=ha.attachments;ga.is_forwarded_snippet=!!ha.forward_count;ga.snippet_sender=ha.author;};fa.prototype.$MercuryThreadso=function(ga,ha){ga.page_thread_info=Object.assign({},ga.page_thread_info,{flagged:ha});};fa.prototype.$MercuryThreadsp=function(ga){if(ga.folder!==x.PENDING)return;ga.folder=x.INBOX;};fa.prototype.$MercuryThreadsd=function(ga){return ga.filter(function(ha){return ha!=this.$MercuryThreads3;}.bind(this)).length<=1;};fa.prototype.$MercuryThreadsb=function(){this.$MercuryThreads4.subscribe('update-threads',function(ga,ha){var ia=(ha.actions||[]).filter(function(ja){return ja.thread_id;});if(ha.threads&&ha.payload_source==t.SERVER_FETCH_THREAD_INFO)ha.threads.forEach(function(ja){var ka=ja.thread_id;if(this.$MercuryThreads7.has(ka)){this.$MercuryThreads7["delete"](ka);if(ja.unread_count)this.$MercuryThreads1.changeThreadReadStatus(ja.thread_id,true);}}.bind(this));this.$MercuryThreadss(ha.threads);this.$MercuryThreadse(ia,ha.from_client);ha.threads&&ha.threads.forEach(function(ja){this.$MercuryThreadsl(ja.thread_id);}.bind(this));if(ha.global_actions)ha.global_actions.forEach(function(ja){if(ja.action_type==p.MARK_ALL_READ)this.$MercuryThreadsr(ja.folder);}.bind(this));if(this.$MercuryThreads5){this.$MercuryThreads5=false;da.emit('change');}}.bind(this));};fa.prototype.$MercuryThreadss=function(ga){if(!ga||!ga.length)return;var ha={},ia=[];ga.forEach(function(ja){var ka=new h(ja);ha[ja.thread_id]=ka;ia.push(s.obfuscateThread(ka));});ia.length&&ea.debug('threads_added',{threads:ia});this.$MercuryThreads6.addResourcesAndExecute(ha);};fa.prototype.$MercuryThreadsl=function(ga){this.$MercuryThreads5=true;this.$MercuryThreads2.updatedThread(ga);};fa.prototype.$MercuryThreadsi=function(ga){this.$MercuryThreads5=true;this.$MercuryThreads2.deletedThread(ga);};fa.prototype.$MercuryThreadsq=function(ga,ha,ia){this.$MercuryThreads5=true;this.$MercuryThreads2.changedThreadReadState(ga,ha,ia);};Object.assign(fa,u);e.exports=fa;},null);
__d("WebMessengerPermalinkConstants",["MercuryConfig","URI"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();var i={ARCHIVED_PATH:'/messages/archived',BASE_PATH:'/messages',PENDING_PATH:'/messages/pending',OTHER_PATH:'/messages/other',SPAM_PATH:'/messages/spam',COMPOSE_POSTFIX_PATH:'/new',SEARCH_POSTFIX_PATH:'/search',TID_POSTFIX_PARTIAL_PATH:'/conversation-',overriddenVanities:g.CoreGraphEnabled?'(archived|other|pending|spam|new|search|conversation-.*)':'(archived|other|spam|new|search|conversation-.*)',getURIPathForThreadID:function(j,k){return (k||i.BASE_PATH)+i.TID_POSTFIX_PARTIAL_PATH+h.encodeComponent(h.encodeComponent(j));},getThreadIDFromURI:function(j){var k=j.getPath().match(i.BASE_PATH+'(/[^/]*)*'+i.TID_POSTFIX_PARTIAL_PATH+'([^/]+)');if(k){var l=h.decodeComponent(h.decodeComponent(k[2]));return l;}},getURIPathForIDOrVanity:function(j,k){if(j.match('^'+i.overriddenVanities+'$'))j='.'+j;return (k||i.BASE_PATH)+'/'+j;},getUserIDOrVanity:function(j){var k=j.match(i.BASE_PATH+'.*/([^/]+)/?$'),l=k&&k[1],m=i.overriddenVanities;if(!l||l.match('^'+m+'$')){return false;}else if(l.match('^\\.'+m+'$')){return l.substr(1);}else return l;}};e.exports=i;},null);
__d("ChatTypeaheadConstants",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();var g={USER_TYPE:'user',THREAD_TYPE:'thread',FRIEND_TYPE:'friend',NON_FRIEND_TYPE:'non_friend',FB4C_TYPE:'fb4c',PAGE_TYPE:'page',HEADER_TYPE:'header'};e.exports=g;},null);
__d("ChatOpenTab",["BusinessURI.brands","Event","requireWeak","ChatWelcomeMessage","ContextualThing","DOM","csx","cx","MercuryIDs","Parent","curry"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){b.__markCompiled&&b.__markCompiled();var r=null;i('ChatApp',function(ba){return r=ba;});var s=null;i('ChatTabModel',function(ba){return s=ba;});var t=716,u='messaging_tracking';function v(){d(['Toggler'],function(ba){var ca=ba.getInstance(l.scry(document,"div._1z4y")[0]);if(ca&&ca.getActive())ca.hide();});}function w(ba,ca,da){d(['LogHistory','MercuryThreads','WebMessengerPermalinkConstants','goURI'],function(ea,fa,ga,ha){fa.get().getThreadMeta(ba,function(ia){if(r&&r.isInitialized()){r.tabController.openTab(ba,r.tabsViewport,ca,da);}else ha(g(ga.getURIPathForThreadID(ba)));if(!aa.canOpenTab())ea.getInstance('mercury').error('Unable to open chat tab',ia);});});if(document.documentElement.clientHeight<=t)v();}function x(ba,ca,da,ea){h.listen(ba,'click',function(fa){if(aa.canOpenTab()){ea(ca,da);return fa.kill();}});}function y(ba,ca,da,ea){var fa={referrer:ba||'',message_thread_id:ca,message_view:'chat',timestamp_send:Date.now()};if(da!==(void 0))fa.message_target_ids=[da];d(['ChatImpressionLogger'],function(ha){ha.logImpression(ba,da,ea);});d(['Banzai'],function(ha){ha.post(u,fa,{delay:0,retry:true});});var ga=o.getUserIDFromThreadID(String(ca));d(['Banzai'],function(ha){ha.post('page_message_button_click',{page_id:ga,ref:ba});});}function z(ba){var ca=k.getContext(ba);return (ca&&p.byClass(ca,"_3qw")!==null);}var aa={canOpenTab:function(){return r&&!r.isHidden();},openEmptyTab:function(ba,ca,da){if(aa.canOpenTab()&&s){var ea=s.getEmptyTab();w(ea);y(ca,ea,null,da);v();return ea;}return null;},listenOpenEmptyTab:function(ba,ca){x(ba,null,ca,aa.openEmptyTab);},openThread:function(ba,ca,da,ea,fa){d(['MercuryThreadIDMap'],function(ga){if(o.isValid(ba)){w(ba,ea,fa);}else ga.get().getClientIDFromFBID(ba,function(ha){return w(ha,ea,fa);});y(ca,ba,null,da);v();});},listenOpenThread:function(ba,ca,da){x(ba,ca,da,aa.openThread);},openUserTab:function(ba,ca,da){var ea=o.getThreadIDFromUserID(ba);w(ea);y(ca,ea,ba,da);return true;},openPageTab:function(ba,ca,da){d(['MercuryThreads'],function(ea){var fa=o.getThreadIDFromUserID(ca);ea.get().getThreadMeta(fa,function(ga){if(ba&&ba.length>0){var ha=(Date.now()-ga.timestamp)/1000,ia=ha/3600;if(ga.message_count===0||ia>24)j.setWelcomeMessage(fa,o.getParticipantIDFromUserID(ca),ba);}});w(fa);y(da,fa,ca);});return true;},listenOpenUserTab:function(ba,ca,da){if(!z(ba))x(ba,ca,da,aa.openUserTab);},listenOpenPageTab:function(ba,ca,da,ea){if(!z(ba))x(ba,ca,ea,q(aa.openPageTab,da));},openTabByType:function(ba,ca,da){d(['ChatTypeaheadConstants','MercuryParticipantTypes'],function(ea,fa){if(ca===ea.THREAD_TYPE){if(ba){aa.openThread(ba,da);}else aa.openEmptyTab(null,da);}else if(!ca||ca===fa.FRIEND||ca===ea.FRIEND_TYPE||ca===ea.PAGE_TYPE||ca===ea.USER_TYPE)aa.openUserTab(ba,da);});}};e.exports=aa;},null);
__d("arrayStableSort",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();function g(h,i){return h.map(function(j,k){return {data:j,index:k};}).sort(function(j,k){return i(j.data,k.data)||(j.index-k.index);}).map(function(j){return j.data;});}e.exports=g;},null);
__d("RangedCallbackManager",["CallbackManagerController","arrayStableSort","createObjectFrom"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();function j(k,l,m){"use strict";this.$RangedCallbackManager0=[];this.$RangedCallbackManager1=false;this.$RangedCallbackManager2=false;this.$RangedCallbackManager3={};this.$RangedCallbackManager4=new g(this.$RangedCallbackManager5.bind(this));this.$RangedCallbackManager6=k;this.$RangedCallbackManager7=l;this.$RangedCallbackManager8=m;}j.prototype.executeOrEnqueue=function(k,l,m,n,o){"use strict";return this.$RangedCallbackManager4.executeOrEnqueue({start:k,limit:l},m,{strict:!!n,skipOnStrictHandler:o});};j.prototype.unsubscribe=function(k){"use strict";this.$RangedCallbackManager4.unsubscribe(k);};j.prototype.getUnavailableResources=function(k){"use strict";var l=this.$RangedCallbackManager4.getRequest(k),m=[];if(l&&!this.$RangedCallbackManager1){var n=l.request,o=this.$RangedCallbackManager9(l.options),p=n.start+n.limit;for(var q=o.length;q<p;q++)m.push(q);}return m;};j.prototype.addResources=function(k){"use strict";k.forEach(function(l){if(!this.$RangedCallbackManager3[l]){this.$RangedCallbackManager3[l]=true;this.$RangedCallbackManager0.push(l);this.$RangedCallbackManager2=null;}}.bind(this));this.resortResources();this.$RangedCallbackManager4.runPossibleCallbacks();};j.prototype.addResourcesWithoutSorting=function(k,l){"use strict";var m=this.$RangedCallbackManager0.slice(0,l);m=m.concat(k);m=m.concat(this.$RangedCallbackManager0.slice(l));this.$RangedCallbackManager0=m;Object.assign(this.$RangedCallbackManager3,i(k,true));this.$RangedCallbackManager2=null;this.$RangedCallbackManager4.runPossibleCallbacks();};j.prototype.removeResources=function(k){"use strict";k.forEach(function(l){if(this.$RangedCallbackManager3[l]){this.$RangedCallbackManager3[l]=false;var m=this.$RangedCallbackManager0.indexOf(l);if(m!=-1)this.$RangedCallbackManager0.splice(m,1);}}.bind(this));};j.prototype.removeAllResources=function(){"use strict";this.$RangedCallbackManager0=[];this.$RangedCallbackManager3={};};j.prototype.resortResources=function(){"use strict";this.$RangedCallbackManager0=h(this.$RangedCallbackManager0,function(k,l){return this.$RangedCallbackManager7(this.$RangedCallbackManager6(k),this.$RangedCallbackManager6(l));}.bind(this));};j.prototype.setReachedEndOfArray=function(){"use strict";if(!this.$RangedCallbackManager1){this.$RangedCallbackManager1=true;this.$RangedCallbackManager2=null;this.$RangedCallbackManager4.runPossibleCallbacks();}};j.prototype.hasReachedEndOfArray=function(){"use strict";return this.$RangedCallbackManager1;};j.prototype.setError=function(k){"use strict";if(this.$RangedCallbackManager2!==k){this.$RangedCallbackManager2=k;this.$RangedCallbackManager4.runPossibleCallbacks();}};j.prototype.getError=function(k,l,m){"use strict";var n=this.$RangedCallbackManager9({strict:m});return k+l>n.length?this.$RangedCallbackManager2:null;};j.prototype.hasResource=function(k){"use strict";return this.$RangedCallbackManager3[k];};j.prototype.getResourceAtIndex=function(k){"use strict";return this.$RangedCallbackManager0[k];};j.prototype.getAllResources=function(){"use strict";return this.$RangedCallbackManager0.concat();};j.prototype.getCurrentArraySize=function(k){"use strict";return this.$RangedCallbackManager9(k).length;};j.prototype.$RangedCallbackManager9=function(k){"use strict";var l=this.$RangedCallbackManager0;if(k&&k.strict){var m=k.skipOnStrictHandler||this.$RangedCallbackManager8;if(m)l=l.filter(m);}return l;};j.prototype.$RangedCallbackManager5=function(k,l){"use strict";var m=this.$RangedCallbackManager9(l);if(!this.$RangedCallbackManager1&&!this.$RangedCallbackManager2&&k.start+k.limit>m.length){return false;}else{var n=m.slice(k.start,k.start+k.limit),o=k.start+k.limit>m.length?this.$RangedCallbackManager2:null;return [n,o];}};j.prototype.getElementsUntil=function(k){"use strict";var l=[];for(var m=0;m<this.$RangedCallbackManager0.length;m++){var n=this.$RangedCallbackManager6(this.$RangedCallbackManager0[m]);if(this.$RangedCallbackManager7(n,k)>0)break;l.push(this.$RangedCallbackManager0[m]);}return l;};e.exports=j;},null);
__d("MercuryRootOfflineThreadingIDResolver",["KeyedCallbackManager","MercurySingletonMixin","MercuryThreadIDMap"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();'use strict';function j(k){this.$MercuryRootOfflineThreadingIDResolver0=k;this.$MercuryRootOfflineThreadingIDResolver1=new g();this.$MercuryRootOfflineThreadingIDResolver2=i.getForFBID(this.$MercuryRootOfflineThreadingIDResolver0);}j.prototype.setRootOTIDToClientID=function(k){this.$MercuryRootOfflineThreadingIDResolver1.setResource(k.offline_threading_id,k.thread_id);};j.prototype.maybeUpdateClientToServerIDMap=function(k){if(k.offline_threading_id&&k.thread_fbid){var l=this.$MercuryRootOfflineThreadingIDResolver1.getResource(k.offline_threading_id);if(l){this.$MercuryRootOfflineThreadingIDResolver2.setFBIDToClientID(k.thread_fbid,l);this.$MercuryRootOfflineThreadingIDResolver2.setClientIDToFBID(l,k.thread_fbid);}}};Object.assign(j,h);e.exports=j;},null);
__d("MercuryFolders",["MercuryConfig","MessagingTag","arrayContains"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();var j=[h.INBOX,h.OTHER,h.ACTION_ARCHIVED,h.SPAM],k=[h.INBOX,h.PENDING,h.OTHER,h.ACTION_ARCHIVED],l={getSupportedFolders:function(){return g.CoreGraphEnabled?k.concat():j.concat();},isSupportedFolder:function(m){return i(j,m);},getFromMeta:function(m){var n=m.folder;if(m.is_archived)n=h.ACTION_ARCHIVED;return n;}};e.exports=l;},null);
__d("MercuryUnreadState",["MercuryFolders","LogHistory","KeyedCallbackManager","MercuryActionType","MercuryDispatcher","MercuryGlobalActionType","MercurySingletonMixin","MercuryThreadlistConstants","MercuryThreadIDMap","MessagingTag","MercuryServerRequests","MercuryThreadInformer","MercuryThreads","arrayContains","createObjectFrom"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u){b.__markCompiled&&b.__markCompiled();var v=(g.getSupportedFolders()||[]).filter(function(na){return na!=p.ACTION_ARCHIVED;}),w='unread_thread_hash',x='unseen_thread_list',y=n.MAX_UNREAD_COUNT,z=h.getInstance('mercury_unread_state');function aa(na){this._fbid=na;this._serverRequests=q.getForFBID(this._fbid);this._threadIDMap=o.getForFBID(this._fbid);this._threadInformer=r.getForFBID(this._fbid);this._threads=s.getForFBID(this._fbid);this._dispatcher=k.getForFBID(this._fbid);this._allReadTimestamp={};this._threadReadTimestamp={};this._initialUnreadCount={};this._maxCount={};this._unreadResources={};v.forEach(function(oa){this._initialUnreadCount[oa]=0;this._maxCount[oa]=false;this._unreadResources[oa]=new i();}.bind(this));this._dispatcher.subscribe('update-unread',function(oa,pa){fa(this,pa);var qa=pa.global_actions||[];for(var ra=0;ra<qa.length;ra++){var sa=qa[ra];if(sa.action_type==l.MARK_ALL_READ)ia(this,sa.folder,sa.timestamp);}}.bind(this));this._dispatcher.subscribe('update-thread-ids',function(oa,pa){ka(this,pa);}.bind(this));}Object.assign(aa.prototype,{getUnreadCount:function(na){if(this.exceedsMaxCount(na)){z.error('unguarded_unread_count_fetch',{});return 0;}return ea(this,na);},exceedsMaxCount:function(na){return this._maxCount[na]||(ea(this,na)>y);},markFolderAsRead:function(na){if(this._maxCount[na]||ea(this,na)>0)this._serverRequests.markFolderAsRead(na);},getIsThreadUnread:function(na,oa){var pa=oa||p.INBOX,qa=da(this,pa);return qa&&qa[na];}});Object.assign(aa,m);function ba(na,oa,pa){na._unreadResources[oa].setResource(w,pa);na._unreadResources[oa].setResource(x,Object.keys(pa));}function ca(na,oa,pa){var qa=na._unreadResources[oa].executeOrEnqueue(w,pa),ra=na._unreadResources[oa].getUnavailableResources(qa);if(ra.length)na._serverRequests.fetchUnreadThreadIDs(oa);}function da(na,oa){return na._unreadResources[oa].getResource(w);}function ea(na,oa){var pa=na._unreadResources[oa].getResource(x);if(pa){return pa.length;}else return na._initialUnreadCount[oa];}function fa(na,oa){var pa;(oa.unread_thread_fbids||[]).forEach(function(qa){pa=qa.folder;if(!ma(pa))return;var ra=qa.thread_fbids||[];ra=ra.concat(qa.other_user_fbids||[]);var sa=ja(na,ra);ba(na,pa,u(sa,true));if(sa.length>y)na._maxCount[pa]=true;na._threadInformer.updatedUnreadState();});(oa.message_counts||[]).forEach(function(qa){if(qa.unread_count===(void 0))return;pa=qa.folder;if(qa.unread_count>y){na._maxCount[pa]=true;ba(na,pa,{});na._threadInformer.updatedUnreadState();}else{na._initialUnreadCount[pa]=qa.unread_count;if(na._initialUnreadCount[pa]===0)ba(na,pa,{});na._threadInformer.updatedUnreadState();}});(oa.actions||[]).forEach(function(qa){if(qa.is_forward)return;var ra=j,sa=qa.other_user_fbid?qa.other_user_fbid:qa.thread_fbid,ta=qa.thread_id?qa.thread_id:sa;if(qa.action_type==ra.DELETE_THREAD){v.forEach(function(va){ha(na,va,ta);});}else if(qa.action_type==ra.CHANGE_ARCHIVED_STATUS||qa.action_type==ra.CHANGE_FOLDER){var ua=na._threads.getThreadMetaNow(qa.thread_id);pa=g.getFromMeta(ua);if(ma(pa)&&ua.unread_count>0)ga(na,pa,ta);v.forEach(function(va){if(va!=pa)ha(na,va,ta);});}else{pa=la(na,qa);if(!ma(pa))return;if(qa.action_type==ra.CHANGE_READ_STATUS){if(qa.mark_as_read){ha(na,pa,ta,qa.timestamp);}else ga(na,pa,ta,qa.timestamp);}else if(qa.action_type==ra.USER_GENERATED_MESSAGE||qa.action_type==ra.LOG_MESSAGE)if(qa.is_unread)ga(na,pa,ta,qa.timestamp);}});}function ga(na,oa,pa,qa){if(na._maxCount[oa])return;ca(na,oa,function(ra){var sa=na._allReadTimestamp[oa]||0,ta=na._threadReadTimestamp[pa]||0,ua=qa||Number.POSITIVE_INFINITY;if(ua>=sa&&ua>=ta&&!ra[pa]){ra[pa]=qa||0;ba(na,oa,ra);na._threadInformer.updatedUnreadState();}});}function ha(na,oa,pa,qa){if(na._maxCount[oa])return;ca(na,oa,function(ra){if(qa){var sa=na._threadReadTimestamp[pa];if(!sa||sa<qa)na._threadReadTimestamp[pa]=qa;}var ta=ra[pa];if(qa&&typeof ta=='number'&&qa<ta)return;if(pa in ra){delete ra[pa];ba(na,oa,ra);na._threadInformer.updatedUnreadState();}});}function ia(na,oa,pa){na._maxCount[oa]=false;ba(na,oa,{});na._allReadTimestamp[oa]=Math.max(na._allReadTimestamp[oa]||0,pa||0);na._threadInformer.updatedUnreadState();}function ja(na,oa){return oa.map(na._threadIDMap.convertThreadIDIfAvailable,na._threadIDMap);}function ka(na,oa){v.forEach(function(pa){var qa=da(na,pa);if(!qa)return;for(var ra in oa){var sa=oa[ra];if(qa[ra]){qa[sa]=qa[ra];delete qa[ra];}}ba(na,pa,qa);});}function la(na,oa){var pa=oa.thread_id?na._threads.getThreadMetaNow(oa.thread_id):null;return pa?g.getFromMeta(pa):oa.folder;}function ma(na){return t(v,na);}e.exports=aa;},null);
__d("MessagingReliabilityLogger",["PresenceUtil","MercuryServerDispatcher","MessagingReliabilityLoggerInitialData","isEmpty","setTimeoutAcrossTransitions"],function(a,b,c,d,e,f,g,h,i,j,k){b.__markCompiled&&b.__markCompiled();var l='/ajax/mercury/client_reliability.php',m=60000;function n(t,u){var v={app:i.app,categories:JSON.stringify(t)};if(!j(u))v.extra=JSON.stringify(u);return v;}function o(t,u,v,w){if(t[u]===(void 0))t[u]={};if(t[u][v]===(void 0))t[u][v]=0;t[u][v]+=w;}function p(t,u,v,w){if(t[u]===(void 0))t[u]={};if(t[u][v]===(void 0))t[u][v]=[];for(var x=0;x<w.length;++x)t[u][v].push(w[x]);}function q(t,u){if((t&&!t.categories)||(u&&!u.categories))return;var v=t?JSON.parse(t.categories):{},w=t&&t.extra?JSON.parse(t.extra):{},x=JSON.parse(u.categories),y=u.extra?JSON.parse(u.extra):{};for(var z in x){var aa=x[z],ba=y[z];for(var ca in aa){o(v,z,ca,aa[ca]);if(ba!==(void 0)){var da=ba[ca];if(da!==(void 0))p(w,z,ca,da);}}}return n(v,w);}var r={};r[l]={mode:h.BATCH_SUCCESSIVE_PIGGYBACK_ON_ERROR,batch_function:q};h.registerEndpoints(r);var s={addEntry:function(t,u,v){if(!i.enabled)return;var w={};o(w,t,u,1);var x={};if(v!==(void 0))p(x,t,u,[v]);h.trySend(l,n(w,x));}};(function t(){s.addEntry('page_event','active',g.getSessionID());k(t,m);})();e.exports=s;},null);