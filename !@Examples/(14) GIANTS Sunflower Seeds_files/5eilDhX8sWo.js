/*!CK:3752313228!*//*1437526175,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["DCfgA"]); }

__d("ChatTypeaheadEvent",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports={ABANDONED_QUERY:"abandoned_query",NEW_QUERY:"new_query",RESULT_SELECTED:"result_selected"};},null);
__d("PhotoResizeModeConst",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports={CONTAIN:"s",COVER:"p"};},null);
__d("ChatSidebarActions",["ChatDispatcher","keyMirror"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();'use strict';var i=h({INIT:null,HIDE:null,LOADED:null,SET_ENABLED:null,SHOW:null,TOGGLE:null}),j={Types:i,init:function(){g.dispatch({type:i.INIT});},loaded:function(){g.dispatch({type:i.LOADED});},disable:function(){g.dispatch({type:i.SET_ENABLED,enabled:false});},enable:function(){g.dispatch({type:i.SET_ENABLED,enabled:true});},hide:function(){g.dispatch({type:i.HIDE});},show:function(){g.dispatch({type:i.SHOW});},toggle:function(){g.dispatch({type:i.TOGGLE});}};e.exports=j;},null);
__d("ChatOptions",["Arbiter","ChannelConstants","ChatSidebarActions","JSLogger","PresenceUtil","ChatOptionsInitialData"],function(a,b,c,d,e,f,g,h,i,j,k){b.__markCompiled&&b.__markCompiled();var l=j.create('chat_options'),m={};(function(){var o=b('ChatOptionsInitialData');for(var p in o){var q=o[p];m[p]=!!q;}})();var n=Object.assign(new g(),{getSetting:function(o){return m[o];},setSetting:function(o,p,q){if(o==='sidebar_mode'){p?i.enable():i.disable();return;}if(this.getSetting(o)==p)return;if(q){q='from_'+q;l.log(q,{name:o,new_value:p,old_value:this.getSetting(o)});}m[o]=!!p;g.inform('chat/option-changed',{name:o,value:p});}});g.subscribe(h.getArbiterType('setting'),function(o,p){var q=p.obj;if(q.window_id===k.getSessionID())return;n.setSetting(q.setting,!!q.value,'channel');});g.subscribe(j.DUMP_EVENT,function(o,p){p.chat_options=m;});e.exports=n;},null);
__d("OrderedFriendsList",["AvailableListConstants","PresenceStatus","SearchableEntry","ShortProfiles","WorkModeConfig","createArrayFromMixed","isValidUniqueID","InitialChatFriendsList"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){b.__markCompiled&&b.__markCompiled();var n=[],o=[],p={},q=[],r={},s=[],t={contains:function(u){return u in p;},getList:function(){if(k.is_work_user)return l(n);t.reRank();var u=l(n);u=u.filter(function(v){var w=j.getNowUnsafe(v);return !w||w.type=="friend";});return u;},getSearchableEntries:function(u,v){var w=t.getList();j.getMulti(w.slice(0,u),function(x){var y=[];for(var z in x)y.push(t.normalizeProfileEntry(x[z]));var aa=t.getGroups().map(t.normalizeThreadEntry);v(y.concat(aa).filter(function(ba){return !!ba;}).sort(function(ba,ca){return ba.getOrder()-ca.getOrder();}));});},normalizeProfileEntry:function(u){var v=u.searchTokens||[];return new i({uniqueID:u.id,keywordString:v.join(' '),order:t.getRank(u.id),photo:u.thumbSrc,title:u.name,type:u.type,uri:u.uri,auxiliaryData:{isMessengerUser:u.is_messenger_user}});},normalizeThreadEntry:function(u,v){var w=u.mercury_thread,x=u.participants_to_render,y=u.text,z=null;if(!y)y=w.name;var aa=x.map(function(ca){return ca.name;}).join(', ');if(!y){y=aa;}else z=aa;var ba=u.uid;if(!y||!m(ba))return null;return new i({uniqueID:ba,order:v,photo:w.image_src,title:y,subtitle:z,type:'thread',auxiliaryData:{participantsToRender:x,thread:w}});},getRank:function(u){return u in p?p[u]:n.length;},getActiveList:function(){if(q.length>0)return q;return t.getList();},getActiveRank:function(u){return u in r?r[u]:t.getRank(u);},reRank:function(){n=[];var u=0;s.forEach(function(v){var w=v.slice(0,-2),x=v.slice(-1);if(h.get(w)==x){n[u]=w;p[w]=u++;}});},rankActive:function(){var u=0;s.forEach(function(v){var w=v.slice(0,-2),x=v.slice(-1);if(x==g.ACTIVE){q[u]=w;r[w]=u++;}});},getGroups:function(){return o;}};(function(){var u=b('InitialChatFriendsList');n=u.list.length?u.list:[];o=u.groups||[];if(!k.is_work_user){s=n.slice();t.rankActive();t.reRank();}else n.forEach(function(v,w){p[v]=w;});})();e.exports=a.OrderedFriendsList||t;},null);
__d("ChatTabActions",["ChatDispatcher","keyMirror"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();'use strict';var i=h({CLOSE_TAB:null,CLOSE_ALL_TABS:null,CLOSE_FRAGILE_TABS:null,LOWER_TAB:null,OPEN_FRAGILE_TAB:null,OPEN_TAB:null,PERSIST_LOCAL_STATE:null,PROMOTE_TAB:null,RAISE_TAB:null}),j={Types:i,closeTab:function(k,l){g.dispatch({actionType:i.CLOSE_TAB,reason:l,threadID:k});},closeAllTabs:function(){g.dispatch({actionType:i.CLOSE_ALL_TABS});},closeFragileTabs:function(){g.dispatch({actionType:i.CLOSE_FRAGILE_TABS});},lowerTab:function(k){g.dispatch({actionType:i.LOWER_TAB,threadID:k});},openFragileTab:function(k){g.dispatch({actionType:i.OPEN_FRAGILE_TAB,threadID:k});},openTab:function(k){g.dispatch({actionType:i.OPEN_TAB,threadID:k});},persistLocalState:function(){g.dispatch({actionType:i.PERSIST_LOCAL_STATE});},promoteTab:function(k){g.dispatch({actionType:i.PROMOTE_TAB,threadID:k});},raiseTab:function(k,l,m){g.dispatch({actionType:i.RAISE_TAB,signatureID:m,threadID:k,userAction:l});}};e.exports=j;},null);
__d("ChatSidebarComposeLink.react",["ChatOpenTab","React","TooltipLink.react","URI","fbt"],function(a,b,c,d,e,f,g,h,i,j,k){b.__markCompiled&&b.__markCompiled();var l=h,m=l.PropTypes,n=h.createClass({displayName:"ChatSidebarComposeLink",propTypes:{className:m.string.isRequired},componentDidMount:function(){g.listenOpenEmptyTab(h.findDOMNode(this),'sidebar');},render:function(){var o=k._("New Message");return (h.createElement(i,{ajaxify:new j('/ajax/messaging/composer.php'),className:this.props.className,tooltip:o,rel:"dialog"}));}});e.exports=n;},null);
__d("ChatSidebarStore",["ChatDispatcher","ChatOptionsInitialData","ChatSidebarActions","FluxStore","performanceAbsoluteNow"],function(a,b,c,d,e,f,g,h,i,j,k){b.__markCompiled&&b.__markCompiled();'use strict';for(var l in j)if(j.hasOwnProperty(l))n[l]=j[l];var m=j===null?null:j.prototype;n.prototype=Object.create(m);n.prototype.constructor=n;n.__superConstructor__=j;function n(){j.call(this,g);this.$ChatSidebarStore0={initialized:false,initTime:k(),loaded:false,visible:true,enabled:!!h.sidebar_mode};this.$ChatSidebarStore1={};}n.prototype.__onDispatch=function(o){var p=o.type;this.$ChatSidebarStore1=Object.assign({},this.$ChatSidebarStore0);switch(p){case i.Types.INIT:if(!this.$ChatSidebarStore1.initialized)this.$ChatSidebarStore0.initTime=k();this.$ChatSidebarStore0.initialized=true;break;case i.Types.HIDE:this.$ChatSidebarStore0.visible=false;break;case i.Types.LOADED:this.$ChatSidebarStore0.loaded=true;break;case i.Types.SHOW:this.$ChatSidebarStore0.visible=true;break;case i.Types.SET_ENABLED:this.$ChatSidebarStore0.enabled=o.enabled;break;case i.Types.TOGGLE:this.$ChatSidebarStore0.enabled=!this.$ChatSidebarStore0.enabled;break;}for(var q in this.$ChatSidebarStore0)if(this.$ChatSidebarStore0.hasOwnProperty(q))if(this.$ChatSidebarStore0[q]!==this.$ChatSidebarStore1[q]){this.__emitChange();break;}};n.prototype.getPrevState=function(){return this.$ChatSidebarStore1;};n.prototype.getState=function(){return this.$ChatSidebarStore0;};n.prototype.isInitialized=function(){return this.$ChatSidebarStore0.initialized;};n.prototype.isLoaded=function(){return this.$ChatSidebarStore0.loaded;};n.prototype.isHidden=function(){return !this.$ChatSidebarStore0.visible;};n.prototype.isEnabled=function(){return this.$ChatSidebarStore0.enabled;};n.prototype.getInitTime=function(){return this.$ChatSidebarStore0.initTime;};e.exports=new n();},null);
__d("ChatSidebarVisibility",["ChatConfig","ChatSidebarStore","DOMDimensions","OrderedFriendsList"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();'use strict';var k=g.get('sidebar.min_friends'),l=g.get('sidebar.minimum_width'),m=g.get('minisidebar.minimum_width'),n={getViewport:function(){return i.getViewportWithoutScrollbarDimensions();},hasLowFriendCount:function(){return j.getActiveList().length<=k;},isViewportCapable:function(){var o=n.getViewport();return o.width>l;},shouldShowSidebar:function(){return n.isViewportCapable()&&!h.isHidden()&&!n.hasLowFriendCount();},isViewportCapableForMiniSidebar:function(){var o=n.getViewport();return o.width>m&&o.width<=l;},shouldShowMiniSidebar:function(){return !g.get('divebar_new_design',false)&&n.isViewportCapableForMiniSidebar()&&!h.isHidden()&&!n.hasLowFriendCount();}};e.exports=n;},null);
__d("SidebarFitWindowHeight",["Arbiter","ArbiterMixin","Event","Style","SubscriptionsHandler","UITinyViewportAction","Vector","mixin","queryThenMutateDOM"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){b.__markCompiled&&b.__markCompiled();var p=n(h);for(var q in p)if(p.hasOwnProperty(q))s[q]=p[q];var r=p===null?null:p.prototype;s.prototype=Object.create(r);s.prototype.constructor=s;s.__superConstructor__=p;function s(t){"use strict";p.call(this);this.$SidebarFitWindowHeight0=t;this.onViewportUpdate();l.subscribe('change',this.onViewportUpdate.bind(this));}s.prototype.onViewportUpdate=function(){"use strict";if(l.isTiny()){this.onScroll();var t=this.onScroll.bind(this);this.$SidebarFitWindowHeight1=new k();this.$SidebarFitWindowHeight1.addSubscriptions(i.listen(window,'scroll',t),g.subscribe('dom-scroll',t));}else{if(this.$SidebarFitWindowHeight2!==0){j.set(this.$SidebarFitWindowHeight0,'margin-top','0');this.$SidebarFitWindowHeight2=0;}this.$SidebarFitWindowHeight1&&this.$SidebarFitWindowHeight1.release();}};s.prototype.onScroll=function(){"use strict";o(this.updateScrollPosition.bind(this),this.resizeSidebar.bind(this),'SidebarFitWindowHeight/scroll');};s.prototype.updateScrollPosition=function(){"use strict";this.$SidebarFitWindowHeight3=m.getScrollPosition().y;this.$SidebarFitWindowHeight4||(this.$SidebarFitWindowHeight4=this.$SidebarFitWindowHeight0.offsetHeight);};s.prototype.resizeSidebar=function(){"use strict";var t=-Math.max(Math.min(this.$SidebarFitWindowHeight3,this.$SidebarFitWindowHeight4),0);j.set(this.$SidebarFitWindowHeight0,'margin-top',t+'px');if(t!=this.$SidebarFitWindowHeight2){this.$SidebarFitWindowHeight2=t;this.inform('resized',t);}};s.prototype.getOffset=function(){"use strict";return this.$SidebarFitWindowHeight2;};e.exports=s;},null);
__d("ChatSidebar",["Arbiter","ArbiterMixin","AsyncRequest","BanzaiODS","Bootloader","ChatConfig","ChatImpressionLogger","ChatSidebarActions","ChatSidebarComposeLink.react","ChatSidebarStore","ChatSidebarVisibility","CSS","DOM","DOMDimensions","Event","JSLogger","LitestandClassicPlaceHolders","MercuryConfig","Parent","PresencePrivacy","React","ReactComponentRenderer","Run","ScrollableArea","SidebarFitWindowHeight","Style","ViewportBounds","createArrayFromMixed","csx","cx","debounce","emptyFunction","ge"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la,ma){b.__markCompiled&&b.__markCompiled();var na='chat_sidebar_visibility',oa,pa,qa=false,ra=false,sa,ta,ua,va,wa,xa,ya,za,ab=null,bb,cb=v.create('chat_sidebar');j.setEntitySample(na,.0001);function db(){r.removeClass(document.documentElement,'sidebarMode');if(!p.isInitialized()||(!nb.isVisible()&&!ra)){g.inform('reflow');ga.inform('change');return;}qa=false;ra=false;ab=null;xa.hide();za.getCore().reset();r.hide(va);r.hide(ta);r.hide(ua);r.removeClass(document.documentElement,'miniSidebar');r.removeClass(va,"_51xq");sa&&sa.setProps({shown:false},function(){return jb(false);});cb.log('minisidebar_hide');g.inform('sidebar/hide',nb);g.inform('reflow');ga.inform('change');}function eb(){var ob=q.shouldShowSidebar(),pb=q.shouldShowMiniSidebar();if(p.isEnabled()&&(ob||pb)){if(ob){hb();ib();}else kb();}else db();if(!p.isInitialized()){mb();n.init();}ab=null;}function fb(){if(za&&nb.isVisible())za.getCore().getElement().focus();}function gb(ob){var pb=q.getViewport().height;ob.forEach(function(qb){if(qb&&qb!==oa)pb-=t.getElementDimensions(qb).height;});if(bb)pb-=bb.getOffset();if(ya)pb-=t.getElementDimensions(ya).height;return Math.max(0,pb);}function hb(){if(nb.isVisible())return;r.hide(ta);r.show(ua);r.removeClass(document.documentElement,'miniSidebar');r.removeClass(va,"_51xq");sa&&sa.setProps({shown:false},function(){return jb(false);});qa=true;ra=false;ab=null;r.show(va);r.addClass(document.documentElement,'sidebarMode');xa.show();cb.log('sidebar_show');g.inform('sidebar/show',nb);w.destroy('sidebar');ga.inform('change');}function ib(){var ob=gb(ha(ua.childNodes)),pb=xa.getItemHeight(),qb=8,rb=Math.floor((ob-qb)/pb);fa.set(oa,'height',ob+'px');xa.setNumTopFriends(rb);if(x.ScrollableSidebarTypeaheadGK){za.getView().setMaxHeight(ob);}else{var sb=Math.floor((ob-qb)/pb);sb=(sb-2)>0?sb-2:0;za.getData().setMaxResults(sb);}g.inform('sidebar/resized',nb);g.inform('reflow');}function jb(ob){if(va===null)return;r.conditionClass(va,"_2e4g",ob);}function kb(){r.hide(ua);r.show(ta);r.show(va);r.addClass(document.documentElement,'sidebarMode');r.addClass(document.documentElement,'miniSidebar');r.addClass(va,"_51xq");var ob=gb([]);if(!sa){k.loadModules(["ChatMiniSidebar.react","ChatSearchSource"],function(pb,qb){if(!pa)pa=new qb({queryRequests:[{uri:'/ajax/mercury/composer_query.php'}]});sa=new ba(pb,ta);sa.setProps({dataSource:pa,height:ob,maxEntries:50,onClickSearch:jb,onToggleSidebar:nb.toggle,shown:true});});}else sa.setProps({height:ob,shown:true});qa=false;ra=true;w.destroy('sidebar');cb.log('minisidebar_show');g.inform('minisidebar/show',nb);g.inform('reflow');ga.inform('change');}function lb(){new i('/ajax/chat/settings.php').setHandler(la).setErrorHandler(la).setData({sidebar_mode:p.isEnabled()}).setAllowCrossPageTransition(true).send();}function mb(){var ob=true;if(!p.isEnabled()){cb.log('state_not_enabled');ob=false;}if(!q.isViewportCapable())if(!q.isViewportCapableForMiniSidebar()){cb.log('state_not_shown_viewport_mini');ob=false;}if(ob)j.bumpEntityKey(na,'state_viewport_can_show');if(p.isHidden()){cb.log('state_not_shown_hidden');ob=false;}if(q.hasLowFriendCount()){cb.log('state_not_shown_num_friends');ob=false;}var pb=ob?'state_shown':'state_not_shown';cb.log(pb);j.bumpEntityKey(na,pb);}var nb={init:function(ob,pb,qb,rb){nb.init=la;n.loaded();va=ob;xa=pb;za=qb;wa=rb;oa=s.find(ob,'div.fbChatSidebarBody');ta=s.find(ob,"._51x-");ua=s.find(ob,"._51x_");ya=s.find(ob,"._5qqe");var sb=s.find(ob,"._x1u");if(sb)aa.render(aa.createElement(o,{className:"_3a-4 _5q85"}),sb);if(l.get('sidebar_react_dropdown',false)){var tb=s.find(ob,"._1ltf");if(tb)ca.onAfterLoad(function(){k.loadModules(["ChatSidebarDropdown.react"],function(ub){aa.render(aa.createElement(ub,{isNormalSidebar:true,onToggleSidebar:function(){return n.toggle();}}),tb);});});}u.listen(window,'resize',eb);ca.onAfterLoad(function(){k.loadModules(["ChatSidebarSheet"],function(ub){var vb=new ub(ob);vb.subscribe('updated',eb);});});xa.setScrollContainer(y.byClass(xa.getRoot(),'uiScrollableAreaWrap'));xa.subscribe(['render','show','hide'],ka(function(ub){var vb=da.getInstance(xa.getRoot());vb&&vb.adjustGripper();}));g.subscribe('chat/option-changed',function(ub,vb){if(vb.name==='hide_groups')eb();});g.subscribe(['AppsDivebar/show-apps','AppsDivebar/hide-apps'],eb);qb.getCore().subscribe('sidebar/typeahead/active',nb.updateOnActiveTypeahead);qb.subscribe('reset',function(){if(!qb.getCore().getValue()&&!xa.isVisible())nb.updateOnActiveTypeahead(null,false);});g.subscribeOnce('buddylist-nub/initialized',function(ub,vb){u.listen(vb.getButton(),'click',function(event){var wb=p.isHidden();n.show();n.enable();var xb=q.shouldShowSidebar()||q.shouldShowMiniSidebar();if(wb&&!xb)n.hide();return !xb;});});z.subscribe('privacy-user-presence-changed',eb);eb();m.init(xa);ga.addPersistentRight(nb.getVisibleWidth);nb.inform('sidebar/initialized',nb,g.BEHAVIOR_PERSISTENT);g.inform('sidebar/initialized',nb,g.BEHAVIOR_PERSISTENT);bb=new ea(ya);bb.subscribe('resized',eb);p.addListener(function(){var ub=p.getState(),vb=p.getPrevState();if(ub.enabled!==vb.enabled){if(ub.enabled){eb();setTimeout(fb,0);}else db();lb();}});},updateOnActiveTypeahead:function(ob,pb){if(!qa)return;if(pb){xa.hide();}else{xa.show();eb();}},ensureLoaded:function(){if(!p.isEnabled())return;if(p.isLoaded())return;if(ma('pagelet_sidebar'))return;d(['UIPagelet'],function(ob){var pb=s.create('div',{id:'pagelet_sidebar'});s.appendContent(document.body,pb);ob.loadFromEndpoint('SidebarPagelet','pagelet_sidebar');});n.loaded();},hide:function(){if(p.isHidden())return;n.hide();db();},unhide:function(){if(!p.isHidden())return;n.show();eb();},getVisibleWidth:function(){if((!qa&&!ra)||!va)return 0;if(ab===null){ab=va.offsetWidth;if(ra)ab=206;}return ab;},isVisible:function(){return qa;},resize:eb,toggle:function(){n.toggle();}};Object.assign(nb,h);e.exports=nb;},null);
__d("ChatTypeaheadBehavior",["BanzaiLogger","ChatOpenTab","ChatTypeaheadEvent","CSS","MercuryTypeaheadConstants","Parent","Rect","cx"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){b.__markCompiled&&b.__markCompiled();function o(q,r){var s=l.byClass(q,"_4oes");if(s)j.conditionClass(s,"_5q83",r);}function p(q){"use strict";this._typeahead=q;this._loggedQuery=false;}p.prototype.enable=function(){"use strict";var q=this._typeahead;this._subscriptions=[q.subscribe('focus',function(){this._loggedQuery=false;q.getData().refreshData();o(q.getElement(),true);}.bind(this)),q.subscribe('blur',function(r){if(this._loggedQuery)g.log('ChatTypeaheadLoggerConfig',{event:i.ABANDONED_QUERY,max_results:q.getData().getMaxResults(),num_friend_results:q.getView().results.filter(function(s){return s.render_type===k.FRIEND_TYPE;}).length,query:q.getCore().value});q.getCore().reset();o(q.getElement(),false);this._loggedQuery=false;}.bind(this)),q.subscribe('respond',function(r,s){if(!this._loggedQuery&&q.getCore().getValue().length>0){g.log('ChatTypeaheadLoggerConfig',{event:i.NEW_QUERY});this._loggedQuery=true;}if(s.value&&s.value===q.getCore().getValue()){if(!s.results.length){var t=s.value.toLowerCase(),u=q.getData().getQueryCache();if(!s.isAsync&&!u.hasOwnProperty(t))return;q.getView().showNoResults();}j.addClass(q.getElement(),'hasValue');}}.bind(this)),q.subscribe('reset',function(){j.removeClass(q.getElement(),'hasValue');}),q.subscribe('select',function(r,s){var t=s.selected.uid;if(s.selected.mercury_thread&&!s.selected.mercury_thread.is_canonical)t=s.selected.mercury_thread.thread_fbid;q.getView().hide();g.log('ChatTypeaheadLoggerConfig',{event:i.RESULT_SELECTED,max_results:q.getData().getMaxResults(),result_type:s.selected.render_type});this._loggedQuery=false;h.openTabByType(t,s.selected.type,'typeahead');}.bind(this)),q.subscribe('highlight',function(r,s){if(s.index>=0){var t=q.getView().getItems()[s.index];if(t){var u=new m(t),v=t.offsetParent,w=u.boundWithin(new m(v)).getPositionVector();u.getPositionVector().sub(w).scrollElementBy(v);}}})];};p.prototype.disable=function(){"use strict";this._subscriptions.forEach(function(q){this._typeahead.unsubscribe(q);},this);this._subscriptions=null;};Object.assign(p.prototype,{_subscriptions:null});e.exports=p;},null);
__d("NubController",["ArbiterMixin","Dock"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();function i(){}Object.assign(i.prototype,g,{init:function(j){this.el=j;h.registerNubController(j,this);return this;},buttonContentChanged:function(){this.inform('nub/button/content-changed');},flyoutContentChanged:function(){this.inform('nub/flyout/content-changed');},hide:function(){h.hide(this.el);},show:function(){h.show(this.el);}});e.exports=i;},null);
__d("ChatActivity",["Event","Arbiter","AvailableList","AvailableListConstants","JSLogger","MercuryConfig","PresenceState","UserActivity"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){b.__markCompiled&&b.__markCompiled();var o=l.activity_limit||60000,p=l.idle_limit||1800000,q=l.idle_poll_interval||300000,r=k.create('chat_activity'),s=Date.now(),t=s,u=true;function v(){var z=Date.now();return !!(u&&(z-s<o));}var w=Object.assign(new h(),{isActive:v});function x(){var z=s;s=Date.now();if(s-z>p){r.debug('idle_to_active',z);m.doSync();}w.inform('activity');}i.subscribe(j.ON_AVAILABILITY_CHANGED,function(){if(!i.isUserIdle())t=Date.now();});g.listen(window,'focus',function(){u=true;x();});g.listen(window,'blur',function(){u=false;});n.subscribe(function(){x();});function y(z){var aa=z&&z.at&&m.verifyNumber(z.at);if(typeof aa!=='number')aa=null;return aa||0;}setInterval(function(){var z=Date.now(),aa=y(m.get()),ba=Math.max(s,aa,t);if(z-ba>p){r.debug('idle',{cookie:aa,local:s,presence:t});w.inform('idle',z-ba);}},q);m.registerStateStorer(function(z){var aa=y(z);if(aa<s)z.at=s;return z;});h.subscribe(k.DUMP_EVENT,function(z,aa){aa.chat_activity={activity_limit:o,idle_limit:p,idle_poll_interval:q,last_active_time:s,last_global_active_time:t};});e.exports=w;},null);
__d("ImageSourceType",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();var g={PROFILE_PICTURE:'profile_picture',IMAGE:'image'};e.exports=g;},null);
__d("ImageSourceRequest",["CurrentUser","ImageSourceType","KeyedCallbackManager","PhotoResizeModeConst","MercuryServerDispatcher","arrayContains"],function(a,b,c,d,e,f,g,h,i,j,k,l){b.__markCompiled&&b.__markCompiled();function m(){"use strict";this._request={fbid:null,type:null,width:null,height:null,resize_mode:null};this._callback=null;}m.prototype.setFBID=function(q){"use strict";this._request.fbid=q;return this;};m.prototype.setType=function(q){"use strict";if(!l([h.PROFILE_PICTURE,h.IMAGE],q))throw new TypeError('ImageSourceRequest.setType: invalid type '+q);this._request.type=q;return this;};m.prototype.setDimensions=function(q,r){"use strict";this._request.width=q;this._request.height=r;return this;};m.prototype.setResizeMode=function(q){"use strict";if(!l([j.COVER,j.CONTAIN],q))throw new TypeError('ImageSourceRequest.setResizeMode: invalid resize mode '+q);this._request.resize_mode=q;return this;};m.prototype.setCallback=function(q){"use strict";this._callback=q;return this;};m.prototype.send=function(){"use strict";if(!this._request.fbid||!this._request.width||!this._request.height||!this._request.type||!this._request.resize_mode||!this._callback)throw new Error('ImageSourceRequest: You must set all the fields');var q=o(),r=p(this._request);q.executeOrEnqueue(r,this._callback);if(q.getUnavailableResourcesFromRequest(r).length===1){k.trySend('/ajax/image_source.php',{requests:[this._request]});return true;}return false;};var n=null;function o(){if(n)return n;var q=new i();n=q;k.registerEndpoints({'/ajax/image_source.php':{request_user_id:g.getID(),mode:k.BATCH_DEFERRED_MULTI,batch_function:function(r,s){var t;(t=r.requests).push.apply(t,s.requests);return r;},handler:function(r,s){var t=s.getData().requests;for(var u=0;u<t.length;++u)q.setResource(p(t[u]),r[u]);}}});return q;}function p(q){return [q.fbid,q.type,q.width,q.height,q.resize_mode].join('|');}e.exports=m;},null);
__d("MercuryParticipantFetcher",["LogHistory","MercuryIDs","MercuryPayloadSource","MercuryServerPayloadPreprocessor","Set","ShortProfiles","setImmediate"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){b.__markCompiled&&b.__markCompiled();'use strict';var n=g.getInstance('short_profiles');function o(q){this.$MercuryParticipantFetcher0=j.getForFBID(q);this.$MercuryParticipantFetcher1=false;this.$MercuryParticipantFetcher2=new k();this.$MercuryParticipantFetcher3=new k();}o.prototype.fetch=function(q){this.$MercuryParticipantFetcher4(q);this.$MercuryParticipantFetcher5();};o.prototype.fetchMulti=function(q){q.forEach(function(r){return this.$MercuryParticipantFetcher4(r);}.bind(this));this.$MercuryParticipantFetcher5();};o.prototype.$MercuryParticipantFetcher4=function(q){if(!this.$MercuryParticipantFetcher3.has(q))this.$MercuryParticipantFetcher2.add(q);};o.prototype.$MercuryParticipantFetcher5=function(){if(this.$MercuryParticipantFetcher1||this.$MercuryParticipantFetcher2.size===0)return;this.$MercuryParticipantFetcher1=true;m(function(){this.$MercuryParticipantFetcher1=false;this.$MercuryParticipantFetcher2.forEach(function(q){return this.$MercuryParticipantFetcher3.add(q);}.bind(this));this.$MercuryParticipantFetcher6(this.$MercuryParticipantFetcher2,function(q){q.forEach(function(r){return this.$MercuryParticipantFetcher3["delete"](r.id);}.bind(this));this.$MercuryParticipantFetcher7(q);}.bind(this));this.$MercuryParticipantFetcher2.clear();}.bind(this));};o.prototype.$MercuryParticipantFetcher6=function(q,r){var s=[];q.forEach(function(t){var u=h.tokenize(t),v=u.type,w=u.value;v==='fbid'&&s.push(w);});if(s.length>0){l.getMulti(s,function(t){var u=[];for(var v in t)u.push(p(t[v],v));r(u);if(u.length!==s.length)n.error('server_fetch_participant_count_error',{expectedIDs:s,receivedIDs:Object.keys(t)});});n.debug('client_fetch_participants',{userIDs:s});}};o.prototype.$MercuryParticipantFetcher7=function(q){this.$MercuryParticipantFetcher0.handleUpdate({participants:q,from_client:false,payload_source:i.SERVER_FETCH_PARTICIPANTS});};function p(q,r){var s=Object.assign({gender:q.gender,fbid:q.id||r,href:q.uri,id:h.getParticipantIDFromUserID(q.id||r),image_src:q.thumbSrc,name:q.name,short_name:q.firstName,employee:q.employee,is_employee_away:q.is_employee_away,type:q.type,vanity:q.vanity,is_friend:q.is_friend,is_messenger_user:q.is_messenger_user,social_snippets:q.social_snippets},{});if(q.officeStatus){s.officeStatus=q.officeStatus;s.officeStatusStartDate=q.officeStatusStartDate;s.officeStatusEndDate=q.officeStatusEndDate;s.officeStatusComment=q.officeStatusComment;s.officeStatusLocation=q.officeStatusLocation;}return s;}e.exports=o;},null);
__d("MercuryVanityIDMap",["Map","MercuryAssert"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();'use strict';var i=new g(),j=new g(),k={getID:function(l){return i.get(l);},getVanity:function(l){return j.get(l);},hasID:function(l){return j.has(l);},hasVanity:function(l){return i.has(l);},set:function(l,m){h.isParticipantID(m);i.set(l,m);j.set(m,l);}};e.exports=k;},null);
__d("MercuryParticipants",["CurrentUser","EventEmitter","ImageSourceRequest","ImageSourceType","ImmutableObject","KeyedCallbackManager","MercuryAssert","MercuryIDs","MercuryParticipantFetcher","MercuryParticipantTypes","MercuryParticipantsConstants","MercuryDispatcher","MercuryVanityIDMap","PhotoResizeModeConst","Set","createObjectFrom","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w){b.__markCompiled&&b.__markCompiled();'use strict';var x='change';function y(aa){this.$MercuryParticipants0=aa;this.$MercuryParticipants1=new h();this.$MercuryParticipants2=new l();this.$MercuryParticipants3=new o(this.$MercuryParticipants0);this.$MercuryParticipants4=r.getForFBID(this.$MercuryParticipants0);this.$MercuryParticipants4.subscribe('update-participants',function(ba,ca){if(ca.participants&&ca.participants.length>0)this.$MercuryParticipants5(ca.participants);}.bind(this));}y.prototype.addListener=function(aa,ba){return this.$MercuryParticipants1.addListener(aa,ba);};y.prototype.getIDFromVanityOrFBID=function(aa){if(!aa)return null;if(s.hasVanity(aa))return s.getID(aa);if(/^\d+$/.test(aa))return n.getParticipantIDFromUserID(aa);};y.prototype.getNow=function(aa){return this.$MercuryParticipants6(aa);};y.prototype.getOrFetch=function(aa){var ba=this.$MercuryParticipants6(aa);if(!ba)this.$MercuryParticipants3.fetch(aa);return ba;};y.prototype.get=function(aa,ba){m.isParticipantID(aa);return this.$MercuryParticipants7([aa],function(ca){ba(ca[aa]);});};y.prototype.getMulti=function(aa,ba){return this.$MercuryParticipants7(aa,ba);};y.prototype.getBigImageMulti=function(aa,ba){m.allParticipantIDs(aa);var ca=q.BIG_IMAGE_SIZE;return this.$MercuryParticipants7(aa,function(da){var ea={},fa=0,ga=new u(),ha=function(la,ma){fa++;ea[la]=ma;if(fa===aa.length){ba(ea);if(ga.size>0)this.$MercuryParticipants8(ga);}}.bind(this),ia=function(la,ma){this.$MercuryParticipants2.setResource(la,k.set(this.$MercuryParticipants2.getResource(la),{big_image_src:ma.uri}));ga.add(la);ha(la,ma.uri);}.bind(this);for(var ja in da){var ka=da[ja];if(!ka.big_image_src){new i().setFBID(n.getUserIDFromParticipantID(ja)).setType(j.PROFILE_PICTURE).setDimensions(ca,ca).setResizeMode(t.COVER).setCallback(ia.bind(null,ja)).send();}else ha(ka.id,ka.big_image_src);}}.bind(this));};y.prototype.getOrderedBigImageMulti=function(aa,ba){return this.getBigImageMulti(aa,function(ca){ba(aa.map(function(da){return ca[da];}));});};y.prototype.$MercuryParticipants7=function(aa,ba){m.allParticipantIDs(aa);var ca=this.$MercuryParticipants2.executeOrEnqueue(aa,ba),da=this.$MercuryParticipants2.getUnavailableResources(ca).filter(function(ea){var fa=n.tokenize(ea),ga=fa.type,ha=fa.value;if(ga==='email'){this.$MercuryParticipants9(ea,ha);return false;}return true;}.bind(this));this.$MercuryParticipants3.fetchMulti(da);return this.$MercuryParticipantsa(ca);};y.prototype.$MercuryParticipants6=function(aa){var ba=this.$MercuryParticipants2.getResource(aa);if(!ba){var ca=n.tokenize(aa),da=ca.type,ea=ca.value;if(da==='email')ba=this.$MercuryParticipants9(aa,ea);}return ba;};y.prototype.$MercuryParticipants9=function(aa,ba){var ca=new k(z(aa,ba));this.$MercuryParticipants2.setResource(aa,ca);return ca;};y.prototype.$MercuryParticipants8=function(aa){this.$MercuryParticipants1.emit(x,aa);};y.prototype.$MercuryParticipants5=function(aa){var ba=aa.map(function(ca){return ca.id;});aa=aa.map(function(ca){if(ca.vanity)s.set(ca.vanity,ca.id);var da=this.$MercuryParticipants2.getResource(ca.id);return da?k.set(da,ca):new k(this.$MercuryParticipantsb(ca));}.bind(this));this.$MercuryParticipants2.addResourcesAndExecute(v(ba,aa));this.$MercuryParticipants8(new u(ba));};y.prototype.$MercuryParticipantsb=function(aa){var ba=aa.type===p.USER||aa.type===p.FRIEND;if(!ba)return aa;if(!aa.name&&!aa.href&&!aa.vanity){var ca=w._("Facebook User");aa.name=ca;aa.short_name=ca;}return aa;};y.prototype.$MercuryParticipantsa=function(aa){return {remove:function(){this.$MercuryParticipants2.unsubscribe(aa);}.bind(this)};};function z(aa,ba){return {gender:q.UNKNOWN_GENDER,href:null,id:aa,image_src:q.EMAIL_IMAGE,big_image_src:q.EMAIL_IMAGE,name:ba,short_name:ba,employee:false};}e.exports=new y(g.getID());},null);
__d("MercuryNotificationRenderer",["MercuryAssert","MercuryParticipants","MercuryViewer","fbt","MercuryMessages","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();var k=b('MercuryMessages').get(),l=b('MercuryThreads').get();function m(n,o){g.isThreadID(n);l.getThreadMeta(n,function(p){k.getThreadMessagesRange(n,0,1,function(q){var r=q.length&&q[q.length-1];if(r&&r.author!=i.getID()){h.get(r.author,function(s){if(p.name){o(j._("{senderName} messaged {groupName}",[j.param("senderName",s.short_name),j.param("groupName",p.name)]));}else o(j._("{name} messaged you",[j.param("name",s.short_name)]));});}else o(j._("New message!"));});});}e.exports={renderDocumentTitle:m};},null);
__d("MercuryTimestampTracker",["MercuryActionType","MercuryPayloadSource","MercurySingletonMixin","MercuryDispatcher"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();function k(l){this._fbid=l;this._dispatcher=j.getForFBID(this._fbid);this._lastTimestamp=0;this._dispatcher.subscribe('update-messages',function(m,n){if(!n.actions||!n.actions.length)return;if(n.payload_source==h.CLIENT_SEND_MESSAGE||n.payload_source==h.UNKNOWN)return;for(var o=0;o<n.actions.length;o++){var p=n.actions[o],q=p.action_type;if(q==g.USER_GENERATED_MESSAGE&&p.thread_id&&p.timestamp>this._lastTimestamp)this._lastTimestamp=p.timestamp;}}.bind(this));}Object.assign(k.prototype,{getLastUserMessageTimestamp:function(){return this._lastTimestamp;}});Object.assign(k,i);e.exports=k;},null);
__d("ChatTitleBarBlinker",["ChatActivity","ChatConfig","DocumentTitle","FavIcon","JSLogger","MercuryNotificationRenderer","PresenceState","MercuryThreadInformer","MercuryTimestampTracker"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){b.__markCompiled&&b.__markCompiled();var n=b('MercuryThreadInformer').get(),o=b('MercuryTimestampTracker').get(),p=k.create('chat_title'),q=null,r=0,s=false;if(h.get('unreadFavicon'))j.setToggleResources(h.get('unreadFaviconURL'));function t(){if(q){q.stop();q=null;return true;}return false;}function u(z){var aa=z||o.getLastUserMessageTimestamp();if(r<=aa){r=aa;if(t()||s)m.doSync();}if(h.get('unreadFavicon')&&j.isToggledResource())j.toggle();}var v={blink:function(z,aa){if(!q&&r<aa)l.renderDocumentTitle(z,function(ba){if(!q)q=i.blink(ba);});},stopBlinking:function(){u();},blinkingElsewhere:function(){s=true;}};function w(z){var aa=m.verifyNumber(z.sb2);if(!aa||aa<=r)return null;return aa;}function x(z){var aa=z&&w(z);if(aa){r=aa;p.debug('load',r);t();s=false;}}function y(z){var aa=w(z);if(!aa){p.debug('store',r);z.sb2=r;s=false;}return z;}m.registerStateStorer(y);m.registerStateLoader(x);n.subscribe('thread-read-changed',function(z,aa){var ba=o.getLastUserMessageTimestamp(),ca=0;for(var da in aa)if(aa[da].mark_as_read&&aa[da].timestamp>=ba&&aa[da].timestamp>ca)ca=aa[da].timestamp;ca&&u(ca);});g.subscribe('activity',function(){u();});(function(){var z=m.getInitial();if(z)r=w(z)||0;})();e.exports=v;},null);
__d("Sound",["SoundInitialData","SoundPlayer","SoundRPC","SoundSynchronizer","URI","UserAgent_DEPRECATED","isFacebookURI"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){b.__markCompiled&&b.__markCompiled();var n=null,o={init:function(s){if(!n)h.init(s);},play:function(s,t,u){if(n){i.playRemote(n.contentWindow,s,t,false);}else i.playLocal(s,t,u);},stop:function(s){if(!n)h.stop(s);}},p=new k(location.href);if(p.getSubdomain()&&p.getSubdomain()!=='www')p.setSubdomain('www');var q=p.getDomain();function r(){if(l.ie()<9)return false;if(g.RPC_DISABLED)return false;return j.isSupported()&&i.supportsRPC();}if(m(p)&&location.host!==q&&r()){n=document.createElement('iframe');n.setAttribute('src','//'+q+'/sound_iframe.php');n.style.display='none';document.body.appendChild(n);}e.exports=o;},null);
__d("MercuryBrowserAlerts",["ArbiterMixin","ChatActivity","ChatConfig","ChatOptions","ChatTitleBarBlinker","MercuryThreadInfo","MercuryIDs","MercuryConfig","MercuryViewer","MessagingTag","ShortProfiles","Sound","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){b.__markCompiled&&b.__markCompiled();var s=b('MercuryThreads').get();r.init(['audio/ogg','audio/mpeg']);function t(v){if(j.getSetting('sound'))r.play([i.get('sound.notif_ogg_url'),i.get('sound.notif_mp3_url')],v,false);}var u={messageReceived:function(v){if(o.isViewer(v.author)||!v.is_unread||(v.folder!=p.INBOX&&v.folder!=p.ARCHIVED))return;var w=v.thread_id,x=h.isActive();if(x){var y=false;u.inform('before-alert',{threadID:w,cancelAlert:function(){y=true;}});}s.getThreadMeta(w,function(z){var aa=l.isMuted(z),ba=m.getUserIDFromParticipantID(o.getID());q.get(ba,function(ca){var da=(new RegExp('@'+ca.firstName,'i')).test(v.body);if(aa&&(!n.GroupChatMentionsGK||!da))return;var ea=v.timestamp;if(x){!y&&t(ea);}else{k.blink(w,ea);t(ea);}k.blinkingElsewhere();});}.bind(this));}};e.exports=Object.assign(u,g);},null);
__d("FBRTCCallSummaryUploader",["Bootloader"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();var h={init:function(){g.loadModules(["Banzai","FBRTCCallSummary","FBRTCCallSummaryStore"],function(i,j,k){var l=k.getInstance();i.subscribe(i.SEND,function(){j.logSavedSummaries(l);});});}};e.exports=h;},null);
__d("FBRTCAvailability",["ChannelConstants","PresenceStatus"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();'use strict';var i={isCallable:function(j){var k=h.getCapabilities(j),l=g.CAPABILITY_VOIP_INTEROP|g.CAPABILITY_VIDEO;return !!(k&l);}};e.exports=i;},null);
__d("FBRTCStruct",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();var g=function(i,j,k){var l,m;if(typeof i=='string'||i instanceof String){m=i;l=i;}else for(var n in i)if(i.hasOwnProperty(n))if(n==='index'){k=i[n];}else{m=n;l=i[n];}j[m]=k;j.strNames[k]=l;};function h(i){"use strict";this.strNames=[];for(var j=0;j<i.length;j++)g(i[j],this,j);}e.exports=h;},null);
__d("FBRTCConstants",["FBRTCStruct"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();var h={OFFER:'offer',ANSWER:'answer',ICE_CANDIDATE:'ice_candidate',OK:'ok',PING:'ping',HANGUP:'hang_up',OTHER_DISMISS:'other_dismiss',MSG_ACK:'msg_ack',PRANSWER:'pranswer',ICERESTART_OFFER:'icerestart_offer',ICERESTART_ANSWER:'icerestart_answer',PCRESTART_OFFER:'pcrestart_offer',PCRESTART_ANSWER:'pcrestart_answer',SDP_UPDATE:'sdp_update',OFFER_ACK:'offer_ack',OFFER_NACK:'offer_nack',ANSWER_ACK:'answer_ack',SET_VIDEO:'set_video',VIDEO_REQUEST:'video_request',ACK:'ack'},i=new g([{IGNORE_CALL:'IgnoreCall'},{HANGUP_CALL:'HangupCall'},{IN_ANOTHER_CALL:'InAnotherCall'},{ACCEPT_AFTER_HANGUP:'CallEndAcceptAfterHangUp'},{NO_ANSWER_TIMEOUT:'NoAnswerTimeout'},{INCOMING_TIMEOUT:'IncomingTimeout'},{OTHER_INSTANCE_HANDLED:'OtherInstanceHandled'},{SIGNALING_MESSAGE_FAILED:'SignalingMessageFailed'},{CONNECTION_DROPPED:'ConnectionDropped'},{CLIENT_INTERRUPTED:'ClientInterrupted'},{WEBRTC_ERROR:'WebRTCError'},{CLIENT_ERROR:'ClientError'},{NO_PERMISSION:'NoPermission'},{OTHER_NOT_CAPABLE:'OtherNotCapable'},{NO_UI_ERROR:'NoUIShown'},{UNSUPPORTED_VERSION:'VersionUnsupported'},{CALLER_NOT_VISIBLE:'CallerNotVisible'},{CARRIER_BLOCKED:'CarrierBlocked'},{OTHER_CARRIER_BLOCKED:'OtherCarrierBlocked'}]),j={TOGGLE_SELF_VIEW:5,SUBMIT_STAR_RATING:6,SUBMIT_FEEDBACK:7,START_CALL:9,OPEN_SCREEN_IN_NEW:10},k={PayloadType:h,CallEndReason:i,UIEventType:j,endCallReasonFromString:function(l){return i.strNames.indexOf(l);},callEndReasonString:function(l){if(l<0||l>i.strNames.length)return 'Unknown';return i.strNames[l];},fullCallEndReasonString:function(l,m){return this.callEndReasonString(l)+'_'+(m?'remote':'local');}};e.exports=k;},null);
__d("FBRTCIceStatsParser",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();var g=null;h.getInstance=function(){"use strict";if(!g)g=new h();return g;};function h(){"use strict";}h.prototype.extractIceInfo=function(i){"use strict";var j=[],k=i.split("\r\n");for(var l=0;l<k.length;l++){var m=k[l];if(this.$FBRTCIceStatsParser0(m))j.push({gen:this.$FBRTCIceStatsParser1(m),type:this.$FBRTCIceStatsParser2(m)});}return j;};h.prototype.$FBRTCIceStatsParser0=function(i){"use strict";return (i.indexOf('candidate:')>-1);};h.prototype.$FBRTCIceStatsParser1=function(i){"use strict";var j=0,k=i.match(/generation (\d+)/);if(k)j=parseInt(k[1],10);return j;};h.prototype.$FBRTCIceStatsParser2=function(i){"use strict";var j=i.match(/typ (host|relay|srflx|prflx)/);if(j){return j[1];}else return 'unknown';};e.exports=h;},null);
__d("FBRTCLogger",["Log","LogHistory","MarauderLogger","formatDate","pageID"],function(a,b,c,d,e,f,g,h,i,j,k){b.__markCompiled&&b.__markCompiled();var l='webrtc',m='sent_message',n='received_message',o='send_succeeded',p='send_failed',q='info',r='call_action',s='client_event',t='client_error',u='type',v='msg_id',w='ack_msg_id',x='call_id',y='from',z='to',aa='content',ba='tag',ca='peer_id',da='error_code',ea='trigger',fa='endcallstats',ga=null;ha.getInstance=function(){"use strict";if(!ga)ga=new ha();return ga;};function ha(){"use strict";this.$FBRTCLogger0=h.getInstance(l);}ha.prototype.logToConsole=function(ia){"use strict";var ja='Console';this.$FBRTCLogger1(null,null,ja,ia);this.$FBRTCLogger0.log(ja,ia);};ha.prototype.logReceivedMessage=function(ia,ja,ka){"use strict";var la={};la[y]=ia;la[x]=ja;la[u]=ka.type;la[v]=ka.msg_id;if(ka.sdp)la[aa]=ka.sdp;if(ka.ack_id)la[w]=ka.ack_id;this.$FBRTCLogger2(n,la);this.$FBRTCLogger1(ia,ja,'Received',ka.type+', '+ka.msg_id);};ha.prototype.logSentMessage=function(ia,ja,ka){"use strict";var la={};la[z]=ia;la[x]=ja;la[u]=ka.type;la[v]=ka.msg_id;if(ka.sdp)la[aa]=ka.sdp;if(ka.ack_id)la[w]=ka.ack_id;this.$FBRTCLogger2(m,la);this.$FBRTCLogger1(ia,ja,'Sent',ka.type+', '+ka.msg_id);};ha.prototype.logSentMessageSuccess=function(ia,ja,ka,la){"use strict";var ma={};ma[ca]=ia;ma[x]=ja;ma[u]=ka;ma[v]=la;this.$FBRTCLogger2(o,ma);};ha.prototype.logSentMessageFailure=function(ia,ja,ka,la,ma){"use strict";var na={};na[ca]=ia;na[x]=ja;na[u]=ka;na[v]=la;na[da]=ma;this.$FBRTCLogger2(p,na);this.$FBRTCLogger1(ia,ja,'Send Failed',ka+', '+ma);};ha.prototype.logCallAction=function(ia,ja,ka,la,ma){"use strict";var na={};na[ca]=ia;na[x]=ja;na[r]=ka;na[aa]=la;if(ma)na[ea]=ma;this.$FBRTCLogger2(r,na);this.$FBRTCLogger1(ia,ja,'CallAction',ka+', '+la);};ha.prototype.logEvent=function(ia,ja,event){"use strict";var ka={};ka[ca]=ia;ka[x]=ja;ka[aa]=event;this.$FBRTCLogger2(s,ka);this.$FBRTCLogger1(ia,ja,'Event',event);};ha.prototype.logInfo=function(ia,ja,ka){"use strict";var la={};la[ca]=ia;la[x]=ja;la[aa]=ka;this.$FBRTCLogger2(q,la);this.$FBRTCLogger1(ia,ja,'Info',ka);};ha.prototype.logError=function(ia,ja,ka){"use strict";var la={};la[ca]=ia;la[x]=ja;la[aa]=ka;this.$FBRTCLogger2(t,la);this.$FBRTCLogger1(ia,ja,'Error',ka);};ha.prototype.logErrorWithoutID=function(ia){"use strict";this.logError(null,null,ia);};ha.prototype.logEndCallSummary=function(ia){"use strict";if(!ia)return;var ja={};ja[ca]=ia.peerID;ja[x]=ia.callID;ja[ba]=fa;ja[aa]=ia.toString();var ka=ia.getExtraInfo();for(var la in ka)if(ka.hasOwnProperty(la))ja[la]=ka[la];this.$FBRTCLogger2(q,ja);this.$FBRTCLogger1(ia.peerID,ia.callID,'Call Summary',ja);};ha.prototype.$FBRTCLogger2=function(ia,ja){"use strict";ja.page_id=k;this.$FBRTCLogger0.log(ia,ja);i.log(ia,l,ja);};ha.prototype.$FBRTCLogger1=function(ia,ja,ka,la){"use strict";};ha.CallAction={START_CALL:'start_call',RECEIVED_CALL:'received_call',ANSWER_CALL:'answer_call',END_CALL:'end_call',DENIED_PERMISSION:'denied_permission',SET_MUTE:'set_mute',SET_VIDEO_ON:'set_video_on',SET_SELF_VIEW_ON:'set_self_view_on',SET_FULLSCREEN_ON:'set_fullscreen_on',START_SKYPE:'start_skype',TRY_NEW:'try_new',OPEN_POPUP:'open_popup',POPUP_OPENED:'popup_opened',AUTO_DISABLE_VIDEO:'auto_disable_video',FAILED_GETTING_URI:'failed_getting_uri',OLD_URI:'old_uri',USER_SETTINGS_CHANGED:'user_settings_changed'};ha.Trigger={ADMIN_MESSAGE:'admin_message',CHAT_TAB_ICON:'chat_tab_icon',CHAT_TAB_ICON_TOUR:'chat_tab_icon_tour',CHAT_TAB_VOICE_ICON:'chat_tab_voice_icon',SKYPE_DEPRECATION_DIALOG:'skype_deprecation_dialog',REDIAL_BUTTON:'redial_button',RETURN_CALL:'return_call',WEB_MESSENGER:'web_messenger',POPUP_CALL_START_BUTTON:'popup_start_call_button',TIMELINE_PROFILE:'timeline_profile',UNKNOWN:'unknown'};ha.Key={DEVICE_INFO:'device_info',RATING:'rating5',RATING_SHOWN:'rating_shown',SURVEY_CHOICE:'survey_choice',SURVEY_DETAILS:'survey_details',SURVEY_SHOWN:'survey_shown',INITIATED_BY_PAGE_ID:'initiated_by_page_id',PEER_IS_MOBILE:'peer_is_mobile'};e.exports=ha;},null);
__d("FBRTCCallSummary",["FBRTCConstants","FBRTCIceStatsParser","FBRTCLogger","UserAgentData","performanceNow"],function(a,b,c,d,e,f,g,h,i,j,k){b.__markCompiled&&b.__markCompiled();var l=5*60*1000,m={CALL_STARTED:'started',POPUP_OPENED:'opened',SENT_OFFER:'s_o',RECV_OFFER:'r_o',SENT_OFFER_ACK:'s_oack',RECV_OFFER_ACK:'r_oack',SENT_RETRIED_OFFER:'s_o2',RECV_RETRIED_OFFER:'r_o2',SENT_RETRIED_OFFER_ACK:'s_oack2',RECV_RETRIED_OFFER_ACK:'r_oack2',SENT_PRANSWER:'s_pr',RECV_PRANSWER:'r_pr',NETWORK_READY:'network_ready',SENT_ANSWER:'s_a',RECV_ANSWER:'r_a',SENT_ANSWER_ACK:'s_aack',RECV_ANSWER_ACK:'r_aack',SENT_RETRIED_ANSWER:'s_a2',RECV_RETRIED_ANSWER:'r_a2',SENT_RETRIED_ANSWER_ACK:'s_aack2',RECV_RETRIED_ANSWER_ACK:'r_aack2',SENT_OK:'s_ok',RECV_OK:'r_ok',CALL_CONNECTED:'connected',CALL_ENDED:'ended'};n.CURRENT_SUMMARY_VERSION=19;function n(o){"use strict";this.peerID=o.peerID;this.callID=o.callID;this.$FBRTCCallSummary0=o.isCaller;this.$FBRTCCallSummary1=(new Date()).valueOf();this.$FBRTCCallSummary2=null;this.$FBRTCCallSummary3={};this.$FBRTCCallSummary4=null;this.$FBRTCCallSummary5=null;this.$FBRTCCallSummary6=null;this.$FBRTCCallSummary7=null;this.$FBRTCCallSummary8=null;this.$FBRTCCallSummary9=null;this.$FBRTCCallSummarya={};this.$FBRTCCallSummaryb={};this.$FBRTCCallSummaryc={};this.$FBRTCCallSummaryd={};this.$FBRTCCallSummarye={};this.$FBRTCCallSummaryf={};this.$FBRTCCallSummaryg=k();this.$FBRTCCallSummaryh=0;this.$FBRTCCallSummaryi={};this.$FBRTCCallSummaryj=this.$FBRTCCallSummaryg;this.$FBRTCCallSummaryk=0;this.$FBRTCCallSummaryl={};this.addExtraInfo(i.Key.DEVICE_INFO,this.$FBRTCCallSummarym());this.$FBRTCCallSummaryn();this.$FBRTCCallSummaryo=h.getInstance();this.$FBRTCCallSummaryp=i.getInstance();}n.prototype.toJsonString=function(){"use strict";this.$FBRTCCallSummary8=(new Date()).valueOf();return JSON.stringify({version:n.CURRENT_SUMMARY_VERSION,peerID:this.peerID,callID:this.callID,isCaller:this.$FBRTCCallSummary0,callType:this.$FBRTCCallSummaryq,localVideoDuration:this.$FBRTCCallSummaryr,remoteVideoDuration:this.$FBRTCCallSummarys,startTime:this.$FBRTCCallSummary1,trigger:this.$FBRTCCallSummary2,signalingTime:this.$FBRTCCallSummary3,endCallReason:this.$FBRTCCallSummary4,endCallSubreason:this.$FBRTCCallSummary5,isRemoteEnded:this.$FBRTCCallSummary6,lastUpdatedTime:this.$FBRTCCallSummary7,lastSerializedTime:this.$FBRTCCallSummary8,unsetOnRetrieve:this.$FBRTCCallSummary9,openCount:this.$FBRTCCallSummaryk,extraInfo:this.$FBRTCCallSummaryl,pcStats:this.$FBRTCCallSummarya,captureStats:this.$FBRTCCallSummaryb,gen0IceSentCount:this.$FBRTCCallSummaryc,gen0IceReceivedCount:this.$FBRTCCallSummaryd,iceSentCount:this.$FBRTCCallSummarye,iceReceivedCount:this.$FBRTCCallSummaryf,newSignalingTime:this.$FBRTCCallSummaryi,accumulatedCallTime:this.$FBRTCCallSummaryt()});};n.fromJsonString=function(o){"use strict";var p;try{p=JSON.parse(o);}catch(q){return null;}if(p.version!==n.CURRENT_SUMMARY_VERSION)return null;if(!p.hasOwnProperty('peerID')||!p.hasOwnProperty('callID')||!p.hasOwnProperty('isCaller')||!p.hasOwnProperty('startTime')||!p.hasOwnProperty('trigger')||!p.hasOwnProperty('signalingTime')||!p.hasOwnProperty('endCallReason')||!p.hasOwnProperty('isRemoteEnded')||!p.hasOwnProperty('lastUpdatedTime')||!p.hasOwnProperty('lastSerializedTime'))return null;var r=new n({peerID:p.peerID,callID:p.callID,isCaller:p.isCaller});r.$FBRTCCallSummary1=p.startTime;r.$FBRTCCallSummary2=p.trigger;r.$FBRTCCallSummary3=p.signalingTime;r.$FBRTCCallSummary4=p.endCallReason;r.$FBRTCCallSummary5=p.endCallSubreason;r.$FBRTCCallSummary6=p.isRemoteEnded;r.$FBRTCCallSummary7=p.lastUpdatedTime;r.$FBRTCCallSummary8=p.lastSerializedTime;if(p.callType)r.$FBRTCCallSummaryq=p.callType;if(p.localVideoDuration)r.$FBRTCCallSummaryr=p.localVideoDuration;if(p.remoteVideoDuration)r.$FBRTCCallSummarys=p.remoteVideoDuration;if(p.unsetOnRetrieve)r.$FBRTCCallSummary9=p.unsetOnRetrieve;if(p.openCount)r.$FBRTCCallSummaryk=p.openCount;if(p.extraInfo)r.$FBRTCCallSummaryl=p.extraInfo;if(p.pcStats)r.$FBRTCCallSummarya=p.pcStats;if(p.captureStats)r.$FBRTCCallSummaryb=p.captureStats;if(p.gen0IceSentCount)r.$FBRTCCallSummaryc=p.gen0IceSentCount;if(p.gen0IceReceivedCount)r.$FBRTCCallSummaryd=p.gen0IceReceivedCount;if(p.iceSentCount)r.$FBRTCCallSummarye=p.iceSentCount;if(p.iceReceivedCount)r.$FBRTCCallSummaryf=p.iceReceivedCount;if(p.newSignalingTime)r.$FBRTCCallSummaryi=p.newSignalingTime;if(p.accumulatedCallTime)r.$FBRTCCallSummaryh=p.accumulatedCallTime;return r;};n.restoreOrInitialize=function(o,p,q,r,s){"use strict";var t=o.retrieveCallSummary(p,q);if(!t){t=new n({peerID:p,callID:q,isCaller:r});if(s){t.onFullMessageReceived({msg:s});t.onOfferAckSent(s);}else t.onCallStarted(i.Trigger.UNKNOWN);i.getInstance().logError(p,q,'Missing call summary from storage');}else if(t.$FBRTCCallSummary9){t.$FBRTCCallSummary4=null;t.$FBRTCCallSummary5=null;t.$FBRTCCallSummary6=null;delete t.$FBRTCCallSummary3[m.CALL_ENDED];delete t.$FBRTCCallSummaryi[m.CALL_ENDED];t.$FBRTCCallSummary9=null;}return t;};n.logSavedSummaries=function(o){"use strict";var p=o.getLoggableSummaries(),q=p.length;if(q<=0)return;var r=i.getInstance(),s=[];for(var t=0;t<q;t++){var u=p[t];r.logEndCallSummary(u);s.push({peerID:u.peerID,callID:u.callID});}o.removeCallSummaries(s);r.logToConsole('Logged pending summaries: '+q);};n.prototype.save=function(o){"use strict";var p=k(),q=p-this.$FBRTCCallSummaryj;if(q>l){this.$FBRTCCallSummaryp.logInfo(this.peerID,this.callID,'Summary too old: '+q);return;}o.storeCallSummary(this.peerID,this.callID,this);this.$FBRTCCallSummaryj=p;};n.prototype.getLastUpdatedTime=function(){"use strict";return this.$FBRTCCallSummary7;};n.prototype.setLastUpdatedTime=function(o){"use strict";this.$FBRTCCallSummary7=o;};n.prototype.getExtraInfo=function(){"use strict";return this.$FBRTCCallSummaryl;};n.prototype.addExtraInfo=function(o,p){"use strict";this.$FBRTCCallSummaryl[o]=p;this.$FBRTCCallSummaryn();};n.prototype.onCallStarted=function(o){"use strict";this.$FBRTCCallSummary2=o;this.$FBRTCCallSummaryu(m.CALL_STARTED);this.$FBRTCCallSummaryn();};n.prototype.onPopupOpened=function(){"use strict";this.$FBRTCCallSummaryu(m.POPUP_OPENED);this.$FBRTCCallSummaryk++;this.$FBRTCCallSummaryn();};n.prototype.setPcStats=function(o){"use strict";this.$FBRTCCallSummarya=o;this.$FBRTCCallSummaryn();};n.prototype.setVideoCaptureStats=function(o,p){"use strict";this.$FBRTCCallSummaryb={w:o,h:p};this.$FBRTCCallSummaryn();};n.prototype.setCallType=function(o){"use strict";this.$FBRTCCallSummaryq=o;this.$FBRTCCallSummaryn();};n.prototype.setVideoDurations=function(o,p){"use strict";this.$FBRTCCallSummaryr=o;this.$FBRTCCallSummarys=p;this.$FBRTCCallSummaryn();};n.prototype.onOfferAckSent=function(o){"use strict";this.onMessageSent({type:g.PayloadType.OFFER_ACK,flag:o.flag});};n.prototype.onMessageSent=function(o){"use strict";var p=o.flag===1;switch(o.type){case g.PayloadType.OFFER:this.$FBRTCCallSummaryv(p,m.SENT_OFFER,m.SENT_RETRIED_OFFER);this.$FBRTCCallSummaryw(o,this.$FBRTCCallSummaryc,this.$FBRTCCallSummarye);break;case g.PayloadType.ANSWER:this.$FBRTCCallSummaryv(p,m.SENT_ANSWER,m.SENT_RETRIED_ANSWER);this.$FBRTCCallSummaryw(o,this.$FBRTCCallSummaryc,this.$FBRTCCallSummarye);break;case g.PayloadType.OK:this.$FBRTCCallSummaryu(m.SENT_OK);break;case g.PayloadType.PRANSWER:this.$FBRTCCallSummaryu(m.SENT_PRANSWER);break;case g.PayloadType.OFFER_ACK:this.$FBRTCCallSummaryv(p,m.SENT_OFFER_ACK,m.SENT_RETRIED_OFFER_ACK);break;case g.PayloadType.ANSWER_ACK:this.$FBRTCCallSummaryv(p,m.SENT_ANSWER_ACK,m.SENT_RETRIED_ANSWER_ACK);break;case g.PayloadType.ICE_CANDIDATE:this.$FBRTCCallSummaryw(o,this.$FBRTCCallSummaryc,this.$FBRTCCallSummarye);break;default:}this.$FBRTCCallSummaryn();};n.prototype.$FBRTCCallSummaryw=function(o,p,q){"use strict";var r=null,s=null,t=this.$FBRTCCallSummaryo.extractIceInfo(o.sdp);for(var u=0;u<t.length;u++){r=t[u].gen;s=t[u].type;if(r===0)this.$FBRTCCallSummaryx(p,s);this.$FBRTCCallSummaryx(q,s);}};n.prototype.$FBRTCCallSummaryx=function(o,p){"use strict";if(!o[p]){o[p]=1;}else o[p]=o[p]+1;};n.prototype.$FBRTCCallSummaryy=function(o){"use strict";if(o.isFromMobile())this.addExtraInfo(i.Key.PEER_IS_MOBILE,'1');};n.prototype.onFullMessageReceived=function(o){"use strict";var p=o.msg,q=p.flag===1;switch(p.type){case g.PayloadType.OFFER:this.$FBRTCCallSummaryy(o);this.$FBRTCCallSummaryv(q,m.RECV_OFFER,m.RECV_RETRIED_OFFER);this.$FBRTCCallSummaryw(p,this.$FBRTCCallSummaryd,this.$FBRTCCallSummaryf);break;case g.PayloadType.ANSWER:this.$FBRTCCallSummaryy(o);this.$FBRTCCallSummaryv(q,m.RECV_ANSWER,m.RECV_RETRIED_ANSWER);this.$FBRTCCallSummaryw(p,this.$FBRTCCallSummaryd,this.$FBRTCCallSummaryf);break;case g.PayloadType.OK:this.$FBRTCCallSummaryu(m.RECV_OK);break;case g.PayloadType.PRANSWER:this.$FBRTCCallSummaryu(m.RECV_PRANSWER);break;case g.PayloadType.OFFER_ACK:this.$FBRTCCallSummaryv(q,m.RECV_OFFER_ACK,m.RECV_RETRIED_OFFER_ACK);break;case g.PayloadType.ANSWER_ACK:this.$FBRTCCallSummaryv(q,m.RECV_ANSWER_ACK,m.RECV_RETRIED_ANSWER_ACK);break;case g.PayloadType.ICE_CANDIDATE:this.$FBRTCCallSummaryw(p,this.$FBRTCCallSummaryd,this.$FBRTCCallSummaryf);break;default:}this.$FBRTCCallSummaryn();};n.prototype.onMsgAckReceived=function(o,p){"use strict";var q=o.msg.flag===1;if(p){this.$FBRTCCallSummaryv(q,m.RECV_OFFER_ACK,m.RECV_RETRIED_OFFER_ACK);}else this.$FBRTCCallSummaryv(q,m.RECV_ANSWER_ACK,m.RECV_RETRIED_ANSWER_ACK);};n.prototype.onCallConnected=function(){"use strict";this.$FBRTCCallSummaryu(m.NETWORK_READY);this.$FBRTCCallSummaryu(m.CALL_CONNECTED);this.$FBRTCCallSummaryn();};n.prototype.onCallEnded=function(o,p,q,r){"use strict";this.$FBRTCCallSummary9=q;this.$FBRTCCallSummary4=o;this.$FBRTCCallSummary5=r;this.$FBRTCCallSummary6=p;this.$FBRTCCallSummaryu(m.CALL_ENDED);this.$FBRTCCallSummaryn();};n.prototype.toString=function(){"use strict";var o={};o.core_metrics=this.$FBRTCCallSummaryz();o.time_series=null;return JSON.stringify(o);};n.prototype.$FBRTCCallSummaryz=function(){"use strict";var o={};o.ver=n.CURRENT_SUMMARY_VERSION;o.caller=this.$FBRTCCallSummary0;o.call_type=this.$FBRTCCallSummaryq;o.conn=this.$FBRTCCallSummaryA();o.peer_id=this.peerID;o.has_video=true;o.open_count=this.$FBRTCCallSummaryk;o.signaling=this.$FBRTCCallSummaryB();o.sender=this.$FBRTCCallSummaryC();o.receiver=this.$FBRTCCallSummaryD();o.end=this.$FBRTCCallSummaryE();o.video=this.$FBRTCCallSummaryF();return o;};n.prototype.$FBRTCCallSummaryA=function(){"use strict";var o={dtls:1};if(this.$FBRTCCallSummarya.sender&&this.$FBRTCCallSummarya.sender.rtt)o.rtt=this.$FBRTCCallSummarya.sender.rtt;return o;};n.prototype.$FBRTCCallSummaryB=function(){"use strict";var o={};if(this.$FBRTCCallSummary2)o.trigger=this.$FBRTCCallSummary2;o.start_time=this.$FBRTCCallSummary1;o.time_from_start=this.$FBRTCCallSummary3;var p=this.$FBRTCCallSummary3[m.CALL_CONNECTED],q=this.$FBRTCCallSummary3[m.CALL_ENDED];if(p){if(!q)if(this.$FBRTCCallSummary8){q=this.$FBRTCCallSummary8-this.$FBRTCCallSummary1;}else q=this.$FBRTCCallSummaryG();var r=q-p;if(r>0)o.duration=r;}o.new_time_from_start=this.$FBRTCCallSummaryi;p=this.$FBRTCCallSummaryi[m.CALL_CONNECTED];q=this.$FBRTCCallSummaryi[m.CALL_ENDED];if(p){if(!q)if(this.$FBRTCCallSummaryh>0){q=this.$FBRTCCallSummaryh;}else q=this.$FBRTCCallSummaryt();r=q-p;if(r>0)o.new_duration=r;}return o;};n.prototype.$FBRTCCallSummaryC=function(){"use strict";var o={};if(this.$FBRTCCallSummaryc)o.ice_g0=this.$FBRTCCallSummaryc;if(this.$FBRTCCallSummarye)o.ice=this.$FBRTCCallSummarye;if(this.$FBRTCCallSummarya.sender)Object.assign(o,this.$FBRTCCallSummarya.sender);return o;};n.prototype.$FBRTCCallSummaryD=function(){"use strict";var o={};if(this.$FBRTCCallSummaryd)o.ice_g0=this.$FBRTCCallSummaryd;if(this.$FBRTCCallSummaryf)o.ice=this.$FBRTCCallSummaryf;return o;};n.prototype.$FBRTCCallSummaryE=function(){"use strict";var o={};if(this.$FBRTCCallSummary4!==null){o.end_call_reason_string=g.callEndReasonString(this.$FBRTCCallSummary4);if(this.$FBRTCCallSummary5!==null)o.end_call_subreason_string=this.$FBRTCCallSummary5;o.remote_ended=this.$FBRTCCallSummary6;}if(this.$FBRTCCallSummarya.end)Object.assign(o,this.$FBRTCCallSummarya.end);return o;};n.prototype.$FBRTCCallSummaryF=function(){"use strict";var o={capture:{}};if(this.$FBRTCCallSummarya.video&&this.$FBRTCCallSummarya.video.sender)Object.assign(o,this.$FBRTCCallSummarya.video.sender);if(this.$FBRTCCallSummaryb)Object.assign(o.capture,this.$FBRTCCallSummaryb);return {sender:o,ld:this.$FBRTCCallSummaryr,rd:this.$FBRTCCallSummarys};};n.prototype.$FBRTCCallSummaryG=function(){"use strict";return (new Date()).valueOf()-this.$FBRTCCallSummary1;};n.prototype.$FBRTCCallSummaryt=function(){"use strict";var o=k()-this.$FBRTCCallSummaryg;return Math.floor(this.$FBRTCCallSummaryh+o);};n.prototype.$FBRTCCallSummaryu=function(o){"use strict";if(this.$FBRTCCallSummary3[o])return;this.$FBRTCCallSummary3[o]=this.$FBRTCCallSummaryG();this.$FBRTCCallSummaryi[o]=this.$FBRTCCallSummaryt();};n.prototype.$FBRTCCallSummaryv=function(o,p,q){"use strict";if(o){this.$FBRTCCallSummaryu(q);}else this.$FBRTCCallSummaryu(p);};n.prototype.$FBRTCCallSummaryn=function(){"use strict";this.$FBRTCCallSummary7=(new Date()).valueOf();};n.prototype.$FBRTCCallSummarym=function(){"use strict";return {device:j.deviceName,os:j.platformName,os_version:j.platformFullVersion,browser:j.browserName,browser_version:j.browserFullVersion,screen_height:window.screen.availHeight,screen_width:window.screen.availWidth};};e.exports=n;},null);
__d("FBRTCCallSummaryStore",["CacheStorage","FBRTCCallSummary","FBRTCLogger","areEqual"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();var k='localstorage',l='RTC_CALL_SUMMARY_',m='summary',n=2000,o=3,p=3*60*1000,q=null;r.getInstance=function(){"use strict";if(!q)q=new r();return q;};function r(){"use strict";this.$FBRTCCallSummaryStore0=new g(k,l);this.$FBRTCCallSummaryStore1=i.getInstance();}r.prototype.storeCallSummary=function(s,t,u){"use strict";var v=this;this.$FBRTCCallSummaryStore2(function(w){if(!w[s])w[s]={};var x=w[s][t];if(x){var y=v.$FBRTCCallSummaryStore3(x);if(y&&y.getLastUpdatedTime()>u.getLastUpdatedTime()){v.$FBRTCCallSummaryStore1.logToConsole('Outdated summaries');return null;}}w[s][t]=v.$FBRTCCallSummaryStore4(u);return w;},v.$FBRTCCallSummaryStore1.logError.bind(v.$FBRTCCallSummaryStore1,s,t));};r.prototype.retrieveCallSummary=function(s,t){"use strict";var u=this.$FBRTCCallSummaryStore5(),v=null;if(u[s])v=u[s][t];if(v){return this.$FBRTCCallSummaryStore3(v);}else return null;};r.prototype.removeCallSummary=function(s,t){"use strict";this.removeCallSummaries([{peerID:s,callID:t}]);};r.prototype.removeCallSummaries=function(s){"use strict";var t=this;this.$FBRTCCallSummaryStore2(function(u){var v=s.length;for(var w=0;w<v;w++){var x=s[w].peerID,y=s[w].callID;if(u[x]&&u[x][y]){delete u[x][y];if(t.$FBRTCCallSummaryStore6(u[x]))delete u[x];}}return u;},t.$FBRTCCallSummaryStore1.logError.bind(t.$FBRTCCallSummaryStore1,null,null));};r.prototype.getLoggableSummaries=function(){"use strict";var s=this.$FBRTCCallSummaryStore5(),t=[];for(var u in s)if(s.hasOwnProperty(u))for(var v in s[u])if(s[u].hasOwnProperty(v)){var w=this.$FBRTCCallSummaryStore3(s[u][v],p);if(w)t.push(w);}return t;};r.prototype.$FBRTCCallSummaryStore6=function(s){"use strict";for(var t in s)if(s.hasOwnProperty(t))return false;return true;};r.prototype.$FBRTCCallSummaryStore4=function(s){"use strict";var t={__t:Date.now(),__d:s.toJsonString()};return t;};r.prototype.$FBRTCCallSummaryStore3=function(s,t){"use strict";if(s)if(!t||(Date.now()-s.__t>=t))return h.fromJsonString(s.__d);return null;};r.prototype.$FBRTCCallSummaryStore5=function(){"use strict";var s=this.$FBRTCCallSummaryStore0.get(m)||{};return s;};r.prototype.$FBRTCCallSummaryStore2=function(s,t,u,v){"use strict";if(u===(void 0)||u===null)u=o;var w=this.$FBRTCCallSummaryStore5(),x=this.$FBRTCCallSummaryStore5(),y=s(w);if(y===null)return;var z=this.$FBRTCCallSummaryStore5();if(j(x,z)){this.$FBRTCCallSummaryStore0.set(m,y);this.$FBRTCCallSummaryStore1.logToConsole('Updated summaries');}else if(u>0){t('Retry lock');if(v){var aa=this;setTimeout(function(){aa.$FBRTCCallSummaryStore2(s,t,u-1,true);},n);}else this.$FBRTCCallSummaryStore2(s,t,u-1,true);}else t('Failed to lock');};e.exports=r;},null);
__d("FBRTCUtils",["emptyFunction","randomInt","AsyncRequest","FBID","RTCConfig"],function(a,b,c,d,e,f,g,h,i,j,k){b.__markCompiled&&b.__markCompiled();var l=6000,m={attachMediaStream:function(n,o){if(window.webkitRTCPeerConnection){n.src=window.webkitURL.createObjectURL(o);}else{n.mozSrcObject=o;n.play();}},reattachMediaStream:function(n,o){if(window.webkitRTCPeerConnection){n.src=o.src;}else{n.mozSrcObject=o.mozSrcObject;n.play();}},generateRandomInt:function(){return h(0,4294967294)+1;},aboutEqual:function(n,o){return (n-o)<.01&&(o-n)<.01;},sendServerRequest:function(n,o,p,q,r,s){o=o||g;p=p||g;q=q||false;r=r||l;s=s||{};var t=new i().setURI(n).setData(s).setAllowCrossPageTransition(true).setHandler(o).setErrorHandler(p).setTimeoutHandler(r,function(){p();});if(q)t.setOption('asynchronous',false);t.send();},isCollabCallable:function(n){return !j.isUser(n)&&k.CollaborationVideoGroupCallGK;}};e.exports=m;},null);
__d("XVideoCallInitController",["XController"],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports=b("XController").create("\/videocall\/init\/",{peer_id:{type:"Int",required:true},call_id:{type:"Int",required:true},is_caller:{type:"Bool",defaultValue:false},audio_only:{type:"Bool",defaultValue:false}});},null);
__d("XVideoCallController",["XController"],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports=b("XController").create("\/videocall\/incall\/",{peer_id:{type:"Int",required:true},call_id:{type:"Int"},is_caller:{type:"Bool",defaultValue:false},audio_only:{type:"Bool",defaultValue:false}});},null);
__d("FBRTCUrlManager",["FBRTCLogger","FBRTCUtils","XVideoCallInitController","XVideoCallController"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();var k=3,l=function(p,q,r,s){g.getInstance().logCallAction(p,q,g.CallAction.OLD_URI);return j.getURIBuilder().setInt('peer_id',p).setInt('call_id',q).setBool('is_caller',r).setBool('audio_only',s).getURI();},m=function(p,q,r,s,t,u,v){if(v===(void 0)||v===null)v=k;var w=i.getURIBuilder().setInt('peer_id',p).setInt('call_id',q).setBool('is_caller',r).setBool('audio_only',s).getURI();h.sendServerRequest(w,function(x){t(x.payload.uri);},function(x){if(v>0){m(p,q,r,s,t,u,v-1);}else t(l(p,q,r,s));});},n=function(p){window.history.replaceState({},'',p);},o={init:function(p){this._peerID=p;},onCallStarted:function(){n(l(this._peerID));},getCallUri:m};e.exports=o;},null);
__d("FBRTCCallUI",["BanzaiLogger","Cookie","UserAgent","FBRTCCallSummary","FBRTCCallSummaryStore","FBRTCConstants","FBRTCLogger","FBRTCUrlManager","pageID"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){b.__markCompiled&&b.__markCompiled();var p=null,q={openAsCaller:function(r,s,t,u){if(!p&&window.rtcCallChildWindow){p=window.rtcCallChildWindow;window.rtcCallChildWindow=null;}if(this._shouldFocusCallWindow(r)){p.focus();return;}if(this._shouldCloseCallWindow())p.close();g.log('VideoCallLoggerConfig',{event:'open_as_caller'});m.getInstance().logCallAction(r,s,m.CallAction.START_CALL,null,t);var v=new j({peerID:r,callID:s,isCaller:true});v.onCallStarted(t);this._open(r,s,true,v,false,u);},openAsCallee:function(r,s,t,u,v){g.log('VideoCallLoggerConfig',{event:'open_as_callee'});this._open(r,s,false,t,u,v);},_shouldFocusCallWindow:function(r){return p&&!p.closed&&p.rtcCallInProgessWith===r;},_shouldCloseCallWindow:function(){return p&&!p.closed&&!p.rtcCallInProgessWith;},_open:function(r,s,t,u,v,w){h.clear('vcpwn');h.clear('vctid');var x=this._windowPosition(),y=['menubar=no','location=no','scrollbars=no','status=no','personalbar=no',x.height,x.width,x.top,x.left].join(',');if(this._isSparkBrowser())y='';u.addExtraInfo(m.Key.INITIATED_BY_PAGE_ID,o);u.onCallEnded(l.CallEndReason.CLIENT_ERROR,false,true,'PopupPending');u.save(k.getInstance());g.log('VideoCallLoggerConfig',{event:'open_popup'});if(!v){p=window.open('','Video Call',y);this._setUri(p,r,s,t,w);}else{m.getInstance().logCallAction(r,s,m.CallAction.OPEN_POPUP);p=window.open(v,'Video Call',y);}if(window.focus)p.focus();},_setUri:function(r,s,t,u,v){n.getCallUri(s,t,u,v,function(w){m.getInstance().logCallAction(s,t,m.CallAction.OPEN_POPUP);r.location=w;},function(){m.getInstance().logCallAction(s,t,m.CallAction.FAILED_GETTING_URI);});},_windowPosition:function(){var r=960,s=540,t,u,v,w;if(screen&&screen.width>1280){r=1280;s=720;}if(window.innerWidth!==(void 0)){u=window.innerWidth;t=window.innerHeight;}else{u=screen.width;t=screen.height;}if(window.screenLeft!==(void 0)){v=window.screenLeft;w=window.screenTop;}else{v=window.screenX;w=window.screenY;}var x=Math.floor(((u/2)-(r/2))+v),y=Math.floor(((t/2)-(s/2))+w);return {height:'height='+s.toString(),width:'width='+r.toString(),top:'top='+y.toString(),left:'left='+x.toString()};},_isSparkBrowser:function(){return i.isBrowser('Chrome < 34')&&i.isBrowser('Chrome > 33');}};e.exports=q;},null);
__d("FBRTCCore",["Bootloader","FBRTCAvailability","FBRTCCallUI","VideoCallSupport","invariant","randomInt"],function(a,b,c,d,e,f,g,h,i,j,k,l){b.__markCompiled&&b.__markCompiled();var m=false,n={startOutgoingCall:function(o,p,q){k(!isNaN(parseInt(o,10)));if(m)return;m=true;setTimeout(function(){m=false;},1000);if(j.isWebrtcSupported()){var r=this._generateCallID();i.openAsCaller(o,r,p,q);}else g.loadModules(["FBRTCUnsupportedBrowserMessage"],function(s){s.showForOutgoingCall();});},isAvailableForWebrtcCalling:function(o){return h.isCallable(o);},shouldEnableVideoCalling:function(){return j.isOSSupported();},_generateCallID:function(){return l(0,4294967295);}};e.exports=n;},null);
__d("FBRTCMessageListener",["Arbiter","ChannelConstants","invariant","mixInEventEmitter"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();'use strict';var k=[],l=null,m={init:function(){g.subscribe(h.getArbiterType('webrtc'),function(n,o){this._onMessage(o.obj);}.bind(this));},setMessageHandler:function(n,o){i(!l);l=o?n.bind(o):n;while(k.length)l(k.shift());},_onMessage:function(n){this.emit('messageReceived',n);if(l){l(n);}else k.push(n);}};j(m,{messageReceived:true});e.exports=m;},null);
__d("VideoCallCore",["Bootloader","FBRTCCallSummaryUploader","FBRTCCore","FBRTCLogger","FBRTCMessageListener","VideoCallSupport"],function(a,b,c,d,e,f,g,h,i,j,k,l){b.__markCompiled&&b.__markCompiled();var m=null,n={showOutgoingCallDialog:function(q,r,s){i.startOutgoingCall(q,s||j.Trigger.CHAT_TAB_ICON,r);}};function o(){if(!m)g.loadModules(["FBRTCIncomingCallController","FBRTCIncomingCallDialog","FBRTCMissedVideoCallHandler","FBRTCUnsupportedBrowserMessage"],function(q,r,s,t){m=new q(r,t,(new s(n)));k.setMessageHandler(m.onMessageReceived,m);});}function p(q){return i.isAvailableForWebrtcCalling(q);}if(l.isReceiveWebrtcSupported()){h.init();k.init();k.once('messageReceived',function(q){o();});}e.exports=n;},null);
__d("ChatPerfInstrumentation",["BanzaiLogger","ChatPerfEvent","Promise","emptyFunction","performanceAbsoluteNow"],function(a,b,c,d,e,f,g,h,i,j,k){b.__markCompiled&&b.__markCompiled();'use strict';var l={_startTime:(Number),init:function(){this._startTime=k();return new i(function(m){return m();});},_log:function(event){g.log('ChatPerfLoggerConfig',{event:event,duration:k()-this._startTime});},logTTI:function(){this.logTTI=j;this._log(h.TTI);},logCHAT_CONVERSATION_TTI:function(){this.logCHAT_CONVERSATION_TTI=j;this._log(h.CHAT_CONVERSATION_TTI);}};e.exports=l;},null);
__d("MercuryRoger",["Arbiter","ArbiterMixin","immutable","JSLogger","MercuryActionStatus","MercuryDispatcher","MercurySingletonMixin","MercuryThreads","mixin","mapObject"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){b.__markCompiled&&b.__markCompiled();var q=k.SUCCESS,r=o(h);for(var s in r)if(r.hasOwnProperty(s))u[s]=r[s];var t=r===null?null:r.prototype;u.prototype=Object.create(t);u.prototype.constructor=u;u.__superConstructor__=r;function u(x){"use strict";r.call(this);this.$MercuryRoger0={};this.$MercuryRoger1=[];this.$MercuryRoger2=x;this.$MercuryRoger3=l.getForFBID(this.$MercuryRoger2);this.$MercuryRoger4=n.getForFBID(this.$MercuryRoger2);this.$MercuryRoger3.subscribe('update-roger',function(y,z){for(var aa in z){var ba=this.$MercuryRoger0[aa]||i.OrderedMap();ba=ba.withMutations(function(ca){for(var da in z[aa]){var ea=this.$MercuryRoger4.getThreadMetaNow(aa);if(ea&&ea.participants)if(ea.participants.indexOf(da)==-1){this.$MercuryRoger1.push(w(this.$MercuryRoger0));continue;}var fa=ca.get(da),ga=z[aa][da];if(!fa||ga>fa)ca.set(da,ga);}}.bind(this));this.$MercuryRoger0[aa]=ba.sort();}z&&this.inform('change',z);}.bind(this));g.subscribe(j.DUMP_EVENT,function(y,z){z.bad_read_receipts={receipts:this.$MercuryRoger1};}.bind(this));}u.prototype.getSeenBy=function(x,y){"use strict";if(!x)return [];var z=[],aa=this.$MercuryRoger0[x.thread_id];if(!aa)return z;aa.forEach(function(ba,ca){if(v(x,ba,ca,y))z.push(ca);});return z;};u.prototype.wasSeenByAll=function(x){"use strict";if(!x)return false;var y=this.$MercuryRoger0[x.thread_id];if(!y)return false;return y.every(function(z,aa){return v(x,z,aa);});};u.prototype.getSeenTimestamps=function(x){"use strict";var y=this.$MercuryRoger0[x];if(!y){y=i.OrderedMap();this.$MercuryRoger0[x]=y;}return y;};u.prototype.getSeenTimestamp=function(x,y){"use strict";var z=this.$MercuryRoger0[x];return z?z.get(y):null;};Object.assign(u,m);function v(x,y,z,aa){return !!(y>x.timestamp&&(x.status===(void 0)||x.status===q)&&(!aa||z!=x.author));}function w(x){return p(x,function(y){return y.toJS();});}e.exports=u;},null);
__d("MercuryDelayedRoger",["ArbiterMixin","LiveTimer","MercuryActionStatus","MercuryConfig","setTimeoutAcrossTransitions","MercuryMessages","MercuryRoger","MercuryThreadInformer","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k){b.__markCompiled&&b.__markCompiled();var l=b('MercuryMessages').get(),m=b('MercuryRoger').get(),n=b('MercuryThreadInformer').get(),o=b('MercuryThreads').get(),p={},q={},r=j['roger.seen_delay'],s={getSeenBy:function(y,z){if(q[y])return [];return m.getSeenBy(t(y),z);},wasSeenByAll:function(y){if(q[y])return false;return m.wasSeenByAll(t(y));}};Object.assign(s,g);function t(y){if(!p[y]){var z=o.getThreadMetaNow(y);if(z)p[y]={thread_id:y,author:z.participants[0],timestamp:z.timestamp};}return p[y];}function u(y){var z=false;l.getThreadMessagesRange(y,0,1,function(aa){var ba=aa[0];if(!ba)return;var ca=ba.timestamp;if(ba.action_id||ba.status==i.SUCCESS)ca-=h.getServerTimeOffset();var da=s.getSeenBy(y);if(q[y]){clearTimeout(q[y]);delete q[y];}var ea=ca+r,fa=ea-Date.now();if(fa>0)q[y]=k(function(){delete q[y];v(y);},fa);p[y]=ba;var ga=s.getSeenBy(y);if(da.length||ga.length)z=true;});return z;}function v(y){var z={};z[y]=true;w(z);}function w(y){s.inform('state-changed',y);s.inform('change');}function x(event,y){var z={};for(var aa in y)if(u(aa))z[aa]=true;for(var ba in z){w(z);break;}}m.subscribe('change',function(y,z){for(var aa in z)!q[aa]&&v(aa);});n.subscribe('messages-received',x);n.subscribe('messages-reordered',x);n.subscribe('messages-updated',x);e.exports=s;},null);
__d("MercuryDeliveryState",["MercuryConfig","MercuryIDs","MercuryServerRequests","MercurySingletonMixin","MercuryThreadInformer","PresencePrivacy","UserActivity","debounceAcrossTransitions"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){b.__markCompiled&&b.__markCompiled();'use strict';var o=g.delivery_timeout||120000;function p(q){this.$MercuryDeliveryState0=q;this.$MercuryDeliveryState1=i.getForFBID(this.$MercuryDeliveryState0);this.$MercuryDeliveryState2=k.getForFBID(this.$MercuryDeliveryState0);this.$MercuryDeliveryState3=[];this.$MercuryDeliveryState2.subscribe('messages-received',this.$MercuryDeliveryState4.bind(this));m.subscribe(n(this.$MercuryDeliveryState5,300,this));}p.prototype.$MercuryDeliveryState4=function(q,r){for(var s in r){var t=r[s];t.forEach(function(u){if(this.$MercuryDeliveryState7(u))this.$MercuryDeliveryState3.push(u);}.bind(this));}if(m.isActive(o))this.$MercuryDeliveryState5();};p.prototype.$MercuryDeliveryState5=function(){if(this.$MercuryDeliveryState3.length===0)return;var q=this.$MercuryDeliveryState3.filter(this.$MercuryDeliveryState7,this).map(function(r){return r.message_id;});if(q)this.$MercuryDeliveryState1.sendDeliveryReceipts(q);this.$MercuryDeliveryState3=[];};p.prototype.$MercuryDeliveryState7=function(q){var r=q.author?h.getUserIDFromParticipantID(q.author):null;if(r===this.$MercuryDeliveryState0)return false;if(!q.is_unread)return false;if(!l.allows(r))return false;return true;};Object.assign(p,j);e.exports=p;},null);
__d("MercuryFilters",["MessagingTag","arrayContains"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();var i=[g.UNREAD],j={ALL:'all',UNREAD:g.UNREAD,getSupportedFilters:function(){return i.concat();},isSupportedFilter:function(k){return h(i,k);}};e.exports=j;},null);
__d("MercuryOrderedThreadlist",["LogHistory","MercuryActionType","MercuryDispatcher","MercuryConfig","MercuryFilters","MercuryFolders","MercuryGlobalActionType","MercuryPayloadSource","MercurySingletonMixin","MercuryThreadIDMap","MessagingTag","PageMessageEnumTag","RangedCallbackManager","MercuryServerRequests","MercuryThreadInformer","MercuryThreads","arrayContains"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w){b.__markCompiled&&b.__markCompiled();'use strict';var x=g.getInstance('ordered_threadlist_model'),y=k.getSupportedFilters().concat([k.ALL,q.GROUPS]),z=l.getSupportedFolders();function aa(ka,la,ma,na){var oa=[],pa=false,qa=false,ra=(la||[]).filter(function(ya){var za=ya.filter||k.ALL;return (ya.folder==ma||(!ya.folder&&ma==q.INBOX))&&za==na;}),sa=ka._threadlistOrderMap[ma][na].getAllResources(),ta;ra.forEach(function(ya){oa=oa.concat(ya.thread_ids);if(ya.error){if(ya.end>sa.length)qa=ya.error;}else{var za=ya.end-ya.start;if(ya.thread_ids.length<za)pa=true;}if(!ta||ya.end>ta)ta=ya.end;});ea(ka,oa,ma,na);if(pa){ka._threadlistOrderMap[ma][na].setReachedEndOfArray();}else if(qa){ka._threadlistOrderMap[ma][na].setError(qa);}else{var ua=ka._threadlistOrderMap[ma][na].getCurrentArraySize();if(ta&&ua<ta){var va={},wa=sa.concat(oa),xa=wa.filter(function(ya){var za=va[ya];va[ya]=true;return za;});if(xa.length){x.warn('duplicate_threads',{folder:ma,expected_final_size:ta,actual_final_size:ua,duplicate_thread_ids:xa});ka._serverRequests.fetchThreadlistInfo(ta,xa.length,ma,na==k.ALL?null:na);}}}}function ba(ka,la){z.forEach(function(ma){y.forEach(function(na){aa(ka,la,ma,na);});});}function ca(ka,la){var ma={};z.forEach(function(na){ma[na]={};y.forEach(function(oa){ma[na][oa]={to_add:[],to_remove:[],to_remove_if_last_after_add:{}};});});la.forEach(function(na){if(na.is_forward)return;var oa=na.thread_id,pa=fa(ka,oa),qa=ga(ka,oa);function ra(){qa.forEach(function(ta){if(!w(y,ta))return;ma[pa][ta].to_add.push(oa);if(!ka._threadlistOrderMap[pa][ta].hasReachedEndOfArray()&&!ka._threadlistOrderMap[pa][ta].hasResource(oa))ma[pa][ta].to_remove_if_last_after_add[oa]=true;});}function sa(ta){if(w(y,ta))if(w(qa,ta)){ma[pa][ta].to_add.push(oa);}else ma[pa][ta].to_remove.push(oa);}if(!pa){if(na.action_type===h.CHANGE_FOLDER||na.action_type===h.CHANGE_ARCHIVED_STATUS)z.forEach(function(ta){if(ta!==pa)y.forEach(function(ua){ka._threadlistOrderMap[ta][ua].removeResources([oa]);});});return;}switch(na.action_type){case h.DELETE_THREAD:qa.forEach(function(ta){if(!w(y,ta))return;ma[pa][ta].to_remove.push(oa);});break;case h.CHANGE_ARCHIVED_STATUS:case h.CHANGE_FOLDER:ra();break;case h.CHANGE_READ_STATUS:sa(q.UNREAD);break;case h.USER_GENERATED_MESSAGE:case h.LOG_MESSAGE:qa.forEach(function(ta){if(!w(y,ta))return;if(ha(ka,oa,pa,ta))ma[pa][ta].to_add.push(oa);});break;case h.CHANGE_FLAG:sa(r.FLAG);break;}});z.forEach(function(na){y.forEach(function(oa){var pa=ka._threadlistOrderMap[na][oa];ea(ka,ma[na][oa].to_add,na,oa);for(var qa=pa.getCurrentArraySize()-1;qa>=0;qa--){var ra=pa.getResourceAtIndex(qa);if(!ma[na][oa].to_remove_if_last_after_add[ra])break;ma[na][oa].to_remove.push(ra);}pa.removeResources(ma[na][oa].to_remove);});});}function da(ka,la){var ma={};z.forEach(function(na){ma[na]={};y.forEach(function(oa){ma[na][oa]=[];});});la.forEach(function(na){var oa=fa(ka,na.thread_id),pa=ga(ka,na.thread_id);if(oa)pa.forEach(function(qa){if(ha(ka,na.thread_id,oa,qa))ma[oa][qa].push(na.thread_id);});});z.forEach(function(na){y.forEach(function(oa){if(ma[na][oa].length>0)ea(ka,ma[na][oa],na,oa);});});}function ea(ka,la,ma,na){na=na||k.ALL;ka._threadlistOrderMap[ma][na].addResources(la);z.forEach(function(oa){if(oa!=ma)ka._threadlistOrderMap[oa][na].removeResources(la);});}function fa(ka,la){var ma=ka._threads.getThreadMetaNow(la),na=null;if(!ma){na='No thread metadata';}else if(!ma.folder)na='No thread folder';if(na){var oa={error:na,tid:la};x.warn('no_thread_folder',oa);return null;}var pa=ma.folder;if(ma.is_archived)pa=q.ACTION_ARCHIVED;if(ka._threadlistOrderMap[pa]){return pa;}else return null;}function ga(ka,la){var ma=ka._threads.getThreadMetaNow(la),na=[k.ALL];if(!ma){var oa={error:'no_thread_metadata',tid:la};x.warn('no_thread_metadata',oa);return [];}if(ma.unread_count)na.push(q.UNREAD);if(!ma.is_canonical)na.push(q.GROUPS);var pa=ma.page_thread_info;if(pa&&pa.flagged)na.push(r.FLAG);return na;}function ha(ka,la,ma,na){var oa=ka._threads.getThreadMetaNow(la);return oa&&oa.timestamp&&fa(ka,la)==ma&&w(ga(ka,la),na);}function ia(ka){this._fbid=ka;this._serverRequests=t.getForFBID(this._fbid);this._threadIDMap=p.getForFBID(this._fbid);this._threadInformer=u.getForFBID(this._fbid);this._threads=v.getForFBID(this._fbid);this._dispatcher=i.getForFBID(this._fbid);this._threadlistOrderMap={};z.forEach(function(la){this._threadlistOrderMap[la]={};y.forEach(function(ma){this._threadlistOrderMap[la][ma]=new s(function(na){return this._threads.getThreadMetaNow(na).timestamp;}.bind(this),function(na,oa){return oa-na;},this._threadIDMap.canLinkExternally.bind(this._threadIDMap));}.bind(this));}.bind(this));this._dispatcher.subscribe('update-threadlist',function(la,ma){if(!ja(ma))return;if(j.MessengerJewelUnread!=='none')if(ma.global_actions)ma.global_actions.forEach(function(pa){if(pa.action_type==m.MARK_ALL_READ)this.getThreadlistOrderMap(pa.folder,k.UNREAD).removeAllResources();}.bind(this));var na=ma.ordered_threadlists;if(na&&na.length){ba(this,na);}else{var oa=(ma.actions||[]).filter(function(pa){return pa.thread_id;});da(this,ma.threads||[]);ca(this,oa);}this._threadInformer.updatedThreadlist();}.bind(this));}Object.assign(ia.prototype,{getThreadlistOrderMap:function(ka,la){if(!this._threadlistOrderMap[ka][la]){y=y.concat([la]);z.forEach(function(ma){this._threadlistOrderMap[ma][la]=new s(function(na){return this._threads.getThreadMetaNow(na).timestamp;}.bind(this),function(na,oa){return oa-na;},this._threadIDMap.canLinkExternally.bind(this._threadIDMap));}.bind(this));}return this._threadlistOrderMap[ka][la];},getThreadlist:function(ka,la,ma,na,oa,pa){return this.getFilteredThreadlist(ka,la,ma,k.ALL,na,oa,pa);},getFilteredThreadlist:function(ka,la,ma,na,oa,pa,qa){var ra=this.getThreadlistOrderMap(ma,na),sa=ra.executeOrEnqueue(ka,la,oa,pa),ta=ra.getUnavailableResources(sa),ua=ra.getError(ka,la,pa);if(ta.length||ua){if(ra.getCurrentArraySize()<ka){var va={start:ka,limit:la,filter:na,resources_size:ra.getCurrentArraySize()};x.warn('range_with_gap',va);}ra.setError(false);this._serverRequests.fetchThreadlistInfo(ra.getCurrentArraySize(),ta.length,ma,na==k.ALL?null:na,qa);}return sa;},getThreadlistUntilTimestamp:function(ka,la,ma){ma=ma||k.ALL;return this.getThreadlistOrderMap(la,ma).getElementsUntil(ka);},getAvailableThreadlistNow:function(ka,la){la=la||k.ALL;return this.getThreadlistOrderMap(ka,la).getAllResources();},getThreadCount:function(ka,la){la=la||k.ALL;return this.getThreadlistOrderMap(ka,la).getCurrentArraySize();},hasLoadedThreadlist:function(ka,la){la=la||k.ALL;return this.getThreadlistOrderMap(ka,la).hasReachedEndOfArray();},unsubscribe:function(ka,la,ma){ma=ma||k.ALL;this.getThreadlistOrderMap(la,ma).unsubscribe(ka);}});Object.assign(ia,o);function ja(ka){switch(ka.payload_source){case n.CLIENT_CHANGE_ARCHIVED_STATUS:case n.CLIENT_CHANGE_READ_STATUS:case n.CLIENT_CHANGE_FOLDER:case n.CLIENT_CHANNEL_MESSAGE:case n.CLIENT_DELETE_MESSAGES:case n.CLIENT_DELETE_THREAD:case n.CLIENT_SEND_MESSAGE:case n.SERVER_SEND_MESSAGE:case n.SERVER_FETCH_THREADLIST_INFO:case n.SERVER_THREAD_SYNC:return true;case n.SERVER_INITIAL_DATA:return ka.ordered_threadlists;default:return false;}}e.exports=ia;},null);
__d("MercuryStateCheck",["Arbiter","ChannelConstants","LogHistory","MercuryAPIArgsSource","MercuryFolders","MercuryOrderedThreadlist","MercuryServerRequests","MercurySingletonMixin","MessagingTag","URI"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){b.__markCompiled&&b.__markCompiled();var q=i.getInstance('mercury_state_check');function r(s){"use strict";this.$MercuryStateCheck0=s;this.$MercuryStateCheck1=m.getForFBID(this.$MercuryStateCheck0);this.$MercuryStateCheck2=l.getForFBID(this.$MercuryStateCheck0);g.subscribe(h.ON_INVALID_HISTORY,this.$MercuryStateCheck3.bind(this,h.ON_INVALID_HISTORY));d(['ChannelConnection'],function(t){t.subscribe(t.CONNECTED,function(u,v){if(!v.init)this.$MercuryStateCheck4(t.CONNECTED);}.bind(this));}.bind(this));}r.prototype.$MercuryStateCheck3=function(s){"use strict";var t;if(p.getRequestURI().getPath().search(/messages/)!==-1){t=k.getSupportedFolders();}else t=[o.INBOX];q.debug('check',{folders:t,source:s});this.$MercuryStateCheck1.fetchMissedMessages(t,j.MERCURYSYNC);};r.prototype.$MercuryStateCheck4=function(s){"use strict";var t=this.$MercuryStateCheck2.getAvailableThreadlistNow(o.INBOX)||[];t=t.slice(0,20);q.debug('full_check',{threads:t,source:s});this.$MercuryStateCheck1.fetchThreadData(t,j.MERCURYSYNC);this.$MercuryStateCheck3(s);};Object.assign(r,n);e.exports=r;},null);
__d("MercuryUnseenState",["MercuryFolders","KeyedCallbackManager","LogHistory","MercuryActionType","MercuryDispatcher","MercurySingletonMixin","MercuryThreadInfo","MercuryThreadlistConstants","MercuryThreadIDMap","MessagingTag","MercuryServerRequests","MercuryThreadInformer","MercuryThreads","createObjectFrom","isEmpty"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u){b.__markCompiled&&b.__markCompiled();var v=n.MAX_UNSEEN_COUNT,w='unseen_thread_hash',x='unseen_thread_list',y=i.getInstance('mercury_unseen_state');function z(oa){this._fbid=oa;this._serverRequests=q.getForFBID(this._fbid);this._threadIDMap=o.getForFBID(this._fbid);this._threads=s.getForFBID(this._fbid);this._threadInformer=r.getForFBID(this._fbid);this._dispatcher=k.getForFBID(this._fbid);this._initialUnseenCount=null;this._lastSeenTimestamp=0;this._maxCount=false;this._pendingServerUpdates=false;this._unseenResources=new h();this._dispatcher.subscribe('update-unseen',function(pa,qa){fa(this,qa);}.bind(this));this._dispatcher.subscribe('update-thread-ids',function(pa,qa){la(this,qa);}.bind(this));}Object.assign(z.prototype,{getUnseenCount:function(){if(this.exceedsMaxCount()){y.error('unguarded_unseen_count_fetch',{});return 0;}return ea(this)||0;},exceedsMaxCount:function(){return this._maxCount||(ea(this)>v);},markAsSeen:function(){var oa=ea(this);if(oa===null){this._pendingServerUpdates=true;}else if(oa>0||this._maxCount){this._serverRequests.markSeen();var pa=this._serverRequests.getLastActionTimestamp();ga(this,pa,[]);}}});Object.assign(z,l);function aa(oa,pa,qa){var ra={};ra[pa]=0;ia(oa,ra,qa);}function ba(oa,pa){oa._unseenResources.setResource(w,pa);oa._unseenResources.setResource(x,Object.keys(pa));}function ca(oa,pa){var qa=oa._unseenResources.executeOrEnqueue(w,pa),ra=oa._unseenResources.getUnavailableResources(qa);if(ra.length)oa._serverRequests.fetchUnseenThreadIDs();}function da(oa){return oa._unseenResources.getResource(w);}function ea(oa){var pa=oa._unseenResources.getResource(x);if(pa){return pa.length;}else return oa._initialUnseenCount;}function fa(oa,pa){var qa=na(pa);if(pa.unseen_thread_fbids){pa.unseen_thread_fbids.forEach(function(bb){if(bb.folder!=p.INBOX)return;var cb=bb.thread_fbids||[];cb=cb.concat(bb.other_user_fbids||[]);var db=ka(oa,cb),eb=oa._lastSeenTimestamp;if(qa&&qa.seen_timestamp)eb=qa.seen_timestamp;ga(oa,eb,db);if(qa&&qa.unseen_count>v)oa._maxCount=true;});}else if(qa&&qa.seen_timestamp){oa._lastSeenTimestamp=qa.seen_timestamp;if(qa.unseen_count>v){oa._maxCount=true;ba(oa,{});}else{oa._initialUnseenCount=qa.unseen_count;if(oa._initialUnseenCount===0)ba(oa,{});}}else{if(oa._maxCount)return;var ra=pa.actions;if(!ra||!(ra.length))return;var sa={},ta={};for(var ua=0;ua<ra.length;ua++){var va=ra[ua];if(va.is_forward)continue;var wa=va.action_type,xa=va.other_user_fbid?va.other_user_fbid:va.thread_fbid,ya=va.thread_id?va.thread_id:xa;if(wa==j.MARK_THREAD_SEEN){aa(oa,ya,va.persistent);continue;}if(!ma(oa,va))continue;if(wa==j.USER_GENERATED_MESSAGE||wa==j.LOG_MESSAGE){var za=sa[ya]?va.timestamp>sa[ya]:false,ab=za||!sa[ya];if(va.is_unread&&ab)oa._threads.getThreadMeta(ya,function(bb){var cb=false;if(bb&&bb.last_read_timestamp)if(bb.last_read_timestamp>=va.timestamp)cb=true;if(!m.isMuted(bb)&&!cb)sa[ya]=va.timestamp;});}else if(wa==j.CHANGE_READ_STATUS&&va.mark_as_read)ta[ya]=va.timestamp;}ha(oa,sa);ia(oa,ta);}if(oa._pendingServerUpdates){oa._pendingServerUpdates=false;oa.markAsSeen();}}function ga(oa,pa,qa){var ra=da(oa);if(ra===(void 0)||pa>oa._lastSeenTimestamp||oa._maxCount){oa._lastSeenTimestamp=pa;qa=qa||[];if(qa.length<=v)oa._maxCount=false;var sa={},ta=da(oa)||{};for(var ua in ta)if(ta[ua]!==true){var va=ta[ua];if(ja(oa,va))sa[ua]=va;}var wa=Object.assign(t(qa,true),sa);ba(oa,wa);oa._threadInformer.updatedUnseenState();}}function ha(oa,pa){if(oa._maxCount)return;var qa={},ra=false;for(var sa in pa){var ta=pa[sa];if(ja(oa,ta)){qa[sa]=ta;ra=true;}}if(!ra)return;ca(oa,function(ua){for(var va in qa){var wa=qa[va];if(!ua[va]&&ja(oa,wa))ua[va]=qa[va];}ba(oa,ua);oa._threadInformer.updatedUnseenState();});}function ia(oa,pa,qa){var ra=false;if(!u(pa))ra=true;if(ra)ca(oa,function(sa){var ta=false;for(var ua in pa){var va=pa[ua],wa=va>sa[ua];if(sa[ua]&&(!va||wa)){delete sa[ua];ta=true;}}if(ta){ba(oa,sa);oa._threadInformer.updatedUnseenState();if(qa&&ea(oa)===0)oa._serverRequests.markSeen();}});}function ja(oa,pa){return pa>oa._lastSeenTimestamp;}function ka(oa,pa){return pa.map(oa._threadIDMap.convertThreadIDIfAvailable,oa._threadIDMap);}function la(oa,pa){var qa=da(oa);if(!qa)return;for(var ra in pa){var sa=pa[ra];if(qa[ra]){qa[sa]=qa[ra];delete qa[ra];}}ba(oa,qa);}function ma(oa,pa){var qa=pa.thread_id?oa._threads.getThreadMetaNow(pa.thread_id):null,ra=qa?g.getFromMeta(qa):pa.folder;return ra===p.INBOX||ra===(void 0);}function na(oa){var pa=(oa.message_counts||[]);for(var qa=0;qa<pa.length;qa++)if(pa[qa].folder==p.INBOX)return pa[qa];return null;}e.exports=z;},null);
__d("ChatBehavior",["Arbiter","AvailableList","AvailableListConstants","MercuryConstants"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();var j=b('MercuryConstants').ChatNotificationConstants,k=false,l=h.getWebChatNotification&&h.getWebChatNotification(),m=k,n=true,o=Object.assign(new g(),{ON_CHANGED:'changed',notifiesUserMessages:function(){return l!==j.NO_USER_MESSAGE_NOTIFICATION;},ignoresRemoteTabRaise:function(){return m;},showsTabUnreadUI:function(){return n;}});function p(){o.inform(o.ON_CHANGED);}h.subscribe&&h.subscribe(i.ON_CHAT_NOTIFICATION_CHANGED,function(){var q=l,r=h.getWebChatNotification();l=r;if(q!=r)p();});g.subscribe('chat/set_does_page_occlude_tabs',function(q,r){m=!!r;p();});g.subscribe('chat/set_show_tab_unread_ui',function(q,r){n=!!r;p();});e.exports=o;},null);
__d("ChatCookieInterface",["ChatConfig","InitialServerTime","LogHistory","PresenceState","PresenceUtil","areJSONRepresentationsEqual"],function(a,b,c,d,e,f,g,h,i,j,k,l){b.__markCompiled&&b.__markCompiled();'use strict';var m=i.getInstance('chat_cookie'),n=h.serverTime,o=g.get('tab_max_load_age')||3600000,p=n-o,q={store:function(u,v){if(u.uct2==v.lastChangeTime)return u;var w=t(u,v),x={};if(!w){x.old_tabs=u&&u.t2&&JSON.stringify(u.t2);x.old_promoted=u&&u.lm2;x.old_time=u&&u.uct2;x.old_reason=u&&u.tr;x.old_window=u&&u.tw;var y=[];v.tabs.forEach(function(z){if(!z.fragile){var aa={i:z.id,si:z.server_id};if(z.raised)aa.r=1;y.push(aa);}});u.t2=y;u.lm2=v.promotedID;u.uct2=v.lastChangeTime;u.tr=v.lastChangeReason;u.tw=k.getSessionID();x.new_tabs=JSON.stringify(u.t2);x.new_promoted=u.lm2;x.new_time=u.uct2;x.new_reason=u.tr;x.new_window=u.tw;m.debug('store',x);}else{x.tabs=u&&u.t2&&JSON.stringify(u.t2);x.promoted=u&&u.lm2;x.time=u&&u.uct2;x.reason=u&&u.tr;x.window=u&&u.tw;x.last_change_time=v.lastChangeTime;x.last_change_reason=v.lastChangeReason;x.min_change_time=p;m.warn('store_bad_state',x);}return u;},load:function(u,v){if(!u){m.warn('load_bad_state',u);return false;}var w=t(u,v);if(!w||w===v.lastChangeTime)return false;var x={};x.old_tabs=JSON.stringify(v.tabs);x.old_promoted=v.promotedID;x.old_time=v.lastChangeTime;x.old_reason=v.lastChangeReason;x.window_id=k.getSessionID();x.cookie_tabs=u&&u.t2&&JSON.stringify(u.t2);x.cookie_promoted=u&&u.lm2;x.cookie_time=u&&u.uct2;x.cookie_reason=u&&u.tr;x.cookie_window=u&&u.tw;v.lastChangeTime=w;v.lastChangeReason='load';var y=r(v,u.t2,u.lm2||null);x.load_result=y;x.new_tabs=JSON.stringify(v.tabs);x.new_promoted=v.promotedID;x.new_time=v.lastChangeTime;x.new_reason=v.lastChangeReason;var event='load';if(!v.isInitialized)event+='_init';m.log(event,x);return y;}};function r(u,v,w){var x;if(!s(u,v,w))return false;var y=u.tabs.filter(function(ba){return !!ba.fragile;}),z={};u.promotedID=null;u.tabs=v.map(function(ba){var ca={id:ba.i,server_id:ba.si};if(ca.id==w)u.promotedID=ca.id;if(ba.r)ca.raised=true;z[ca.id]=ca;return ca;});u.tabs=u.tabs.filter(function(ba){return !!ba;});if(u.localRaised)for(var aa in u.localRaised)if(!z[aa]||!z[aa].raised)delete u.localRaised[aa];y=y.filter(function(ba){return !z[ba.id];});(x=u.tabs).push.apply(x,y);return true;}function s(u,v,w){if(w!=u.promotedID)return true;var x=u.tabs.filter(function(aa){return !aa.fragile;});if(v.length!=x.length)return true;for(var y=0,z=v.length;y<z;y++)if(!l(v[y],x[y]))return true;return false;}function t(u,v){var w=j.verifyNumber(u.uct2);if(!w||typeof w!=='number'){m.warn('bad_cookie_version',u);return null;}if(w<v.lastChangeTime||w<p)return null;return w;}e.exports=q;},null);
__d("ChatTabPresence",["AvailableList","ChatTabModel","MercuryIDs"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();var j={};function k(l){var m=i.getUserIDFromThreadID(l);if(m&&g.shouldUpdateForID(m))g.updateForID(m);}h.addListener(function(){var l=h.get();l.tabs.forEach(function(m){if(m.raised&&!j[m.id])k(m.id);});j={};l.tabs.forEach(function(m){if(m.raised)j[m.id]=true;});});e.exports={};},null);
__d("ChatMentionsNotifications",["fbt","CurrentUser","MercuryParticipants"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();var j={notifyIfMessageToMe:function(k){var l='fbid:'+h.getID(),m=k.body;i.get(l,function(n){var o=new RegExp(n.short_name,"i");if(o.test(m))j._notify(k);});},_notify:function(k){var l=48,m=k.body;if(m.length>l)m=m.substr(0,l-3)+"...";new Notification(g._("You were tagged in a message!"),{body:m,icon:"http://facebook.com//images/icons-large/fb-xl.png"});}};e.exports=j;},null);
__d("ChatTabViewInstances",["Map"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();'use strict';e.exports=new g();},null);
__d("ChatNewMessageHandler",["ChatActivity","ChatMentionsNotifications","ChatTabModel","ChatTabViewInstances","JSLogger","MercuryAssert","MercuryBrowserAlerts","UserActivity","MercuryConfig","MercuryThreadlistConstants"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){b.__markCompiled&&b.__markCompiled();var q=k.create('chat_new_message'),r={_notify:function(s,t,u){if(o.DesktopNotificationsGK)h.notifyIfMessageToMe(t);var v=j.get(s);u.view_is_visible=v&&v.isVisible();u.view_is_focused=v&&v.isFocused();if(!u.view_is_visible)q.log('message_to_hidden');u.is_active=g.isActive();m.messageReceived(t);},newMessage:function(s,t){l.isThreadID(s);var u=i.getTab(s),v={thread_id:s,message_id:t.message_id,to_new_tab:!u,to_raised_tab:u?!!u.raised:true};this._notify(s,t,v);q.log('message',v);}};m.subscribe('before-alert',function(s,event){var t=event.threadID,u=j.get(t),v=i.getTab(t),w=p.MESSAGE_NOTICE_INACTIVITY_THRESHOLD;if(v&&v.raised&&u&&u.isVisible()&&u.isFocused()&&n.isActive(w)){u.tryMarkAsRead();event.cancelAlert();}});e.exports=r;},null);
__d("ChatTabLRUManager",["ChatTabViewInstances","ChatTabModel","InitialServerTime","MercuryThreads"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();var j=b('MercuryThreads').get(),k={getLRUVisibleTab:function(l){if(l.hasRoomForRaisedTab())return (void 0);var m=Object.keys(l.getTabsToShow()||{}),n=1*60,o=null,p=Infinity;for(var q=0;q<m.length;q++){var r=m[q],s=j.getThreadMetaNow(r);if(h.isTabPromoted(r))continue;if(!g.get(r).hasEmptyInput()||!s)continue;var t=(i.serverTime-s.timestamp)/1000;if(!s.timestamp||(s.timestamp&&s.timestamp<p&&t>n)){o=s.thread_id;p=s.timestamp;}}return o;}};e.exports=k;},null);
__d("ChatTabPolicy",["ChatBehavior","ChatConfig","JSLogger","MercuryActionType","MercuryLogMessageType","MercuryAssert","MercuryConfig","MercuryIDs","MercuryParticipantTypes","MercurySourceType","MercuryThreadInfo","MercuryThreadMode","MercuryViewer","MessagingTag","PresencePrivacy","ShortProfiles","MercuryThreadActions"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){b.__markCompiled&&b.__markCompiled();var w=b('MercuryThreadActions').get(),x=i.create('tab_policy');e.exports={messageIsAllowed:function(y,z,aa){var ba=y.thread_id,ca=z.message_id;l.isThreadID(ba);l.isParticipantID(z.author);var da;if(q.isMuted(y)){da={thread_id:ba,message_id:ca,mute_settings:y.mute_settings};x.log('message_thread_muted',da);if(!m.GroupChatMentionsGK)return;}if(y.mode==r.OBJECT_ORIGINATED){da={thread_id:ba,message_id:ca,mode:y.mode};x.log('message_object_originated',da);return;}if(z.source==p.EMAIL||z.source==p.TITAN_EMAIL_REPLY){da={thread_id:ba,message_id:ca,source:z.source};x.log('message_source_not_allowed',da);return;}var ea=n.getUserIDFromParticipantID(z.author);if(!ea){x.log('message_bad_author',{thread_id:ba,message_id:ca,user:ea});return;}if(z.action_type!=j.USER_GENERATED_MESSAGE&&!this._messageIsNewlyCreatedGroup(z,y)){da={thread_id:ba,message_id:ca,type:z.action_type};x.log('message_non_user_generated',da);return;}if(y.is_canonical_user&&!g.notifiesUserMessages()){x.log('message_jabber',{thread_id:ba,message_id:ca});w.markSeen(ba,true);return;}if(y.is_canonical&&!y.canonical_fbid){x.log('message_canonical_contact',{thread_id:ba,message_id:ca});return;}if(y.folder!=t.INBOX){x.log('message_folder',{thread_id:ba,message_id:ca,folder:y.folder});return;}var fa=n.getUserIDFromParticipantID(s.getID());v.getMulti([ea,fa],function(ga){if(!u.allows(ea)){x.log('message_privacy',{thread_id:ba,message_id:ca,user:ea});return;}var ha=ga[ea].employee&&ga[fa].employee,ia=h.get('IsWorkUser',false);if(!ha&&!ia&&!ga[ea].isCommercePage&&ga[ea].type!==o.FRIEND){x.log('message_non_friend',{thread_id:ba,message_id:ca,user:ea});return;}aa();});},_messageIsNewlyCreatedGroup:function(y,z){return y.action_type===j.LOG_MESSAGE&&y.log_message_type===k.THREAD_NAME&&z.message_count===1;}};},null);
__d("ChatTabViewEvents",["Arbiter"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();'use strict';e.exports=new g();},null);
__d("MercuryParticipantListRenderer",["fbt"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();'use strict';function h(){this.$MercuryParticipantListRenderer0=false;this.$MercuryParticipantListRenderer1=false;this.$MercuryParticipantListRenderer2=false;this.$MercuryParticipantListRenderer3=function(r){return this.$MercuryParticipantListRenderer1?r.short_name:r.name;}.bind(this);}h.prototype.renderParticipantList=function(r){var s=r.map(this.$MercuryParticipantListRenderer3);switch(s.length){case 0:return i(this.$MercuryParticipantListRenderer0);case 1:return j(s);case 2:return this.$MercuryParticipantListRenderer2?l(s):k(s);case 3:return this.$MercuryParticipantListRenderer2?n(s):m(s);default:return this.$MercuryParticipantListRenderer2?p(s):o(s);}};h.prototype.setIsNewThread=function(r){this.$MercuryParticipantListRenderer0=r;return this;};h.prototype.setNameRenderer=function(r){this.$MercuryParticipantListRenderer3=r;return this;};h.prototype.setUseShortName=function(r){this.$MercuryParticipantListRenderer1=r;return this;};h.prototype.setUseAndSeparator=function(r){this.$MercuryParticipantListRenderer2=r;return this;};function i(r){if(r){return (g._("New Message"));}else return (g._("No Participants"));}function j(r){return r[0];}function k(r){return (g._("{participant1}, {participant2}",[g.param("participant1",r[0]),g.param("participant2",r[1])]));}function l(r){return (g._("{participant1} and {participant2}",[g.param("participant1",r[0]),g.param("participant2",r[1])]));}function m(r){return (g._("{participant1}, {participant2}, {participant3}",[g.param("participant1",r[0]),g.param("participant2",r[1]),g.param("participant3",r[2])]));}function n(r){return (g._("{participant1}, {participant2} and {participant3}",[g.param("participant1",r[0]),g.param("participant2",r[1]),g.param("participant3",r[2])]));}function o(r){return (g._("{participant1}, {participant2}, {participant3}, {others_link}",[g.param("participant1",r[0]),g.param("participant2",r[1]),g.param("participant3",r[2]),g.param("others_link",q(r.length-3))]));}function p(r){return (g._("{participant1}, {participant2} and {others_link}",[g.param("participant1",r[0]),g.param("participant2",r[1]),g.param("others_link",q(r.length-2))]));}function q(r){if(r>1){return (g._({"*":"{others_count} others"},[g.param("others_count",r,[0])]));}else return (g._("1 other"));}e.exports=h;},null);
__d("MercuryThreadTitle.react",["MercuryIDs","MercuryParticipantListRenderer","MercuryParticipants","React","TextWithEmoticons.react","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l){b.__markCompiled&&b.__markCompiled();'use strict';var m=j,n=m.PropTypes,o=j.createClass({displayName:"MercuryThreadTitle",propTypes:{isNewThread:n.bool,thread:n.object.isRequired,viewer:n.string.isRequired,showUnreadCount:n.bool,useShortName:n.bool,useAndSeparator:n.bool},getDefaultProps:function(){return {isNewThread:false,showUnreadCount:false,useShortName:false,useAndSeparator:false};},getInitialState:function(){return {participantNames:''};},componentDidMount:function(){this._renderParticipantsList(this.props);},componentWillReceiveProps:function(p){this._renderParticipantsList(p);},render:function(){return (j.createElement("span",{className:this.props.className},this.props.thread.name?this._renderThreadTitle():this.state.participantNames,this.props.children));},getTitle:function(){return this.state.participantNames;},_renderThreadTitle:function(){var p=this.props.thread,q=j.createElement(k,{renderEmoticons:true,renderEmoji:true,text:p.name});if(!p.unread_count||!this.props.showUnreadCount)return q;return this._renderTitleWithUnreadCount(q,p.unread_count);},_renderParticipantsList:function(p){if(p.thread.name)return;var q=g.getParticipantIDFromUserID(p.viewer),r=p.thread.participants;if(r.length>1)r=r.filter(function(s){return s!=q;});i.getMulti(r,function(s){if(!this.isMounted())return;var t=r.map(function(w){return s[w];}),u=new h().setUseShortName(this.props.useShortName).setUseAndSeparator(this.props.useAndSeparator).setIsNewThread(this.props.isNewThread).renderParticipantList(t),v=(p.showUnreadCount&&p.thread.unread_count)?this._renderTitleWithUnreadCount(u,p.thread.unread_count):u;this.setState({participantNames:v});}.bind(this));},_renderTitleWithUnreadCount:function(p,q){return (l._("{conversation-title} ({unread-count})",[l.param("conversation-title",p),l.param("unread-count",q)]));}});e.exports=o;},null);
__d("ChatTabViewSelector",["Arbiter","ArbiterMixin","CSS","ChatTabActions","CurrentUser","DOM","DataStore","Event","MenuDeprecated","MercuryThreadTitle.react","NubController","React","ChatTabTemplates","Toggler","MercuryThreadInformer","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){b.__markCompiled&&b.__markCompiled();var u=b('MercuryThreadInformer').get(),v=b('MercuryThreads').get();function w(x){var y=s[':fb:chat:tab:selector'].build(),z=y.getRoot(),aa=y.getNode('menu'),ba=l.find(aa,'.uiMenuInner'),ca={},da=new q().init(z);i.hide(z);l.insertBefore(x,z);function ea(ha){var ia=0;for(var ja in ca){var ka=ca[ja],la=v.getThreadMetaNow(ja),ma=ka.getNode('unreadCount'),na=(la&&la.unread_count)||0;ia+=na;if(na>9)na='+';i.conditionClass(ma,'invisible_elem',!na);l.setContent(ma,na);}var oa=y.getNode('numMessages');i.conditionShow(oa,ia);l.setContent(oa,ia);}this.setTabData=function(ha){var ia=ca;ca={};if(ha.length<1){i.hide(z);return;}i.show(z);l.empty(ba);ha.forEach(function(la){var ma=s[':fb:chat:tab:selector:item'].build(),na=ma.getNode('content');ca[la.id]=ma;v.getThreadMeta(la.id,function(pa){r.render(r.createElement(p,{thread:pa,useAndSeparator:true,viewer:k.getID()}),na);});l.prependContent(ba,ma.getRoot());m.set(ma.getRoot(),'threadID',la.id);var oa=ma.getNode('closeButton');n.listen(oa,'click',function(event){j.closeTab(la.id,'selector/close-tab');event.kill();});});for(var ja in ia)if(ia.hasOwnProperty(ja)){var ka=ia[ja].getNode('content');ka&&r.unmountComponentAtNode(ka);}da.flyoutContentChanged();l.setContent(y.getNode('numTabs'),ha.length);ea();};function fa(event,ha){if(ha.menu!=aa)return;var ia=m.get(ha.item,'threadID');w.inform('selected',ia);t.hide(z);}function ga(event,ha){o.register(aa);}o.subscribe('select',fa.bind(this));t.listen('show',z,function(){g.inform('layer_shown',{type:'ChatTabSelector'});ga();});t.listen('hide',z,function(){g.inform('layer_hidden',{type:'ChatTabSelector'});});u.subscribe('threads-updated',ea);}Object.assign(w,h);e.exports=w;},null);
__d("ChatTabController",["Arbiter","BanzaiLogger","ChatActivity","ChatConfig","ChatNewMessageHandler","ChatTabActions","ChatTabLRUManager","ChatTabModel","ChatTabPolicy","ChatTabViewEvents","ChatTabViewInstances","ChatTabViewSelector","JSLogger","MercuryViewer","Style","UserAgent_DEPRECATED","VideoCallCore","ChatTabPresence","ChatTypeaheadBehavior","MercuryThreadInformer","MercuryThreadActions","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w){b.__markCompiled&&b.__markCompiled();b('ChatTabPresence');b('ChatTypeaheadBehavior');var x=b('MercuryThreadInformer').get(),y=b('MercuryThreadActions').get(),z=b('MercuryThreads').get(),aa=j.get('tab_auto_close_timeout')||7200000,ba=s.create('tab_controller');function ca(na,oa,pa){var qa=n.get().tabs,ra=qa[na],sa,ta;if(qa.length===0)return false;var ua=qa.slice(na+1),va=qa.slice(0,na),wa=ua.concat(va);if(!oa)wa.reverse();if(ra)wa.push(ra);for(var xa=0;xa<wa.length;xa++){sa=wa[xa];ta=q.get(sa.id);if(ta&&ta.isVisible()&&(!pa||sa.raised)){ta.focus();return true;}}return false;}function da(na,oa){var pa=oa&&oa.getRightmostHiddenTab();if(pa===na)return null;return pa;}function ea(){return Math.floor(Math.random()*2147483648).toString(16);}function fa(na,oa,pa,qa){l.raiseTab(na,true,pa);var ra=oa&&oa.getLeftmostVisibleTab(),sa=oa&&oa.getTabsToShow();if(sa&&!sa[na]&&ra){n.promoteThreadInPlaceOfThread(na,ra,da(na,oa),true);}else l.promoteTab(na);g.inform('chat/open-tab',na);if(qa)return;var ta=q.get(na);ta&&ta.focus();}function ga(na,oa){if(!n.getTab(na))l.raiseTab(na,false);var pa=oa&&m.getLRUVisibleTab(oa),qa=oa&&oa.getTabsToShow();if(qa&&!qa[na]&&pa)n.promoteThreadInPlaceOfThread(na,pa,da(na,oa));}function ha(na){r.subscribe('selected',function(pa,qa){fa(qa,na);});g.subscribe('page_transition',function(pa,qa){l.closeFragileTabs();});g.subscribe('chat-visibility/go-offline',function(){l.closeAllTabs();});i.subscribe('idle',function(pa,qa){if(qa>aa){var ra=n.get().tabs;ra.forEach(function(sa){var ta=sa.id;z.getThreadMeta(ta,function(ua){if(!ua.unread_count){ba.log('autoclose_idle_seen',{thread_id:ta,idleness:qa});l.closeTab(ta,'autoclose_idle_seen');}});});}});p.subscribe('nub-activated',function(pa,qa){fa(qa,na);});p.subscribe('focus-tab',function(pa,qa){var ra=n.getTab(qa);if(ra&&ra.raised)fa(qa,na,ra.signatureID,false);});function oa(pa,qa){h.log('VideoCallLoggerConfig',{event:'chat_tab_call_click'});w.showOutgoingCallDialog(qa.userID,qa.audioOnly,qa.clickSource);}p.subscribe('video-call-clicked',oa);p.subscribe('interaction-with-tab',function(pa,qa){var ra=n.getTab(qa);ra&&ra.raised&&y.markSeen(qa);});p.subscribe('esc-pressed',function(pa,qa){ba.log('close_esc',{thread_id:qa});var ra=n.indexOf(qa);l.closeTab(qa,'close_esc');setTimeout(function(){ca(ra-1,true,true);},0);});x.subscribe('messages-received',function(pa,qa){for(var ra in qa){var sa=qa[ra];for(var ta=0;ta<sa.length;ta++){var ua=sa[ta];if(ua.author!=t.getID()){if(!ua.is_unread){ba.log('message_already_read',{action_id:ua.action_id,thread_id:ua.thread_id});continue;}z.getThreadMeta(ra,function(va){o.messageIsAllowed(va,ua,function(){ga(ra,na);k.newMessage(ra,ua);});});}}}});x.subscribe('thread-read-changed',function(pa,qa){for(var ra in qa)if(!qa[ra].mark_as_read){ba.log('autoclose_marked_unread',{thread_id:ra});l.closeTab(ra,'autoclose_marked_unread');}});p.subscribe('tab-pressed',function(pa,qa){return !ca(n.indexOf(qa.id),qa.shiftPressed);});g.subscribe(s.DUMP_EVENT,function(pa,qa){qa.chat_controller={auto_close_timeout:aa};});this.openTab=function(pa,qa,ra,sa){fa(pa,qa,ea(),sa);if(ra)ra(q.get(pa));};}if(v.firefox()){var ia=function(){return u.get(document.body,'overflowX')+' '+u.get(document.body,'overflowY');},ja=ia(),ka=function(){var na=ia();if(na!==ja){ja=na;g.inform('overflow-applied-to-body');}};if('MutationObserver' in window){var la=new MutationObserver(ka),ma={attributes:true,attributeFilter:['class','style']};la.observe(document.documentElement,ma);}else document.documentElement.addEventListener('DOMAttrModified',function(event){if(event.getTarget()===document.documentElement&&(event.attrName==='class'||event.attrName==='style'))ka();},false);}e.exports=ha;},null);
__d("ChatTabViewPlaceholder",["DOM","ErrorUtils","React","cx"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();'use strict';function k(l,m,n,o,p,q){this.$ChatTabViewPlaceholder0={threadID:m,serverThreadID:n,signatureID:o,root:p,prevTab:q};this.$ChatTabViewPlaceholder1={visible:true,raised:true};l.then(function(r){try{var t=new r(this.$ChatTabViewPlaceholder0.threadID,this.$ChatTabViewPlaceholder0.serverThreadID,this.$ChatTabViewPlaceholder0.signatureID,this.$ChatTabViewPlaceholder0.root,this);t.setVisibleState(this.$ChatTabViewPlaceholder1.visible,this.$ChatTabViewPlaceholder1.raised);this.destroy();this.$ChatTabViewPlaceholder2=t.getTabElem();if(this.$ChatTabViewPlaceholder3)this.$ChatTabViewPlaceholder3(this.$ChatTabViewPlaceholder0.threadID,t);}catch(s){h.reportError(s,false);}}.bind(this));this.render(this.$ChatTabViewPlaceholder0.root,this.$ChatTabViewPlaceholder0.prevTab);}k.prototype.getTabElem=function(){return this.$ChatTabViewPlaceholder2;};k.prototype.onBeingReplaced=function(l){this.$ChatTabViewPlaceholder3=l;};k.prototype.updateSignatureID=function(l){this.$ChatTabViewPlaceholder0.signatureID=l;};k.prototype.getScrollTop=function(){return 0;};k.prototype.appendTo=function(l){g.appendContent(l,this.$ChatTabViewPlaceholder2);};k.prototype.insertBefore=function(l){g.insertBefore(l.getTabElem(),this.$ChatTabViewPlaceholder2);};k.prototype.isFocused=function(){return false;};k.prototype.hasEmptyInput=function(){return true;};k.prototype.destroy=function(){i.unmountComponentAtNode(this.$ChatTabViewPlaceholder2);g.remove(this.$ChatTabViewPlaceholder2);};k.prototype.nextTabIs=function(l){var m=l&&l.getTabElem();return !!(this.$ChatTabViewPlaceholder2&&this.$ChatTabViewPlaceholder2.nextSibling===m);};k.prototype.setVisibleState=function(l,m){this.$ChatTabViewPlaceholder1={visible:l,raised:!!m};this.render(this.$ChatTabViewPlaceholder0.root,this.$ChatTabViewPlaceholder0.prevTab);};k.prototype.render=function(l,m){var n=!this.$ChatTabViewPlaceholder1.visible,o=this.$ChatTabViewPlaceholder1.raised,p=(("fbNub")+(' '+"_50-v")+(n?' '+"hidden_elem":'')+(o?' '+"opened":'')+(' '+"placeholder")+(' '+"_50mz"));if(!this.$ChatTabViewPlaceholder2){var q=g.create('div',{className:p});this.$ChatTabViewPlaceholder2=q;i.render(i.createElement("div",null,i.createElement("span",{className:"fbNubButton"}),"opened"+" "+"? (",i.createElement("div",{className:"fbNubFlyout fbDockChatTabFlyout _16bz"},i.createElement("div",{className:"fbNubFlyoutTitlebar"}),i.createElement("div",{className:"fbNubFlyoutBody"})),")"),q);if(m&&m.getTabElem()){this.insertBefore(m);}else this.appendTo(l);}else this.$ChatTabViewPlaceholder2.className=p;};e.exports=k;},null);
__d("ChatTabViewLoader",["Bootloader","ChatTabViewPlaceholder","Promise","Run","requireWeak"],function(a,b,c,d,e,f,g,h,i,j,k){b.__markCompiled&&b.__markCompiled();'use strict';var l,m;k('ChatTabView',function(o){return m=o;});var n={make:function(o,p,q,r,s){if(m){return new m(o,p,q,r,s);}else{if(!l)l=new i(function(t){j.onAfterLoad(function(){g.loadModules(["ChatTabView"],function(u){m=u;t(u);});});});return new h(l,o,p,q,r,s);}}};e.exports=n;},null);
__d("ChatTabViewCoordinator",["Arbiter","ChatTabModel","ChatTabViewLoader","ChatTabViewSelector","CSS","JSLogger","VideoCallSupport"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){b.__markCompiled&&b.__markCompiled();var n=l.create('chat_tab_coordinator');function o(p,q){var r=new j(p),s={},t=false;function u(){var y=h.get(),z={};y.tabs.forEach(function(ba){z[ba.id]=1;});n.log('process_tab_changed',{model_tabs:Object.keys(z),view_tabs:Object.keys(s)});for(var aa in s)if(!z[aa]){n.log('remove_tab',{tab_id:aa});s[aa].destroy();delete(s[aa]);}v(y);w(y);if(y.tabNeedsFocus&&!y.tabNeedsFocus.isFocused())y.tabNeedsFocus.focus();}function v(y){var z=null;y.tabs.forEach(function(aa){var ba=aa.id,ca=false;if(!s[ba]){n.log('add_tab',{tab_id:ba});s[ba]=i.make(ba,aa.server_id,aa.signatureID,p,z);ca=true;if(s[ba].onBeingReplaced)s[ba].onBeingReplaced(function(ea,fa){s[ea]=fa;});}else s[ba].updateSignatureID(aa.signatureID);if(s[ba].isFocused())y.tabNeedsFocus=s[ba];if(!ca&&!s[ba].nextTabIs(z)){var da=s[ba].getScrollTop();if(z){s[ba].insertBefore(z);}else s[ba].appendTo(p);if(da)s[ba].setScrollTop(da);}z=s[ba];});}function w(y){var z=q.getTabsToShow(y),aa=[],ba=false;y.tabs.forEach(function(ca){if(!z[ca.id]){s[ca.id].setVisibleState(false,ca.raised);aa.push(ca);}});y.tabs.forEach(function(ca){if(z[ca.id]){s[ca.id].setVisibleState(true,ca.raised);ba|=ca.raised;}});r.setTabData(aa);x(ba);}function x(y){if(!y&&t){g.inform('layer_hidden',{type:'ChatTab'});t=false;}else if(y&&!t){g.inform('layer_shown',{type:'ChatTab'});t=true;}}if(m.isVideoCallSupported())k.addClass(p,'videoCallEnabled');q.subscribe('tabs-changed',u);u();}e.exports=o;},null);
__d("TabsViewport",["Arbiter","ArbiterMixin","ChatTabModel","Dock","DOM","DOMDimensions","Event","Parent","Vector","ViewportBounds","areJSONRepresentationsEqual","csx"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){b.__markCompiled&&b.__markCompiled();var s=175,t=269,u=0;function v(){return s;}function w(){return t;}function x(y){this._root=y;var z=this._recalculateWidth.bind(this);m.listen(window,'resize',z);j.subscribe('resize',z);g.subscribeOnce('sidebar/initialized',z,g.SUBSCRIBE_NEW);i.subscribe('change',function(){return this._recalculateTabs(true);}.bind(this));this._recalculateWidth();this._initialized=true;}Object.assign(x.prototype,h,{_root:null,_initialized:false,_availableWidth:0,_maxShown:1,_viewState:null,_recalculateWidth:function(){var y=x._getAvailableDockWidth(this._root),z=Math.max(1,Math.floor(y/w())),aa=z!=this._maxShown;if(!this._viewState||aa||y<=this._viewState.usedWidth||y>this._viewState.widthToShowNext){this._availableWidth=y;this._maxShown=z;this._viewState=null;this._recalculateTabs(aa);}},_onTabsChanged:function(){if(this._initialized){this.inform('tabs-changed');this.inform('max-to-show-changed',this._maxShown);this.inform('max-to-show-change-completed');}},_recalculateTabs:function(y){var z=x._getTabsToShow(i.get(),this._availableWidth);if(y||!q(this._viewState,z)){this._viewState=z;this._onTabsChanged();}},getMaxTabsToShow:function(){return this._maxShown;},checkWidth:function(){this._recalculateWidth();},hasRoomForRaisedTab:function(){return this._availableWidth-this._viewState.usedWidth>w();},getTabsToShow:function(){return JSON.parse(JSON.stringify(this._viewState.tabsToShow));},getShowingTabsOrder:function(){var y=i.get(),z=this._viewState.tabsToShow;return y.tabs.filter(function(aa){return z[aa.id];});},getRightmostHiddenTab:function(){var y=i.get(),z=this._viewState.tabsToShow,aa=y.tabs.filter(function(ca){return !z[ca.id];}),ba=aa.shift();return ba?ba.id:null;},getLeftmostVisibleTab:function(){var y=this.getShowingTabsOrder(),z=y.pop();return z?z.id:null;},getRaisedVisibleTabs:function(){var y=[],z=this.getShowingTabsOrder(),aa=z.length;for(var ba=0;ba<aa;ba++)if(i.getTab(z[ba].id).raised)y.push(z[ba].id);return y;},shouldPromoteOnRaise:function(y){if(!this._viewState.tabsToShow[y])return true;if(this._viewState.nextToHide!=y)return false;var z=i.getTab(y),aa=z&&z.raised;return !aa&&(this._availableWidth-this._viewState.usedWidth<w()-v());}});Object.assign(x,{_getAvailableDockWidth:function(y){var z=l.getViewportWithoutScrollbarDimensions().width;z-=p.getLeft()+p.getRight();z-=50;var aa=n.byClass(y,'fbDock'),ba=k.find(aa,"._56ox"),ca=ba?o.getElementDimensions(ba).x:0;z-=ca;var da=k.scry(aa,"._56oy");ca+=o.getElementDimensions(da.pop()).x;var ea=o.getElementDimensions(aa),fa=ea.x-ca;if(fa>u)u=fa;z-=u;z-=15;return Math.max(z,0);},_getTabsToShow:function(y,z){z=Math.max(z,w()+1);function aa(qa,ra){return (qa.raised||!ra)?w():v();}var ba=JSON.parse(JSON.stringify(y.tabs)),ca=-1,da=null;if(y.promoted)ba.forEach(function(qa,ra){if(qa.id===y.promoted){ca=ra;da=qa;}});var ea=0,fa=false,ga=0,ha=!da;ba.forEach(function(qa,ra){var sa=aa(qa,fa);fa=fa||!qa.raised;qa.leftmostOffset=ea+sa;ea+=sa;if(qa.leftmostOffset<z)ga++;ha|=ra==ca;qa.alreadyPlacedPromoted=ha;});function ia(qa,ra,sa){var ta={};for(var ua=0;ua<ra;ua++){var va=qa[ua];if(!va.alreadyPlacedPromoted&&ua==ra-1){ta[sa]=true;}else ta[va.id]=true;}return ta;}var ja=ia(ba,ga,y.promoted),ka=ia(ba,ga-1,y.promoted),la=null;for(var ma in ja)if(!ka[ma])la=ma;var na=ba[ga-1],oa=na?na.leftmostOffset:0,pa=Infinity;if(ga<ba.length)pa=ba[ga].leftmostOffset;return {nextToHide:la,tabsToShow:ja,usedWidth:oa,widthToShowNext:pa};}});e.exports=x;},null);
__d("MessengerDispatcher",["Dispatcher"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();'use strict';e.exports=new g();},null);
__d("MNCommerceActionTypes",["keyMirrorRecursive"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();'use strict';var h=g({RECEIPT:{LOADED:null,LOAD_ERROR:null,RELOAD:null},SHIPMENT:{LOADED:null,LOAD_ERROR:null,RELOAD:null},DIALOG:{SHOW:null,HIDE:null}});e.exports=h;},null);
__d("MNCommerceDialogStateStore",["FluxStore","MessengerDispatcher","MNCommerceActionTypes"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();'use strict';for(var j in g)if(g.hasOwnProperty(j))l[j]=g[j];var k=g===null?null:g.prototype;l.prototype=Object.create(k);l.prototype.constructor=l;l.__superConstructor__=g;function l(){g.call(this,h);this.$MNCommerceDialogStateStore0=null;this.$MNCommerceDialogStateStore1=null;}l.prototype.__onDispatch=function(m){var n=m.type;switch(n){case i.DIALOG.SHOW:this.$MNCommerceDialogStateStore0=m.dialogContainer;this.$MNCommerceDialogStateStore1=m.state;this.__emitChange();break;case i.DIALOG.HIDE:this.$MNCommerceDialogStateStore0=null;this.$MNCommerceDialogStateStore1=null;this.__emitChange();break;}};l.prototype.getDialogContainer=function(){return this.$MNCommerceDialogStateStore0;};l.prototype.getState=function(){return this.$MNCommerceDialogStateStore1;};e.exports=new l();},null);
__d("MNCommerceDialogContainer.react",["MNCommerceDialogStateStore","PureStoreBasedStateMixin","React"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();'use strict';var j=i.createClass({displayName:"MNCommerceDialogContainer",mixins:[h(g)],statics:{calculateState:function(){var k=g.getDialogContainer();return {dialogContainer:k};}},render:function(){var k=this.state.dialogContainer;if(!k)return null;return i.createElement(k,null);}});e.exports=j;},null);
__d("P2PActionConstants",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();'use strict';var g={CREDIT_CARDS_UPDATED:'credit_cards_updated',CHANNEL_EVENTS_ALLOWED:'channel_events_allowed',CHANNEL_EVENTS_IGNORED:'channel_events_ignored',CREDIT_CARD_ADDED:'credit_card_added',CREDIT_CARD_ADDED_ERROR:'credit_card_added_error',CREDIT_CARD_DELETED:'credit_card_deleted',CREDIT_CARD_DELETED_ERROR:'credit_card_deleted_error',CREDIT_CARD_UPDATED:'credit_card_updated',CREDIT_CARD_UPDATED_ERROR:'credit_card_updated_error',PRESET_CREDIT_CARD_UPDATED:'preset_credit_card_updated',PRESET_CREDIT_CARD_UPDATED_ERROR:'preset_credit_card_updated_error',CREDIT_CARD_VERIFIED:'credit_card_verified',CREDIT_CARD_VERIFIED_ERROR:'credit_card_verified_error',TRANSFERS_UPDATED:'transfers_updated',TRANSFERS_UPDATED_ERROR:'transfers_updated_error',NUX_TRANSFERS_UPDATED:'nux_transfers_updated',TRANSFER_ADDED:'transfer_added',TRANSFER_ADDED_ERROR:'transfer_added_error',TRANSFER_UPDATED:'transfer_updated',TRANSFER_UPDATED_ERROR:'transfer_updated_error',TRANSFER_ACCEPTED:'transfer_accepted',TRANSFER_DECLINED:'transfer_declined',CHAT_SEND_VIEW_OPENED:'chat_send_view_opened',CHAT_SEND_VIEW_CLOSED:'chat_send_view_closed',BIN_NUMBER_VALIDATED:'bin_number_validated',BIN_NUMBER_VALIDATED_ERROR:'bin_number_validated_error',USER_ELIGIBILITY_UDPATED:'user_eligibility_updated',FRIENDS_LIST_UPDATED:'friends_list_updated',DIALOG_SHOWN:'dialog_shown',DIALOG_CLOSED:'dialog_closed',BANNER_STATES_UPDATED:'banner_states_updated',BANNER_DISMISSED:'banner_dismissed',BANNER_VIEWED:'banner_viewed',BANNER_COMPLETED:'banner_completed',MONEYPENNY_TRANSFER_CREATED:'moneypenny_transfer_created',MONEYPENNY_TRANSFER_CREATED_ERROR:'moneypenny_transfer_created_error'};e.exports=g;},null);
__d("P2PDispatcher",["Dispatcher"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();'use strict';e.exports=new g();},null);
__d("P2PDialogStore",["EventEmitter","P2PActionConstants","P2PDispatcher"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();'use strict';var j,k={};for(var l in g)if(g.hasOwnProperty(l))n[l]=g[l];var m=g===null?null:g.prototype;n.prototype=Object.create(m);n.prototype.constructor=n;n.__superConstructor__=g;function n(){g.call(this);j=i.register(this.onEventDispatched.bind(this));k={dialogClass:null,dialogProps:null};}n.prototype.getState=function(){return k;};n.prototype.onEventDispatched=function(o){var p=o.type,q=o.data;switch(p){case h.DIALOG_SHOWN:k.dialogClass=q.dialogClass;k.dialogProps=q.dialogProps;this.emit('change');break;case h.DIALOG_CLOSED:k.dialogClass=null;k.dialogProps=null;this.emit('change');break;}};e.exports=new n();},null);
__d("P2PDialogContainer.react",["P2PDialogStore","React","ReactLayeredComponentMixin"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();'use strict';var j=h.createClass({displayName:"P2PDialogContainer",mixins:[i],getInitialState:function(){return g.getState();},componentDidMount:function(){this.dialogStoreSub=g.addListener('change',this.onDialogStoreChange);},componentWillUnmount:function(){if(this.dialogStoreSub){this.dialogStoreSub.remove();this.dialogStoreSub=null;}},onDialogStoreChange:function(){this.setState(g.getState());},renderLayers:function(){if(!this.state.dialogClass)return {};var k=this.state.dialogClass;return {dialog:h.createElement(k,h.__spread({},this.state.dialogProps))};},render:function(){return null;}});e.exports=j;},null);
__d("HotLikeSound",["MercuryConfig","SoundPlayer","StickerConstants"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();'use strict';h.init(['audio/ogg','audio/mpeg']);var j=[g['sound.hot_like_grow_mp3_url'],g['sound.hot_like_grow_ogg_url']],k=[g['sound.hot_like_pop_mp3_url'],g['sound.hot_like_pop_ogg_url']],l=[g['sound.hot_like_outgoing_small_mp3_url'],g['sound.hot_like_outgoing_small_ogg_url']],m=[g['sound.hot_like_outgoing_medium_mp3_url'],g['sound.hot_like_outgoing_medium_ogg_url']],n=[g['sound.hot_like_outgoing_large_mp3_url'],g['sound.hot_like_outgoing_large_ogg_url']],o=function(){return false;},p={setCheckSoundEnabledFunc:function(q){o=q;},start:function(){this._play(j);},stop:function(){h.stop(j);},pop:function(){this.stop();this._play(k);},snap:function(q){this.stop();if(q===i.HOT_LIKE_SMALL_STICKER_ID)this._play(l);if(q===i.HOT_LIKE_MEDIUM_STICKER_ID)this._play(m);if(q===i.HOT_LIKE_LARGE_STICKER_ID)this._play(n);},_play:function(q){if(o())h.play(q);}};e.exports=p;},null);
__d("ChatApp",["CSS","ChatPerfInstrumentation","DOM","JSLogger","Promise","React","csx"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){b.__markCompiled&&b.__markCompiled();'use strict';var n={init:function(t,u,v){if(this._isInitialized){j.create('chat_app').error('repeated_init');return;}this._rootElem=t;k.resolve().then(function(){return h.init();}).then(function(){return o();}).then(function(){return p(v);}).then(function(){return q(u,t);}).then(function(){return r();}).then(function(){this._isInitialized=this._isLoaded=true;h.logTTI();}.bind(this)).then(function(){return s(v);});},isInitialized:function(){return !!this._isInitialized;},isHidden:function(){return !this._isInitialized||this._isHidden;},hide:function(){if(this.isHidden())return;g.hide(this._rootElem);this._isHidden=true;},unhide:function(){if(this._isInitialized){if(this._isHidden){g.show(this._rootElem);this.tabsViewport.checkWidth();d(['Dock'],function(t){t.resizeAllFlyouts();});this._isHidden=false;}}else if(!this._isLoaded){d(['UIPagelet'],function(t){t.loadFromEndpoint('ChatTabsPagelet','ChatTabsPagelet');t.loadFromEndpoint('BuddylistPagelet','BuddylistPagelet');});this._isLoaded=true;}}};function o(){return new k(function(t){d(['MercuryChannelHandler','MercuryDelayedRoger','MercuryDeliveryState','MercuryParticipants','MercuryStateCheck','MercuryThreads','MercuryUnreadState','MercuryUnseenState'],function(u,v,w,x,y,z,aa,ba){u.get().turnOn();v;w.get();x;z.get();ba.get();aa.get();y.get();t();});});}function p(t){return new k(function(u){d(['MercuryServerPayloadPreprocessor'],function(v){v.get().handleUpdate(t);u();});});}function q(t,u){return new k(function(v){d(['ChatTabController','ChatTabViewCoordinator','TabsViewport','MNCommerceDialogContainer.react','P2PDialogContainer.react'],function(w,x,y,z,aa){n.tabsViewport=new y(t);n.tabViewCoordinator=new x(t,n.tabsViewport);n.tabController=new w(n.tabsViewport);var ba=i.find(u,"._26-x");l.render(l.createElement(z,null),ba);var ca=i.find(u,"._26-y");l.render(l.createElement(aa,null),ca);v();});});}function r(){return new k(function(t){d(['HotLikeSound','ChatOptions'],function(u,v){u.setCheckSoundEnabledFunc(function(){return v.getSetting('sound');});t();});});}function s(t){return new k(function(u){if(!t.threads_to_auto_open||!n.tabsViewport.hasRoomForRaisedTab())u();d(['ChatOpenTab'],function(v){v.openThread(t.threads_to_auto_open.thread_fbid,"autoOpenTab",'',null,true);u();});});}e.exports=n;},null);