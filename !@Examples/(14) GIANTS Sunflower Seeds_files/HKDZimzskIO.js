/*!CK:1127547258!*//*1437526664,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["qMBbW"]); }

__d("ChatSidebarDropdownConstants",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();var g={SOUND:'sound',ADVANCED_SETTINGS:'advanced_settings',TURN_OFF_DIALOG:'turn_off_dialog',CLOSE_ALL_TABS:'close_all_tabs',SIDEBAR:'sidebar',HIDE_GROUPS:'hide_groups',ONLINE:'online',PAUSE:'pause',SHOW_APPS:'show_apps',HIDE_APPS:'hide_apps',SHOW_TICKER:'show_ticker',HIDE_TICKER:'hide_ticker'};e.exports=g;},null);
__d("ChatSidebarSheetChatOffline.react",["Link.react","React","ReactComponentWithPureRenderMixin","fbt"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();'use strict';var k=h,l=k.PropTypes,m=h.createClass({displayName:"ChatSidebarSheetChatOffline",mixins:[i],propTypes:{onGoOnlineClick:l.func.isRequired},render:function(){return (h.createElement("div",null,j._("{=Go online} to see who's available.",[j.param("=Go online",h.createElement(g,{className:"fbChatGoOnlineLink",onClick:this.props.onGoOnlineClick},j._("Turn on chat")))])));}});e.exports=m;},null);
__d("ChatSidebarSheet",["ArbiterMixin","ChannelConnection","ChannelConstants","ChatBehavior","ChatSidebarSheetChatOffline.react","ChatSidebarSheetChatReconnectMsg.react","ChatVisibility","CSS","DOM","Event","JSLogger","PresencePrivacy","React","fbt","mixin","setTimeoutAcrossTransitions"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){b.__markCompiled&&b.__markCompiled();var w=q.create('sidebar_sheet');function x(da){switch(da){case i.HINT_AUTH:return t._("Your session has timed out. Please log in.");case i.HINT_CONN:return t._("Facebook {Chat} is currently unavailable.",[t.param("Chat",t._("Chat"))]);case i.HINT_MAINT:return t._("Facebook {Chat} is currently down for maintenance.",[t.param("Chat",t._("Chat"))]);default:return t._("Facebook {Chat} is currently unavailable.",[t.param("Chat",t._("Chat"))]);}}function y(da,ea){return s.render(s.createElement(l,{msecs:da}),ea);}var z=u(g);for(var aa in z)if(z.hasOwnProperty(aa))ca[aa]=z[aa];var ba=z===null?null:z.prototype;ca.prototype=Object.create(ba);ca.prototype.constructor=ca;ca.__superConstructor__=z;function ca(da){"use strict";z.call(this);this._root=da;this._message=o.find(da,'div.fbChatSidebarMessage div.message');h.subscribe([h.CONNECTED,h.SHUTDOWN,h.RECONNECTING],this._handleConnectionChange.bind(this));h.subscribe([h.MUTE_WARNING,h.UNMUTE_WARNING],this._render.bind(this));r.subscribe('privacy-user-presence-changed',this._render.bind(this));j.subscribe(j.ON_CHANGED,this._render.bind(this));this._render();}ca.prototype._handleConnectionChange=function(da,ea){"use strict";this._channelStatus=da;this._channelData=ea;this._render();};ca.prototype._renderChannelDisconnect=function(){"use strict";if(this._channelStatus===h.SHUTDOWN){return o.setContent(this._message,x(this._channelData));}else if(this._channelStatus===h.RECONNECTING){var da=this._channelData;y(da,this._message);if(da>1000){if(da>i.WARNING_COUNTDOWN_THRESHOLD_MSEC)this._warningMsgEventListener=p.listen(this._message,'click',function(event){if(n.hasClass(event.getTarget(),'fbChatReconnectLink')){h.reconnect();return false;}});this._showWarningTimeout=v(this._handleConnectionChange.bind(this,h.RECONNECTING,da-1000),1000);}}};ca.prototype._renderOffline=function(){"use strict";return s.render(s.createElement(k,{onGoOnlineClick:function(da){w.log('sidebar_go_online');m.goOnline();}}),this._message);};ca.prototype._clear=function(){"use strict";if(this._showWarningTimeout){clearTimeout(this._showWarningTimeout);this._showWarningTimeout=null;}if(this._warningMsgEventListener){this._warningMsgEventListener.remove();this._warningMsgEventListener=null;}if(this._goOnlineEventListener){this._goOnlineEventListener.remove();this._goOnlineEventListener=null;}n.removeClass(this._root,'offline');n.removeClass(this._root,'error');n.removeClass(this._root,'notice');o.empty(this._message);};ca.prototype._render=function(){"use strict";this._clear();if(!m.isOnline()){n.addClass(this._root,'offline');this._renderOffline();}else if(h.disconnected()){n.addClass(this._root,'error');this._renderChannelDisconnect();}else if(!j.notifiesUserMessages()){n.addClass(this._root,'notice');var da=t._("Alerts are off while you use another client to chat.");o.setContent(this._message,da);}this.inform('updated');};Object.assign(ca.prototype,{_channelStatus:null,_channelData:null,_showWarningTimeout:null,_warningMsgEventListener:null,_goOnlineEventListener:null});e.exports=ca;},null);
__d("ChatSidebarDropdown.react",["AppsDivebarDisplayController","Arbiter","AsyncRequest","ChatVisibility","ChatConfig","ChatOptions","ChatSidebarDropdownConstants","ChatTabActions","ContextualDialogArrow","ContextualLayerAutoFlip","Link.react","LogHistory","MenuSeparator.react","PopoverMenu.react","PresenceState","ReactComponentWithPureRenderMixin","React","ReactXUIMenu","SubscriptionsHandler","TrackingNodes","URI","cx","emptyFunction","fbt","ge","joinClasses"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa){b.__markCompiled&&b.__markCompiled();'use strict';var ga=x.Item,ha=x.SelectableItem,ia=x.SelectableMenu,ja=w,ka=ja.PropTypes,la=r.getInstance('blackbird'),ma=w.createClass({displayName:"ChatSidebarDropdown",mixins:[v],propTypes:{className:ka.string,isNormalSidebar:ka.bool,onHide:ka.func,onShow:ka.func,onToggleSidebar:ka.func.isRequired},getDefaultProps:function(){return {className:'',isNormalSidebar:true,onHide:ca,onShow:ca};},getInitialState:function(){return {appsVisible:g.isVisible(),isTickerVisible:this._getTickerVisibility(),pendingChange:false};},componentDidMount:function(){this._subscriptions=new y();this._subscriptions.addSubscriptions(h.subscribe(['Ticker/resized','ticker/show'],function(){this.setState({isTickerVisible:this._getTickerVisibility()});}.bind(this)),h.subscribe(['AppsDivebar/show-apps','AppsDivebar/hide-apps'],function(){this.setState({appsVisible:g.isVisible()});}.bind(this)));},componentWillUnmount:function(){this._subscriptions&&this._subscriptions.release();},_getTickerVisibility:function(){var na=ea('pagelet_ticker');return !!(na&&na.offsetHeight!==0);},_logVisibilityChange:function(na,oa){var pa=oa?'sidebar_dropdown_visibility_error':'sidebar_dropdown_set_visibility';la.debug(pa,{action:na});},_changeSetting:function(na,oa){if(this.state.pendingChange)return;this.setState({pendingChange:true});var pa={};pa[na]=!oa;l.setSetting(na,!oa,'mini_sidebar_menu');new i('/ajax/chat/settings.php').setHandler(u.doSync).setErrorHandler(function(){return l.setSetting(na,oa,'mini_sidebar_menu_error');}).setFinallyHandler(function(){return this.setState({pendingChange:false});}.bind(this)).setData(pa).setAllowCrossPageTransition(true).send();},_onClickOption:function(na,oa){var pa=true;switch(na){case m.SOUND:this._changeSetting(na,oa);break;case m.ADVANCED_SETTINGS:case m.TURN_OFF_DIALOG:h.inform('chat/advanced-settings-dialog-opened');this._logVisibilityChange(na,false);break;case m.CLOSE_ALL_TABS:n.closeAllTabs();this._logVisibilityChange(na,false);break;case m.HIDE_GROUPS:this._changeSetting(na,oa);break;case m.SIDEBAR:this.props.onToggleSidebar();pa=false;break;case m.ONLINE:!j.isOnline()?j.goOnline():this._logVisibilityChange(na,true);break;case m.PAUSE:break;case m.SHOW_TICKER:h.inform('ChatSidebarDropdown/openTicker');break;case m.HIDE_TICKER:h.inform('ChatSidebarDropdown/closeTicker');break;case m.SHOW_APPS:g.showApps();break;case m.HIDE_APPS:g.hideApps();break;}if(pa&&this.refs.menu)this.refs.menu.hidePopover();},_onItemClick:function(na,oa){var pa=oa.item.getValue(),qa=oa.item.isSelected&&oa.item.isSelected();this._onClickOption(pa,!!qa);},_renderChatSoundOption:function(){return (w.createElement(ha,{value:m.SOUND,selected:l.getSetting(m.SOUND)},da._("Chat Sounds")));},_renderAdvancedSettingsOption:function(){return (w.createElement(ga,{href:new aa('/ajax/chat/privacy/settings_dialog.php'),rel:"dialog",value:m.ADVANCED_SETTINGS},da._("Advanced Settings...")));},_renderCloseAllOption:function(){return (w.createElement(ga,{value:m.CLOSE_ALL_TABS},da._("Close All Chat Tabs")));},_renderHideSidebarOption:function(){return (w.createElement(ga,{className:"_2xvi",value:m.SIDEBAR},da._("Hide Sidebar")));},_renderHideGroupsOption:function(){if(!this.props.isNormalSidebar)return null;return (w.createElement(ha,{value:m.HIDE_GROUPS,selected:l.getSetting(m.HIDE_GROUPS)},da._("Hide Groups")));},_renderOnlineOption:function(){var na=j.isOnline(),oa=na?(new aa('/ajax/chat/privacy/settings_dialog.php')).addQueryData('dialog_type','turn_off_dialog'):'#',pa=na?da._("Turn Off Chat"):da._("Turn On Chat"),qa=na?m.TURN_OFF_DIALOG:m.ONLINE;return (w.createElement(ga,{href:oa,rel:na?'dialog':'',value:qa},pa));},_renderAppsOption:function(){if(!k.get('has_apps_option')||!this.props.isNormalSidebar)return null;var na=this.state.appsVisible,oa=na?da._("Hide Games"):da._("Show Games"),pa=na?m.HIDE_APPS:m.SHOW_APPS;return (w.createElement(ga,{value:pa},oa));},_renderTickerToggleOption:function(){if(!k.get('has_ticker_toggle_option')||!this.props.isNormalSidebar)return null;var na=this.state.isTickerVisible,oa=na?da._("Hide Ticker"):da._("Show Ticker"),pa=na?m.HIDE_TICKER:m.SHOW_TICKER;return (w.createElement(ga,{value:pa},oa));},_renderConditionalSeparator:function(na){if(!na)return null;return w.createElement(s,null);},_renderMenu:function(){return (w.createElement(ia,{className:'fbChatSidebarDropdown/PopoverMenu',multiple:true,onItemClick:this._onItemClick},this._renderChatSoundOption(),this._renderAdvancedSettingsOption(),this._renderConditionalSeparator(true),this._renderCloseAllOption(),this._renderHideSidebarOption(),this._renderHideGroupsOption(),this._renderOnlineOption(),this._renderConditionalSeparator(!!k.get('has_apps_option')&&this.props.isNormalSidebar),this._renderAppsOption(),this._renderConditionalSeparator(!!k.get('has_ticker_toggle_option')&&this.props.isNormalSidebar),this._renderTickerToggleOption()));},render:function(){var na=da._("Options"),oa=fa(this.props.className,(("_5qth")+(' '+"_5vm9")+(!j.isOnline()?' '+"_5vma":''))),pa=z.getTrackingInfo(z.types.DROPDOWN_BUTTON);return (w.createElement(t,{alignh:"right",alignv:"top",className:oa,layerBehaviors:[p,o],menu:this._renderMenu(),onHide:this.props.onHide,onShow:this.props.onShow,ref:"menu"},w.createElement(q,{"aria-label":na,className:"_5vmb button","data-ft":pa,"data-hover":"tooltip",href:"#"})));}});e.exports=ma;},null);