/*!CK:3842660700!*//*1438925312,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["L9zhh"]); }

__d("ChatSidebarSheet.react",["ChannelConnection","ChatBehavior","ChatSidebarSheetChatOffline.react","ChatSidebarSheetChatReconnectMsg.react","ChatSidebarSheetChatShutdownMsg.react","ChatVisibility","CSS","JSLogger","PresencePrivacy","ReactComponentWithPureRenderMixin","React","SubscriptionsHandler","emptyFunction","fbt","setTimeoutAcrossTransitions"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u){b.__markCompiled&&b.__markCompiled();'use strict';var v=n.create('sidebar_sheet'),w=q,x=w.PropTypes,y=q.createClass({displayName:"ChatSidebarSheet",mixins:[p],propTypes:{onUpdate:x.func,root:x.object.isRequired},getInitialState:function(){return {channelStatus:null,channelData:null,isConnected:!g.disconnected(),isOnline:l.isOnline(),notifiesUserMessages:h.notifiesUserMessages()};},getDefaultProps:function(){return {onUpdate:s};},_subscriptions:r,_showWarningTimeout:(null),componentDidMount:function(){this._subscriptions=new r();this._subscriptions.addSubscriptions(g.subscribe([g.CONNECTED,g.SHUTDOWN,g.RECONNECTING],this._handleConnectionChange),g.subscribe([g.MUTE_WARNING,g.UNMUTE_WARNING],this._calculateState),o.subscribe('privacy-user-presence-changed',this._calculateState),h.subscribe(h.ON_CHANGED,this._calculateState));},componentWillUpdate:function(){if(this._showWarningTimeout){clearTimeout(this._showWarningTimeout);this._showWarningTimeout=null;}m.removeClass(this.props.root,'offline');m.removeClass(this.props.root,'error');m.removeClass(this.props.root,'notice');},componentDidUpdate:function(){if(this.props.onUpdate)this.props.onUpdate();},componentWillUnmount:function(){this._subscriptions&&this._subscriptions.release();},render:function(){if(!this.state.isOnline){m.addClass(this.props.root,'offline');return this._renderOffline();}else if(!this.state.isConnected){m.addClass(this.props.root,'error');return this._renderChannelDisconnect();}else if(!this.state.notifiesUserMessages){m.addClass(this.props.root,'notice');return this._renderNotice();}return null;},_handleConnectionChange:function(z,aa){this.setState({channelStatus:z,channelData:aa});this._calculateState();},_calculateState:function(){this.setState({isConnected:!g.disconnected(),isOnline:l.isOnline(),notifiesUserMessages:h.notifiesUserMessages()});},_renderChannelDisconnect:function(){if(this.state.channelStatus===g.SHUTDOWN){return (q.createElement(k,{hint:this.state.channelData}));}else if(this.state.channelStatus===g.RECONNECTING){var z=this.state.channelData;if(z>1000)this._showWarningTimeout=u(this._handleConnectionChange.bind(this,g.RECONNECTING,z-1000),1000);return (q.createElement(j,{msecs:z,onManuallyConnectClick:function(){return g.reconnect();}}));}return null;},_renderOffline:function(){return (q.createElement(i,{onGoOnlineClick:function(z){v.log('sidebar_go_online');l.goOnline();}}));},_renderNotice:function(){return (q.createElement("div",null,t._("Alerts are off while you use another client to chat.")));}});e.exports=y;},null);