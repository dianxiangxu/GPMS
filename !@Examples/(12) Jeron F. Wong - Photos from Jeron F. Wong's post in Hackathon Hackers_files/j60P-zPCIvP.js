/*!CK:1571995989!*//*1439019380,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["gsHOL"]); }

__d("MercuryActionStatus",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports={UNSENT:0,SUCCESS:1,UNCONFIRMED:3,FAILED_UNKNOWN_REASON:4,UNABLE_TO_CONFIRM:5,RESENT:6,RESENDING:7,ERROR:10};},null);
__d("MercuryActionType",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports={LOG_MESSAGE:"ma-type:log-message",USER_GENERATED_MESSAGE:"ma-type:user-generated-message",CHANGE_READ_STATUS:"ma-type:change_read_status",MARK_THREAD_SEEN:"ma-type:mark_thread_seen",CHANGE_MUTE_SETTINGS:"ma-type:change-mute-settings",SEND_MESSAGE:"ma-type:send-message",UPDATE_ACTION_ID:"ma-type:update-action-id",DELETE_MESSAGES:"ma-type:delete-messages",DELETE_THREAD:"ma-type:delete-thread",CHANGE_ARCHIVED_STATUS:"ma-type:change-archived-status",CHANGE_FOLDER:"ma-type:change-folder",ADD_PARTICIPANTS:"ma-type:add-participants",CANCEL_ATTACHMENT_PLACEHOLDER:"ma-type:cancel-attachment-placeholder",CONFIRM_ATTACHMENT_PLACEHOLDER:"ma-type:confirm-attachment-placeholder",UNPIN_THREAD:"ma-type:unpin-thread",CHANGE_FLAG:"ma-type:change_flag",MOVE_PENDING_TO_INBOX:"ma-type:move_pending_to_inbox",UPDATE_BLOCKER_STATUS:"ma-type:update-blocker-status",UPDATE_BLOCKEE_STATUS:"ma-type:update-blockee-status"};},null);
__d("MercuryAPIArgsSource",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports={CHAT:"chat",JEWEL:"jewel",MERCURY:"mercury",MERCURYSYNC:"mercury_sync",WEBMESSENGER:"web_messenger",MESSENGER:"messenger"};},null);
__d("MercuryAttachmentContentType",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports={PHOTO:"attach:image",VIDEO:"attach:video",MUSIC:"attach:music",VOICE:"attach:voice",TEXT:"attach:text",MSWORD:"attach:ms:word",MSXLS:"attach:ms:xls",MSPPT:"attach:ms:ppt",ORION:"attach:orion",SHOERACK_INVITATION:"attach:shoerackinvite",UNKNOWN:"attach:unknown"};},null);
__d("MercuryAttachmentType",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports={ERROR:"error",FILE:"file",PHOTO:"photo",STICKER:"sticker",SHARE:"share",UNKNOWN:"unknown",VIDEO:"video",ANIMATED_IMAGE:"animated_image"};},null);
__d("MercuryAudioType",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports={AudioClip:"fb_voice_message",VoiceMessageWithTranscript:"fb_voice_message_with_transcript"};},null);
__d("MercuryErrorType",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports={SERVER:1,TRANSPORT:2,TIMEOUT:3};},null);
__d("MercuryGlobalActionType",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports={MARK_ALL_READ:"mga-type:mark-all-read"};},null);
__d("MercuryLogMessageType",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports={SUBSCRIBE:"log:subscribe",UNSUBSCRIBE:"log:unsubscribe",VIDEO_CALL:"log:video-call",PHONE_CALL:"log:phone-call",THREAD_NAME:"log:thread-name",THREAD_IMAGE:"log:thread-image",SERVER_ERROR:"log:error-msg",LIVE_LISTEN:"log:live-listen",WALLPAPER:"log:wallpaper",ORION:"log:orion",SWITCH_TO_WORK:"log:switch",PAGE_REPLY:"log:page-reply",GENERIC_ADMIN_TEXT:"log:generic-admin-text"};},null);
__d("MercuryMessageSourceTags",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports={CHAT:"source:chat",EMAIL:"source:email",MESSENGER:"source:messenger",MOBILE:"source:mobile"};},null);
__d("MercuryParticipantTypes",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports={USER:"user",THREAD:"thread",EVENT:"event",PAGE:"page",FRIEND:"friend",FB4C:"fb4c",NON_FRIEND:"non_friend"};},null);
__d("MercuryPayloadSource",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports={UNKNOWN:"unknown",CLIENT_CHANNEL_MESSAGE:"client_channel_message",CLIENT_SEND_MESSAGE:"client_send_message",CLIENT_CHANGE_ARCHIVED_STATUS:"client_change-archived_status",CLIENT_CHANGE_FOLDER:"client_change_folder",CLIENT_CHANGE_MUTE_SETTINGS:"client_change_mute_settings",CLIENT_CHANGE_READ_STATUS:"client_change_read_status",CLIENT_MARK_THREAD_SEEN:"client_mark_thread_seen",CLIENT_ADD_PARTICIPANTS:"client_add_participants",CLIENT_FETCH_PARTICIPANTS:"client_fetch_participants",CLIENT_DELETE_MESSAGES:"client_delete_messages",CLIENT_DELETE_THREAD:"client_delete_thread",CLIENT_HANDLE_ERROR:"client_handle_error",CLIENT_UNPIN_THREAD:"client_unpin_thread",CLIENT_CHANGE_FLAG:"client_change_flag",CLIENT_MOVE_PENDING_TO_INBOX:"client_move_pending_to_inbox",SERVER_INITIAL_DATA:"server_initial_data",SERVER_SEND_MESSAGE:"server_send_message",SERVER_CHANGE_ARCHIVED_STATUS:"server_change_archived_status",SERVER_CHANGE_READ_STATUS:"server_change_read_status",SERVER_MARK_FOLDER_READ:"server_mark_folder_read",SERVER_MARK_SEEN:"server_mark_seen",SERVER_FETCH_PARTICIPANTS:"server_fetch_participants",SERVER_FETCH_THREAD_INFO:"server_fetch_thread_info",SERVER_FETCH_THREADLIST_INFO:"server_fetch_threadlist_info",SERVER_STANDALONE_NOTIFICATIONS:"server_standalone_notifications",SERVER_THREAD_SYNC:"server_thread_sync",SERVER_TAB_PRESENCE:"server_tab_presence",SERVER_UNREAD_THREADS:"server_unread_threads",SERVER_SEARCH:"server_search",SERVER_CHANGE_FLAG:"server_change_flag"};},null);
__d("MercurySourceType",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports={CHAT_ORCA:"source:chat:orca",CHAT_IPHONE:"source:chat:iphone",CHAT_JABBER:"source:chat:jabber",CHAT_MEEBO:"source:chat:meebo",CHAT_WEB:"source:chat:web",CHAT_TEST:"source:chat:test",CHAT_FORWARD_DIALOG:"source:chat:forward",CHAT:"source:chat",EMAIL:"source:email",EVENT_MESSAGE_BLAST:"source:event_message_blast",GIGABOXX_API:"source:gigaboxx:api",GIGABOXX_BLAST:"source:gigaboxx:blast",GIGABOXX_EMAIL_REPLY:"source:gigaboxx:emailreply",GIGABOXX_MOBILE:"source:gigaboxx:mobile",GIGABOXX_WAP:"source:gigaboxx:wap",GIGABOXX_WEB:"source:gigaboxx:web",LEIA:"source:leia",MESSENGER_WEB:"source:messenger:web",SAM_UFI:"source:sam:ufi",SHARE_DIALOG:"source:share:dialog",SEND_PLUGIN:"source:sendplugin",SMS:"source:sms",TEST:"source:test",TITAN_WAP:"source:titan:wap",TITAN_M_BASIC:"source:titan:m_basic",TITAN_M_FREE:"source:titan:m_free_basic",TITAN_M_JAPAN:"source:titan:m_japan",TITAN_M_MINI:"source:titan:m_mini",TITAN_M_TOUCH:"source:titan:m_touch",TITAN_M_APP:"source:titan:m_app",TITAN_M_TABLET:"source:titan:m_tablet",TITAN_M_ZERO:"source:titan:m_zero",TITAN_M_TALK:"source:titan:m_talk",TITAN_WEB:"source:titan:web",TITAN_FACEWEB_ANDROID:"source:titan:faceweb_android",TITAN_FACEWEB_BUFFY:"source:titan:faceweb_buffy",TITAN_FACEWEB_IPAD:"source:titan:faceweb_ipad",TITAN_FACEWEB_IPHONE:"source:titan:faceweb_iphone",TITAN_FACEWEB_UNKNOWN:"source:titan:faceweb_unknown",TITAN_API:"source:titan:api",TITAN_API_MOBILE:"source:titan:api_mobile",TITAN_ORCA:"source:titan:orca",TITAN_EMAIL_REPLY:"source:titan:emailreply",MOBILE:"source:mobile",PAGE_PLATFORM_API:"source:page_platform_api",UNKNOWN:"source:unknown",WEB:"source:web",HELPCENTER:"source:helpcenter",NEW_SHARE_DIALOG:"source:share:dialog:new",PAID_PROMOTION:"source:paid_promotion",BUFFY_SMS:"source:buffy:sms",WEBRTC_MOBILE:"source:webrtc:mobile",MESSENGER_COMMERCE:"source:messenger:commerce",MESSENGER_BOT:"source:bot"};},null);
__d("MercuryTimePassed",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports={TODAY:0,WEEK_AGO:1,MONTH_AGO:2,CURRENT_YEAR:3,OTHER_YEAR:4};},null);
__d("MessagingEvent",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports={DELETE:"delete",DELETE_MESSAGES:"delete_messages",DELIVER:"deliver",ERROR:"error",READ:"read",REPORT_SPAM:"report_spam",REPORT_SPAM_MESSAGES:"report_spam_messages",UNMARK_SPAM:"unmark_spam",SUBSCRIBE:"subscribe",CHANGE_MUTE_SETTINGS:"change_mute_settings",TAG:"tag",UNREAD:"unread",UNSUBSCRIBE:"unsubscribe",DELIVER_LOG:"deliver_log",MORE_THREADS:"more_threads",READ_ALL:"read_all",READ_RECEIPT:"read_receipt",DELIVERY_RECEIPT:"delivery_receipt",SENT_PUSH:"sent_push",DELIVER_FAST_PAST:"deliver_fast_path",MESSENGER_STATUS:"messenger_status",UPDATE_PINNED_THREADS:"update_pinned_threads",CHANGE_PAGE_THREAD_FLAG:"change_page_thread_flag",UPDATE_BLOCKER_STATUS:"update_blocker_status",UPDATE_BLOCKEE_STATUS:"update_blockee_status"};},null);
__d("MessagingRealtimeConstants",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports={VIEWER_FBID:"realtime_viewer_fbid"};},null);
__d("MessagingTag",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports={GROUPS:"groups",UNREAD:"unread",FLAGGED:"flagged",ACTION_ARCHIVED:"action:archived",INBOX:"inbox",OTHER:"other",PENDING:"pending",MONTAGE:"montage",EVENT:"event",SENT:"sent",SMS_MUTE:"sms_mute",SPAM:"spam",UPDATES:"broadcasts_inbox",BCC:"header:bcc",FILTERED_CONTENT:"filtered_content",FILTERED_CONTENT_BH:"filtered_content_bh",FILTERED_CONTENT_ACCOUNT:"filtered_content_account",UNAVAILABLE_ATTACHMENT:"unavailable_attachment",ARCHIVED:"archived",EMAIL:"email",VOICEMAIL:"voicemail",SPAM_SPOOFING:"spam:spoofing",SPOOF_WARNING:"MTA:spoof_warning",SMS_TAG_ROOT:"SMSShortcode:",APP_ID_ROOT:"app_id:",DOMAIN_AUTH_PASS:"MTA:dmarc:pass",DOMAIN_AUTH_FAIL:"MTA:dmarc:fail",MTA_SYSTEM_MESSAGE:"MTA:system_message",EMAIL_MESSAGE:"source:email"};},null);
__d("PageMessageEnumTag",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports={FLAG:"flag",LOW_VALUE:"low_value",SPAM_SPOOFING:"spam_spoofing"};},null);
__d("SyncRequestStatusEnum",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports={PENDING:0,ACCEPTED:1,REJECTED:2,EXPIRED:3,CANCELED:4,namesByValue:["PENDING","ACCEPTED","REJECTED","EXPIRED","CANCELED"]};},null);
__d("AvailableListConstants",["fbt"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();var h={ON_AVAILABILITY_CHANGED:'buddylist/availability-changed',ON_UPDATE_ERROR:'buddylist/update-error',ON_UPDATED:'buddylist/updated',ON_CHAT_NOTIFICATION_CHANGED:'chat-notification-changed',OFFLINE:0,IDLE:1,ACTIVE:2,MOBILE:3,WEB_STATUS:'webStatus',FB_APP_STATUS:'fbAppStatus',MESSENGER_STATUS:'messengerStatus',OTHER_STATUS:'otherStatus',STATUS_ACTIVE:'active',STATUS_IDLE:'idle',STATUS_OFFLINE:'offline',ACTIVE_ON_WEB:g._("Web"),ACTIVE_ON_MOBILE:g._("Mobile")};a.AvailableListConstants=e.exports=h;},null);
__d("ChatConfig",["ChatConfigInitialData"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();var h={},i={get:function(j,k){return j in h?h[j]:k;},set:function(j){if(arguments.length>1){var k={};k[j]=arguments[1];j=k;}Object.assign(h,j);},getDebugInfo:function(){return h;}};i.set(g);e.exports=i;},null);
__d("PresenceUtil",["CurrentUser","randomInt"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();var i=h(0,4294967295)+1;function j(){return i;}function k(){return g.isLoggedInNow();}e.exports={getSessionID:j,hasUserCookie:k};},null);
__d("PresencePrivacy",["Arbiter","AsyncRequest","ChannelConstants","CurrentUser","PresencePrivacyInitialData","JSLogger","PresenceUtil"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){b.__markCompiled&&b.__markCompiled();var n='/ajax/chat/privacy/settings.php',o='/ajax/chat/privacy/online_policy.php',p='/ajax/chat/privacy/visibility.php',q='friend_visibility',r='visibility',s='online_policy',t=Object.assign({},k.privacyData),u=k.visibility,v=Object.assign({},k.privacyData),w=u,x=k.onlinePolicy,y=x,z=[],aa=false;function ba(){return l.create('blackbird');}var ca=Object.assign(new g(),{WHITELISTED:1,BLACKLISTED:-1,UNLISTED:0,ONLINE:1,OFFLINE:0,ONLINE_TO_WHITELIST:0,ONLINE_TO_BLACKLIST:1});function da(pa){var qa;for(qa in pa){var ra=pa[qa];if(qa==j.getID()){ba().error('set_viewer_visibility');throw new Error("Invalid to set current user's visibility");}switch(ra){case ca.WHITELISTED:case ca.BLACKLISTED:case ca.UNLISTED:break;default:ba().error('set_invalid_friend_visibility',{id:qa,value:ra});throw new Error("Invalid state: "+ra);}}for(qa in pa)t[qa]=pa[qa];ca.inform('privacy-changed');}function ea(pa,qa){var ra={};ra[pa]=qa;da(ra);}function fa(pa){switch(pa){case ca.ONLINE:case ca.OFFLINE:break;default:ba().error('set_invalid_visibility',{value:pa});throw new Error("Invalid visibility: "+pa);}u=pa;ca.inform('privacy-changed');ca.inform('privacy-user-presence-changed');g.inform('chat/visibility-changed',{sender:this});}function ga(pa){switch(pa){case ca.ONLINE_TO_WHITELIST:case ca.ONLINE_TO_BLACKLIST:break;default:throw new Error("Invalid default online policy: "+pa);}x=pa;ca.inform('privacy-user-presence-changed');ca.inform('privacy-changed');}function ha(pa,qa){aa=true;pa.send();}function ia(pa,qa){z.push({request:pa,data:qa});if(!aa){var ra=z.shift();ha(ra.request,ra.data);}}function ja(pa,qa){var ra=pa.type;if(ra===q){var sa=qa.payload.user_availabilities;if(!Array.isArray(sa)){ca.inform('privacy-availability-changed',{user_availabilities:sa});for(var ta in pa.settings)v[ta]=pa.settings[ta];}}else{if(ra===r){w=pa.visibility;}else if(ra===s)y=pa.online_policy;ca.inform('privacy-user-presence-response');}ba().log('set_update_response',{data:pa,response:qa});}function ka(pa,qa){if(u!==w)fa(w);if(x!==y)ga(y);Object.assign(t,v);ca.inform('privacy-changed');z=[];ba().log('set_error_response',{data:pa,response:qa});}function la(pa){aa=false;if(z.length>0){var qa=z.shift();ha(qa.request,qa.data);}}function ma(pa,qa){if(m!=null){var ra=pa.getData();ra.window_id=m.getSessionID();pa.setData(ra);}pa.setHandler(ja.bind(this,qa)).setErrorHandler(ka.bind(this,qa)).setTransportErrorHandler(ka.bind(this,qa)).setFinallyHandler(la.bind(this)).setAllowCrossPageTransition(true);return pa;}function na(pa,qa,ra){return ma(new h(pa).setData(qa),ra);}function oa(pa,qa){var ra=qa.obj;if(ra.viewer_id!=j.getID()){ba().error('invalid_viewer_for_channel_message',{type:pa,data:qa});throw new Error("Viewer got from the channel is not the real viewer");}if(ra.window_id===m.getSessionID())return;var sa=ra.data;if(ra.event=='access_control_entry'){sa.target_ids.forEach(function(ua){ea(ua,sa.setting);v[ua]=sa.setting;});}else{if(ra.event=='visibility_update'){var ta=!!sa.visibility?ca.ONLINE:ca.OFFLINE;fa(ta);w=ta;}else if(ra.event=='online_policy_update'){ga(sa.online_policy);y=sa.online_policy;}ca.inform('privacy-user-presence-response');}ba().log('channel_message_received',{data:qa.obj});}Object.assign(ca,{WHITELISTED:1,BLACKLISTED:-1,UNLISTED:0,ONLINE:1,OFFLINE:0,ONLINE_TO_WHITELIST:0,ONLINE_TO_BLACKLIST:1,init:function(pa,qa,ra){},setVisibility:function(pa){w=u;fa(pa);var qa={visibility:pa},ra={type:r,visibility:pa},sa=na(p,qa,ra);ia(sa,ra);ba().log('set_visibility',{data:qa});return pa;},getVisibility:function(){return u;},setOnlinePolicy:function(pa){y=x;ga(pa);var qa={online_policy:pa},ra={type:s,online_policy:pa},sa=na(o,qa,ra);ia(sa,ra);ba().log('set_online_policy',{data:qa});return pa;},getOnlinePolicy:function(){return x;},getFriendVisibility:function(pa){return t[pa]||ca.UNLISTED;},isUserOffline:function(){return this.getVisibility()===ca.OFFLINE;},allows:function(pa){if(this.isUserOffline())return false;var qa=this.getOnlinePolicy();return qa===ca.ONLINE_TO_WHITELIST?t[pa]==ca.WHITELISTED:t[pa]!=ca.BLACKLISTED;},setFriendsVisibility:function(pa,qa){if(pa.length>0){var ra={};for(var sa=0;sa<pa.length;sa++){var ta=pa[sa];v[ta]=t[ta];ra[ta]=qa;}da(ra);var ua=qa;if(ua==ca.UNLISTED)ua=v[pa[0]];var va={users:pa,setting:qa,setting_type:ua},wa={type:q,settings:ra},xa=na(n,va,wa);ia(xa,wa);ba().log('set_friend_visibility',{data:va});}return qa;},setFriendVisibilityMap:function(pa,qa){for(var ra in pa)v[ra]=t[ra];da(pa);var sa={type:q,settings:pa};ia(ma(qa,sa),sa);ba().log('set_friend_visibility_from_map',{data:pa});},allow:function(pa){if(this.allows(pa)){ba().error('allow_already_allowed');throw new Error("allow() should only be called for users that "+"are not already allowed");}if(this.getVisibility()===ca.OFFLINE){ba().error('allow_called_while_offline');throw new Error("allow() should only be called when the user is already online");}var qa=this.getOnlinePolicy()===ca.ONLINE_TO_WHITELIST?ca.WHITELISTED:ca.UNLISTED;return this.setFriendsVisibility([pa],qa);},disallow:function(pa){if(!this.allows(pa)){ba().error('disallow_already_disallowed');throw new Error("disallow() should only be called for users that "+"are not already disallowed");}if(this.getVisibility()===ca.OFFLINE){ba().error('disallow_called_while_offline');throw new Error("disallow() should only be called when the user is already online");}var qa=this.getOnlinePolicy()===ca.ONLINE_TO_BLACKLIST?ca.BLACKLISTED:ca.UNLISTED;return this.setFriendsVisibility([pa],qa);},getBlacklist:function(){var pa=[];for(var qa in t)if(t[qa]===ca.BLACKLISTED)pa.push(qa);return pa;},getWhitelist:function(){var pa=[];for(var qa in t)if(t[qa]===ca.WHITELISTED)pa.push(qa);return pa;},getMapForTest:function(){return t;},setMapForTest:function(pa){t=pa;}});ca.inform('privacy-changed');ca.inform('privacy-user-presence-changed',g.BEHAVIOR_STATE);ba().log('initialized',{visibility:u,policy:x});g.subscribe(l.DUMP_EVENT,function(pa,qa){qa.presence_privacy={initial:k.privacyData,current:t};});g.subscribe(i.getArbiterType('privacy_changed'),oa.bind(this));g.subscribe(i.ON_CONFIG,function(pa,qa){var ra=qa.getConfig('visibility',null);if(ra!==null&&typeof(ra)!=='undefined'){var sa=ra?ca.ONLINE:ca.OFFLINE;fa(sa);ba().log('config_visibility',{vis:sa});}}.bind(this));a.PresencePrivacy=e.exports=ca;},3);
__d("ChatVisibility",["Arbiter","JSLogger","PresencePrivacy"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();var j={isOnline:function(){return i.getVisibility()===i.ONLINE;},hasBlackbirdEnabled:function(){return this.isVisibleToMostFriends()||this.isVisibleToSomeFriends();},isVisibleToMostFriends:function(){return i.getOnlinePolicy()===i.ONLINE_TO_BLACKLIST&&i.getBlacklist().length>0;},isVisibleToSomeFriends:function(){return i.getOnlinePolicy()===i.ONLINE_TO_WHITELIST&&i.getWhitelist().length>0;},goOnline:function(k){if(i.getVisibility()===i.OFFLINE){h.create('blackbird').log('chat_go_online');i.setVisibility(i.ONLINE);g.inform('chat-visibility/go-online');}k&&k();},goOffline:function(k){if(i.getVisibility()===i.ONLINE){h.create('blackbird').log('chat_go_offline');i.setVisibility(i.OFFLINE);g.inform('chat-visibility/go-offline');}k&&k();},toggleVisibility:function(){if(j.isOnline()){j.goOffline();}else j.goOnline();}};e.exports=j;},null);
__d("Poller",["ArbiterMixin","AsyncRequest","CurrentUser","emptyFunction","mixin","setTimeoutAcrossTransitions"],function(a,b,c,d,e,f,g,h,i,j,k,l){b.__markCompiled&&b.__markCompiled();var m=k(g);for(var n in m)if(m.hasOwnProperty(n))p[n]=m[n];var o=m===null?null:m.prototype;p.prototype=Object.create(o);p.prototype.constructor=p;p.__superConstructor__=m;function p(s){"use strict";m.call(this);this._config=Object.assign({clearOnQuicklingEvents:true,setupRequest:j,interval:null,maxRequests:Infinity,dontStart:false},s);this._handle=null;if(!this._config.dontStart)this.start();}p.prototype.start=function(){"use strict";if(this._polling)return this;this._requests=0;this.request();return this;};p.prototype.stop=function(){"use strict";this._cancelRequest();return this;};p.prototype.mute=function(){"use strict";this._muted=true;return this;};p.prototype.resume=function(){"use strict";if(this._muted){this._muted=false;if(this._handle===null&&this._polling)return this.request();}return this;};p.prototype.skip=function(){"use strict";this._skip=true;return this;};p.prototype.reset=function(){"use strict";return this.stop().start();};p.prototype.request=function(){"use strict";this._cancelRequest();this._polling=true;if(!r())return this._done();if(this._muted)return this;if(++this._requests>this._config.maxRequests)return this._done();var s=new h();s.setIsBackgroundRequest(true);var t=false;s.setInitialHandler(function(){return !t;});this._cancelRequest=function(){t=true;this._cleanup();}.bind(this);s.setFinallyHandler(q.bind(this));s.setInitialHandler=j;s.setFinallyHandler=j;this._config.setupRequest(s,this);if(this._skip){this._skip=false;setTimeout(q.bind(this),0);}else s.send();return this;};p.prototype.isPolling=function(){"use strict";return this._polling;};p.prototype.isMuted=function(){"use strict";return this._muted;};p.prototype.setInterval=function(s){"use strict";if(s){this._config.interval=s;this.start();}};p.prototype.getInterval=function(){"use strict";return this._config.interval;};p.prototype._cleanup=function(){"use strict";if(this._handle!==null)clearTimeout(this._handle);this._handle=null;this._cancelRequest=j;this._polling=false;};p.prototype._done=function(){"use strict";this._cleanup();this.inform('done',{sender:this});return this;};p.MIN_INTERVAL=2000;Object.assign(p.prototype,{_config:null,_requests:0,_muted:false,_polling:false,_skip:false,_cancelRequest:j});function q(){if(!this._polling)return;if(this._requests<this._config.maxRequests){var s=this._config.interval;s=typeof s==='function'?s(this._requests):s;s=(s>p.MIN_INTERVAL)?s:p.MIN_INTERVAL;if(this._config.clearOnQuicklingEvents){this._handle=setTimeout(this.request.bind(this),s);}else this._handle=l(this.request.bind(this),s);}else this._done();}function r(){return i.isLoggedInNow();}e.exports=p;},null);
__d("LastMobileActiveTimes",["ServerTime","fbt"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();var i={};function j(n){if(!n||n<0)return '';var o=(g.get()/1000)-n,p=Math.floor(o/60),q=Math.floor(p/60),r=Math.floor(q/24);if(p<=1){return h._("{count}m",[h.param("count",1)]);}else if(p<60){return h._("{count}m",[h.param("count",p)]);}else if(q<24){return h._("{count}h",[h.param("count",q)]);}else if(r<3){return h._("{count}d",[h.param("count",r)]);}else return '';}function k(n,o){if(!(n in i)||i[n]<o)i[n]=o;}function l(n){if(n in i){return i[n];}else return 0;}var m={update:function(n){for(var o in n)k(o,n[o]);},getShortDisplay:function(n){return j(l(n));},get:function(n){return l(n);}};e.exports=m;},null);
__d("PresenceStatus",["ArbiterMixin","AvailableListConstants","BanzaiODS","ChatVisibility","CurrentUser","LastMobileActiveTimes","LogHistory","PresencePrivacy","ServerTime","createObjectFrom","debounceAcrossTransitions"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){b.__markCompiled&&b.__markCompiled();i.setEntitySample('presence',.0001);var r=m.getInstance('presence_status'),s={},t={},u={},v={},w={},x={},y={},z=Object.assign({},g),aa=q(function(){return z.inform('change');},0);Object.assign(z,{resetPresenceData:function(){t={};u={};y={};x={};w={};},reset:function(){z.resetPresenceData();v={};},get:function(ba){if(ba==k.getID())return j.isOnline()?h.ACTIVE:h.OFFLINE;var ca=h.OFFLINE;if(ba in t)ca=t[ba];if(ca===h.OFFLINE||ca===h.IDLE)if(v[ba])ca=h.MOBILE;if(!n.allows(ba))ca=h.OFFLINE;return ca;},getCapabilities:function(ba){var ca=z.get(ba);if(ca==h.OFFLINE)return 0;var da=u[ba];return da?da:0;},getDetailedActivePresence:function(ba){var ca=y[ba];if(!ca)return h.ACTIVE_ON_WEB;var da=this._getDetailedActivePresenceFromObject(ca);if(da)return da;if(!s[ba]){r.error('inconsistent_presence',{id:ba,presence:z.getDebugInfo(ba)});i.bumpEntityKey('presence','inconsistent_presence');s[ba]=true;}return null;},_getDetailedActivePresenceFromObject:function(ba){var ca=ba[h.WEB_STATUS],da=ba[h.FB_APP_STATUS],ea=ba[h.MESSENGER_STATUS],fa=ba[h.OTHER_STATUS];if(da===h.STATUS_ACTIVE||ea===h.STATUS_ACTIVE){return h.ACTIVE_ON_MOBILE;}else if(ca===h.STATUS_ACTIVE||fa===h.STATUS_ACTIVE)return h.ACTIVE_ON_WEB;},isMessengerUser:function(ba){var ca=y[ba];if(ca)if(ca[h.MESSENGER_STATUS]==h.STATUS_ACTIVE)return true;return v[ba];},hasDetailedPresenceData:function(ba){return y[ba]!=null;},getGroup:function(ba){return ba.some(function(ca){if(ca==k.getID())return false;return (z.get(ca)===h.ACTIVE);})?h.ACTIVE:h.OFFLINE;},set:function(ba,ca,da,ea,fa,ga){if(ba==k.getID())return false;switch(ca){case h.OFFLINE:case h.IDLE:case h.ACTIVE:case h.MOBILE:break;default:return false;}var ha=z.get(ba),ia=ha!=ca;if((ia&&ha==h.ACTIVE)||(ca==h.ACTIVE)){var ja={};ja[ba]=o.get()/1000;l.update(ja);}var ka=false;if(!ia&&fa)ka=z.getCapabilities(ba)!=fa;if(da){w[ba]=o.get();x[ba]=ea;}t[ba]=ca;if(fa)u[ba]=fa;if(ga)y[ba]=ga;var la=ia||ka;if(la)aa();return la;},setMobileFriends:function(ba){v=p(ba);},getOnlineIDs:function(){var ba,ca=[];for(ba in t)if(z.get(ba)===h.ACTIVE)ca.push(ba);return ca;},getAvailableIDs:function(){var ba=z.getOnlineIDs(),ca;for(ca in v){if(t[ca])continue;ba.push(ca);}return ba;},getOnlineCount:function(){return z.getOnlineIDs().length;},getPresenceStats:function(){var ba=0,ca=0,da=0,ea=0,fa=0;for(var ga in t){ba+=1;switch(z.get(ga)){case h.OFFLINE:ca+=1;break;case h.IDLE:da+=1;break;case h.ACTIVE:ea+=1;break;case h.MOBILE:fa+=1;break;default:break;}}return {total:ba,offline:ca,idle:da,active:ea,mobile:fa};},getDebugInfo:function(ba){return {id:ba,presence:t[ba],detailedPresence:y[ba],overlaySource:x[ba],overlayTime:w[ba],mobile:v[ba]};}});e.exports=z;},null);
__d("ChatImpressionLogger",["AsyncSignal","requireWeak","ChatConfig","ChatVisibility","Poller","PresencePrivacy","PresenceStatus","debounceAcrossTransitions"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){b.__markCompiled&&b.__markCompiled();var o=null;h('AvailableList',function(u){return o=u;});var p=null;function q(){if(!p)return '';return p.getCachedSortedList().toString();}function r(){if(!p||!o)return '';var u=[],v=p.getCachedSortedList();for(var w=0;w<v.length;w++)u[w]=o.get(v[w]);return u.toString();}function s(u){u.setURI('/ajax/chat/imps_logging.php').setData({list_availability:r(),sorted_list:q(),source:'periodical_imps'});}var t={init:function(u){p=u;var v=i.get('chat_impression_logging_periodical',0);if(v){var w=i.get('periodical_impression_logging_config.interval'),x=new k({interval:w,setupRequest:s,clearOnQuicklingEvents:false,dontStart:true});l.subscribe('privacy-user-presence-changed',n(function(){if(j.isOnline()){x.start();}else x.stop();}));}this.init=function(){};},logImpression:function(u,v,w){var x=i.get('chat_impression_logging_with_click'),y={list_availability:x?r():'',sorted_list:x?q():'',source:u,target:v,target_presence:m.get(v),viewport_width:document.body.clientWidth};new g('/ajax/chat/ct.php',Object.assign(y,w)).send();}};e.exports=t;},null);
__d("ChatWelcomeMessage",["ImmutableObject"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();'use strict';function h(){this.$ChatWelcomeMessage0={};}h.prototype.setWelcomeMessage=function(j,k,l){this.$ChatWelcomeMessage0[j]=new g({timestamp:Date.now(),thread_id:j,author:k,body:l});};h.prototype.getWelcomeMessage=function(j){return this.$ChatWelcomeMessage0[j];};var i=new h();e.exports=i;},null);
__d("MercuryIDs",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();var g={isValid:function(h){if(!h||typeof h!=='string')return false;return (/^\w{3,12}:/.test(h));},isValidThreadID:function(h){if(!g.isValid(h))return false;var i=g.tokenize(h);switch(i.type){case 'user':case 'group':case 'thread':case 'root':case 'pending':return true;default:return false;}},tokenize:function(h){if(!this.isValid(h))throw ("bad_id_format "+h);var i=h.indexOf(':');return {type:h.substr(0,i),value:h.substr(i+1)};},getUserIDFromParticipantID:function(h){if(!this.isValid(h))throw ("bad_id_format "+h);var i=g.tokenize(h),j=i.type,k=i.value;if(j!='fbid')return null;return k;},getParticipantIDFromUserID:function(h){if(isNaN(h))throw ("Not a user ID: "+h);return 'fbid:'+h;},getUserIDFromThreadID:function(h){if(!this.isCanonical(h))return null;return this.tokenize(h).value;},getThreadIDFromUserID:function(h){return 'user:'+h;},getThreadIDFromParticipantID:function(h){var i=this.getUserIDFromParticipantID(h);return i?this.getThreadIDFromUserID(i):null;},getParticipantIDFromFromThreadID:function(h){return this.getParticipantIDFromUserID(this.getUserIDFromThreadID(h)||'');},isCanonical:function(h){return this.isValid(h)&&this.tokenize(h).type==='user';},isGroupChat:function(h){return this.isValid(h)&&this.tokenize(h).type!=='user';}};e.exports=g;},null);
__d("MercuryAssert",["MercuryIDs"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();e.exports={isParticipantID:function(h){if(!g.isValid(h))throw ("bad_participant_id "+h);},allParticipantIDs:function(h){h.forEach(this.isParticipantID);},isUserParticipantID:function(h){var i=g.tokenize(h);if(i.type!='fbid')throw ("bad_user_id "+h);},isEmailParticipantID:function(h){var i=g.tokenize(h);if(i.type!='email')throw ("bad_email_id "+h);},allThreadID:function(h){h.forEach(this.isThreadID);},isThreadID:function(h){if(!g.isValid(h))throw ("bad_thread_id "+h);}};},null);
__d("MercuryAttachment",["MercuryAttachmentContentType","MercuryAttachmentType","MercuryAudioType"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();'use strict';var j={getAttachIconClass:function(k){switch(k){case g.PHOTO:return 'MercuryPhotoIcon';case g.VIDEO:return 'MercuryVideoIcon';case g.MUSIC:return 'MercuryMusicIcon';case g.VOICE:return 'MercuryVoiceIcon';case g.TEXT:return 'MercuryTextIcon';case g.MSWORD:return 'MercuryMSWordIcon';case g.MSXLS:return 'MercuryMSXLSIcon';case g.MSPPT:return 'MercuryMSPPTIcon';}return 'MercuryDefaultIcon';},getAttachIconClassByMime:function(k){if(k.startsWith('image')){return 'MercuryPhotoIcon';}else if(k.startsWith('video')){return 'MercuryVideoIcon';}else if(k.startsWith('audio')){return 'MercuryMusicIcon';}else if(k.startsWith('text/plain')){return 'MercuryTextIcon';}else return 'MercuryDefaultIcon';},getAttachTypeByMime:function(k){if(k.startsWith('image')){return g.PHOTO;}else if(k.startsWith('video')){return g.VIDEO;}else if(k.startsWith('audio')){return g.MUSIC;}else if(k.startsWith('text/plain')){return g.TEXT;}else return g.UNKNOWN;},convertRaw:function(k){var l=[];for(var m=0;m<k.length;m++){var n=k[m];if(n.attach_type===h.PHOTO){l.push(n);}else if(n.filename){var o=j.getAttachTypeByMime(n.filetype),p={};p.attach_type=h.FILE;p.name=n.filename;p.icon_type=o;p.url='';l.push(p);}}return l;},get:function(k){var l=[];if(k.attachments){l=k.attachments;}else if(k.raw_attachments)l=this.convertRaw(k.raw_attachments);if(!(k.attachments&&k.attachments.length>0)){if(k.sticker_id)return l.concat([{attach_type:h.STICKER}]);if(k.preview_attachments&&k.preview_attachments.length>0)return l.concat(k.preview_attachments);}return l;},resizeContain:function(k,l){var m=k.width/k.height,n=l.width/l.height;if(n<m){return {width:Math.ceil(Math.min(k.height*n,l.width)),height:Math.ceil(Math.min(k.height,l.height))};}else return {width:Math.ceil(Math.min(k.width,l.width)),height:Math.ceil(Math.min(k.width/n,l.height))};},isBubblePreferred:function(k){return !(this.isPhotoAttachment(k)||this.isStickerAttachment(k)||this.isVideoAttachment(k)||this.isVoiceAttachment(k));},isPhotoAttachment:function(k){return !!(k.attach_type==h.PHOTO||k.attach_type==h.ANIMATED_IMAGE||(k.attach_type==h.FILE&&k.preview_url));},isVideoAttachment:function(k){return k.attach_type==h.VIDEO;},isShareAttachment:function(k){return k.attach_type==h.SHARE;},isFileAttachment:function(k){return k.attach_type==h.FILE;},isErrorAttachment:function(k){return k.attach_type==h.ERROR;},isStickerAttachment:function(k){return k.attach_type==h.STICKER;},isVoiceAttachment:function(k){if(!k.metadata)return false;return (k.metadata.type===i.AudioClip||k.metadata.type===i.VoiceMessageWithTranscript);},hasAttribution:function(k){return !!k.app_attribution;}};e.exports=j;},null);
__d("MercurySingletonMixin",["CurrentUser"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();var h={_getInstances:function(){if(!this._instances)this._instances={};return this._instances;},get:function(){return this.getForFBID(g.getID());},getForFBID:function(i){var j=this._getInstances();if(!j[i])j[i]=new this(i);return j[i];}};e.exports=h;},null);
__d("MercuryMessageClientState",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();var g={DO_NOT_SEND_TO_SERVER:'do_not_send_to_server',SEND_TO_SERVER:'send_to_server'};e.exports=g;},null);
__d("MercurySendErrorLogger",["Banzai","BanzaiLogger"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();var i=h.create({retry:true}),j=g.isEnabled('mercury_send_error_logging'),k={log:function(l){if(!j)return;var m={message_id:l.message_id,timestamp_client:Date.now(),error_type:l.error_data.type,error_code:l.error_data.code,error_description:l.error_data.description,is_transient:l.error_data.is_transient};i.log('MercurySendErrorLoggerConfig',m);}};e.exports=k;},null);
__d("MercuryServerPayloadPreprocessor",["CurrentEnvironment","MercuryIDs","MercuryActionStatus","MercuryActionType","MercuryAttachment","MercuryDispatcher","MercurySendErrorLogger","MercurySingletonMixin","MercuryThreadIDMap","invariant","URI"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){b.__markCompiled&&b.__markCompiled();'use strict';function r(s){this.$MercuryServerPayloadPreprocessor0=s;this.$MercuryServerPayloadPreprocessor1=o.getForFBID(this.$MercuryServerPayloadPreprocessor0);this.$MercuryServerPayloadPreprocessor2=l.getForFBID(this.$MercuryServerPayloadPreprocessor0);}r.prototype.handleUpdate=function(s){var t,u,v,w={};p(!s.from_client);(s.threads||[]).forEach(function(ka){this.$MercuryServerPayloadPreprocessor3(ka,w);var la=this.$MercuryServerPayloadPreprocessor1.getFBIDFromClientIDNow(ka.thread_id);d(['MercuryServerRequests'],function(ma){var na=ma.getForFBID(this.$MercuryServerPayloadPreprocessor0);na.markThreadFetched(ka.thread_id);na.markThreadFetched(la);na.updateLastActionTimestamp(ka.timestamp);}.bind(this));}.bind(this));(s.ordered_threadlists||[]).forEach(function(ka){var la=ka.thread_fbids||[];la=la.concat(ka.other_user_fbids||[]);ka.thread_ids=la.map(function(ma){return this.$MercuryServerPayloadPreprocessor1.getClientIDFromFBIDNow(ma);}.bind(this));}.bind(this));if(s.pinned_threads&&s.pinned_threads.thread_fbids)s.pinned_threads.thread_fbids=s.pinned_threads.thread_fbids.map(function(ka){return this.$MercuryServerPayloadPreprocessor1.getClientIDFromFBIDNow(ka);}.bind(this));if(s.delivery_receipts){var x={},y;for(t=s.delivery_receipts,u=Array.isArray(t),v=0,t=u?t:t[typeof Symbol=="function"?Symbol.iterator:"@@iterator"]();;){if(u){if(v>=t.length)break;y=t[v++];}else{v=t.next();if(v.done)break;y=v.value;}var z=y.other_user_fbid?h.getThreadIDFromUserID(y.other_user_fbid):this.$MercuryServerPayloadPreprocessor1.getClientIDFromFBIDNow(y.thread_fbid);x[z]=y.time;}s.delivery_receipts=x;}s.actions=s.actions||[];s.actions.forEach(function(ka){if(ka.action_type===j.SEND_MESSAGE&&ka.status===i.ERROR)m.log(ka);var la=ka.thread_fbid;if(ka.other_user_fbid)la=ka.other_user_fbid;if(ka.status&&ka.status!=i.SUCCESS&&!la){ka.thread_id=ka.client_thread_id;return;}if(ka.action_type==j.SEND_MESSAGE&&ka.client_thread_id&&la){var ma=la.toString(),na=ka.client_thread_id;this.$MercuryServerPayloadPreprocessor1.setClientIDToFBID(na,ma);w[ma]=na;}var oa=ka.thread_id;if(la){ka.thread_id=this.$MercuryServerPayloadPreprocessor1.hasClientIDForFBID(la)?this.$MercuryServerPayloadPreprocessor1.getClientIDFromFBIDNow(la):null;}else if(ka.client_thread_id)ka.thread_id=ka.client_thread_id;if(!ka.thread_id)ka.server_thread_id=oa;if(!s.payload_source||!s.payload_source.startsWith('server'))d(['MercuryServerRequests'],function(pa){pa.getForFBID(this.$MercuryServerPayloadPreprocessor0).updateLastActionTimestamp(ka.timestamp);}.bind(this));}.bind(this));this.$MercuryServerPayloadPreprocessor4(s);if(s.end_of_history){var aa=[];for(var ba=0;ba<s.end_of_history.length;ba++){var ca=s.end_of_history[ba];if(ca.type=='user'){aa.push('user:'+ca.fbid);}else if(ca.type=='thread'&&this.$MercuryServerPayloadPreprocessor1.hasClientIDForFBID(ca.fbid))aa.push(this.$MercuryServerPayloadPreprocessor1.getClientIDFromFBIDNow(ca.fbid));}s.end_of_history=aa;}if(s.roger){var da={};for(var ea in s.roger){var fa=Object.keys(s.roger[ea]),ga;if(ea){ga=this.$MercuryServerPayloadPreprocessor1.getClientIDFromFBIDNow(ea);}else if(fa.length===1)ga=h.getThreadIDFromUserID(fa[0]);if(ga){var ha=s.roger[ea];da[ga]={};for(var ia in ha)if(ha.hasOwnProperty(ia)){var ja=h.getParticipantIDFromUserID(ia);da[ga][ja]=ha[ia];}}}s.roger=da;}s.newlyAddedClientIDs=w;s.preprocessed=true;this.$MercuryServerPayloadPreprocessor2.handleUpdate(s);};r.prototype.$MercuryServerPayloadPreprocessor3=function(s,t){var u=s.thread_fbid;if(s.canonical_fbid)u=s.canonical_fbid;var v=this.$MercuryServerPayloadPreprocessor1.getClientIDFromFBIDNow(u);if(!v){if(s.canonical_fbid){v='user:'+s.canonical_fbid;}else if(s.root_message_threading_id)v='root:'+s.root_message_threading_id;v=v||'thread:'+u;if(u)u=u.toString();this.$MercuryServerPayloadPreprocessor1.setClientIDToFBID(v,u);t[u]=v;if(s.thread_id){this.$MercuryServerPayloadPreprocessor1.setServerToClientID(s.thread_id,v);t[s.thread_id]=v;}}s.thread_id=v;};r.prototype.$MercuryServerPayloadPreprocessor4=function(s){s.actions.forEach(function(t){if(t.action_type===j.USER_GENERATED_MESSAGE){t.attachments=t.attachments||[];t.attachments.forEach(function(u){if(k.isShareAttachment(u)&&g.messengerdotcom){var v=new q(u.share.uri);if(!v.getDomain())u.share.uri=v.setDomain('facebook.com').setSubdomain(q.getRequestURI().getSubdomain()).setProtocol('https').toString();}});}});};Object.assign(r,n);e.exports=r;},null);
__d("MercuryServerSendMessageQueueSimulatedError",["AsyncRequest","AsyncResponse"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();var i=9999,j={create:function(k){var l=new g(this.endpoint_uri).setData({message_batch:[k],client:this.client}),m=new h(l,{});Object.assign(m,{error:i,silentError:false,transientError:true,request:l});return m;}};e.exports=j;},null);
__d("MercuryServerSendMessageQueue",["BanzaiODS","LogHistory","MercuryLoggingHelper","MercuryServerRequestsConfig","MercuryServerDispatcher","MercuryServerSendMessageQueueSimulatedError"],function(a,b,c,d,e,f,g,h,i,j,k,l){b.__markCompiled&&b.__markCompiled();var m='/ajax/mercury/send_messages.php',n=h.getInstance('mercury_server_send_message_queue');function o(p,q,r,s){"use strict";this.sender_id=p;this.queue_id=q;this.$MercuryServerSendMessageQueue0=r.success_handler;this.$MercuryServerSendMessageQueue1=r.error_handler;this.$MercuryServerSendMessageQueue2=r.transport_error_handler;this.$MercuryServerSendMessageQueue3=r.timeout_handler;this.client=s;var t=null;if(j.msgrRegion)t={name:'X-MSGR-Region',value:j.msgrRegion};var u={};u[m]={request_user_id:this.sender_id,endpoint_id:this.queue_id,mode:k.IMMEDIATE,customHeader:t,handler:this.handleSuccess.bind(this),error_handler:this.handleError.bind(this),transport_error_handler:this.handleTransportError.bind(this),timeout:r.timeout,timeout_handler:this.handleTimeout.bind(this),connection_retries:r.connection_retries};k.registerEndpoints(u);this.pending_message=null;this.queue=[];}o.prototype.enqueue=function(p){"use strict";this.queue.push(p);this.$MercuryServerSendMessageQueue5();};o.prototype.$MercuryServerSendMessageQueue5=function(){"use strict";if(this.pending_message||!this.queue.length){if(this.pending_message)this.$MercuryServerSendMessageQueue6();return;}this.pending_message=this.queue.shift();k.trySend(m,{message_batch:[this.pending_message],client:this.client},null,this.sender_id,this.queue_id);};o.prototype.$MercuryServerSendMessageQueue7=function(){"use strict";while(this.queue.length)this.$MercuryServerSendMessageQueue8(this.queue.shift());};o.prototype.$MercuryServerSendMessageQueue8=function(p){"use strict";this.$MercuryServerSendMessageQueue1(l.create(p));n.error('mark_as_failed',{fbid:this.sender_id,queue_id:this.queue_id,message:i.obfuscateMessage(p)});};o.prototype.handleSuccess=function(p,q){"use strict";this.$MercuryServerSendMessageQueue0(p,q);this.pending_message=null;this.$MercuryServerSendMessageQueue5();};o.prototype.handleError=function(p){"use strict";this.$MercuryServerSendMessageQueue1(p);this.$MercuryServerSendMessageQueue7();this.pending_message=null;};o.prototype.handleTransportError=function(p){"use strict";this.$MercuryServerSendMessageQueue2(p);this.$MercuryServerSendMessageQueue7();this.pending_message=null;};o.prototype.handleTimeout=function(p){"use strict";this.$MercuryServerSendMessageQueue3(p);this.$MercuryServerSendMessageQueue7();this.pending_message=null;};o.prototype.$MercuryServerSendMessageQueue6=function(){"use strict";n.debug('maybe_send_next_pending_message',{fbid:this.sender_id,queue_id:this.queue_id,pending_message:i.obfuscateMessage(this.pending_message),queue:this.queue.map(function(q){return i.obfuscateMessage(q);})});var p='send_queue.delayed.queue_length.'+this.queue.length.toString();g.bumpEntityKey('chat.web',p);};e.exports=o;},null);
__d("MercuryServerSendMessageQueueRouter",["BanzaiODS","LogHistory","Map","MercuryServerSendMessageQueue","MercurySingletonMixin"],function(a,b,c,d,e,f,g,h,i,j,k){b.__markCompiled&&b.__markCompiled();var l=h.getInstance('mercury_server_send_message_queue_router'),m='chat.web.send_queue_router';g.setEntitySample(m,.1);function n(o){"use strict";this.fbid=o;this.queues=new i();}n.prototype.enqueue=function(o,p,q,r){"use strict";if(!this.queues.has(o)){this.queues.set(o,new j(this.fbid,o,p,q));l.debug('added queue',{fbid:this.fbid,queue_id:o});g.bumpEntityKey(m,'new_queue');}this.queues.get(o).enqueue(r);};Object.assign(n,k);e.exports=n;},null);
__d("FBID",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();'use strict';var g={isUser:function(h){return h<2.2e+09||(h>=1e+14&&h<=100099999989999)||(h>=8.9e+13&&h<=89999999999999)||(h>=6.000001e+13&&h<=60000019999999);}};e.exports=g;},null);
__d("PagesMessengerThreadUtils",["PageMessageEnumTag"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();var h={isFlagThread:function(i){if(!i)return false;return i.page_thread_info?i.page_thread_info.flagged:false;},isPageSpecficFilter:function(i){if(i===g.FLAG)return true;return false;}};e.exports=h;},null);
__d("MercuryPageServerRequests",["MercuryAPIArgsSource","MercuryAssert","MercuryServerRequests","PageMessageEnumTag","PagesMessengerThreadUtils","MercuryServerDispatcher"],function(a,b,c,d,e,f,g,h,i,j,k,l){b.__markCompiled&&b.__markCompiled();var m=g.MERCURY;for(var n in i)if(i.hasOwnProperty(n))p[n]=i[n];var o=i===null?null:i.prototype;p.prototype=Object.create(o);p.prototype.constructor=p;p.__superConstructor__=i;function p(q){"use strict";i.call(this,q);var r={'/pages/messaging/thread_tag/add/':{request_user_id:q,mode:l.BATCH_SUCCESSIVE,batch_function:this.$MercuryPageServerRequests0,handler:function(s,t){return this.__handleUpdate(s,t);}.bind(this)},'/pages/messaging/thread_tag/remove/':{request_user_id:q,mode:l.BATCH_SUCCESSIVE,batch_function:this.$MercuryPageServerRequests0,handler:function(s,t){return this.__handleUpdate(s,t);}.bind(this)},'/pages/messaging/thread_tag/list/':{request_user_id:q,mode:l.IMMEDIATE,handler:function(s,t){return this.__handleUpdate(s,t);}.bind(this)},'/pages/messaging/create_note/':{request_user_id:q,mode:l.IMMEDIATE,handler:function(s,t){return this.__handleUpdate(s,t);}.bind(this)}};l.registerEndpoints(r);}p.prototype.$MercuryPageServerRequests0=function(q,r){"use strict";var s=q?q.tag_name:r.tag_name,t=q?q.thread_ids:[],u=r?r.thread_ids:[],v=t.concat(u),w={tag_name:s,thread_ids:v};return w;};p.prototype.addThreadFlag=function(q,r){"use strict";h.isThreadID(q);this.__threadIDMap.getFBIDFromClientID(q,function(s){var t={thread_ids:[s],tag_name:j.FLAG};this.__sendRequest('/pages/messaging/thread_tag/add/',t);}.bind(this));};p.prototype.createNote=function(q,r,s){"use strict";this.__sendRequest('/pages/messaging/create_note/',{body:q,thread_id:r,message_id:s});};p.prototype.fetchThreadlistInfo=function(q,r,s,t,u){"use strict";if(k.isPageSpecficFilter(t)){u=u||m;var v={folder:s,tag_name:t,offset:q,limit:r};this.__sendRequest('/pages/messaging/thread_tag/list/',v);return;}o.fetchThreadlistInfo.call(this,q,r,s,t,u);};p.prototype.removeThreadFlag=function(q,r){"use strict";h.isThreadID(q);this.__threadIDMap.getFBIDFromClientID(q,function(s){var t={thread_ids:[s],tag_name:j.FLAG};this.__sendRequest('/pages/messaging/thread_tag/remove/',t);}.bind(this));};p.prototype.toString=function(){"use strict";return 'MercuryPageServerRequests';};e.exports=p;},null);
__d("MercuryServerRequestSingletonMixin",["CurrentUser","FBID"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();var i={_getInstances:function(){if(!this._instances)this._instances={};return this._instances;},get:function(){return this.getForFBID(g.getID());},getForFBID:function(j){var k=this._getInstances();if(!k[j])if(h.isUser(j)){k[j]=new this(j);}else{var l;d(['MercuryPageServerRequests'],function(m){l=new m(j);});k[j]=l;}return k[j];}};e.exports=i;},null);
__d("MercuryMessageIDs",["KeyedCallbackManager"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();var h=new g(),i={getServerIDs:function(j,k){var l=j.filter(function(n){return n.indexOf('id')===-1;}),m=function(n){var o=j.map(function(p){return n[p]?n[p]:p;});k(o);};return h.executeOrEnqueue(l,m);},addServerID:function(j,k){h.setResource(j,k);}};e.exports=i;},null);
__d("MercuryServerSendMessageQueueOptions",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();function g(h,i,j,k,l,m){"use strict";this.success_handler=h;this.error_handler=i;this.transport_error_handler=j;this.timeout_handler=k;this.timeout=l;this.connection_retries=m;}e.exports=g;},null);
__d("XMessengerNotificationsSettingsDialogController",["XController"],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports=b("XController").create("\/notifications\/settings\/dialog\/",{thread_key_id:{type:"String",required:true},modify:{type:"Bool",defaultValue:false},__asyncDialog:{type:"Int"}});},null);
__d("MercuryServerRequests",["Arbiter","AsyncResponse","ChannelConstants","CurrentUser","LogHistory","MercuryActionStatus","MercuryActionType","MercuryAPIArgsSource","MercuryAssert","MercuryDispatcher","MercuryThreadIDMap","MercuryErrorType","MercuryGlobalActionType","MercuryIDs","MercuryLogMessageType","MercuryMessageClientState","MercuryPayloadSource","MercurySendErrorLogger","MercuryServerPayloadPreprocessor","MercuryServerRequestsConfig","MercuryServerSendMessageQueueRouter","MercuryServerRequestSingletonMixin","MercurySourceType","MercuryThreadlistConstants","MercuryMessageIDs","MessagingConfig","MessagingTag","MercuryServerDispatcher","MercuryServerSendMessageQueueOptions","AsyncRequest","XMessengerNotificationsSettingsDialogController","createObjectFrom","errorCode","setTimeoutAcrossTransitions"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la,ma,na){b.__markCompiled&&b.__markCompiled();'use strict';var oa=k.getInstance('mercury_server'),pa=n.MERCURY;function qa(cb){return cb.thread_fbid||cb.thread_id||cb.client_thread_id;}function ra(cb){return cb.getError()?'_'+cb.getError():'';}function sa(cb,db){var eb=Object.assign({},cb),fb;if(db.threads){if(!eb.threads)eb.threads={};for(fb in db.threads)eb.threads[fb]=Object.keys(la((eb.threads[fb]||[]).concat(db.threads[fb])));}if(db.messages){if(!eb.messages)eb.messages={};for(fb in db.messages){if(!eb.messages[fb])eb.messages[fb]={};for(var gb in db.messages[fb])if(eb.messages[fb][gb]){eb.messages[fb][gb]=xa(eb.messages[fb][gb],db.messages[fb][gb]);}else eb.messages[fb][gb]=db.messages[fb][gb];}}eb.client=cb.client||db.client;return eb;}function ta(cb,db){var eb=Object.assign(la(cb.folders,true),la(db.folders,true)),fb=cb.client||db.client;return {folders:Object.keys(eb),client:fb};}function ua(cb,db){for(var eb in db)if(cb[eb]&&typeof cb[eb]==='object'){cb[eb]=xa(cb[eb],db[eb]);}else if(db[eb]&&typeof db[eb]==='object'){var fb={};Object.assign(fb,db[eb]);cb[eb]=fb;}return cb;}function va(cb,db){var eb=Object.assign({},cb.ids,db.ids),fb=cb.client||db.client;return {ids:eb,client:fb};}function wa(cb,db){return db;}function xa(cb,db){var eb=cb.offset<db.offset?cb.offset:db.offset,fb=cb.offset+cb.limit,gb=db.offset+db.limit,hb=(fb>gb)?fb:gb,ib=hb-eb,jb=cb.timestamp>db.timestamp?cb.timestamp:db.timestamp;return {offset:eb,limit:ib,timestamp:jb};}function ya(cb,db){var eb=cb.client||db.client,fb={ids:{},client:eb};Object.assign(fb.ids,cb.ids,db.ids);return fb;}function za(cb,db){var eb={},fb,gb=cb.client||db.client;delete cb.client;delete db.client;for(fb in cb)Object.assign(eb,la(cb[fb],fb));for(fb in db)Object.assign(eb,la(db[fb],fb));var hb={client:gb};for(var ib in eb){fb=eb[ib];if(!hb[fb])hb[fb]=[];hb[fb].push(ib);}return hb;}function ab(cb,db){var eb=cb.client||db.client,fb=la(cb.ids,true),gb=la(db.ids,true),hb=Object.assign(fb,gb);return {ids:Object.keys(hb),client:eb};}function bb(cb){this._fbid=cb;this._lastActionTimestamp=0;this._fetchingThreads={};this._sentMessagesTimestamp={};this.__threadIDMap=q.getForFBID(this._fbid);this._dispatcher=p.getForFBID(this._fbid);this._payloadPreprocessor=y.getForFBID(this._fbid);this._sendMessageQueueOptions=new ia(function(db,eb){return this.__handleUpdate(db,eb);}.bind(this),function(db){return this._handleSendMessageError(db);}.bind(this),function(db){return this._handleSendMessageTransportError(db);}.bind(this),function(db){return this._handleSendMessageTimeout(db);}.bind(this),z.sendMessageTimeout,fa.SEND_CONNECTION_RETRIES);this._registerEndpoints();}Object.assign(bb.prototype,{fetchThreadlistInfo:function(cb,db,eb,fb,gb){eb=eb||ga.INBOX;gb=gb||pa;var hb=fb?ha.IMMEDIATE:null,ib={client:gb};ib[eb]={offset:cb,limit:db,filter:fb};this.__sendRequest('/ajax/mercury/threadlist_info.php',ib,hb);},fetchPinnedThreads:function(){this.__sendRequest('/mercury/pinned_threads/',{});},fetchUnseenThreadIDs:function(cb,db){db=db||pa;this.fetchThreadlistInfo(da.RECENT_THREAD_OFFSET,da.JEWEL_THREAD_COUNT,cb,null,db);},fetchUnreadThreadIDs:function(cb,db){db=db||pa;this.__sendRequest('/ajax/mercury/unread_threads.php',{folders:[cb],client:db});},fetchMissedMessages:function(cb,db){db=db||pa;var eb={last_action_timestamp:this._lastActionTimestamp,folders:cb,client:db};eb.last_action_timestamp=this._lastActionTimestamp;this.__sendRequest('/ajax/mercury/thread_sync.php',eb);},fetchThreadData:function(cb,db){db=db||pa;o.allThreadID(cb);var eb={threads:{},client:db},fb=[],gb=[];cb.forEach(function(ib){if(this._fetchingThreads[ib])return;this._fetchingThreads[ib]=true;var jb=this.__threadIDMap.getFBIDFromClientIDNow(ib),kb=t.tokenize(ib);if(kb.type=='user'){fb.push(kb.value);eb.threads.user_ids=fb;}else if(kb.type=='thread'){if(jb){gb.push(jb);}else gb.push(kb.value);eb.threads.thread_fbids=gb;}else if(kb.type=='root'){if(jb){gb.push(jb);eb.threads.thread_fbids=gb;}}else if(kb.type!='pending')throw new Error('Unknown thread type',kb);}.bind(this));this._dispatcher.inform("fetch-thread-data",eb);for(var hb in eb.threads){this.__sendRequest('/ajax/mercury/thread_info.php',eb);break;}},ensureThreadIsFetched:function(cb,db){db=db||pa;if(!this.__threadIDMap.getClientIDFromFBIDNow(cb)&&!this._fetchingThreads[cb]){this._fetchingThreads[cb]=true;this.__sendRequest('/ajax/mercury/thread_info.php',{threads:{thread_fbids:[cb]},client:db});}},fetchThreadMessages:function(cb,db,eb,fb,gb,hb){o.isThreadID(cb);hb=hb||pa;var ib,jb,kb=t.tokenize(cb),lb=this.__threadIDMap.getFBIDFromClientIDNow(cb),mb=false;if(lb){ib=lb;jb=(kb.type=='user')?'user_ids':'thread_fbids';}else{ib=kb.value;switch(kb.type){case 'user':jb='user_ids';mb=true;break;case 'thread':jb='thread_fbids';break;}}var nb={messages:{},threads:{},client:hb};if(jb){nb.messages[jb]={};nb.messages[jb][ib]={offset:db,timestamp:fb,limit:eb};if(mb)nb.threads[jb]=[ib];this.__sendRequest('/ajax/mercury/thread_info.php',nb,gb);}else this.__threadIDMap.getFBIDFromClientID(cb,function(ob){nb.messages.thread_fbids={};nb.messages.thread_fbids[ob]={offset:db,timestamp:fb,limit:eb};this.__sendRequest('/ajax/mercury/thread_info.php',nb,gb);}.bind(this));},handleThreadInfoError:function(cb){var db=cb.getRequest().getData(),eb=[];if(db.messages){for(var fb in db.messages.thread_fbids)eb.push(this._createServerErrorLogMessage(this.__threadIDMap.getClientIDFromFBIDNow(fb)));for(var gb in db.messages.user_ids)eb.push(this._createServerErrorLogMessage('user:'+gb));for(var hb in db.messages.group_ids)eb.push(this._createServerErrorLogMessage('group:'+hb));}if(eb.length)this._dispatcher.handleUpdate({actions:eb,from_client:true,payload_source:w.CLIENT_CHANNEL_MESSAGE});if(db.threads&&(db.threads.user_ids||db.threads.group_ids||db.threads.thread_ids)){var ib=5,jb=true;if(!db.retry_count){db.retry_count=0;if(db.messages)delete db.messages;}else if(db.retry_count>=ib){jb=false;(db.threads.thread_ids||[]).forEach(function(lb){if(lb in this._fetchingThreads)delete this._fetchingThreads[lb];}.bind(this));}if(jb){var kb=Math.pow(2,db.retry_count)*1000;na(function(){oa.log('retry_thread',db);this.__sendRequest('/ajax/mercury/thread_info.php',db);}.bind(this),kb);db.retry_count++;}}},markFolderAsRead:function(cb){this.__sendRequest('/ajax/mercury/mark_folder_as_read.php',{folder:cb});var db=[{action_type:s.MARK_ALL_READ,action_id:null,folder:cb}];this._dispatcher.handleUpdate({global_actions:db,from_client:true,payload_source:w.CLIENT_CHANGE_READ_STATUS});},changeThreadReadStatus:function(cb,db,eb,fb){o.isThreadID(cb);this.__threadIDMap.getFBIDFromClientID(cb,function(gb){var hb,ib={ids:(hb={},hb[gb]=db,hb),source:eb,watermarkTimestamp:fb};this.__sendRequest('/ajax/mercury/change_read_status.php',ib);}.bind(this));},changeThreadArchivedStatus:function(cb,db,eb){o.isThreadID(cb);this.__threadIDMap.getFBIDFromClientID(cb,function(fb){var gb={ids:{},source:eb};gb.ids[fb]=db;this.__sendRequest('/ajax/mercury/change_archived_status.php',gb);}.bind(this));},changeThreadFolder:function(cb,db){o.isThreadID(cb);this.__threadIDMap.getFBIDFromClientID(cb,function(eb){var fb={};fb[db]=[eb];this.__sendRequest('/ajax/mercury/move_thread.php',fb);}.bind(this));},openNotificationSettings:function(cb){o.isThreadID(cb);this.__threadIDMap.getFBIDFromClientID(cb,function(db){var eb=ka.getURIBuilder().setString('thread_key_id',db).setBool('modify',false).getURI();new ja().setURI(eb).send();});},changeMutingOnThread:function(cb,db){o.isThreadID(cb);this.__threadIDMap.getFBIDFromClientID(cb,function(eb){this.__sendRequest('/ajax/mercury/change_mute_thread.php',{thread_fbid:eb,mute_settings:db,payload_source:pa});}.bind(this));},markThreadSpam:function(cb,db){o.isThreadID(cb);this.__threadIDMap.getFBIDFromClientID(cb,function(eb){this.__sendRequest('/ajax/mercury/mark_spam.php',{id:eb,source:db});}.bind(this));},unmarkThreadSpam:function(cb,db){o.isThreadID(cb);this.__threadIDMap.getFBIDFromClientID(cb,function(eb){this.__sendRequest('/ajax/mercury/unmark_spam.php',{id:eb,source:db});}.bind(this));},deleteThread:function(cb,db){o.isThreadID(cb);this.__threadIDMap.getFBIDFromClientID(cb,function(eb){var fb={ids:[eb],source:db};this.__sendRequest('/ajax/mercury/delete_thread.php',fb);}.bind(this));},unpinThread:function(cb){o.isThreadID(cb);this.__threadIDMap.getFBIDFromClientID(cb,function(db){this.__sendRequest('/mercury/unpin_thread/',{id:db});}.bind(this));},deleteMessages:function(cb,db){ea.getServerIDs(db||[],function(eb){this.__sendRequest('/ajax/mercury/delete_messages.php',{message_ids:eb});}.bind(this));},sendDeliveryReceipts:function(cb){ea.getServerIDs(cb||[],function(db){this.__sendRequest('/ajax/mercury/delivery_receipts.php',{message_ids:db});}.bind(this));},sendNewMessage:function(cb,db){db=db||pa;if(!cb.client_state||cb.client_state==v.SEND_TO_SERVER){var eb=t.tokenize(cb.thread_id),fb=eb.type,gb=Object.assign({},cb);if((fb=='root'&&eb.value==gb.threading_id)||(fb=='user')){gb.client_thread_id=gb.thread_id;gb.thread_id=null;this._sendNewMessageToServer(gb,db);}else this.__threadIDMap.getFBIDFromClientID(gb.thread_id,function(hb){eb=t.tokenize(gb.thread_id);if(eb.type=='user'){gb.other_user_fbid=eb.values;}else gb.thread_fbid=hb;gb.thread_id=null;this._sendNewMessageToServer(gb);}.bind(this));}},_sendNewMessageToServer:function(cb,db){g.inform(i.ATTEMPT_RECONNECT);db=db||pa;this._sentMessagesTimestamp[cb.message_id]=Date.now();aa.getForFBID(this._fbid).enqueue(qa(cb),this._sendMessageQueueOptions,db,cb);},markSeen:function(){var cb=this._lastActionTimestamp;this.__sendRequest('/ajax/mercury/mark_seen.php',{seen_timestamp:cb});},_handleSendMessageErrorCommon:function(cb,db,eb,fb){oa.debug('handle_send_message_error_common',{reliability_error_status:eb,request_error_status:db});var gb=cb.getData(),hb=gb.message_batch,ib=hb.map(function(kb){var lb={action_type:m.SEND_MESSAGE,thread_fbid:kb.thread_fbid,client_message_id:kb.message_id,message_id:kb.message_id,client_thread_id:kb.client_thread_id,status:db,error_data:fb};return lb;});ib.forEach(function(kb){if(kb.action_type===m.SEND_MESSAGE&&kb.status===l.ERROR)x.log(kb);},this);var jb={actions:ib,payload_source:w.CLIENT_HANDLE_ERROR};this._payloadPreprocessor.handleUpdate(jb);},handleSendMessageError:function(cb){var db=cb.getPayload(),eb=null,fb=null;if(db&&db.error_payload){eb=l.UNCONFIRMED;fb='send_error';}else{eb=l.ERROR;fb='request_error'+ra(cb);}var gb=cb.error;if(gb===1404102)h.verboseErrorHandler(cb);var hb=/<.*>/.test(cb.getErrorDescription())?cb.getErrorSummary():cb.getErrorDescription();this._handleSendMessageErrorCommon(cb.getRequest(),eb,fb,{type:r.SERVER,code:cb.getError(),description:hb,is_transient:cb.isTransient()});},handleSendMessageTransportError:function(cb){this._handleSendMessageErrorCommon(cb.getRequest(),l.ERROR,'transport_error'+ra(cb),{type:r.TRANSPORT,code:cb.getError(),is_transient:true});},handleSendMessageTimeout:function(cb){this._handleSendMessageErrorCommon(cb,l.ERROR,'transport_timeout',{type:r.TIMEOUT,is_transient:true});},getLastActionTimestamp:function(){return this._lastActionTimestamp;},updateLastActionTimestamp:function(cb){if(cb)this._lastActionTimestamp=Math.max(this._lastActionTimestamp,cb);},markThreadFetched:function(cb){delete this._fetchingThreads[cb];},_createServerErrorLogMessage:function(cb){return {action_type:m.LOG_MESSAGE,thread_id:cb,message_id:cb,timestamp:Date.now(),timestamp_absolute:'',timestamp_relative:'',is_unread:false,source:ca.UNKNOWN,log_message_type:u.SERVER_ERROR,log_message_data:{}};},_getForAsyncRequest:function(cb){var db=cb.getData(),eb=db.request_user_id?db.request_user_id:j.getID();return bb.getForFBID(eb);},__handleUpdate:function(cb,db){this._getForAsyncRequest(db)._payloadPreprocessor.handleUpdate(cb);},_handleThreadInfoError:function(cb){var db=this._getForAsyncRequest(cb.getRequest());db.handleThreadInfoError(cb);},_handleSendMessageError:function(cb){var db=this._getForAsyncRequest(cb.getRequest());db.handleSendMessageError(cb);},_handleSendMessageTransportError:function(cb){var db=this._getForAsyncRequest(cb.getRequest());db.handleSendMessageTransportError(cb);},_handleSendMessageTimeout:function(cb){var db=this._getForAsyncRequest(cb);db.handleSendMessageTimeout(cb);},_registerEndpoints:function(){var cb=null;if(z.msgrRegion)cb={name:'X-MSGR-Region',value:z.msgrRegion};var db={'/ajax/mercury/thread_sync.php':{request_user_id:this._fbid,mode:ha.IDEMPOTENT,customHeader:cb,handler:function(eb,fb){return this.__handleUpdate(eb,fb);}.bind(this)},'/ajax/mercury/thread_info.php':{request_user_id:this._fbid,mode:ha.BATCH_DEFERRED_MULTI,customHeader:cb,batch_function:sa,handler:function(eb,fb){return this.__handleUpdate(eb,fb);}.bind(this),error_handler:function(eb){return this._handleThreadInfoError(eb);}.bind(this)},'/ajax/mercury/mark_folder_as_read.php':{request_user_id:this._fbid,mode:ha.IMMEDIATE,customHeader:cb,handler:function(eb,fb){return this.__handleUpdate(eb,fb);}.bind(this)},'/ajax/mercury/change_read_status.php':{request_user_id:this._fbid,mode:ha.BATCH_SUCCESSIVE,customHeader:cb,batch_function:va,handler:function(eb,fb){return this.__handleUpdate(eb,fb);}.bind(this)},'/ajax/mercury/mark_seen.php':{request_user_id:this._fbid,mode:ha.BATCH_SUCCESSIVE,customHeader:cb,batch_function:wa,handler:function(eb,fb){return this.__handleUpdate(eb,fb);}.bind(this)},'/ajax/mercury/threadlist_info.php':{request_user_id:this._fbid,mode:ha.BATCH_SUCCESSIVE_UNIQUE,customHeader:cb,batch_function:ua,handler:function(eb,fb){return this.__handleUpdate(eb,fb);}.bind(this)},'/ajax/mercury/mark_spam.php':{request_user_id:this._fbid,mode:ha.IMMEDIATE,customHeader:cb,handler:function(eb,fb){return this.__handleUpdate(eb,fb);}.bind(this)},'/ajax/mercury/unmark_spam.php':{request_user_id:this._fbid,mode:ha.IMMEDIATE,customHeader:cb,handler:function(eb,fb){return this.__handleUpdate(eb,fb);}.bind(this)},'/ajax/mercury/unread_threads.php':{request_user_id:this._fbid,mode:ha.BATCH_SUCCESSIVE_UNIQUE,customHeader:cb,batch_function:ta,handler:function(eb,fb){return this.__handleUpdate(eb,fb);}.bind(this)},'/ajax/chat/settings.php':{request_user_id:this._fbid,mode:ha.IMMEDIATE,customHeader:cb},'/ajax/mercury/change_archived_status.php':{request_user_id:this._fbid,mode:ha.BATCH_SUCCESSIVE,customHeader:cb,batch_function:ya,handler:function(eb,fb){return this.__handleUpdate(eb,fb);}.bind(this)},'/ajax/mercury/delete_thread.php':{request_user_id:this._fbid,mode:ha.BATCH_SUCCESSIVE,customHeader:cb,batch_function:ab,handler:function(eb,fb){return this.__handleUpdate(eb,fb);}.bind(this)},'/ajax/mercury/delete_messages.php':{request_user_id:this._fbid,mode:ha.IMMEDIATE,customHeader:cb,handler:function(eb,fb){return this.__handleUpdate(eb,fb);}.bind(this)},'/ajax/mercury/delivery_receipts.php':{request_user_id:this._fbid,mode:ha.IMMEDIATE,customHeader:cb,handler:function(eb,fb){return this.__handleUpdate(eb,fb);}.bind(this)},'/ajax/mercury/move_thread.php':{request_user_id:this._fbid,mode:ha.BATCH_SUCCESSIVE,customHeader:cb,batch_function:za,handler:function(eb,fb){return this.__handleUpdate(eb,fb);}.bind(this)},'/ajax/mercury/change_mute_thread.php':{request_user_id:this._fbid,mode:ha.IMMEDIATE,customHeader:cb,handler:function(eb,fb){return this.__handleUpdate(eb,fb);}.bind(this)},'/mercury/pinned_threads/':{request_user_id:this._fbid,mode:ha.BATCH_SUCCESSIVE_UNIQUE,customHeader:cb,handler:function(eb,fb){return this.__handleUpdate(eb,fb);}.bind(this)},'/mercury/unpin_thread/':{request_user_id:this._fbid,mode:ha.IMMEDIATE,customHeader:cb,handler:function(eb,fb){return this.__handleUpdate(eb,fb);}.bind(this)}};ha.registerEndpoints(db);},__sendRequest:function(cb,db,eb){ha.trySend(cb,db,eb,this._fbid);}});Object.assign(bb,ba);e.exports=bb;},null);
__d("MercuryThreadIDMap",["KeyedCallbackManager","MercuryAssert","MercuryIDs","MercurySingletonMixin"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();'use strict';function k(l){this.$MercuryThreadIDMap0=l;this.$MercuryThreadIDMap1=new g();this.$MercuryThreadIDMap2=new g();this.$MercuryThreadIDMap3=new g();}k.prototype.setServerToClientID=function(l,m){this.$MercuryThreadIDMap1.setResource(l,m);};k.prototype.getClientIDFromServerIDNow=function(l){return this.$MercuryThreadIDMap1.getResource(l);};k.prototype.setFBIDToClientID=function(l,m){this.$MercuryThreadIDMap2.setResource(l,m);this.$MercuryThreadIDMap3.setResource(m,l);};k.prototype.getClientIDFromFBIDNow=function(l){return this.$MercuryThreadIDMap2.getResource(l);};k.prototype.getClientIDFromFBID=function(l,m){this.$MercuryThreadIDMap2.executeOrEnqueue(l,m);d(['MercuryServerRequests'],function(n){n.getForFBID(this.$MercuryThreadIDMap0).ensureThreadIsFetched(l);}.bind(this));};k.prototype.setClientIDToFBID=function(l,m){this.$MercuryThreadIDMap3.setResource(l,m);this.$MercuryThreadIDMap2.setResource(m,l);};k.prototype.getFBIDFromClientIDNow=function(l){return this.$MercuryThreadIDMap3.getResource(l);};k.prototype.getFBIDFromClientID=function(l,m){h.isThreadID(l);var n=this.$MercuryThreadIDMap3.executeOrEnqueue(l,m);d(['MercuryServerRequests'],function(o){var p=this.$MercuryThreadIDMap3.getUnavailableResources(n),q=i.tokenize(l);if(p.length&&q.type!='root')o.getForFBID(this.$MercuryThreadIDMap0).fetchThreadData(p);}.bind(this));};k.prototype.hasClientIDForFBID=function(l){return !!this.getClientIDFromFBIDNow(l);};k.prototype.convertThreadIDIfAvailable=function(l){var m=this.getClientIDFromFBIDNow(l);if(m===(void 0)){return l;}else return m;};k.prototype.canLinkExternally=function(l){h.isThreadID(l);var m=i.tokenize(l);return (m.type=='user')||!!this.getFBIDFromClientIDNow(l);};Object.assign(k,j);e.exports=k;},null);
__d("MercuryThreadInformer",["ArbiterMixin","LogHistory","MercuryAssert","MercuryLoggingHelper","MercurySingletonMixin","mapObject","mixin"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){b.__markCompiled&&b.__markCompiled();'use strict';var n=h.getInstance('mercury_informer'),o=m(g);for(var p in o)if(o.hasOwnProperty(p))r[p]=o[p];var q=o===null?null:o.prototype;r.prototype=Object.create(q);r.prototype.constructor=r;r.__superConstructor__=o;function r(t){o.call(this);this.$MercuryThreadInformer0=t;this.$MercuryThreadInformer1={};this.$MercuryThreadInformer2={};this.$MercuryThreadInformer3={};this.$MercuryThreadInformer4=false;this.$MercuryThreadInformer5=false;this.$MercuryThreadInformer6=false;this.$MercuryThreadInformer7={};this.$MercuryThreadInformer8={};this.$MercuryThreadInformer9={};this.$MercuryThreadInformera=0;}r.prototype.updatedThread=function(t){this.$MercuryThreadInformer2[t]=true;this.$MercuryThreadInformerb();};r.prototype.deletedThread=function(t){this.$MercuryThreadInformer1[t]=true;this.$MercuryThreadInformerb();};r.prototype.updatedThreadlist=function(){this.$MercuryThreadInformer4=true;this.$MercuryThreadInformerb();};r.prototype.updatedUnseenState=function(){this.$MercuryThreadInformer5=true;this.$MercuryThreadInformerb();};r.prototype.updatedUnreadState=function(){this.$MercuryThreadInformer6=true;this.$MercuryThreadInformerb();};r.prototype.changedThreadReadState=function(t,u,v){if(!this.$MercuryThreadInformer3[t]||this.$MercuryThreadInformer3[t].timestamp<v)this.$MercuryThreadInformer3[t]={mark_as_read:u,timestamp:v};this.$MercuryThreadInformerb();};r.prototype.receivedMessage=function(t){i.isThreadID(t.thread_id);var u=t.thread_id;if(!this.$MercuryThreadInformer7[u])this.$MercuryThreadInformer7[u]=[];this.$MercuryThreadInformer7[u].push(t);this.updatedThread(u);};r.prototype.reorderedMessages=function(t,u){this.$MercuryThreadInformer8[t]={source:u};this.$MercuryThreadInformerb();};r.prototype.updatedMessage=function(t,u,v){if(!this.$MercuryThreadInformer9[t])this.$MercuryThreadInformer9[t]={};this.$MercuryThreadInformer9[t][u]={source:v};this.updatedThread(t);};r.prototype.synchronizeInforms=function(t){this.$MercuryThreadInformera++;try{t();}catch(u){throw u;}finally{this.$MercuryThreadInformera--;this.$MercuryThreadInformerb();}};r.prototype.listen=function(t,u){return this.subscribe('threads-updated',function(v,w){if(w[t])u(t);});};r.prototype.$MercuryThreadInformerb=function(){if(!this.$MercuryThreadInformera){var t=this.$MercuryThreadInformer1,u=this.$MercuryThreadInformer2,v=this.$MercuryThreadInformer3,w=this.$MercuryThreadInformer4,x=this.$MercuryThreadInformer5,y=this.$MercuryThreadInformer6,z=this.$MercuryThreadInformer7,aa=this.$MercuryThreadInformer8,ba=this.$MercuryThreadInformer9;this.$MercuryThreadInformer1={};this.$MercuryThreadInformer2={};this.$MercuryThreadInformer3={};this.$MercuryThreadInformer4=false;this.$MercuryThreadInformer5=false;this.$MercuryThreadInformer6=false;this.$MercuryThreadInformer7={};this.$MercuryThreadInformer8={};this.$MercuryThreadInformer9={};var ca=Object.keys(u);if(ca.length||w)this.inform('threadlist-updated',ca);if(ca.length)this.$MercuryThreadInformerc('threads-updated',u);for(var da in v){this.$MercuryThreadInformerc('thread-read-changed',v);break;}for(da in t){this.$MercuryThreadInformerc('threads-deleted',t);break;}if(x)this.$MercuryThreadInformerc('unseen-updated',null);if(y)this.$MercuryThreadInformerc('unread-updated',null);for(da in z){this.$MercuryThreadInformerc('messages-received',z);break;}for(da in aa){this.$MercuryThreadInformerc('messages-reordered',aa);break;}for(da in ba){this.$MercuryThreadInformerc('messages-updated',ba);break;}}};r.prototype.$MercuryThreadInformerc=function(t,u){s(t,u);this.inform(t,u);};function s(t,u){var v=u;if(t=='messages-received')v=l(v,function(w){return w.map(function(x){return j.obfuscateMessage(x);});});n.debug(t,v);}Object.assign(r,k);e.exports=r;},null);
__d("MercuryDispatcher",["ArbiterMixin","LogHistory","MercuryLoggingHelper","MercuryPayloadSource","MercurySingletonMixin","MercuryThreadIDMap","MercuryThreadInformer","invariant","isEmpty","mixin"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){b.__markCompiled&&b.__markCompiled();'use strict';var q=h.getInstance('mercury_dispatcher'),r=p(g);for(var s in r)if(r.hasOwnProperty(s))u[s]=r[s];var t=r===null?null:r.prototype;u.prototype=Object.create(t);u.prototype.constructor=u;u.__superConstructor__=r;function u(v){r.call(this);this.$MercuryDispatcher0=v;this.$MercuryDispatcher1=l.getForFBID(this.$MercuryDispatcher0);}u.prototype.handleUpdate=function(v){this.$MercuryDispatcher2(v);n((!!v.from_client)!==(!!v.preprocessed));delete v.preprocessed;if(!o(v))m.getForFBID(this.$MercuryDispatcher0).synchronizeInforms(function(){if(!v.from_client)this.inform('payload-preprocessed',v);this.inform('update-thread-ids',v.newlyAddedClientIDs||{});this.inform('update-participants',v);this.inform('update-threads',v);this.inform('update-unread',v);this.inform('update-threadlist',v);this.inform('update-pinned-threads',v);this.inform('update-messages',v);this.inform('update-unseen',v);this.inform('update-typing-state',v);this.inform('update-delivery',v);this.inform('update-roger',v.roger);this.inform('update-blocked-users',v);this.inform('model-update-completed',null);}.bind(this));};u.prototype.$MercuryDispatcher2=function(v){var w={actions:[],threads:[]};if(v){if(v.actions)w.actions=v.actions.map(function(z){return i.obfuscateMessage(z);});if(v.threads)w.threads=v.threads.map(function(z){return i.obfuscateThread(z);});}var x=Object.assign({},v,w),y=v.payload_source;if(y!==j.CLIENT_CHANGE_READ_STATUS&&y!==j.CLIENT_MARK_THREAD_SEEN)q.debug('update:'+y,{payload:x,from_client:v.from_client});};Object.assign(u,k);e.exports=u;},null);
__d("MercuryThreadInfo",["CurrentUser","MercuryIDs"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();'use strict';var i={canReply:function(k){return !!(k.is_subscribed&&(k.can_reply===(void 0)||k.can_reply)&&!k.has_email_participant&&!k.read_only&&(k.recipients_loadable||k.recipients_loadable===(void 0)));},getMuteSetting:function(k){return (k.mute_settings&&k.mute_settings[j(g.getID())]);},isEmptyLocalThread:function(k){return (h.tokenize(k.thread_id).type==='root'&&!k.timestamp);},isMuted:function(k){return i.getMuteSetting(k)!==(void 0);},isNewEmptyLocalThread:function(k){return !!(i.isEmptyLocalThread(k)&&k.participants&&k.participants.length===0);},showComposer:function(k){return !!(k.is_subscribed&&(k.composer_enabled===(void 0)||k.composer_enabled)&&!k.has_email_participant&&!k.read_only&&(k.recipients_loadable||k.recipients_loadable===(void 0)));}};function j(k){return k+'@facebook.com';}e.exports=i;},null);
__d("MercuryDisplayTimeFilterMessageRenderer",["fbt"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();'use strict';var h={renderFilteredContent:function(i){if(i.is_filtered_content_bh)return (g._("This message was removed because it contains blocked or harmful links."));if(i.is_filtered_content_account)return (g._("This message has been temporarily removed because the sender's account requires verification."));return (g._("This message has been temporarily removed because the sender's account requires verification, or it was identified as abusive."));}};e.exports=h;},null);
__d("MercuryThreads",["EventEmitter","ImmutableObject","KeyedCallbackManager","LogHistory","Map","MercuryActionType","MercuryAssert","MercuryAttachment","MercuryDispatcher","MercuryGlobalActionType","MercuryIDs","MercuryLogMessageType","MercuryLoggingHelper","MercuryPayloadSource","MercurySingletonMixin","MercuryThreadInfo","MessagingTag","MercuryDisplayTimeFilterMessageRenderer","MercuryServerRequests","Set","MercuryThreadInformer","setImmediate"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba){b.__markCompiled&&b.__markCompiled();'use strict';var ca=new g(),da=j.getInstance('mercury_threads');function ea(fa){this.$MercuryThreads0=fa;this.$MercuryThreads1=y.getForFBID(this.$MercuryThreads0);this.$MercuryThreads2=aa.getForFBID(this.$MercuryThreads0);this.$MercuryThreads3=q.getParticipantIDFromUserID(this.$MercuryThreads0);this.$MercuryThreads4=o.getForFBID(this.$MercuryThreads0);this.$MercuryThreads5=false;this.$MercuryThreads6=new i();this.$MercuryThreads7=new z();this.$MercuryThreads8=false;this.$MercuryThreads9=new z();this.$MercuryThreadsa=new z();this.$MercuryThreadsb();}ea.prototype.getThreadMetaNow=function(fa){m.isThreadID(fa);return this.$MercuryThreads6.getResource(fa);};ea.prototype.getOrFetch=function(fa){var ga=this.getThreadMetaNow(fa);if(!ga&&!this.$MercuryThreadsa.has(fa))this.$MercuryThreads9.add(fa);if(this.$MercuryThreads9.size>0&&!this.$MercuryThreads8)this.$MercuryThreadsc();return ga;};ea.prototype.$MercuryThreadsc=function(){if(this.$MercuryThreads8)return;this.$MercuryThreads8=true;ba(function(){this.$MercuryThreads8=false;this.$MercuryThreads9.forEach(function(fa){return this.$MercuryThreadsa.add(fa);}.bind(this));this.getMultiThreadMeta(Array.from(this.$MercuryThreads9),function(fa){for(var ga in fa)fa.hasOwnProperty(ga)&&this.$MercuryThreadsa["delete"](ga);}.bind(this));this.$MercuryThreads9.clear();}.bind(this));};ea.prototype.getThreadMeta=function(fa,ga,ha){return this.getMultiThreadMeta([fa],function(ia){return ga(ia[fa]);},ha);};ea.prototype.getMultiThreadMeta=function(fa,ga,ha){m.allThreadID(fa);var ia=this.$MercuryThreads6.executeOrEnqueue(fa,ga),ja=this.$MercuryThreads6.getUnavailableResources(ia);if(ja.length){var ka=[];for(var la=0;la<ja.length;la++){var ma=ja[la],na=q.tokenize(ma),oa=na.type,pa=na.value;if(oa=='user'){var qa=q.getParticipantIDFromUserID(pa);this.createNewLocalThread(ma,qa===this.$MercuryThreads3?[this.$MercuryThreads3]:[this.$MercuryThreads3,qa]);}else ka.push(ma);}if(ka.length)this.$MercuryThreads1.fetchThreadData(ka,ha);}return ia;};ea.addListener=function(fa,ga){return ca.addListener(fa,ga);};ea.prototype.unsubscribe=function(fa){this.$MercuryThreads6.unsubscribe(fa);};ea.prototype.getCanonicalThreadToParticipant=function(fa,ga,ha,ia){var ja=q.getThreadIDFromParticipantID(fa),ka=this.$MercuryThreads6.getResource(ja);if(typeof ka=='undefined'){ka=this.createNewLocalThread(ja,this.$MercuryThreads3===fa?[this.$MercuryThreads3]:[this.$MercuryThreads3,fa],ga);!ia&&this.$MercuryThreads1.fetchThreadData([ja],ha);}return ka;};ea.prototype.createNewLocalThread=function(fa,ga,ha){var ia=this.$MercuryThreads6.getResource(fa);if(!ia){var ja=q.tokenize(fa),ka=ja.type,la=ja.value;ia=new h({thread_id:fa,last_action_id:null,participants:Array.from(ga),name:null,snippet:'',snippet_has_attachment:false,snippet_sender:null,unread_count:ha?ha:0,message_count:0,image_src:null,timestamp_absolute:null,timestamp_relative:null,timestamp:null,canonical_fbid:ka==='user'?la:null,is_canonical_user:ka=='user',is_canonical:this.$MercuryThreadsd(ga),is_subscribed:true,root_message_threading_id:null,folder:w.INBOX,is_archived:false});this.$MercuryThreads6.setResource(fa,ia);}return ia;};ea.prototype.isEmptyLocalThread=function(fa){var ga=this.$MercuryThreads6.getResource(fa);if(!ga)return false;return v.isEmptyLocalThread(ga);};ea.prototype.isNewEmptyLocalThread=function(fa){var ga=this.$MercuryThreads6.getResource(fa);if(!ga)return false;return v.isNewEmptyLocalThread(ga);};ea.prototype.$MercuryThreadse=function(fa,ga){if(!fa||!fa.length)return;var ha=new k(),ia=new k(),ja=new k(),ka=[];for(var la=0;la<fa.length;la++){var ma=fa[la];if(ma.is_forward)continue;var na=ma.action_type;if(na==l.LOG_MESSAGE&&ma.log_message_type==r.SERVER_ERROR)continue;var oa=!!(ma.sync_id||ma.action_id),pa=ma.thread_id;m.isThreadID(pa);var qa=this.$MercuryThreads6.getResource(pa);if(!qa&&!oa&&na==l.USER_GENERATED_MESSAGE){qa=this.$MercuryThreadsf(ma);this.$MercuryThreads6.setResource(pa,qa);}if(!qa)continue;if(na==l.LOG_MESSAGE||na==l.USER_GENERATED_MESSAGE)oa=!ga;if(qa.server_timestamp&&ma.timestamp<=qa.server_timestamp&&oa)continue;if(!ja.has(pa))ja.set(pa,Object.assign({},qa));this.$MercuryThreadsg(ja.get(pa),ma,ga);if(na==l.USER_GENERATED_MESSAGE)ha.set(pa,ma);if(na==l.USER_GENERATED_MESSAGE||na==l.LOG_MESSAGE||na==l.SEND_MESSAGE)if(ma&&ma.timestamp&&(!ia.has(pa)||ma.timestamp>ia.get(pa).timestamp))ia.set(pa,ma);}ja.forEach(function(ra,sa){var ta=ia.get(sa),ua=ha.get(sa);if(ua){this.$MercuryThreadsh(ra,ua);}else if(ta&&(ta.log_message_type==r.PHONE_CALL||ta.log_message_type==r.VIDEO_CALL)){var va=Object.assign({},ta,{body:ta.log_message_body});this.$MercuryThreadsh(ra,va);}var wa=ra.timestamp;if(ta){if(ta.timestamp>wa)Object.assign(ra,{timestamp_absolute:ta.timestamp_absolute,timestamp_relative:ta.timestamp_relative,timestamp:ta.timestamp});var xa=ra.server_timestamp;if(!ga&&ta.timestamp>xa)ra.server_timestamp=ta.timestamp;}var ya=new h(ra);this.$MercuryThreads6.setResource(sa,ya);ka.push(s.obfuscateThread(ya));}.bind(this),this);ka.length&&this.$MercuryThreads5&&da.debug('threads_updated',{threads:ka});};ea.prototype.$MercuryThreadsg=function(fa,ga,ha){var ia=ga.action_type;if(ia==l.USER_GENERATED_MESSAGE||ia==l.LOG_MESSAGE){ga.is_unread&&fa.unread_count++;fa.message_count++;fa.is_archived=false;}switch(ia){case l.DELETE_THREAD:fa.message_count=0;this.$MercuryThreadsi(ga.thread_id);break;case l.USER_GENERATED_MESSAGE:if(fa.last_read_timestamp>=ga.timestamp)this.$MercuryThreadsj(fa,ga,true);this.$MercuryThreadsk(fa,ga.author);break;case l.SEND_MESSAGE:var ja=ga.log_message_type;if(ja==r.THREAD_IMAGE){fa.image_src=ga.log_message_data.image?ga.log_message_data.image.preview_url:null;this.$MercuryThreadsl(ga.thread_id);}if(ja!==r.SUBSCRIBE&&ja!==r.UNSUBSCRIBE)fa.snippet_attachments=ga.attachments;break;case l.LOG_MESSAGE:var ja=ga.log_message_type;if(ja==r.SUBSCRIBE){this.$MercuryThreadsm(fa,ga.log_message_data.added_participants);this.$MercuryThreadsl(ga.thread_id);}else if(ja==r.UNSUBSCRIBE){this.$MercuryThreadsn(fa,ga.log_message_data.removed_participants);this.$MercuryThreadsl(ga.thread_id);}else if(ja==r.THREAD_IMAGE){if(!ha)fa.image_src=ga.log_message_data.image?ga.log_message_data.image.preview_url:null;}else if(ja==r.THREAD_NAME){if(fa.name!==ga.log_message_data.name)this.$MercuryThreadsl(ga.thread_id);fa.name=ga.log_message_data.name;}else if(ja==r.GENERIC_ADMIN_TEXT)if(this.$MercuryThreadso(fa,ga))this.$MercuryThreadsl(ga.thread_id);break;case l.CHANGE_READ_STATUS:var ka=this.$MercuryThreadsj(fa,ga,ga.mark_as_read);if(ka&&ga.timestamp)fa.last_read_timestamp=ga.timestamp;if(ka&&ha)this.$MercuryThreads1.changeThreadReadStatus(fa.thread_id,ga.mark_as_read,ga.source,fa.last_read_timestamp);break;case l.CHANGE_ARCHIVED_STATUS:if(fa.is_archived!=ga.archived){fa.is_archived=ga.archived;this.$MercuryThreadsl(ga.thread_id);}break;case l.CHANGE_FOLDER:if(fa.folder!=ga.new_folder){fa.folder=ga.new_folder;this.$MercuryThreadsl(ga.thread_id);}break;case l.DELETE_MESSAGES:if(ha){fa.snippet='...';fa.snippet_has_attachment=false;fa.snippet_attachments=null;fa.snippet_sender=null;this.$MercuryThreadsl(ga.thread_id);}else if(ga.message_ids)fa.message_count=fa.message_count-ga.message_ids.length;break;case l.UPDATE_BLOCKER_STATUS:fa.can_reply=!!(!ga.message_blocked&&(ga.is_blocked_by_recipient===(void 0)||!ga.is_blocked_by_recipient)&&fa.is_subscribed&&!fa.has_email_participant&&!fa.read_only&&(fa.recipients_loadable||fa.recipients_loadable===(void 0)));this.$MercuryThreadsl(ga.thread_id);break;case l.UPDATE_BLOCKEE_STATUS:fa.can_reply=!!(!ga.got_blocked&&fa.is_subscribed&&!fa.has_email_participant&&!fa.read_only&&(fa.recipients_loadable||fa.recipients_loadable===(void 0)));this.$MercuryThreadsl(ga.thread_id);break;case l.CHANGE_MUTE_SETTINGS:if(ga.mute_settings!==(void 0)){var la=this.$MercuryThreads0+'@facebook.com';if(fa.mute_settings){if(ga.mute_settings){var ma={};ma[la]=ga.mute_settings;fa.mute_settings=Object.assign({},fa.mute_settings,ma);}else{fa.mute_settings=Object.assign({},fa.mute_settings);delete fa.mute_settings[la];}this.$MercuryThreadsl(fa.thread_id);}}break;case l.ADD_PARTICIPANTS:this.$MercuryThreadsm(fa,ga.participants);this.$MercuryThreadsl(fa.thread_id);break;case l.CHANGE_FLAG:this.$MercuryThreadsp(fa,ga.mark_as_flag);this.$MercuryThreadsl(fa.thread_id);break;case l.MOVE_PENDING_TO_INBOX:this.$MercuryThreadsq(fa);this.$MercuryThreadsl(fa.thread_id);break;}};ea.prototype.$MercuryThreadsf=function(fa){var ga=q.tokenize(fa.thread_id),ha=ga.type,ia=ga.value,ja=this.$MercuryThreadsd(fa.specific_to_list);return new h({thread_id:fa.thread_id,last_action_id:null,participants:fa.specific_to_list,name:null,snippet:fa.body,snippet_has_attachment:false,snippet_attachments:[],snippet_sender:fa.author,unread_count:0,message_count:0,image_src:null,timestamp_absolute:fa.timestamp_absolute,timestamp_relative:fa.timestamp_relative,timestamp:fa.timestamp,canonical_fbid:ha==='user'?ia:null,is_canonical_user:ha==='user',is_canonical:ja,is_subscribed:true,root_message_threading_id:fa.message_id,folder:w.INBOX,is_archived:false});};ea.prototype.$MercuryThreadsj=function(fa,ga,ha){if(ga.timestamp)this.$MercuryThreadsr(fa.thread_id,ha,ga.timestamp);if(!fa||!fa.thread_id)return false;if(!fa.timestamp){this.$MercuryThreads7.add(fa.thread_id);return false;}var ia=!fa.unread_count;if(ha==ia)return false;fa.unread_count=ha?0:1;this.$MercuryThreadsl(fa.thread_id);return true;};ea.prototype.$MercuryThreadss=function(fa){var ga=this.$MercuryThreads6.getAllResources();for(var ha in ga)if(ga.hasOwnProperty(ha)){var ia=ga[ha];if(ia.folder==fa){this.$MercuryThreads6.setResource(ha,h.setProperty(ia,'unread_count',0));this.$MercuryThreadsl(ha);}}};ea.prototype.$MercuryThreadsm=function(fa,ga){var ha=new z(fa.participants);fa.participants=Array.from(fa.participants);ga.forEach(function(ia){if(!ha.has(ia)){fa.participants.push(ia);if(ia===this.$MercuryThreads3)fa.is_subscribed=true;}}.bind(this));};ea.prototype.$MercuryThreadso=function(fa,ga){if(ga.log_message_data&&ga.log_message_data.untypedData){var ha=ga.log_message_data.untypedData.ttl;if(ha!==null&&fa.ephemeral_ttl_mode!==ha){fa.ephemeral_ttl_mode=ha;return true;}}return false;};ea.prototype.$MercuryThreadsn=function(fa,ga){var ha=new z(ga);fa.participants=fa.participants.filter(function(ia){return !ha.has(ia);});if(ha.has(this.$MercuryThreads3))fa.is_subscribed=false;this.$MercuryThreads1.fetchThreadData([fa.thread_id]);};ea.prototype.$MercuryThreadsk=function(fa,ga){if(fa.participants[0]!=ga){fa.participants=fa.participants.filter(function(ha){return ha!=ga;});fa.participants.unshift(ga);}};ea.prototype.$MercuryThreadsh=function(fa,ga){var ha=ga.body,ia=ga.subject,ja='';if(ia){ia=ia.toLowerCase();if(ha.slice(0,ia.length).toLowerCase()==ia){ja=ha;}else if(ha){ja=ia+' \u00B7 '+ha;}else ja=ia;}else ja=ha;if(ga.is_filtered_content)ja=x.renderFilteredContent(ga);fa.snippet=ja;fa.snippet_has_attachment=ga.has_attachment;if(ga.raw_attachments&&ga.raw_attachments.length>0){var ka=n.convertRaw(ga.raw_attachments);fa.snippet_attachments=ka;}else fa.snippet_attachments=ga.attachments;fa.snippet_sender=ga.author;};ea.prototype.$MercuryThreadsp=function(fa,ga){fa.page_thread_info=Object.assign({},fa.page_thread_info,{flagged:ga});};ea.prototype.$MercuryThreadsq=function(fa){if(fa.folder!==w.PENDING)return;fa.folder=w.INBOX;};ea.prototype.$MercuryThreadsd=function(fa){return fa.filter(function(ga){return ga!=this.$MercuryThreads3;}.bind(this)).length<=1;};ea.prototype.$MercuryThreadsb=function(){this.$MercuryThreads4.subscribe('update-threads',function(fa,ga){var ha=(ga.actions||[]).filter(function(ia){return ia.thread_id;});if(ga.threads&&ga.payload_source==t.SERVER_FETCH_THREAD_INFO)ga.threads.forEach(function(ia){var ja=ia.thread_id;if(this.$MercuryThreads7.has(ja)){this.$MercuryThreads7["delete"](ja);if(ia.unread_count)this.$MercuryThreads1.changeThreadReadStatus(ia.thread_id,true);}}.bind(this));this.$MercuryThreadst(ga.threads);this.$MercuryThreadse(ha,ga.from_client);ga.threads&&ga.threads.forEach(function(ia){this.$MercuryThreadsl(ia.thread_id);}.bind(this));if(ga.global_actions)ga.global_actions.forEach(function(ia){if(ia.action_type==p.MARK_ALL_READ)this.$MercuryThreadss(ia.folder);}.bind(this));if(this.$MercuryThreads5){this.$MercuryThreads5=false;ca.emit('change');}}.bind(this));};ea.prototype.$MercuryThreadst=function(fa){if(!fa||!fa.length)return;var ga={},ha=[];fa.forEach(function(ia){var ja=new h(ia);ga[ia.thread_id]=ja;ha.push(s.obfuscateThread(ja));});ha.length&&da.debug('threads_added',{threads:ha});this.$MercuryThreads6.addResourcesAndExecute(ga);};ea.prototype.$MercuryThreadsl=function(fa){this.$MercuryThreads5=true;this.$MercuryThreads2.updatedThread(fa);};ea.prototype.$MercuryThreadsi=function(fa){this.$MercuryThreads5=true;this.$MercuryThreads2.deletedThread(fa);};ea.prototype.$MercuryThreadsr=function(fa,ga,ha){this.$MercuryThreads5=true;this.$MercuryThreads2.changedThreadReadState(fa,ga,ha);};Object.assign(ea,u);e.exports=ea;},null);
__d("WebMessengerPermalinkConstants",["MercuryConfig","URI"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();var i={ARCHIVED_PATH:'/messages/archived',BASE_PATH:'/messages',PENDING_PATH:'/messages/pending',OTHER_PATH:'/messages/other',SPAM_PATH:'/messages/spam',COMPOSE_POSTFIX_PATH:'/new',SEARCH_POSTFIX_PATH:'/search',TID_POSTFIX_PARTIAL_PATH:'/conversation-',overriddenVanities:g.CoreGraphEnabled?'(archived|other|pending|spam|new|search|conversation-.*)':'(archived|other|spam|new|search|conversation-.*)',getURIPathForThreadID:function(j,k){return (k||i.BASE_PATH)+i.TID_POSTFIX_PARTIAL_PATH+h.encodeComponent(h.encodeComponent(j));},getThreadIDFromURI:function(j){var k=j.getPath().match(i.BASE_PATH+'(/[^/]*)*'+i.TID_POSTFIX_PARTIAL_PATH+'([^/]+)');if(k){var l=h.decodeComponent(h.decodeComponent(k[2]));return l;}},getURIPathForIDOrVanity:function(j,k){if(j.match('^'+i.overriddenVanities+'$'))j='.'+j;return (k||i.BASE_PATH)+'/'+j;},getUserIDOrVanity:function(j){var k=j.match(i.BASE_PATH+'.*/([^/]+)/?$'),l=k&&k[1],m=i.overriddenVanities;if(!l||l.match('^'+m+'$')){return false;}else if(l.match('^\\.'+m+'$')){return l.substr(1);}else return l;}};e.exports=i;},null);
__d("ChatTypeaheadConstants",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();var g={USER_TYPE:'user',THREAD_TYPE:'thread',FRIEND_TYPE:'friend',NON_FRIEND_TYPE:'non_friend',FB4C_TYPE:'fb4c',PAGE_TYPE:'page',HEADER_TYPE:'header'};e.exports=g;},null);
__d("ChatOpenTab",["BusinessURI.brands","Event","requireWeak","ChatWelcomeMessage","ContextualThing","DOM","csx","cx","MercuryIDs","Parent","curry"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){b.__markCompiled&&b.__markCompiled();var r=null;i('ChatApp',function(ba){return r=ba;});var s=null;i('ChatTabModel',function(ba){return s=ba;});var t=716,u='messaging_tracking';function v(){d(['Toggler'],function(ba){var ca=ba.getInstance(l.scry(document,"div._1z4y")[0]);if(ca&&ca.getActive())ca.hide();});}function w(ba,ca,da){d(['LogHistory','MercuryThreads','WebMessengerPermalinkConstants','goURI'],function(ea,fa,ga,ha){fa.get().getThreadMeta(ba,function(ia){if(r&&r.isInitialized()){r.tabController.openTab(ba,r.tabsViewport,ca,da);}else ha(g(ga.getURIPathForThreadID(ba)));if(!aa.canOpenTab())ea.getInstance('mercury').error('Unable to open chat tab',ia);});});if(document.documentElement.clientHeight<=t)v();}function x(ba,ca,da,ea){h.listen(ba,'click',function(fa){if(aa.canOpenTab()){ea(ca,da);return fa.kill();}});}function y(ba,ca,da,ea){var fa={referrer:ba||'',message_thread_id:ca,message_view:'chat',timestamp_send:Date.now()};if(da!==(void 0))fa.message_target_ids=[da];d(['ChatImpressionLogger'],function(ha){ha.logImpression(ba,da,ea);});d(['Banzai'],function(ha){ha.post(u,fa,{delay:0,retry:true});});var ga=o.getUserIDFromThreadID(String(ca));d(['Banzai'],function(ha){ha.post('page_message_button_click',{page_id:ga,ref:ba});});}function z(ba){var ca=k.getContext(ba);return (ca&&p.byClass(ca,"_3qw")!==null);}var aa={canOpenTab:function(){return r&&!r.isHidden();},openEmptyTab:function(ba,ca,da){if(aa.canOpenTab()&&s){var ea=s.getEmptyTab();w(ea);y(ca,ea,null,da);v();return ea;}return null;},listenOpenEmptyTab:function(ba,ca){x(ba,null,ca,aa.openEmptyTab);},openThread:function(ba,ca,da,ea,fa){d(['MercuryThreadIDMap'],function(ga){if(o.isValid(ba)){w(ba,ea,fa);}else ga.get().getClientIDFromFBID(ba,function(ha){return w(ha,ea,fa);});y(ca,ba,null,da);v();});},listenOpenThread:function(ba,ca,da){x(ba,ca,da,aa.openThread);},openUserTab:function(ba,ca,da){var ea=o.getThreadIDFromUserID(ba);w(ea);y(ca,ea,ba,da);return true;},openPageTab:function(ba,ca,da){d(['MercuryThreads'],function(ea){var fa=o.getThreadIDFromUserID(ca);ea.get().getThreadMeta(fa,function(ga){if(ba&&ba.length>0){var ha=(Date.now()-ga.timestamp)/1000,ia=ha/3600;if(ga.message_count===0||ia>24)j.setWelcomeMessage(fa,o.getParticipantIDFromUserID(ca),ba);}});w(fa);y(da,fa,ca);});return true;},listenOpenUserTab:function(ba,ca,da){if(!z(ba))x(ba,ca,da,aa.openUserTab);},listenOpenPageTab:function(ba,ca,da,ea){if(!z(ba))x(ba,ca,ea,q(aa.openPageTab,da));},openTabByType:function(ba,ca,da){d(['ChatTypeaheadConstants','MercuryParticipantTypes'],function(ea,fa){if(ca===ea.THREAD_TYPE){if(ba){aa.openThread(ba,da);}else aa.openEmptyTab(null,da);}else if(!ca||ca===fa.FRIEND||ca===ea.FRIEND_TYPE||ca===ea.PAGE_TYPE||ca===ea.USER_TYPE)aa.openUserTab(ba,da);});}};e.exports=aa;},null);
__d("arrayStableSort",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();function g(h,i){return h.map(function(j,k){return {data:j,index:k};}).sort(function(j,k){return i(j.data,k.data)||(j.index-k.index);}).map(function(j){return j.data;});}e.exports=g;},null);
__d("RangedCallbackManager",["CallbackManagerController","arrayStableSort","createObjectFrom"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();function j(k,l,m){"use strict";this.$RangedCallbackManager0=[];this.$RangedCallbackManager1=false;this.$RangedCallbackManager2=false;this.$RangedCallbackManager3={};this.$RangedCallbackManager4=new g(this.$RangedCallbackManager5.bind(this));this.$RangedCallbackManager6=k;this.$RangedCallbackManager7=l;this.$RangedCallbackManager8=m;}j.prototype.executeOrEnqueue=function(k,l,m,n,o){"use strict";return this.$RangedCallbackManager4.executeOrEnqueue({start:k,limit:l},m,{strict:!!n,skipOnStrictHandler:o});};j.prototype.unsubscribe=function(k){"use strict";this.$RangedCallbackManager4.unsubscribe(k);};j.prototype.getUnavailableResources=function(k){"use strict";var l=this.$RangedCallbackManager4.getRequest(k),m=[];if(l&&!this.$RangedCallbackManager1){var n=l.request,o=this.$RangedCallbackManager9(l.options),p=n.start+n.limit;for(var q=o.length;q<p;q++)m.push(q);}return m;};j.prototype.addResources=function(k){"use strict";k.forEach(function(l){if(!this.$RangedCallbackManager3[l]){this.$RangedCallbackManager3[l]=true;this.$RangedCallbackManager0.push(l);this.$RangedCallbackManager2=null;}}.bind(this));this.resortResources();this.$RangedCallbackManager4.runPossibleCallbacks();};j.prototype.addResourcesWithoutSorting=function(k,l){"use strict";var m=this.$RangedCallbackManager0.slice(0,l);m=m.concat(k);m=m.concat(this.$RangedCallbackManager0.slice(l));this.$RangedCallbackManager0=m;Object.assign(this.$RangedCallbackManager3,i(k,true));this.$RangedCallbackManager2=null;this.$RangedCallbackManager4.runPossibleCallbacks();};j.prototype.removeResources=function(k){"use strict";k.forEach(function(l){if(this.$RangedCallbackManager3[l]){this.$RangedCallbackManager3[l]=false;var m=this.$RangedCallbackManager0.indexOf(l);if(m!=-1)this.$RangedCallbackManager0.splice(m,1);}}.bind(this));};j.prototype.removeAllResources=function(){"use strict";this.$RangedCallbackManager0=[];this.$RangedCallbackManager3={};};j.prototype.resortResources=function(){"use strict";this.$RangedCallbackManager0=h(this.$RangedCallbackManager0,function(k,l){return this.$RangedCallbackManager7(this.$RangedCallbackManager6(k),this.$RangedCallbackManager6(l));}.bind(this));};j.prototype.setReachedEndOfArray=function(){"use strict";if(!this.$RangedCallbackManager1){this.$RangedCallbackManager1=true;this.$RangedCallbackManager2=null;this.$RangedCallbackManager4.runPossibleCallbacks();}};j.prototype.hasReachedEndOfArray=function(){"use strict";return this.$RangedCallbackManager1;};j.prototype.setError=function(k){"use strict";if(this.$RangedCallbackManager2!==k){this.$RangedCallbackManager2=k;this.$RangedCallbackManager4.runPossibleCallbacks();}};j.prototype.getError=function(k,l,m){"use strict";var n=this.$RangedCallbackManager9({strict:m});return k+l>n.length?this.$RangedCallbackManager2:null;};j.prototype.hasResource=function(k){"use strict";return this.$RangedCallbackManager3[k];};j.prototype.getResourceAtIndex=function(k){"use strict";return this.$RangedCallbackManager0[k];};j.prototype.getAllResources=function(){"use strict";return this.$RangedCallbackManager0.concat();};j.prototype.getCurrentArraySize=function(k){"use strict";return this.$RangedCallbackManager9(k).length;};j.prototype.$RangedCallbackManager9=function(k){"use strict";var l=this.$RangedCallbackManager0;if(k&&k.strict){var m=k.skipOnStrictHandler||this.$RangedCallbackManager8;if(m)l=l.filter(m);}return l;};j.prototype.$RangedCallbackManager5=function(k,l){"use strict";var m=this.$RangedCallbackManager9(l);if(!this.$RangedCallbackManager1&&!this.$RangedCallbackManager2&&k.start+k.limit>m.length){return false;}else{var n=m.slice(k.start,k.start+k.limit),o=k.start+k.limit>m.length?this.$RangedCallbackManager2:null;return [n,o];}};j.prototype.getElementsUntil=function(k){"use strict";var l=[];for(var m=0;m<this.$RangedCallbackManager0.length;m++){var n=this.$RangedCallbackManager6(this.$RangedCallbackManager0[m]);if(this.$RangedCallbackManager7(n,k)>0)break;l.push(this.$RangedCallbackManager0[m]);}return l;};e.exports=j;},null);
__d("VideoCallSupport",["ChannelConstants","RTCConfig","UserAgent"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();var j={isSendWebrtcSupported:function(){return h.SendNewVCGK;},isReceiveWebrtcSupported:function(){return h.ReceiveNewVCGK;},isVideoInteropSupported:function(){return h.VideoInteropGK;},isVideoCallSupported:function(){return j.isSendWebrtcSupported();},isWebrtcSupported:function(){return (i.isBrowser('Chrome >= 28')||i.isBrowser('Firefox >= 25')||i.isBrowser('Opera >= 20'));},isOSSupported:function(){return !i.isPlatform('Android')&&!i.isPlatform('iOS');},getCapabilities:function(){var k=0;if(this.isReceiveWebrtcSupported())k=g.CAPABILITY_VOIP_INTEROP;return k;}};e.exports=j;},null);
__d("MercuryFolders",["MercuryConfig","MessagingTag","arrayContains"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();var j=[h.INBOX,h.OTHER,h.ACTION_ARCHIVED,h.SPAM],k=[h.INBOX,h.PENDING,h.OTHER,h.ACTION_ARCHIVED],l={getSupportedFolders:function(){return g.CoreGraphEnabled?k.concat():j.concat();},isSupportedFolder:function(m){return i(j,m);},getFromMeta:function(m){var n=m.folder;if(m.is_archived)n=h.ACTION_ARCHIVED;return n;}};e.exports=l;},null);
__d("MercuryUnreadState",["MercuryFolders","LogHistory","KeyedCallbackManager","MercuryActionType","MercuryDispatcher","MercuryGlobalActionType","MercurySingletonMixin","MercuryThreadlistConstants","MercuryThreadIDMap","MessagingTag","MercuryServerRequests","MercuryThreadInformer","MercuryThreads","arrayContains","createObjectFrom"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u){b.__markCompiled&&b.__markCompiled();var v=(g.getSupportedFolders()||[]).filter(function(na){return na!=p.ACTION_ARCHIVED;}),w='unread_thread_hash',x='unseen_thread_list',y=n.MAX_UNREAD_COUNT,z=h.getInstance('mercury_unread_state');function aa(na){this._fbid=na;this._serverRequests=q.getForFBID(this._fbid);this._threadIDMap=o.getForFBID(this._fbid);this._threadInformer=r.getForFBID(this._fbid);this._threads=s.getForFBID(this._fbid);this._dispatcher=k.getForFBID(this._fbid);this._allReadTimestamp={};this._threadReadTimestamp={};this._initialUnreadCount={};this._maxCount={};this._unreadResources={};v.forEach(function(oa){this._initialUnreadCount[oa]=0;this._maxCount[oa]=false;this._unreadResources[oa]=new i();}.bind(this));this._dispatcher.subscribe('update-unread',function(oa,pa){fa(this,pa);var qa=pa.global_actions||[];for(var ra=0;ra<qa.length;ra++){var sa=qa[ra];if(sa.action_type==l.MARK_ALL_READ)ia(this,sa.folder,sa.timestamp);}}.bind(this));this._dispatcher.subscribe('update-thread-ids',function(oa,pa){ka(this,pa);}.bind(this));}Object.assign(aa.prototype,{getUnreadCount:function(na){if(this.exceedsMaxCount(na)){z.error('unguarded_unread_count_fetch',{});return 0;}return ea(this,na);},exceedsMaxCount:function(na){return this._maxCount[na]||(ea(this,na)>y);},markFolderAsRead:function(na){if(this._maxCount[na]||ea(this,na)>0)this._serverRequests.markFolderAsRead(na);},getIsThreadUnread:function(na,oa){var pa=oa||p.INBOX,qa=da(this,pa);return qa&&qa[na];}});Object.assign(aa,m);function ba(na,oa,pa){na._unreadResources[oa].setResource(w,pa);na._unreadResources[oa].setResource(x,Object.keys(pa));}function ca(na,oa,pa){var qa=na._unreadResources[oa].executeOrEnqueue(w,pa),ra=na._unreadResources[oa].getUnavailableResources(qa);if(ra.length)na._serverRequests.fetchUnreadThreadIDs(oa);}function da(na,oa){return na._unreadResources[oa].getResource(w);}function ea(na,oa){var pa=na._unreadResources[oa].getResource(x);if(pa){return pa.length;}else return na._initialUnreadCount[oa];}function fa(na,oa){var pa;(oa.unread_thread_fbids||[]).forEach(function(qa){pa=qa.folder;if(!ma(pa))return;var ra=qa.thread_fbids||[];ra=ra.concat(qa.other_user_fbids||[]);var sa=ja(na,ra);ba(na,pa,u(sa,true));if(sa.length>y)na._maxCount[pa]=true;na._threadInformer.updatedUnreadState();});(oa.message_counts||[]).forEach(function(qa){if(qa.unread_count===(void 0))return;pa=qa.folder;if(qa.unread_count>y){na._maxCount[pa]=true;ba(na,pa,{});na._threadInformer.updatedUnreadState();}else{na._initialUnreadCount[pa]=qa.unread_count;if(na._initialUnreadCount[pa]===0)ba(na,pa,{});na._threadInformer.updatedUnreadState();}});(oa.actions||[]).forEach(function(qa){if(qa.is_forward)return;var ra=j,sa=qa.other_user_fbid?qa.other_user_fbid:qa.thread_fbid,ta=qa.thread_id?qa.thread_id:sa;if(qa.action_type==ra.DELETE_THREAD){v.forEach(function(va){ha(na,va,ta);});}else if(qa.action_type==ra.CHANGE_ARCHIVED_STATUS||qa.action_type==ra.CHANGE_FOLDER){var ua=na._threads.getThreadMetaNow(qa.thread_id);pa=g.getFromMeta(ua);if(ma(pa)&&ua.unread_count>0)ga(na,pa,ta);v.forEach(function(va){if(va!=pa)ha(na,va,ta);});}else{pa=la(na,qa);if(!ma(pa))return;if(qa.action_type==ra.CHANGE_READ_STATUS){if(qa.mark_as_read){ha(na,pa,ta,qa.timestamp);}else ga(na,pa,ta,qa.timestamp);}else if(qa.action_type==ra.USER_GENERATED_MESSAGE||qa.action_type==ra.LOG_MESSAGE)if(qa.is_unread)ga(na,pa,ta,qa.timestamp);}});}function ga(na,oa,pa,qa){if(na._maxCount[oa])return;ca(na,oa,function(ra){var sa=na._allReadTimestamp[oa]||0,ta=na._threadReadTimestamp[pa]||0,ua=qa||Number.POSITIVE_INFINITY;if(ua>=sa&&ua>=ta&&!ra[pa]){ra[pa]=qa||0;ba(na,oa,ra);na._threadInformer.updatedUnreadState();}});}function ha(na,oa,pa,qa){if(na._maxCount[oa])return;ca(na,oa,function(ra){if(qa){var sa=na._threadReadTimestamp[pa];if(!sa||sa<qa)na._threadReadTimestamp[pa]=qa;}var ta=ra[pa];if(qa&&typeof ta=='number'&&qa<ta)return;if(pa in ra){delete ra[pa];ba(na,oa,ra);na._threadInformer.updatedUnreadState();}});}function ia(na,oa,pa){na._maxCount[oa]=false;ba(na,oa,{});na._allReadTimestamp[oa]=Math.max(na._allReadTimestamp[oa]||0,pa||0);na._threadInformer.updatedUnreadState();}function ja(na,oa){return oa.map(na._threadIDMap.convertThreadIDIfAvailable,na._threadIDMap);}function ka(na,oa){v.forEach(function(pa){var qa=da(na,pa);if(!qa)return;for(var ra in oa){var sa=oa[ra];if(qa[ra]){qa[sa]=qa[ra];delete qa[ra];}}ba(na,pa,qa);});}function la(na,oa){var pa=oa.thread_id?na._threads.getThreadMetaNow(oa.thread_id):null;return pa?g.getFromMeta(pa):oa.folder;}function ma(na){return t(v,na);}e.exports=aa;},null);
__d("MessagingReliabilityLogger",["PresenceUtil","MercuryServerDispatcher","MessagingReliabilityLoggerInitialData","isEmpty","setTimeoutAcrossTransitions"],function(a,b,c,d,e,f,g,h,i,j,k){b.__markCompiled&&b.__markCompiled();var l='/ajax/mercury/client_reliability.php',m=60000;function n(t,u){var v={app:i.app,categories:JSON.stringify(t)};if(!j(u))v.extra=JSON.stringify(u);return v;}function o(t,u,v,w){if(t[u]===(void 0))t[u]={};if(t[u][v]===(void 0))t[u][v]=0;t[u][v]+=w;}function p(t,u,v,w){if(t[u]===(void 0))t[u]={};if(t[u][v]===(void 0))t[u][v]=[];for(var x=0;x<w.length;++x)t[u][v].push(w[x]);}function q(t,u){if((t&&!t.categories)||(u&&!u.categories))return;var v=t?JSON.parse(t.categories):{},w=t&&t.extra?JSON.parse(t.extra):{},x=JSON.parse(u.categories),y=u.extra?JSON.parse(u.extra):{};for(var z in x){var aa=x[z],ba=y[z];for(var ca in aa){o(v,z,ca,aa[ca]);if(ba!==(void 0)){var da=ba[ca];if(da!==(void 0))p(w,z,ca,da);}}}return n(v,w);}var r={};r[l]={mode:h.BATCH_SUCCESSIVE_PIGGYBACK_ON_ERROR,batch_function:q};h.registerEndpoints(r);var s={addEntry:function(t,u,v){if(!i.enabled)return;var w={};o(w,t,u,1);var x={};if(v!==(void 0))p(x,t,u,[v]);h.trySend(l,n(w,x));}};(function t(){s.addEntry('page_event','active',g.getSessionID());k(t,m);})();e.exports=s;},null);