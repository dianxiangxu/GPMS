window.lpCWTagUI=window.lpCWTagUI||{};window.lpCWTagConst=window.lpCWTagConst||{};lpCWTagConst.CHAT_BASE_URL="https://www.aexp-static.com";lpCWTagConst.CHAT_LOCATION_URI="/api/axpi/ioa/chatserver/";lpCWTagConst.CHAT_LOCATION_URI2="";lpCWTagConst.DEBUG_ENABLE=false;lpCWTagConst.LOGGER_NAME_BOOTSTAP="LPChatBootstrap";lpCWTagConst.WS_ENABLE=true;lpCWTagConst.VERSION="0.9.6-b18";lpCWTagConst.lpChatTitleVal="American Express Live Chat";lpCWTagConst.lpChatTitleDock="Dock";lpCWTagConst.lpChatTitleUndock="Un-Dock";lpCWTagConst.lpChatTitleMinimize="Minimize";lpCWTagConst.lpChatTitleMaximize="Maximize";lpCWTagConst.lpChatTitleClose="Close";lpCWTagConst.lpNewChatMsgArrive="New Chat Message Has Arrived";lpCWTagConst.enableSiteTitleFlashing=true;lpCWTagConst.enableDockUnDock=true;lpCWTagConst.lpTitleFlashingTimer;lpCWTagConst.widgetMarginRight="32";lpCWTagUI.LPChatWidgetLogger=lpCWTagUI.LPChatWidgetLogger||function LPChatWidgetLogger(){var a=this;function c(e,f){var d="000"+e;return d.substr(d.length-f);}function b(i,h,g,e){if(e){var f=new Date();try{h=typeof h==="string"?h:JSON.stringify(h);g=typeof g==="string"?g:JSON.stringify(g);}catch(d){h=d;g="...";}f=""+c(f.getHours(),2)+":"+c(f.getMinutes(),2)+":"+c(f.getSeconds(),2)+":"+c(f.getMilliseconds(),3);if(!(window.console&&console.log)){console={log:function(){},debug:function(){},info:function(){},warn:function(){},error:function(){}};}console.log(f+" "+i+" : "+h+(g==""?"":(" : "+g)));}}a.debug=function(e,d){b(lpCWTagConst.LOGGER_NAME_BOOTSTAP,e||"",d||"",lpCWTagConst.DEBUG_ENABLE);};a.info=function(e,d){b(lpCWTagConst.LOGGER_NAME_BOOTSTAP,e||"",d||"",true);};};lpCWTagUI.LPChatWidgetUI=lpCWTagUI.LPChatWidgetUI||function LPChatWidgetUI(ab){var n=this;var b;var K=new lpCWTagUI.LPChatWidgetLogger();var I=false;var m=false;var x=true;var X="";var D="";var H=true;var t=lpCWTagConst.WS_ENABLE;var ae,S,W,P,y;var i=false;var s=false;var E=0,ac=0;function U(an){return document.getElementById(an);}function w(an){if(an&&an.parentNode){an.parentNode.removeChild(an);}}function Q(an){if(typeof an!="undefined"){an.style.display="block";}}function Y(an){Q(U(an));}function aj(an){if(typeof an!="undefined"){an.style.display="none";}}function q(an){aj(U(an));}function ak(ao,an,ap){return V(U(ao),an,ap);}function V(ar,ao,at){K.debug("deleteAppendStyleClass","classToRemove="+ao+", classToAdd="+at);var an="";if(typeof ar!="undefined"&&ar&&ar.className){var aq=ar.className.split(/\s/g);if(aq.length>0){for(var ap=0;ap<aq.length;ap++){if(aq[ap]!=""&&aq[ap]!==ao&&aq[ap]!==at){if(an!=""){an+=" ";}an+=aq[ap];}}}}if(an!=""){an+=" ";}an+=at;K.debug("deleteAppendStyleClass","newClassName="+an);return an;}function r(an){var ap=0,ao=0;while(an&&!isNaN(an.offsetLeft)&&!isNaN(an.offsetTop)){ap+=an.offsetLeft-an.scrollLeft;ao+=an.offsetTop-an.scrollTop;an=an.offsetParent;}return{top:ao,left:ap};}function N(ao,an,ap){if(ao.addEventListener){ao.addEventListener(an,ap,false);}else{ao.attachEvent("on"+an,ap);}}function af(ao,an,ap){if(ao.addEventListener){ao.removeEventListener(an,ap,false);}else{ao.detachEvent("on"+an,ap);}}function A(){if(!I){K.debug("lpChatBuildFrame","...");var an=document.body;try{n.registerOnMessage();ae=document.createElement("div");ae.id="lpChatWizContainer";ae.style.display="none";an.appendChild(ae);ae.innerHTML=g();S=document.createElement("div");S.id="lpChatiFrameContainer";S.className="lpPosRel";ae.appendChild(S);W=document.createElement("iframe");W.id="lpChatiFrame";W.className="lpChatiFrame";W.src=R();W.scrolling="no";W.frameBorder="0";W.style.border="none";W.style.width="400px";W.style.height="410px";W.setAttribute("allowtransparency","true");N(W,"load",z);S.appendChild(W);I=true;n.bindEvents();}catch(ao){K.debug("lpChatBuildFrame","Exception occurred",ao);}}else{K.debug("lpChatBuildFrame","chat window already loaded");}}function z(){K.debug("flagChatFrameLoaded","method invoke");s=true;}function O(){var an=R();return an.indexOf("https")>-1?"https://"+an.substr(8).split("/")[0]:"http://"+an.substr(7).split("/")[0];}function al(){return lpCWTagConst.CHAT_BASE_URL.replace(/,\s*$/,"");}function R(){var an=al()+lpCWTagConst.CHAT_LOCATION_URI+lpCWTagConst.CHAT_LOCATION_URI2+"lpChatWireFrame.html?v"+lpCWTagConst.VERSION;return an;}function F(an){K.debug("isSameOrigin respDomain="+an,"targetDomain: "+O());return O()==an?true:false;}function k(an){K.debug("parentFrame sending postmsg to ="+O(),an);if(B().postMessage){B().postMessage(JSON.stringify(an),O());}else{throw new Error("Your browser does not support the postMessage method!");}}function B(){var an=document.getElementById("lpChatiFrame");return(an.contentWindow||an.contentDocument);}function v(){aj(ae);}function d(){Q(ae);}function h(){K.debug("WebService","execute lpSendData..");lpSendData("page","lpChatRequest","true");}function aa(){K.debug("WebService","execute sendDataCheckWebService..");lpSendData("page","lpDataCheck","true");}function ad(){K.debug("startWebService","...");if(t){h();var an=0;b=setInterval(function(){an+=500;if(an>=10000){if(typeof ab.lpCustDataRecvd=="undefined"){k({lpEmbChatWiz:"LPNVCF",CMD:"LP_WEB_SERVICES",value:"FAILED",MSG:"TIMEOUT"});}else{if(ab.lpCustDataRecvd){k({lpEmbChatWiz:"LPNVCF",CMD:"LP_WEB_SERVICES",value:"FAILED",MSG:""});}else{k({lpEmbChatWiz:"LPNVCF",CMD:"LP_WEB_SERVICES",value:"FAILED",MSG:""});}}clearInterval(b);}else{if(typeof ab.lpCustDataRecvd=="undefined"){aa();}else{if(ab.lpCustDataRecvd){k({lpEmbChatWiz:"LPNVCF",CMD:"LP_WEB_SERVICES",value:"SUCCESS",MSG:""});clearInterval(b);}else{K.debug("startWebService waiting","**************");}}}},500);}return true;}function am(){K.debug("fireLPChat","...");var au="offline";var at="";var an="";var aq="";var ar="";var ap="";var ao="";if(typeof ab.lpChatSkill!="undefined"){au=ab.lpChatSkill;}if(typeof ab.lpOfflineSurveyNameOverride!="undefined"){an=ab.lpOfflineSurveyNameOverride;}if(typeof ab.lpPreChatSurveyNameOverride!="undefined"){aq=ab.lpPreChatSurveyNameOverride;}if(typeof ab.lpExitChatSurveyNameOverride!="undefined"){ar=ab.lpExitChatSurveyNameOverride;}if(typeof ab.lpPCIGenID!="undefined"){t=ab.lpPCIGenID;}if(ab.lpMTagConfig!="undefined"&&ab.lpMTagConfig.FPC_CONT){at=ab.lpMTagConfig.FPC_CONT;}if(ab.lpMTagConfig&&ab.lpMTagConfig.LPSID_VAR){X=ab.lpMTagConfig.LPSID_VAR;}if(typeof ab.lpWebserviceFailureOfflineSurveyNameOverride!="undefined"){ap=ab.lpWebserviceFailureOfflineSurveyNameOverride;}if(typeof ab.lpNonInteractiveChatSurveyNameOverride!="undefined"){ao=ab.lpNonInteractiveChatSurveyNameOverride;}var av=lpMTagConfig.chatWizButtonName?lpMTagConfig.chatWizButtonName:"";if(au!="offline"){ad();}k({lpEmbChatWiz:"LPNVCF",CMD:"CONTROL",value:"lpStartChatButtonClicked",skill:au,lpChatWizButtonName:av,lpVisitorSessionId:X,WS_ENABLE:t,siteContainer:at,offlineSurveyNameOverride:an,preChatSurveyNameOverride:aq,exitChatSurveyNameOverride:ar,webserviceFailureOfflineSurveyNameOverride:ap,nonInteractiveChatSurveyNameOverride:ao});}function J(){K.debug("closeButtonClicked","method is invoked");k({lpEmbChatWiz:"LPNVCF",CMD:"CONTROL",value:"END_CHAT"});}function C(){K.debug("onWinResizeEvent","...");Z();}function Z(){var at,aA,au,an,aq,ay;var av=r(ae);var ao=av.top;var ax=av.left;var ap=ab.innerWidth||document.documentElement.clientWidth||document.body.clientWidth;var ar=ab.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;var az=ae.offsetWidth;var aw=ae.offsetHeight;K.debug("adjustChatWizLocation","(win.width, win.height): ("+ap+", "+ar+") (widget.width, widget.height): ("+az+", "+aw+") (EW.top, EW.left): ("+ao+", "+ax+")");if(x){at=ar-aw;aA=ap-az-lpCWTagConst.widgetMarginRight;if(at>=0){au="auto";an="0px";}else{au="0px";an="auto";}if(aA>=0){aq="auto";ay="0px";}else{aq="0px";ay="auto";}}else{at=ar-aw-ao;aA=ap-az-ax;K.debug("adjustChatWizLocation","new (EW.top, EW.left):("+at+", "+aA+")");if(at<0){at=ar-aw;}else{at=ao;}if(at<0){at=0;}if(aA<0){aA=ap-az;}else{aA=ax;}if(aA<0){aA=0;}an="auto";ay="auto";aq=aA+"px";au=at+"px";}K.debug("adjustChatWizLocation","FINAL (EW.top, EW.left, EW.bottom, EW.right) : ("+au+", "+aq+", "+an+", "+ay+")");ae.style.bottom=an;ae.style.right=ay;ae.style.left=aq;ae.style.top=au;}function j(){K.debug("adjustWindowSizeForPCI","...");ae.style.width="700px";S.style.width="700px";W.style.width="700px";K.debug("adjustWindowSizeForPCI","1top="+ae.style.top+", "+ae.style.left);var an=parseInt(ae.style.left)-300;if(an<0){an=0;}ae.style.left=an+"px";}function l(){K.debug("adjustWindowSizeNonPCI","...");K.debug("adjustWindowSizeNonPCI","top="+ae.style.top+", "+ae.style.left);S.style.width="400px";W.style.width="400px";var an=parseInt(ae.style.left);var ao=parseInt(ae.style.width);K.debug("adjustWindowSizeNonPCI","width="+ae.style.width);if(ao>400){an+=300;}ae.style.width="400px";ae.style.left=an+"px";K.debug("adjustWindowSizeNonPCI","originalLeft="+an+", top="+ae.style.top+", "+ae.style.left);}function ai(){K.debug("showMinimizeHandler","method is invoked");ae.style.bottom="0px";ae.style.right="0px";ae.style.left="auto";ae.style.top="auto";aj(S);var an=U("lpChatMinizeBtnImg");var ap=V(an,"lpCustChatIconMinimize","lpCustChatIconMaximize");an.className=ap;var ao=U("lpChatMinizeBtn");ao.setAttribute("data-msg",lpCWTagConst.lpChatTitleMaximize);k({lpEmbChatWiz:"LPNVCF",CMD:"FLASHING",value:"MINIMIZED",MSG:""});H=false;}function c(){K.debug("showMaximizeHandler","method is invoked");Q(S);Z();var an=U("lpChatMinizeBtnImg");var ap=V(an,"lpCustChatIconMaximize","lpCustChatIconMinimize");an.className=ap;var ao=U("lpChatMinizeBtn");ao.setAttribute("data-msg",lpCWTagConst.lpChatTitleMinimize);G();k({lpEmbChatWiz:"LPNVCF",CMD:"FLASHING",value:"MAXIMIZED",MSG:""});H=true;}function ag(){K.debug("minimzeMaximizeButtonClick","method is invoked");if(H){ai();}else{c();}}function o(){K.debug("endChat","method is invoked");delCookie("lp_flg");m=false;u(false);L();clearInterval(b);}function M(){D=document.title;titleTimer=setInterval(function(){K.debug("flashMainPageTitle","originalSiteTitle...."+D);if(document.title==lpCWTagConst.lpNewChatMsgArrive){document.title=D;}else{document.title=lpCWTagConst.lpNewChatMsgArrive;}},800);}function f(){var an=1;if(lpCWTagConst.enableSiteTitleFlashing){D=document.title;}if(typeof lpCWTagConst.lpTitleFlashingTimer=="undefined"){K.debug("lpFlashingStart"," starting...");lpCWTagConst.lpTitleFlashingTimer=setInterval(function(){var ap=U("lpChatTitleContainer");var ao=U("lpChatTitleTxt");if(an==1){ap.style.backgroundColor="#002665";ao.style.color="darkorange";an=0;}else{ap.style.backgroundColor="#335184";ao.style.color="white";an=1;}if(lpCWTagConst.enableSiteTitleFlashing){if(document.title==lpCWTagConst.lpNewChatMsgArrive){document.title=D;}else{document.title=lpCWTagConst.lpNewChatMsgArrive;}}},1000);}}function G(){K.debug("lpFlashingStop"," stoppping...");var ao=U("lpChatTitleContainer");var an=U("lpChatTitleTxt");clearInterval(lpCWTagConst.lpTitleFlashingTimer);ao.style.backgroundColor="#002665";an.style.color="white";lpCWTagConst.lpTitleFlashingTimer=undefined;if(lpCWTagConst.enableSiteTitleFlashing){document.title=D;D="";}}function u(an){K.debug("showChatWizContainerVisibility","...");if(an){Q(ae);}else{aj(ae);}}function g(){var an='<div id="lpChatTitleContainer" class="lpRight"><div id="lpChatTitleDragArea" class="lpLeft"><div class="lpLeft"><span class="lpChatTitleContainerLogo lpLeft lpCustSpriteBackground lpCustChatLogoSmall" ></span></div><div id="lpChatTitleTxt" class="lpLeft lpChatHeaderText noselect" unselectable="on">'+lpCWTagConst.lpChatTitleVal+'</div></div><div class="lpRight lpHeaderActionbuttonsContainer" style="">';if(lpCWTagConst.enableDockUnDock){an+='<div class="lpHeaderActionbuttons lpHoverButton lpPointer" data-msg="'+lpCWTagConst.lpChatTitleUndock+'" id="lpChatPopOutBtn" ><span id="lpChatPopOutBtnImg" class="lpPointer lpCustSpriteBackground lpCustChatIconPopOut" ></span></div>';}an+='<div class="lpHeaderActionbuttons lpHoverButton lpPointer" data-msg="Minimize" id="lpChatMinizeBtn" ><span id="lpChatMinizeBtnImg" class="lpPointer lpCustSpriteBackground lpCustChatIconMinimize" ></span></div><div class="lpHeaderActionbuttons lpHoverButton lpPointer" data-msg="'+lpCWTagConst.lpChatTitleClose+'" id="lpChatEndChatBtn" ><span class="lpPointer lpCustSpriteBackground lpCustChatIconClose" ></span></div></div><div class="lpClear"></div></div><div class="lpClear"></div>';return an;}function ah(ap,ao){T();var an=document.createElement("div");an.className=ao?"lpBubbleUp":"lpBubbleDown";an.id="lpToolTipContent";an.innerHTML=ap;return an;}function T(){K.debug("removeMouseOverToolTip","delete tooltip");w(U("lpToolTipContent"));}n.endChatRequest=function(){J();};n.debugEnable=function(){lpCWTagConst.DEBUG_ENABLE=true;k({lpEmbChatWiz:"LPNVCF",CMD:"DEBUG",value:"ENABLE"});};n.debugDisable=function(){lpCWTagConst.DEBUG_ENABLE=false;k({lpEmbChatWiz:"LPNVCF",CMD:"DEBUG",value:"DISABLE"});};n.debug=function(ao,an){K.debug(ao,an);};n.loadChat=function(){K.debug("loadChat","method invoked");A();if(!m){K.debug("loadChat","an active chat session not found, about fireChat");var an=0;var ao=setInterval(function(){an+=500;if(an>=10000){clearInterval(ao);K.info("loadChat","iframe content exceeded maximun load time of "+an+" seconds. Suggest to reload page");}else{K.debug("loadChat","waiting for iFrame content to load..chatFrameLoaded="+s);if(s){K.debug("loadChat","iFrame content fully loaded");am();clearInterval(ao);}}},500);}else{K.debug("loadChat","an active chat session found. do nothing");}};n.chatOnPageLoad=function(){K.info("chatOnPageLoad","starting...");A();};n.registerOnMessage=function(){if(ab.addEventListener){ab.addEventListener("message",n.receiveChatPostMessage,false);}else{ab.attachEvent("onmessage",n.receiveChatPostMessage);}};n.receiveChatPostMessage=function(ap){if(lpCWTagConst.DEBUG_ENABLE&&F(ap.origin)){K.debug("receiveChatPostMessageParent",ap.data);}try{var an=JSON.parse(ap.data);if(an.lpEmbChatWiz=="LPNVPF"){if(an.CMD=="FLASHING"){if(an.value=="START"){f();}else{G();}}else{if(an.CMD=="CONTROL"){if(an.value=="SHOW_CONTAINER"){u(true);}else{if(an.value=="END_CHAT"){o();}else{if(an.value=="HIDE_CONTAINER"){u(false);}else{if(an.value=="CHAT_STATE_ACTIVE"){m=true;}else{if(an.value=="CHAT_STATE_INACTIVE"){m=false;}else{if(an.value=="UPDATE_DRAG_AREA_SHOW_PCI"){j();i=true;}else{if(an.value=="UPDATE_DRAG_AREA_HIDE_PCI"){l();i=false;}}}}}}}}}}}catch(ao){K.debug("lpReceiveChatPostMessage. Exception occurred",ao);}return;};function e(an){K.debug("showMouseOverToolTip","id ="+an);T();var ao=U(an);var aq=ao.offsetHeight-12;var ar=r(ae);K.debug("showMouseOverToolTip","container top ="+r(ae).top+" , button height="+aq);var ap;if(ar.top>=aq){ap=ah(ao.getAttribute("data-msg"),false);}else{ap=ah(ao.getAttribute("data-msg"),true);}ae.appendChild(ap);var ap=U("lpToolTipContent");if(an=="lpChatPopOutBtn"){ap.style.right="22px";}else{if(an=="lpChatMinizeBtn"){ap.style.right="2px";}else{if(an=="lpChatEndChatBtn"){ap.style.right="-19px";}}}}function L(){K.debug("dockButtonHandler","");x=true;var an=U("lpChatPopOutBtnImg");var ap=V(an,"lpCustChatIconPopIn","lpCustChatIconPopOut");an.className=ap;var ao=U("lpChatPopOutBtn");ao.setAttribute("data-msg",lpCWTagConst.lpChatTitleUndock);ae.style.bottom="0px";ae.style.right="0px";ae.style.left="auto";ae.style.top="auto";if(typeof P!="undefined"){P.unbind(y);}}function p(){K.debug("undockButtonHandler","222");x=false;var an=U("lpChatPopOutBtnImg");var ar=V(an,"lpCustChatIconPopOut","lpCustChatIconPopIn");an.className=ar;var ao=U("lpChatPopOutBtn");ao.setAttribute("data-msg",lpCWTagConst.lpChatTitleDock);P=lpTag.taglets.lpDragManager();var aq=U("lpChatTitleDragArea");var ap={drag:ae,anchor:aq,horizontal:true,vertical:true,onDrag:function(at){K.debug("Drag Start","...");},onDragEnd:function(at){K.debug("Drag Complete",at);}};y=P.bind(ap);}function a(an){K.debug("dockUnDockButtonClick","...");if(x){p();}else{L();}}n.bindEvents=function(){K.debug("bindEvents","...");if(lpCWTagConst.enableDockUnDock){N(U("lpChatPopOutBtn"),"click",a);N(U("lpChatPopOutBtn"),"mouseover",function(){e("lpChatPopOutBtn");});N(U("lpChatPopOutBtn"),"mouseout",T);}N(U("lpChatMinizeBtn"),"click",ag);N(U("lpChatEndChatBtn"),"click",J);N(U("lpChatMinizeBtn"),"mouseover",function(){e("lpChatMinizeBtn");});N(U("lpChatEndChatBtn"),"mouseover",function(){e("lpChatEndChatBtn");});N(U("lpChatMinizeBtn"),"mouseout",T);N(U("lpChatEndChatBtn"),"mouseout",T);N(ab,"resize",C);K.debug("bindEvents","complete");};n.isChatWinLoaded=function(){return I;};n.webServicesEnable=function(){t=true;};n.webServicesDisable=function(){t=false;};n.embeddedChatVersion=function(){return lpCWTagConst.VERSION;};};lpChatWidgetUI=new lpCWTagUI.LPChatWidgetUI(window);function lpEndChat(){delCookie("lp_flg");lpChatWidgetUI.endChatRequest();}function loadDragJSForInlineChat(){try{if(wasDragJSLoaded()){return;}var a=getHomePageServerURL()+"api/axpi/ioa/chatdemo/js/drag.min.js";var c=document.getElementsByTagName("head").item(0);var b=document.createElement("script");b.type="text/javascript";b.async=true;b.src=a;c.appendChild(b);}catch(d){}}function wasDragJSLoaded(){var a=document.getElementsByTagName("script");for(var b=0;b<a.length;b++){if(a[b].src.indexOf("chatdemo/js/drag.min.js")>-1){return true;}}return false;}function setAACookieForInlineChat(){try{setCookie("lp_flg","true",null,45);}catch(a){console.log("Error in setAACookieForInlineChat:: "+a.message);}}function lpChatOnPageLoad(){try{loadDragJSForInlineChat();lpChatWidgetUI.chatOnPageLoad();}catch(a){console.log("Error in lpChatOnPageLoad:: "+a.message);}}function lpLoadChat(){loadDragJSForInlineChat();setAACookieForInlineChat();lpChatWidgetUI.loadChat();}function lpChatWizInfo(){new lpCWTagUI.LPChatWidgetLogger().info("Initializing Chat Widget Bootstrap","Version ["+lpCWTagConst.VERSION+"]");}lpChatWizInfo();