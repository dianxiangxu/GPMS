/*!CK:706177616!*//*1438227126,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["HOWit"]); }

__d("MercuryAudioPlayer",["Event","Arbiter","DOM","Flash","UserAgent_DEPRECATED"],function(a,b,c,d,e,f,g,h,i,j,k){b.__markCompiled&&b.__markCompiled();var l=200;function m(){if(k.webkit()&&!k.chrome())return false;var v=i.create('audio'),w=false;try{if(!!v.canPlayType)if(v.canPlayType('video/mp4;').replace(/^no$/,''))w=true;}finally{return w;}}function n(){return j.isAvailable();}var o=function(){this.interval=null;this.arbiterInstance=null;this.audio=i.create('audio');g.listen(this.audio,'playing',function(){this.informAttachment('playing',this.audio.currentTime);this.interval=setInterval(function(){this.informAttachment('playing',this.audio.currentTime);}.bind(this),l);}.bind(this));g.listen(this.audio,'ended',function(){clearInterval(this.interval);this.informAttachment('finished');}.bind(this));};Object.assign(o.prototype,{setAudio:function(v,w){this.audio.setAttribute('src',v);this.arbiterInstance=w;},informAttachment:function(v,w){if(this.arbiterInstance)this.arbiterInstance.inform(v,w);},play:function(){this.audio.play();this.informAttachment('played');},resume:function(){this.audio.play();this.informAttachment('played');},pause:function(){this.audio.pause();clearInterval(this.interval);this.informAttachment('paused');},getType:function(){return 'html5';}});var p=function(){this.src=null;this.arbiterInstance=null;var v=i.create('div');document.body.appendChild(v);this.swf=j.embed('/swf/SoundStreamPlayer.swf',v,null,{});this.interval=null;h.subscribe('soundstream/finished',function(){clearInterval(this.interval);this.informAttachment('finished');}.bind(this));};Object.assign(p.prototype,{setAudio:function(v,w){this.src=v;this.arbiterInstance=w;},informAttachment:function(v,w){if(this.arbiterInstance)this.arbiterInstance.inform(v,w);},play:function(){this.swf.playSound(this.src);this.interval=setInterval(function(){var v=this.swf.getCurrentTime();this.informAttachment('playing',v);}.bind(this),l);this.informAttachment('played');},resume:function(){this.swf.resume();this.informAttachment('played');},pause:function(){clearInterval(this.interval);this.swf.pause();this.informAttachment('paused');},getType:function(){return 'flash';}});function q(){if(m()){return new o();}else if(n())return new p();return false;}var r=null,s=null,t=0;function u(v,w){this.src=v;this.arbiterInstance=w;this.audio_id=++t;r!==null||(r=q());if(!r)return false;}Object.assign(u.prototype,{getType:function(){if(!r){return false;}else return r.getType();},play:function(v){if(v&&s==this.audio_id){r.resume();}else{this.pause();s=this.audio_id;r.setAudio(this.src,this.arbiterInstance);r.play();}},pause:function(){r.pause();}});e.exports=u;},null);
__d("MercuryAttachmentAudioClip.react",["Arbiter","ArbiterMixin","MercuryAudioPlayer","CurrentUser","JSLogger","LeftRight.react","MercuryShareAttachmentRenderLocations","React","SubscriptionsHandler","cx","fbt","joinClasses","shield"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){b.__markCompiled&&b.__markCompiled();var t=n,u=t.PropTypes,v='MercuryAttachmentAudioClip/play',w=k.create('mercury_audio_clip'),x=n.createClass({displayName:"AudioClip",mixins:[h],propTypes:{duration:u.number,location:u.oneOf(m.getValues()),rootClassName:u.string,showHelp:u.bool,src:u.string.isRequired,width:u.number},getInitialState:function(){this.logged=false;return {time:0,playing:false,started:false,duration:this.props.duration,audioPlayer:new i(this.props.src,this)};},componentDidMount:function(){this._subscriptionsHandler=new o();this._subscriptionsHandler.addSubscriptions(this.subscribe('playing',this.updateTime),this.subscribe('played',s(this.setState,this,{playing:true,started:true})),this.subscribe('paused',s(this.setState,this,{playing:false})),this.subscribe('finished',s(this.setState,this,{playing:false,started:false,time:this.props.duration})),g.subscribe(v,function(y,z){if(this.props.src!=z)this.setState({time:0});}.bind(this)));},componentWillUnmount:function(){this._subscriptionsHandler&&this._subscriptionsHandler.release();},updateTime:function(y,z){this.setState({time:z});},play:function(){if(this.state.playing){this.state.audioPlayer.pause();}else{this.state.audioPlayer.play(this.state.started);g.inform(v,this.props.src);if(!this.logged){this.logged=true;w.log('play',{uid:j.getID(),duration:this.props.duration});}}},_formatSeconds:function(y){if(y){y=Math.ceil(y);var z=y%60;if(z<10)z='0'+z;var aa=Math.floor(y/60);return aa+':'+z;}else return null;},_renderPlayer:function(y,z){return (n.createElement("a",{className:"_1miz _2e-1",href:"#",style:{width:y},onClick:this.play},n.createElement("span",{className:"_1mi- _2e-2"},n.createElement("i",{className:"_1mi_ _2e-3"})),n.createElement("span",{className:"_1mj0 _2e-4 _3oh-"},z),n.createElement("div",{className:"_1mj1 _2e-5"})));},render:function(){var y=this.state.time,z=this.state.playing,aa=this._formatSeconds(this.state.duration),ba=this.props.location===m.MESSENGER,ca=this.props.width||170;if(ba){var da=this.props.duration;if(da>10){ca=240;}else if(da>5){ca=200;}else if(da>2){ca=160;}else ca=120;}var ea=null,fa=Math.ceil((y*(ca+2))/this.state.duration);if(ba)fa=Math.ceil((y*(ca+24))/this.state.duration);if(this.state.audioPlayer&&this.state.audioPlayer.getType()){var ga=this._renderPlayer(ca,aa),ha=this._renderPlayer(ca,aa),ia=(("_1mj2")+(' '+"_2e-6")+(z&&(y!==0)?' '+"_1mj3":'')+(z&&(y===0)?' '+"_4g4x":''));ea=(n.createElement("div",{className:ia},ga,n.createElement("div",{className:"_1mj4 _2e-7",style:{width:fa}},ha)));}else ea=(n.createElement("div",{className:"_1mj2"},n.createElement("div",{className:"_1miz"},n.createElement(l,null,n.createElement("a",{className:"_1mj5",href:this.props.src},n.createElement("span",{className:"_3qi6"},n.createElement("i",{className:"_1mj6"})),n.createElement("span",{className:"_1mj7"},q._("Voice Message")),n.createElement("span",{className:"_1mj8"},aa)),n.createElement("a",{href:this.props.src,className:"_1mj9"},n.createElement("i",{className:"_1mja"}))))));return (n.createElement("div",{className:r((("_1mjb")+(ba?' '+"_454y":'')),this.props.rootClassName)},ea));}});e.exports=x;},null);
__d("MercuryAttachmentConstants",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();var g={SIDE_LENGTH:9};e.exports=g;},null);
__d("MercuryAttachmentFile.react",["Image.react","LeftRight.react","Link.react","MercuryAttachment","ReactComponentWithPureRenderMixin","React","ix","cx","joinClasses","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){b.__markCompiled&&b.__markCompiled();'use strict';var q=l,r=q.PropTypes,s=l.createClass({displayName:"MercuryAttachmentFile",propTypes:{name:r.string.isRequired,open_url:r.string,rel:r.string,type:r.string.isRequired,url:r.string},mixins:[k],_renderFileLinks:function(){if(this.props.open_url)return (l.createElement("div",{className:"_59gs"},l.createElement(i,{target:"_blank",href:this.props.open_url},p._("open")),' ',"Â·",' ',l.createElement(i,{href:this.props.url},p._("download"))));return l.createElement("div",null);},render:function(){var t=o(j.getAttachIconClass(this.props.type),"_59go _59gq");if(this.props.url)return (l.createElement(h,{className:t},l.createElement(i,{href:this.props.url},l.createElement(h,null,l.createElement(g,{src:m('/images/messaging/docs/generic.png')}),l.createElement("span",{className:"_59gp"},this.props.name))),this._renderFileLinks()));return (l.createElement(h,{className:t},l.createElement(g,{src:m('/images/messaging/docs/generic.png')}),l.createElement("span",{className:"_59gp"},this.props.name)));}});e.exports=s;},null);
__d("ChatImageArrowDirection",["keyMirror"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();'use strict';var h=g({BOTH:null,LEFT:null,RIGHT:null});e.exports=h;},null);
__d("ChatImageWithArrow.react",["BackgroundImage.react","ChatImageArrowDirection","Link.react","MercuryAttachmentConstants","MercuryConfig","React","XUISpinner.react","cx","getVendorPrefixedName","joinClasses"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){b.__markCompiled&&b.__markCompiled();'use strict';var q=l,r=q.PropTypes,s=30,t=15,u=l.createClass({displayName:"ChatImageWithArrow",propTypes:{arrowDirection:r.oneOf(Object.keys(h)),onClick:r.func,height:r.number.isRequired,isLoading:r.bool,rootClassName:r.string,sideLength:r.number,source:r.string,width:r.number.isRequired},getDefaultProps:function(){return {sideLength:j.SIDE_LENGTH,isLoading:false};},render:function(){this._arrowWidth=Math.floor(this.props.sideLength/Math.sqrt(2));this._extendedPhotoWidth=Math.ceil(this._getWidth()+this._arrowWidth);if(this.props.isLoading)return this._renderUploadingBubble();var v=p((("_4yp6")+(this.props.arrowDirection!==h.BOTH?' '+"_2nlo":'')),this.props.rootClassName),w,x;switch(this.props.arrowDirection){case h.BOTH:w=[this._renderArrowWithBorder(h.LEFT),this._renderArrowWithBorder(h.RIGHT)];x=[this._renderArrowWithNoBorder(h.LEFT),this._renderArrowWithNoBorder(h.RIGHT)];break;case h.LEFT:case h.RIGHT:w=this._renderArrowWithBorder(this.props.arrowDirection);x=this._renderArrowWithNoBorder(this.props.arrowDirection);break;}return this._renderLink(l.createElement("div",{className:v},k.ChatTabMessengerStyle?null:w,l.createElement("div",{className:"_52kr",style:{width:this._getWidth(),height:this._getHeight()}},l.createElement("div",{className:"_4yp9",style:{backgroundImage:'url('+this.props.source+')',width:this._extendedPhotoWidth,height:this._getHeight()}})),k.ChatTabMessengerStyle?null:x));},_getWidth:function(){return Math.max(this.props.width,t);},_getHeight:function(){return Math.max(this.props.height,s);},_renderLink:function(v){if(this.props.onClick)return (l.createElement(i,{onClick:this.props.onClick},v));return v;},_calculateArrowTransform:function(v,w,x,y){if(w===h.LEFT){return 'translate('+x+'px, '+y+'px)'+'rotate(45deg)';}else return 'translate('+(v-x)+'px, '+y+'px)'+'rotate(45deg)';},_calculateArrowImageTransform:function(v,w,x,y){if(w===h.LEFT){return 'rotate(-45deg)'+'translate(-'+(this._arrowWidth+x)+'px,'+'-'+y+'px)';}else return 'rotate(-45deg)'+'translate(-'+(v-x)+'px, -'+y+'px)';},_renderUploadingBubble:function(){var v={width:this.props.sideLength,height:this.props.sideLength};if(this.props.source)v.backgroundImage='url('+this.props.source+')';var w={width:this.props.sideLength,height:this.props.sideLength};if(this.props.source)w.opacity=0;var x=o('transform');if(x){v[x]=this._calculateArrowTransform(this._getWidth(),this.props.arrowDirection,0,this.props.sideLength);w[x]=this._calculateArrowTransform(this._getWidth(),this.props.arrowDirection,0,Math.floor(this.props.sideLength-this._getHeight()));}var y={width:this._getWidth(),height:this._getHeight()};if(this.props.source){y.backgroundImage='url('+this.props.source+')';y.backgroundSize='cover';}return (l.createElement("div",{className:"_4yp6"},l.createElement("div",{className:"_4ypa",style:v}),l.createElement("div",{className:"_4ypb",style:y},l.createElement(m,{size:"small"})),l.createElement("div",{className:"_4ype",style:w})));},_renderArrowWithBorder:function(v){var w={width:this.props.sideLength,height:this.props.sideLength},x={},y=o('transform');if(y){w[y]=this._calculateArrowTransform(this._getWidth(),v,0,this.props.sideLength);x[y]=this._calculateArrowImageTransform(this._getWidth(),v,0,this.props.sideLength);return (l.createElement("div",{className:(("_4ypf")+(v===h.LEFT?' '+"_2nlp":'')+(v===h.RIGHT?' '+"_2nlq":'')),key:'border:'+v,style:w},l.createElement(g,{backgroundSize:"cover",className:"_4ypg",height:this._getHeight(),src:this.props.source,style:x,width:this._extendedPhotoWidth})));}},_renderArrowWithNoBorder:function(v){var w={width:this.props.sideLength,height:this.props.sideLength},x={},y=1,z=o('transform');if(z){w[z]=this._calculateArrowTransform(this._getWidth(),v,y,this.props.sideLength-this._getHeight());x[z]=this._calculateArrowImageTransform(this._getWidth(),v,y,this.props.sideLength);}return (l.createElement("div",{className:(("_4yph")+(v===h.LEFT?' '+"_2nlp":'')+(v===h.RIGHT?' '+"_2nlq":'')),key:'noBorder:'+v,style:w},l.createElement(g,{backgroundSize:"cover",className:"_4ypg",height:this._getHeight(),src:this.props.source,style:x,width:this._extendedPhotoWidth})));}});e.exports=u;},null);
__d("MercuryAttachmentPhoto.react",["ChatImageArrowDirection","ChatImageWithArrow.react","MercuryMessageInfo","MessagesViewer","React"],function(a,b,c,d,e,f,g,h,i,j,k){b.__markCompiled&&b.__markCompiled();'use strict';var l=k,m=l.PropTypes,n=k.createClass({displayName:"MercuryAttachmentPhoto",propTypes:{height:m.number,image:m.object.isRequired,message:m.object.isRequired,width:m.number},componentDidMount:function(){j.preload();},_handleClickPicture:function(o){var p=this.props.image;j.bootstrapWithConfig({src:p.preview_url,endpoint:p.url,fbid:p.metadata.fbid,dimensions:p.metadata.dimensions,disablePaging:true},null);},render:function(){var o=i.isInbound(this.props.message);return (k.createElement(h,{arrowDirection:o?g.LEFT:g.RIGHT,source:this.props.image.preview_url,height:this.props.height,width:this.props.width,onClick:this._handleClickPicture,isLoading:!!this.props.image.preview_uploading}));}});e.exports=n;},null);
__d("ChatGridImage.react",["Link.react","React","cx"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();'use strict';var j=h,k=j.PropTypes,l=h.createClass({displayName:"ChatGridImage",propTypes:{isLoading:k.bool,onClick:k.func,size:k.number.isRequired,source:k.string},render:function(){if(this.props.isLoading)return (h.createElement("div",{className:"_4ypb",style:{width:this.props.size,height:this.props.size}}));return (h.createElement(g,{onClick:this.props.onClick},h.createElement("div",{className:"_332l",style:{backgroundImage:'url('+this.props.source+')',width:this.props.size,height:this.props.size}})));}});e.exports=l;},null);
__d("MercuryAttachmentPhotoGrid.react",["ChatGridImage.react","ChatImageArrowDirection","ChatImageWithArrow.react","Grid.react","MercuryAttachmentType","MercuryMessageInfo","MessagesViewer","React","cx"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){b.__markCompiled&&b.__markCompiled();'use strict';var p=j.GridItem,q=n,r=q.PropTypes,s=n.createClass({displayName:"MercuryAttachmentPhotoGrid",propTypes:{images:r.arrayOf(r.object).isRequired,size:r.number.isRequired,message:r.object.isRequired},componentDidMount:function(){m.preload();},_generateClickHandler:function(t){var u=this.props.images.some(function(v){return v.attach_type===k.ANIMATED_IMAGE;});return (function(v){m.bootstrapWithConfig({src:t.preview_url,endpoint:t.url,fbid:t.metadata.fbid,dimensions:t.metadata.dimensions,disablePaging:u},null);});},render:function(){var t=this.props.images,u=t.length,v=(u==2||u==4)?2:3,w=Math.floor(this.props.size/v),x=l.isInbound(this.props.message),y=x?0:v-1,z=[];for(var aa=0;aa<t.length;aa++)if(aa===y){z.push(n.createElement(p,{key:aa},n.createElement(i,{arrowDirection:x?h.LEFT:h.RIGHT,source:t[aa].preview_url,height:w,width:w,isLoading:!!t[aa].preview_uploading,onClick:this._generateClickHandler(t[aa])})));}else z.push(n.createElement(p,{key:aa},n.createElement(g,{isLoading:!!t[aa].preview_uploading,onClick:this._generateClickHandler(t[aa]),size:w,source:t[aa].preview_url})));return (n.createElement(j,{cols:v,className:"_5b2w",spacing:"_5b2x",alignh:"right"},z));}});e.exports=s;},null);
__d("MercuryAttachmentAttribution.react",["Image.react","ImmutableObject","ReactComponentWithPureRenderMixin","React","cx","joinClasses"],function(a,b,c,d,e,f,g,h,i,j,k,l){b.__markCompiled&&b.__markCompiled();'use strict';var m=j,n=m.PropTypes,o=j.createClass({displayName:"MercuryAttachmentAttribution",mixins:[i],propTypes:{attachment:n.instanceOf(h)},render:function(){var p=this._getAttribution();if(!p)return null;return (j.createElement("div",{className:l(this.props.className,"_29ew")},j.createElement(g,{src:p.icon_url,className:"_29ex"}),j.createElement("span",{className:"_29ey"},p.name)));},_getAttribution:function(){return this.props.attachment&&this.props.attachment.app_attribution;}});e.exports=o;},null);
__d("ChatAttachmentAttribution.react",["ImmutableObject","MercuryAttachmentAttribution.react","React","cx"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();'use strict';var k=i,l=k.PropTypes,m=i.createClass({displayName:"ChatAttachmentAttribution",propTypes:{attachment:l.instanceOf(g)},render:function(){return (i.createElement(h,{attachment:this.props.attachment,className:"_1ekr"}));}});e.exports=m;},null);
__d("MercuryAttachmentVideo.react",["ChatAttachmentAttribution.react","ChatImageArrowDirection","ChatImageWithArrow.react","CenteredContainer.react","FBOverlayBase.react","FBOverlayContainer.react","FBOverlayElement.react","Image.react","ImmutableObject","MercuryAttachment","MessagesViewer","React","Vector","cx","ix"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u){b.__markCompiled&&b.__markCompiled();var v=r,w=v.PropTypes,x=r.createClass({displayName:"MercuryAttachmentVideo",propTypes:{attachment:w.instanceOf(o),duration:w.number.isRequired,isChat:w.bool,isInbound:w.bool,name:w.string.isRequired,pageID:w.number,thumbSize:w.shape({height:w.number,width:w.number}).isRequired,thumbnail:w.string.isRequired,videoSize:w.shape({height:w.number,width:w.number}).isRequired,videoID:w.string.isRequired,videoURI:w.string.isRequired},componentDidMount:function(){q.preload();},_formatDuration:function(){var y=this.props.duration,z=Math.floor(y/60),aa=y%60;if(aa<10)return z+':0'+aa;return z+':'+aa;},openViewer:function(){var y=this.props,z=y.pageID,aa=y.videoID,ba=y.videoSize,ca=y.videoURI;ba=new s(ba.width,ba.height);q.renderVideo({pageID:z,videoID:aa,videoSize:ba,videoURI:ca});},_renderImage:function(){if(this.props.isChat){return (r.createElement("div",null,r.createElement(i,{arrowDirection:this.props.isInbound?h.LEFT:h.RIGHT,height:this.props.thumbSize.height,key:"previewImage",source:this.props.thumbnail,width:this.props.thumbSize.width}),r.createElement(g,{attachment:this.props.attachment,key:"chatAttribution"})));}else return (r.createElement(n,{height:this.props.thumbSize.height,width:this.props.thumbSize.width,src:this.props.thumbnail}));},_getStyle:function(){if(this.props.isChat)return {};return this.props.thumbSize;},render:function(){var y=p.hasAttribution(this.props.attachment),z=(("clearfix")+(' '+"_zow")+(' '+"_59go")+(y?' '+"_4yjw":'')+(this.props.isChat?' '+"_3ds5":'')),aa=(r.createElement(l,{className:z,key:"overlayContainer",onClick:this.openViewer,style:this._getStyle()},r.createElement(k,null,this._renderImage()),r.createElement(m,null,r.createElement("div",{className:((!this.props.isChat?"_zox":'')+(y?' '+"_jt3":''))},r.createElement("span",{className:"_zoz"},this._formatDuration()))),r.createElement(m,null,r.createElement(j,{className:((y?"_jt3":'')),vertical:true},r.createElement(n,{src:u('/images/chat/chat_play_icon.png')})))));if(this.props.isChat)return aa;return (r.createElement("div",null,aa,r.createElement(g,{attachment:this.props.attachment,key:"inboxAttribution"})));}});e.exports=x;},null);
__d("loadImage",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();'use strict';function g(h,i){var j=new Image();j.onload=function(){i(j.width,j.height,j);};j.src=h;}e.exports=g;},null);
__d("PhotoResizeMath",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();var g={getScaledPhotoDimensions:function(h,i,j,k,l){var m=h/i,n=j/k;if(j&&k&&l==='stretch')return {width:j,height:k};if((!j&&k)||((l==='contain')!==(m>=n)))return {width:k*m,height:k};if(j)return {width:j,height:j/m};return {width:h,height:i};}};e.exports=g;},null);
__d("PixelzFocus",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();'use strict';var g={search:function(h,i){var j=0,k=h.length-1;while(j<=k){var l=j+Math.floor((k-j)/2),m=h[l];if(m>i){k=l-1;}else if(m<i){j=l+1;}else return l;}return Math.min(j,k);},forceSpecificPoint:function(h,i,j){var k=1e-09,l=g.search(h,i-j-k)+1,m=g.search(h,i+j);return h.slice(l,m+1);},findBiggestSets:function(h,i){var j=[],k=-1;for(var l=0;l<h.length;++l){var m=h[l],n=l,o=g.search(h,m+i),p=o-n;if(p>k)j=[];if(p>=k){k=p;j.push({low:n,high:o});}}return j;},getBestSet:function(h,i,j){var k=-1,l=null;for(var m=0;m<i.length;++m){var n=i[m],o=h[n.low],p=h[n.high],q=o+(p-o)/2,r=Math.min(o-(q-j),(q+j)-p);if(r>k){k=r;l=n;}}return l;},getFocusFromSet:function(h,i){var j=h[i.low],k=h[i.high];return j+(k-j)/2;},clampFocus:function(h,i){var j=i/2,k=1-(i/2);if(h<j)return j;if(h>k)return k;return h;},convertFromCenterToCSS:function(h,i){if(Math.abs(1-i)<1e-05)return 0;return (h-i/2)/(1-i);},convertFromCSSToCenter:function(h,i){return h*(1-i)+i/2;},getVisible:function(h,i){if(h<i)return h/i;return i/h;},getHidden:function(h,i){return 1-g.getVisible(h,i);},focusHorizontally:function(h,i){return h<i;},convertVectorFromCenterToCSS:function(h,i,j){var k=g.focusHorizontally(i,j),l;if(k){l=h.x/100;}else l=h.x/100;var m=g.convertFromCenterToCSS(l,g.getVisible(i,j));if(k){return {x:m,y:0};}else return {x:0,y:m};},getCropRect:function(h,i,j){var k=g.focusHorizontally(i,j),l=g.getVisible(i,j);if(k){var m=(1-l)*h.x;return {left:m,top:0,width:l,height:1};}else{var n=(1-l)*h.y;return {left:0,top:n,width:1,height:l};}}};e.exports=g;},null);
__d("Pixelz.react",["arrayContains","cx","loadImage","joinClasses","React","PhotoResizeMath","PixelzFocus"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){b.__markCompiled&&b.__markCompiled();'use strict';var n=k,o=n.PropTypes,p=k.createClass({displayName:"Pixelz",propTypes:{width:o.number,height:o.number,resizeMode:o.oneOf(['contain','cover','stretch']),alt:o.string,letterbox:o.bool,borderRadius:o.number,insetBorderColor:o.string,animated:o.bool,upscale:o.bool,cropRect:function(q,r,s){var t=q[r],u='Invalid prop `'+r+'` supplied to `'+s+'`, expected a rectangle with values normalized '+'between 0 and 1.';if(t.left<0||t.top<0||t.width<0||t.height<0||t.left+t.width>1||t.top+t.height>1)return new Error(u);},focus:function(q,r,s){var t=q[r],u='Invalid prop `'+r+'` supplied to `'+s+'`, expected either a {x, y, type} vector where type '+'is `css` or `center` or an array of {x, y} vectors. All the vectors '+'have with values normalized between 0 and 1.';if(Array.isArray(t)){for(var v=0;v<t.length;++v)if(!(t[v].x>=0&&t[v].x<=1)||!(t[v].y>=0&&t[v].y<=1))return new Error(u);}else{if(!t.type)t.type='css';if(!(t.x>=0&&t.x<=1)||!(t.y>=0&&t.y<=1)||!g(['center','css'],t.type))return new Error(u);}}},getDefaultProps:function(){return {resizeMode:'cover',alt:'',letterbox:true,upscale:true,cropRect:{width:1,height:1,top:0,left:0},focus:{x:.5,y:.5,type:'css'}};},getInitialState:function(){return {srcDimensions:{}};},getSrcDimensions:function(){var q=this.props.src,r=this.state.srcDimensions[q];if(r)return r;i(q,function(s,t){var u={};u[q]={width:s,height:t};this.isMounted()&&this.setState({srcDimensions:u});}.bind(this));return null;},getCropSrcDimensions:function(){var q=this.getSrcDimensions();return {width:q.width*this.props.cropRect.width,height:q.height*this.props.cropRect.height};},getUpscaleCropDimensions:function(){var q=this.getCropSrcDimensions();return l.getScaledPhotoDimensions(q.width,q.height,this.props.width,this.props.height,this.props.resizeMode);},getCropDimensions:function(){var q=this.getUpscaleCropDimensions(),r=this.getCropSrcDimensions();if(!this.props.upscale)return {width:Math.min(q.width,r.width),height:Math.min(q.height,r.height)};return q;},getCropAspectRatio:function(){var q=this.getCropDimensions();return q.width/q.height;},getContainerDimensions:function(){if(this.props.letterbox&&this.props.width&&this.props.height)return {width:this.props.width,height:this.props.height};return this.getCropDimensions();},getContainerAspectRatio:function(){var q=this.getContainerDimensions();return q.width/q.height;},getContainerPosition:function(){return {left:0,top:0};},getFocus:function(){var q=this.props.focus;if(!Array.isArray(q)&&q.type==='css')return {x:q.x,y:q.y};var r=this.getContainerAspectRatio(),s=this.getCropAspectRatio(),t=m.getVisible(r,s),u=m.focusHorizontally(r,s),v;if(!Array.isArray(q)){v=m.convertFromCenterToCSS(u?q.x:q.y,t);}else{var w=q.map(function(z){return u?z.x:z.y;});w.sort();var x=m.findBiggestSets(w,t),y=m.getBestSet(w,x,t);v=m.getFocusFromSet(w,y);}return {x:u?v:.5,y:u?.5:v};},getCropPosition:function(){var q=this.getCropDimensions(),r=this.getContainerDimensions(),s=this.getFocus();return {left:s.x*(r.width-q.width),top:s.y*(r.height-q.height)};},getScaleDimensions:function(){var q=this.getCropDimensions();return {width:q.width/this.props.cropRect.width,height:q.height/this.props.cropRect.height};},getScalePosition:function(){var q=this.getScaleDimensions();return {left:-q.width*this.props.cropRect.left,top:-q.height*this.props.cropRect.top};},getClipCropRectangle:function(){var q=this.getContainerDimensions(),r=this.getCropDimensions(),s=this.getContainerPosition(),t=this.getCropPosition(),u=Math.max(s.left,t.left),v=Math.max(s.top,t.top),w=Math.min(s.top+q.height,t.top+r.height),x=Math.min(s.left+q.width,t.left+r.width);return {left:u,top:v,width:x-u,height:w-v};},getClipCropPosition:function(){var q=this.getClipCropRectangle();return {left:q.left,top:q.top};},getClipCropDimensions:function(){var q=this.getClipCropRectangle();return {width:q.width,height:q.height};},getClipScalePosition:function(){var q=this.getScalePosition(),r=this.getClipCropPosition(),s=this.getCropPosition();return {left:q.left+(s.left-r.left),top:q.top+(s.top-r.top)};},getClipScaleDimensions:function(){return this.getScaleDimensions();},areDimensionsEqual:function(q,r){return q.width===r.width&&q.height===r.height;},shouldAddAllNodesAndStyles:function(){return this.props.animated;},hasCrop:function(){if(this.shouldAddAllNodesAndStyles())return true;var q=this.getContainerDimensions(),r=this.getClipCropDimensions(),s=this.getClipScaleDimensions();if(this.areDimensionsEqual(q,r)||this.areDimensionsEqual(r,s))return false;return true;},hasContainer:function(){if(this.shouldAddAllNodesAndStyles()||this.hasInsetBorder())return true;var q=this.getContainerDimensions(),r=this.getClipScaleDimensions();if(this.areDimensionsEqual(q,r))return false;return true;},hasInsetBorder:function(){return this.shouldAddAllNodesAndStyles()||this.props.insetBorderColor;},applyPositionStyle:function(q,r){if(this.shouldAddAllNodesAndStyles()||r.left)q.left=Math.round(r.left);if(this.shouldAddAllNodesAndStyles()||r.top)q.top=Math.round(r.top);},applyDimensionsStyle:function(q,r){q.width=Math.round(r.width);q.height=Math.round(r.height);},applyBorderRadiusStyle:function(q){if(this.shouldAddAllNodesAndStyles()||this.props.borderRadius)q.borderRadius=this.props.borderRadius||0;},getScaleStyle:function(){var q={},r=this.getClipCropDimensions(),s=this.getClipScaleDimensions();if(this.shouldAddAllNodesAndStyles()||!this.areDimensionsEqual(r,s)){this.applyPositionStyle(q,this.getClipScalePosition());}else this.applyPositionStyle(q,this.getClipCropPosition());this.applyDimensionsStyle(q,this.getClipScaleDimensions());this.applyBorderRadiusStyle(q);return q;},getCropStyle:function(){var q={};this.applyPositionStyle(q,this.getClipCropPosition());this.applyDimensionsStyle(q,this.getClipCropDimensions());this.applyBorderRadiusStyle(q);return q;},getInsetBorderStyle:function(){var q={borderColor:this.props.insetBorderColor||'transparent'};this.applyPositionStyle(q,this.getClipCropPosition());this.applyDimensionsStyle(q,this.getClipCropDimensions());this.applyBorderRadiusStyle(q);return q;},getContainerStyle:function(){var q={};this.applyDimensionsStyle(q,this.getContainerDimensions());this.applyBorderRadiusStyle(q);return q;},getScale:function(){var q=this.getScaleStyle(),r=q.width,s=q.height;q=Object.assign({},q);delete q.width;delete q.height;return (k.createElement("img",k.__spread({},this.props,{alt:this.props.alt,className:j(this.props.className,(("_56wb")+(this.shouldAddAllNodesAndStyles()?' '+"_56t5":''))),src:this.props.src,style:Object.assign({},(this.props.style||{}),q),width:r,height:s})));},getCrop:function(){var q=this.getScale();if(!this.hasCrop())return q;return (k.createElement("div",{className:(("_56ma")+(this.shouldAddAllNodesAndStyles()?' '+"_56t5":'')),style:this.getCropStyle()},q));},getInsetBorder:function(){if(!this.hasInsetBorder())return null;return (k.createElement("div",{className:(("_56lv")+(this.shouldAddAllNodesAndStyles()?' '+"_56t5":'')),style:this.getInsetBorderStyle()}));},getContainer:function(){var q=this.getCrop();if(!this.hasContainer())return q;var r=this.getInsetBorder();return (k.createElement("div",{className:(("_56jj")+(this.shouldAddAllNodesAndStyles()?' '+"_56t5":'')),style:this.getContainerStyle()},q,r));},render:function(){var q=this.getSrcDimensions();if(!q)return k.createElement("span",null);return this.getContainer();}});e.exports=p;},null);
__d("MercuryFileUploader",["ArbiterMixin","CSS","Dialog","DOM","Event","FileForm","FileFormResetOnSubmit","FileInput","FormSubmitOnChange","MercuryAttachment","MercuryAttachmentTemplates","MercuryConstants","PhotosUploadID","SubscriptionsHandler","csx","fbt","getObjectValues","mixin","shield"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y){b.__markCompiled&&b.__markCompiled();var z=x(g);for(var aa in z)if(z.hasOwnProperty(aa))ca[aa]=z[aa];var ba=z===null?null:z.prototype;ca.prototype=Object.create(ba);ca.prototype.constructor=ca;ca.__superConstructor__=z;function ca(ea,fa,ga,ha){"use strict";z.call(this);this.$MercuryFileUploader0=ea;this.$MercuryFileUploader1={};this.$MercuryFileUploader2={};this.$MercuryFileUploader3={};this.$MercuryFileUploader4={};this.$MercuryFileUploader5={};this.$MercuryFileUploader6={};this.$MercuryFileUploader7={};this.$MercuryFileUploader8={};this.$MercuryFileUploader9={};this.updateElements(fa,ga,ha);}ca.prototype.updateElements=function(ea,fa,ga){"use strict";this.$MercuryFileUploadera&&this.$MercuryFileUploadera.release();this.$MercuryFileUploadera=new t();this.$MercuryFileUploaderb&&this.$MercuryFileUploaderb.destroy();this.$MercuryFileUploaderb=new l(ea,[o,m]);this.$MercuryFileUploaderb.setAllowCrossOrigin(true);this.$MercuryFileUploaderb.setUploadInParallel(true);var ha=j.find(ea,"._4q60"),ia=j.find(ha,"._4q61");new n(ha,ia,fa);this.$MercuryFileUploadera.addSubscriptions(this.$MercuryFileUploaderb.subscribe('submit',function(){var ja={count:0,file_sizes:[]};if(fa.files){for(var ka=0;ka<fa.files.length;ka++)if(fa.files[ka].size>r.AttachmentMaxSize){this.showAttachmentSizeErrorDialog();return false;}var la={};for(var ma=0;ma<fa.files.length;ma++){var na=this.$MercuryFileUploaderc();this.$MercuryFileUploaderd(na,fa.files[ma].name);ja.count++;ja.file_sizes.push(fa.files[ma].size);la[na]=fa.files[ma];}this.$MercuryFileUploaderb.setFiles(la);}else{ga.value=this.$MercuryFileUploaderc();this.$MercuryFileUploaderd(ga.value,fa.value);ja.count=1;}this.inform('submit',ja);}.bind(this)),this.$MercuryFileUploaderb.subscribe('success',this.$MercuryFileUploadere.bind(this)),this.$MercuryFileUploaderb.subscribe('failure',this.$MercuryFileUploaderf.bind(this)),k.listen(ia,'click',y(this.inform,this,'open')));};ca.prototype.showAttachmentSizeErrorDialog=function(){"use strict";this.$MercuryFileUploaderb.abort();this.$MercuryFileUploaderb.clear();new i().setTitle(v._("The file you have selected is too large")).setBody(v._("The file you have selected is too large. The maximum size is 25MB.")).setButtons(i.OK).setSemiModal(true).show();};ca.prototype.addDroppedFiles=function(ea){"use strict";if(!this.$MercuryFileUploaderb||!this.$MercuryFileUploaderb.canUseXHR())return;var fa={},ga={count:0,file_sizes:[]};for(var ha=0;ha<ea.length;ha++){var ia=ea[ha];if(ia.size>r.AttachmentMaxSize){this.showAttachmentSizeErrorDialog();return false;}var ja=this.$MercuryFileUploaderc();this.$MercuryFileUploaderd(ja,ia.name);fa[ja]=ia;ga.file_sizes.push(ia.size);ga.count++;}this.$MercuryFileUploaderb.setFiles(fa);this.$MercuryFileUploaderb.forceSendViaXHR();this.inform('submit',ga);};ca.prototype.isUploading=function(){"use strict";return !!Object.keys(this.$MercuryFileUploader7).length;};ca.prototype.addCachedAttachments=function(ea){"use strict";ea.forEach(function(fa){var ga=this.$MercuryFileUploaderc();this.$MercuryFileUploaderd(ga,fa.filename);this.$MercuryFileUploaderg(ga,fa);}.bind(this));};ca.prototype.addCachedImageFiles=function(ea){"use strict";var fa=v._("Photo");ea.forEach(function(ga){var ha=this.$MercuryFileUploaderc();this.$MercuryFileUploaderd(ha,fa);this.$MercuryFileUploaderg(ha,{filename:ga,image_id:ga,filetype:'image/jpeg'});}.bind(this));};ca.prototype.getAttachments=function(){"use strict";return w(this.$MercuryFileUploader1);};ca.prototype.getImageFiles=function(){"use strict";var ea=Object.keys(this.$MercuryFileUploader2).sort(),fa=[];ea.forEach(function(ga){return fa.push(this.$MercuryFileUploader2[ga]);}.bind(this));return fa;};ca.prototype.getAnimatedImageFiles=function(){"use strict";return w(this.$MercuryFileUploader3);};ca.prototype.getVideoFiles=function(){"use strict";return w(this.$MercuryFileUploader4);};ca.prototype.getAudioFiles=function(){"use strict";return w(this.$MercuryFileUploader5);};ca.prototype.getFiles=function(){"use strict";return w(this.$MercuryFileUploader6);};ca.prototype.removeAttachments=function(){"use strict";if(this.$MercuryFileUploader0)j.empty(this.$MercuryFileUploader0);this.$MercuryFileUploader1={};this.$MercuryFileUploader2={};this.$MercuryFileUploader3={};this.$MercuryFileUploader4={};this.$MercuryFileUploader5={};this.$MercuryFileUploader6={};this.$MercuryFileUploader8={};this.$MercuryFileUploader7={};this.$MercuryFileUploader9={};if(this.$MercuryFileUploader0)h.hide(this.$MercuryFileUploader0);this.inform('dom-updated');};ca.prototype.destroy=function(){"use strict";this.$MercuryFileUploadera&&this.$MercuryFileUploadera.release();this.$MercuryFileUploaderb&&this.$MercuryFileUploaderb.destroy();this.removeAttachments();};ca.prototype.$MercuryFileUploaderd=function(ea,fa){"use strict";var ga=q[':fb:mercury:upload-file-row'].build();this.$MercuryFileUploader8[ea]=ga;this.$MercuryFileUploader7[ea]=true;this.$MercuryFileUploader9[ea]=Date.now();j.appendContent(ga.getNode('iconText'),da(fa));k.listen(ga.getNode('closeFileUpload'),'click',this.$MercuryFileUploaderh.bind(this,ea));if(this.$MercuryFileUploader0){j.appendContent(this.$MercuryFileUploader0,ga.getRoot());h.show(this.$MercuryFileUploader0);}this.inform('dom-updated');};ca.prototype.$MercuryFileUploaderh=function(ea,event){"use strict";if(this.$MercuryFileUploader7[ea]){this.inform('upload-canceled-during-upload');}else if(this.$MercuryFileUploader1[ea]||this.$MercuryFileUploader2[ea]||this.$MercuryFileUploader3[ea]||this.$MercuryFileUploader4[ea]||this.$MercuryFileUploader5[ea]||this.$MercuryFileUploader6[ea])this.inform('upload-canceled-after-uploaded');delete this.$MercuryFileUploader1[ea];delete this.$MercuryFileUploader2[ea];delete this.$MercuryFileUploader3[ea];delete this.$MercuryFileUploader4[ea];delete this.$MercuryFileUploader5[ea];delete this.$MercuryFileUploader6[ea];delete this.$MercuryFileUploader7[ea];delete this.$MercuryFileUploader9[ea];var fa=this.$MercuryFileUploader8[ea];delete this.$MercuryFileUploader8[ea];if(fa){j.remove(fa.getRoot());this.inform('dom-updated');}this.inform('upload-canceled');return false;};ca.prototype.$MercuryFileUploaderi=function(ea,fa){"use strict";var ga=this.$MercuryFileUploader8[ea],ha=p.getAttachIconClassByMime(fa);h.addClass(ga.getNode('iconText'),ha);h.addClass(ga.getRoot(),'done');};ca.prototype.$MercuryFileUploaderg=function(ea,fa){"use strict";if(this.$MercuryFileUploader7[ea]){delete this.$MercuryFileUploader7[ea];if(fa.image_id){this.$MercuryFileUploader2[ea]=fa.image_id;}else if(fa.gif_id){this.$MercuryFileUploader3[ea]=fa.gif_id;}else if(fa.video_id){this.$MercuryFileUploader4[ea]=fa.video_id;}else if(fa.audio_id){this.$MercuryFileUploader5[ea]=fa.audio_id;}else if(fa.file_id){this.$MercuryFileUploader6[ea]=fa.file_id;}else this.$MercuryFileUploader1[ea]=fa;this.$MercuryFileUploaderi(ea,fa.filetype);this.inform('one-upload-completed',{upload_time_ms:Date.now()-this.$MercuryFileUploader9[ea]});}if(!this.isUploading())this.inform('all-uploads-completed',{count:this.getAttachments().length});};ca.prototype.$MercuryFileUploadere=function(event,ea){"use strict";var fa=ea.response.getPayload();this.$MercuryFileUploaderg(this.$MercuryFileUploaderj(ea),fa.metadata[0]);};ca.prototype.$MercuryFileUploaderf=function(event,ea){"use strict";this.inform('one-upload-failed');this.$MercuryFileUploaderh(this.$MercuryFileUploaderj(ea),event);};ca.prototype.$MercuryFileUploaderc=function(){"use strict";return 'upload_'+s.getNewID();};ca.prototype.$MercuryFileUploaderj=function(ea){"use strict";var fa=ea.response.getPayload();if(ea.upload){return ea.upload.getName();}else return fa.uploadID;};function da(ea){if(ea&&ea.startsWith('C:\\fakepath\\'))return ea.substring(12);return ea;}e.exports=ca;},null);
__d("VaultEditableGrid",["Event","Arbiter","AsyncRequest","CSS","DOM","Scroll","$","csx","ge","removeFromArray"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){b.__markCompiled&&b.__markCompiled();var q={};function r(s,t,u,v){q[s.id]=this;this._grid=s;this._gridID=s.id;this._dialogEndpoint=t;this._collapseWhenEmpty=u;this._attachmentCount=v;this._selectedVaultImageIDs=[];h.subscribe('multi-upload/image-removed/'+this._gridID,function(w,x){p(this._selectedVaultImageIDs,x);this.updateAttachmentCount(this._attachmentCount-1);}.bind(this));h.subscribe('multi-upload/composer-reset/'+this._gridID,function(w,x){this.removeImages();}.bind(this));h.subscribe(['multi-upload/images-upload-start/'+this._gridID,'multi-upload/video-added/'+this._gridID],function(){this.updateAttachmentCount(this._attachmentCount+1);}.bind(this));h.inform('fbVaultEditableGrid/created/'+s.id,this,h.BEHAVIOR_PERSISTENT);h.subscribe('multi-upload/images-upload-start/'+this._gridID,this._scrollToRight.bind(this));this.updateAttachmentCount(this._attachmentCount);}Object.assign(r,{VAULT_IMAGE:'vault_image',getInstance:function(s){return q[s];},registerDialogWithGrid:function(s,t,u){h.subscribe(['multi-upload/images-upload-start/'+s,'multi-upload/video-added/'+s],u.hide.bind(u));h.subscribe('fbVaultEditableGrid/created/'+s,function(v,w){w._registerDialogWithGrid(t,u);});},onImagesSelected:function(s,t,u){q[s]._onImagesSelected(t,u);}});Object.assign(r.prototype,{getRoot:function(){var s=o(this._gridID);if(s){return s;}else return this._grid;},_registerDialogWithGrid:function(s,t){this._dialog=t;var u=this.getMoreLink();u&&g.listen(u,'click',function(){t.show();return false;});t.subscribe('aftershow',function(){var v=[];k.scry(m(this._gridID),'input[type="hidden"]').forEach(function(x){if(x.name.match('composer_vault_images')||x.name.match('composer_unpublished_photo'))v.push(x.value);});var w=s.getGrid();w.bulkChange(function(){var x=w.getSelectionSet();x.clear();x.addAll(v);});}.bind(this));},updateAttachmentCount:function(s){this._attachmentCount=s;if(this._collapseWhenEmpty)j.conditionShow(this._grid,this._attachmentCount>0);},getID:function(){return this._gridID;},_onImagesSelected:function(s,t){var u=k.find(this.getRoot(),"._577");this.removeImages();this._selectedVaultImageIDs=t;s.forEach(function(v){k.insertBefore(u,v);});h.inform('multi-upload/images-added/'+this._gridID,{fbids:t});this._scrollToRight();},removeImages:function(){k.scry(this.getRoot(),'.fbVaultGridItem').forEach(function(s){if(!j.hasClass(s,'fbVaultEditableGridMoreLink'))k.remove(s);});this._selectedVaultImageIDs=[];h.inform('multi-upload/all-images-removed/'+this._gridID);this.updateAttachmentCount(0);},_scrollToRight:function(){var s=this.getRoot(),t=k.find(s,'.fbScrollableAreaWrap');l.setLeft(t,Math.max(0,k.find(s,'.fbScrollableAreaBody').offsetWidth-t.offsetWidth));},showDialog:function(s,t){if(this._dialog){this._dialog.show();}else i.bootstrap(this._dialogEndpoint,s);},getMoreLink:function(){return k.scry(this.getRoot(),'.fbVaultEditableGridMoreLink')[0];}});e.exports=r;},null);
__d("BasePhotoUploader",["Arbiter","ArbiterMixin","CSS","DOM","PhotosMultiUploadInput","VaultEditableGrid","TimelineMapScrollableArea","mixin","getObjectValues"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){b.__markCompiled&&b.__markCompiled();var p=n(h);for(var q in p)if(p.hasOwnProperty(q))s[q]=p[q];var r=p===null?null:p.prototype;s.prototype=Object.create(r);s.prototype.constructor=s;s.__superConstructor__=p;function s(t,u){"use strict";p.call(this);new m(t,{verticalscroll:true});this.$BasePhotoUploader0=t;this.$BasePhotoUploader1=this.$BasePhotoUploader2();this.$BasePhotoUploader3=false;this.$BasePhotoUploader4=null;u.addSubscriptions(g.subscribe('multi-upload/images-added/'+this.$BasePhotoUploader0.id,function(v,w){var x=Object.assign({},w.fbids);Object.assign(this.$BasePhotoUploader1,x);this.$BasePhotoUploader5();this.inform('upload-completed',{fbids:o(x)});}.bind(this)),g.subscribe('multi-upload/image-removed/'+this.$BasePhotoUploader0.id,function(v,w){for(var x in this.$BasePhotoUploader1)if(this.$BasePhotoUploader1[x]===w){delete this.$BasePhotoUploader1[x];break;}this.$BasePhotoUploader5();}.bind(this)),g.subscribe('multi-upload/images-upload-start/'+this.$BasePhotoUploader0.id,function(v,w){i.show(this.$BasePhotoUploader0);this.$BasePhotoUploader3=true;this.inform('dom-updated');this.inform('upload-started',w);}.bind(this)),g.subscribe('multi-upload/composer-reset/'+this.$BasePhotoUploader0.id,this.clear.bind(this)),g.subscribe('multi-upload/all-images-removed/'+this.$BasePhotoUploader0.id,this.$BasePhotoUploader6.bind(this)),g.subscribe('multi-upload/images-upload-completed/'+this.$BasePhotoUploader0.id,function(v){this.$BasePhotoUploader3=false;this.inform('all-uploads-completed');this.$BasePhotoUploader5();}.bind(this)));i.conditionShow(this.$BasePhotoUploader0,Object.keys(this.$BasePhotoUploader1).length);}s.prototype.getSelectedFBIDs=function(){"use strict";var t=Object.keys(this.$BasePhotoUploader1).sort();return t.map(function(u){return this.$BasePhotoUploader1[u];}.bind(this));};s.prototype.isUploading=function(){"use strict";return this.$BasePhotoUploader3;};s.prototype.clear=function(){"use strict";var t=l.getInstance(this.$BasePhotoUploader0.id);t&&t.removeImages();};s.prototype.getWaterfallID=function(){"use strict";return k.getWaterfallID(this.$BasePhotoUploader0.id);};s.prototype.$BasePhotoUploader6=function(){"use strict";this.$BasePhotoUploader1={};this.$BasePhotoUploader3=false;i.hide(this.$BasePhotoUploader0);this.inform('all-uploads-completed');this.inform('dom-updated');};s.prototype.$BasePhotoUploader2=function(){"use strict";var t={},u=-10000;j.scry(this.$BasePhotoUploader0,'input[type="hidden"]').forEach(function(v){if(v.name.match('composer_vault_images')){t[u]=v.value;u--;}});return t;};s.prototype.$BasePhotoUploader5=function(){"use strict";i.conditionShow(this.$BasePhotoUploader0,Object.keys(this.$BasePhotoUploader1).length>0);this.inform('dom-updated');};s.prototype.setCurrentMethod=function(t){"use strict";this.$BasePhotoUploader4=t;};s.prototype.getCurrentMethod=function(){"use strict";return this.$BasePhotoUploader4;};e.exports=s;},null);
__d("MercuryPhotoUploader",["Arbiter","AsyncRequest","DOM","FileInput","Parent","PhotosMultiUploadInput","PUWMethods","VaultEditableGrid","Focus","csx","cx","Event","BasePhotoUploader"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){b.__markCompiled&&b.__markCompiled();for(var t in s)if(s.hasOwnProperty(t))v[t]=s[t];var u=s===null?null:s.prototype;v.prototype=Object.create(u);v.prototype.constructor=v;v.__superConstructor__=s;function v(w,x,y,z){"use strict";s.call(this,w,y);this.$MercuryPhotoUploader0=w.id;this.$MercuryPhotoUploader1=false;g.subscribe('PhotosMultiUploadInput/loaded/'+w.id,function(){this.$MercuryPhotoUploader1=true;}.bind(this));g.subscribe('MercuryPhotoUploader/initUploadButton/'+w.id,function(){var aa=i.scry(x,'input[type="file"]')[0];if(!aa)aa=i.create('input',{accept:'image/*',type:'file',className:"_n",name:'composer_unpublished_photo[]',multiple:1});var ba=k.byClass(x,"_9_h"),ca=new j(ba,i.find(ba,"._214"),aa);ca.subscribe('change',l.doFileUpload.bind(null,w.id,ca));});g.subscribe('MercuryPhotoUploader/registerPhotoMenu/'+w.id,function(aa,ba){var ca=ba.menu.getRoot();ba.menu.setContext(x);var da=i.scry(ca,"._d2p"),ea=da&&da[0];ea&&r.listen(ea,'click',function(){n.getInstance(w.id).showDialog(ea,n.VAULT_IMAGE);this.setCurrentMethod(m.VAULT);this.inform('selection-start',{method:m.VAULT});}.bind(this));r.listen(x,'click',function(){if(!this.$MercuryPhotoUploader1)return;if(!ba.menu.isShown()){var ga=i.scry(ba.menu.getContentRoot(),'li');this.inform('menu-show');ba.menu.show();if(ga)o.setWithoutOutline(ga[0]);}else{this.inform('menu-hide');ba.menu.hide();}}.bind(this));r.listen(document.documentElement,'click',function(event){if(!i.contains(x,event.getTarget())&&!i.contains(ea,event.getTarget())){if(ba.menu.isShown())this.inform('menu-hide');ba.menu.hide();}}.bind(this));var fa=i.find(ca,"._9_h");r.listen(fa,'click',function(){this.setCurrentMethod(m.FILE_SELECTOR);this.inform('selection-start',{method:m.FILE_SELECTOR});}.bind(this));}.bind(this));z&&l.initDragDrop(w.id,z);}v.prototype.uploadPastedFile=function(w){"use strict";l.onFilesDrop(this.$MercuryPhotoUploader0,[w]);};v.prototype.addCachedPhotos=function(w){"use strict";h.post('/ajax/vault/selected.php',{max_select:10,grid_id:this.$MercuryPhotoUploader0,source:'messenger',image_ids:w});};Object.assign(v,{initUploadButton:function(w){g.inform('MercuryPhotoUploader/initUploadButton/'+w,{},g.BEHAVIOR_PERSISTENT);},registerPhotoMenu:function(w,x){g.inform('MercuryPhotoUploader/registerPhotoMenu/'+w,{menu:x},g.BEHAVIOR_PERSISTENT);}});e.exports=v;},null);
__d("MercuryShareLinkUploader",["ArbiterMixin","AsyncRequest","CSS","DOM","Event","Form","URLScraper","WebMessengerEvents","mixin","isEmpty"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){b.__markCompiled&&b.__markCompiled();var q=o(g);for(var r in q)if(q.hasOwnProperty(r))t[r]=q[r];var s=q===null?null:q.prototype;t.prototype=Object.create(s);t.prototype.constructor=t;t.__superConstructor__=q;function t(){"use strict";q.call(this);this.__initialize.apply(this,arguments);}t.prototype.__initialize=function(u,v,w,x,y){"use strict";this.$MercuryShareLinkUploader0=u;this.$MercuryShareLinkUploader1=v;this.$MercuryShareLinkUploader2=w;this.$MercuryShareLinkUploader3=y;this.$MercuryShareLinkUploader4=false;this.$MercuryShareLinkUploader5=null;this.$MercuryShareLinkUploader6=null;k.listen(x,'click',this.close.bind(this));k.listen(y,'keyup',function(){!y.value.length&&this.$MercuryShareLinkUploader7.enable();}.bind(this));this.$MercuryShareLinkUploader7=new m(y);this.$MercuryShareLinkUploader7.subscribe('match',function(z,aa){this.loadShare(aa&&aa.url);}.bind(this));};t.prototype.getAttachData=function(){"use strict";return this.loadAttachData(this.$MercuryShareLinkUploader4,this.$MercuryShareLinkUploader0,this.$MercuryShareLinkUploader3);};t.prototype.getShareDataFromStage=function(u,v){"use strict";var w=l.serialize(v),x=w.attachment&&w.attachment.params;if(!x)return null;if(x instanceof Object){var y=[];y.push(x[0]);y.push(x[1]);x=y;}return {params:x,type:w.attachment.type};};t.prototype.loadAttachData=function(u,v,w,x){"use strict";if(u){var y=l.serialize(v),z=y.attachment&&y.attachment.params,aa=y.link_metrics?y.link_metrics.no_image:true;if(!z||p(z))return null;var ba=x?x():w.value;if(ba.indexOf(z.url)===-1)return y;if(!z.summary&&!z.favicon&&aa&&z.title&&z.url&&z.url.substr(0,z.title.length)===z.title)return null;return y;}return null;};t.prototype.check=function(){"use strict";this.$MercuryShareLinkUploader7.check();};t.prototype.close=function(){"use strict";this.$MercuryShareLinkUploader8();this.$MercuryShareLinkUploader7.disable();this.inform('closed');};t.prototype.clear=function(){"use strict";this.$MercuryShareLinkUploader8();this.$MercuryShareLinkUploader7.enable();};t.prototype.enable=function(){"use strict";this.$MercuryShareLinkUploader7.enable();};t.prototype.disable=function(){"use strict";this.$MercuryShareLinkUploader7.disable();};t.prototype.loadShare=function(u){"use strict";this.$MercuryShareLinkUploader5=u;this.$MercuryShareLinkUploader6&&this.$MercuryShareLinkUploader6.abort();this.$MercuryShareLinkUploader6=new h().setMethod('POST').setURI('/ajax/share_scrape.php').setData({u:u}).setHandler(this.$MercuryShareLinkUploader9.bind(this).bind(null,u)).setStatusElement(this.$MercuryShareLinkUploader2);this.$MercuryShareLinkUploader6.send();this.inform('link-detected');};t.prototype.$MercuryShareLinkUploader9=function(u,v){"use strict";if(this.$MercuryShareLinkUploader5!==u)return;this.$MercuryShareLinkUploader5=null;this.$MercuryShareLinkUploader6=null;i.show(this.$MercuryShareLinkUploader0);j.empty(this.$MercuryShareLinkUploader1);j.setContent(this.$MercuryShareLinkUploader1,v.payload);this.$MercuryShareLinkUploader4=true;if(!this.getAttachData()){this.close();return;}n.detailDOMChanged();};t.prototype.$MercuryShareLinkUploader8=function(){"use strict";i.hide(this.$MercuryShareLinkUploader0);this.$MercuryShareLinkUploader4=false;this.$MercuryShareLinkUploader5=null;this.$MercuryShareLinkUploader6&&this.$MercuryShareLinkUploader6.abort();this.$MercuryShareLinkUploader6=null;this.$MercuryShareLinkUploader7.reset();n.detailDOMChanged();};e.exports=t;},null);
__d("MessengerHotLikePreview.react",["Animation","HotLikeSound","MessengerHotLikePreviewEvents","MessengerHotLikeUtils","React","StickerConstants","SubscriptionsHandler","cx"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){b.__markCompiled&&b.__markCompiled();'use strict';var o=k,p=o.PropTypes,q=k.createClass({displayName:"MessengerHotLikePreview",propTypes:{since:p.number},componentDidMount:function(){this._subscriptions=new m();this._subscriptions.addSubscriptions(i.addListener(i.STOP,this._snapToStickerSize),i.addListener(i.POP,this._pop));h.start();this._growthAnimation=new g(k.findDOMNode(this)).to('width',80).to('height',80).duration(3000).go();this._setUpRotationAnimation();},componentWillUnmount:function(){this._subscriptions&&this._subscriptions.release();},render:function(){return (k.createElement("div",{className:"_4a9g _576q"}));},_setUpRotationAnimation:function(){this._rotateAnimation=new g(k.findDOMNode(this));this._rotateHotLike(-2,2,150,1000);this._rotateHotLike(-4,4,100,1000);this._rotateHotLike(-10,10,75,1000);this._rotateAnimation.go();},_rotateHotLike:function(r,s,t,u){var v=Math.floor(u/t),w=null;for(var x=0;x<v;x++){w=x%2?r:s;this._rotateAnimation.to('rotateZ',w).duration(t).checkpoint();}},_snapToStickerSize:function(r){if(this._snapped)return;this._snapped=true;var s=Date.now()-this.props.since,t=j.getStickerIDForTime(s);if(t){h.snap(t);var u=j.getMetadataForHotLike(t);this._rotateAnimation.stop();var v=30,w=-10;if(t===l.HOT_LIKE_SMALL_STICKER_ID){v=0;w=0;}this._growthAnimation.stop().to('width',u.width*1.2).to('height',u.height*1.2).to('rotateZ',v).duration(100).checkpoint().to('width',u.width*.9).to('height',u.height*.9).to('rotateZ',w).duration(100).checkpoint().to('width',u.width).to('height',u.height).to('rotateZ',0).duration(100).ondone(function(){i.emit(i.FINISH_ANIMATION,r,t);}).go();}},_pop:function(r){h.pop();this._growthAnimation.stop().to('width',0).to('height',0).duration(100).ondone(function(){i.emit(i.REMOVE,r);}).go();}});e.exports=q;},null);
__d("MercuryDrafts",["CacheStorage","MercurySingletonMixin","isEmpty"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();function j(k){"use strict";this.$MercuryDrafts0=k;this.$MercuryDrafts1=new g('localstorage','mercury-drafts:'+this.$MercuryDrafts0);}j.prototype.saveDraft=function(k,l){"use strict";if(this.isMessageEmpty(l)){this.removeDraft(k);}else this.$MercuryDrafts1.set(k,this.$MercuryDrafts2(k,l));};j.prototype.removeDraft=function(k){"use strict";this.$MercuryDrafts1.remove(k);};j.prototype.getDraft=function(k){"use strict";var l=this.$MercuryDrafts1.get(k,{});return l.message;};j.prototype.isMessageEmpty=function(k){"use strict";return i(k)||(i(k.body)&&i(k.content_attachment)&&i(k.raw_attachments)&&i(k.photo_fbids)&&i(k.image_ids));};j.prototype.$MercuryDrafts2=function(k,l){"use strict";return {thread_id:k,message:l};};Object.assign(j,h);e.exports=j;},null);
__d("MercuryDraftsController",["Input","MercurySingletonMixin","isEmpty","MercuryDrafts"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();var j=b('MercuryDrafts').get();function k(l){"use strict";this.$MercuryDraftsController0;}k.prototype.clearDraft=function(l){"use strict";if(this.canSaveDrafts(l))j.removeDraft(l);};k.prototype.saveDraft=function(l,m,n,o,p){"use strict";if(!this.canSaveDrafts(l))return;var q={body:g.getValue(m)};if(!i(n.getAttachments())){q.has_attachment=true;q.raw_attachments=n.getAttachments();}if(!i(n.getImageFiles())){q.has_attachment=true;q.image_ids=n.getImageFiles();}if(p&&!i(p.getSelectedFBIDs())){q.has_attachment=true;q.photo_fbids=p.getSelectedFBIDs();}if(o.getAttachData()){q.has_attachment=true;q.content_attachment=o.getAttachData();}j.saveDraft(l,q);};k.prototype.loadDraft=function(l,m,n,o,p){"use strict";if(!this.canSaveDrafts(l)||this.$MercuryDraftsController1(m,n,o,p))return;var q=j.getDraft(l);if(!i(q)){if(q.body){m.focus();g.setValue(m,q.body);}if(!i(q.raw_attachments))n.addCachedAttachments(q.raw_attachments);if(!i(q.image_ids))n.addCachedImageFiles(q.image_ids);if(!i(q.content_attachment))o.loadShare(q.content_attachment.attachment.params.url);if(p&&!i(q.photo_fbids))p.addCachedPhotos(q.photo_fbids);this.clearDraft(l);}};k.prototype.canSaveDrafts=function(l){"use strict";return !!(l);};k.prototype.$MercuryDraftsController1=function(l,m,n,o){"use strict";return !g.isEmpty(l)||!i(m.getAttachments())||!i(m.getImageFiles())||(o&&!i(o.getSelectedFBIDs()))||n.getAttachData();};k.prototype.toString=function(){"use strict";return '[object MercuryDraftsController:'+this.$MercuryDraftsController0+']';};Object.assign(k,h);e.exports=k;},null);
__d("MercuryShareAttachmentSnippet.react",["MercuryShareAttachmentReactShape","MercuryShareStyleMap","React"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();'use strict';var j=i,k=j.PropTypes,l=i.createClass({displayName:"MercuryShareAttachmentSnippet",propTypes:{attachment:g,isSenderViewer:k.bool,senderName:k.string},render:function(){var m=h.getStyleFactory(this.props.attachment);if(m.factory&&!!m.factory.getSnippetComponent){var n=m.factory.getSnippetComponent();return (i.createElement(n,i.__spread({},this.props,{attachment:m.attachment})));}return null;}});e.exports=l;},null);
__d("MercuryAttachmentSnippet.react",["EmoticonsList","Image.react","MercuryAttachment","MercuryAttachmentSnippetRenderer","MercuryAttachmentSnippetType","MercuryAttachmentType","MercuryIDs","P2PMercuryAttachmentSnippet.react","MercuryShareAttachmentSnippet.react","MercuryParticipants","React","StickerConstants","TextWithEmoticons.react","cx","ix","joinClasses"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){b.__markCompiled&&b.__markCompiled();'use strict';var w=q,x=w.PropTypes,y=q.createClass({displayName:"MercuryAttachmentSnippet",propTypes:{thread:x.object.isRequired,viewer:x.string.isRequired},componentWillMount:function(){this._ensureParticipant(this.props.thread.snippet_sender);this._setVariables(this.props);},componentWillReceiveProps:function(ba){this._ensureParticipant(ba.thread.snippet_sender);this._setVariables(ba);},componentWillUnmount:function(){this._cancelParticipantFetch();},render:function(){var ba=this._getSenderName(),ca=j.getAttachmentSnippetType(this._attachments);switch(ca){case k.PHOTO:return this._renderPhotoSnippet(ba);case k.GIF:return this._renderAnimatedImageSnippet(ba);case k.VIDEO:return this._renderVideoSnippet(ba);case k.AUDIO_CLIP:return this._renderAudioClipSnippet(ba);case k.STICKER:return this._renderStickerSnippet(ba);case k.ORION:return this._renderOrionSnippet(ba);case k.SHARE:return this._renderShareSnippet(ba);case k.ERROR:return this._renderError(ba);default:return this._renderMixedSnippet(ba);}},_renderPhotoSnippet:function(ba){return this._renderSnippet(j.renderAttachmentSnippetText(k.PHOTO,this._isViewerSender,ba,this._attachments));},_renderAnimatedImageSnippet:function(ba){return this._renderSnippet(j.renderAttachmentSnippetText(k.GIF,this._isViewerSender,ba,this._attachments));},_renderVideoSnippet:function(ba){return this._renderSnippet(j.renderAttachmentSnippetText(k.VIDEO,this._isViewerSender,ba));},_renderAudioClipSnippet:function(ba){return this._renderSnippet(j.renderAttachmentSnippetText(k.AUDIO_CLIP,this._isViewerSender,ba));},_renderStickerSnippet:function(ba){if(z(this._attachments[0].metadata.stickerID)){return (q.createElement(s,{renderEmoticons:true,text:g.symbols.like}));}else return (q.createElement("span",null,j.renderAttachmentSnippetText(k.STICKER,this._isViewerSender,ba)));},_renderOrionSnippet:function(ba){return (q.createElement("span",null,q.createElement(n,q.__spread({},this._attachments[0].metadata))));},_renderShareSnippet:function(ba){if(!!this._attachments[0].share)return (q.createElement(o,{attachment:this._attachments[0].share,senderName:ba,isViewerSender:this._isViewerSender}));return this._renderSnippet(j.renderAttachmentSnippetText(k.SHARE,this._isViewerSender,ba));},_renderMixedSnippet:function(ba){return (q.createElement("span",null,this._attachments.filter(function(ca){return ca.attach_type===l.FILE||ca.attach_type===l.PHOTO||ca.attach_type===l.VIDEO;}).map(function(ca,da){return this._renderSnippet(ca.name,ca.icon_type,da);}.bind(this))));},_renderSnippet:function(ba,ca,da){var ea=i.getAttachIconClass(ca||this._attachments[0].icon_type),fa=v(ea,"uiIconText _3l6h");return (q.createElement("span",{className:fa,key:da},q.createElement(h,{src:u('/images/messaging/docs/generic.png')}),ba));},_renderError:function(ba){var ca=j.renderAttachmentSnippetText(k.ERROR,this._isViewerSender,ba);return this._renderSnippet(ca);},_setVariables:function(ba){this._viewer=ba.viewer;this._sender=ba.thread.snippet_sender;this._attachments=ba.thread.snippet_attachments;this._isViewerSender=aa(this._sender,this._viewer);},_getSenderName:function(){if(!this._sender||this._isViewerSender)return null;var ba=p.getNow(this._sender);if(!ba)return null;return ba.short_name;},_ensureParticipant:function(ba){if(!ba)return;this._cancelParticipantFetch();if(!p.getNow(ba))this._sub=p.get(ba,function(ca){return this.forceUpdate();}.bind(this));},_cancelParticipantFetch:function(){this._sub&&this._sub.remove();}});function z(ba){return (ba==r.LIKE_STICKER_ID||ba==r.HOT_LIKE_SMALL_STICKER_ID||ba==r.HOT_LIKE_MEDIUM_STICKER_ID||ba==r.HOT_LIKE_LARGE_STICKER_ID);}function aa(ba,ca){return !!(ba&&m.getParticipantIDFromUserID(ca)==ba);}e.exports=y;},null);
__d("MercuryParticipantsImage.react",["MercuryParticipants","React","SplitImage.react","areEqual"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();'use strict';var k=h,l=k.PropTypes,m=h.createClass({displayName:"MercuryParticipantsImage",_bigImageToken:(null),propTypes:{participants:l.array.isRequired,size:l.number},getInitialState:function(){return {participantImages:[]};},componentDidMount:function(){this._getParticipantImages(this.props);},componentWillReceiveProps:function(n){this._getParticipantImages(n);},componentWillUnmount:function(){this._bigImageToken&&this._bigImageToken.remove();},shouldComponentUpdate:function(n,o){return (n.size!==this.props.size||!o||!j(o.participantImages,this.state.participantImages));},render:function(){if(this.state.participantImages.length>0)return (h.createElement(i,{border:true,className:this.props.className,srcs:this.state.participantImages,size:this.props.size}));return null;},_getParticipantImages:function(n){this._bigImageToken&&this._bigImageToken.remove();(this)._bigImageToken=g.getOrderedBigImageMulti(n.participants,function(o){this.isMounted()&&this.setState({participantImages:o});}.bind(this));}});e.exports=m;},null);
__d("MercuryThreadImage.react",["ImmutableObject","MercuryIDs","MercuryParticipantsImage.react","MercuryParticipantsConstants","Pixelz.react","React","areEqual"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){b.__markCompiled&&b.__markCompiled();'use strict';var n=l,o=n.PropTypes,p=l.createClass({displayName:"MercuryThreadImage",propTypes:{thread:o.instanceOf(g).isRequired,viewer:o.string.isRequired,size:o.number,useBackground:o.bool},shouldComponentUpdate:function(q,r){return (q.thread.image_src!==this.props.thread.image_src||!m(q.thread.participants,this.props.thread.participants)||q.size!==this.props.size||q.viewer!==this.props.viewer||q.useBackground!==this.props.useBackground);},render:function(){var q=this.props.size||j.BIG_IMAGE_SIZE,r=this.props.thread.image_src;if(r){if(this.props.useBackground)return (l.createElement("div",{style:{height:q,backgroundImage:("url("+r+")"),backgroundPosition:'50% 50%',backgroundRepeat:'no-repeat',backgroundSize:'cover',width:q}}));return (l.createElement(k,{height:q,resizeMode:'cover',src:r,width:q}));}var s=h.getParticipantIDFromUserID(this.props.viewer),t=this.props.thread.participants.filter(function(v){return v!==s;}),u=[];if(!t.length){u=[s];}else if(t.length==1){u=t;}else u=t.slice(0,3);return (l.createElement(i,{participants:u,size:q}));}});e.exports=p;},null);
__d("MercuryShareAttachment.react",["BootloadedComponent.react","MercuryShareAttachmentReactShape","MercuryShareAttachmentRenderLocations","MercuryShareStyleMap","React","cx","emptyFunction","joinClasses"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){b.__markCompiled&&b.__markCompiled();'use strict';var o=k,p=o.PropTypes,q=k.createClass({displayName:"MercuryShareAttachment",propTypes:{attachment:h,location:p.oneOf(i.getValues()),onComponentLoaded:p.func.isRequired},getDefaultProps:function(){return {onComponentLoaded:m};},componentDidMount:function(){this._handleComponentLoad();},_renderComponent:function(r,s){if(this.props.location===i.MESSENGER)s=n("_52mr _2poz _ui9",s);return !!s?k.createElement("div",{className:s},r):r;},render:function(){var r=j.getStyleFactory(this.props.attachment);if(!r)return null;var s=r,t=s.attachment,u=s.factory;return (this._renderComponent(k.createElement(g,k.__spread({},this.props,{attachment:t,bootloadLoader:u.componentLoader,bootloadPlaceholder:k.createElement("div",null),module:u.componentName,onComponentLoad:this._handleComponentLoad})),u.cx&&u.cx.get(this.props.location)));},_handleComponentLoad:function(){var r=k.findDOMNode(this).children,s=0;for(var t=0;t<r.length;t++)s+=r[t].offsetHeight;this.props.onComponentLoaded(s);}});e.exports=q;},null);
__d("Sticker.react",["Arbiter","React","StickerConfig","StickerConstants","cx","emptyFunction","getElementPosition","getObjectValues","joinClasses"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){b.__markCompiled&&b.__markCompiled();'use strict';var p=h,q=p.PropTypes,r=83,s=5000,t=10,u={CLICK:'click',HOVER:'hover',LOAD_AND_HOVER:'load_and_hover'},v=h.createClass({displayName:"Sticker",propTypes:{animationTrigger:q.oneOf(n(u)),forceCursorPointer:q.bool,frameCount:q.number.isRequired,frameRate:q.number,framesPerCol:q.number.isRequired,framesPerRow:q.number.isRequired,onAttachmentLoad:q.func,onStickerClick:q.func,packID:q.string,sourceURI:q.string.isRequired,sourceWidth:q.number.isRequired,sourceHeight:q.number.isRequired,spriteURI:q.string,stickerID:q.string,subscribedThreadID:q.string,testID:q.string},getInitialState:function(){return {index:0,hasAnimated:false,unsubscribeID:null};},getDefaultProps:function(){return {forceCursorPointer:false,frameRate:r,onStickerClick:l,packID:null};},componentDidMount:function(){this.props.onAttachmentLoad&&this.props.onAttachmentLoad(this.props.sourceHeight);this._stopIntervalID=0;if(this.props.animationTrigger===u.LOAD_AND_HOVER&&this.props.frameCount>1&&this.props.spriteURI)this.startAnimation();if(this.props.subscribedThreadID&&this.props.frameCount>1){var w=g.subscribe(this.props.subscribedThreadID,function(x,y){this.isScrolledIntoView(y.scrollTop,y.viewHeight,y.top);}.bind(this));this.setState({unsubscribeID:w});}},componentWillUnmount:function(){if(this.state.unsubscribeID)g.unsubscribe(this.state.unsubscribeID);if(this.isAnimating())clearInterval(this._stopIntervalID);},isAnimating:function(){return !!this._stopIntervalID;},getWidth:function(){return Math.floor(this.props.sourceWidth);},getHeight:function(){return Math.floor(this.props.sourceHeight);},preloadSprite:function(){var w=new Image();w.onload=function(){if(this.isMounted()&&!this.state.hasAnimated){this.setState({hasAnimated:true});this._stopIntervalID=setInterval(this.incrementFrameIndex,this.props.frameRate);}}.bind(this);if(i.ChatPaddedAnimatedStickerGK&&this.props.paddedSpriteURI){w.src=this.props.paddedSpriteURI;}else w.src=this.props.spriteURI;},isScrolledIntoView:function(w,x,y){var z=m(h.findDOMNode(this)),aa=w+z.y-y,ba=w+x,ca=aa+z.height;if(this.props.frameCount>1&&!this.state.hasAnimated&&ca-t<=ba&&aa+t>=w)this.startAnimation();},startAnimation:function(){if(!this.state.hasAnimated&&this.props.spriteURI){this.preloadSprite();}else if(!this.isAnimating()){this.setState({hasAnimated:true});this._stopIntervalID=setInterval(this.incrementFrameIndex,this.props.frameRate);}},stopAnimation:function(){this.setState({index:0});clearInterval(this._stopIntervalID);this._stopIntervalID=0;},toggleAnimation:function(){if(this.isAnimating()){this.stopAnimation();}else this.startAnimation();},shouldStopAnimating:function(){var w=this.state.index%this.props.frameCount;if(!(w===0&&this.state.index*this.props.frameRate>s))return false;if(this.props.animationTrigger===u.CLICK)return true;return !this.state.isHovered;},incrementFrameIndex:function(){if(this.shouldStopAnimating()){this.stopAnimation();}else this.setState({index:this.state.index+1});},getStyle:function(){var w=0,x=this.props.spriteURI;if(i.ChatPaddedAnimatedStickerGK&&this.props.paddedSpriteURI){x=this.props.paddedSpriteURI;var y=240/Math.min(this.getHeight(),this.getWidth());w=Math.floor(j.SPRITE_PADDING/y);}var z=this.state.index%this.props.frameCount,aa=(z%this.props.framesPerRow)*(this.getWidth()+w*2)+w,ba=Math.floor(z/this.props.framesPerRow)*(this.getHeight()+w*2)+w,ca=(this.props.frameCount>1&&this.props.animationTrigger===u.CLICK)||this._isStickerClickable(this.props.packID),da=this.props.forceCursorPointer||ca?'pointer':'default';if(!this.state.hasAnimated||!this.props.spriteURI){return {backgroundImage:this._isHotLike()?null:'url('+this.props.sourceURI+')',backgroundRepeat:'no-repeat',backgroundSize:this.getWidth()+'px '+this.getHeight()+'px',cursor:da,height:this.getHeight(),width:this.getWidth()};}else return {backgroundImage:'url('+x+')',backgroundPosition:(-aa)+'px '+(-ba)+'px',backgroundSize:(this.getWidth()+w*2)*this.props.framesPerRow+'px '+(this.getHeight()+w*2)*this.props.framesPerCol+'px',cursor:da,height:this.getHeight(),width:this.getWidth()};},_isStickerClickable:function(w){return w&&w!=j.MOBILE_LIKE_STICKER_PACK_ID&&w!=j.GRAVEYARD_PACK_ID;},onStickerClick:function(){if(!this._isStickerClickable(this.props.packID))return;if(this.props.onStickerClick)this.props.onStickerClick(this.props.packID,this.props.stickerID);},mouseLeft:function(){this.setState({isHovered:false});},mouseEntered:function(){this.setState({isHovered:true});if(!this.isAnimating())this.startAnimation();},tabFocusSelected:function(){this.setState({isHovered:true});if(!this.isAnimating())this.startAnimation();},tabFocusUnselected:function(){this.setState({isHovered:false});},render:function(){var w,x;if(this.props.animationTrigger===u.CLICK&&this.props.frameCount>1&&this.props.spriteURI){w=true;}else if((this.props.animationTrigger===u.HOVER||this.props.animationTrigger===u.LOAD_AND_HOVER)&&this.props.frameCount>1&&this.props.spriteURI)x=true;var y=w?this.toggleAnimation:null;if(this.props.packID)y=this.onStickerClick;var z=this.props.className;if(this._isHotLike())z=o(z,"_576q");return (h.createElement("div",{className:z,"data-testid":this.props.testID,tabIndex:"0",style:this.getStyle(),onClick:y,onMouseEnter:x?this.mouseEntered:null,onMouseLeave:x?this.mouseLeft:null,onFocus:this.tabFocusSelected,onBlur:this.tabFocusUnselected}));},_isHotLike:function(){if(!!document.createElementNS&&!!document.createElementNS('http://www.w3.org/2000/svg','svg').createSVGRect)return (this.props.stickerID===j.HOT_LIKE_SMALL_STICKER_ID||this.props.stickerID===j.HOT_LIKE_MEDIUM_STICKER_ID||this.props.stickerID===j.HOT_LIKE_LARGE_STICKER_ID);return false;}});e.exports=v;},null);
__d("StickerUtils",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();var g={getScaledDimensions:function(h,i,j){var k,l,m;if(i>h){m=j/i;k=h*m;l=i*m;}else{m=j/h;k=h*m;l=i*m;}return {height:Math.round(k),width:Math.round(l)};},capitalizeWords:function(h){var i=h.split(" ");for(var j=0;j<i.length;j++){var k=i[j].charAt(0).toUpperCase();i[j]=k+i[j].substr(1);}return i.join(" ");}};e.exports=g;},null);
__d("MercuryAttachmentRenderer",["MercuryAttachmentAudioClip.react","ChatAttachmentAttribution.react","ImmutableObject","MercuryAttachment","MercuryAttachmentFile.react","MercuryAttachmentPhoto.react","MercuryAttachmentPhotoGrid.react","MercuryAttachmentVideo.react","MercuryMessageInfo","MercuryShareAttachment.react","MercuryShareAttachmentRenderLocations","MessengerHotLikeUtils","React","Sticker.react","StickerAssetType","StickerConstants","StickerImages","StickerUtils","cx","XStickerAssetController"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z){b.__markCompiled&&b.__markCompiled();'use strict';var aa={renderFile:function(ba,ca){return (s.createElement(k,{name:ba.name,open_url:ca?null:ba.open_url,rel:ba.rel,type:ba.icon_type,url:ba.url}));},renderAudioClip:function(ba,ca){var da=ba.metadata.duration/1000,ea=100,fa=ca?160:400,ga=100;if(da>=5)ga=(1-Math.pow(10,(da-5)/-30))*(fa-ea)+ea;return [s.createElement(g,{duration:ba.metadata.duration/1000,key:"audioClip",showHelp:false,src:ba.url,width:ga}),s.createElement(h,{attachment:new i(ba),key:"audioAttribution"})];},renderVideo:function(ba,ca,da){var ea=ca?ba.metadata.chat_size:ba.metadata.inbox_size,fa=ca?ba.metadata.chat_preview:ba.metadata.inbox_preview;return (s.createElement(n,{attachment:new i(ba),duration:ba.metadata.duration,isInbound:o.isInbound(da),isChat:ca,name:ba.name,pageID:ba.metadata.pageid,thumbSize:ea,thumbnail:fa,videoSize:ba.metadata.dimensions,videoID:ba.metadata.fbid,videoURI:ba.url}));},constructStickerComponent:function(ba,ca,da,ea,fa){var ga=ea?'chatScrolled/':'messengerScrolled/';ga+=ba.thread_id;if(!ca){ca=r.getMetadataForHotLike(ba.sticker_id);if(!ca){var ha=w.getSticker(ba.sticker_id),ia=Object.assign({},ha),ja=ha?x.getScaledDimensions(ha.height,ha.width,v.THREAD_SIZE):{height:v.THREAD_SIZE,width:v.THREAD_SIZE},ka=ja.height,la=ja.width;ia.height=ka;ia.width=la;ia.stickerID=ba.sticker_id;ia.spriteURI='';ia.spriteURI2x='';ia.paddedSpriteURI='';ia.paddedSpriteURI2x='';ca=ia;}}var ma=null;if(ca.stickerID){ma=ca.stickerID.toString();}else if(ba.sticker_id)ma=ba.sticker_id.toString();var na=null;if(ca.packID)na=ca.packID.toString();var oa=z.getURIBuilder().setInt('sticker_id',ma),pa=null,qa=null;if(window.devicePixelRatio&&window.devicePixelRatio>1){qa=ca.paddedSpriteURI2x;pa=ca.spriteURI2x;}else{qa=ca.paddedSpriteURI;pa=ca.spriteURI;}return (s.createElement(t,{animationTrigger:"hover",className:"mvs",frameCount:ca.frameCount||1,frameRate:ca.frameRate||83,framesPerCol:ca.framesPerCol||1,framesPerRow:ca.framesPerRow||1,onAttachmentLoad:fa,onStickerClick:da,packID:na,paddedSpriteURI:qa,sourceHeight:ca.height,sourceURI:oa.setEnum('image_type',u.IMAGE).getURI().toString(),sourceWidth:ca.width,spriteURI:pa,stickerID:ma,subscribedThreadID:ga}));},renderPhotoAttachments:function(ba,ca,da){var ea=ba.length;if(!ea)return null;if(ea===1){var fa=ba[0],ga=j.resizeContain({width:da,height:da},{width:fa.preview_width,height:fa.preview_height});return (s.createElement("div",{className:(("_55pk")+(' '+"_59go")+(j.hasAttribution(fa)?' '+"_4yjw":''))},s.createElement(l,{image:fa,width:ga.width,height:ga.height,message:ca}),s.createElement(h,{attachment:new i(ba[0])})));}return (s.createElement("div",{className:"_55pk"},s.createElement(m,{images:ba,size:da,message:ca})));},sortAttachmentsStablyByType:function(ba){var ca=[j.isPhotoAttachment,j.isShareAttachment,j.isFileAttachment,j.isErrorAttachment];ca.push(function(ea){return true;});var da=ca.map(function(ea){return [];});ba.forEach(function(ea){for(var fa=0;fa<ca.length;fa++)if(ca[fa](ea)){da[fa].push(ea);break;}});return Array.prototype.concat.apply([],da);},constructStoryBasedShareAttachment:function(ba,ca,da,ea,fa){var ga=da?q.CHAT:q.WEB_INBOX;return (s.createElement("div",{className:((!!ba.body&&da?"_r38":''))},s.createElement(p,{attachment:ca.share,location:ga,maxWidth:ea,onComponentLoaded:fa})));}};e.exports=aa;},null);
__d("MercuryAttachments.react",["MercuryAttachmentRenderer","ImmutableObject","MercuryAttachment","MercuryAttachmentMalicious.react","MessengerHotLikePreview.react","React","SubscriptionsHandler","emptyFunction"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){b.__markCompiled&&b.__markCompiled();'use strict';var o=l,p=o.PropTypes,q=l.createClass({displayName:"MercuryAttachments",propTypes:{attachments:p.array.isRequired,maxWidth:p.number.isRequired,message:p.instanceOf(h).isRequired,isChat:p.bool,onAttachmentLoad:p.func,onStickerClick:p.func},getDefaultProps:function(){return {isChat:false,onAttachmentLoad:n,onStickerClick:n};},_subscriptionsHandler:(null),componentDidMount:function(){this._subscriptionsHandler=new m();},componentWillUnmount:function(){this._subscriptionsHandler&&this._subscriptionsHandler.release();},_renderAttachment:function(r){if(i.isStickerAttachment(r)){return g.constructStickerComponent(this.props.message,this.props.attachments[0].metadata,this.props.onStickerClick,this.props.isChat,function(s){this.props.onAttachmentLoad&&this.props.onAttachmentLoad(s);}.bind(this));}else if(i.isVoiceAttachment(r)){return g.renderAudioClip(this.props.attachments[0],this.props.isChat);}else if(i.isVideoAttachment(r)){return g.renderVideo(this.props.attachments[0],this.props.isChat,this.props.message);}else if(i.isShareAttachment(r)){return g.constructStoryBasedShareAttachment(this.props.message,r,this.props.isChat,this.props.maxWidth,function(s){this.props.onAttachmentLoad&&this.props.onAttachmentLoad(s);}.bind(this));}else if(i.isFileAttachment(r))return g.renderFile(r,this.props.isChat);return l.createElement(j,null);},render:function(){if(this.props.message.is_like_preview)return (l.createElement(k,{isChat:this.props.isChat,key:'hlp:'+this.props.message.like_preview_since,since:this.props.message.like_preview_since}));if(this.props.attachments.length===0)return l.createElement("div",l.__spread({},this.props));var r=g.renderPhotoAttachments(this.props.attachments.filter(i.isPhotoAttachment),this.props.message,this.props.maxWidth),s=g.sortAttachmentsStablyByType(this.props.attachments.filter(function(t){return !i.isPhotoAttachment(t);})).map(function(t,u){return (l.createElement("span",{key:u},this._renderAttachment(t)));}.bind(this));return (l.createElement("div",l.__spread({},this.props),r,s));}});e.exports=q;},null);
__d("MercuryDataSources",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();var g={},h={add:function(i,j){g[i]=j;},get:function(i){!g[i];return g[i];}};e.exports=h;},null);
__d("MercuryTypeahead",["Event","ArbiterMixin","DOM","DOMDimensions","Input","Keys","MercuryTypeaheadTemplates","Tokenizer","Typeahead","TypeaheadCore","cx"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){b.__markCompiled&&b.__markCompiled();var r=function(s,t){this._domElement=null;this._typeahead=null;this._tokenizer=null;this._placeholder='';this._exclusions=[];this._viewNodeOrID=null;this._viewOptions={renderer:'compact',autoSelect:true};this._tokenizerBehaviors=[];this._heightPrev=null;this._dataSource=s;this._view=t;};Object.assign(r.prototype,h);Object.assign(r.prototype,{setPlaceholder:function(s){this._placeholder=s;return this;},setExcludedParticipantsFromThreadMeta:function(s){if(!s)return;if(!s.former_participants){this.setExcludedParticipants(s.participants);return;}var t=s.former_participants.filter(function(u){return u.is_friend===false;}).map(function(u){return u.id;});this.setExcludedParticipants(t.concat(s.participants));},setExcludedParticipants:function(s){this._exclusions=[];s.forEach(function(t){var u=t.indexOf(':');if(t.substr(0,u)=='fbid')this._exclusions.push(t.substr(u+1));}.bind(this));return this;},setViewNodeID:function(s){this._viewNodeOrID=s;},setViewNode:function(s){this._viewNodeOrID=s;},setFullWidthView:function(s){var t=i.create('div',{className:"_4ck uiTypeaheadView"});i.setContent(s,t);this.setViewNode(t);},setViewOption:function(s,t){this._viewOptions[s]=t;},addTokenizerBehavior:function(s){this._tokenizerBehaviors.push(s);},build:function(s){if(this._domElement)return;var t=m[':fb:mercury:tokenizer'].build(),u=m[':fb:mercury:typeahead'].build();this._domElement=t.getRoot();i.appendContent(this._domElement,u.getRoot());var v=u.getNode('textfield');k.setPlaceholder(v,this._placeholder);v.setAttribute('data-placeholder',this._placeholder);this._input=v;var w={node_id:this._viewNodeOrID,ctor:this._view,options:this._viewOptions},x={ctor:p,options:{setValueOnSelect:true}};this._typeahead=new o(this._dataSource,w,x,u.getRoot());this._typeahead.init();var y={inline:true,behaviors:this._tokenizerBehaviors};this._tokenizer=new n(this._domElement,this._typeahead);this._tokenizer.init(t.getNode('tokenarea'),'participants',[],y);this._tokenizer.subscribe(['addToken','removeToken','removeAllTokens'],this._tokensChanged.bind(this));this._tokenizer.subscribe('resize',function(){this.inform('resize');}.bind(this));g.listen(v,'focus',function(){this._resetDataSource();this._typeahead.init();}.bind(this));g.listen(this._domElement,'click',this.focus.bind(this));g.listen(v,'keydown',this.keydown.bind(this));this._heightPrev=j.getElementDimensions(this._domElement).height;},getElement:function(){return this._domElement;},getSelectedParticipantIDs:function(){var s=[];if(this._tokenizer)(this._tokenizer.getTokenValues()||[]).forEach(function(t){s.push('fbid:'+t);});return s;},getTokens:function(){var s=[];if(this._tokenizer)s=this._tokenizer.getTokens();return s;},getTokenizer:function(){return this._tokenizer;},keydown:function(event){if(this._tokenizer.inline&&event.keyCode==l.ESC){event.stopPropagation();if(k.isEmpty(this._input)){var s=this._tokenizer.getLastToken();if(s&&s.isRemovable()){this._tokenizer.removeToken(s);return;}}else{this._typeahead.getCore().reset();return;}this.inform('esc-pressed');return;}if(k.isEmpty(this._input)&&this._tokenizer.inline&&event.keyCode===l.RETURN){event.preventDefault();return this.inform('tokens-return');}},reset:function(){this._tokenizer&&this._tokenizer.removeAllTokens();this._typeahead&&this._typeahead.getCore().reset();},focus:function(){this._tokenizer&&this._tokenizer.focusInput();},getTypeahead:function(){return this._typeahead;},_resetDataSource:function(){this._dataSource.setExclusions(this._exclusions);},_tokensChanged:function(){this.inform('tokens-changed');}});e.exports=r;},null);
__d("MercuryTypeaheadRenderer",["Event","Badge.react","CSS","DOM","Image.react","MercuryTypeaheadConstants","MercuryParticipantsConstants","React","MercuryTypeaheadTemplates","cx"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){b.__markCompiled&&b.__markCompiled();function q(s,t){var u;switch(s.type){case l.HEADER_TYPE:u=o[':fb:mercury:typeahead:header'].build();q.renderHeader(u,s);break;case l.USER_TYPE:case l.PAGE_TYPE:u=o[':fb:mercury:typeahead:result'].build();q.renderPerson(u,s);break;default:throw new Error('Unsupported result type: '+s.type);}return u.getRoot();}Object.assign(q,{renderHeader:function(s,t){if(t.disabled){i.hide(s.getRoot());return;}var u=t.getLinkHandler&&t.getLinkHandler();if(u){var v=s.getNode('link');j.setContent(v,t.linkText);g.listen(v,'click',u);}else i.hide(s.getNode('link'));s.setNodeContent('text',t.text);},renderPersonWithBigPhoto:function(s,t){r(s,t,m.BIG_IMAGE_SIZE);},renderPerson:function(s,t){r(s,t,m.IMAGE_SIZE);},renderPage:function(s,t){r(s,t,m.IMAGE_SIZE);}});function r(s,t,u){if(t.photo){var v=n.createElement(k,{width:u,height:u,src:t.photo});n.render(v,s.getNode('image'));}if(t.text){j.setContent(s.getNode('name'),t.text);s.getRoot().setAttribute('aria-label',t.text);}var w=[];if(t.subtext||t.category){if(t.subtext)w.push(t.subtext);if(t.category)w.push(t.category);j.appendContent(s.getNode('snippet'),w.join(" \u00b7 "));}var x=null;if(t.is_verified){x=n.createElement(h,{type:"verified",size:"xsmall"});n.render(x,s.getNode('badge'));}else if(t.is_work_user){x=n.createElement(h,{type:"work",size:"xsmall"});n.render(x,s.getNode('badge'));}if(t.non_employee){if(w.length)j.prependContent(s.getNode('snippet')," \u00b7 ");var y=j.create('span',{className:"_52l8 highlight"},'(Non-Employee)');j.prependContent(s.getNode('snippet'),y);}}e.exports=q;},null);
__d("WebMessengerAddPeopleToConversationDialog",["ContextualTypeaheadView","Dialog","DOM","MercuryAPIArgsSource","MercuryDataSources","MercuryIDs","MercuryLogMessageType","MercurySourceType","MercuryTypeahead","MercuryTypeaheadConstants","MercuryTypeaheadRenderer","WebMessengerTemplates","WorkModeConfig","fbt","MercuryMessageObject","MercuryMessageActions","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){b.__markCompiled&&b.__markCompiled();var u=b('MercuryMessageObject').get(),v=b('MercuryMessageActions').get(),w=b('MercuryThreads').get(),x={show:function(z){var aa=t._("Add People"),ba={};ba[p.FRIEND_TYPE]={uid:p.FRIEND_TYPE,type:p.HEADER_TYPE,disabled:true};ba[p.NON_FRIEND_TYPE]={uid:p.NON_FRIEND_TYPE,text:t._("Other People"),type:p.HEADER_TYPE};var ca=new o(k.get('MercuryRecipientsDataSource'),g);ca.setViewOption('renderer',q);ca.setViewOption('typeObjects',ba);var da=s.is_work_user?t._("Add co-workers to this chat"):t._("Add friends to this chat");ca.setPlaceholder(da);var ea=[];ea.push({name:'subscribe',label:aa,handler:y.bind(null,z,ca)});ea.push(h.CANCEL);var fa=r[':fb:web-messenger:add-people-dialog'].build(),ga=new h().setTitle(aa).setBody(fa.getRoot()).setButtons(ea).showLoading();w.getThreadMeta(z,function(ha){ca.setFullWidthView(fa.getNode('participantsTypeahead'));ca.setExcludedParticipantsFromThreadMeta(ha);ca.build();i.appendContent(fa.getNode('participantsTypeahead'),ca.getElement());ga.show();ca.focus();},j.WEBMESSENGER);}};function y(z,aa){var ba=aa.getTokens(),ca=ba.map(function(da){return l.getParticipantIDFromUserID(da.getValue());});if(!ca.length)return false;v.send(u.constructLogMessageObject(n.TITAN_WEB,z,m.SUBSCRIBE,{added_participants:ca}),null,j.WEBMESSENGER);return true;}e.exports=x;},null);
__d("Autosize",["CSS","cx","DOM","Style"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();var k=['fontFamily','fontStyle','fontVariant','fontWeight','letterSpacing','textDecoration','textIndent','textTransform','whiteSpace','wordSpacing','wordWrap'],l=/^[0-9]+$/;function m(r){var s=r.cloneNode(true);g.addClass(s,"_4g");var t=r.clientWidth-j.getFloat(r,'paddingLeft')-j.getFloat(r,'paddingRight');j.set(s,'width',t+'px');var u=r.clientHeight-j.getFloat(r,'paddingTop')-j.getFloat(r,'paddingBottom');j.set(s,'height',u+'px');i.insertAfter(r,s);return s;}function n(r,s,t,u,v){var w=r.style.fontSize,x=r.style.height;j.set(r,"height","auto");if(s!==null){var y=r.style.width;j.set(r,"width","auto");}var z=0,aa=v.length-1;while(z<aa){var ba=Math.ceil((z+aa)/2);j.set(r,"font-size",v[ba]+u);if((t!==null&&r.scrollHeight>t)||(s!==null&&r.scrollWidth>s)){aa=ba-1;}else z=ba;}r.style.fontSize=w;r.style.height=x;if(s!==null)r.style.width=y;return v[z]+u;}function o(r,s,t,u,v,w){var x=r.style.fontSize,y=r.style.height;j.set(r,"height","auto");if(s!==null){var z=r.style.width;j.set(r,"width","auto");}j.set(r,"font-size",w+u);if((t===null||r.scrollHeight<=t)&&(s===null||r.scrollWidth<=s)){r.style.fontSize=x;r.style.height=y;if(s!==null)r.style.width=z;return w+u;}j.set(r,"font-size",v+u);if((t!==null&&r.scrollHeight>t)||(s!==null&&r.scrollWidth>s)){r.style.fontSize=x;r.style.height=y;if(s!==null)r.style.width=z;return v+u;}while(v+1<w){var aa=Math.ceil((v+w)/2);j.set(r,"font-size",aa+u);if((t!==null&&r.scrollHeight>t)||(s!==null&&r.scrollWidth>s)){w=aa;}else v=aa;}r.style.fontSize=x;r.style.height=y;if(s!==null)r.style.width=z;return v+u;}function p(r,s){this._wrap=r;this._attr=s;if(this._attr.sizes){var t=this._attr.sizes;for(var u=1,v=t.length;u<v;u++){if(t[u-1]<=t[u])continue;t.sort(function(x,y){return x-y;});break;}}else if(s.min>s.max){var w=s.min;s.min=s.max;s.max=w;}this.fit();}p.prototype.fit=function(r,s){var t=this._wrap;if(!t.clientWidth){q.push(this);return;}var u=m(t);if(typeof r==="undefined")r=this._attr.width;if(l.test(r)){u.style.width=r+"px";}else if(r!==null&&r!=="auto")u.style.width=r;if(typeof s==="undefined")s=this._attr.height;if(l.test(s)){u.style.height=s+"px";}else if(s!==null&&s!=="auto")u.style.height=s;var v=null;if(!this._attr.wrap)v=u.clientWidth;var w=null;if(this._attr.wrap||s!==null)w=u.clientHeight;var x;if(this._attr.sizes){x=n(u,v,w,"px",this._attr.sizes);}else x=o(u,v,w,"px",this._attr.min,this._attr.max);i.remove(u);j.set(t,"font-size",x);g.removeClass(t,"invisible_elem");};var q=[];p.onNodeInserted=function(){var r=q;q=[];r.forEach(function(s){s.fit();});};e.exports=p;},null);
__d("WebMessengerEditThreadDialog",["Event","Button","ContextualDialog","CSS","DOM","FileInput","FileInputUploader","Input","InputSelection","LayerFadeOnHide","LayerFadeOnShow","LayerHideOnTransition","MercuryAPIArgsSource","MercuryLogMessageType","MercurySourceType","WebMessengerTemplates","URI","WebMessengerSubscriptionsHandler","csx","cx","MercuryMessageObject","MercuryMessageActions","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z){b.__markCompiled&&b.__markCompiled();var aa=b('MercuryMessageObject').get(),ba=b('MercuryMessageActions').get(),ca=b('MercuryThreads').get(),da=':fb:web-messenger:read-view:header:edit-multichat';function ea(){"use strict";var fa=v[da].build();this._dialog=new i({position:'below',addedBehaviors:[p,q,r]},fa.getRoot());this._saveButton=fa.getNode('saveButton');this._cancelButton=fa.getNode('cancelButton');this._pictureInput=fa.getNode('newPicture');this._uploadButton=fa.getNode('uploadButton');this._uploadingThrobber=fa.getNode('uploadingThrobber');this._uploadedFileDetails=fa.getNode('uploadedFileDetails');this._fileNameNode=fa.getNode('fileName');this._cancelImageButton=fa.getNode('cancelImage');this._threadID=null;var ga=fa.getNode('newName');this._uploadedImage=null;if(!this._pictureInput){var ha=k.scry(fa.getRoot(),"._8-9")[0];this._pictureInput=k.create('input',{accept:'image/*',type:'file',className:"_n",name:'attachment[]',tabindex:2});new l(ha,this._uploadButton,this._pictureInput);}var ia=new w('/ajax/mercury/upload.php').setSubdomain('upload').toString();this._uploader=new m(this._pictureInput).setURI(ia).setAllowCrossOrigin(true).setData({images_only:true});x.addSubscriptions(this._uploader.subscribe('success',this._onFileUploadSuccess.bind(this)),this._uploader.subscribe('failure',this._onFileUploadFailure.bind(this)),g.listen(this._pictureInput,'change',this._onFileUploadChange.bind(this)),g.listen(this._cancelImageButton,'click',this._resetImageUpload.bind(this)));g.listen(this._saveButton,'click',function(){this.save(n.getValue(ga));this._dialog.hide();}.bind(this));g.listen(this._cancelButton,'click',function(){this._dialog.hide();}.bind(this));this._dialog.subscribe('show',function(){var ja=ca.getThreadMetaNow(this._threadID);n.setValue(ga,ja.name);this._resetImageUpload();}.bind(this));this._dialog.subscribe('aftershow',function(){o.set(ga,0,n.getValue(ga).length);}.bind(this));}ea.prototype.toggleShown=function(fa,ga){"use strict";if(!this._dialog.isShown()){this._dialog.setContext(fa);this._threadID=ga;this._uploadedImage=null;this._dialog.show();}else this._dialog.hide();};ea.prototype.save=function(fa){"use strict";var ga=null,ha=ca.getThreadMetaNow(this._threadID);if(ha)ga=ha.name;if((fa||ga)&&(fa!=ga))ba.send(aa.constructLogMessageObject(u.CHAT_WEB,this._threadID,t.THREAD_NAME,{name:fa}),null,s.WEBMESSENGER);if(this._uploadedImage)ba.send(aa.constructLogMessageObject(u.CHAT_WEB,this._threadID,t.THREAD_IMAGE,{image:this._uploadedImage}));};ea.prototype._onFileUploadChange=function(event){"use strict";var fa=n.getValue(event.getTarget());if(fa){h.setEnabled(this._saveButton,false);j.hide(this._uploadButton);j.hide(this._uploadedFileDetails);j.show(this._uploadingThrobber);this._uploader.send();}};ea.prototype._onFileUploadSuccess=function(fa,ga){"use strict";var ha=ga.response.getPayload();this._uploadedImage=ha.metadata[0];k.setContent(this._fileNameNode,this._uploadedImage.filename);j.hide(this._uploadingThrobber);j.hide(this._uploadButton);j.show(this._uploadedFileDetails);h.setEnabled(this._saveButton,true);};ea.prototype._onFileUploadFailure=function(fa,ga){"use strict";h.setEnabled(this._saveButton,true);this._resetImageUpload();};ea.prototype._resetImageUpload=function(){"use strict";this._uploadedImage=null;this._pictureInput.value=null;j.hide(this._uploadingThrobber);j.hide(this._uploadedFileDetails);j.show(this._uploadButton);};e.exports=ea;},null);
__d("MercuryPresence",["Arbiter","AvailableListConstants","DOM","CSS","requireWeak","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l){b.__markCompiled&&b.__markCompiled();var m={},n={},o={updateOnPresenceChanges:function(u,v){n[v.tagName]=true;m[u]=true;j.addClass(v,'presenceListener_'+u);var w=p(u);q(v,w.classes);r(v,w.label);}};function p(u){var v=t(u),w={presenceActive:false,presenceMobile:false},x=null;switch(v){case h.ACTIVE:w.presenceActive=true;x=l._("Active");break;case h.MOBILE:w.presenceMobile=true;x=l._("Mobile");break;default:break;}return {classes:w,label:x};}function q(u,v){for(var w in v)j.conditionClass(u,w,v[w]);}function r(u,v){if(u&&v){var w=i.create('span',{className:'accessible_elem'},v);i.setContent(u,w);}}function s(){for(var u in m){var v=p(u);for(var w in n){var x=i.scry(document,w+'.presenceListener_'+u);for(var y=0;y<x.length;y++){q(x[y],v.classes);r(x[y],v.label);}}}}var t=function(u){return h.OFFLINE;};k('AvailableList',function(u){t=u.get;s();});g.subscribe(h.ON_AVAILABILITY_CHANGED,s);e.exports=o;},null);
__d("WebMessengerStateConstants",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();var g={STATE_CHANGE_EVENT:'state-changed',DETAIL:{COMPOSE_MAIN:'compose-main',COMPOSE_TYPEAHEAD_RESULTS:'compose-typeahead-results',COMPOSE_ALL_PEOPLE_RESULTS:'compose-all-people-results',RECENT_MESSAGES:'recent-messages',SEARCH_CONTEXT:'search-context',SEARCH_SNIPPET:'search-snippet',SEARCH_THREAD_SNIPPET:'search-thread-snippet',SHARED_PHOTOS:'shared-photos'},MASTER:{RECENT_THREADS:'recent-threads',SEARCH:'search'},MESSAGE_ACTION:{DELETE:'delete'}};e.exports=g;},null);
__d("WebMessengerOldToNewPermalink",["WebMessengerPermalinkConstants","WebMessengerStateConstants"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();function i(n){if(!j(n))return n;k(n);m(n);l(n);return n;}function j(n){var o=n.getQueryData();if(o.sk)switch(o.sk){case 'inbox':n.setPath(g.BASE_PATH);n.removeQueryData('sk');break;case 'other':n.setPath(g.OTHER_PATH);n.removeQueryData('sk');break;default:return false;}return true;}function k(n){var o=n.getQueryData();switch(o.action){case 'read':if(!o.tid){n.addQueryData({action:h.DETAIL.RECENT_MESSAGES});}else n.removeQueryData('action');break;}}function l(n){var o=n.getQueryData();if(o.tid){n.setPath(g.getURIPathForThreadID(o.tid,n.getPath()));n.removeQueryData('tid');}}function m(n){var o=n.getQueryData();if(!n.getPath().match(g.SEARCH_POSTFIX_PATH)&&o.action!=h.DETAIL.SEARCH_SNIPPET&&!o.mid){var p=o.query;if(o.query){var q=/\bis:(archived|spam)\b(.*)/,r=q.exec(o.query);if(r){switch(r[1]){case 'archived':n.setPath(g.ARCHIVED_PATH);break;case 'spam':n.setPath(g.SPAM_PATH);break;}var s=o.query.substr(0,o.query.length-r[0].length),t=r[2];p=(s.trim()+' '+t.trim()).trim();}}if(o.thread_query){n.setPath(n.getPath()+g.SEARCH_POSTFIX_PATH);n.setQueryData({query:o.thread_query});}else if(p){n.setPath(n.getPath()+g.SEARCH_POSTFIX_PATH);n.addQueryData({query:p});}else n.removeQueryData('query');}}e.exports=i;},null);
__d("WebMessengerStateStore",["MercuryAssert","PresenceState"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();var i=null;function j(){var l=h.get();if(l&&l.wml)return l.wml;return {};}h.registerStateStorer(function(l){if(i)l.wml=i;i=null;});var k={getLastSeenThreadID:function(){var l=j();return l.thread_id||null;},getLastSeenFolder:function(){var l=j();return l.folder||null;},setLastSeen:function(l,m){m&&g.isThreadID(m);i={folder:l,thread_id:m||null};h.doSync();}};e.exports=k;},null);
__d("WebMessengerPermalinks",["MercuryAPIArgsSource","MercuryConfig","MercuryFilters","MercuryIDs","MercuryParticipants","MercuryParticipantTypes","MercuryTypeaheadConstants","MessagingTag","WebMessengerOldToNewPermalink","WebMessengerPermalinkConstants","WebMessengerStateConstants","WebMessengerStateStore","Token","URI","WebMessengerPreferences","WWWBase","MercuryUnreadState","isWebMessengerURI","goURI","MercuryThreadIDMap","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y){b.__markCompiled&&b.__markCompiled();var z=b('MercuryThreadIDMap').get(),aa=b('MercuryThreads').get(),ba='(/|\\?|$)',ca={getDefaultURI:function(){var pa=new t(v.uri);pa.setPath(p.BASE_PATH);return pa;},goNextURI:function(pa,qa,ra,sa){if(la(pa,qa,ra)){var ta=ca.getURI(pa,qa,ra);y(ta,false,sa);return true;}return false;},getURI:function(pa,qa,ra){var sa=ca.getDefaultURI();if(!pa||!qa||!ra)return sa;switch(ra.folder){case n.OTHER:sa.setPath(p.OTHER_PATH);break;case n.ACTION_ARCHIVED:sa.setPath(p.ARCHIVED_PATH);break;case n.SPAM:sa.setPath(p.SPAM_PATH);break;case n.PENDING:h.CoreGraphEnabled&&sa.setPath(p.PENDING_PATH);break;}if(ra.filter&&(ra.filter!=i.ALL))sa.addQueryData({filter:ra.filter});var ta;switch(pa){case q.MASTER.SEARCH:ta=false;sa.setPath(sa.getPath()+p.SEARCH_POSTFIX_PATH);break;}switch(qa){case q.DETAIL.COMPOSE_MAIN:case q.DETAIL.COMPOSE_TYPEAHEAD_RESULTS:case q.DETAIL.COMPOSE_ALL_PEOPLE_RESULTS:sa.setPath(sa.getPath()+p.COMPOSE_POSTFIX_PATH);ta=false;break;case q.DETAIL.RECENT_MESSAGES:ta=!ra.thread_id;break;case q.DETAIL.SEARCH_CONTEXT:case q.DETAIL.SHARED_PHOTOS:ta=false;break;default:ta=true;break;}if(ta)sa.addQueryData({action:qa});if(ra.thread_id){var ua=j.getUserIDFromThreadID(ra.thread_id),va=ua&&k.getNow(j.getParticipantIDFromUserID(ua));if(va&&va.type!==l.EVENT){var wa=(va&&va.vanity)||ua;sa.setPath(p.getURIPathForIDOrVanity(wa,sa.getPath()));}else{var xa=z.getFBIDFromClientIDNow(ra.thread_id),ya=xa?xa:ra.thread_id;sa.setPath(p.getURIPathForThreadID(ya,sa.getPath()));}}if(ra.query)sa.addQueryData({query:ra.query});if(ra.message_query)sa.addQueryData({mquery:ra.message_query});if(ra.message_id)sa.addQueryData({mid:ra.message_id});if(ra.reuse_composer)sa.addQueryData({rc:true});if(ra.isStandaloneMode)sa.addQueryData({standalone:true});return sa;},processURI:function(pa){pa=o(pa);if(!x(pa))return false;var qa,ra=ma(pa),sa=(!ra.master_state||!ra.detail_state);if(sa){qa=na(pa);}else{qa={data:{folder:ja(pa),filter:ka(pa)},redirect:false,master_state:ra.master_state,detail_state:ra.detail_state};if(pa.getQueryData().rc)qa.data.reuse_composer=true;qa=ga(pa,qa);}qa.data.isStandaloneMode=pa.getQueryData().standalone;if(sa)return qa;switch(ra.detail_state){case q.DETAIL.RECENT_MESSAGES:return ia(pa,qa);case q.DETAIL.COMPOSE_MAIN:return da(pa,qa);case q.DETAIL.SEARCH_SNIPPET:qa=ha(pa,qa);return qa;case q.DETAIL.SEARCH_CONTEXT:qa=ia(pa,qa);qa=ha(pa,qa);return fa(pa,qa);}qa.redirect=true;qa.detail_state=null;return qa;}};function da(pa,qa){var ra=null;if(pa.getQueryData().to)ra=[].concat(pa.getQueryData().to);return ea(ra,qa);}function ea(pa,qa){if(pa){qa.data.new_tokens=[];pa.forEach(function(ra){var sa=k.getNow(j.getParticipantIDFromUserID(ra));if(sa){var ta={uid:ra,text:sa.name,type:m.USER_TYPE};qa.data.new_tokens.push(new s(ta));}});}qa.data.start=true;return qa;}function fa(pa,qa){var ra=pa.getQueryData().mid;if(ra){qa.data.message_id=ra;}else qa.redirect=true;return qa;}function ga(pa,qa){var ra=pa.getQueryData().query;qa.data.query=ra;return qa;}function ha(pa,qa){var ra=pa.getQueryData().mquery;qa.data.message_query=ra;return qa;}function ia(pa,qa){var ra=p.getThreadIDFromURI(pa);if(ra){var sa=j.isValidThreadID(ra)?ra:z.getClientIDFromFBIDNow(ra)||z.getClientIDFromServerIDNow(ra);if(sa){qa.data.thread_id=sa;}else qa.redirect=true;}else{var ta=p.getUserIDOrVanity(pa.getPath());if(ta){var ua=k.getIDFromVanityOrFBID(ta),va=ua&&aa.getCanonicalThreadToParticipant(ua,null,g.WEBMESSENGER);if(va){if(va.timestamp){qa.data.thread_id=va.thread_id;}else{qa.detail_state=q.DETAIL.COMPOSE_MAIN;qa=ea([j.getUserIDFromParticipantID(ua)],qa);}}else qa.redirect=true;}}return qa;}function ja(pa,qa){var ra=pa.getPath();if(ra.match('^'+p.ARCHIVED_PATH+ba))return n.ACTION_ARCHIVED;if(ra.match('^'+p.OTHER_PATH+ba))return n.OTHER;if(ra.match('^'+p.SPAM_PATH+ba))return n.SPAM;if(h.CoreGraphEnabled&&ra.match('^'+p.PENDING_PATH+ba))return n.PENDING;if(qa!==(void 0))return qa;return n.INBOX;}function ka(pa){return pa.getQueryData().filter||i.ALL;}function la(pa,qa,ra){if(qa===q.DETAIL.SEARCH_CONTEXT||qa===q.DETAIL.SEARCH_THREAD_SNIPPET||qa===q.DETAIL.SHARED_PHOTOS)return false;if(ra&&ra.no_uri===true){delete ra.no_uri;return false;}var sa=qa==q.DETAIL.COMPOSE_MAIN||qa==q.DETAIL.COMPOSE_TYPEAHEAD_RESULTS||qa==q.DETAIL.COMPOSE_ALL_PEOPLE_RESULTS;if(sa&&(!ra.start||ra.new_tokens))return false;if(!pa||!qa||!ra)return true;if(ra.bug_reporting_enabled)return false;return !ra.message_action;}function ma(pa){var qa={},ra=pa.getPath(),sa=pa.getQueryData(),ta=ra.match(p.BASE_PATH+'(/[^/]+)?'+p.SEARCH_POSTFIX_PATH+ba);qa.master_state=ta&&sa.query?q.MASTER.SEARCH:q.MASTER.RECENT_THREADS;if(sa.action){qa.detail_state=sa.action;return qa;}if(ra.match('(?:'+p.BASE_PATH+'|'+p.OTHER_PATH+')'+'(/[^/]+)?'+p.COMPOSE_POSTFIX_PATH+ba)){qa.detail_state=q.DETAIL.COMPOSE_MAIN;return qa;}if(ra.match(p.TID_POSTFIX_PARTIAL_PATH)||p.getUserIDOrVanity(ra)){if(sa.mid&&sa.mquery){qa.detail_state=q.DETAIL.SEARCH_CONTEXT;}else qa.detail_state=q.DETAIL.RECENT_MESSAGES;}else if(sa.mquery)qa.detail_state=q.DETAIL.SEARCH_SNIPPET;return qa;}function na(pa){var qa=ja(pa,null)||r.getLastSeenFolder(),ra=r.getLastSeenThreadID()||oa(qa||n.INBOX),sa=w.get();if(qa===n.OTHER&&sa.getUnreadCount(qa)===0){var ta=n.INBOX;if(sa.exceedsMaxCount(ta)||sa.getUnreadCount(ta)>0)qa=ta;}var ua={redirect:!!ra||!!qa,replace:true,master_state:q.MASTER.RECENT_THREADS,detail_state:q.DETAIL.RECENT_MESSAGES,data:{folder:qa||n.INBOX,filter:i.ALL,thread_id:ra}};return ua;}function oa(pa){var qa=u.lastReadThreadForFolder[pa];if(qa){var ra=qa.canonical_fbid||qa.thread_fbid;return z.getClientIDFromFBIDNow(ra)||null;}else return null;}e.exports=ca;},null);
__d("WebMessengerStateManager",["Arbiter","CurrentUser","Dialog","Focus","JSLogger","MercuryFilters","MessagingTag","WebMessengerPermalinks","WebMessengerStateConstants"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){b.__markCompiled&&b.__markCompiled();var p=k.create('wm_state_manager'),q=h.getID(),r=false,s=Object.assign(new g(),{getCurrentUserID:function(){return q;},getCurrentMasterState:function(){return v;},getCurrentDetailState:function(){return w;},getCurrentStateData:function(){return x;},getStandaloneMode:function(){return r;},setUserID:function(z){q=z||h.getID();},setStandaloneMode:function(z){r=Boolean(z);},updateMasterState:function(z,aa){s.updateAllStates(z,w,aa);},updateDetailState:function(z,aa){s.updateAllStates(v,z,aa);},updateAllStates:function(z,aa,ba){for(var ca=0;ca<y.length;ca++)if(y[ca]){var da=y[ca](z,aa,ba);if(da){p.log('confirmation_dialog',{master_state:v,detail_state:w,data:x,new_master_state:z,new_detail_state:aa,new_data:ba});da.setHandler(t.bind(null,z,aa,ba)).show();var ea=da.getButtonElement(i.OK.label);ea&&j.set(ea);return;}}t(z,aa,ba);},updateStateOnURI:function(z,aa,ba){u(z,aa,ba);},registerConfirmationBeforeStateUpdate:function(z){var aa=y.length;y.push(z);return aa;},unregisterConfirmationBeforeStateUpdate:function(z){delete y[z];}});function t(z,aa,ba){if(!ba.folder)ba.folder=x.folder;if(!ba.filter)ba.filter=x.filter;ba.isStandaloneMode=s.getStandaloneMode();if(!n.goNextURI(z,aa,ba))u(z,aa,ba);}function u(z,aa,ba){v=z;w=aa;x=ba;var ca=Object.assign({},x);ca.new_tokens=[];(x.new_tokens||[]).forEach(function(da){ca.new_tokens.push(da.getInfo());});ca.new_tokens=[];p.log('state_updated',{master_state:v,detail_state:w,data:ca});s.inform(o.STATE_CHANGE_EVENT);}var v=o.MASTER.RECENT_THREADS,w=o.DETAIL.RECENT_MESSAGES,x={thread_id:null,folder:m.INBOX,filter:l.ALL},y=[(void 0)];e.exports=s;},null);
__d("MercurySeenByAll",["CSS","DataStore","MercuryDelayedRoger","DOM","MercuryIDs","MercuryViewer","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k,l){b.__markCompiled&&b.__markCompiled();var m=b('MercuryThreads').get(),n={},o={updateOnSeenChange:function(q,r,s){n[q.tagName]=true;h.set(q,'thread-id',r.thread_id);g.addClass(q,'seenByListener');p(q,r,s);}};function p(q,r,s){var t=null;if(s){t=k.getParticipantIDFromUserID(s);}else t=l.getID();var u=r.participants.filter(function(w){return w!==t;}),v=r.participants.length>0&&r.participants[0]===t;g.conditionClass(q,'repliedLast',v);g.conditionClass(q,'seenByAll',v&&i.getSeenBy(r.thread_id).length===u.length);}i.subscribe('state-changed',function(q,r){for(var s in n){var t=j.scry(document.body,s+'.seenByListener');for(var u=0;u<t.length;u++){var v=t[u],w=h.get(v,'thread-id');if(r[w])m.getThreadMeta(w,function(x){p(v,x);});}}});e.exports=o;},null);
__d("MercuryThreadMetadataRenderer",["CSS","DOM","Emoji","HTML","JSLogger","MercuryAttachmentType","MercuryIDs","MercuryMessageSourceTags","MercurySingletonMixin","MercuryThreadImage.react","MercuryThreadIDMap","MercuryThreadMetadataRawRenderer","MercuryThreadTitle.react","MercuryParticipants","React","MercurySeenByAll","MercuryServerRequests","Style","MercuryThreads","Tooltip","URI","WebMessengerThreadPermalinks","arrayContains","createArrayFromMixed","cx","formatDate","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga){b.__markCompiled&&b.__markCompiled();var ha=k.create('wm_timestamp');function ia(na){this._fbid=na;this._serverRequests=w.getForFBID(na);this._threads=y.getForFBID(na);this._threadIDMap=q.getForFBID(na);}Object.assign(ia,o);Object.assign(ia.prototype,{renderTimestamp:function(na,oa,pa,qa){if(qa){if(!oa){ha.warn('no_title');oa=(new Date(qa)).toLocaleDateString();}na.setAttribute('title',oa);na.setAttribute('data-utime',qa/1000);if(!pa){ha.warn('no_display');pa=fa(new Date(qa),'g:ia');}h.setContent(na,pa);g.show(na);}},renderMessageSourceTags:function(na,oa,pa,qa){var ra='',sa='',ta='';if(ca(pa,n.MESSENGER)){ra=ga._("Sent from Messenger");sa=new aa('/mobile/messenger');ta="_9g";}else if(ca(pa,n.MOBILE)){ra=ga._("Sent from Mobile");sa=new aa('/mobile/');ta="_9j";}else if(ca(pa,n.CHAT)){ra=ga._("Sent from chat");ta="_9h";}else if(ca(pa,n.EMAIL)){if(qa){ra=ga._("Sent from {email}",[ga.param("email",qa)]);}else ra=ga._("Sent from email");ta="_9i";}if(ta){z.set(na,ra);g.addClass(oa,ta);if(sa){na.setAttribute('href',sa);}else na.removeAttribute('href');}else g.hide(na);},renderSpoofWarning:function(na,oa,pa){if(oa){g.addClass(na,"_sa");z.set(na,ga._("Unable to confirm {name_or_email} as the sender.",[ga.param("name_or_email",pa.name)]));}},renderChatSpoofWarning:function(na,oa,pa){if(oa)h.appendContent(na,ga._("Unable to confirm {name_or_email} as the sender.",[ga.param("name_or_email",pa.name)]));},renderCoreThreadlist:function(na,oa,pa,qa,ra){qa=qa||{};this.renderThreadImage(na,oa.getNode('image'));var sa=oa.getNode('accessibleName'),ta=[oa.getNode('name')];if(sa)ta.push(sa);ma(this,na,ta,qa);if(na.folder&&ra)la(oa.getNode('folderBadge'),na.folder);var ua=oa.getNode('timestamp');this.renderTimestamp(ua,na.timestamp_absolute,na.timestamp_relative,na.timestamp);this.renderSnippet(na,oa.getNode('snippet'));ka(oa,na);pa(oa,na);},renderAndSeparatedParticipantList:function(na,oa,pa){pa=pa||{};pa.last_separator_uses_and=true;this._threads.getThreadMeta(na,function(qa){ma(this,qa,oa,pa);}.bind(this));},renderSnippet:function(na,oa){var pa=false,qa=h.create('span');g.addClass(qa,'MercuryRepliedIndicator');h.appendContent(oa,qa);v.updateOnSeenChange(qa,na,this._fbid);var ra=na.snippet;if(ra){if(na.snippet_has_attachment)h.appendContent(oa,h.create('span',{className:'MercuryAttachmentIndicator'}));if(ra.substr(0,4)=='?OTR'){ra=ga._("[encrypted message]");}else ra=ra.replace(/\r\n|[\r\n]/g," ");ra=j(i.htmlEmojiAndEmote(ra));}else if(na.snippet_has_attachment&&na.snippet_attachments&&na.snippet_attachments.length){pa=true;ra=h.create('span');d(['MercuryAttachmentSnippet.react'],function(ua){u.render(u.createElement(ua,{thread:na,viewer:this._fbid}),ra);}.bind(this));}var sa=na.participants.length;if(na.is_subscribed)sa--;var ta=na.snippet_sender;if(!pa&&ta&&m.getParticipantIDFromUserID(this._fbid)!=ta&&sa>1){t.get(ta,function(ua){if(ua.short_name){h.appendContent(oa,ga._("{name}: {conversation_snippet}",[ga.param("name",ua.short_name),ga.param("conversation_snippet",ra)]));}else h.appendContent(oa,ra);});}else h.appendContent(oa,ra);},renderWebMessengerLink:function(na,oa,pa,qa){ba.getThreadURI(na,function(ra){oa.setAttribute('href',ra);pa&&pa();},qa);},renderThreadImage:function(na,oa){u.render(u.createElement(p,{thread:na,viewer:this._fbid}),oa);},renderParticipantList:function(na,oa,pa,qa){return r.renderRawParticipantList(this._threadIDMap.getFBIDFromClientIDNow(na),oa,pa,qa);},renderThreadNameAndParticipantList:function(na,oa,pa,qa){var ra=r.renderRawParticipantList(this._threadIDMap.getFBIDFromClientIDNow(na),oa,pa,qa),sa=this._threads.getThreadMetaNow(na);if(!sa.name)return ra;return ga._("{conversation_name} [with {participant_list}]",[ga.param("conversation_name",sa.name),ga.param("participant_list",ra)]);},renderParticipantCount:function(na,oa){return r.renderRawParticipantCount(oa);}});function ja(na){if(!na.snippet_attachments)return [];return na.snippet_attachments.filter(function(oa){return oa.attach_type===l.PHOTO;});}function ka(na,oa){var pa=ja(oa);if(pa.length===0)return;var qa=pa[0].thumbnail_url;if(!qa)return;var ra=(pa.length==1)?'snippet-thumbnail-single':'snippet-thumbnail-multiple',sa=na.getNode(ra);if(!sa)return;var ta=h.find(sa,'i');x.set(ta,'background-image','url('+qa+')');g.show(sa);}function la(na,oa){da(na).forEach(function(pa){h.setContent(pa,oa);});}function ma(na,oa,pa,qa){pa=da(pa);var ra=na._fbid;if(oa.name){pa.forEach(function(ta){u.render(u.createElement(s,{thread:oa,viewer:ra,showUnreadCount:!!qa.show_unread_count}),ta);});return;}var sa=oa.participants;if(oa.participants.length>1)sa=oa.participants.filter(function(ta){return ta!=m.getParticipantIDFromUserID(ra);});t.getMulti(sa,function(ta){r.renderParticipantListWithNoThreadName(na._threadIDMap.getFBIDFromClientIDNow(oa.thread_id),oa,sa,ta,pa,qa);});}e.exports=ia;},null);
__d("WebMessengerDetailViewHeaderControl",["WebMessengerAddPeopleToConversationDialog","Autosize","AvailableListConstants","Bootloader","ContextualDialog","CSS","DOM","WebMessengerEditThreadDialog","Event","HovercardLink","HoverFlyout","JSXDOM","LastMobileActiveTimes","LayerFadeOnHide","LayerFadeOnShow","LayerHideOnTransition","MercuryAPIArgsSource","MercuryIDs","MercuryThreadInfo","MercuryViewer","MercuryParticipants","MercuryPresence","ScrollableArea","WebMessengerStateConstants","WebMessengerStateManager","Style","WebMessengerTemplates","Tooltip","WebMessengerConstants","WebMessengerEvents","WebMessengerSubscriptionsHandler","csx","cx","curry","fbt","MercuryThreadInformer","MercuryThreadMetadataRenderer","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la,ma,na,oa){b.__markCompiled&&b.__markCompiled();var pa=b('MercuryThreadInformer').get(),qa=b('MercuryThreadMetadataRenderer').get(),ra=b('MercuryThreads').get(),sa=null;function ta(ab){"use strict";this._rootElement=ab;m.empty(this._rootElement);this._renderHeaderBar();}ta.prototype.hideView=function(){"use strict";l.hide(this._rootElement);};ta.prototype.updateView=function(){"use strict";l.removeClass(this._rootElement,'hasMultiChatThreadActions');l.show(this._rootElement);if(this._listener){pa.unsubscribe(this._listener);this._listener=null;}var ab=da;switch(ea.getCurrentDetailState()){case ab.DETAIL.RECENT_MESSAGES:case ab.DETAIL.SEARCH_CONTEXT:case ab.DETAIL.SEARCH_THREAD_SNIPPET:case ab.DETAIL.SHARED_PHOTOS:this.setThreadID(ea.getCurrentStateData().thread_id);break;default:this.setThreadID(null);break;}ja.detailDOMChanged();};ta.prototype.setThreadID=function(ab){"use strict";this._threadID=ab;if(this._threadID){this._listener=pa.listen(this._threadID,this.updateView.bind(this));ka.addSubscriptions(this._listener);}ab&&ra.getThreadMeta(ab,function(bb){if(this._threadID==ab)l.conditionClass(this._rootElement,'hasMultiChatThreadActions',!bb.is_canonical&&y.canReply(bb));}.bind(this));};ta.prototype._renderHeaderBar=function(){"use strict";this._headerBar=ga[':fb:web-messenger:read-view:header'].build();m.appendContent(this._rootElement,this._headerBar.getRoot());var ab=this._headerBar.getNode('editThreadName'),bb=this._headerBar.getNode('addPeopleToThread'),cb=new n();this._title_node_wrapper=this._headerBar.getNode('headerName');this._relationship_status=this._headerBar.getNode('relationshipStatus');ka.addSubscriptions(o.listen(this._headerBar.getNode('closeButton'),'click',function(){var db=Object.assign({},ea.getCurrentStateData(),{all_people_query:(void 0)});ea.updateDetailState(da.DETAIL.COMPOSE_MAIN,db);}),o.listen(ab,'click',function(event){this._threadID&&cb.toggleShown(this._headerBar.getNode('headerName'),this._threadID);return true;}.bind(this)),o.listen(bb,'click',function(event){this._threadID&&g.show(this._threadID);return true;}.bind(this)),ja.subscribe(ja.DETAIL_DOM_CHANGED,this.updateHeaderBar.bind(this)));};ta.prototype.updateHeaderBar=function(){"use strict";var ab=this._headerBar.getNode('headerButtons');this._title_node_wrapper.style.fontSize='';var bb=r.span(null);m.setContent(this._title_node_wrapper,bb);var cb=this._headerBar.getNode('webMessengerRecIndicator');cb&&l.hide(cb);var db=ea.getCurrentDetailState(),eb=db==da.DETAIL.COMPOSE_ALL_PEOPLE_RESULTS;l.conditionShow(this._headerBar.getNode('closeButton'),eb);l.conditionClass(this._title_node_wrapper,'allPeopleResults',eb);l.hide(this._relationship_status);l.removeClass(this._title_node_wrapper,"_50jz");var fb,gb;switch(db){case da.DETAIL.COMPOSE_ALL_PEOPLE_RESULTS:gb=ea.getCurrentStateData().all_people_query;fb=oa._("People matching {query}",[oa.param("query",m.create('strong',{},gb))]);break;case da.DETAIL.COMPOSE_MAIN:case da.DETAIL.COMPOSE_TYPEAHEAD_RESULTS:fb=oa._("New Message");break;case da.DETAIL.SEARCH_SNIPPET:gb=ea.getCurrentStateData().message_query;if(gb)fb=oa._("Messages with word: {query}",[oa.param("query",gb)]);break;}var hb=!fb&&!this._threadID;if(hb)fb=oa._("No Selection");l.conditionClass(this._title_node_wrapper,"_3jd",hb);if(fb){m.setContent(bb,fb);za(this._title_node_wrapper,this._threadID,ab,cb);return;}qa.renderAndSeparatedParticipantList(this._threadID,bb,{check_length:false,names_renderer:function(ib){var jb=ib.map(function(lb){var mb=ib.length===1?lb.name:lb.short_name,nb=lb.id?x.getUserIDFromParticipantID(lb.id):null;if(nb&&lb.href){var ob=r.a({href:lb.href},mb);if(ib.length===1)ob.setAttribute('data-hovercard',p.constructEndpoint({id:nb}));if(ea.getStandaloneMode())ob.setAttribute('target','_blank');return ob;}else return mb;}.bind(this));if(ib.length===1&&ib[0].fbid!==null){var kb=r.span(null);m.setContent(kb,jb[0]);va(ib[0],kb);jb[0]=kb;}return jb;}.bind(this)});if(cb)ra.getThreadMeta(this._threadID,function(ib){wa(ib,cb);});this.renderParticipantListFlyout(bb);this.renderNamedThreadParticipantCount(bb);za(this._title_node_wrapper,this._threadID,ab,cb);new h(this._title_node_wrapper,{min:11,max:16,height:100,width:this._title_node_wrapper.offsetWidth,wrap:false});};ta.prototype.renderNamedThreadParticipantCount=function(ab){"use strict";ra.getThreadMeta(this._threadID,function(bb){if(bb.name){var cb=qa.renderParticipantCount(bb.thread_id,{count:bb.participants.length}),db=m.create('span',{className:"_1us"},oa._("({participants})",[oa.param("participants",cb)]));m.appendContent(ab,db);}},w.WEBMESSENGER);};ta.prototype.renderParticipantListFlyout=function(ab){"use strict";this._dialog&&this._dialog.destroy();delete this._dialog;this._flyout&&this._flyout.destroy();delete this._flyout;var bb=this._threadID;ra.getThreadMeta(this._threadID,function(cb){var db=cb.participants;if(!cb.name){db=db.filter(function(eb){return eb!==z.getID();});if(db.length<=1)return;}aa.getMulti(db,function(eb){if(this._threadID!=bb)return;var fb=0,gb=ga[':fb:web-messenger:flyoutlist'].build();for(var hb in eb){if(!eb.hasOwnProperty(hb))continue;var ib=eb[hb],jb=ga[':fb:web-messenger:flyoutlist-profile-item'].build();jb.getNode('profilePhoto').setAttribute('src',ib.image_src);var kb=jb.getNode('title');if(ib.href){var lb=r.a({href:ib.href});m.setContent(kb,lb);kb=lb;var mb=jb.getNode('profilePhoto'),nb=r.a({href:ib.href});m.replace(mb,nb);m.setContent(nb,mb);if(ea.getStandaloneMode()){lb.setAttribute('target','_blank');nb.setAttribute('target','_blank');}}m.setContent(kb,ib.name);va(ib,jb.getNode('title'));m.setContent(jb.getNode('infoLine'),ya(ib));fb++;m.appendContent(gb.getNode('list'),jb.getRoot());}var ob=gb.getRoot();this._dialog=new k({context:ab,position:'below',addedBehaviors:[t,u,v]},ob);this._flyout=new q();this._flyout.init(this._dialog);this._flyout.initNode(ab);xa(this._flyout,ob,fb);}.bind(this));}.bind(this),w.WEBMESSENGER);};ta.prototype.destroy=function(){"use strict";};function ua(ab,bb,cb){var db=s.getShortDisplay(cb);if(!db||ab.get(cb)!==i.MOBILE){ha.remove(bb);return;}ha.set(bb,oa._("Last active {time} ago",[oa.param("time",db)]),'right');}function va(ab,bb){var cb=x.getUserIDFromParticipantID(ab.id);if(!cb)return;var db=r.span(null);ba.updateOnPresenceChanges(cb,db);if(m.isNode(bb)){j.loadModules(["PresenceStatus","ChatOpenTab"],function(eb,fb){o.listen(db,'mouseenter',na(ua,eb,db,cb));o.listen(db,'click',fb.openUserTab.bind(null,cb,'web messenger header'));});m.appendContent(bb,db);}}function wa(ab,bb){if(bb)aa.getMulti(ab.participants,function(cb){var db=true;for(var eb in cb)if(cb.hasOwnProperty(eb))db=db&&cb[eb].employee;l.conditionShow(bb,db);});}function xa(ab,bb,cb){if(cb<=ia.MAX_VISIBLE_IN_FLYOUT)return;var db=ca.fromNative(bb,{fade:true});bb.style.height=ia.PARTICIPANTS_FLYOUT_HEIGHT+'px';ab.subscribe('show',function(){db.showScrollbar(false);});}function ya(ab){var bb=ab.social_snippets||{},cb=Object.keys(bb);if(cb.length>0){var db=cb.slice(0,1).map(function(ib){return bb[ib];});return db;}var eb=ab.networks||{},fb=Object.keys(eb),gb=fb.length>0,hb=2;if(gb){var db=fb.slice(0,hb).map(function(ib){return eb[ib];});return db.join(' \u00b7 ');}return '';}function za(ab,bb,cb,db){var eb=cb.offsetWidth;if(db){sa=sa||db.offsetWidth;eb+=sa;}var fb=m.scry(document.body,"div._2nd");if(fb.length)eb+=fb[0].offsetWidth;var gb=ab.parentNode.offsetWidth;if(gb>eb)fa.set(ab,'max-width',(gb-eb)+'px');}e.exports=ta;},null);
__d("WebMessengerFlexibleArea",["Event","ArbiterMixin","CSS","cx","DOM","Style","throttle","Vector","createArrayFromMixed","mixin"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){b.__markCompiled&&b.__markCompiled();var q=[];function r(){q.forEach(function(w){w.draw();});}g.listen(window,'resize',m(r,50));var s=p(h);for(var t in s)if(s.hasOwnProperty(t))v[t]=s[t];var u=s===null?null:s.prototype;v.prototype=Object.create(u);v.prototype.constructor=v;v.__superConstructor__=s;function v(w){"use strict";s.call(this);this.minFlexAreaHeight=0;this.flexArea=w;this.container=null;this.padding=0;this.sizeToFit=false;q.push(this);}v.prototype.setContainer=function(w){"use strict";this.container=w;return this;};v.prototype.setPadding=function(w){"use strict";this.padding=w;return this;};v.prototype.setMinFlexAreaHeight=function(w){"use strict";this.minFlexAreaHeight=w;return this;};v.prototype.setSizeToFit=function(w){"use strict";this.sizeToFit=w;return this;};v.prototype.draw=function(){"use strict";if(this.flexArea){var w=this._flexHeight;this.inform('predraw',{old_height:w});var x=n.getViewportDimensions().y-this.padding;x-=n.getElementPosition(this.container||this.flexArea).y;if(this.container){o(this.container.childNodes).forEach(function(y){x-=n.getElementDimensions(y).y;});x+=n.getElementDimensions(this.flexArea).y;}if(this.sizeToFit)x=Math.min(x,this._getNaturalHeight());if(x<this.minFlexAreaHeight)x=this.minFlexAreaHeight;if(isNaN(x)||x<0)x=0;if(x!==w){l.set(this.flexArea,'height',x+'px');this._flexHeight=x;this.inform('height_changed',{height:x,old_height:w});}}return this;};v.prototype.destroy=function(){"use strict";var w=q.indexOf(this);w>=0&&q.splice(w,1);r();};v.prototype._getNaturalHeight=function(){"use strict";var w=this.flexArea.cloneNode(true);i.addClass(w,"_2ys");l.set(w,'height','auto');k.insertAfter(this.flexArea,w);var x=n.getElementDimensions(w).y;k.remove(w);return x;};v.prototype._getFlexHeight=function(){"use strict";if(isNaN(this._flexHeight))this._flexHeight=n.getElementDimensions(this.flexArea).y;return this._flexHeight;};e.exports=v;},null);
__d("WebMessengerFlexibleScrollArea",["CSS","DOMQuery","ScrollableArea","Style","WebMessengerFlexibleArea","throttle"],function(a,b,c,d,e,f,g,h,i,j,k,l){b.__markCompiled&&b.__markCompiled();for(var m in k)if(k.hasOwnProperty(m))o[m]=k[m];var n=k===null?null:k.prototype;o.prototype=Object.create(n);o.prototype.constructor=o;o.__superConstructor__=k;function o(p,q){"use strict";k.call(this,p);this._scroll=i.fromNative(p,q);this._scrollBody=h.find(this.flexArea,'.uiScrollableAreaBody');var r=h.scry(this.flexArea,'.uiScrollableAreaShadow');this._shadow=r.length?r[0]:null;this._scrollContent=h.find(this.flexArea,'.uiScrollableAreaContent');this._scrollCallbacks=[];this._drawSubscription=this.subscribe('height_changed',this.poke.bind(this));this._scrollSub=this._scroll.subscribe('scroll',l(this._onScroll,50,this));this._nearTop=false;this._nearBottom=false;}o.prototype.showAtTop=function(p){"use strict";if(p){j.set(this._scrollContent,'top','0');j.set(this._scrollContent,'bottom','');}else{j.set(this._scrollContent,'top','');j.set(this._scrollContent,'bottom','0');}};o.prototype.setBottomAligned=function(p){"use strict";var q=p!==false;if(this._bottomEdgeBias===q)return;g.conditionClass(this.flexArea,'uiScrollableAreaBottomAligned',q);this._bottomEdgeBias=q;if(this._bottomEdgeBias){this.scrollToBottom(false);}else this.scrollToTop(false);setTimeout(this.poke.bind(this),0);return this;};o.prototype.setInfiniteScrollHandler=function(p,q){"use strict";if(q){this._infiniteUpwardScrollHandler=p;}else this._infiniteDownScrollHandler=p;return this;};o.prototype.addScrollCallback=function(p){"use strict";this._scrollCallbacks.push(p);return this;};o.prototype.setTabbable=function(p){"use strict";this._scroll._wrap.setAttribute('tabindex',p?'0':'-1');};o.prototype.poke=function(p,q){"use strict";var r=this._scrollHeight,s=this._scroll.getScrollTop();this._scrollHeight=this._getScrollHeight();if(typeof r=='undefined'||(q&&!q.old_height)){this._bottomEdgeBias&&this._setShadowHeight();return;}var t=this._scrollHeight-r;if(this._bottomEdgeBias){var u=q?q.height-q.old_height:0;clearTimeout(this._pollTimer);this._pollTimer=setTimeout(this.poke.bind(this),200);var v,w=t-u;if(this._scrollHeight>this._getFlexHeight()){v=s+w;v=v<0?0:v;}else v=0;w>0&&this._setShadowHeight();if(v!==s)this._scroll.setScrollTop(v,false);w<0&&this._setShadowHeight();}else if(t)this._scroll.setScrollTop(s,false);};o.prototype.setScrollTop=function(p,q){"use strict";this._scroll.setScrollTop(p,q);};o.prototype.getScrollableArea=function(){"use strict";return this._scroll;};o.prototype.isScrolledToBottom=function(){"use strict";return this._scroll.isScrolledToBottom();};o.prototype.scrollToBottom=function(p){"use strict";this._scroll.scrollToBottom(p);if(this._bottomEdgeBias)this._scrollBottom=0;};o.prototype.isScrolledToTop=function(){"use strict";return this._scroll.getScrollTop()===0;};o.prototype.scrollToTop=function(p){"use strict";this._scroll.scrollToTop(p);};o.prototype.scrollIntoView=function(p,q){"use strict";this._scroll.scrollIntoView(p,q);};o.prototype.destroy=function(){"use strict";this._scrollSub&&this._scrollSub.unsubscribe();this.unsubscribe(this._drawSubscription);clearTimeout(this._pollTimer);n.destroy.call(this);this._scroll.destroy();};o.prototype._getScrollHeight=function(){"use strict";if(this._bottomEdgeBias){return this._scrollContent.offsetHeight;}else return this._scroll.getScrollHeight();};o.prototype._setShadowHeight=function(){"use strict";var p=this._shadowHeight;this._shadowHeight=this._scrollHeight-this._getFlexHeight();if(this._shadowHeight<0)this._shadowHeight=0;if(this._shadowHeight!==p)j.set(this._shadow,'height',this._shadowHeight+'px');};o.prototype._onScroll=function(){"use strict";var p=this._scroll.getScrollTop(),q=this._getScrollHeight();if(p<this._getFlexHeight()){if(!this._nearTop){this._nearTop=true;this._infiniteUpwardScrollHandler&&this._infiniteUpwardScrollHandler();}}else this._nearTop=false;if(p+2*this._getFlexHeight()>q){if(!this._nearBottom){this._nearBottom=true;this._infiniteDownScrollHandler&&this._infiniteDownScrollHandler();}}else this._nearBottom=false;this._scrollCallbacks.forEach(function(r){return r(this._scroll);}.bind(this));};e.exports=o;},null);
__d("ListInputTargetTracker",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();function g(){"use strict";this._index=(void 0);this._items=[];}g.prototype.getIndex=function(){"use strict";return this._index;};g.prototype.setIndex=function(h){"use strict";this._index=Math.max(0,Math.min(h,this._items.length-1));};g.prototype.getNumItems=function(){"use strict";return this._items.length;};g.prototype.getItem=function(){"use strict";if(this._index!==(void 0))return this._items[this._index];};g.prototype.setTargetItem=function(h){"use strict";this.updateIndex(this._items,h);};g.prototype.addItem=function(h){"use strict";this._items.push(h);};g.prototype.removeItemAtIndex=function(h){"use strict";this._items.splice(h,1);};g.prototype.removeItemByValue=function(h){"use strict";var i=this._items.indexOf(h);this.removeItemAtIndex(i);};g.prototype.moveUp=function(){"use strict";if(this._index===(void 0)||this._index===0){if(this._items.length){this._index=this._items.length-1;return true;}}else if(this._index>0){this._index--;return true;}return false;};g.prototype.moveDown=function(){"use strict";if(this._index===(void 0)||this._index===this._items.length-1){if(this._items.length){this._index=0;return true;}}else if(this._index<this._items.length-1){this._index++;return true;}return false;};g.prototype.updateIndex=function(h,i){"use strict";this._items=h||[];if(i){var j=this._items.indexOf(i);if(j>=0){this._index=j;}else if(this._index!==(void 0))if(this._items.length>0){this._index=Math.min(this._index,this._items.length-1);}else this._index=(void 0);}else this._index=(void 0);return this._index;};e.exports=g;},null);
__d("WebMessengerShortcuts",["DialogX","DOM","KeyEventController","LayerHideOnEscape","ListInputTargetTracker","MercuryAPIArgsSource","MessagingTag","Parent","WebMessengerStateConstants","WebMessengerStateManager","WebMessengerTemplates","UserAgent_DEPRECATED","WebMessengerEvents","BanzaiODS","arrayContains","csx","cx","fbt","ge","shield","MercuryThreadActions","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z){b.__markCompiled&&b.__markCompiled();var aa=b('MercuryThreadActions').get(),ba=b('MercuryThreads').get(),ca=null,da=null,ea=null,fa={g:{callback:la,description:x._("Search conversations"),section:'searchAndHelp',uses_meta:true},m:{callback:ka,description:x._("Start a new message"),section:'navigation',uses_meta:true},i:{callback:ta.bind(null,m.INBOX),description:x._("Go to Inbox"),section:'navigation',uses_meta:true},u:{callback:ta.bind(null,m.OTHER),description:x._("Go to Other"),section:'navigation',uses_meta:true},z:{callback:na,description:x._("Archive\/unarchive conversation"),otherKeys:['y'],section:'conversation',uses_meta:true},r:{callback:oa,description:x._("Mark message as read\/unread"),section:'conversation',uses_meta:true},UP:{callback:pa,description:x._("Select next conversation"),section:'navigation',uses_meta:false},DOWN:{callback:qa,description:x._("Select previous conversation"),section:'navigation',uses_meta:false},q:{callback:z(va),description:x._("Show\/hide keyboard shortcuts"),section:'searchAndHelp',uses_meta:true}},ga={registerGeneralShortcuts:function(){da=new k();for(var wa in fa){var xa=fa[wa],ya=[wa];if(xa.otherKeys)ya=xa.otherKeys.concat(ya);for(var za=0;za<ya.length;za++)i.registerKey(ya[za],xa.callback,ja.bind(null,xa.uses_meta));}},updateThreadlistIndex:function(wa,xa,ya){ca=wa;if(da){if(!u(xa,ya))ya=null;da.updateIndex(xa,ya);}},openSearchThread:function(){var wa=sa(),xa=p.getCurrentMasterState();if(wa&&xa==o.MASTER.SEARCH)ca.openSearchThread(wa);},showOrHideShortcuts:va};function ha(){return r.osx()?'CTRL':'ALT';}function ia(wa){function xa(){if(!ea){var ya=h.find(document.body,"._ksg");ea=[];do{ya=ya.parentNode;ea.push(ya);}while(ya&&ya!==document.body);}return ea;}if(!n.byClass(wa,"_ksg"))if(!u(xa(),wa))if(!h.scry(wa,"._5hu2").length)return false;return true;}function ja(wa,event,xa){if(!i.filterEventTypes(event,xa))return false;if(!ia(event.getTarget()))return false;var ya;if(wa)switch(ha()){case 'CTRL':ya='ctrlKey';break;case 'ALT':ya='altKey';break;}var za=['ctrlKey','metaKey','altKey','shiftKey'];for(var ab=0;ab<za.length;ab++)if(za[ab]!==ya&&event[za[ab]])return false;return !wa||event[ya];}function ka(){t.bumpEntityKey('kbshorts_messenger','kbshorts.compose');p.updateDetailState(o.DETAIL.COMPOSE_MAIN,{start:true});return false;}function la(){t.bumpEntityKey('kbshorts_messenger','kbshorts.search');s.focusAndSelectSearch();return false;}function ma(wa){var xa;if(da.getNumItems()>1){var ya=da.getIndex();da.setIndex(ya===0?1:ya-1);xa=sa();}wa();p.updateDetailState(o.DETAIL.RECENT_MESSAGES,{folder:p.getCurrentStateData().folder,thread_id:xa});if(xa)ca._manager.scrollIntoView(y(da.getItem()),false);}function na(){t.bumpEntityKey('kbshorts_messenger','kbshorts.toggle_archive');var wa=sa();if(wa){ba.getThreadMeta(wa,function(xa){if(xa.folder==m.SPAM)return;ma(function(){if(xa.is_archived){aa.unarchive(xa.thread_id);}else aa.archive(xa.thread_id);});},l.WEBMESSENGER);return false;}}function oa(){var wa=sa();t.bumpEntityKey('kbshorts_messenger','kbshorts.toggle_read_status');if(wa){ba.getThreadMeta(wa,function(xa){var ya=!xa.unread_count;ya?aa.markUnread(wa):aa.markRead(wa);},l.WEBMESSENGER);return false;}}function pa(){t.bumpEntityKey('kbshorts_messenger','kbshorts.go_to_next');if(da)if(da.getIndex()===0){switch(p.getCurrentMasterState()){case o.MASTER.SEARCH:da.moveUp();ra();ca._manager.scrollToBottom(false);break;default:ca._manager.scrollToTop(false);s.focusSearch();}}else{if(da.getItem()){da.moveUp();}else da.moveDown();ra();}return false;}function qa(){t.bumpEntityKey('kbshorts_messenger','kbshorts.go_to_previous');var wa=p.getCurrentMasterState();if(da&&(wa!==o.MASTER.RECENT_THREADS||da.getIndex()<da.getNumItems()-1)){da.moveDown();ra();}return false;}function ra(){var wa=sa();if(wa){var xa=p.getCurrentMasterState();if(xa==o.MASTER.SEARCH){ca.updateKeyboardSelection(wa);s.focusSearch();}else p.updateDetailState(o.DETAIL.RECENT_MESSAGES,{thread_id:wa});if(da)if(da.getIndex()===0){ca._manager.scrollToTop(false);}else ca._manager.scrollIntoView(y(da.getItem()),false);}}function sa(){var wa=da&&da.getItem();if(typeof wa==='string'&&wa.indexOf(':')!==-1)return wa.substr(wa.indexOf(':')+1);return null;}function ta(wa){if(wa===m.INBOX){t.bumpEntityKey('kbshorts_messenger','kbshorts.go_to_inbox');}else if(wa===m.OTHER)t.bumpEntityKey('kbshorts_messenger','kbshorts.go_to_other');var xa=p.getCurrentMasterState(),ya=xa==o.MASTER.SEARCH?null:p.getCurrentStateData().thread_id;p.updateMasterState(o.MASTER.RECENT_THREADS,{thread_id:ya,folder:wa});}var ua;function va(wa){t.bumpEntityKey('kbshorts_messenger','kbshorts.show_or_hide_shortcuts');if(!ua){var xa={};for(var ya in fa){var za=fa[ya];if(!za.uses_meta)continue;var ab=q[':fb:web-messenger:shortcuts-dialog:row'].build(),bb=[ya],cb=[];if(za.otherKeys)bb=za.otherKeys.concat(bb);for(var db=0;db<bb.length;db++){var eb=q[':fb:web-messenger:shortcuts-dialog:key'].build();eb.setNodeContent('meta',ha());eb.setNodeContent('key',bb[db]);cb.push(eb.getRoot());}ab.setNodeContent('keys',cb);ab.setNodeContent('description',za.description);if(!xa[za.section])xa[za.section]=[];xa[za.section].push(ab.getRoot());}var fb=q[':fb:web-messenger:shortcuts-dialog'].build();for(var gb in xa)fb.setNodeContent(gb,xa[gb]);var hb=h.scry(fb.getRoot(),"._1yw")[0],ib=null;if(hb)ib=h.getID(hb);ua=new g({modal:true,titleID:ib,width:565},fb.getRoot());ua.enableBehavior(j);}if(ua.isShown()){ua.hide();}else{ua.show();if(typeof wa==='function')ua.subscribeOnce('hide',wa);}return false;}e.exports=ga;},null);
__d("WebMessengerActionsMenuItem",["CSS","MenuItem","WebMessengerStateManager"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();for(var j in h)if(h.hasOwnProperty(j))l[j]=h[j];var k=h===null?null:h.prototype;l.prototype=Object.create(k);l.prototype.constructor=l;l.__superConstructor__=h;function l(m){"use strict";m.href=m.href||'#';h.call(this,m);this.setOnClickHandler(this.handleMenuItemClick);this.showFn=this._data.should_show_fn;this.hasAction=function(){return !this._data.hideManually;}.bind(this);}l.prototype.handleMenuItemClick=function(){"use strict";var m=i.getCurrentStateData().thread_id;m&&this._data.onclick(m);};l.prototype.updateShownState=function(m){"use strict";if(this.showFn){this._isHidden=!this.showFn(m);if(this._root)g.conditionShow(this._root,!this._isHidden);}};l.prototype.isShown=function(m){"use strict";var n=this.showFn?this.showFn(m):true;return n;};l.prototype.render=function(){"use strict";var m=k.render.call(this);if(this._isHidden)g.hide(m);return m;};e.exports=l;},null);
__d("XMessagingLeaveConversationDialogController",["XController"],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports=b("XController").create("\/leave_conversation\/",{__asyncDialog:{type:"Int"}});},null);
__d("WebMessengerDetailViewActionsMenuControl",["WebMessengerAddPeopleToConversationDialog","AsyncDialog","AsyncRequest","ChatOpenTab","ContextualDialogArrow","CSS","CurrentUser","WebMessengerDeleteThreadDialog","DOM","WebMessengerEditThreadDialog","Event","FBRTCCore","FBRTCCallabilityStore","Input","Keys","Menu","MenuSeparator","MercuryAPIArgsSource","MercuryIDs","MercuryLogMessageType","MercurySourceType","MercuryThreadInfo","MercuryThreadMuter","MercuryViewer","MessagingTag","MercuryParticipants","Popover","PopoverMenu","WebMessengerShortcuts","WebMessengerStateConstants","WebMessengerStateManager","WebMessengerTemplates","Toggler","URI","WebMessengerActionsMenuItem","WebMessengerSubscriptionsHandler","XMessagingLeaveConversationDialogController","XUIMenuTheme","XNFXStartForMessageThreadController","MercuryMessengerBlockingUtils","emptyFunction","fbt","goURI","MercuryThreadIDMap","MercuryMessageObject","MercuryMessageActions","MercuryThreadActions","MercuryThreadInformer","MercuryThreads","WebMessengerDetailViewCallButtonManager"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la,ma,na,oa,pa,qa,ra,sa,ta,ua,va,wa){b.__markCompiled&&b.__markCompiled();var xa=b('MercuryThreadIDMap').get(),ya=b('MercuryMessageObject').get(),za=b('MercuryMessageActions').get(),ab=b('MercuryThreadActions').get(),bb=b('MercuryThreadInformer').get(),cb=b('MercuryThreads').get(),db=b('WebMessengerDetailViewCallButtonManager').module;function eb(wc,xc){"use strict";this._rootElement=wc;this._headerControl=xc;this._menuTemplate=la[':fb:web-messenger:actions-menu'].build();this._newMessageButton=this._menuTemplate.getNode('newMessageButton');this._actionsMenu=this._menuTemplate.getNode('menu');this._searchThreadInput=this._menuTemplate.getNode('searchThreadInput');this._searchThreadButton=this._menuTemplate.getNode('searchThreadButton');this._searchCloseButton=this._menuTemplate.getNode('searchCloseButton');this._videoCallButton=this._menuTemplate.getNode('videoCallButton');var yc=this._menuTemplate.getNode('actionsButton'),zc=function(event){if(!this._searchMode){gb(this,true);}else{var ad=t.getValue(this._searchThreadInput);if(ad){var bd=Object.assign({},ka.getCurrentStateData(),{message_query:ad});ka.updateDetailState(ja.DETAIL.SEARCH_THREAD_SNIPPET,bd);this._searchThreadInput.focus();}else gb(this,false);}event.kill();}.bind(this);pa.addSubscriptions(bb.subscribe('threads-updated',function(ad,bd){bd[this._threadID]&&this.updateView();}.bind(this)),q.listen(this._menuTemplate.getNode('newMessageButton'),'click',function(){ka.updateDetailState(ja.DETAIL.COMPOSE_MAIN,Object.assign({},ka.getCurrentStateData(),{start:true,thread_id:(void 0)}));}),q.listen(this._actionsMenu,'keydown',function(event){if(event.keyCode===u.ESC){yc.focus();event.preventDefault();}}),q.listen(this._searchThreadButton,'mousedown',zc),q.listen(this._searchThreadButton,'keydown',function(event){if(event.keyCode===u.RETURN||event.keyCode===u.SPACE)zc(event);}),q.listen(this._searchThreadButton,'click',ua.thatReturnsFalse),q.listen(this._searchCloseButton,'keydown',function(event){if(event.keyCode===u.RETURN||event.keyCode===u.SPACE){ib(this);this._menuTemplate.getNode('searchThreadButton').focus();}}.bind(this)),q.listen(this._searchCloseButton,'mousedown',function(event){ib(this);}.bind(this)),q.listen(this._searchThreadInput,'blur',function(event){var ad=t.getValue(this._searchThreadInput);if(!ad)gb(this,false);}.bind(this)),q.listen(this._searchThreadInput,'keyup',function(event){var ad=t.getValue(this._searchThreadInput),bd=Object.assign({},ka.getCurrentStateData(),{message_query:ad});if(event.keyCode==u.RETURN&&ad)ka.updateDetailState(ja.DETAIL.SEARCH_THREAD_SNIPPET,bd);if(event.keyCode==u.ESC)t.reset(this._searchThreadInput);}.bind(this)),q.listen(this._videoCallButton,'click',function(){db.onCallClicked(this._threadID);}.bind(this)),s.addListener(function(){db.updateVideoCallButton(this._videoCallButton,this._threadID);}.bind(this)));this.initItems();o.setContent(this._rootElement,this._menuTemplate.getRoot());}eb.prototype.initItems=function(){"use strict";var wc=this._menuTemplate.getNode('actionsButton'),xc=this._menuTemplate.getNode('newMessageButton'),yc=function(){wc.focus();},zc=function(){xc.focus();};this.menuItems=[];this.menuItems.push({ctor:oa,label:va._("Add People..."),onclick:fc,should_show_fn:kb},{ctor:oa,label:va._("Edit Participants..."),onclick:gc,should_show_fn:kb},{ctor:oa,hideManually:true,label:va._("Edit Conversation Name..."),onclick:ic.bind(null,this),should_show_fn:kb},{ctor:oa,hideManually:true,label:va._("Edit Conversation Picture..."),onclick:ic.bind(null,this),should_show_fn:kb},{ctor:oa,label:va._("Leave Conversation..."),onclick:hc,should_show_fn:kb},{ctor:w,should_show_fn:kb});this.menuItems.push({ctor:oa,hideManually:true,label:va._("Open in Chat"),onclick:lb,should_show_fn:j.canOpenTab},{ctor:oa,label:va._("View Photos in Thread"),onclick:dc},{ctor:oa,label:va._("Mark as Read"),onclick:qc.bind(null,yc),should_show_fn:yb},{ctor:oa,label:va._("Mark as Unread"),onclick:pc.bind(null,yc),should_show_fn:tb(yb)});this.menuItems.push({ctor:w},{ctor:oa,label:va._("Move to Work Account"),onclick:rb,should_show_fn:qb},{ctor:oa,label:va._("Archive"),onclick:kc.bind(null,zc),should_show_fn:tb(xb)},{ctor:oa,label:va._("Unarchive"),onclick:lc.bind(null,zc),should_show_fn:xb},{ctor:oa,label:va._("Mute Conversation..."),onclick:function(ad){ca.showMuteChangeDialog(ad,wc);},should_show_fn:tb(ba.isMuted)},{ctor:oa,label:va._("Unmute Conversation"),onclick:hb.bind(null,yc),should_show_fn:ba.isMuted},{ctor:oa,label:va._("Move to Inbox"),onclick:nb.bind(null,zc,ea.INBOX),should_show_fn:mb.bind(null,ea.OTHER)},{ctor:oa,hideManually:true,label:va._("Delete Conversation..."),onclick:sb},{ctor:oa,label:va._("Delete Messages..."),onclick:rc});this.menuItems.push({ctor:w},{ctor:oa,label:va._("Create Group..."),onclick:nc,should_show_fn:ob},{ctor:oa,label:va._("Create Event..."),onclick:oc,should_show_fn:pb},{ctor:oa,label:va._("Block Messages..."),onclick:ac.bind(null),should_show_fn:ub},{ctor:oa,label:va._("Unblock Messages..."),onclick:bc.bind(null),should_show_fn:vb},{ctor:oa,label:va._("Report Spam or Abuse..."),onclick:cc.bind(null,yc),should_show_fn:tb(wb)},{ctor:oa,label:va._("Not Spam"),onclick:ec.bind(null,zc),should_show_fn:wb},{ctor:oa,hideManually:true,label:va._("Keyboard Shortcuts"),onclick:vc.bind(null,yc)},{ctor:oa,label:va._("Feedback"),onclick:wa.bind(null,'/help/?page=134259426717336')});if(jb())this.menuItems.push({ctor:w},{ctor:oa,label:'Enable bug reporting',onclick:sc.bind(null,yc),should_show_fn:tb(zb)},{ctor:oa,label:'Disable bug reporting',onclick:tc.bind(null,yc),should_show_fn:zb});this._menu=new v(this.menuItems,{theme:ra});new ha(new ga(wc.parentNode,wc,[k],{alignh:'right'}),wc,this._menu);};eb.prototype.hideView=function(){"use strict";l.hide(this._rootElement);};eb.prototype.updateView=function(){"use strict";this.hideView();var wc=ka.getCurrentDetailState(),xc=false,yc=false,zc=false,ad=false,bd=false,cd=false;switch(wc){case ja.DETAIL.COMPOSE_MAIN:case ja.DETAIL.COMPOSE_TYPEAHEAD_RESULTS:case ja.DETAIL.COMPOSE_ALL_PEOPLE_RESULTS:fb(this);this._threadID=null;break;case ja.DETAIL.RECENT_MESSAGES:case ja.DETAIL.SEARCH_CONTEXT:if(this._state!==wc)fb(this);var dd=ka.getCurrentStateData().thread_id;xc=true;if(this._searchMode&&this._threadID===dd){ad=true;}else{fb(this);yc=true;zc=true;}this._threadID=dd;if(this._threadID)bd=true;break;case ja.DETAIL.SEARCH_THREAD_SNIPPET:var ed=ka.getCurrentStateData();t.setValue(this._searchThreadInput,ed.message_query);this._threadID=ed.thread_id;xc=true;ad=true;cd=true;break;case ja.DETAIL.SHARED_PHOTOS:var fd=ka.getCurrentStateData();this._threadID=fd.thread_id;xc=true;yc=true;zc=true;bd=true;break;default:fb(this);xc=true;yc=true;this._threadID=null;break;}this._state=wc;l.conditionShow(this._searchThreadInput,ad);l.conditionShow(this._searchThreadButton,bd);l.conditionShow(this._searchCloseButton,cd);l.conditionShow(this._newMessageButton,yc);l.conditionShow(this._rootElement,xc);db.updateVideoCallButton(this._videoCallButton,this._threadID);l.conditionShow(this._videoCallButton,db.isVideoCallableThread(this._threadID)&&!this._searchMode&&r.shouldEnableVideoCalling());this._threadSubscription&&cb.unsubscribe(this._threadSubscription);if(zc&&this._threadID){this._threadSubscription=cb.getThreadMeta(this._threadID,function(gd){this._menu.forEachItem(function(hd){return hd.updateShownState&&hd.updateShownState(gd);});l.show(this._menuTemplate.getNode('menu'));l.show(this._rootElement);}.bind(this),x.WEBMESSENGER);}else l.hide(this._menuTemplate.getNode('menu'));};eb.prototype.destroy=function(){"use strict";};function fb(wc){wc._searchMode=false;t.reset(wc._searchThreadInput);}function gb(wc,xc){if(xc){wc._searchMode=true;}else fb(wc);l.conditionShow(wc._newMessageButton,!xc);l.conditionShow(wc._videoCallButton,!xc&&db.isVideoCallableThread(wc._threadID));l.conditionShow(wc._actionsMenu,!xc);l.conditionShow(wc._searchThreadInput,xc);if(xc){wc._searchThreadInput.focus();ma.hide(this._actionsMenu);}}function hb(wc,xc){ab.unmute(xc);ma.hide();wc();}function ib(wc){gb(wc,false);l.conditionShow(wc._searchThreadButton,true);l.conditionShow(wc._searchCloseButton,false);var xc=ka.getCurrentDetailState();if(xc!==ja.DETAIL.RECENT_MESSAGES)ka.updateDetailState(ja.DETAIL.RECENT_MESSAGES,{thread_id:ka.getCurrentStateData().thread_id});}function jb(){var wc=fa.getNow(da.getID());return wc&&wc.employee;}function kb(wc){return !wc.is_canonical&&wc.is_subscribed&&!wc.has_email_participant&&!wc.read_only;}function lb(wc){ma.hide();j.openThread(wc,'WebMessengerDetailViewActionsMenuControl');}function mb(wc,xc){return !xc.is_archived&&xc.folder==wc;}function nb(wc,xc,yc){ab.changeFolder(yc,xc);uc();wc();}function ob(wc){var xc=mc(wc.participants);return xc.length>2;}function pb(wc){var xc=mc(wc.participants);return xc.length>2;}function qb(wc){if(!m.isEmployee()||!m.hasWorkUser()||!y.isGroupChat(wc.thread_id))return false;var xc=wc.participants;for(var yc=0;yc<xc.length;++yc)if(!fa.getNow(xc[yc]).employee)return false;return true;}function rb(wc){if(!cb.isEmptyLocalThread(wc)){var xc=ya.constructLogMessageObject(aa.MESSENGER_WEB,wc,z.SWITCH_TO_WORK,{removed_participants:[da.getID()]});za.send(xc,null,x.WEBMESSENGER);uc();}return true;}function sb(wc){ma.hide();ka.updateDetailState(ja.DETAIL.RECENT_MESSAGES,ka.getCurrentStateData());n.show(wc);}function tb(wc){return function(){return !wc.apply(this,arguments);};}function ub(wc){return wc.is_canonical&&ta.gk_result&&!ba.isMessageBlocked(wc);}function vb(wc){return wc.is_canonical&&ta.gk_result&&ba.isMessageBlocked(wc);}function wb(wc){return wc.folder===ea.SPAM;}function xb(wc){return wc.is_archived;}function yb(wc){return wc.unread_count>0;}function zb(){return ka.getCurrentStateData().bug_reporting_enabled;}function ac(wc){ab.blockMessages(wc);}function bc(wc){ab.unblockMessages(wc);}function cc(wc,xc){xa.getFBIDFromClientID(xc,function(yc){var zc=sa.getURIBuilder().setString('thread_fbid',yc).getURI();h.send(new i(zc));});}function dc(wc){ka.updateDetailState(ja.DETAIL.SHARED_PHOTOS,Object.assign({},ka.getCurrentStateData()));}function ec(wc,xc){ab.unmarkSpam(xc);uc();wc();}function fc(wc){g.show(wc);}function gc(wc){xa.getFBIDFromClientID(wc,function(xc){h.send(new i(new na('/ajax/browser/dialog/multichat_members/').addQueryData({id:xc})));});}function hc(wc){var xc=qa.getURIBuilder().getURI();h.send(new i(xc),function(yc){yc.subscribe('confirm',function(){jc(wc);yc.hide();});});}function ic(wc,xc){ma.hide();var yc=new p();yc.toggleShown(wc._headerControl?wc._headerControl._headerBar.getNode('headerName'):wc._rootElement,xc);}function jc(wc){za.send(ya.constructLogMessageObject(aa.TITAN_WEB,wc,z.UNSUBSCRIBE,{removed_participants:[da.getID()]}),null,x.WEBMESSENGER);return true;}function kc(wc,xc){ab.archive(xc);uc();wc();}function lc(wc,xc){ab.unarchive(xc);uc();wc();}function mc(wc){var xc=[];for(var yc=0;yc<wc.length;yc++){var zc=wc[yc];if(/^fbid:\d+$/.test(zc))xc.push(zc.substr(5));}return xc;}function nc(wc){cb.getThreadMeta(wc,function(xc){var yc=mc(xc.participants),zc=new na('/ajax/groups/create_get.php').addQueryData({ref:'web_messenger',members:yc,parent_id:'0'});h.send(new i(zc));},x.WEBMESSENGER);}function oc(wc){cb.getThreadMeta(wc,function(xc){var yc=mc(xc.participants),zc=new na('/ajax/plans/create/dialog.php').addQueryData({invite_ids:yc,eventname:xc.name,group_chat:true});h.send(new i(zc));},x.WEBMESSENGER);}function pc(wc,xc){ab.markUnread(xc);ma.hide();wc();}function qc(wc,xc){ab.markRead(xc);ma.hide();wc();}function rc(){var wc=Object.assign({},ka.getCurrentStateData(),{message_action:ja.MESSAGE_ACTION.DELETE});ka.updateDetailState(ka.getCurrentDetailState(),wc);}function sc(wc){var xc=Object.assign({},ka.getCurrentStateData(),{bug_reporting_enabled:true});ma.hide();ka.updateDetailState(ka.getCurrentDetailState(),xc);wc();}function tc(wc){var xc=Object.assign({},ka.getCurrentStateData(),{bug_reporting_enabled:false});ma.hide();ka.updateDetailState(ka.getCurrentDetailState(),xc);wc();}function uc(){ka.updateDetailState(ja.DETAIL.RECENT_MESSAGES,{folder:ka.getCurrentStateData().folder});}function vc(wc){ma.hide();ia.showOrHideShortcuts(wc);}e.exports=eb;},null);
__d("ExpandableDataSource",["DataSource"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();for(var h in g)if(g.hasOwnProperty(h))j[h]=g[h];var i=g===null?null:g.prototype;j.prototype=Object.create(i);j.prototype.constructor=j;j.__superConstructor__=g;function j(k,l,m){"use strict";k=k||{};k.maxResults=l;g.call(this,k);this._initialLimit=l;this._moreResultsLimit=m;this._states={};}j.prototype.query=function(k,l,m){"use strict";this.setQueryData({offset:0,limit:this._initialLimit});i.query.call(this,k,l,m);};j.prototype.fetchHandler=function(k,l){"use strict";var m=k.getPayload(),n=l.value;this.getState('is_loading_more_per_query')[n]=false;this.getState('total_results_count_per_query')[n]=m.total_count;i.fetchHandler.call(this,k,l);};j.prototype.loadMore=function(){"use strict";if(this.value&&!this.hasLoadedAllResults()){var k=this.getState('max_results_per_query');if(!k[this.value])k[this.value]=this._initialLimit;this.setQueryData({offset:k[this.value],limit:this._moreResultsLimit});k[this.value]+=this._moreResultsLimit;if(k[this.value]>this._maxResults)this._maxResults=k[this.value];this.getState('is_loading_more_per_query')[this.value]=true;this.fetch(this.queryEndpoint,this.getQueryData(this.value,this.buildUids(this.value)),{value:this.value});}};j.prototype.isLoadingMore=function(){"use strict";return this.getState('is_loading_more_per_query')[this.value];};j.prototype.hasLoadedAllResults=function(){"use strict";var k=this.getState('total_results_count_per_query')[this.value],l=(this.buildQueryResults(this.value)||[]).length;return k&&l>=k;};j.prototype.getStates=function(){"use strict";return this._states;};j.prototype.getState=function(k){"use strict";var l=this.getStates();if(!l[k])l[k]={};return l[k];};j.prototype.getQueryCache=function(){"use strict";return this.getState('query_cache');};e.exports=j;},null);
__d("WebMessengerDetailViewAllPeopleResultsControl",["Event","CSS","DataStore","DOM","ExpandableDataSource","MercuryIDs","Parent","WebMessengerStateConstants","WebMessengerStateManager","Token","WebMessengerEvents","cx","WebMessengerSubscriptionsHandler","WebMessengerTemplates"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){b.__markCompiled&&b.__markCompiled();var u=5,v=5;function w(ba){"use strict";this._rootElement=ba;j.empty(this._rootElement);var ca=t[':fb:web-messenger:all-people-results'].build();j.setContent(this._rootElement,ca.getRoot());this._loadingSpinner=ca.getNode('loadingSpinner');this._peopleResults=ca.getNode('results');this._loadMoreButton=ca.getNode('loadMoreButton');this._loadMoreLink=ca.getNode('loadMoreLink');s.addSubscriptions(g.listen(this._loadMoreLink,'click',function(){h.addClass(this._loadMoreButton,'async_saving');this._peopleDataSource&&this._peopleDataSource.loadMore();}.bind(this)));}w.prototype.hideView=function(){"use strict";h.hide(this._rootElement);};w.prototype.updateView=function(){"use strict";var ba=o.getCurrentDetailState();if(ba==n.DETAIL.COMPOSE_ALL_PEOPLE_RESULTS){h.show(this._rootElement);x(this);q.detailDOMChanged();}};w.prototype.destroy=function(){"use strict";};function x(ba){h.show(ba._loadingSpinner);h.hide(ba._peopleResults);h.hide(ba._loadMoreButton);var ca=o.getCurrentStateData(),da=ca.all_people_query||'';y(ba);var ea=(ca.participants||[]).map(function(fa){return l.tokenize(fa).value;});ba._peopleDataSource.setExclusions(ea);ba._peopleDataSource.query(da);}function y(ba){if(!ba._peopleDataSource){ba._peopleDataSource=new k({queryEndpoint:'/ajax/mercury/search_people.php'},u,v);ba._peopleDataSource.init();s.addSubscriptions(ba._peopleDataSource.subscribe('respond',z.bind(null,ba)),g.listen(ba._rootElement,'click',function(event){var ca=event.getTarget().parentNode;if(h.hasClass(ca,"_4wt"))aa(event.getTarget(),ba._peopleDataSource);}));}}function z(ba,ca,da){var ea=o.getCurrentDetailState(),fa=o.getCurrentStateData();if(ea==n.DETAIL.COMPOSE_ALL_PEOPLE_RESULTS&&fa.all_people_query==da.value){j.empty(ba._peopleResults);h.show(ba._peopleResults);da.results.forEach(function(ga){var ha=j.create('div',{className:'personResult'},ga.detail_markup);i.set(ha,'uid',ga.uid);j.appendContent(ba._peopleResults,ha);});if(da.results.length){h.hide(ba._loadingSpinner);h.conditionShow(ba._loadMoreButton,!ba._peopleDataSource.hasLoadedAllResults());h.conditionClass(ba._loadMoreButton,'async_saving',ba._peopleDataSource.isLoadingMore());}}}function aa(ba,ca){var da=m.byClass(ba,'personResult'),ea=ca.getEntry(i.get(da,'uid')),fa=Object.assign({},o.getCurrentStateData(),{new_tokens:[new p(ea)],start:false});o.updateDetailState(n.DETAIL.COMPOSE_MAIN,fa);}e.exports=w;},null);
__d("WebMessengerComposerTypeaheadView",["BucketedTypeaheadView","CSS","DataStore","MercuryTypeaheadConstants","WebMessengerStateConstants","WebMessengerStateManager","cx","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){b.__markCompiled&&b.__markCompiled();for(var o in g)if(g.hasOwnProperty(o))q[o]=g[o];var p=g===null?null:g.prototype;q.prototype=Object.create(p);q.prototype.constructor=q;q.__superConstructor__=g;function q(u,v){"use strict";g.call(this,u,v);this.typeObjects={};this.typeObjects[j.FRIEND_TYPE]={disabled:true,uid:j.FRIEND_TYPE,type:j.HEADER_TYPE};this.typeObjects[j.THREAD_TYPE]={uid:j.THREAD_TYPE,text:n._("Group Conversations"),type:j.HEADER_TYPE,linkText:n._("Show More"),getLinkHandler:t.bind(null,this)};this.typeObjects[j.PAGE_TYPE]={uid:j.PAGE_TYPE,text:n._("Businesses"),type:j.HEADER_TYPE};this.typeObjects[j.FB4C_TYPE]={uid:j.THREAD_TYPE,text:n._("Co-workers"),type:j.HEADER_TYPE};this.typeObjects[j.NON_FRIEND_TYPE]={uid:j.NON_FRIEND_TYPE,text:n._("Other People"),type:j.HEADER_TYPE,linkText:n._("Show All"),getLinkHandler:function(){return function(){s(this.value);}.bind(this);}.bind(this)};}q.prototype.setTypeahead=function(u){"use strict";p.setTypeahead.call(this,u);var v=i.get(u,'Typeahead');v.subscribe('loading',function(w,x){var y=v.getData();if(this._threadHeader)h.conditionClass(this._threadHeader,"_355",y.isLoadingMore(this.value));}.bind(this));};q.prototype.setNewHeader=function(u,v){"use strict";if(v.uid===j.THREAD_TYPE)this._threadHeader=u;};q.prototype.mouseover=function(event){"use strict";if(!r(this,event))p.mouseover.call(this,event);};q.prototype.mouseup=function(event){"use strict";if(!r(this,event))p.mouseup.call(this,event);};q.prototype.clearSelected=function(){"use strict";this.index=-1;this.highlight(-1);};function r(u,event){var v=u.getIndex(event);return v>=0&&v<u.results.length&&u.results[v].type==j.HEADER_TYPE;}function s(u){var v=Object.assign({},l.getCurrentStateData(),{all_people_query:u,start:false});l.updateDetailState(k.DETAIL.COMPOSE_ALL_PEOPLE_RESULTS,v);}function t(u){var v=i.get(u.typeahead,'Typeahead'),w=v.getData();if(w.hasLoadedInitialResults(u.value)&&!w.hasLoadedAllResults(u.value))return w.loadMore.bind(w);}e.exports=q;},null);
__d("MercuryDataSourceHelper",["MercuryPayloadSource","MercuryTypeaheadConstants","MercuryThreadMetadataRawRenderer","MercuryServerPayloadPreprocessor","MercuryThreadMetadataRenderer"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();var j=b('MercuryServerPayloadPreprocessor').get(),k=b('MercuryThreadMetadataRenderer').get(),l={updateMercuryOnFetchComplete:function(m){m.subscribe('fetchComplete',function(n,o){var p={participants:[],threads:[],pages:[],payload_source:g.SERVER_SEARCH};o.response.getPayload().entries.forEach(function(q){if(q.type==h.THREAD_TYPE){p.threads=p.threads.concat(q.mercury_thread);p.participants=p.participants.concat(q.participants_to_render);}else if(q.type==h.PAGE_TYPE)p.pages=p.pages.concat(q);});if(p.threads.length){j.handleUpdate(p);o.response.getPayload().entries.forEach(function(q){if(q.mercury_thread)q.text=k.renderThreadNameAndParticipantList(q.mercury_thread.thread_id,q.participants_to_render,q.mercury_thread.participants.length,{last_separator_uses_and:false,names_renderer:i.renderShortNames});});}});}};e.exports=l;},null);
__d("MercuryExpandableDataSource",["MercuryTypeaheadDataSource"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();for(var h in g)if(g.hasOwnProperty(h))j[h]=g[h];var i=g===null?null:g.prototype;j.prototype=Object.create(i);j.prototype.constructor=j;j.__superConstructor__=g;function j(k,l,m){"use strict";k=k||{};k.maxResults=l;g.call(this,k);this.$MercuryExpandableDataSource0=l;this.$MercuryExpandableDataSource1=m;this.$MercuryExpandableDataSource2={};}j.prototype.query=function(k,l,m){"use strict";this.setQueryData({offset:0,limit:this.$MercuryExpandableDataSource0});return i.query.call(this,k,l,m);};j.prototype.fetchHandler=function(k,l){"use strict";var m=k.getPayload(),n=l.value;this.getState('is_loading_more_per_query')[n]=false;this.getState('total_results_count_per_query')[n]=m.total_count;i.fetchHandler.call(this,k,l);};j.prototype.loadMore=function(){"use strict";if(this.value&&!this.hasLoadedAllResults()){var k=this.getState('max_results_per_query');if(!k[this.value])k[this.value]=this.$MercuryExpandableDataSource0;this.setQueryData({offset:k[this.value],limit:this.$MercuryExpandableDataSource1});k[this.value]+=this.$MercuryExpandableDataSource1;if(k[this.value]>this.$MercuryExpandableDataSource3)this.$MercuryExpandableDataSource3=k[this.value];this.getState('is_loading_more_per_query')[this.value]=true;this.fetch(this.queryEndpoint,this.getQueryData(this.value,this.buildUids(this.value)),{value:this.value});}};j.prototype.isLoadingMore=function(){"use strict";return this.getState('is_loading_more_per_query')[this.value];};j.prototype.hasLoadedAllResults=function(){"use strict";var k=this.getState('total_results_count_per_query')[this.value],l=(this.buildQueryResults(this.value)||[]).length;return k&&l>=k;};j.prototype.getStates=function(){"use strict";return this.$MercuryExpandableDataSource2;};j.prototype.getState=function(k){"use strict";var l=this.getStates();if(!l[k])l[k]={};return l[k];};e.exports=j;},null);
__d("WebMessengerTypeaheadDataSource",["MercuryExpandableDataSource","MercuryIDs","MercuryParticipants","MercuryTypeaheadConstants","WebMessengerStateManager"],function(a,b,c,d,e,f,g,h,i,j,k){b.__markCompiled&&b.__markCompiled();for(var l in g)if(g.hasOwnProperty(l))n[l]=g[l];var m=g===null?null:g.prototype;n.prototype=Object.create(m);n.prototype.constructor=n;n.__superConstructor__=g;function n(q){"use strict";q=q||{};q.kanaNormalization=true;g.call(this,q,j.COMPOSER_THREADS_INITIAL_LIMIT,j.COMPOSER_SHOW_MORE_LIMIT);this.setMaxResults(j.COMPOSER_WM_MAX);}n.prototype.bootstrap=function(){"use strict";if(!m.bootstrap.call(this))this.fetchEntryBigProfilePic();};n.prototype.updateBootstrapData=function(){"use strict";m.updateBootstrapData.call(this);this.fetchEntryBigProfilePic();};n.prototype.buildData=function(q){"use strict";var r=[],s=[],t=[],u=[],v=[];q.forEach(function(x){var y=m.getEntry.call(this,x);switch(y.render_type){case j.FRIEND_TYPE:if(r.length<j.COMPOSER_FRIENDS_MAX)r.push(x);break;case j.THREAD_TYPE:var z=y.mercury_thread.thread_fbid;y.uid=z;m.setEntry.call(this,z,y);if(o().length===0)s.push(z);break;case j.NON_FRIEND_TYPE:if(t.length<j.COMPOSER_NON_FRIENDS_MAX)t.push(x);break;case j.FB4C_TYPE:if(u.length<j.COMPOSER_FB4C_MAX)u.push(x);break;case j.PAGE_TYPE:if(v.length<j.COMPOSER_PAGES_MAX&&o().length===0)v.push(x);break;}},this);var w=r.concat(u,s,v,t);return m.buildData.call(this,w);};n.prototype.query=function(q,r,s){"use strict";this.value=q;if(!m.query.call(this,q,r,s)){if(this.getState('loaded_all_threads_per_query')[q]==null)this.getState('loaded_all_threads_per_query')[q]=true;this.getState('loaded_initial_per_query')[q]=true;}this.logQuery({event:'query_web_messenger',query:q});};n.prototype.respond=function(q,r,s){"use strict";var t=m.respond.call(this,q,r,s);this.logResponse({event:'query_response_web_messenger',response_query:q,response_uids:r});return t;};n.prototype.getQueryData=function(q,r){"use strict";var s=m.getQueryData.call(this,q,r);s.existing_token_ids=o();return s;};n.prototype.fetchHandler=function(q,r){"use strict";this.getState('loaded_all_threads_per_query')[r.value]=q.getPayload().end_of_threads;this.getState('loaded_initial_per_query')[r.value]=true;m.fetchHandler.call(this,q,r);};n.prototype.hasLoadedInitialResults=function(q){"use strict";if(q===(void 0))q=this.value;return this.getState('loaded_initial_per_query')[q]||(q&&q.length<=1);};n.prototype.hasLoadedAllResults=function(q){"use strict";if(q===(void 0))q=this.value;return this.getState('loaded_all_threads_per_query')[q];};n.prototype.fetchEntryBigProfilePic=function(){"use strict";var q=this.getCachedShortProfileIDs().map(function(r){return h.getParticipantIDFromUserID(r);});i.getBigImageMulti(q,p.bind(this));};n.prototype.loadMore=function(){"use strict";this.setMaxResults(this.buildQueryResults(this.value).length+(j.COMPOSER_SHOW_MORE_LIMIT*2));m.loadMore.call(this);};function o(){var q=k.getCurrentStateData();return (q.participants||[]).map(function(r){return h.tokenize(r).value;});}function p(q){for(var r in q)if(q.hasOwnProperty(r)){var s=this.getEntry(h.getUserIDFromParticipantID(r));if(s)s.photo=q[r];}if(this.value)this.query(this.value);}e.exports=n;},null);
__d("WebMessengerTypeaheadRenderer",["CurrentUser","DOM","ImmutableObject","MercuryAPIArgsSource","MercuryThreadImage.react","MercuryTypeaheadConstants","MercuryTypeaheadRenderer","React","WebMessengerTemplates","MercuryThreadMetadataRawRenderer","MercuryThreadIDMap","MercuryThreadMetadataRenderer","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){b.__markCompiled&&b.__markCompiled();var q=b('MercuryThreadIDMap').get(),r=b('MercuryThreadMetadataRenderer').get(),s=b('MercuryThreads').get(),t=50;function u(w,x){var y;switch(w.type){case l.HEADER_TYPE:y=o[':fb:web-messenger:typeahead-header'].build();m.renderHeader(y,w);if(this.setNewHeader)this.setNewHeader(y.getRoot(),w);break;case l.USER_TYPE:case l.PAGE_TYPE:y=o[':fb:web-messenger:threadlist-row'].build();m.renderPersonWithBigPhoto(y,w);break;case l.THREAD_TYPE:y=o[':fb:web-messenger:threadlist-row'].build();v(y,w);break;default:return h.create('div');}return y.getRoot();}function v(w,x){var y=q.getClientIDFromFBIDNow(x.uid),z=n.createElement(k,{size:t,thread:new i(x.mercury_thread),viewer:g.getID()});n.render(z,w.getNode('image'));var aa=r.renderThreadNameAndParticipantList(y,x.participants_to_render,x.mercury_thread.participants.length,{last_separator_uses_and:false,names_renderer:p.renderShortNames});h.setContent(w.getNode('name'),aa);w.getRoot().setAttribute('aria-label',aa);s.getThreadMeta(y,function(ba){r.renderSnippet(ba,w.getNode('snippet'));r.renderTimestamp(w.getNode('timestamp'),ba.timestamp_absolute,ba.timestamp_relative,ba.timestamp);},j.WEBMESSENGER);}e.exports=u;},null);
__d("WebMessengerDetailViewComposeTypeaheadControl",["Event","WebMessengerComposerTypeaheadView","CSS","DOM","MercuryFolders","Keys","MercuryDataSourceHelper","MercuryIDs","MercuryTypeahead","MercuryTypeaheadConstants","WebMessengerStateConstants","WebMessengerStateManager","WebMessengerTemplates","WebMessengerEvents","WebMessengerTypeaheadDataSource","WebMessengerSubscriptionsHandler","WebMessengerTypeaheadRenderer","fbt","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x){b.__markCompiled&&b.__markCompiled();var y=b('MercuryThreads').get();function z(da,ea){"use strict";this._typeaheadRoot=da;this._resultsRoot=ea;j.empty(this._typeaheadRoot);j.empty(this._resultsRoot);}z.prototype.hideView=function(){"use strict";i.hide(this._typeaheadRoot);i.hide(this._resultsRoot);};z.prototype.updateView=function(){"use strict";var da=q;switch(r.getCurrentDetailState()){case da.DETAIL.COMPOSE_MAIN:this.renderComposeTypeahead();i.hide(this._resultsRoot);break;case da.DETAIL.COMPOSE_TYPEAHEAD_RESULTS:this.renderComposeTypeahead();i.show(this._resultsRoot);break;}t.detailDOMChanged();};z.prototype.renderComposeTypeahead=function(){"use strict";var da=r.getCurrentStateData();i.show(this._typeaheadRoot);i.show(this._resultsRoot);if(!this._initiated){var ea=s[':fb:web-messenger:read-view:compose:typeahead'].build();j.setContent(this._typeaheadRoot,ea.getRoot());var fa=s[':fb:web-messenger:read-view:compose:typeahead:results'].build();j.setContent(this._resultsRoot,fa.getRoot());this._initialResultsLoadingSpinner=fa.getNode('initialResultsLoadingSpinner');this._typeaheadFooter=fa.getNode('typeaheadFooter');this._moreResultsLink=fa.getNode('moreResultsLink');this._typeaheadCaption=fa.getNode('caption');this.buildTypeahead(fa.getNode('results'));j.appendContent(ea.getNode('typeahead'),this._typeahead.getElement());this._initiated=true;}if(da.start){if(!da.participants)this._typeahead.reset();this._typeahead.focus();var ga=this._typeahead.getTypeahead().getCore();ga.getElement().removeAttribute('disabled');}ba(this);if(da.start)r.updateDetailState(r.getCurrentDetailState(),Object.assign({},r.getCurrentStateData(),{start:false,new_tokens:(void 0)}));};z.prototype.buildTypeahead=function(da){"use strict";if(this._typeahead)return;var ea=new u({queryEndpoint:'/ajax/mercury/composer_query.php'});m.updateMercuryOnFetchComplete(ea);var fa=new o(ea,h);fa.setPlaceholder(x._("Name"));fa.setViewNodeID(da);fa.setViewOption('renderer',w);v.addSubscriptions(fa.subscribe('tokens-changed',this.onTokensChanged.bind(this)));fa.build();v.addSubscriptions(fa.getTypeahead().subscribe(['respond','focus'],function(){aa(!!fa.getTypeahead().getCore().getValue());}),fa.getTypeahead().subscribe(['reset','blur'],function(){aa(false);}),fa.getTypeahead().subscribe('render',function(ga,ha){ca(this,ha.length);}.bind(this)),fa.getTypeahead().subscribe('reset',function(){ca(this,false);}.bind(this)),fa.getTypeahead().subscribe('query',function(ga,ha){j.setContent(this._moreResultsLink,x._("See more results for {query}",[x.param("query",ha.value)]));}.bind(this)),g.listen(fa.getElement(),'keydown',function(ga){if(ga.keyCode===l.TAB&&!ga.getModifiers().any){t.focusComposer();return false;}}),g.listen(this._typeaheadFooter,'mousedown',function(){return false;}),g.listen(this._moreResultsLink,'click',function(){var ga=this._typeahead.getTypeahead().getCore().getValue(),ha=Object.assign({},r.getCurrentStateData(),{all_people_query:ga,start:false});r.updateDetailState(q.DETAIL.COMPOSE_ALL_PEOPLE_RESULTS,ha);}.bind(this)),g.listen(this._typeaheadFooter,'mouseover',function(){this._typeahead.getTypeahead().getView().clearSelected();}.bind(this)));this._typeahead=fa;};z.prototype.onTokensChanged=function(){"use strict";var da=r.getCurrentDetailState();if(da==q.DETAIL.COMPOSE_MAIN||da==q.DETAIL.COMPOSE_TYPEAHEAD_RESULTS||da==q.DETAIL.COMPOSE_ALL_PEOPLE_RESULTS){var ea=this._typeahead,fa=ea.getTokens(),ga=fa[fa.length-1];if(ga&&ga.getInfo().mercury_thread){var ha=ga.getInfo().mercury_thread.thread_id,ia=k.getFromMeta(y.getThreadMetaNow(ha));r.updateDetailState(q.DETAIL.RECENT_MESSAGES,{thread_id:ha,folder:ia,reuse_composer:true});}else{var ja=fa.map(function(la){if(la.getInfo().type===p.PAGE_TYPE){var ma=ea.getTypeahead().getCore();ma.getElement().setAttribute('disabled','disabled');}return n.getParticipantIDFromUserID(la.getValue());}),ka=r.getCurrentStateData();if(!ka.start||(ja||[]).length)r.updateDetailState(q.DETAIL.COMPOSE_MAIN,Object.assign({},ka,{participants:ja}));}}};z.prototype.destroy=function(){"use strict";};function aa(da){var ea=r.getCurrentDetailState(),fa=q;if(ea!=fa.DETAIL.COMPOSE_MAIN&&ea!=fa.DETAIL.COMPOSE_TYPEAHEAD_RESULTS)return;var ga;if(da){ga=fa.DETAIL.COMPOSE_TYPEAHEAD_RESULTS;}else if(ea==fa.DETAIL.COMPOSE_TYPEAHEAD_RESULTS){ga=fa.DETAIL.COMPOSE_MAIN;}else ga=ea;if(ga!=ea){var ha=Object.assign({},r.getCurrentStateData(),{start:false,new_tokens:(void 0)});r.updateDetailState(ga,ha);}}function ba(da){var ea=r.getCurrentStateData();if(ea.new_tokens){var fa=da._typeahead.getTypeahead().getCore();fa.reset();ea.new_tokens.forEach(function(ga){da._typeahead.getTokenizer().addToken(ga);});}}function ca(da,ea){var fa=da._typeahead.getTypeahead(),ga=fa.getCore().getValue(),ha=fa.getData().hasLoadedInitialResults(ga);i.conditionShow(da._initialResultsLoadingSpinner,!ha);i.conditionShow(da._moreResultsLink,ha&&ea);if(!ea&&ha){j.setContent(da._typeaheadCaption,x._("No results found"));}else j.setContent(da._typeaheadCaption,x._("Displaying top results"));}e.exports=z;},null);
__d("WebMessengerUnseenMessageNoticeRenderer",["JSXDOM","ContextualLayer","LayerFadeOnHide","cx","fbt","Event"],function(a,b,c,d,e,f,g,h,i,j,k,l){b.__markCompiled&&b.__markCompiled();var m={renderNoticeTooltip:function(o,p){var q=g.div({className:"_40p"},n(o),g.i({className:"_40q"})),r=new h(p||{},q).enableBehavior(i);return r;}};function n(o){var p=g.div({className:"_40r"},k._("You have new messages"));l.listen(p,'click',o);return p;}e.exports=m;},null);
__d("WebMessengerMessagesNotice",["LayerDestroyOnHide","MercuryViewer","WebMessengerUnseenMessageNoticeRenderer"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();function j(){"use strict";this._notice=null;this._noticeContextNode=null;this._active=false;}j.prototype.getActive=function(){"use strict";return this._active;};j.prototype.showMessageNotice=function(k,l){"use strict";if(!this._active)return;if(!this._notice)this._notice=i.renderNoticeTooltip(k,{context:this._noticeContextNode,offsetY:2,position:l,alignment:'center'});this._notice.show();};j.prototype.hideMessageNotice=function(){"use strict";this._notice&&this._notice.hide();};j.prototype.removeMessageNotice=function(){"use strict";if(this._notice){this._notice.enableBehavior(g).hide();this._notice=null;}};j.prototype.setNoticeContextNode=function(k){"use strict";this._noticeContextNode=k;};j.prototype.hideView=function(){"use strict";this._active=false;this.hideMessageNotice();};j.prototype.updateView=function(){"use strict";this._active=true;};j.prototype.destroy=function(){"use strict";this._active=false;this.removeMessageNotice();};j.prototype.onlyReceivedFromSelf=function(k){"use strict";for(var l in k){if(!k.hasOwnProperty(l))continue;for(var m=0,n=k[l].length;m<n;m++)if(k[l][m].author!==h.getID())return false;}return true;};e.exports=j;},null);
__d("WebMessengerDetailViewUnreadMessagesNotice",["MercuryThreadlistConstants","WebMessengerStateManager","throttle","UserActivity","WebMessengerMessagesNotice","WebMessengerSubscriptionsHandler","MercuryThreadInformer","MercuryThreadActions"],function(a,b,c,d,e,f,g,h,i,j,k,l){b.__markCompiled&&b.__markCompiled();var m=b('MercuryThreadInformer').get(),n=b('MercuryThreadActions').get(),o=g.MESSAGE_NOTICE_INACTIVITY_THRESHOLD;for(var p in k)if(k.hasOwnProperty(p))r[p]=k[p];var q=k===null?null:k.prototype;r.prototype=Object.create(q);r.prototype.constructor=r;r.__superConstructor__=k;function r(s){"use strict";k.call(this);this._manager=s;l.addSubscriptions(m.subscribe('thread-read-changed',this._updateReadStatus.bind(this)));this._manager.addScrollCallback(i.withBlocking(function(t){if(this._shouldMarkAsRead(t)){this.removeMessageNotice();if(j.isActive(5000)){var u=h.getCurrentStateData().thread_id;n.markRead(u);}else j.subscribeOnce(function(){if(this._shouldMarkAsRead(t)){var v=h.getCurrentStateData().thread_id;n.markRead(v);}}.bind(this));}}.bind(this),100,null));}r.prototype.updateOnMessagesReceived=function(s,t,u,v){"use strict";var w=!j.isActive(o);if(!q.getActive.call(this))return;if(w||q.onlyReceivedFromSelf.call(this,v)){this.removeMessageNotice();this._manager.scrollToBottom(true);}else if(!this._manager.isScrolledToBottom()){var x=u-(t-s);this._manager.setScrollTop(x,false);this.showMessageNotice();}};r.prototype.showMessageNotice=function(){"use strict";var s=function(){this._manager.scrollToBottom();}.bind(this);q.showMessageNotice.call(this,s,'above');};r.prototype._shouldMarkAsRead=function(s){"use strict";var t=h.getCurrentStateData().thread_id;return t&&q.getActive.call(this)&&s.isScrolledToBottom();};r.prototype._updateReadStatus=function(s,t){"use strict";var u=h.getCurrentStateData().thread_id;if(u&&t[u]&&t[u].mark_as_read)this.removeMessageNotice();};e.exports=r;},null);
__d("MercuryListUpdateRenderer",["DOM","ge"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();var i={updateList:function(j,k,l,m,n){var o=[];for(var p=0;p<k.length;p++){if(n){var q=n(p);q&&o.push(q);}var r=h(k[p]);if(r&&l(p)){o.push(r);}else o.push(m(p));}g.setContent(j,o);}};e.exports=i;},null);
__d("WebMessengerMessageIDFinder",["DataStore","DOM","csx"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();var j={find:function(k,l){var m=l?h.find(k,l):k,n=g.get(m,'MessageRenderer:messageID');return n;},findAll:function(k){var l=h.scry(k,"._53"),m=[];if(l.length){var n=l[0];for(var o=0;o<n.childNodes.length;o++)m.push(g.get(n.childNodes[o],'MessageRenderer:messageID'));}return m;}};e.exports=j;},null);
__d("WebMessengerMessagesSelection",["CSS","csx","DOM","getObjectValues","WebMessengerMessageIDFinder"],function(a,b,c,d,e,f,g,h,i,j,k){b.__markCompiled&&b.__markCompiled();var l={};function m(p,q){var r=p,s=q;if(r==s)return 0;while(true){r=r.nextSibling;s=s.nextSibling;if(!r||s==p){return 1;}else if(!s||r==q)return -1;}}function n(p,q){var r=p.id,s=i.scry(p,"._yh input")[0];if(q){l[r]=p;g.addClass(p,'selected');s.checked=true;}else{delete l[r];g.removeClass(p,'selected');s.checked=false;}}var o={clear:function(){for(var p in l)n(l[p],false);},selectClick:function(p){n(p,!(p.id in l));},getSelectedMessageIDs:function(){var p=j(l);p.sort(m);var q=[];p.forEach(function(r){q=q.concat(k.findAll(r));});return q;}};e.exports=o;},null);
__d("MessagingConst",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();var g={APP_ID:313785040330,XD_MESSAGE:{SANDBOX_READY:'sandbox_ready',SET_CONTENT:'set_content',HTML_SIZE:'html_size',REFRESH_SIZE:'refresh_size'},SHINGLE_SCROLL_TRIGGER:5,EVENTS:{MESSAGE_SENT:'messaging/message_sent'},initConstants:function(h){Object.assign(g,h);}};e.exports=g;},null);
__d("MessagingXD",["Event","DOM","MercuryConstants","MessagingConst","URI"],function(a,b,c,d,e,f,g,h,i,j,k){b.__markCompiled&&b.__markCompiled();function l(m){this._listeners=[g.listen(window,'message',this._onPostMessage.bind(this))];this._iframes={};this._contentWindows={};this._messageHandler=m;}Object.assign(l.prototype,{unload:function(){this._listeners.forEach(function(m){m.remove();});},createIframe:function(m,n,o){var p=new k(o);this._iframes[n]=h.create('iframe',{name:n,frameBorder:0,src:p.toString()});h.appendContent(m,this._iframes[n]);this._contentWindows[n]=this._iframes[n].contentWindow;return this._iframes[n];},sendMessage:function(m,n){var o=Array.prototype.slice.apply(arguments);o[0]=j.APP_ID;var p=this._iframes[m].contentWindow||this._contentWindows[m];p.postMessage(o.join(','),i.Sandbox.ORIGIN);},_onPostMessage:function(event){if(event.origin!==i.Sandbox.ORIGIN||!event.data.split)return;var m=event.data.split(','),n=unescape(m[1]);this._contentWindows[n]=event.source;this._messageHandler(n,m);}});e.exports=l;},null);
__d("HTMLEmailRenderer",["CSS","MessagingConst","MessagingXD","emptyFunction","fbt","MercuryConstants"],function(a,b,c,d,e,f,g,h,i,j,k,l){b.__markCompiled&&b.__markCompiled();function m(n,o){this._resizeContent=n.resizeContent||j;this._richMap={};this._useFBStyle=o;this._xdc=new i(this.onXDMessage.bind(this));this._maxWidth=0;}Object.assign(m.prototype,{onXDMessage:function(n,o){if(o[0]!=h.APP_ID.toString())return;if(this._richMap&&this._richMap[n])if(o[2]==h.XD_MESSAGE.SANDBOX_READY){return this.setIframeContent(n);}else if(o[2]==h.XD_MESSAGE.HTML_SIZE)return this._resizeContent(n,parseInt(o[3],10),parseInt(o[4],10),o[5]=='true',o[6]=='true');},setIframeContent:function(n,o){this._xdc.sendMessage(n,h.XD_MESSAGE.SET_CONTENT,escape(this._richMap[n]),this._useFBStyle?'useFBStyle':'',o?'forceDialogOnWide':'',escape(k._("Show Hidden Text")),escape(k._("Hide")),this._maxWidth);},makeRich:function(n,o,p,q){var r=this._xdc.createIframe(o,n,l.Sandbox.PAGE_URL);g.addClass(r,'xdIframe');this._richMap[n]=p;this._maxWidth=q||0;},updateRichMap:function(n,o){this._richMap[n]=o;},unload:function(){this._xdc.unload();}});e.exports=m;},null);
__d("UntrustedLink",["DOM","Event","URI","UserAgent_DEPRECATED"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();function k(l,m,n,o){this.dom=l;this.url=l.href;this.hash=m;this.func_get_params=o||function(){return {};};h.listen(this.dom,'click',this.onclick.bind(this));h.listen(this.dom,'mousedown',this.onmousedown.bind(this));h.listen(this.dom,'mouseup',this.onmouseup.bind(this));h.listen(this.dom,'mouseout',this.onmouseout.bind(this));this.onmousedown(h.$E(n));}k.bootstrap=function(l,m,n,o){if(l.__untrusted)return;l.__untrusted=true;new k(l,m,n,o);};k.prototype.getRewrittenURI=function(){var l=Object.assign({u:this.url,h:this.hash},this.func_get_params(this.dom)),m=new i('/l.php').setSubdomain('www');if(new i(this.url).getProtocol()=='https'){return m.setQueryData(l).setProtocol('https');}else return m.setQueryData(l).setProtocol('http');};k.prototype.onclick=function(){setTimeout((function(){this.setHref(this.url);}).bind(this),100);this.setHref(this.getRewrittenURI());};k.prototype.onmousedown=function(l){if(l.button==2)this.setHref(this.getRewrittenURI());};k.prototype.onmouseup=function(){this.setHref(this.getRewrittenURI());};k.prototype.onmouseout=function(){this.setHref(this.url);};k.prototype.setHref=function(l){if(j.ie()<9){var m=g.create('span');g.appendContent(this.dom,m);this.dom.href=l;g.remove(m);}else this.dom.href=l;};e.exports=k;},null);
__d("DOMHyperlink",["Env","JSXDOM","TransformTextToDOMMixin","UntrustedLink","URI","URLScraper","isFacebookURI","cx"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){b.__markCompiled&&b.__markCompiled();var o={MAX_ITEMS:40,match:function(p,q){var r=l.match(p);if(!r)return false;var s=p.indexOf(r),t=s+r.length;return {startIndex:s,endIndex:t,element:this._element(r,q)};},_element:function(p,q){var r=p,s=r.replace(/"/g,'%22');if(!(/^[a-z][a-z0-9\-+.]+:\/\//i.test(p)))s='http://'+s;if(!k.isValidURI(s))return r;var t=h.a({className:"_553k",href:s,target:"_blank",rel:"nofollow"},r);if(q&&!m(new k(s)))t.onmousedown=function(u){j.bootstrap(this,g.lhsh,u);};return t;}};e.exports=Object.assign(o,i);},null);
__d("MercuryMessageRenderer",["DOM","DOMEmoji","DOMEmote","DOMHyperlink","isFacebookURI","JSXDOM","URI","transformTextToDOM"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){b.__markCompiled&&b.__markCompiled();var o={formatMessageBody:function(s,t,u){var v=(s||'').replace(/\s+$/,'');if(!t)return r(v,false,u);var w=Object.keys(t).map(function(z){return window.parseInt(z);}).sort(function(z,aa){return z-aa;}),x=[],y=0;w.forEach(function(z){var aa=v.slice(y,z);if(aa)x.push(r(aa,false,u));y=z+t[z].length;var ba=v.slice(z,y);if(ba)x.push(r(ba,true,u));});if(y<v.length)x.push(r(v.slice(y),false,u));return x.length===0?null:x.length===1?x[0]:g.create('span',{},x);}};function p(s,t){var u=t(s);if(Array.isArray(u))u.forEach(function(v){if(v.href){var w=new m(v.href);if(k(w))v.href=w.addQueryData({__mref:'message'}).toString();}});return u;}function q(s,t){var u=s.replace(/\r\n?/g,'\n').split(/\n{2,}/);return u.filter(function(v){return v.length;}).map(function(v){return l.p(null,p(v,t));});}function r(s,t,u){if(s.length===0&&!t)return null;var v=function(w){return n(w,[j.params(true),h,i]);};return (l.span({className:t?'highlight':null},u?q(s,v):p(s,v)));}e.exports=o;},null);
__d("WebMessengerThreadMessagesRenderer",["AsyncRequest","MercuryAttachment","CSS","DataStore","DOM","Event","HovercardLink","HTMLEmailRenderer","Image.react","ImmutableObject","LinkController","MercuryLogMessageRenderer","MercuryActionType","MercuryAttachments.react","MercuryAttachmentType","MercuryErrorInfo","MercuryIDs","MercuryMessageError.react","MercuryMessageGroup","MercuryTimePassed","MercuryViewer","MercuryMessageRenderer","WebMessengerMessagesSelection","Parent","MercuryParticipants","MercuryParticipantsConstants","React","WebMessengerStateManager","MercuryStatusTemplates","Style","WebMessengerTemplates","Vector","WebMessengerConstants","WebMessengerEvents","WebMessengerSubscriptionsHandler","csx","cx","formatDate","ge","isRTL","fbt","MercuryMessages","MercuryThreadMetadataRenderer"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la,ma,na,oa,pa,qa,ra,sa,ta,ua){b.__markCompiled&&b.__markCompiled();'use strict';var va=b('MercuryMessages').get(),wa=b('MercuryThreadMetadataRenderer').get(),xa={updateSelection:function(za){var ab=ha.getCurrentStateData().message_action;i.conditionClass(za,'selectionEnabled',ab);},setupSelectionListener:function(za){q.registerHandler(function(ab){var bb=ha.getCurrentStateData().message_action;if(bb&&da.byClass(ab,'webMessengerMessageGroup'))return false;});oa.addSubscriptions(l.listen(za,'click',function(event){var ab=ha.getCurrentStateData().message_action;if(ab){var bb=null;for(var cb=event.getTarget();cb;cb=cb.parentNode)if(i.hasClass(cb,'webMessengerMessageGroup'))bb=cb;bb&&ca.selectClick(bb);}}));},renderForwardedMessages:function(za,ab){var bb=y.calculateMessageGroups(ab),cb=null;bb.forEach(function(db){var eb=xa.renderMessageGroup(db,true);k.appendContent(za,eb.getRoot());cb=db[db.length-1];});},renderMessageGroup:function(za,ab,bb){var cb=za[0],db=cb.action_type==s.LOG_MESSAGE,eb=db?ka[':fb:web-messenger:read-view:log-message'].build():ka[':fb:web-messenger:read-view:message-group'].build();eb.getRoot().setAttribute('id',(bb||'wm:')+cb.message_id);if(db){xa.renderSingleLogMessage(eb,cb);}else ea.get(cb.author,function(fb){xa.renderSingleMessage(eb,cb,fb,ab);for(var gb=1;gb<za.length;gb++)xa.appendMessageToGroup(eb,za[gb]);});return eb;},appendMessageToGroup:function(za,ab){var bb=ka[':fb:web-messenger:read-view:message'].build();if(ab.is_filtered_content_bh){var cb=ia[':fb:mercury:filtered-message-blackholefilter'].build();bb.setNodeContent('message',cb.getRoot());}else if(ab.is_filtered_content_account){var db=ia[':fb:mercury:filtered-message-account'].build();bb.setNodeContent('message',db.getRoot());}else if(ab.is_filtered_content){var eb=ia[':fb:mercury:filtered-message'].build();bb.setNodeContent('message',eb.getRoot());}else bb.setNodeContent('message',ba.formatMessageBody(ab.body,null,true));ga.render(ga.createElement(x,{message:new p(ab)}),bb.getNode('status'));var fb=bb.getRoot();j.set(fb,'MessageRenderer:messageID',ab.message_id);i.addClass(bb.getNode('message'),ta(ab.body)?'direction_rtl':'direction_ltr');k.appendContent(za.getNode('bodyDiv'),fb);ea.get(aa.getID(),function(gb){if(gb.employee){var hb=ka[':fb:web-messenger:bug-reporting'].build();hb.getNode('fbtrace').setAttribute('data-timestamp',ab.timestamp);hb.getNode('brokenheart').setAttribute('data-timestamp',ab.timestamp);k.setContent(bb.getNode('bugReporting'),hb.getRoot());}});},renderSingleLogMessage:function(za,ab){var bb=za.getNode('attachment');r.renderLegacy(za.getNode('icon'),za.getNode('message'),bb,ab);xa.renderStatus(za,ab);wa.renderTimestamp(za.getNode('timestamp'),ab.timestamp_absolute,ab.timestamp_relative,ab.timestamp);},renderMessageSeparator:function(za){var ab=ka[':fb:mercury:timestamp'].render();ab.removeAttribute('title');var bb=za.timestamp_absolute;if(!bb)bb=ra(new Date(za.timestamp),{withinWeek:'l',withinYear:'F jS',older:'F jS, Y'});if(va.isFirstMessage(za))if(za.timestamp_time_passed===z.TODAY){bb=ua._("Conversation started today");}else bb=ua._("Conversation started {timestamp}",[ua.param("timestamp",bb)]);k.setContent(ab,bb);i.show(ab);return k.create('li',{className:"_2n3"},ab);},renderMessageSeparatorForIndex:function(za,ab){var bb=za[ab][0];if(ab){var cb=bb.timestamp,db=za[ab-1],eb=db[db.length-1].timestamp,fb=ma.READ_VIEW_SEPARATOR_TIME_LIMIT;if(cb-eb<fb)return false;}return xa.renderMessageSeparator(bb);},renderRawAttachments:function(za,ab){var bb=h.convertRaw(ab.raw_attachments||[]),cb=(ab.photo_fbids?ab.photo_fbids.length:0)+(ab.image_ids?ab.image_ids.length:0);for(var db=0;db<cb;db++)bb.push({attach_type:u.PHOTO,preview_width:206,preview_height:206});if(ab.sticker_id)bb.push({attach_type:u.STICKER});xa.renderAttachments(za,bb,ab);},renderAttachments:function(za,ab,bb){ga.render(ga.createElement(t,{attachments:ab,maxWidth:450,message:bb,isChat:false,onStickerClick:na.stickerClicked.bind(na)}),za);},renderStatus:function(za,ab){if(v.hasErrorStatus(ab)){var bb=ga.createElement(x,{message:new p(ab)}),cb=za.getNode('statusContainer');if(cb&&bb){ga.render(bb,cb);i.show(cb);}}},renderSingleMessage:function(za,ab,bb,cb){if(ab.html_body){var db=za.getNode('fbml');l.listen(db,'click',function(){new g().setURI('/ajax/messaging/async.php').setReadOnly(true).setMethod('GET').setData({action:'htmlDialog',mid:ab.message_id}).send();return false;});i.show(db);var eb=za.getNode('bodyDiv'),fb=k.create('div',{className:"_5xl"}),gb=k.create('div',{className:"_5xm"},fb);k.setContent(eb,gb);j.set(gb,'MessageRenderer:messageID',ab.message_id);var hb=new n({resizeContent:ya}),ib=function(){hb.makeRich(ab.message_id,fb,ab.html_body);};setTimeout(ib,0);xa.renderStatus(za,ab);}else xa.appendMessageToGroup(za,ab);var jb;if(bb.href){jb=k.create('a',{href:bb.href},bb.name);if(ha.getStandaloneMode())jb.setAttribute('target','_blank');var kb=w.getUserIDFromParticipantID(bb.id);if(kb)jb.setAttribute('data-hovercard',m.constructEndpoint({id:kb}));}else jb=bb.name;za.setNodeContent('authorName',jb);var lb=za.getNode('image');i.removeClass(lb,'MercuryThreadImage');var mb=ga.createElement(o,{alt:bb.name,width:fa.IMAGE_SIZE,height:fa.IMAGE_SIZE,src:bb.image_src,className:"_50dv"});if(bb.href)mb=ga.createElement("a",{href:bb.href},mb);mb=ga.render(mb,lb);var nb;if(ab.timestamp_time_passed===z.TODAY){nb='g:ia';}else nb='n/j, g:ia';var ob=ra(new Date(ab.timestamp),nb);wa.renderTimestamp(za.getNode('timestamp'),ab.timestamp_absolute,ob,ab.timestamp);wa.renderMessageSourceTags(za.getNode('tooltipForSource'),za.getNode('sourceIcon'),ab.source_tags||[],ab.author_email);wa.renderSpoofWarning(za.getNode('spoofWarning'),ab.is_spoof_warning,bb);if(ab.subject)za.setNodeContent('subject',ab.subject);if(ab.has_attachment){var pb=za.getNode('attachments');if(ab.attachments&&ab.attachments.length===0){xa.renderRawAttachments(pb,ab);}else if(ab.attachments!==null&&ab.attachments.length>0){xa.renderAttachments(pb,ab.attachments,ab);}else if(ab.raw_attachments!=null&&ab.raw_attachments.length>0)xa.renderRawAttachments(pb,ab.raw_attachments);}var qb=za.getNode('forwards'),rb=ab.forward_count&&va.getMessagesFromIDs(ab.forward_message_ids);if(rb)xa.renderForwardedMessages(qb,rb);i.conditionShow(qb,rb);}};function ya(za,ab,bb){var cb=sa(za),db=k.find(cb,'iframe'),eb=k.find(db,"^._5xm"),fb=eb.firstChild;ja.set(db,'width',ab+'px');ja.set(db,'height',(bb+1)+'px');db.setAttribute('scrolling','no');var gb=cb&&la.getElementDimensions(cb).x/ab;if(gb&&gb<1){ja.set(eb,'height',Math.round(gb*(bb+1))+'px');var hb=db.style,ib=['transform','WebkitTransform','msTransform','MozTransform','OTransform'],jb;while(jb=ib.shift())if(typeof hb[jb]!=='undefined'){ja.set(db,jb,'scale('+gb+','+gb+')');return;}ja.set(fb,'zoom',gb);}}e.exports=xa;},null);
__d("WebMessengerInfoBoxRenderer",["Event","cx","DOM","WebMessengerSubscriptionsHandler"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();var k={render:function(l,m){var n=i.create('div',{className:"_4rk"},l),o=i.create('div',{}),p=true;m.forEach(function(q){if(!p){var r=i.create('span',{className:"_4rl"},'\u00b7');i.appendContent(o,r);}p=false;var s=i.create('a',{},q.text);if(q.handler)j.addSubscriptions(g.listen(s,'click',q.handler));i.appendContent(o,s);});return i.create('div',{className:"_4rh"},[n,o]);}};e.exports=k;},null);
__d("MercurySearchContextResults",["KeyedCallbackManager","MercuryAPIArgsSource","MercuryIDs","MercuryThreadlistConstants","RangedCallbackManager","MercuryServerDispatcher","WebMessengerConstants","MercuryThreadIDMap","MercuryServerPayloadPreprocessor"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){b.__markCompiled&&b.__markCompiled();var n=b('MercuryThreadIDMap').get(),o=b('MercuryServerPayloadPreprocessor').get(),p=new g(),q=j.WEBMESSENGER_SEARCH_SNIPPET_COUNT,r=m.MORE_SEARCH_CONTEXT_COUNT,s={getSearchContext:function(w,x,y){if(w){var z=p.executeOrEnqueue(w,function(ea){var fa=u(ea,w);y(fa);}),aa=p.getUnavailableResources(z);if(aa.length){var ba={message_id:w,limit:q+1},ca=n.getFBIDFromClientIDNow(x),da=i.tokenize(x);if(da.type=='user'){ba.other_user_fbid=ca;}else ba.thread_fbid=ca;v(ba);}return z;}},getMoreSearchContext:function(w,x,y,z){if(w){var aa=p.getResource(w);if(aa){var ba=y==m.MORE_SEARCH_CONTEXT_UP?aa.up_message_ids:aa.down_message_ids,ca=ba.getCurrentArraySize()+r,da=ba.executeOrEnqueue(0,ca,function(){var ia=u(aa,w);z(ia);}),ea=ba.getUnavailableResources(da);if(ea.length){var fa={message_id:w,limit:ca,direction:y},ga=n.getFBIDFromClientIDNow(x),ha=i.tokenize(x);if(ha.type=='user'){fa.other_user_fbid=ga;}else fa.thread_fbid=ga;v(fa);}return da;}}},handleUpdate:function(w){if(w.mercury_payload)o.handleUpdate(w.mercury_payload);var x=w.search_context||{};for(var y in x){var z=x[y],aa=z.other_user_fbid||z.thread_fbid,ba=n.getClientIDFromFBIDNow(aa),ca=!p.getResource(y),da=ca?{thread_id:ba,up_message_ids:new k(),down_message_ids:new k()}:p.getResource(y),ea=ca?q+1:r;if(z.up_message_ids&&(da.up_message_ids.getCurrentArraySize()===0||z.up_message_ids.length>=da.up_message_ids.getCurrentArraySize()))t(da.up_message_ids,z.up_message_ids,ea);if(z.down_message_ids&&(da.down_message_ids.getCurrentArraySize()===0||z.down_message_ids.length>=da.down_message_ids.getCurrentArraySize()))t(da.down_message_ids,z.down_message_ids,ea);if(ca)p.setResource(y,da);}},unsubscribe:function(w,x,y){if(x){var z=p.getResource(x);if(z){if(y==m.MORE_SEARCH_CONTEXT_UP){z.up_message_ids.unsubscribe(w);}else z.down_message_ids.unsubscribe(w);}else p.unsubscribe(w);}}};function t(w,x,y){var z=w.getCurrentArraySize(),aa=x.length<z+y;if(x.length){w.removeAllResources();w.addResourcesWithoutSorting(x,0);}if(aa)w.setReachedEndOfArray();}function u(w,x){var y=w.up_message_ids.hasReachedEndOfArray(),z=w.up_message_ids.getAllResources();if(!y)z.shift();var aa=w.down_message_ids.hasReachedEndOfArray(),ba=w.down_message_ids.getAllResources();if(!aa)ba.pop();return {thread_id:w.thread_id,message_id:x,up_message_ids:z,up_exhausted:y,down_message_ids:ba,down_exhausted:aa};}function v(w){w.client=h.WEBMESSENGER;l.trySend('/ajax/mercury/search_context.php',w);}l.registerEndpoints({'/ajax/mercury/search_context.php':{mode:l.IMMEDIATE,handler:s.handleUpdate}});e.exports=s;},null);
__d("MercurySearchSnippetResults",["MercuryAPIArgsSource","MercuryIDs","MercurySingletonMixin","MercuryThreadlistConstants","MercuryThreadIDMap","RangedCallbackManager","MercuryServerDispatcher","MercuryServerPayloadPreprocessor"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){b.__markCompiled&&b.__markCompiled();var o={},p={},q=null,r=j.WEBMESSENGER_SEARCH_SNIPPET_COUNT,s=j.WEBMESSENGER_SEARCH_SNIPPET_LIMIT,t=j.WEBMESSENGER_SEARCH_SNIPPET_MORE;function u(ea){"use strict";this.$MercurySearchSnippetResults0=ea;this.$MercurySearchSnippetResults1=n.getForFBID(ea);m.registerEndpoints({'/ajax/mercury/search_snippets.php':{request_user_id:ea,mode:m.IMMEDIATE,handler:function(fa){this.handleUpdate(fa);}.bind(this)}});this.$MercurySearchSnippetResults2=k.getForFBID(ea);}u.prototype.getFBID=function(){"use strict";return this.$MercurySearchSnippetResults0;};u.prototype.getThreadIDMap=function(){"use strict";return this.$MercurySearchSnippetResults2;};u.prototype.getAllThreadSearchResults=function(ea,fa){"use strict";if(ea)v(this.$MercurySearchSnippetResults0,ea,s,0,fa);};u.prototype.getAllThreadSearchMoreResults=function(ea,fa){"use strict";if(ea){var ga=o[ea];if(ga){var ha=ga.getCurrentArraySize();v(this.$MercurySearchSnippetResults0,ea,t,ha,fa);}}};u.prototype.getSingleThreadSearchResults=function(ea,fa,ga){"use strict";if(!ea||!fa)return;w.call(this,ea,fa,r,0,ga);};u.prototype.getSingleThreadSearchMoreResults=function(ea,fa,ga){"use strict";if(!ea||!fa)return;if(!p[fa])return;var ha=p[fa][ea];if(ha){var ia=ha.num_total_snippets,ja=ha.snippets_cbm.getCurrentArraySize(),ka=ia-ja;if(ka>0){var la=ka>t?t:ka;w.call(this,ea,fa,la,ja,ga);}}};u.prototype.countSnippetsMatchingQueryInThread=function(ea,fa){"use strict";var ga=p[fa][ea];if(ga)return ga.num_total_snippets;};u.prototype.findIndexOfSnippet=function(ea,fa,ga,ha){"use strict";var ia=ca(ea,fa),ja=ia.getAllResources();for(var ka=0;ka<ja.length;ka++)if(ga===ja[ka].message_id)return ka;};u.prototype.findSnippetAtIndex=function(ea,fa,ga,ha){"use strict";z(ea,fa,ga);aa.call(this,ea,fa,ga,ha);};u.prototype.handleUpdate=function(ea){"use strict";if(ea.mercury_payload)this.$MercurySearchSnippetResults1.handleUpdate(ea.mercury_payload);var fa=ea.search_snippets||{};Object.keys(fa).filter(function(ua){return !!fa[ua];}).forEach(function(ua){Object.keys(fa[ua]).forEach(function(va){fa[ua][va].snippets.forEach(function(wa){wa.matched_keywords=x(wa.matched_keywords);});});});var ga=ea.offset,ha=[];for(var ia in fa){var ja=fa[ia];for(var ka in ja){var la=ja[ka],ma=ea.other_user_fbid||ea.thread_fbid,na=this.$MercurySearchSnippetResults2.getClientIDFromFBIDNow(ka),oa=la.snippets,pa=ca(ia,na),qa=pa.getCurrentArraySize();if(!ma){ha.push(na);if(qa)continue;}else if(ga!=qa)continue;var ra=p[na][ia];ra.num_total_snippets=la.num_total_snippets;pa.addResourcesWithoutSorting(oa,qa);if(!ma||ea.limit>oa.length)if(pa.getCurrentArraySize()==ra.num_total_snippets)pa.setReachedEndOfArray();}if(!ma){var sa=ba(ia),ta=sa.getCurrentArraySize();if(ga==ta){sa.addResourcesWithoutSorting(ha,ta);if(ea.limit>ha.length)sa.setReachedEndOfArray();}}}};function v(ea,fa,ga,ha,ia){y();var ja=ba(fa),ka=ha+ga,la=ja.executeOrEnqueue(0,ka,function(oa){var pa={};for(var qa=0;qa<oa.length;qa++){var ra=oa[qa],sa=p[ra][fa];pa[ra]={num_total_snippets:sa.num_total_snippets,snippets:sa.snippets_cbm.getAllResources()};}var ta=ja.hasReachedEndOfArray();ia(pa,ta);}),ma=ja.getUnavailableResources(la);if(ma.length){q={query:fa,thread_id:null,subscriber_id:la};var na={query:fa,offset:ha,limit:ga+1,snippetLimit:r};na.identifier='thread_fbid';da(na,ea);}}function w(ea,fa,ga,ha,ia){y();var ja=ca(ea,fa),ka=ha+ga,la=ja.executeOrEnqueue(0,ka,function(){var ra=ja.getAllResources(),sa=p[fa][ea].num_total_snippets;ia(ra,sa);}),ma=ja.getUnavailableResources(la);if(ma.length){q={query:ea,thread_id:fa,subscriber_id:la};var na={query:ea,snippetOffset:ha,snippetLimit:ga},oa=this.getThreadIDMap().getFBIDFromClientIDNow(fa),pa=h.tokenize(fa),qa=pa.type;if(qa=='user'){na.other_user_fbid=oa;}else na.thread_fbid=oa;na.identifier='thread_fbid';da(na,this.getFBID());}}function x(ea){if(ea instanceof Array){var fa={};for(var ga=0;ga<ea.length;ga++)fa[ga.toString()]=ea[ga];return fa;}else return ea;}function y(){if(q){if(q.thread_id){var ea=ca(q.query,q.thread_id);ea.unsubscribe(q.subscriber_id);}else{var fa=ba(q.query);fa.unsubscribe(q.subscriber_id);}q=null;}}function z(ea,fa,ga){}function aa(ea,fa,ga,ha){var ia=p[fa][ea],ja=ia.snippets_cbm.getAllResources(),ka=ia.num_total_snippets,la=ja.length;if(ga<la){ha(ja[ga].message_id);return;}var ma=ka-la,na=ma>t?t:ma;w.call(this,ea,fa,na,la,function(oa,pa){aa.call(this,ea,fa,ga,ha);});}function ba(ea){if(!o[ea])o[ea]=new l();return o[ea];}function ca(ea,fa){if(!p[fa])p[fa]={};var ga=p[fa][ea];if(!ga){ga={num_total_snippets:-1,snippets_cbm:new l()};p[fa][ea]=ga;}return ga.snippets_cbm;}function da(ea,fa){ea.client=g.WEBMESSENGER;m.trySend('/ajax/mercury/search_snippets.php',ea,null,fa);}Object.assign(u,i);e.exports=u;},null);
__d("WebMessengerDetailViewSearchContextControl",["Event","CSS","DOM","MercuryMessageGroup","WebMessengerMessagesSelection","MercurySearchContextResults","WebMessengerStateConstants","WebMessengerStateManager","WebMessengerTemplates","WebMessengerThreadMessagesRenderer","WebMessengerConstants","fbt","WebMessengerSubscriptionsHandler","MercuryMessages","MercurySearchSnippetResults"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){b.__markCompiled&&b.__markCompiled();var t=b('MercuryMessages').get(),u=b('MercurySearchSnippetResults').get();function v(fa,ga,ha){"use strict";this._manager=fa;this._rootElement=ga;this._paginationBox=ha;i.empty(this._rootElement);var ia=o[':fb:web-messenger:read-view:search-context'].build(),ja=o[':fb:web-messenger:read-view:search-pagination-box'].build();i.setContent(this._rootElement,ia.getRoot());i.setContent(this._paginationBox,ja.getRoot());this._messagelistRoot=ia.getRoot();this._loadingSpinner=ia.getNode('loadingSpinner');this._messageList=ia.getNode('messagelist');this._loadMoreButton=ia.getNode('loadMoreButton');this._loadMoreLink=ia.getNode('loadMoreLink');this._downMoreButton=ia.getNode('downMoreButton');this._downMoreLink=ia.getNode('downMoreLink');this._nextSnippet=ja.getNode('nextSnippet');this._previousSnippet=ja.getNode('previousSnippet');this._backToSnippetsButton=ja.getNode('backToSnippetsButton');this._snippetCountDescription=ja.getNode('snippetCountDescription');this._paginationBoxCloseButton=ja.getNode('paginationBoxCloseButton');this._state=null;this._threadID=null;this._messageID=null;p.setupSelectionListener(this._messageList);s.addSubscriptions(g.listen(this._loadMoreLink,'click',function(){h.addClass(this._loadMoreButton,'async_saving');da(this,q.MORE_SEARCH_CONTEXT_UP);}.bind(this)),g.listen(this._downMoreLink,'click',function(){h.addClass(this._downMoreButton,'async_saving');da(this,q.MORE_SEARCH_CONTEXT_DOWN);}.bind(this)),g.listen(this._nextSnippet,'click',w.bind(null,this,1)),g.listen(this._previousSnippet,'click',w.bind(null,this,-1)),g.listen(this._backToSnippetsButton,'click',function(){var ka=n.getCurrentStateData(),la=ka.single_thread_search?m.DETAIL.SEARCH_THREAD_SNIPPET:m.DETAIL.SEARCH_SNIPPET,ma={folder:ka.folder,message_query:ka.message_query,query:ka.query};if(ka.single_thread_search)ma.thread_id=ka.thread_id;n.updateDetailState(la,ma);}),g.listen(this._paginationBoxCloseButton,'click',function(){n.updateDetailState(m.DETAIL.RECENT_MESSAGES,{thread_id:n.getCurrentStateData().thread_id});}.bind(this)));}v.prototype.hideView=function(){"use strict";h.hide(this._rootElement);h.hide(this._paginationBox);};v.prototype.updateView=function(){"use strict";h.show(this._rootElement);h.show(this._paginationBox);var fa=z(this);aa(this);k.clear();if(fa)ca(this);};v.prototype.destroy=function(){"use strict";y(this);};function w(fa,ga){var ha=n.getCurrentStateData(),ia=u.findIndexOfSnippet(fa._messageQuery,ha.thread_id,ha.message_id),ja=ia+ga;h.hide(fa._messageList);h.hide(fa._loadMoreButton);h.hide(fa._downMoreButton);h.show(fa._loadingSpinner);u.findSnippetAtIndex(fa._messageQuery,ha.thread_id,ja,function(ka){h.show(fa._messageList);x(ha,ka);});}function x(fa,ga){var ha={folder:fa.folder,message_id:ga,message_query:fa.message_query,query:fa.query,single_thread_search:fa.single_thread_search,thread_id:fa.thread_id};n.updateDetailState(n.getCurrentDetailState(),ha);}function y(fa){fa._searchContextSubscription&&l.unsubscribe(fa._searchContextSubscription.subscriber_id,fa._searchContextSubscription.message_id,fa._searchContextSubscription.direction);fa._searchThreadsSubscription=null;}function z(fa){var ga=n.getCurrentStateData();if(fa._threadID!=ga.thread_id)return true;if(fa._messageQuery!=ga.message_query)return true;if(fa._messageID!=ga.message_id)return true;return false;}function aa(fa){var ga=n.getCurrentStateData();fa._state=n.getCurrentDetailState();fa._threadID=ga.thread_id;fa._messageQuery=ga.message_query;fa._messageID=ga.message_id;fa._selectionEnabled=!!ga.message_action;p.updateSelection(fa._messageList);h.conditionClass(fa._messageList,'bugReportingEnabled',ga.bug_reporting_enabled);}function ba(fa,ga){i.setAttributes(fa,{disabled:ga});var ha=i.find(fa,'^label');h.conditionClass(ha,'uiButtonDisabled',ga);}function ca(fa){var ga=i.create('strong',{},fa._messageQuery),ha=u.countSnippetsMatchingQueryInThread(fa._messageQuery,fa._threadID),ia=u.findIndexOfSnippet(fa._messageQuery,fa._threadID,fa._messageID),ja=ia+1,ka=r._({"*":"{index} of {count} results for {query}"},[r.param("index",ja),r.param("count",ha,[0]),r.param("query",ga)]);i.setContent(fa._snippetCountDescription,ka);ba(fa._previousSnippet,ia===0);ba(fa._nextSnippet,ia===ha-1);i.empty(fa._messageList);h.show(fa._loadingSpinner);h.hide(fa._loadMoreButton);h.hide(fa._downMoreButton);y(fa);if(fa._threadID&&fa._messageID){var la=l.getSearchContext(fa._messageID,fa._threadID,function(ma){h.hide(fa._loadingSpinner);ea(fa,ma);});if(la)fa._searchContextSubscription={subscriber_id:la,message_id:fa._messageID};}}function da(fa,ga){y(fa);if(fa._threadID&&fa._messageID){var ha=l.getMoreSearchContext(fa._messageID,fa._threadID,ga,function(ia){if(ga==q.MORE_SEARCH_CONTEXT_UP){h.removeClass(fa._loadMoreButton,'async_saving');}else h.removeClass(fa._downMoreButton,'async_saving');ea(fa,ia);});if(ha)fa._searchContextSubscription={subscriber_id:ha,message_id:fa._messageID,direction:ga};}}function ea(fa,ga){h.conditionShow(fa._loadMoreButton,!ga.up_exhausted);h.conditionShow(fa._downMoreButton,!ga.down_exhausted);var ha=ga.up_message_ids.concat([ga.message_id],ga.down_message_ids),ia=t.getMessagesFromIDs(ha);i.empty(fa._messageList);var ja=j.calculateMessageGroups(ia);ja.forEach(function(ka,la){var ma=p.renderMessageSeparatorForIndex(ja,la);if(ma)i.appendContent(fa._messageList,ma);var na=p.renderMessageGroup(ka,false,'context:').getRoot(),oa=ka.some(function(pa){return pa.message_id==ga.message_id;});if(oa)h.addClass(na,'selectedHighlight');i.appendContent(fa._messageList,na);});}e.exports=v;},null);
__d("WebMessengerSearchSnippetsRenderer",["Event","CSS","DOM","Image.react","MercuryMessageRenderer","MercuryParticipants","MercuryParticipantsConstants","React","WebMessengerStateConstants","WebMessengerStateManager","WebMessengerTemplates","cx","fbt","MercurySearchSnippetResults","MercuryThreadMetadataRenderer"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){b.__markCompiled&&b.__markCompiled();var t=b('MercurySearchSnippetResults').get(),u=b('MercuryThreadMetadataRenderer').get(),v={renderMultipleSnippetBlocks:function(ba,ca,da){da=da||{};var ea=true;for(var fa in da){ea=false;var ga=q[':fb:web-messenger:read-view:search-snippets-block'].build();i.appendContent(ba,ga.getRoot());v.renderSingleSnippetBlock(ga,ca,fa,da[fa]);}if(ea)aa(ba);},renderThreadSnippetBlock:function(ba,ca,da,ea,fa){if(!ea||!ea.length){aa(ba);return;}var ga=q[':fb:web-messenger:read-view:search-snippets-block'].build();i.appendContent(ba,ga.getRoot());h.hide(ga.getNode('searchThreadName'));w(ga,ca,da,ea,fa);},renderSingleSnippetBlock:function(ba,ca,da,ea){var fa=ba.getNode('searchThreadName'),ga=i.create('h3');i.setContent(fa,ga);u.renderAndSeparatedParticipantList(da,ga);w(ba,ca,da,ea.snippets,ea.num_total_snippets);},renderMultipleSnippets:function(ba,ca,da,ea){(ea||[]).forEach(function(fa){var ga=q[':fb:web-messenger:read-view:search-snippet'].build();i.appendContent(ba,ga.getRoot());l.get(fa.author,function(ha){v.renderSingleSnippet(ga,ca,da,fa,ha);});});},renderSingleSnippet:function(ba,ca,da,ea,fa){ba.setNodeProperty('bodyDiv','id','snippet:'+ea.message_id);var ga=ea.matched_keywords||(void 0),ha=k.formatMessageBody(ea.body,ga);ba.setNodeContent('body',ha);var ia=ba.getNode('image');h.removeClass(ia,'MercuryThreadImage');h.addClass(ia,'MercuryMediumThreadImage');var ja=n.createElement(j,{width:m.IMAGE_SIZE,height:m.IMAGE_SIZE,src:fa.image_src});if(fa.href)ja=n.createElement("a",{href:fa.href},ja);n.render(ja,ia);var ka=fa.short_name;ba.setNodeContent('shortName',s._("{name}:",[s.param("name",ka)])+' ');u.renderTimestamp(ba.getNode('timestamp'),ea.timestamp_absolute,ea.timestamp_relative,ea.timestamp);var la=ba.getNode('seeContext');g.listen(la,'click',function(){var ma=p.getCurrentStateData(),na={message_query:ca,query:ma.query,thread_id:da,message_id:ea.message_id},oa=p.getCurrentDetailState();if(oa===o.DETAIL.SEARCH_THREAD_SNIPPET)na.single_thread_search=true;p.updateDetailState(o.DETAIL.SEARCH_CONTEXT,na);return false;});}};function w(ba,ca,da,ea,fa){var ga=ba.getNode('snippetList');v.renderMultipleSnippets(ga,ca,da,ea);var ha=fa-ea.length;x(ba,ca,da,fa,ha);}function x(ba,ca,da,ea,fa){var ga=ba.getNode('totalSnippetsCount'),ha=ba.getNode('moreSnippetsLink');h.conditionShow(ha,fa>0);if(fa>0){var ia=z(fa);i.setContent(ha,ia);}i.setContent(ga,y(ea));if(fa>0)g.listen(ha,'click',function(){t.getSingleThreadSearchMoreResults(ca,da,function(ja){i.empty(ba.getNode('snippetList'));w(ba,ca,da,ja,ea);});});}function y(ba){if(ba==1){return s._("1 result in total");}else return s._({"*":"{count} results in total"},[s.param("count",ba,[0])]);}function z(ba){if(ba==1){return s._("Show 1 more result");}else return s._({"*":"Show {count} more results"},[s.param("count",ba,[0])]);}function aa(ba){var ca=s._("No results"),da=i.create('div',{className:"_2n4"},ca);i.setContent(ba,da);}e.exports=v;},null);
__d("WebMessengerDetailViewSearchSnippetsControl",["JSXDOM","Event","CSS","DOM","WebMessengerSearchSnippetsRenderer","WebMessengerStateConstants","WebMessengerStateManager","WebMessengerTemplates","WebMessengerPermalinks","WebMessengerSubscriptionsHandler","cx","fbt","MercurySearchSnippetResults"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){b.__markCompiled&&b.__markCompiled();var s=b('MercurySearchSnippetResults').get();function t(y,z){"use strict";this._manager=y;this._rootElement=z;j.empty(this._rootElement);var aa=n[':fb:web-messenger:read-view:search-snippets'].build();j.setContent(this._rootElement,aa.getRoot());this._loadingSpinner=aa.getNode('loadingSpinner');this._messageList=aa.getNode('messagelist');this._downMoreButton=aa.getNode('downMoreButton');this._downMoreLink=aa.getNode('downMoreLink');this._state=null;this._messageQuery=null;this._threadID=null;i.hide(this._downMoreButton);p.addSubscriptions(h.listen(this._downMoreLink,'click',function(){i.addClass(this._downMoreButton,'async_saving');x(this);}.bind(this)));}t.prototype.hideView=function(){"use strict";i.hide(this._rootElement);};t.prototype.updateView=function(){"use strict";i.show(this._rootElement);var y=u(this);v(this);if(y)w(this);};t.prototype.destroy=function(){"use strict";};function u(y){var z=m.getCurrentDetailState();if(y._state!=z)return true;var aa=m.getCurrentStateData();if(y._messageQuery!=aa.message_query)return true;if(z==l.DETAIL.SEARCH_THREAD_SNIPPET)if(y._threadID!=aa.thread_id)return true;return false;}function v(y){y._state=m.getCurrentDetailState();var z=m.getCurrentStateData();y._threadID=z.thread_id;y._messageQuery=z.message_query;}function w(y){i.hide(y._downMoreButton);j.empty(y._messageList);if(y._messageQuery){i.show(y._loadingSpinner);if(y._state===l.DETAIL.SEARCH_THREAD_SNIPPET&&y._threadID){s.getSingleThreadSearchResults(y._messageQuery,y._threadID,function(z,aa){i.hide(y._loadingSpinner);k.renderThreadSnippetBlock(y._messageList,y._messageQuery,y._threadID,z,aa);var ba=g.a({className:"_4-ii"},r._("Search all conversations for \"{query}\"",[r.param("query",y._messageQuery)])),ca=o.getURI(l.MASTER.SEARCH,l.DETAIL.SEARCH_SNIPPET,{query:y._messageQuery,message_query:y._messageQuery});ba.setAttribute('href',ca);j.prependContent(y._messageList,g.div({className:"_4-ij"},ba));});}else s.getAllThreadSearchResults(y._messageQuery,function(z,aa){i.hide(y._loadingSpinner);k.renderMultipleSnippetBlocks(y._messageList,y._messageQuery,z);i.conditionShow(y._downMoreButton,!aa);});}}function x(y){if(y._messageQuery)s.getAllThreadSearchMoreResults(y._messageQuery,function(z,aa){i.removeClass(y._downMoreButton,'async_saving');j.empty(y._messageList);k.renderMultipleSnippetBlocks(y._messageList,y._messageQuery,z);i.conditionShow(y._downMoreButton,!aa);});}e.exports=t;},null);
__d("Ellipsizer",["CSS","Style","UserAgent_DEPRECATED","cx","getElementText"],function(a,b,c,d,e,f,g,h,i,j,k){b.__markCompiled&&b.__markCompiled();'use strict';var l=1;function m(n){this.elements=[];this.descend=true;n.forEach(function(o){g.addClass(o,"_6qy");this.elements.push({node:o});},this);return this;}m.prototype.setDescend=function(n){this.descend=n;return this;};m.prototype.$Ellipsizer0=function(){var n;this.elements.forEach(function(o){n=o.node;if(this.descend)while(n.children.length===1)n=n.children[0];if(n===o.node)h.set(n,'width','');i.ie()&&h.set(n,'position','absolute');o.width=n.offsetWidth;i.ie()&&h.set(n,'position','');},this);this.elements.sort(function(o,p){return o.width-p.width;});};m.prototype.confineWithin=function(n,o){o=o||l;this.$Ellipsizer0();var p=n;this.elements.forEach(function(q,r){var s=Math.floor(p/(this.elements.length-r));if(q.width<=s||q.width<=0||s<=0||(q.width<=s*o&&p>=s*o)){g.removeClass(q.node,"_6s5");h.set(q.node,'width','');p-=q.width;if(q.titleSet){q.node.setAttribute('title','');q.titleSet=false;}}else{g.addClass(q.node,"_6s5");h.set(q.node,'width',s+'px');p-=s;if(!q.titleSet&&!q.node.getAttribute('title')){q.node.setAttribute('title',k(q.node));q.titleSet=true;}}},this);};e.exports=m;},null);
__d("MercuryReadOnlyReason",["React","fbt"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();var i={getReason:function(j){if(j.has_email_participant){return (h._("Sorry, this conversation isn't active anymore because messages can no longer be sent to email addresses. Messages sent to facebook.com email addresses will now be forwarded to primary email addresses, so you can continue this conversation over email. {Learn more}.",[h.param("Learn more",g.createElement("a",{href:"/help/224049364288051"},h._("Learn more")))]));}else return (h._("You cannot reply to this conversation."));}};e.exports=i;},null);
__d("MessagesEmoticonView",["DOM","EmoticonsList","Event","Focus","InputSelection","Keys","Parent","SubscriptionsHandler","TextAreaControl","Toggler","UserAgent_DEPRECATED","cx"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){b.__markCompiled&&b.__markCompiled();var s=h.symbols;function t(w){return m.byClass(w,"_5r8h");}function u(w,x,y,z){var aa=m.byClass(w,'emoticon');if(!aa)return;var ba='emoticon_',ca=null;aa.className.split(' ').forEach(function(ja){if(ja.startsWith(ba))ca=ja.substring(ba.length);});if(!s[ca])return;if(!z)return true;var da=o.getInstance(x),ea=da.getValue(),fa=s[ca],ga=ea.substring(0,y.start),ha=ea.substring(y.end);if(y.start>0&&!ga.endsWith(' '))fa=' '+fa;if(!ha.startsWith(' '))fa+=' ';var ia=ga+fa+ha;y.start+=fa.length;y.end=y.start;da.setValue(ia);k.set(x,y.start,y.end);return true;}function v(w,x){var y={start:0,end:0};function z(){y=k.get(x);}var aa=g.find(w,'.uiToggleFlyout');this._subscriptions=new n();this._subscriptions.addSubscriptions(p.subscribe('show',function(ba,ca){if(ca.active&&g.contains(w,ca.active)){k.set(x,y.start,y.end);var da=g.scry(aa,'a.emoticon')[0];da&&j.setWithoutOutline(da);}}),i.listen(aa,'click',function(event){u(event.getTarget(),x,y,true);}),i.listen(aa,'keyup',function(event){if(event.keyCode===l.ESC){p.hide(w);k.set(x,y.start,y.end);}}),i.listen(x,'keyup',z),i.listen(x,'click',z));if(q.chrome()||q.ie()||q.opera())this._subscriptions.addSubscriptions(i.listen(aa,'mousedown',function(event){var ba=i.listen(document.documentElement,'click',function(event){var ca=event.getTarget(),da=u(ca,x,y,false),ea=t(ca);!da&&!ea&&p.show(w);ba.remove();});}.bind(this)));}Object.assign(v.prototype,{destroy:function(){this._subscriptions&&this._subscriptions.release();this._subscriptions=null;}});Object.assign(v,{create:function(w,x){return new v(w,x);}});e.exports=v;},null);
__d("MessagesEmoticons.react",["Grid.react","React","cx","emptyFunction","fbt"],function(a,b,c,d,e,f,g,h,i,j,k){b.__markCompiled&&b.__markCompiled();var l=g.GridItem,m=h,n=m.PropTypes,o=8,p={smile:k._("smile"),frown:k._("frown"),tongue:k._("tongue"),grin:k._("grin"),gasp:k._("gasp"),wink:k._("wink"),pacman:k._("pacman"),grumpy:k._("grumpy"),unsure:k._("unsure"),cry:k._("cry"),kiki:k._("kiki"),glasses:k._("glasses"),sunglasses:k._("sunglasses"),heart:k._("heart"),devil:k._("devil"),angel:k._("angel"),squint:k._("squint"),confused:k._("confused"),upset:k._("upset"),colonthree:k._("colonthree"),like:k._("like")},q=h.createClass({displayName:"MessagesEmoticons",propTypes:{onEmoticonSelect:n.func},getDefaultProps:function(){return {onEmoticonSelect:j};},getEmoticons:function(){return Object.keys(p).map(function(r){return (h.createElement(l,{key:r},h.createElement("div",{className:"panelCell"},h.createElement("a",{"aria-label":p[r],className:'emoticon emoticon_'+r,onClick:function(){return this.props.onEmoticonSelect(r);}.bind(this)}))));}.bind(this));},render:function(){return (h.createElement("div",{className:"emoticonsTable"},h.createElement(g,{cols:o,alignv:"middle",alignh:"center",spacing:"pam"},this.getEmoticons())));}});e.exports=q;},null);
__d("StickersFlyoutPackSelector.react",["Animation","ImmutableObject","Locale","React","Image.react","StickerActions","StickerConfig","StickerConstants","StickerInterfaces","StickerState","StickerStoreController","XUIBadge.react","cx","emptyFunction","fbt","ix","getObjectValues"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w){b.__markCompiled&&b.__markCompiled();'use strict';var x=j,y=x.PropTypes,z=4,aa=200,ba=u._("Sticker Store"),ca=j.createClass({displayName:"StickersFlyoutPackSelector",propTypes:{stickerInterface:y.oneOf(w(o)),numNewPacks:y.number,packs:y.arrayOf(y.instanceOf(h)).isRequired,onPackClick:y.func,selectedPackID:y.string,resetTagSelectorFunc:y.func},getInitialState:function(){return {animating:false,page:0};},getDefaultProps:function(){return {stickerInterface:o.MESSAGES,numNewPacks:0};},shouldComponentUpdate:function(ea,fa){return !fa.animating;},onFlyoutShown:function(){if(this.props.packs.length>0){var ea=this._calculatePageForPack(this.props.selectedPackID);if(this.state.page!==ea)this._setPage(ea,0);}},_calculatePageForPack:function(ea){for(var fa=0;fa<this.props.packs.length;fa++)if(this.props.packs[fa].id==ea)return fa<=z?0:Math.floor((fa-1)/z);return 0;},_setPage:function(ea,fa){if(this.state.animating)return;this.setState({animating:true,page:ea},function(){var ga=j.findDOMNode(this.refs.positioner),ha=this._calculatePosition(ea);new g(ga).to(ha.reference,ha.offset+'px').ondone(function(){return this.setState({animating:false});}.bind(this)).duration(fa).go();});},_calculatePosition:function(ea){var fa=j.findDOMNode(this.refs.positioner),ga=fa.childNodes[ea].offsetLeft;if(i.isRTL()){var ha=fa.offsetWidth,ia=fa.childNodes[ea].offsetWidth;return {reference:'right',offset:ga+ia-ha};}return {reference:'left',offset:-ga};},_numPages:function(){return Math.max(1,Math.ceil((this.props.packs.length-1)/z));},_canGoPrev:function(){return this.state.page>0;},_canGoNext:function(){return this.state.page+1<this._numPages();},_goPrev:function(){this._canGoPrev()&&this._setPage(this.state.page-1,aa);},_goNext:function(){this._canGoNext()&&this._setPage(this.state.page+1,aa);},_openStore:function(){l.resetNumNewPacks();var ea=this.props.stickerInterface==o.COMPOSER;q.showStore(null,ea);},render:function(){return (j.createElement("div",{className:"_5r85"},this._renderStoreButton(),this._renderPrevArrow(),this._renderNextArrow(),j.createElement("div",{className:"_5r88"},j.createElement("div",{className:"_5r89",ref:"positioner"},this._renderPages()))));},_selectPack:function(ea){var fa=p.getPack(ea);if(fa&&fa.isPromoted)l.addPack(ea);if(ea===n.SEARCH_PACK_ID)this.props.resetTagSelectorFunc();l.selectPack(ea);},_renderPages:function(){var ea=this.props.packs.map(function(ia,ja){return j.createElement(da,{key:ia.id,onClick:function(){return this._selectPack(ia.id);}.bind(this),pack:ia,selected:this.props.selectedPackID===ia.id,index:ja,isComments:this.props.stickerInterface==o.COMMENTS});}.bind(this)),fa=[];for(var ga=0;ga<ea.length;ga+=z){var ha=ga;ga===0&&ga++;fa.push(j.createElement("div",{className:"_5r81",key:ga},ea.slice(ha,ga+z)));}return fa;},_renderStoreButton:function(){return (j.createElement("a",{"aria-label":ba,className:"_5r86 rfloat","data-hover":"tooltip",onClick:this._openStore},j.createElement(k,{className:"_5r87",src:v('/images/messaging/stickers/selector/sticker_store.png')}),this._renderJewel()));},_renderJewel:function(){var ea=this.props.numNewPacks;if(!ea)return null;return (j.createElement(r,{className:"rfloat _3fhs",count:ea,maxcount:9,type:"special"}));},_renderPrevArrow:function(){if(!this._canGoPrev())return null;var ea=i.isRTL()?v('/images/messaging/stickers/selector/right.png'):v('/images/messaging/stickers/selector/left.png');return (j.createElement("a",{className:(("_37wu")+(' '+"lfloat")),onClick:this._goPrev},j.createElement(k,{className:"_5r84",src:ea})));},_renderNextArrow:function(){if(!this._canGoNext())return null;var ea=i.isRTL()?v('/images/messaging/stickers/selector/left.png'):v('/images/messaging/stickers/selector/right.png');return (j.createElement("a",{className:(("_37wv")+(' '+"rfloat")),onClick:this._goNext},j.createElement(k,{className:"_5r84",src:ea})));}}),da=j.createClass({displayName:"PackIcon",propTypes:{index:y.number,isComments:y.bool,onClick:y.func,pack:y.instanceOf(h).isRequired,selected:y.bool},getDefaultProps:function(){return {isComments:false,onClick:t};},_getPackIcon:function(ea){if(ea.id==n.SEARCH_PACK_ID)return v('/images/messaging/stickers/icons/search.png');if(ea.id==n.MRU_STICKER_PACK)return v('/images/messaging/stickers/icons/recent.png');if(ea.id==n.EMOTICON_PACK_ID)return v('/images/messaging/stickers/icons/emoji.png');return ea.icon;},render:function(){var ea=this.props.pack,fa=m.WebStickerSearch&&!m.StickerSearchInRecent?this.props.index===1||this.props.index===2:this.props.index===1,ga=(("_5r8a")+(this.props.selected?' '+"_5r8b":'')+(ea.id==n.MRU_STICKER_PACK?' '+"_5qcj":'')+(ea.id==n.SEARCH_PACK_ID?' '+"_5qck":'')+(fa?' '+"_eb3":'')),ha=this.props.isComments&&!ea.isCommentsCapable,ia=u._("This pack is only available in photos"),ja=u._("This pack is only available in messages"),ka=ha?t:function(){return this.props.onClick(ea.id);}.bind(this),la=this._getPackIcon(ea);if(la===null)return null;var ma=ja;if(!ea.isMessengerCapable&&ea.isComposerCapable)ma=ia;return (j.createElement("a",{"aria-label":ha?ma:ea.name,className:ga,"data-id":ea.id,"data-hover":"tooltip",ref:"search_icon",onClick:ka,tabIndex:"0"},j.createElement(k,{className:((ha?"_2ji6":'')+(' '+"_5r8c")+(m.WebStickerSearch?' '+"_1viy":'')),src:la})));}});e.exports=ca;},null);
__d("StickerSearch",["StickerServerRequests"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();'use strict';var h,i,j={},k={requestStickersForQuery:function(l,m){h=l;g.getStickersForQuery(l,function(n){return h===l&&m(n.payload);});},prepareTagsData:function(){if(!i)i=g.fetchTagData(function(l){j=l;});return i;},getTagByName:function(l){return j[l];},getTagsIndex:function(){return j;}};e.exports=k;},null);
__d("StickersFlyoutStickerSelector.react",["BanzaiLogger","Grid.react","Image.react","ScrollableArea.react","React","Sticker.react","StickerConstants","StickerConfig","StickerImages","StickerInterfaces","StickerSearch","StickerState","StickerUtils","XUISpinner.react","cx","debounce","emptyFunction","fbt","getObjectValues","ix","throttle"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa){b.__markCompiled&&b.__markCompiled();'use strict';var ba=h.GridItem,ca=k,da=ca.PropTypes,ea=320,fa=278,ga=m.MRU_STICKER_PACK,ha=44,ia=112,ja=v(function(la,ma){if(!la)return;g.log('StickersLoggerConfig',{event:'search_sticker',searchtoken:la,numsearchresults:ma.length});},1000),ka=k.createClass({displayName:"StickersFlyoutStickerSelector",propTypes:{height:da.number,stickerInterface:da.oneOf(y(p)),onQueryResultsFound:da.func,onScroll:da.func,packID:da.string,singleWordTags:da.array,typeaheadTags:da.array,userInput:da.string},getDefaultProps:function(){return {stickerInterface:p.MESSAGES,onScroll:w};},getInitialState:function(){return {loading:false,stickers:[]};},componentDidMount:function(){if(this.props.packID){this.requestStickersForPack(this.props.packID);return;}if(this.props.userInput)this.requestStickersForQuery(this.props.userInput);},componentWillReceiveProps:function(la){if(la.packID&&la.packID!==this.props.packID){this.requestStickersForPack(la.packID);}else if(la.userInput!==this.props.userInput)this.requestStickersForQuery(la.userInput);},requestStickersForQuery:function(la){this.setState({loading:true});q.requestStickersForQuery(la,function(ma){ma.map(function(na){return o.cacheSticker(na);});if(!this.props.tagChosen)ja(la,ma);if(this.props.stickerInterface==p.COMPOSER)ma=ma.filter(function(na){return na.isComposerCapable;});if(this.props.stickerInterface==p.COMMENTS)ma=ma.filter(function(na){return na.isCommentsCapable;});if(this.props.stickerInterface==p.MESSAGES)ma=ma.filter(function(na){return na.isMessengerCapable;});if(this.isMounted()){this.setState({loading:false,stickers:ma});if(n.EnterToSendSticker)this.props.onQueryResultsFound&&this.props.onQueryResultsFound(ma);}}.bind(this));},requestStickersForPack:function(la){this.setState({loading:true});o.requestStickersForPack(la,m.TRAY_SIZE,function(ma){if(la==ga){ma=r.getMRUStickerPack(ma);if(this.props.stickerInterface==p.COMPOSER)ma=ma.filter(function(na){return na.isComposerCapable;});if(this.props.stickerInterface==p.COMMENTS)ma=ma.filter(function(na){return na.isCommentsCapable;});if(this.props.stickerInterface==p.MESSAGES)ma=ma.filter(function(na){return na.isMessengerCapable;});}this.setState({loading:false,stickers:ma});}.bind(this));},renderStickers:function(){return this.state.stickers.map(function(la){var ma=s.getScaledDimensions(la.height,la.width,m.TRAY_SIZE);return (k.createElement(ba,{key:la.id},k.createElement("div",{className:"_5r8h","data-id":la.id},k.createElement(l,{animationTrigger:"hover",className:"_5r8i",forceCursorPointer:true,frameCount:la.frameCount,frameRate:la.frameRate||83,framesPerCol:la.framesPerCol,framesPerRow:la.framesPerRow,sourceHeight:ma.height,sourceURI:la.sourceURI,sourceWidth:ma.width,spriteURI:la.spriteURI,paddedSpriteURI:la.paddedSpriteURI,stickerID:la.id}))));});},_onScroll:function(){var la=this.refs.stickerScrollable;if(la){var ma=la.getArea().getScrollTop();this.props.onScroll(ma);}},render:function(){if(this.state.loading){return (k.createElement("div",{className:"_e0r"},k.createElement(t,{size:"large"})));}else if(this.state.stickers.length===0){var la=(ea-ha*2-ia)/2+"px";return (k.createElement("div",{className:"_5jdt",style:{marginTop:la}},k.createElement(i,{src:z("/images/messaging/stickers/icons/sad_face.png")}),k.createElement("p",null,x._("No Stickers to Show"))));}return (k.createElement(j,{ref:"stickerScrollable",height:this.props.height||ea,onScroll:aa(this._onScroll,200),width:fa,fade:true},k.createElement("div",{className:"_5r8k"},k.createElement(h,{cols:4,fixed:true},this.renderStickers()))));}});e.exports=ka;},null);
__d("StickersFlyoutTagSelector.react",["BanzaiLogger","Grid.react","ScrollableArea.react","Parent","React","Image.react","StickerConfig","StickerConstants","StickersFlyoutStickerSelector.react","StickerInterfaces","StickerSearch","StickerState","StickerUtils","Toggler","XUIButton.react","XUICloseButton.react","XUITextInput.react","cx","emptyFunction","fbt","getObjectValues"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa){b.__markCompiled&&b.__markCompiled();'use strict';var ba=h.GridItem,ca=k,da=ca.PropTypes,ea=320,fa=278,ga=44,ha=k.createClass({displayName:"StickersFlyoutTagSelector",propTypes:{trigger:da.string,stickerInterface:da.oneOf(aa(p)),resetTrigger:da.func,onSelectSticker:da.func},getInitialState:function(){return {input:'',isScrolling:false,tagChosen:false,matchedStickers:[]};},getDefaultProps:function(){return {trigger:null,stickerInterface:p.MESSAGES,resetTrigger:y,onSelectSticker:y};},componentDidMount:function(){var ia=j.byClass(k.findDOMNode(this),'uiToggle');if(ia)this._togglerSub=t.listen('show',ia,function(){this.isMounted()&&this.focusInput();}.bind(this));this.focusInput();this.selectTrigger(this.props.trigger);},componentWillUnmount:function(){this._togglerSub&&this._togglerSub.unsubscribe();},componentWillReceiveProps:function(ia){this.selectTrigger(ia.trigger);},focusInput:function(){this.refs.inputField.focusInput&&this.refs.inputField.focusInput();},_setMatchedStickers:function(ia){this.setState({matchedStickers:ia?ia:[]});},_onEnter:function(ia){ia.preventDefault();ia.stopPropagation();if(!m.EnterToSendSticker)return;var ja=this.state.matchedStickers;if(ja&&ja.length===1){this.props.onSelectSticker(ja[0].id,ia);this.setState({matchedStickers:[]});}},_inputChanged:function(ia){this.setState({input:ia.target.value,tagChosen:false,isScrolling:false});},_normalizeInput:function(ia){return ia.trim().replace(/\s+/,' ').toLowerCase();},_handleResetButtonClick:function(ia){ia.preventDefault();this.reset();},reset:function(){this.setState(this.getInitialState());},renderContentArea:function(){if(this.state.tagChosen||this._normalizeInput(this.state.input).length>1){return this.renderStickers();}else return m.StickerSearchInRecent?this.renderRecentStickers():this.renderTags();},render:function(){return (k.createElement("div",{className:(("_217a")+(this.state.isScrolling?' '+"_1hg1":''))},k.createElement("div",{className:"_5jdr"},k.createElement("span",{className:"_5jds"}),k.createElement(w,{onEnter:this._onEnter,onChange:this._inputChanged,ref:"inputField",placeholder:z._("Search stickers"),value:this.state.input}),k.createElement(v,{size:"small",onClick:this._handleResetButtonClick,className:((this.state.input.length===0?"hidden_elem":''))})),this.renderContentArea()));},selectTag:function(ia){g.log('StickersLoggerConfig',{event:'select_tag',tagid:ia.id});this.setState({tagChosen:true,input:s.capitalizeWords(ia.name)});this.focusInput();},selectTrigger:function(ia){if(ia!==null){var ja=q.getTagByName(ia);this.setState({tagChosen:true,input:s.capitalizeWords(ja.name)});this.props.resetTrigger();}},_onScroll:function(ia){this.setState({isScrolling:!!ia});},renderStickers:function(){var ia=this._normalizeInput(this.state.input);return (k.createElement(o,{ref:"selector",height:ea-ga,userInput:ia,onScroll:this._onScroll,stickerInterface:this.props.stickerInterface,tagChosen:this.state.tagChosen,onQueryResultsFound:this._setMatchedStickers}));},renderRecentStickers:function(){if(this._normalizeInput(this.state.input).length===1)return k.createElement("div",null);return (k.createElement(o,{ref:"selector",height:ea-ga,packID:n.MRU_STICKER_PACK,onScroll:this._onScroll,stickerInterface:this.props.stickerInterface}));},renderTags:function(){var ia=r.getFeaturedTags().filter(function(ja){return ja.sourceURI!==null;}).sort(function(ja,ka){return ja.order-ka.order;}).map(function(ja,ka){return k.createElement(ba,{key:ka},k.createElement("div",{className:(("_t5c")+(ka<2?' '+"_1b27":'')+(ka%2===0?' '+"_t5d":'')+(ka%2!==0?' '+"_t5e":''))},k.createElement(u,{image:k.createElement(l,{src:ja.sourceURI}),label:ja.name,onClick:this.selectTag.bind(this,ja),className:"_5jdu",style:{background:'#'+ja.color_code},disabled:this._normalizeInput(this.state.input).length===1})));}.bind(this));return (k.createElement(i,{height:ea-ga,width:fa-16,shadow:true,fade:true,className:"_5jei"},k.createElement(h,{spacing:"pas",cols:2,fixed:true,ref:"grid"},ia)));}});e.exports=ha;},null);
__d("StickersFlyout.react",["BanzaiLogger","Event","Keys","MessagesEmoticons.react","Parent","ReactComponentWithPureRenderMixin","React","StickerConstants","StickerConfig","StickersFlyoutPackSelector.react","StickersFlyoutStickerSelector.react","StickersFlyoutTagSelector.react","StickerInterfaces","StickerState","StickerStateStore","StoreAndPropBasedStateMixin","SubscriptionsHandler","Toggler","XUISpinner.react","cx","getObjectValues","joinClasses"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba){b.__markCompiled&&b.__markCompiled();'use strict';var ca=m,da=ca.PropTypes,ea=n.SEARCH_PACK_ID,fa=m.createClass({displayName:"StickersFlyout",mixins:[l,v(u)],statics:{calculateState:function(ga){var ha=u.getState(ga.stickerInterface);return {dataReady:ha.trayDataReady,packID:ha.packID,numNewPacks:ha.numNewPacks,packs:ha.trayPacks};}},propTypes:{stickerInterface:da.oneOf(aa(s)),onStickerSelect:da.func.isRequired,onEmoticonSelect:da.func,onShown:da.func,onHidden:da.func,onEscKeyDown:da.func,onPackSelect:da.func,shown:da.bool},getDefaultProps:function(){return {stickerInterface:s.MESSAGES,shown:false,packSelectorClass:p,tagSelectorClass:r,glyphProvider:null};},getInitialState:function(){return {trigger:null};},componentDidMount:function(){if(o.LoadStickerEarly&&!this.state.dataReady)this.loadTrayData();this._toggle=k.byClass(m.findDOMNode(this),'uiToggle');this._subscriptions=new w();if(this._toggle)this._subscriptions.addSubscriptions(x.listen('show',this._toggle,this._onShownWrapper),x.listen('hide',this._toggle,this._onHidden));this._subscriptions.addSubscriptions(h.listen(m.findDOMNode(this),'keydown',this._onKeyDown));if(this.props.shown)this._onShown();},_onShownWrapper:function(){if(this.props.onShown){this.props.onShown(this._onShown);}else this._onShown();},_onShown:function(){g.log('StickersLoggerConfig',{event:'open_tray'});if(!o.LoadStickerEarly&&!this.state.dataReady)this.loadTrayData();if(this.state.packID===ea)this.refs.tagSelector&&this.refs.tagSelector.focusInput();this.refs.packSelector.onFlyoutShown();},_onHidden:function(){this.resetTagSelector();this.props.onHidden&&this.props.onHidden();},componentWillUnmount:function(){this._subscriptions.release();},componentWillReceiveProps:function(ga){if(!this.state.dataReady&&ga.shown)this.loadTrayData();},componentDidUpdate:function(ga){if(!ga.shown&&this.props.shown){this._onShown();}else if(ga.shown&&!this.props.shown)this._onHidden();},_onKeyDown:function(event){if(event.keyCode===i.ESC&&this.props.onEscKeyDown){this.props.onEscKeyDown();event.kill();}if(event.keyCode===i.RETURN&&this.props.stickerInterface===s.COMMENTS)this.selectedSticker(event);},resetTagSelector:function(){this.refs.tagSelector&&this.refs.tagSelector.reset();},loadTrayData:function(){t.onTrayDataReady(function(){}.bind(this));},loadPack:function(){if(!this.state.dataReady)return (m.createElement("div",{className:"_e0r"},m.createElement(y,{size:"large"})));if(this.state.packID===n.EMOTICON_PACK_ID)return (m.createElement("div",{className:"_5r8l","data-id":this.state.packID},m.createElement(j,{onEmoticonSelect:this.props.onEmoticonSelect})));if(this.state.packID===ea&&o.WebStickerSearch){var ga=this.props.tagSelectorClass;return (m.createElement("div",{className:"_5r8l"},m.createElement(ga,{ref:"tagSelector",className:"fbStickersFlyoutTagSelector",trigger:this.state.trigger,resetTrigger:function(){return this.setState({trigger:null});}.bind(this),stickerInterface:this.props.stickerInterface,onSelectSticker:this.onSelectSticker})));}return (m.createElement("div",{className:"_5r8l","data-id":this.state.packID},m.createElement(q,{ref:"selector",packID:this.state.packID,stickerInterface:this.props.stickerInterface})));},onSelectSticker:function(ga,event){if(ga){t.updateRecentlyUsed(ga);this.props.onStickerSelect(ga,event);if(o.PromotePackFromSearch&&this.state.packID===n.SEARCH_PACK_ID)t.promotePackSentFromSearch(ga);t.clearShowStickerReplyNUX();}},selectedSticker:function(event){var ga=k.byClass(event.target,"_5r8h");if(ga){var ha=ga.getAttribute('data-id');this.onSelectSticker(ha,event);}},render:function(){var ga=this.props.packSelectorClass;return (m.createElement("div",{className:ba(this.props.className,"_5r8f")},m.createElement("div",{className:"_5r8e"},m.createElement(ga,{ref:"packSelector",numNewPacks:this.state.numNewPacks,onPackClick:this.props.onPackSelect,selectedPackID:this.state.packID,packs:this.state.packs,stickerInterface:this.props.stickerInterface,resetTagSelectorFunc:this.resetTagSelector,glyphProvider:this.props.glyphProvider})),m.createElement("div",{className:"_5r8m",onClick:this.selectedSticker},this.loadPack())));}});e.exports=fa;},null);
__d("TabIndexDelegator",["CSS","DOM","Event","Focus","JSXDOM"],function(a,b,c,d,e,f,g,h,i,j,k){b.__markCompiled&&b.__markCompiled();function l(m,n){"use strict";this._placeholder=n||k.button(null);this._placeholder.setAttribute('aria-hidden',true);g.addClass(this._placeholder,'accessible_elem');this._listener=i.listen(this._placeholder,'click',function(){m.click();});j.relocate(this._placeholder,m);this.enable();}l.prototype.enable=function(){"use strict";g.show(this._placeholder);};l.prototype.disable=function(){"use strict";g.hide(this._placeholder);};l.prototype.getPlaceholder=function(){"use strict";return this._placeholder;};l.prototype.destroy=function(){"use strict";this._listener.remove();h.remove(this._placeholder);};e.exports=l;},null);
__d("XMessagingSetPreferencesController",["XController"],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports=b("XController").create("\/messaging\/preferences\/",{send_on_enter:{type:"Bool",defaultValue:false}});},null);
__d("WebMessengerDetailViewBottomShelfControl",["ARIA","Arbiter","AsyncDialog","AsyncRequest","BanzaiLogger","Bootloader","Button","CSS","MercuryConstants","DOM","WebMessengerDeleteThreadDialog","Ellipsizer","Event","Focus","MercuryFolders","Input","Keys","Locale","MercuryAPIArgsSource","MercuryIDs","MercuryConfig","MercuryFileUploader","MercuryMessengerBlockingUtils","MercuryParticipants","MercuryPhotoUploader","MercuryReadOnlyReason","MercuryShareLinkUploader","MercurySourceType","MercuryThreadInfo","MessagesEmoticonView","MessagingTag","PUWMethods","PagesEventObserver","PagesEventType","PhotosUploadWaterfall","WebMessengerPreferences","React","Run","Set","WebMessengerStateConstants","WebMessengerStateManager","StickerActions","StickersFlyout.react","StickerState","StickerStoreController","Style","TabIndexDelegator","WebMessengerTemplates","TextAreaControl","Toggler","UnsentMessageDialog","URI","UserAgent_DEPRECATED","VaultBoxURI","Vector","WebMessengerEvents","WebMessengerSubscriptionsHandler","XMessagingSetPreferencesController","arrayContains","csx","csx","fbt","isWebMessengerURI","MercuryDraftsController","MercuryThreadIDMap","MercuryThreadActions","MercuryMessageObject","MercuryMessageActions","MercuryThreadInformer","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la,ma,na,oa,pa,qa,ra,sa,ta,ua,va,wa,xa,ya,za,ab,bb,cb,db,eb,fb,gb,hb,ib,jb,kb,lb,mb,nb,ob,pb,qb){b.__markCompiled&&b.__markCompiled();var rb=b('MercuryDraftsController').get(),sb=b('MercuryThreadIDMap').get(),tb=b('MercuryThreadActions').get(),ub=b('MercuryMessageObject').get(),vb=b('MercuryMessageActions').get(),wb=b('MercuryThreadInformer').get(),xb=b('MercuryThreads').get(),yb="_1rh";function zb(dd,ed){"use strict";this._manager=dd;this._rootElement=ed;this._sendOnEnterDefault=pa.sendOnEnter;p.empty(this._rootElement);var fd=bb[':fb:web-messenger:read-view:bottom-shelf'].build();p.setContent(this._rootElement,fd.getRoot());this._bottomShelfToolbar=fd.getNode('toolbar');this._bottomShelfComposer=fd.getNode('composer');this._bottomShelfButtons=fd.getNode('buttons');this._bottomPendingActions=fd.getNode('pendingActions');this._autogrowContainer=fd.getNode('autogrowContainer');this._composerBox=fd.getNode('composerTextarea');this._composerGrid=fd.getNode('composerGrid');this._sendContainer=fd.getNode('sendContainer');this._replyButton=fd.getNode('replyButton');this._uploadingWarning=fd.getNode('uploadingWarning');this._replyButtonLabel=p.find(this._sendContainer,"._1ri");this._sendOnEnterButton=fd.getNode('sendOnEnterButton');this._loadingIndicator=fd.getNode('loadingIndicator');this._cannotReplyAlert=fd.getNode('noReplyMessage');this._ariaOwns=this._composerBox.getAttribute('aria-owns');kb.addSubscriptions(s.listen(this._autogrowContainer,'click',this.focusComposer.bind(this)),jb.subscribe(jb.UPDATE_SELECTION,cd.bind(null,this)),jb.subscribe(jb.FOCUS_COMPOSER,this.focusComposer.bind(this)));this._emoteWrapper=fd.getNode('emoteWrapper');this._stickersFlyoutToggler=fd.getNode('emoticons');this._emoticonsPanel=new ja(this._stickersFlyoutToggler,this._composerBox);var gd=fd.getNode('stickers');if(gd){this._stickersFlyout=qa.render(qa.createElement(wa,{onStickerSelect:function(kd){oc(this,kd);}.bind(this)}),gd);kb.addSubscriptions(jb.subscribe(jb.STICKER_CLICKED,this._onStickerClick.bind(this)));}this._messageSent=false;this._fileUploader=new ba(fd.getNode('attachmentShelf'),fd.getNode('attachButtonForm'),fd.getNode('fileInput'),fd.getNode('attachID'));this._shareLinkUploader=new ga(fd.getNode('shareStage'),fd.getNode('shareStageContent'),fd.getNode('shareStageLoadingIndicator'),fd.getNode('shareStageCloseButton'),this._composerBox);t.relocate(this._replyButton,this._replyButtonLabel);this._delegator=new ab(this._replyButtonLabel);p.prependContent(this._bottomShelfToolbar,this._delegator.getPlaceholder());d(['TypingDetectorController'],function(kd){this._typingDetector=new kd(null,this._composerBox,'web-messenger',null,null);bd(this);}.bind(this));this._photoUploader=new ea(this._composerGrid,fd.getNode('photoButton'),kb,fd.getNode('composer'));var hd=false;kb.addSubscriptions(this._photoUploader.subscribe('dom-updated',jb.detailDOMChanged.bind(jb)),this._photoUploader.subscribe('menu-show',function(kd,ld){if(!hd){this.waterfallStep(oa.BEGIN,ld);hd=true;}}.bind(this)),this._photoUploader.subscribe('selection-start',function(kd,ld){this.waterfallStep(oa.SELECT_START,ld);}.bind(this)),this._photoUploader.subscribe('upload-started',function(kd,ld){this.waterfallStep(oa.IMAGES_SELECTED,{method:ld.method||this._photoUploader.getCurrentMethod()});this.waterfallStep(oa.UPLOAD_START,{count:ld.imageCount});}.bind(this)),this._photoUploader.subscribe('upload-completed',function(kd,ld){var md=this._photoUploader.getCurrentMethod();if(md!==la.FILE_SELECTOR)this.waterfallStep(oa.IMAGES_SELECTED,{method:md});for(var nd=0;nd<ld.fbids.length;++nd)this.waterfallStep(oa.ONE_UPLOAD_DONE);this._composerBox.focus();var od=pb._("A photo has been attached to your message.");g.notify(od);}.bind(this)),this._photoUploader.subscribe('all-uploads-completed',function(kd,ld){if(this._blockedOnUpload){sc(this,false);pc(this);}this.waterfallStep(oa.ALL_UPLOADS_DONE,ld);}.bind(this)));var id=p.scry(this._bottomShelfToolbar,"._6q-");id.push(fd.getNode('sendOnEnterButtonLabel'));this._ellipsizer=new r(id);kb.addSubscriptions(this._fileUploader.subscribe('all-uploads-completed',function(){if(this._blockedOnUpload){sc(this,false);pc(this);}}.bind(this)),this._fileUploader.subscribe('upload-canceled',sc.bind(null,this,false)),this._fileUploader.subscribe('dom-updated',jb.detailDOMChanged.bind(jb)));this._confirmationSubscription=ua.registerConfirmationBeforeStateUpdate(function(kd,ld,md){if(!rb.canSaveDrafts(this._threadID)&&wc(this)&&ac(this,ld,md))return eb.get();return false;}.bind(this));xc(this);kb.addSubscriptions(h.subscribe('page_transition',function(kd,ld){if(qb(ld.uri))xc(this);}.bind(this)),this._shareLinkUploader.subscribe('link-detected',jb.detailDOMChanged.bind(jb)),this._shareLinkUploader.subscribe('closed',this.focusComposer.bind(this)));cb.getInstance(this._composerBox).subscribe('resize',function(){jb.detailDOMChanged();}.bind(this));ad(this);kb.addSubscriptions(s.listen(this._replyButtonLabel,'click',pc.bind(null,this)),s.listen(this._replyButton,'keydown',dc.bind(null,this)),s.listen(this._composerBox,'keydown',dc.bind(null,this)),s.listen(this._composerBox,'paste',ec.bind(null,this)),s.listen(this._sendOnEnterButton,'click',gc.bind(null,this)),s.listen(fd.getNode('cancelButton'),'click',tc),s.listen(fd.getNode('deleteButton'),'click',uc.bind(null,this)),jb.subscribe(jb.DETAIL_DOM_CHANGED,fc.bind(null,this)));if(aa.CoreGraphEnabled)kb.addSubscriptions(s.listen(fd.getNode('deletePendingButton'),'click',function(){ua.updateDetailState(ta.DETAIL.RECENT_MESSAGES,ua.getCurrentStateData());q.show(this._threadID);}.bind(this)),s.listen(fd.getNode('replyPendingButton'),'click',function(){n.hide(this._bottomPendingActions);n.show(this._bottomShelfComposer);n.removeClass(this._bottomShelfComposer,'invisible_elem');}.bind(this)));kb.addSubscriptions(wb.subscribe('threads-updated',function(kd,ld){ld[this._threadID]&&this.updateView();}.bind(this)));this._replySet=new sa();var jd=new fb(window.location.href);this._uriData=jd.getQueryData();this._shouldLogMessageSend=!!this._uriData.loggedoutpage;}zb.prototype._logMessageSend=function(){"use strict";ma.notify(na.MESSAGES_SEND_ENTRY_POINT,this._uriData.loggedoutpage,{was_logged_out:true});};zb.prototype._onStickerClick=function(dd,ed){"use strict";if(!ed||!ed.packID)return;var fd=ed.packID,gd=ed.stickerID;k.log('StickersLoggerConfig',{event:'click_sticker',packid:fd,stickerid:gd});xa.onTrayDataReady(function(){if(mb(xa.getPackIDsInTray(),fd)){var hd=xa.getPack(fd);if(hd&&hd.isPromoted)va.addPack(fd);var id=this._stickersFlyout,jd=this._stickersFlyoutToggler;if(!jd||!id||!id.isMounted())return;va.selectPack(fd);db.show(jd);}else ya.showStore(fd);}.bind(this));};zb.prototype.waterfallStep=function(dd,ed){"use strict";var fd=this._photoUploader.getWaterfallID();if(!fd)return;oa.sendSignal(Object.assign({qn:fd,step:dd,uploader:oa.APP_MESSENGER},(ed||{})));};zb.prototype.hideView=function(){"use strict";n.hide(this._rootElement);};zb.prototype.updateView=function(){"use strict";var dd=ua.getCurrentDetailState();n.show(this._rootElement);var ed=ua.getCurrentStateData();ac(this,dd,ed)&&rc(this);n.hide(this._bottomShelfComposer);n.removeClass(this._bottomShelfComposer,'invisible_elem');n.hide(this._bottomShelfButtons);n.show(this._sendOnEnterButton);n.hide(this._cannotReplyAlert);ic(this,this._sendOnEnterDefault);switch(dd){case ta.DETAIL.RECENT_MESSAGES:case ta.DETAIL.SEARCH_CONTEXT:this._threadID=ed.thread_id;if(ed.message_action==ta.MESSAGE_ACTION.DELETE){n.hide(this._bottomPendingActions);yc(this,ed.message_action);}else if(this._threadID)xb.getThreadMeta(this._threadID,function(fd){if(aa.CoreGraphEnabled&&!this._replySet.has(this._threadID)&&fd&&fd.folder===ka.PENDING){zc(this);}else if(ia.showComposer(fd)){n.show(this._bottomShelfComposer);ad(this);rb.loadDraft(this._threadID,this._composerBox,this._fileUploader,this._shareLinkUploader,this._photoUploader);this._shareLinkUploader.check();}else{qa.render(qa.createElement("span",null,fa.getReason(fd)),this._cannotReplyAlert);n.show(this._cannotReplyAlert);}cc(this,fd);}.bind(this));break;case ta.DETAIL.COMPOSE_MAIN:this._threadID=null;n.show(this._bottomShelfComposer);ad(this);cc(this,null);break;default:this._threadID=null;break;}bc(this,dd,ed);bd(this);jb.detailDOMChanged();this._state=dd;};zb.prototype.focusComposer=function(){"use strict";this._composerBox.focus();};zb.prototype.submitReply=function(){"use strict";pc(this);};zb.prototype.destroy=function(){"use strict";this._emoticonsPanel&&this._emoticonsPanel.destroy();this._fileUploader.destroy();ua.unregisterConfirmationBeforeStateUpdate(this._confirmationSubscription);};zb.prototype.getStickersFlyoutToggler=function(){"use strict";return this._stickersFlyoutToggler;};function ac(dd,ed,fd){switch(ed){case ta.DETAIL.RECENT_MESSAGES:case ta.DETAIL.SEARCH_CONTEXT:return !fd.reuse_composer&&(dd._threadID!=fd.thread_id||dd._state!=ed);case ta.DETAIL.COMPOSE_MAIN:return fd.start;case ta.DETAIL.SEARCH_SNIPPET:case ta.DETAIL.SEARCH_THREAD_SNIPPET:case ta.DETAIL.SHARED_PHOTOS:return true;}return false;}function bc(dd,ed,fd){var gd=fd.participants&&fd.participants.length>0;n.conditionClass(dd._replyButtonLabel,'uiButtonDisabled',ed==ta.DETAIL.COMPOSE_MAIN&&!gd);}function cc(dd,ed){var fd,gd;if(!ed){fd=pb._("Send");gd=pb._("Write a message...");}else if(ed.participants&&ed.participants.length<=2){fd=pb._("Reply");gd=pb._("Write a reply...");}else{fd=pb._("Reply All");gd=pb._("Write a reply...");}if(dd._composerBox.getAttribute('placeholder')!=gd)v.setPlaceholder(dd._composerBox,gd);m.setLabel(dd._replyButton,fd);lc(dd);}function dc(dd,event){var ed=event.getModifiers();if(ed.any&&event.keyCode!==w.RETURN)return;var fd=false;switch(event.keyCode){case w.ESC:var gd=dd.getStickersFlyoutToggler();db.hide(gd);return;case w.SPACE:fd=event.getTarget()===dd._replyButton;break;case w.RETURN:var hd=!n.hasClass(dd._bottomShelfComposer,yb),id=event.getTarget()===dd._replyButton,jd=false;if(!hd){if(gb.windows()){jd=ed.control;}else if(gb.osx()){jd=ed.meta;}else jd=ed.control||ed.meta;}else if(event.getModifiers().any)return;fd=id||hd||jd;break;case w.UP:case w.DOWN:var kd=ua.getCurrentDetailState();if(dd._composerBox.value||kd!=ta.DETAIL.RECENT_MESSAGES)event.stop();break;}if(fd){pc(dd);dd.focusComposer();return false;}}function ec(dd,event){if(gb.chrome()){var ed=event.clipboardData||event.originalEvent.clipboardData;if(!ed||!ed.items||ed.items.length<1)return;var fd=ed.items[0].type;if(fd!=='image/png')return;if(ed.items[0].getAsFile){var gd=ed.items[0].getAsFile();dd._photoUploader.uploadPastedFile(gd);}}}function fc(dd){ad(dd);jc(dd);}function gc(dd){hc(dd);var ed=!dd._sendOnEnterDefault;dd.focusComposer();dd._sendOnEnterDefault=ed;pa.sendOnEnter=ed;var fd=lb.getURIBuilder().setBool('send_on_enter',ed).getURI();new j(fd).send();}function hc(dd){n.toggleClass(dd._bottomShelfComposer,yb);if(n.hasClass(dd._bottomShelfComposer,yb)){dd._sendOnEnterButton.setAttribute('aria-checked','false');}else dd._sendOnEnterButton.setAttribute('aria-checked','true');lc(dd,true);jb.detailDOMChanged();}function ic(dd,ed){if(ed==n.hasClass(dd._bottomShelfComposer,yb))hc(dd);}function jc(dd){var ed;if(n.hasClass(dd._bottomShelfComposer,yb)){ed=kc(dd);}else ed=0;var fd=ib.getElementDimensions(dd._bottomShelfToolbar).x;dd._ellipsizer.confineWithin(fd-ed-120,1.3);}function kc(dd){return ib.getElementDimensions(dd._replyButtonLabel).x+20;}function lc(dd,ed){var fd='',gd='';if(!n.hasClass(dd._bottomShelfComposer,yb)){gd=kc(dd)+'px';fd='-1';dd._delegator.disable();}else dd._delegator.enable();n.conditionClass(dd._sendContainer,'transition',ed);dd._replyButton.setAttribute('tabindex',fd);za.set(dd._sendContainer,x.isRTL()?'right':'left',gd);}function mc(dd){var ed=ua.getCurrentStateData(),fd=ub.constructUserGeneratedMessageObject(v.getValue(dd._composerBox),ha.TITAN_WEB,ed.thread_id,ed.participants),gd=dd._fileUploader.getAttachments();if(gd&&gd.length){fd.has_attachment=true;fd.raw_attachments=gd;}var hd=dd._photoUploader.getSelectedFBIDs();if(hd.length>0){fd.has_attachment=true;fd.photo_fbids=hd;}var id=dd._fileUploader.getImageFiles();if(id.length>0){fd.has_attachment=true;fd.image_ids=id;}var jd=dd._fileUploader.getAnimatedImageFiles();if(jd.length>0){fd.has_attachment=true;fd.gif_ids=jd;}var kd=dd._fileUploader.getVideoFiles();if(kd.length>0){fd.has_attachment=true;fd.video_ids=kd;}var ld=dd._fileUploader.getAudioFiles();if(ld.length>0){fd.has_attachment=true;fd.audio_ids=ld;}var md=dd._fileUploader.getFiles();if(md.length>0){fd.has_attachment=true;fd.file_ids=md;}if(dd._shareLinkUploader.getAttachData()){fd.has_attachment=true;fd.content_attachment=dd._shareLinkUploader.getAttachData();}fd.force_sms=true;fd.ui_push_phase=o.UIPushPhase;return fd;}function nc(dd,ed,fd){var gd=dd._threadID&&xb.getThreadMetaNow(dd._threadID);if(gd&&gd.is_canonical&&!ia.canReply(gd)&&ca.gk_result){qc(dd._threadID,gd);if(n.hasClass(dd._bottomShelfComposer,yb)){n.hide(dd._loadingIndicator);n.show(dd._replyButtonLabel);dd._composerBox.removeAttribute('disabled');}return;}dd.waterfallStep(oa.SESSION_POSTED);if(aa.CoreGraphEnabled&&dd._threadID)dd._replySet.add(dd._threadID);dd._sendSubscription=vb.send(ed,function(hd){dd.waterfallStep(oa.POST_PUBLISHED);if(!fd){rb.clearDraft(hd);rc(dd);}dd._messageSent=true;if(dd._shouldLogMessageSend)dd._logMessageSend();var id=dd.getStickersFlyoutToggler(),jd=false;if(id)jd=db.isShown(id);var kd=u.getFromMeta(xb.getThreadMetaNow(hd));if(aa.CoreGraphEnabled&&kd===ka.PENDING)tb.movePendingToInbox(hd);var ld=ta.DETAIL.RECENT_MESSAGES;if(ua.getCurrentDetailState()!==ld)ua.updateDetailState(ld,{thread_id:hd,folder:kd,reuse_composer:fd});dd._messageSent=false;if(id&&jd)db.show(id);},y.WEBMESSENGER);dd.focusComposer();}function oc(dd,ed){var fd=ua.getCurrentStateData(),gd=ub.constructUserGeneratedMessageObject('',ha.TITAN_WEB,fd.thread_id,fd.participants);if(!gd.thread_id&&!gd.specific_to_list.length)return;gd.has_attachment=true;gd.sticker_id=ed;nc(dd,gd,true);}function pc(dd){if(dd._fileUploader.isUploading()||dd._photoUploader.isUploading()){sc(dd,true);return;}var ed=mc(dd),fd=v.isEmpty(dd._composerBox);if((fd&&!ed.has_attachment)||(!ed.thread_id&&!ed.specific_to_list.length))return;if(n.hasClass(dd._bottomShelfComposer,yb)){n.show(dd._loadingIndicator);n.hide(dd._replyButtonLabel);dd._composerBox.setAttribute('disabled','disabled');}nc(dd,ed);}function qc(dd,ed){var fd=z.getParticipantIDFromFromThreadID(dd);da.get(fd,function(gd){l.loadModules(["MessageBlockedDialog"],function(hd){hd.show(ed.thread_fbid,ed.can_reply,ia.isMessageBlocked(ed),gd.short_name);});});}function rc(dd){v.reset(dd._composerBox);ad(dd);dd._typingDetector&&dd._typingDetector.resetState();dd._fileUploader.removeAttachments();dd._shareLinkUploader.clear();if(dd._photoUploader.getSelectedFBIDs().length>0)dd._photoUploader.clear();n.hide(dd._loadingIndicator);n.show(dd._replyButtonLabel);dd._composerBox.removeAttribute('disabled');if(dd._sendSubscription)dd._sendSubscription=null;sc(dd,false);}function sc(dd,ed){n.conditionShow(dd._uploadingWarning,ed);dd._blockedOnUpload=ed;}function tc(){var dd=ua.getCurrentDetailState(),ed=ua.getCurrentStateData();delete ed.message_action;ua.updateDetailState(dd,ed);}function uc(dd){var ed=dd._manager.getSelectedMessageIDs().length;i.send(new j('/ajax/mercury/delete_messages_dialog.php').setData({count:ed}),function(fd){fd.subscribe('confirm',vc.bind(null,dd,fd));});}function vc(dd,ed){var fd=dd._manager.getSelectedMessageIDs();vb["delete"](dd._threadID,fd);ed.hide();var gd=ua.getCurrentStateData();if(gd.message_action){var hd=Object.assign({},gd);delete hd.message_action;ua.updateDetailState(ua.getCurrentDetailState(),hd);}}function wc(dd){if(dd._messageSent)return false;if(!v.isEmpty(dd._composerBox))return true;var ed=dd._fileUploader.getAttachments();if((ed&&ed.length)||dd._fileUploader.getImageFiles().length>0||dd._fileUploader.getAnimatedImageFiles().length>0||dd._fileUploader.getVideoFiles().length>0||dd._fileUploader.getAudioFiles().length>0||dd._fileUploader.getFiles().length>0||dd._shareLinkUploader.getAttachData()||dd._photoUploader.getSelectedFBIDs().length>0)return true;var fd=ua.getCurrentStateData(),gd=ua.getCurrentDetailState(),hd=gd==ta.DETAIL.COMPOSE_MAIN||gd==ta.DETAIL.COMPOSE_TYPEAHEAD_RESULTS||gd==ta.DETAIL.COMPOSE_ALL_PEOPLE_RESULTS;if(hd&&!fd.start&&(fd.participants||[]).length)return true;return false;}function xc(dd){ra.onBeforeUnload(function(){var ed=fb.getNextURI();if(!ed.getQueryData().hasOwnProperty('theater')&&!hb.isVaultBoxURI(ed))rb.saveDraft(dd._threadID,dd._composerBox,dd._fileUploader,dd._shareLinkUploader,dd._photoUploader);if(!qb(ed)&&!ed.getQueryData().hasOwnProperty('theater')&&!hb.isVaultBoxURI(ed)&&wc(dd))return pb._("You haven't sent your message.");},true);ra.onBeforeUnload(function(){if(qb(fb.getNextURI())&&wc(dd))return pb._("You haven't sent your message.");},false);ra.onUnload(function(){rb.saveDraft(dd._threadID,dd._composerBox,dd._fileUploader,dd._shareLinkUploader,dd._photoUploader);});}function yc(dd,ed){n.show(dd._bottomShelfComposer);n.addClass(dd._bottomShelfComposer,'invisible_elem');n.conditionClass(dd._bottomShelfButtons,'delete',ed==ta.MESSAGE_ACTION.DELETE);n.show(dd._bottomShelfButtons);}function zc(dd){n.show(dd._bottomShelfComposer);n.addClass(dd._bottomShelfComposer,'invisible_elem');n.show(dd._bottomPendingActions);}function ad(dd){za.set(dd._emoteWrapper,x.isRTL()?'right':'left',(dd._composerBox.clientWidth+22)+'px');}function bd(dd){if(dd._typingDetector){var ed=dd._threadID,fd=null;if(ed){fd=z.getUserIDFromThreadID(ed);var gd=xb.getThreadMetaNow(ed);if((!gd||gd.is_canonical)&&!fd)ed=null;}if(!ed){dd._typingDetector.setUserAndThread(fd,ed);return;}sb.getFBIDFromClientID(ed,function(hd){dd._typingDetector.setUserAndThread(fd,hd);});}}function cd(dd,ed,fd){if(p.contains(dd._ariaOwns,fd))dd._composerBox.setAttribute('aria-activedescendant',fd);}e.exports=zb;},null);
__d("WebMessengerSharedPhotos.react",["AsyncRequest","cx","fbt","glyph","Grid.react","LoadingIndicator.react","MessagesViewer","MessagesViewerSetID","Pixelz.react","React","Image.react","WebMessengerStateConstants","WebMessengerStateManager","URI","XUIButton.react"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u){b.__markCompiled&&b.__markCompiled();var v=p,w=v.PropTypes,x=k.GridItem,y=i._("Return to Conversation"),z=42,aa=p.createClass({displayName:"WebMessengerSharedPhotos",propTypes:{threadID:w.string.isRequired,totalWidth:w.number.isRequired},getInitialState:function(){return {isLoadingMore:true,moreImages:true,imagesData:{}};},componentDidMount:function(){this.requestImages();m.preload();},componentDidUpdate:function(){if(!this.isVisible())this.requestImages();},componentWillReceiveProps:function(ba){if(ba.threadID&&ba.threadID!==this.props.threadID)this.setState({isLoadingMore:true,moreImages:true,imagesData:{}});},isVisible:function(){return !(this.state.isLoadingMore&&this.state.moreImages&&Object.keys(this.state.imagesData).length===0);},loadMoreImages:function(){if(this.state.moreImages&&!this.state.isLoadingMore){this.setState({isLoadingMore:true});this.requestImages();}},renderImages:function(){var ba=Math.floor((this.props.totalWidth-z)/3),ca=this.state,da=ca.imagesData,ea=Object.keys(da).map(function(fa){return (p.createElement(x,{key:da[fa].URI},p.createElement("div",{className:"_5dq3",onClick:this.viewFullImage.bind(null,fa)},p.createElement(o,{upscale:true,width:ba,height:ba,resizeMode:"cover",src:da[fa].URI,borderRadius:1,insetBorderColor:"rgba(0, 0, 0, 0.1)"}))));}.bind(this));return ea;},viewFullImage:function(ba){var ca=new t('/ajax/messaging/attachments/sharedphotos.php').setQueryData({thread_id:this.props.threadID,image_id:ba});m.bootstrapWithConfig({fbid:ba,dimensions:this.state.imagesData[ba].dim,src:this.state.imagesData[ba].URI,disablePaging:Object.keys(this.state.imagesData).length===1,endpoint:ca,setID:n.MESSAGES_VIEW_ALL_IN_THREAD});},requestImages:function(){new g().setURI('/ajax/messaging/attachments/sharedphotos.php').setMethod('POST').setData({thread_id:this.props.threadID,offset:Object.keys(this.state.imagesData).length,limit:30}).setHandler(function(ba){var ca=ba.getPayload();this.setState({isLoadingMore:false,moreImages:ca.moreImagesToLoad,imagesData:Object.assign({},this.state.imagesData,ca.imagesData)});}.bind(this)).send();},returnToThread:function(){var ba=Object.assign({},s.getCurrentStateData());s.updateDetailState(r.DETAIL.RECENT_MESSAGES,ba);},render:function(){var ba=(p.createElement("div",{className:((this.isVisible()?"_5dq2":'')+(!this.isVisible()?' '+"_5dq1":'')+(!this.isVisible()?' '+"_5dpz":''))},p.createElement(l,{color:"white",size:"large"})));if(!this.isVisible()){return ba;}else if(!this.state.isLoadingMore)ba=null;return (p.createElement("div",{className:"_5dpz"},p.createElement("div",{className:"_5dp-"},p.createElement(u,{image:p.createElement(q,{src:j('back')}),label:y,size:"medium",onClick:this.returnToThread})),p.createElement("div",{className:"_5dq0"},p.createElement(k,{cols:3,fixed:false},this.renderImages()),ba)));}});e.exports=aa;},null);
__d("WebMessengerDetailViewSharedPhotosControl",["CSS","DOM","ReactComponentRenderer","WebMessengerSharedPhotos.react","WebMessengerStateConstants","WebMessengerStateManager","WebMessengerEvents","WebMessengerSubscriptionsHandler","MercuryThreadIDMap"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){b.__markCompiled&&b.__markCompiled();var o=b('MercuryThreadIDMap').get();function p(q,r){"use strict";this.manager=q;this.rootElement=r;this.renderer=null;this.serverID=null;this.state=null;this.threadID=null;h.empty(this.rootElement);n.addSubscriptions(this.manager.subscribe('scrolledNearBottom',this.notifyImageRequest.bind(this)),m.subscribe(m.DETAIL_DOM_CHANGED,this.render.bind(this)));}p.prototype.hideView=function(){"use strict";g.hide(this.rootElement);};p.prototype.updateView=function(){"use strict";g.show(this.rootElement);this.updateStateAndData();this.render();};p.prototype.destroy=function(){"use strict";n.release();};p.prototype.updateStateAndData=function(){"use strict";this.state=l.getCurrentDetailState();var q=l.getCurrentStateData();this.threadID=q.thread_id;};p.prototype.render=function(){"use strict";this.serverID=o.getFBIDFromClientIDNow(this.threadID);if(!this.serverID)return;if(!this.renderer){this.renderer=new i(j,this.rootElement);this.renderer.setProps({threadID:this.serverID,totalWidth:this.rootElement.clientWidth});}else this.renderer.setProps({threadID:this.serverID,totalWidth:this.rootElement.clientWidth});};p.prototype.notifyImageRequest=function(){"use strict";var q=l.getCurrentDetailState();if(q===k.DETAIL.SHARED_PHOTOS&&this.renderer)this.renderer.component.loadMoreImages();};e.exports=p;},null);
__d("MercurySheetPolicy",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();var g={canReplaceOpenSheet:function(h,i){if(h.isSheetWithInput&&h.isSheetWithInput())return i.getType()!=h.getType()&&i.isSheetWithInput&&i.isSheetWithInput();if(h.getType()==i.getType())return false;if(h.isPermanent()&&!i.isPermanent())return false;return true;}};e.exports=g;},null);
__d("MercurySheetView",["Animation","ArbiterMixin","MercurySheetPolicy","CSS","DOM","Style","MercurySheetTemplates","Vector","cx","setTimeoutAcrossTransitions"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){b.__markCompiled&&b.__markCompiled();var q=5000,r=function(s,t,u){this._threadID=s;this._rootElement=t;this._tabMainElement=u;this._openSheet=null;};Object.assign(r.prototype,h,{destroy:function(){k.empty(this._rootElement);},_openCommon:function(s,t){if(this._openSheet&&!i.canReplaceOpenSheet(this._openSheet,s)){if(s.couldNotReplace)s.couldNotReplace();return;}this.clear(function(){this._openSheet=s;var u=m[':fb:mercury:tab-sheet:loading'].build().getRoot();k.setContent(this._rootElement,u);j.show(u);j.show(this._rootElement);s.render();if(t){j.addClass(this._tabMainElement,'sheetSlide');j.addClass(this._tabMainElement,"_1sk4");var v=n.getElementDimensions(this._rootElement).y;l.set(this._rootElement,'bottom',v+'px');this.resize();this._animation=new g(this._rootElement).to('bottom',0).duration(150).ease(g.ease.both).ondone(function(){j.removeClass(this._tabMainElement,'sheetSlide');j.removeClass(this._tabMainElement,"_1sk4");this.resize();}.bind(this)).go();}else this.resize();if(!s.isPermanent()){var w=q;if(s.getCloseTimeout)w=s.getCloseTimeout();var x=this.getAutoCloseCallback(s);this._sheetCloseHandler=p(this.close.bind(this,s,x),w);if(s.timeoutCanBeReset)s.setResetTimeoutCallback(this.resetTimeout.bind(this));}}.bind(this));},getAutoCloseCallback:function(s){if(!s.autoCloseCallback)return null;return s.autoCloseCallback.bind(s);},resetTimeout:function(s,t){clearTimeout(this._sheetCloseHandler);var u=this.getAutoCloseCallback(s);this._sheetCloseHandler=p(this.close.bind(this,s,u),t);},set:function(s){return this._openCommon(s,false);},open:function(s){return this._openCommon(s,true);},close:function(s,t){if(this._openSheet!=s)return;if(!this._openSheet){t&&t();return;}if(this._animation)this._animation.stop();if(this._sheetCloseHandler){clearTimeout(this._sheetCloseHandler);this._sheetCloseHandler=null;}j.addClass(this._tabMainElement,'sheetSlide');j.addClass(this._tabMainElement,"_1sk4");var u=n.getElementDimensions(this._rootElement).y;this.resize();this._animation=new g(this._rootElement).to('bottom',u+'px').duration(100).ease(g.ease.begin).ondone(function(){k.empty(this._rootElement);j.hide(this._rootElement);j.removeClass(this._tabMainElement,'sheetSlide');j.removeClass(this._tabMainElement,"_1sk4");this._openSheet=null;this.resize();t&&t();}.bind(this)).go();},clear:function(s){this.close(this._openSheet,s);},resize:function(){this.inform('resize');}});e.exports=r;},null);
__d("WebMessengerEmployeeAwaySheet",["ArbiterMixin","DOM","mixin","WebMessengerTemplates"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();var k=i(g);for(var l in k)if(k.hasOwnProperty(l))n[l]=k[l];var m=k===null?null:k.prototype;n.prototype=Object.create(m);n.prototype.constructor=n;n.__superConstructor__=k;function n(o,p,q){"use strict";k.call(this);this.$WebMessengerEmployeeAwaySheet0=o;this.$WebMessengerEmployeeAwaySheet1=p;this.$WebMessengerEmployeeAwaySheet2=q;}n.prototype.render=function(){"use strict";var o=j[':fb:mercury:employee-away-sheet'].build();h.setContent(this.$WebMessengerEmployeeAwaySheet1,o.getRoot());};n.prototype.isPermanent=function(){"use strict";return true;};n.prototype.getType=function(){"use strict";return 'employee-away';};n.prototype.open=function(){"use strict";this.$WebMessengerEmployeeAwaySheet2.open(this);};n.prototype.close=function(){"use strict";this.$WebMessengerEmployeeAwaySheet2.close(this);};e.exports=n;},null);
__d("WebMessengerIsMessageBlockedSheet",["ArbiterMixin","DOM","Event","WebMessengerTemplates","fbt","mixin"],function(a,b,c,d,e,f,g,h,i,j,k,l){b.__markCompiled&&b.__markCompiled();var m=l(g);for(var n in m)if(m.hasOwnProperty(n))p[n]=m[n];var o=m===null?null:m.prototype;p.prototype=Object.create(o);p.prototype.constructor=p;p.__superConstructor__=m;function p(q,r,s){"use strict";m.call(this);this.$WebMessengerIsMessageBlockedSheet0=q;this.$WebMessengerIsMessageBlockedSheet1=r;this.$WebMessengerIsMessageBlockedSheet2=s;}p.prototype.render=function(){"use strict";var q=j[':fb:mercury:messages-blocked-sheet'].build(),r=k._("Messages from this recipient are blocked.");h.setContent(this.$WebMessengerIsMessageBlockedSheet1,q.getRoot());h.setContent(q.getNode('text'),r+' ');i.listen(q.getNode('unblockButton'),'click',function(){this.inform('clicked',this.$WebMessengerIsMessageBlockedSheet0);}.bind(this));};p.prototype.isPermanent=function(){"use strict";return true;};p.prototype.getType=function(){"use strict";return 'message-blocked';};p.prototype.open=function(){"use strict";this.$WebMessengerIsMessageBlockedSheet2.open(this);};p.prototype.close=function(){"use strict";this.$WebMessengerIsMessageBlockedSheet2.close(this);};e.exports=p;},null);
__d("WebMessengerThreadIsMutedTabSheet",["Event","ArbiterMixin","DOM","WebMessengerTemplates","fbt","mixin"],function(a,b,c,d,e,f,g,h,i,j,k,l){b.__markCompiled&&b.__markCompiled();var m=l(h);for(var n in m)if(m.hasOwnProperty(n))p[n]=m[n];var o=m===null?null:m.prototype;p.prototype=Object.create(o);p.prototype.constructor=p;p.__superConstructor__=m;function p(q,r){"use strict";m.call(this);this._rootElement=q;this._sheetView=r;}p.prototype.render=function(){"use strict";var q=j[':fb:web-messenger:read-view:message-mute-sheet'].build();i.setContent(q.getNode('text'),k._("This conversation is muted. Chat tabs will not pop up for it and push notifications are off."));i.setContent(this._rootElement,q.getRoot());g.listen(q.getNode('unmuteButton'),'click',function(){this.inform('clicked',null);}.bind(this));};p.prototype.isPermanent=function(){"use strict";return false;};p.prototype.getType=function(){"use strict";return 'wb-thread-is-muted';};p.prototype.open=function(){"use strict";this._sheetView.open(this);};p.prototype.close=function(){"use strict";this._sheetView.close(this);};e.exports=p;},null);
__d("WebMessengerDetailViewSheetControl",["DOM","ArbiterMixin","WebMessengerStateManager","MercurySheetView","MercuryThreadInfo","WebMessengerTemplates","WebMessengerEmployeeAwaySheet","ChatEmployeeAwayWarning","WebMessengerIsMessageBlockedSheet","WebMessengerThreadIsMutedTabSheet","WebMessengerSubscriptionsHandler","mixin","MercuryThreadInformer","MercuryThreadActions","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){b.__markCompiled&&b.__markCompiled();var s=b('MercuryThreadInformer').get(),t=b('MercuryThreadActions').get(),u=b('MercuryThreads').get(),v=r(h);for(var w in v)if(v.hasOwnProperty(w))y[w]=v[w];var x=v===null?null:v.prototype;y.prototype=Object.create(x);y.prototype.constructor=y;y.__superConstructor__=v;function y(z){"use strict";v.call(this);this._template=l[':fb:web-messenger:tab-sheet-container'].build();this._rootElement=this._template.getNode('sheet');this._threadID=i.getCurrentStateData().thread_id;this._sheetView=new j(this._threadID,this._rootElement,z);this._threadIsMessageBlockedSheet=new o(this._threadID,this._rootElement,this._sheetView);this._employeeAwaySheet=new m(this._threadID,this._rootElement,this._sheetView);this._threadIsMutedTabSheet=new p(this._rootElement,this._sheetView);this._muteSetting=(void 0);g.setContent(z,this._template.getRoot());this._threadMessageBlockedSub=this._threadIsMessageBlockedSheet.subscribe('clicked',function(){t.unblockMessages(this._threadID);}.bind(this));this._threadIsMutedClickSub=this._threadIsMutedTabSheet.subscribe('clicked',function(){t.unmute(this._threadID);}.bind(this));q.addSubscriptions(this._sheetView.subscribe('resize',this.inform.bind(this,'resize')),s.subscribe('threads-updated',function(aa,ba){if(this._threadID&&ba[this._threadID])this.updateTabSheet(false);}.bind(this)));this.updateTabSheet(true);}y.prototype.updateView=function(){"use strict";var z=i.getCurrentStateData().thread_id;if(this._threadID!=z){this._threadID=z;this.updateTabSheet(true);}};y.prototype.updateTabSheet=function(z){"use strict";if(!this._threadID)return;u.getThreadMeta(this._threadID,function(aa){var ba=k.getMuteSetting(aa);if(ba!=this._muteSetting||z){if(ba){this._threadIsMutedTabSheet.open();}else this._threadIsMutedTabSheet.close();this._muteSetting=ba;}if(k.isMessageBlocked(aa)){this._threadIsMessageBlockedSheet.open();}else this._threadIsMessageBlockedSheet.close();n.updateEmployeeAwayWarning(aa,function(){this._employeeAwaySheet.open();}.bind(this),function(){this._employeeAwaySheet.close();}.bind(this));}.bind(this));};y.prototype.destroy=function(){"use strict";this._threadIsMutedClickSub&&this._threadIsMutedClickSub.unsubscribe();this._employeeAwaySheet&&this._employeeAwaySheet.close();};e.exports=y;},null);
__d("WebMessengerDetailViewControlManager",["Event","ArbiterMixin","CSS","WebMessengerDetailViewHeaderControl","DOM","WebMessengerFlexibleScrollArea","WebMessengerDetailViewActionsMenuControl","WebMessengerDetailViewAllPeopleResultsControl","WebMessengerDetailViewComposeTypeaheadControl","WebMessengerDetailViewRecentMessagesControl","WebMessengerDetailViewSearchContextControl","WebMessengerDetailViewSearchSnippetsControl","WebMessengerDetailViewBottomShelfControl","WebMessengerDetailViewSharedPhotosControl","MercuryConfig","MercuryIDs","WebMessengerMessagesSelection","Parent","WebMessengerDetailViewSheetControl","WebMessengerStateManager","WebMessengerStateConstants","Style","UserAgent_DEPRECATED","WebMessengerEvents","WebMessengerSubscriptionsHandler","WebMessengerTemplates","mixin","getElementPosition"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha){b.__markCompiled&&b.__markCompiled();var ia=ga(h);for(var ja in ia)if(ia.hasOwnProperty(ja))la[ja]=ia[ja];var ka=ia===null?null:ia.prototype;la.prototype=Object.create(ka);la.prototype.constructor=la;la.__superConstructor__=ia;function la(ma){"use strict";ia.call(this);this._rootElement=ma;k.empty(this._rootElement);var na=fa[':fb:web-messenger:read-view'].build();k.setContent(this._rootElement,na.getRoot());this._readContainer=na.getNode('readContainer');this._headerControl=new j(na.getNode('detailViewHeader'));this._actionsMenuControl=new m(na.getNode('detailViewActionsMenu'),this._headerControl);this._allPeopleResultsControl=new n(na.getNode('detailViewAllPeopleResults'));this._composeTypeaheadControl=new o(na.getNode('detailViewComposeTypeahead'),na.getNode('detailViewComposeTypeaheadResults'));this._searchContextControl=new q(this,na.getNode('detailViewSearchContext'),na.getNode('snippetPaginationControlBox'));this._searchSnippetsControl=new r(this,na.getNode('detailViewSearchSnippets'));this._sharedPhotosControl=new t(this,na.getNode('detailViewSharedPhotos'));this._sheetControl=new y(na.getNode('detailViewSheetTab'));var oa=na.getNode('detailViewBottomShelf');this._bottomShelfControl=new s(this,oa);this._detailViewScroller=na.getNode('readMessagesScroller');ea.addSubscriptions(g.listen(this._detailViewScroller,'click',function(qa){if(x.byTag(qa.getTarget(),'a')||k.getSelection())return;this._bottomShelfControl.focusComposer();}.bind(this)));var pa={fade:!!ca.osx(),persistent:true};this._flexArea=new l(this._detailViewScroller,pa).setBottomAligned(false).setInfiniteScrollHandler(this.inform.bind(this,'scrolledNearTop'),true).setInfiniteScrollHandler(this.inform.bind(this,'scrolledNearBottom')).setContainer(this._rootElement).setMinFlexAreaHeight(200).draw();ea.addSubscriptions(da.subscribe(da.DETAIL_DOM_CHANGED,this._flexArea.draw.bind(this._flexArea)),da.subscribe(da.SUBMIT_REPLY,this._bottomShelfControl.submitReply.bind(this._bottomShelfControl)),z.subscribe(aa.STATE_CHANGE_EVENT,this.updateOnStateChange.bind(this)));ea.addSubscriptions(this._sheetControl.subscribe('resize',this._flexArea.draw.bind(this._flexArea)));this._recentMessagesControl=new p(this,na.getNode('detailViewRecentMessages'),na.getNode('loadingSpinner'),na.getNode('noSelectedConversation'),na.getNode('newMessageLink'),na.getNode('showUnreadLink'),na.getNode('contextBanner'),oa);this._stateData={};this._resizeNodes=[this._rootElement,this._detailViewScroller,k.find(this._detailViewScroller,'div.uiScrollableAreaBody')];}la.prototype.updateOnStateChange=function(){"use strict";var ma=z.getCurrentDetailState(),na=this._stateData;this._stateData=z.getCurrentStateData();this._flexArea.setTabbable(ma!==aa.DETAIL.COMPOSE_MAIN);this._allPeopleResultsControl.hideView();this._composeTypeaheadControl.hideView();this._recentMessagesControl.hideView();this._searchContextControl.hideView();this._searchSnippetsControl.hideView();this._sharedPhotosControl.hideView();i.removeClass(this._readContainer,'blankComposeState');i.conditionClass(this._readContainer,'blankComposeState',ma===aa.DETAIL.COMPOSE_MAIN);this._bottomShelfControl.updateView();this._actionsMenuControl.updateView();this._headerControl.updateView();switch(ma){case aa.DETAIL.RECENT_MESSAGES:this._recentMessagesControl.updateView();this._sheetControl.updateView();break;case aa.DETAIL.COMPOSE_ALL_PEOPLE_RESULTS:this._allPeopleResultsControl.updateView();this._composeTypeaheadControl.updateView();break;case aa.DETAIL.COMPOSE_MAIN:this._updateNullStateContextBanner();this._composeTypeaheadControl.updateView();break;case aa.DETAIL.COMPOSE_TYPEAHEAD_RESULTS:this._composeTypeaheadControl.updateView();break;case aa.DETAIL.SHARED_PHOTOS:this._sharedPhotosControl.updateView();break;case aa.DETAIL.SEARCH_SNIPPET:case aa.DETAIL.SEARCH_THREAD_SNIPPET:this._searchSnippetsControl.updateView();break;case aa.DETAIL.SEARCH_CONTEXT:this._searchContextControl.updateView();break;}switch(ma){case aa.DETAIL.RECENT_MESSAGES:case aa.DETAIL.SEARCH_CONTEXT:if(na.thread_id!=this._stateData.thread_id)this._bottomShelfControl.focusComposer();break;}};la.prototype._updateNullStateContextBanner=function(){"use strict";var ma=this._stateData.participants;if(ma&&ma.length===1){if(u.ShowContextBanner&&u.ShowContextBannerNullState){var na=v.getUserIDFromParticipantID(ma[0]);this._recentMessagesControl&&this._recentMessagesControl.renderContextBanner(null,na);}}else this._recentMessagesControl&&this._recentMessagesControl.unmountContextBanner();};la.prototype.hideAll=function(){"use strict";this._headerControl.hideView();this._actionsMenuControl.hideView();this._allPeopleResultsControl.hideView();this._composeTypeaheadControl.hideView();this._recentMessagesControl.hideView();this._searchContextControl.hideView();this._searchSnippetsControl.hideView();this._sharedPhotosControl.hideView();this._bottomShelfControl.hideView();};la.prototype.getSelectedMessageIDs=function(){"use strict";var ma=z.getCurrentDetailState();switch(ma){case aa.DETAIL.RECENT_MESSAGES:case aa.DETAIL.SEARCH_CONTEXT:return w.getSelectedMessageIDs();}return [];};la.prototype.scrollIntoView=function(ma){"use strict";this._flexArea&&this._flexArea.scrollIntoView(ma);};la.prototype.setScrollTop=function(ma,na){"use strict";this._flexArea&&this._flexArea.setScrollTop(ma,na);};la.prototype.isScrolledToBottom=function(){"use strict";return this._flexArea&&this._flexArea.isScrolledToBottom();};la.prototype.scrollToBottom=function(ma){"use strict";this._flexArea&&this._flexArea.scrollToBottom(ma);};la.prototype.draw=function(){"use strict";this._flexArea&&this._flexArea.draw();};la.prototype.poke=function(){"use strict";this._flexArea&&this._flexArea.poke();};la.prototype.addScrollCallback=function(ma){"use strict";this._flexArea&&this._flexArea.addScrollCallback(ma);};la.prototype.getFlexAreaBoundingClientRect=function(){"use strict";return ha(this._flexArea.flexArea);};la.prototype.resizeTo=function(ma){"use strict";if(ma!==null){ma=ma.toString();if(!ma.endsWith('%')||ma.endsWith('px'))ma=ma+'px';}this._resizeNodes.forEach(function(na){ba.set(na,'width',ma);});da.detailDOMChanged();};la.prototype.destroy=function(){"use strict";this._headerControl.destroy();this._actionsMenuControl.destroy();this._allPeopleResultsControl.destroy();this._composeTypeaheadControl.destroy();this._recentMessagesControl.destroy();this._searchContextControl.destroy();this._searchSnippetsControl.destroy();this._bottomShelfControl.destroy();this._sharedPhotosControl.destroy();this._flexArea.destroy();this._sheetControl.destroy();};e.exports=la;},null);
__d("WebMessengerAuxMenu",["SelectableMenu","MenuSelectableItem","MenuTheme","PopoverMenuOverlappingBorder","Popover","PopoverMenu"],function(a,b,c,d,e,f,g,h,i,j,k,l){b.__markCompiled&&b.__markCompiled();function m(n,o){"use strict";this._menu=new g([],{className:o,theme:i});var p=new k(n.parentNode,n,null,{alignh:'right'});new l(p,n,this._menu,[j]);}m.prototype.addOption=function(n,o){"use strict";var p=new h({markup:n,title:''});p.setOnClickHandler(o);this._menu.addItem(p);return p;};m.prototype.destroy=function(){"use strict";};e.exports=m;},null);
__d("WebMessengerMenuFolderControl",["WebMessengerAuxMenu","CSS","Parent","WebMessengerTemplates","Toggler","cx","WebMessengerSubscriptionsHandler"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){b.__markCompiled&&b.__markCompiled();var n,o;function p(r){return i.byClass(r,"_282");}function q(r,s,t){"use strict";var u=!n||n!=s;n=s;this._template=j[':fb:web-messenger:master-view:tab-bar:menu-option'].build();this._template.setNodeContent('folderLabel',r);if(!o||u){o=new g(n,"_1j");h.show(p(n));m.addSubscriptions(k.subscribe(['show','hide'],function(v,w){var x=w.getActive(),y=x&&i.byClass(x,"_282");if(y)h.conditionClass(y,"_50p_",v==='show');}));}this._menuItem=o.addOption(this._template.getRoot(),t);this._menuItem.getRoot();}q.prototype.getCountBadge=function(){"use strict";return this._template.getNode('count');};q.prototype.setSelected=function(r){"use strict";h.conditionClass(p(n),'selectedFolder',r);if(r){this._menuItem.select();}else this._menuItem.deselect();};q.prototype.destroy=function(){"use strict";o&&o.destroy();};e.exports=q;},null);
__d("MessagingFilteringNux",["Arbiter","AsyncRequest","LayerDestroyOnHide","LayerHideOnTransition","MercuryConfig","isWebMessengerURI"],function(a,b,c,d,e,f,g,h,i,j,k,l){b.__markCompiled&&b.__markCompiled();var m=null,n,o={ACCEPTED_EVENT:'filtering/accepted',DIALOG_REGISTERED_EVENT:'filtering/dialog-registered',tryShow:function(p){g.subscribe(o.DIALOG_REGISTERED_EVENT,function(){if(!m)return;m.setContext(p);m.show();m=null;},g.SUBSCRIBE_ALL);},registerDialog:function(p){m=p.disableBehavior(i).disableBehavior(j);n=g.subscribe('page_transition',function(q,r){if(!l(r.uri)){p&&p.destroy();n.unsubscribe();}},g.SUBSCRIBE_NEW);if(p)p.subscribe('confirm',function(){k.filtering_active=true;new h('/ajax/web_messenger/dismiss_filtering_nux.php').send();p.hide();g.inform(o.ACCEPTED_EVENT,{});});g.inform(o.DIALOG_REGISTERED_EVENT,{},g.BEHAVIOR_PERSISTENT);}};e.exports=o;},null);
__d("WebMessengerTabbedFolderControl",["Event","CSS","WebMessengerTemplates"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();function j(k,l,m,n){"use strict";this._template=i[':fb:web-messenger:master-view:tab-bar:folder'].build();this._template.setNodeContent('folderLabel',k);this._listener=g.listen(this._template.getNode('link'),'click',m);if(n)this._countListener=g.listen(this._template.getNode('count'),'click',n);l.push(this._template.getRoot());}j.prototype.getCountBadge=function(){"use strict";return this._template.getNode('count');};j.prototype.setSelected=function(k){"use strict";h.conditionClass(this._template.getRoot(),'selectedFolder',k);};j.prototype.getElement=function(){"use strict";this._template.getRoot();};j.prototype.destroy=function(){"use strict";this._listener.remove();this._countListener&&this._countListener.remove();};e.exports=j;},null);
__d("WebMessengerEditFilteringSettingDialog",["AsyncDialog","AsyncRequest","MercuryConstants","DOM","csx"],function(a,b,c,d,e,f,g,h,i,j,k){b.__markCompiled&&b.__markCompiled();var l='/ajax/mercury/edit_filtering_type.php',m='/ajax/mercury/change_filtering_type.php',n={show:function(){var o=function(q){var r=q.getRoot(),s=j.find(r,"._cq6").checked,t=j.find(r,"._cq7").checked,u='';if(s){u=i.MessagingFilteringType.MODERATE;}else if(t)u=i.MessagingFilteringType.STRICT;new h(m).setData({filtering_type:u}).send();q.hide();},p=function(q){q.subscribe('confirm',o.bind(null,q));q.show();};g.send(new h(l),p);}};e.exports=n;},null);
__d("WebMessengerMercury",["MercuryMessages","MercuryOrderedThreadlist","MercuryServerRequests","WebMessengerStateManager","MercuryThreadInformer","MercuryThreadActions","MercuryThreads","MercuryUnreadState","MercuryUnseenState"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){b.__markCompiled&&b.__markCompiled();var p={getMessages:function(){return g.getForFBID(q());},getOrderedThreadlist:function(){return h.getForFBID(q());},getServerRequests:function(){return i.getForFBID(q());},getThreadInformer:function(){return k.getForFBID(q());},getThreadActions:function(){return l.getForFBID(q());},getThreads:function(){return m.getForFBID(q());},getUnreadState:function(){return n.getForFBID(q());},getUnseenState:function(){return o.getForFBID(q());}};function q(){return j.getCurrentUserID();}e.exports=p;},null);
__d("WebMessengerMasterViewTabBarControl",["JSXDOM","Arbiter","CSS","DOM","Event","Ellipsizer","WebMessengerMenuFolderControl","MercuryConfig","MercuryFilters","MercuryFolders","MercuryThreadlistConstants","MessagingFilteringNux","MessagingTag","WebMessengerStateConstants","WebMessengerStateManager","WebMessengerTabbedFolderControl","WebMessengerTemplates","WebMessengerEditFilteringSettingDialog","WebMessengerEvents","WebMessengerSubscriptionsHandler","WebMessengerMercury","csx","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca){b.__markCompiled&&b.__markCompiled();function da(ka,la,ma){"use strict";this._manager=ka;this._rootElement=la;this._rootTopContentElement=ma;this._threadInformer=aa.getThreadInformer();this._unreadState=aa.getUnreadState();j.empty(this._rootElement);var na=w[':fb:web-messenger:master-view:tab-bar'].build(),oa=w[':fb:web-messenger:master-view:top-content'].build();j.setContent(this._rootElement,na.getRoot());j.setContent(this._rootTopContentElement,oa.getRoot());this._tabList=na.getRoot();this._moreMenu=na.getNode('moreMenu');this._topContentCont=oa.getRoot();this._topContent=oa.getNode('masterViewTopContentHolder');this._closeButton=oa.getNode('masterViewTopContentCloseButton');this._closeButtonCont=oa.getNode('masterViewTopContentCloseCont');this._state=null;this._folder=null;this._filter=null;this._query=null;this._threadID=null;this._folders=p.getSupportedFolders();this._foldersToHeader={};this._filters=o.getSupportedFilters();this._filtersToHeader={};this._otherMarkAllRead=g.a({href:"#"},ca._("Mark All as Read"));this._unreadMarkAllRead=g.a({href:"#"},ca._("Mark All as Read"));this._otherEditSettings=g.a({href:"#"},ca._("Edit Preferences"));var pa=[];this._filters.forEach(function(sa){var ta=ia.bind(null,this,s.INBOX,sa);switch(sa){case s.UNREAD:this._filtersToHeader[sa]=this._filtersToHeader[sa]||new m(ca._("Unread"),this._moreMenu,ta);break;}}.bind(this));this._folders.forEach(function(sa){var ta=ia.bind(null,this,sa,o.ALL),ua=ia.bind(null,this,sa,s.UNREAD);switch(sa){case s.INBOX:var va=n.CoreGraphEnabled?ca._("Recent"):ca._("Inbox");this._foldersToHeader[sa]=this._foldersToHeader[sa]||new v(va,pa,ta,ua);break;case s.OTHER:if(n.CoreGraphEnabled){this._foldersToHeader[sa]=this._foldersToHeader[sa]||new m(ca._("Filtered"),this._moreMenu,ta);}else this._foldersToHeader[sa]=this._foldersToHeader[sa]||new v(ca._("Other"),pa,ta);break;case s.ACTION_ARCHIVED:this._foldersToHeader[sa]=this._foldersToHeader[sa]||new m(ca._("Archived"),this._moreMenu,ta);break;case s.SPAM:if(n.CoreGraphEnabled)break;this._foldersToHeader[sa]=this._foldersToHeader[sa]||new m(ca._("Spam"),this._moreMenu,ta);break;case s.PENDING:if(!n.CoreGraphEnabled)break;this._foldersToHeader[sa]=this._foldersToHeader[sa]||new v(ca._("Message Requests"),pa,ta);break;}}.bind(this));j.prependContent(this._tabList,pa);var qa=j.scry(this._tabList,"._6xt");qa.push(na.getNode('moreMenuLabel'));this._ellipsizer=new l(qa);ea(this);var ra=ia.bind(null,this,s.INBOX,o.ALL);h.subscribe(r.ACCEPTED_EVENT,ha.bind(null,this));z.addSubscriptions(this._threadInformer.subscribe('unread-updated',ja.bind(null,this)),k.listen(this._otherMarkAllRead,'click',function(){this._unreadState.markFolderAsRead(s.OTHER);}.bind(this)),k.listen(this._unreadMarkAllRead,'click',function(){this._unreadState.markFolderAsRead(s.INBOX);}.bind(this)),k.listen(this._otherEditSettings,'click',function(){x.show();}),k.listen(this._closeButton,'click',ra));}da.prototype.updateView=function(){"use strict";var ka=ga(this);fa(this);if(ka)ha(this);ea(this);};da.prototype.getOtherFolderLabel=function(){"use strict";var ka=s.OTHER,la=this._foldersToHeader[ka];if(!la||!la._template)return null;return la._template.getNode('folderLabel');};da.prototype.destroy=function(){"use strict";for(var ka in this._foldersToHeader)this._foldersToHeader[ka]&&this._foldersToHeader[ka].destroy();for(var la in this._filtersToHeader)this._filtersToHeader[la]&&this._filtersToHeader[la].destroy();};function ea(ka){var la=85;j.scry(ka._tabList,"._1r").forEach(function(ma){la+=ma.offsetWidth;});ka._ellipsizer.confineWithin(ka._rootElement.offsetWidth-la,1.3);}function fa(ka){var la=u.getCurrentStateData();ka._state=u.getCurrentMasterState();ka._folder=la.folder;ka._filter=la.filter;ka._query=la.query;}function ga(ka){if(!ka._state||!ka._folder)return true;var la=u.getCurrentStateData();if(ka._folder!=la.folder)return true;if(ka._filter!=la.filter)return true;return false;}function ha(ka){var la=false,ma;ka._folders.forEach(function(na){var oa=ka._filter==s.UNREAD,pa=na==ka._folder&&(ka._filter==o.ALL||oa),qa,ra;switch(na){case s.INBOX:if(oa){var sa=g.strong(null,ca._("Unread")),ta=g.strong(null,ca._("Inbox")),ua=ca._("{unread} messages in {inbox}",[ca.param("unread",sa),ca.param("inbox",ta)]);qa=g.div(null,ua,' \u00b7 ',ka._unreadMarkAllRead);ra=true;}break;case s.OTHER:if(n.CoreGraphEnabled)break;var va='';if(n.filtering_active)va=g.span(null,ka._otherEditSettings,' \u00b7 ');qa=g.div(null,g.p(null,g.strong(null,ca._("Tip:")+' '),ca._("See a message from someone you know? Just reply or click Move to Inbox from the Actions menu.")),va,ka._otherMarkAllRead);r.tryShow(ka.getOtherFolderLabel());break;}if(pa){ma=na;i.conditionShow(ka._closeButtonCont,ra);}else ka._foldersToHeader[na].setSelected(false);if(pa&&qa){la=true;j.setContent(ka._topContent,qa);}});ka._filters.forEach(function(na){var oa=ka._folder==s.INBOX&&na==ka._filter;ka._filtersToHeader[na].setSelected(oa);});ma&&ka._foldersToHeader[ma].setSelected(true);i.conditionShow(ka._topContentCont,la);ja(ka);ka._manager.draw();}function ia(ka,la,ma){var na=ka._state==t.MASTER.SEARCH;if(na||ka._folder!=la||ka._filter!=ma){var oa=Object.assign({},u.getCurrentStateData()),pa=u.getCurrentDetailState();if(pa!==t.DETAIL.SEARCH_SNIPPET&&pa!==t.DETAIL.SEARCH_CONTEXT)delete oa.query;u.updateMasterState(t.MASTER.RECENT_THREADS,Object.assign(oa,{folder:la,filter:ma}));}y.focusComposer();return false;}function ja(ka){for(var la in ka._foldersToHeader){if(la==s.ACTION_ARCHIVED)continue;var ma=ka._unreadState.exceedsMaxCount(la)?q.MAX_UNREAD_COUNT+'+':ka._unreadState.getUnreadCount(la),na=[ka._foldersToHeader[la].getCountBadge()];if(la==s.INBOX)ka._filters.forEach(function(oa){na.push(ka._filtersToHeader[oa].getCountBadge());});na.forEach(function(oa){if(ma)j.setContent(oa,ca._("({unread_count})",[ca.param("unread_count",ma)]));i.conditionShow(oa,ma);});}ea(ka);}e.exports=da;},null);
__d("MercuryLocalThreadResults",["MercuryFolders","MercuryIDs","MercurySingletonMixin","MercuryOrderedThreadlist","MercuryParticipants","MercuryThreadSearchUtils","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){b.__markCompiled&&b.__markCompiled();function n(o){"use strict";this.$MercuryLocalThreadResults0=o;this.$MercuryLocalThreadResults1=j.getForFBID(this.$MercuryLocalThreadResults0);this.$MercuryLocalThreadResults2=m.getForFBID(this.$MercuryLocalThreadResults0);}n.prototype.findMatchingThreadsFromIds=function(o,p){"use strict";return p.filter(function(q){var r=this.$MercuryLocalThreadResults2.getThreadMetaNow(q);return this.$MercuryLocalThreadResults3(r,o);}.bind(this));};n.prototype.findMatchingThreads=function(o){"use strict";var p=[];g.getSupportedFolders().forEach(function(q){p=p.concat(this.$MercuryLocalThreadResults1.getThreadlistUntilTimestamp(0,q));}.bind(this));return this.findMatchingThreadsFromIds(o,p);};n.prototype.$MercuryLocalThreadResults3=function(o,p){"use strict";var q=this.$MercuryLocalThreadResults4(o.participants),r=l.wordsInString(p),s=null;k.getMulti(q,function(t){s=q.map(function(u){return t[u];});});if(!s)return false;return l.allMatchPredicate(r,function(t){var u=l.anyMatchPredicate(s,function(w){return w&&w.name&&l.queryWordMatchesAnyNameWord(t,l.wordsInString(w.name));}),v=o.name&&l.queryWordMatchesAnyNameWord(t,l.wordsInString(o.name));return u||v;});};n.prototype.$MercuryLocalThreadResults4=function(o){"use strict";if(o.length===1&&h.tokenize(o[0]).value===this.$MercuryLocalThreadResults0)return o;return o.filter(function(p){var q=h.tokenize(p).value;return q!==this.$MercuryLocalThreadResults0;}.bind(this));};Object.assign(n,i);e.exports=n;},null);
__d("MercurySearchThreadResults",["KeyedCallbackManager","MercuryAPIArgsSource","MercurySingletonMixin","MercuryThreadlistConstants","MercuryThreadIDMap","RangedCallbackManager","MercuryServerDispatcher","MercuryServerPayloadPreprocessor"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){b.__markCompiled&&b.__markCompiled();var o=new g(),p=j.WEBMESSENGER_THREAD_COUNT,q=j.WEBMESSENGER_MORE_COUNT;function r(s){"use strict";this.$MercurySearchThreadResults0=s;this.$MercurySearchThreadResults1=n.getForFBID(this.$MercurySearchThreadResults0);this.$MercurySearchThreadResults2=k.getForFBID(this.$MercurySearchThreadResults0);m.registerEndpoints({'/ajax/mercury/search_threads.php':{request_user_id:s,mode:m.IMMEDIATE,handler:function(t){this.handleUpdate(t);}.bind(this)}});}r.prototype.getThreadlist=function(s,t){"use strict";if(s){var u=o.executeOrEnqueue(s,function(x){var y=x.getAllResources(),z=x.hasReachedEndOfArray();t(y,z);}),v=o.getUnavailableResources(u),w=h.WEBMESSENGER;if(v.length)this.$MercurySearchThreadResults3({client:w,query:s,offset:0,limit:p+1});return u;}};r.prototype.isExhausted=function(s){"use strict";var t=o.getResource(s);return t?t.hasReachedEndOfArray():false;};r.prototype.getCachedThreadlist=function(s){"use strict";var t=o.getResource(s);return t?t.getAllResources():null;};r.prototype.cacheThreadlist=function(s,t){"use strict";o.getResource(s);var u=new l();u.addResourcesWithoutSorting(t,0);u.setReachedEndOfArray();o.setResource(s,u);};r.prototype.getMoreThreadlist=function(s,t){"use strict";if(s){var u=o.getResource(s);if(u){var v=u.getCurrentArraySize(),w=q,x=u.executeOrEnqueue(0,v+w,function(){var z=u.getAllResources(),aa=u.hasReachedEndOfArray();t(z,aa);}),y=u.getUnavailableResources(x);if(y.length)this.$MercurySearchThreadResults3({query:s,offset:v,limit:w+1});return x;}}};r.prototype.handleUpdate=function(s){"use strict";if(s.mercury_payload)this.$MercurySearchThreadResults1.handleUpdate(s.mercury_payload);var t=s.search_threads||{};for(var u in t){var v=t[u]||[],w=v.map(function(y){return this.$MercurySearchThreadResults2.getClientIDFromFBIDNow(y);}.bind(this)),x=o.getResource(u);if(x){this.$MercurySearchThreadResults4(x,w,q+1);}else{x=new l();this.$MercurySearchThreadResults4(x,w,p+1);o.setResource(u,x);}}};r.prototype.unsubscribe=function(s,t){"use strict";if(t){var u=o.getResource(t);if(u){u.unsubscribe(s);}else o.unsubscribe(s);}};r.prototype.setInitialCount=function(s){"use strict";p=s;};r.prototype.$MercurySearchThreadResults4=function(s,t,u){"use strict";var v=s.getCurrentArraySize(),w=t.length<u;if(!w)t.pop();s.addResourcesWithoutSorting(t,v);if(w)s.setReachedEndOfArray();};r.prototype.$MercurySearchThreadResults3=function(s){"use strict";s.client=h.WEBMESSENGER;s.index='fbid';m.trySend('/ajax/mercury/search_threads.php',s,null,this.$MercurySearchThreadResults0);};Object.assign(r,i);e.exports=r;},null);
__d("MercurySearchThreadsStrategy",["WebMessengerConstants","MercuryLocalThreadResults","MercurySingletonMixin","MercurySearchThreadResults","createObjectFrom"],function(a,b,c,d,e,f,g,h,i,j,k){b.__markCompiled&&b.__markCompiled();var l=null,m=null,n=g.SEARCH_THREAD_DELAY;function o(p){"use strict";this.$MercurySearchThreadsStrategy0=p;this.$MercurySearchThreadsStrategy1=h.getForFBID(this.$MercurySearchThreadsStrategy0);this.$MercurySearchThreadsStrategy2=j.getForFBID(this.$MercurySearchThreadsStrategy0);}o.prototype.clearTimer=function(){"use strict";l=null;clearTimeout(m);m=null;};o.prototype.search=function(p,q,r,s){"use strict";if(p!=l){l=p;clearTimeout(m);m=null;}var t=this.$MercurySearchThreadsStrategy1.findMatchingThreads(p),u=this.$MercurySearchThreadsStrategy2.getCachedThreadlist(p);if(u){var v=this.$MercurySearchThreadsStrategy3(t,u);q(v);r([],this.$MercurySearchThreadsStrategy2.isExhausted(p));s(null,p);return;}var w=this.$MercurySearchThreadsStrategy4(p),x=this.$MercurySearchThreadsStrategy3(t,w.thread_ids);if(w.from_exhausted_remote_results){this.$MercurySearchThreadsStrategy2.cacheThreadlist(p,x);q(x);r([],true);s(null,p);return;}q(x);m=setTimeout(function(){var y=this.$MercurySearchThreadsStrategy2.getThreadlist(p,r);s(y,p);}.bind(this),n);};o.prototype.$MercurySearchThreadsStrategy4=function(p){"use strict";var q='',r=[];for(var s=p.length-1;s>0;s--){var t=p.slice(0,s),u=this.$MercurySearchThreadsStrategy2.getCachedThreadlist(t);if(!u)continue;if(this.$MercurySearchThreadsStrategy2.isExhausted(t)){return {from_exhausted_remote_results:true,thread_ids:this.$MercurySearchThreadsStrategy1.findMatchingThreadsFromIds(p,u)};}else if(q.length===0){q=t;r=this.$MercurySearchThreadsStrategy1.findMatchingThreadsFromIds(p,u);}}return {from_exhausted_remote_results:false,thread_ids:r};};o.prototype.$MercurySearchThreadsStrategy3=function(p,q){"use strict";return Object.keys(Object.assign({},k(p),k(q)));};Object.assign(o,i);e.exports=o;},null);
__d("WebMessengerMasterViewSearchInputControl",["Event","CSS","DOM","Input","Keys","WebMessengerShortcuts","WebMessengerStateConstants","WebMessengerStateManager","WebMessengerTemplates","WebMessengerSubscriptionsHandler","WebMessengerEvents","cx","MercurySearchThreadsStrategy"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){b.__markCompiled&&b.__markCompiled();var s=b('MercurySearchThreadsStrategy').get();function t(ba,ca){"use strict";this._manager=ba;this._rootElement=ca;i.empty(this._rootElement);var da=o[':fb:web-messenger:master-view:search-input'].build();i.replace(this._rootElement,da.getRoot());this._searchBox=da.getRoot();this._searchInput=da.getNode('searchInput');this._searchClear=da.getNode('searchClear');this._searchButton=i.find(this._searchBox,'button');this._state=null;this._query=null;this._folder=null;this._threadID=null;this._ariaOwns=this._searchInput.getAttribute('aria-owns');p.addSubscriptions(q.subscribe(q.UPDATE_SELECTION,aa.bind(null,this)),g.listen(this._searchButton,'click',function(){var ea=j.getValue(this._searchInput);if(ea)y(this,ea);}.bind(this)),g.listen(this._searchClear,'click',x.bind(null,this)),g.listen(this._searchInput,'keyup',function(event){var ea=j.getValue(this._searchInput);if(event.keyCode==k.ESC){x(this);}else if(event.keyCode==k.RETURN&&ea){l.openSearchThread();}else if(ea){z(this,ea);}else if(ea!==n.getCurrentStateData().query){x(this);this.focus();}return false;}.bind(this)),g.listen(this._searchInput,'focus',function(ea){this._focused=true;}.bind(this)),g.listen(this._searchInput,'blur',function(ea){this._focused=false;}.bind(this)));}t.prototype.updateView=function(){"use strict";var ba=v(this);u(this);if(ba)w(this);};t.prototype.focusAndSelectSearch=function(){"use strict";y(this,j.getValue(this._searchInput));this._manager.scrollToTop(false);this.focus();this._searchInput.select();};t.prototype.focus=function(){"use strict";setTimeout((function(){if(!this._focused){this._searchInput.focus();this._searchInput.value=this._searchInput.value;}}).bind(this),0);};t.prototype.destroy=function(){"use strict";};function u(ba){var ca=n.getCurrentStateData();ba._state=n.getCurrentMasterState();ba._folder=ca.folder;if(ba._state!=m.MASTER.SEARCH){ba._query=null;}else ba._query=ca.query;}function v(ba){if(!ba._state||!ba._folder)return true;var ca=n.getCurrentMasterState(),da=n.getCurrentStateData();if(ba._folder!=da.folder)return true;if(ca!=ba._state)return true;if(ca==m.MASTER.SEARCH&&ba._query!=da.query)return true;return false;}function w(ba){if(ba._state==m.MASTER.SEARCH){var ca=ba._query||'';if(j.getValue(ba._searchInput)!=ca)j.setValue(ba._searchInput,ca);ba.focus();}else{j.reset(ba._searchInput);ba._searchInput.blur();}h.conditionClass(ba._searchBox,"_47",!j.isEmpty(ba._searchInput));}function x(ba){s.clearTimer();var ca=n.getCurrentStateData();ca.no_uri=true;delete ca.query;n.updateMasterState(m.MASTER.RECENT_THREADS,ca);}function y(ba,ca){var da=n.getCurrentMasterState();if(da!=m.MASTER.SEARCH)ba._threadID=n.getCurrentStateData().thread_id;if(ca)n.updateDetailState(m.DETAIL.SEARCH_SNIPPET,{query:ca,message_query:ca});}function z(ba,ca){var da=n.getCurrentStateData();if(ca!==da.query){var ea=n.getCurrentMasterState();if(ea!=m.MASTER.SEARCH)ba._threadID=da.thread_id;if(ca)n.updateMasterState(m.MASTER.SEARCH,{all_people_query:da.all_people_query,message_query:da.message_query,message_id:da.message_id,query:ca,thread_id:da.thread_id});}}function aa(ba,ca,da){if(i.contains(ba._ariaOwns,da))ba._searchInput.setAttribute('aria-activedescendant',da);}e.exports=t;},null);
__d("MercuryLogger",["JSLogger","MercuryThreadIDMap","MercuryThreads"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();var h=b('MercuryThreadIDMap').get(),i=b('MercuryThreads').get(),j=g.create('messaging_impressions');function k(event,o){j.log(event,o);}function l(o,p){var q=i.getThreadMetaNow(o);if(q){var r=h.getFBIDFromClientIDNow(o);if(r){var event=p?'thread_search':'thread',s={is_single_thread:q.is_canonical_user,is_subscribed:q.is_subscribed,query:p||null};s.thread_fbid=r;k(event,s);}j.bump('opened_thread_'+q.folder);}}function m(o,p){var q={};p.forEach(function(r){var s=h.getFBIDFromClientIDNow(r),t=i.getThreadMetaNow(r);if(t&&s){var u={is_single_thread:t.is_canonical_user,folder:t.folder,participants:t.participants,canonical_fbid:t.canonical_fbid};u.thread_fbid=s;q[s]=u;}});k('threadlist',{folder:o,threads:q});j.bump('opened_threadlist_'+o);}var n={logThread:function(o){l(o);},logThreadlist:function(o,p){m(o,p);},logThreadFromSearch:function(o,p){l(p,o);},logThreadlistFromSearch:function(o,p){k('threadlist_search',{folder:p,query:o});}};e.exports=n;},null);
__d("WebMessengerThreadlistRenderer",["CSS","DOM","Event","Focus","MercuryListUpdateRenderer","MercuryAPIArgsSource","MessagingTag","WebMessengerStateConstants","WebMessengerStateManager","WebMessengerTemplates","MercuryThreadMetadataRawRenderer","MercuryThreadMetadataRenderer","Tooltip","WebMessengerMercury","WebMessengerPermalinks","WebMessengerDeleteThreadDialog","cx","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x){b.__markCompiled&&b.__markCompiled();var y={renderThreadsFromIDs:function(aa,ba,ca,da,ea,fa){da=da||function(ga){return ga;};ea=ea||{};k.updateList(aa,ba.map(da),function(ga){return !ea[ba[ga]]&&ba[ga]!=ca;},function(ga){var ha=ba[ga],ia=p[':fb:web-messenger:threadlist-row'].build();ia.getRoot().setAttribute('id',da(ha));var ja=ia.getNode('threadLink');j.listen(ja,function(ka){g.conditionClass(ia.getRoot(),"_5fes",ka);});i.listen(ja,'click',function(ka){if(ka.getModifiers().any)return true;var la=o.getCurrentMasterState(),ma={thread_id:ha};if(la===n.MASTER.SEARCH)ma.query=o.getCurrentStateData().query;o.updateDetailState(n.DETAIL.RECENT_MESSAGES,ma);return false;});if(ha==ca)g.addClass(ia.getRoot(),"_kv");t.getThreads().getThreadMeta(ha,function(ka){var la=r.getForFBID(o.getCurrentUserID());la.renderCoreThreadlist(ka,ia,z.bind(null,fa),{names_renderer:q.renderShortNames,show_unread_count:false},true);},l.WEBMESSENGER);return ia.getRoot();});}};function z(aa,ba,ca){var da=ba.getNode('readToggler'),ea=ba.getNode('archiveButton'),fa=ba.getNode('deleteButton');ba.getNode('threadLink').setAttribute('href',u.getURI(aa,n.DETAIL.RECENT_MESSAGES,{thread_id:ca.thread_id}).toString());if(ca.unread_count>0){g.addClass(ba.getRoot(),"_kx");h.setContent(ba.getNode('newCount'),x._("{num} new",[x.param("num",ca.unread_count)]));g.addClass(da,"_ky");s.set(da,x._("Mark as Read"),'above','right');}else{g.addClass(da,"_kz");s.set(da,x._("Mark as Unread"),'above','right');}i.listen(da,'click',function(event){var ia=t.getThreadActions();g.hasClass(da,"_ky")?ia.markRead(ca.thread_id):ia.markUnread(ca.thread_id);return false;});var ga=o.getCurrentStateData().folder;if(ga==m.SPAM){s.set(fa,x._("Delete Conversation"),'above','right');g.addClass(fa,"_4_3q");i.listen(fa,'click',function(event){v.show(ca.thread_id);});g.hide(ea);}else{g.hide(fa);var ha=true;if(ga==m.ACTION_ARCHIVED){ha=false;s.set(ea,x._("Unarchive"),'above','right');g.addClass(ea,"_2s2");}else{s.set(ea,x._("Archive"),'above','right');g.addClass(ea,"_l9");}i.listen(ea,'click',function(event){var ia=t.getThreadActions();ha?ia.archive(ca.thread_id):ia.unarchive(ca.thread_id);var ja=o.getCurrentStateData();if(ja.thread_id==ca.thread_id)o.updateDetailState(n.DETAIL.RECENT_MESSAGES,{folder:ja.folder});return false;});}}e.exports=y;},null);
__d("WebMessengerMasterViewUnseenMessagesNotice",["MercuryThreadlistConstants","MessagingTag","WebMessengerStateManager","UserActivity","WebMessengerSubscriptionsHandler","WebMessengerMessagesNotice","WebMessengerConstants","WebMessengerMercury","throttle"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){b.__markCompiled&&b.__markCompiled();var p=m.THREADLIST_SCROLLTOP_OFFSET,q=g.MESSAGE_NOTICE_INACTIVITY_THRESHOLD;for(var r in l)if(l.hasOwnProperty(r))t[r]=l[r];var s=l===null?null:l.prototype;t.prototype=Object.create(s);t.prototype.constructor=t;t.__superConstructor__=l;function t(y){"use strict";l.call(this);this._manager=y;this._threadInformer=n.getThreadInformer();this._unseenState=n.getUnseenState();k.addSubscriptions(this._threadInformer.subscribe('messages-received',function(z,aa){var ba=!j.isActive(q),ca=!this.isScrolledWithinTopThreshold();if(!s.getActive.call(this)||w(aa)||!v(aa))return;if(s.onlyReceivedFromSelf.call(this,aa))return;if(ba){this.removeMessageNotice();this._manager.scrollToTop();}else if(ca)this.showMessageNotice();}.bind(this)),this._threadInformer.subscribe('unseen-updated',u.bind(null,this)));this._manager.addScrollCallback(o.withBlocking(function(z){if(s.getActive.call(this)&&z.getScrollTop()<=m.THREADLIST_TOP_OFFSET&&j.isActive(q)&&x()){this.removeMessageNotice();this._unseenState.markAsSeen();}}.bind(this),100,null));}t.prototype.isScrolledWithinTopThreshold=function(){"use strict";return this._manager.getScrollTop()<=p;};t.prototype.showMessageNotice=function(){"use strict";if(!x())return;var y=function(){this._manager.scrollToTop();}.bind(this);s.showMessageNotice.call(this,y,'below');};function u(y){if(y._unseenState.getUnseenCount()===0)y.removeMessageNotice();}function v(y){for(var z in y)for(var aa=0;aa<y[z].length;aa++)if(y[z][aa].folder==h.INBOX)return true;return false;}function w(y){var z=i.getCurrentStateData().thread_id,aa=true;for(var ba in y)if(y.hasOwnProperty(ba))if(ba!==z){aa=false;break;}return x()&&aa;}function x(){var y=i.getCurrentStateData().folder;return y===h.INBOX;}e.exports=t;},null);
__d("WebMessengerMasterViewRecentThreadsControl",["CSS","DOM","Event","MercuryLogger","MercuryAPIArgsSource","MercuryFilters","MercuryFolders","MercuryThreadlistConstants","MessagingTag","WebMessengerShortcuts","WebMessengerStateConstants","WebMessengerStateManager","WebMessengerTemplates","WebMessengerThreadlistRenderer","WebMessengerConstants","WebMessengerEvents","WebMessengerInfoBoxRenderer","WebMessengerSubscriptionsHandler","WebMessengerMasterViewUnseenMessagesNotice","WebMessengerMercury","createObjectFrom","cx","ge","fbt","UserActivity"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da){b.__markCompiled&&b.__markCompiled();b('UserActivity');var ea='recent:';function fa(xa,ya,za,ab){"use strict";this._manager=xa;this._rootElement=ya;this._infoBox=za;this._orderedThreadlist=z.getOrderedThreadlist();this._serverRequests=z.getServerRequests();this._threadInformer=z.getThreadInformer();this._threads=z.getThreads();this._unseenState=z.getUnseenState();h.empty(this._rootElement);this._pagerExponent=-1;var bb=s[':fb:web-messenger:threadlist'].build();h.setContent(this._rootElement,bb.getRoot());this._loadingSpinner=bb.getNode('loadingSpinner');this._threadlistRows=bb.getNode('threadlistRows');this._loadMoreButton=bb.getNode('loadMoreButton');this._loadMoreLink=bb.getNode('loadMoreLink');this._active=false;this._state=null;this._folder=null;this._filter=null;this._selection=null;this._threadIDs=[];this._unreadThreadIDs=[];this._folders=m.getSupportedFolders();this._filters=l.getSupportedFilters();this._olderTimestamp={};this._currentCountMap={};this._folders.forEach(function(cb){this._currentCountMap[cb]={};this._filters.concat([l.ALL]).forEach(function(db){this._currentCountMap[cb][db]=n.WEBMESSENGER_THREAD_COUNT+1;}.bind(this));}.bind(this));this._unseenMessagesNotice=new y(this._manager);this._unseenMessagesNotice.setNoticeContextNode(ab);x.addSubscriptions(this._threadInformer.subscribe('threadlist-updated',function(cb,db){sa(this,aa(db));}.bind(this)),i.listen(this._loadMoreLink,'click',function(){ra(this);}.bind(this)),this._manager.subscribe('scrolledNearBottom',function(){this._active&&ra(this);}.bind(this)));}fa.prototype.updateView=function(){"use strict";this._active=true;this._unseenMessagesNotice.updateView();g.show(this._rootElement);var xa=ha(this),ya=ia(this),za=this._folder,ab=this._selection;ja(this);if(ya)ka(this,ab);if(xa){qa(this);}else la(this);if(za!=this._folder)j.logThreadlist(this._folder,this._threadIDs);if(this._selection&&ab!=this._selection)j.logThread(this._selection);};fa.prototype.hideView=function(){"use strict";this._active=false;this._unseenMessagesNotice.hideView();g.hide(this._rootElement);};fa.prototype.destroy=function(){"use strict";ga(this);this._unseenMessagesNotice.destroy();};function ga(xa){xa._threadlistSubscription&&xa._orderedThreadlist.unsubscribe(xa._threadlistSubscription.subscriber_id,xa._threadlistSubscription.folder,xa._threadlistSubscription.filter);xa._threadlistSubscription=null;}function ha(xa){var ya=r.getCurrentStateData();if((xa._folder!=ya.folder)||(xa._filter!=ya.filter))return true;return false;}function ia(xa){var ya=r.getCurrentStateData();if(xa._selection!=ya.thread_id)return true;return false;}function ja(xa){var ya=r.getCurrentStateData();xa._state=r.getCurrentMasterState();if((xa._folder!=ya.folder)||(xa._filter!=ya.filter))xa._pageExponent=-1;xa._folder=ya.folder;xa._filter=ya.filter;xa._selection=ya.thread_id;}function ka(xa,ya){var za=ca(wa(ya));if(za){g.removeClass(za,"_kv");za.removeAttribute('aria-selected');}var ab=ca(wa(xa._selection));if(ab){g.addClass(ab,"_kv");ab.setAttribute('aria-selected','true');}v.updateSelection(ab&&ab.id);}function la(xa){if(xa._active)p.updateThreadlistIndex(xa,xa._threadIDs.map(wa),wa(xa._selection));}function ma(xa){g.addClass(xa._manager.getFlexAreaElement(),"_3j6");g.addClass(xa._manager.getFlexAreaElement(),"_3j7");}function na(xa){g.removeClass(xa._manager.getFlexAreaElement(),"_3j6");g.removeClass(xa._manager.getFlexAreaElement(),"_3j7");}function oa(xa){g.hide(xa._threadlistRows);na(xa);}function pa(xa){if(xa._threadIDs.length){g.show(xa._threadlistRows);na(xa);}else{g.hide(xa._threadlistRows);ma(xa);}}function qa(xa){g.show(xa._loadingSpinner);g.hide(xa._infoBox);oa(xa);g.hide(xa._loadMoreButton);ga(xa);var ya=xa._orderedThreadlist.getFilteredThreadlist(n.RECENT_THREAD_OFFSET,xa._currentCountMap[xa._folder][xa._filter],xa._folder,xa._filter,function(za,ab){g.hide(xa._loadingSpinner);ta(xa,za,ab);pa(xa);la(xa);xa._manager.poke();xa._manager.forceFireScrollCallbacks();},null,k.WEBMESSENGER);if(ya)xa._threadlistSubscription={subscriber_id:ya,folder:xa._folder,filter:xa._filter};}function ra(xa){if(xa._requestInFlight||g.hasClass(xa._loadMoreButton,'hidden_elem'))return;xa._requestInFlight=true;g.addClass(xa._loadMoreButton,'async_saving');xa._pagerExponent=Math.min(xa._pagerExponent+1,u.EXPONENTIAL_PAGER_MAX_CYCLES);var ya=Math.pow(2,xa._pagerExponent),za=xa._currentCountMap[xa._folder][xa._filter]+ya*(n.WEBMESSENGER_MORE_COUNT);ga(xa);var ab=xa._orderedThreadlist.getFilteredThreadlist(n.RECENT_THREAD_OFFSET,za,xa._folder,xa._filter,function(bb,cb){g.removeClass(xa._loadMoreButton,'async_saving');xa._currentCountMap[xa._folder][xa._filter]=za;ta(xa,bb,cb);la(xa);xa._manager.poke();xa._requestInFlight=false;},null,k.WEBMESSENGER);if(ab)xa._threadlistSubscription={subscriber_id:ab,folder:xa._folder,filter:xa._filter};}function sa(xa,ya){if(!xa._folder||!xa._olderTimestamp[xa._folder])return;var za=xa._orderedThreadlist.getThreadlistUntilTimestamp(xa._olderTimestamp[xa._folder],xa._folder,xa._filter);if(xa._filter==o.UNREAD){za=va(xa,za);}else xa._unreadThreadIDs=[];if(za.length>xa._currentCountMap[xa._folder][xa._filter])xa._currentCountMap[xa._folder][xa._filter]=za.length;xa._threadIDs=za;pa(xa);t.renderThreadsFromIDs(xa._threadlistRows,za,xa._selection,wa,ya,q.MASTER.RECENT_THREADS);la(xa);xa._manager.poke();}function ta(xa,ya,za){var ab=(ya.length==xa._currentCountMap[xa._folder][xa._filter]);if(ab)ya.pop();if(ya.length){var bb=ya[ya.length-1];xa._threads.getThreadMeta(bb,function(cb){xa._olderTimestamp[xa._folder]=cb.timestamp;},k.WEBMESSENGER);}if(xa._filter==o.UNREAD){xa._unreadThreadIDs=ya;}else xa.unreadThreadIDs=[];g.conditionShow(xa._loadMoreButton,ab);xa._threadIDs=ya;t.renderThreadsFromIDs(xa._threadlistRows,ya,xa._selection,wa,null,q.MASTER.RECENT_THREADS);za=za&&ya.length===0;za&&ua(xa);g.conditionShow(xa._infoBox,za);}function ua(xa){if(xa._builtErrorMessage)return;h.setContent(xa._infoBox,w.render(da._("Could Not Load Conversations"),[{text:da._("Try Again"),handler:qa.bind(null,xa)}]));xa._builtErrorMessage=true;}function va(xa,ya){ya.forEach(function(za){if(xa._unreadThreadIDs.indexOf(za)<0)xa._unreadThreadIDs.push(za);});xa._unreadThreadIDs.sort(function(za,ab){var bb=xa._threads.getThreadMetaNow(za).timestamp,cb=xa._threads.getThreadMetaNow(ab).timestamp;return cb-bb;});xa._unreadThreadIDs=xa._unreadThreadIDs.filter(function(za){var ab=xa._threads.getThreadMetaNow(za);return m.getFromMeta(ab)==xa._folder;});return xa._unreadThreadIDs;}function wa(xa){if(xa)return ea+xa;return null;}e.exports=fa;},null);
__d("MercurySearchThreadResultOrderer",["MercurySingletonMixin","MessagingTag","MercuryThreads","createObjectFrom"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();function k(o){"use strict";this.$MercurySearchThreadResultOrderer0=o;this.$MercurySearchThreadResultOrderer1=i.getForFBID(o);}k.prototype.separateCanonicalThreadsInFolder=function(o,p){"use strict";var q=[],r=[];o.forEach(function(s){var t=this.$MercurySearchThreadResultOrderer1.getThreadMetaNow(s);if(t.folder===p&&t.is_canonical){q.push(s);}else r.push(s);}.bind(this));return {canonical_in_folder:q.sort(function(s,t){return this.$MercurySearchThreadResultOrderer2(s,t);}.bind(this)),remaining:r};};k.prototype.filterThreadsInFolder=function(o,p){"use strict";var q=[];o.forEach(function(r){var s=this.$MercurySearchThreadResultOrderer1.getThreadMetaNow(r);if(s.folder===p&&s.is_archived===false){q.push(r);}else if(p===h.ACTION_ARCHIVED&&s.is_archived===true)q.push(r);}.bind(this));return q;};k.prototype.orderResults=function(o,p,q,r){"use strict";var s=n(p,q),t=s.sort(this.$MercurySearchThreadResultOrderer3.bind(this,r));return n(o,t);};k.prototype.$MercurySearchThreadResultOrderer3=function(o,p,q){"use strict";var r=this.$MercurySearchThreadResultOrderer1.getThreadMetaNow(p),s=this.$MercurySearchThreadResultOrderer1.getThreadMetaNow(q),t=l(r),u=l(s);if(t!==u)return m(t,o)>m(u,o)?-1:1;if(r.is_canonical!==s.is_canonical)return r.is_canonical?-1:1;return this.$MercurySearchThreadResultOrderer2(p,q);};k.prototype.$MercurySearchThreadResultOrderer2=function(o,p){"use strict";var q=this.$MercurySearchThreadResultOrderer1.getThreadMetaNow(o),r=this.$MercurySearchThreadResultOrderer1.getThreadMetaNow(p);return q.timestamp>r.timestamp?-1:1;};function l(o){return o.is_archived?h.ACTION_ARCHIVED:o.folder;}function m(o,p){if(o===p)return 5;var q={};q[h.INBOX]=4;q[h.ACTION_ARCHIVED]=3;q[h.OTHER]=2;q[h.SPAM]=1;return q[o];}function n(o,p){var q=j(o),r=p.filter(function(s){return !(s in q);});return o.concat(r);}Object.assign(k,g);e.exports=k;},null);
__d("WebMessengerMasterViewSearchThreadsControl",["Event","CSS","DOM","MercuryFolders","MercuryLogger","WebMessengerShortcuts","WebMessengerStateConstants","WebMessengerStateManager","WebMessengerTemplates","WebMessengerThreadlistRenderer","WebMessengerEvents","WebMessengerMercury","WebMessengerSubscriptionsHandler","createObjectFrom","csx","cx","fbt","ge","getElementText","MercurySearchThreadResultOrderer","MercurySearchThreadResults","MercurySearchThreadsStrategy"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y){b.__markCompiled&&b.__markCompiled();var z=b('MercurySearchThreadResultOrderer').get(),aa=b('MercurySearchThreadResults').get(),ba=b('MercurySearchThreadsStrategy').get(),ca='search:',da='search-indicator';function ea(ab,bb,cb,db){"use strict";this._manager=ab;this._rootElement=bb;this._noMessagesIndicator=db;this._orderedThreadlist=r.getOrderedThreadlist();this._threadInformer=r.getThreadInformer();this._threads=r.getThreads();i.empty(this._rootElement);var eb=o[':fb:web-messenger:thread-search'].build();i.setContent(this._rootElement,eb.getRoot());this._loadingSpinner=eb.getNode('loadingSpinner');this._threadlistRows=eb.getNode('threadlistRows');this._loadMoreButton=eb.getNode('loadMoreButton');this._loadMoreLink=eb.getNode('loadMoreLink');var fb=o[':fb:web-messenger:master-view-snippets-link'].build();this._threadSearchResultDescription=fb.getNode('threadSearchResultDescription');this._searchMessagesIndicator=fb.getRoot();this._searchMessagesIndicator.setAttribute('id',ca+da);i.replace(cb,this._searchMessagesIndicator);this._snippetSearchLink=fb.getNode('snippetSearchLink');this._snippetSearchLinkText=fb.getNode('snippetSearchLinkText');this._active=false;this._detailState=null;this._query=null;this._folder=null;this._selection=null;this._keyboardSelection=null;this._threadIDs=[];this._oldestTimestamps=ga(this);this._namesChangedSinceLastRedraw=false;this._remoteResultsCompleted=true;s.addSubscriptions(this._threadInformer.subscribe('threadlist-updated',function(gb,hb){sa(this,t(hb));}.bind(this)),this._threadInformer.subscribe('messages-received',function(){this._namesChangedSinceLastRedraw=true;}.bind(this)),g.listen(this._loadMoreLink,'click',function(){ra(this);}.bind(this)),g.listen(this._snippetSearchLink,'click',function(){this.updateKeyboardSelection(da);za(this);}.bind(this)));}ea.prototype.updateView=function(){"use strict";this._active=true;h.show(this._rootElement);h.hide(this._loadingSpinner);var ab=ha(this),bb=ia(this),cb=this._folder,db=this._query,eb=this._selection;ja(this);if(bb||ab){var fb=this._keyboardSelection;switch(this._detailState){case m.DETAIL.RECENT_MESSAGES:this._keyboardSelection=this._selection;break;case m.DETAIL.SEARCH_SNIPPET:case m.DETAIL.SEARCH_CONTEXT:this._keyboardSelection=da;}ka(this,fb);}if(ab){pa(this);}else{la(this,false);qa(this);}if(db!=this._query||cb!=this._folder)k.logThreadlistFromSearch(this._query,this._folder);if(this._selection&&eb!=this._selection)k.logThreadFromSearch(this._query,this._selection);};ea.prototype.hideView=function(){"use strict";this._active=false;h.hide(this._rootElement);ta(this,false);qa(this);};ea.prototype.openSearchThread=function(ab){"use strict";if(ab==da){za(this);}else n.updateDetailState(m.DETAIL.RECENT_MESSAGES,{query:this._query,thread_id:ab});};ea.prototype.updateKeyboardSelection=function(ab){"use strict";var bb=this._keyboardSelection;this._keyboardSelection=ab;ka(this,bb);};ea.prototype.destroy=function(){"use strict";fa(this);};function fa(ab){ab._searchThreadsSubscription&&aa.unsubscribe(ab._searchThreadsSubscription.subscriber_id,ab._searchThreadsSubscription.query);ab._searchThreadsSubscription=null;}function ga(ab){var bb={};j.getSupportedFolders().forEach(function(cb){var db=ab._orderedThreadlist.getThreadlistUntilTimestamp(0,cb);bb[cb]=db.length>0?ab._threads.getThreadMetaNow(db[db.length-1]).timestamp:Infinity;}.bind(this));return bb;}function ha(ab){var bb=ab._namesChangedSinceLastRedraw;ab._namesChangedSinceLastRedraw=false;if(bb)return true;if(!ab._remoteResultsCompleted)return true;var cb=ga(ab),db=ab._oldestTimestamps;ab._oldestTimestamps=cb;var eb=n.getCurrentStateData();if(ab._query!==eb.query||ab._folder!==eb.folder)return true;for(var fb in db)if(db[fb]>cb[fb])return true;return false;}function ia(ab){var bb=n.getCurrentStateData();if(ab._selection!=bb.thread_id)return true;return false;}function ja(ab){var bb=n.getCurrentStateData();ab._detailState=n.getCurrentDetailState();ab._query=bb.query;ab._folder=bb.folder;ab._selection=bb.thread_id;}function ka(ab,bb){var cb=x(xa(bb));if(cb){h.removeClass(cb,"_kv");cb.removeAttribute('aria-selected');}var db=x(xa(ab._keyboardSelection));if(db){h.addClass(db,"_kv");db.setAttribute('aria-selected',true);}q.updateSelection(db&&db.id);}function la(ab,bb){if(ab._keyboardSelection&&ab._keyboardSelection!=da&&ab._threadIDs.indexOf(ab._keyboardSelection)<0)ab._keyboardSelection=null;if(!ab._keyboardSelection)if(ab._threadIDs.length){ab._keyboardSelection=ab._threadIDs[0];}else if(!bb){ab._keyboardSelection=da;ka(ab);}var cb=ab._threadIDs.slice(0);cb.push(da);if(ab._active)l.updateThreadlistIndex(ab,cb.map(xa),xa(ab._keyboardSelection));}function ma(ab){var bb=i.scry(ab._threadlistRows,"._l5");bb.filter(function(cb){return y(cb)!==n.getCurrentStateData().folder;}).forEach(h.show.bind(h));}function na(ab){var bb=i.scry(ab._threadlistRows,"._l5");bb.forEach(h.hide.bind(h));}function oa(ab){ma(ab);ab._manager.draw();}function pa(ab){h.show(ab._loadingSpinner);ta(ab,false);h.hide(ab._threadlistRows);h.hide(ab._loadMoreButton);na(ab);fa(ab);if(ab._query){var bb=[],cb=[];ab._remoteResultsCompleted=false;ba.search(ab._query,function(db){var eb=z.separateCanonicalThreadsInFolder(db,n.getCurrentStateData().folder);bb=eb.canonical_in_folder;cb=eb.remaining;ya(ab);h.show(ab._threadlistRows);va(ab,bb);oa(ab);},function(db,eb){ab._remoteResultsCompleted=true;var fb=z.orderResults(bb,cb,db,n.getCurrentStateData().folder);if(fb.length>0){h.conditionShow(ab._loadMoreButton,!eb);wa(ab,fb);}else ua(ab);h.hide(ab._loadingSpinner);oa(ab);},function(db,eb){if(db)ab._searchThreadsSubscription={subscriber_id:db,query:eb};});}else{ba.clearTimer();h.hide(ab._loadingSpinner);i.empty(ab._threadlistRows);h.show(ab._threadlistRows);ab._threadIDs=[];}qa(ab);}function qa(ab){var bb=!!ab._query&&ab._active,cb=bb^h.shown(ab._searchMessagesIndicator);h.conditionShow(ab._searchMessagesIndicator,bb);ab._manager.sizeToFit(bb);cb&&ab._manager.draw();}function ra(ab){fa(ab);h.addClass(ab._loadMoreButton,'async_saving');var bb=aa.getMoreThreadlist(ab._query,function(cb,db){h.removeClass(ab._loadMoreButton,'async_saving');h.conditionShow(ab._loadMoreButton,!db);wa(ab,cb);ab._manager.poke();});if(bb)ab._searchThreadsSubscription={subscriber_id:bb,query:ab._query};}function sa(ab,bb){if(ab._threadIDs.length){p.renderThreadsFromIDs(ab._threadlistRows,ab._threadIDs,ab._keyboardSelection,xa,bb,m.MASTER.SEARCH);ab._manager.poke();}}function ta(ab,bb){bb=bb&&ab._active;h.conditionClass(ab._searchMessagesIndicator,"_33x",bb!==false);h.conditionShow(ab._noMessagesIndicator,bb!==false);}function ua(ab){ab._threadIDs=[];la(ab,false);var bb=w._("No people or conversations named {query}",[w.param("query",ab._query)]),cb=i.create('div',{},bb);i.setContent(ab._noMessagesIndicator,cb);ta(ab,true);}function va(ab,bb){wa(ab,bb,true);}function wa(ab,bb,cb){ab._threadIDs=bb;la(ab,cb);p.renderThreadsFromIDs(ab._threadlistRows,bb,ab._keyboardSelection,xa,null,m.MASTER.SEARCH);q.updateSelection(ab._keyboardSelection);if(ab._keyboardSelection==da)ka(ab);}function xa(ab){if(ab)return ca+ab;return null;}function ya(ab){var bb=w._("Showing results for name: {query}",[w.param("query",ab._query)]);i.setContent(ab._threadSearchResultDescription,bb);}function za(ab){if(ab._query){n.updateDetailState(m.DETAIL.SEARCH_SNIPPET,{query:ab._query,message_query:ab._query});q.focusSearch();}}e.exports=ea;},null);
__d("WebMessengerMasterViewControlManager",["ArbiterMixin","DOM","WebMessengerFlexibleScrollArea","WebMessengerMasterViewTabBarControl","WebMessengerMasterViewSearchInputControl","WebMessengerMasterViewRecentThreadsControl","WebMessengerMasterViewSearchThreadsControl","WebMessengerStateManager","WebMessengerStateConstants","Style","WebMessengerTemplates","WebMessengerEvents","WebMessengerSubscriptionsHandler","mixin"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){b.__markCompiled&&b.__markCompiled();var u=t(g);for(var v in u)if(u.hasOwnProperty(v))x[v]=u[v];var w=u===null?null:u.prototype;x.prototype=Object.create(w);x.prototype.constructor=x;x.__superConstructor__=u;function x(y){"use strict";u.call(this);this._rootElement=y;h.empty(this._rootElement);var z=q[':fb:web-messenger:master-view'].build();h.setContent(this._rootElement,z.getRoot());this._tabBarControl=new j(this,z.getNode('masterViewTabBar'),z.getNode('masterViewTopContent'));this._searchInputControl=new k(this,z.getNode('masterViewSearchInput'));this._searchThreadsControl=new m(this,z.getNode('masterViewSearchThreads'),z.getNode('searchMessagesIndicator'),z.getNode('noMessages'));this._threadlistRowsWrapper=z.getNode('threadlistRowsWrapper');this._flexArea&&this._flexArea.destroy();var aa={fade:true,persistent:true};this._flexArea=new i(this._threadlistRowsWrapper,aa).setInfiniteScrollHandler(this.inform.bind(this,'scrolledNearBottom')).setContainer(this._rootElement).setMinFlexAreaHeight(40).draw();this._recentThreadsControl=new l(this,z.getNode('masterViewRecentThreads'),z.getNode('masterInfoBox'),z.getNode('masterViewTabBar'));s.addSubscriptions(r.subscribe(r.FOCUS_AND_SELECT_SEARCH,this._searchInputControl.focusAndSelectSearch.bind(this._searchInputControl)),r.subscribe(r.FOCUS_SEARCH,this._searchInputControl.focus.bind(this._searchInputControl)),r.subscribe(r.MASTER_DOM_CHANGED,function(){this._tabBarControl.updateView();this._flexArea&&this._flexArea.draw();}.bind(this)),n.subscribe(o.STATE_CHANGE_EVENT,this.updateOnStateChange.bind(this)));this._resizeNodes=[this._rootElement,this._threadlistRowsWrapper,h.find(this._threadlistRowsWrapper,'div.uiScrollableAreaBody')];}x.prototype.updateOnStateChange=function(){"use strict";var y=n.getCurrentMasterState();this._tabBarControl.updateView();this._searchInputControl.updateView();switch(y){case o.MASTER.RECENT_THREADS:this._searchThreadsControl.hideView();this._recentThreadsControl.updateView();break;case o.MASTER.SEARCH:this._recentThreadsControl.hideView();this._searchThreadsControl.updateView();break;}};x.prototype.scrollIntoView=function(y,z){"use strict";this._flexArea&&this._flexArea.scrollIntoView(y,z);};x.prototype.scrollToBottom=function(y){"use strict";this._flexArea&&this._flexArea.scrollToBottom(y);};x.prototype.scrollToTop=function(y){"use strict";this._flexArea&&this._flexArea.scrollToTop(y);};x.prototype.isScrolledToTop=function(){"use strict";return this._flexArea&&this._flexArea.isScrolledToTop();};x.prototype.getScrollTop=function(){"use strict";return this._flexArea.getScrollableArea().getScrollTop();};x.prototype.draw=function(){"use strict";this._flexArea&&this._flexArea.draw();};x.prototype.poke=function(){"use strict";this._flexArea&&this._flexArea.poke();};x.prototype.sizeToFit=function(y){"use strict";this._flexArea&&this._flexArea.setSizeToFit(y);};x.prototype.addScrollCallback=function(y){"use strict";this._flexArea&&this._flexArea.addScrollCallback(y);};x.prototype.forceFireScrollCallbacks=function(){"use strict";this._flexArea&&this._flexArea._onScroll();};x.prototype.getFlexAreaElement=function(){"use strict";return this._flexArea.flexArea;};x.prototype.resizeTo=function(y){"use strict";if(y!==null){y=y.toString();if(!(y.endsWith('%')||y.endsWith('px')))y=y+'px';}this._resizeNodes.forEach(function(z){p.set(z,'width',y);});r.masterDOMChanged();};x.prototype.destroy=function(){"use strict";this._tabBarControl.destroy();this._recentThreadsControl.destroy();this._searchThreadsControl.destroy();this._flexArea.destroy();};e.exports=x;},null);
__d("WebMessengerPageTitleRenderer",["DocumentTitle","MercuryAPIArgsSource","MercuryViewer","MercuryParticipants","WebMessengerStateConstants","WebMessengerStateManager","fbt","MercuryThreadMetadataRenderer","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){b.__markCompiled&&b.__markCompiled();var n=b('MercuryThreadMetadataRenderer').get(),o=b('MercuryThreads').get(),p={updateTitleForState:function(s,t,u){this.withTitleForState(s,t,u||function(v){var w=l.getCurrentDetailState(),x=l.getCurrentStateData();if(s===w&&t===x)g.set(v);});},withTitleForState:function(s,t,u){switch(s){case k.DETAIL.RECENT_MESSAGES:q(t.thread_id,u);break;default:r(u);break;}}};function q(s,t){if(!s){r(t);return;}o.getThreadMeta(s,function(u){if(u.name){t(m._("{conversation_name} - Messages",[m.param("conversation_name",u.name)]));return;}j.getMulti(u.participants,function(v){var w=[];for(var x in v)if(v.hasOwnProperty(x))w.push(v[x]);var y=n.renderParticipantList(s,w,v[i.getID()]?u.participants.length-1:u.participants.length,{abbr_mode:true,last_separator_uses_and:true,names_renderer:function(z){var aa=[];if(z.length===1&&z[0].id===i.getID()){aa.push(z[0].name);}else for(var ba=0;ba<z.length;ba++)if(z[ba].id!==i.getID())aa.push(z[ba].name);return aa;}});t(m._("{conversation_name} - Messages",[m.param("conversation_name",y)]));});},h.WEBMESSENGER);}function r(s){s(m._("Messages"));}e.exports=p;},null);
__d("WebMessengerPageTitleControl",["WebMessengerPageTitleRenderer","WebMessengerStateManager","WebMessengerStateConstants","WebMessengerSubscriptionsHandler","WebMessengerEvents"],function(a,b,c,d,e,f,g,h,i,j,k){b.__markCompiled&&b.__markCompiled();var l=function(){var m=function(){g.updateTitleForState(h.getCurrentDetailState(),h.getCurrentStateData());};j.addSubscriptions(h.subscribe(i.STATE_CHANGE_EVENT,m),k.subscribe(k.DETAIL_DOM_CHANGED,m));};e.exports=l;},null);
__d("WebMessengerThreadMessagesAgent",["MercuryAPIArgsSource","MessagingTag","WebMessengerConstants","MercuryMessages","MercuryOrderedThreadlist","MercuryThreadInformer","MercuryThreads"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();var j=b('MercuryMessages').get(),k=b('MercuryOrderedThreadlist').get(),l=b('MercuryThreadInformer').get(),m=b('MercuryThreads').get(),n=21,o=false,p='n_inbox_n_unreads',q=i.THREADLIST_MAX_READ_PRELOAD_NUM,r=i.THREADLIST_MAX_UNREAD_PRELOAD_NUM;function s(){"use strict";this._active=true;this._iterative=o;this._strategy=p;this._requestInFlight=false;this._requestIsQueued=false;this._pendingThreadIds={};this._processedThreadIds={};this._threadInformerSubscriptions=[];this._threadInformerSubscriptions.push(l.subscribe('threadlist-updated',t.bind(null,this)));}s.prototype.turnOn=function(){"use strict";this._active=true;};s.prototype.turnOff=function(){"use strict";this._active=false;};s.prototype.destroy=function(){"use strict";this._threadInformerSubscriptions.forEach(l.unsubscribe);this._threadInformerSubscriptions=[];};function t(w){if(w._active&&!w._requestIsQueued){if(w._requestInFlight){w._requestIsQueued=true;return;}var x=u(w);if(x.length){w._requestInFlight=true;if(x.length>n){x=x.slice(0,n);w._requestIsQueued=true;}}x.forEach(function(y){w._processedThreadIds[y]=true;w._pendingThreadIds[y]=true;j.getThreadMessagesRange(y,0,i.INITIAL_MESSAGES_LIMIT+1,function(){v(w,y);},null,g.WEBMESSENGER);});}}function u(w){var x=k.getThreadlistUntilTimestamp(0,h.INBOX),y=x.filter(function(da){return !w._processedThreadIds[da]&&!j.hasLoadedNMessages(da,i.INITIAL_MESSAGES_LIMIT+1);});if(w._strategy===p){var z=[],aa=[];for(var ba=0;ba<y.length;ba++){var ca=m.getThreadMetaNow(y[ba]);if(ca){if(ca.unread_count&&aa.length<r)aa.push(y[ba]);if(!ca.unread_count&&z.length<q)z.push(y[ba]);if(aa.length>=r&&z.length>=q)break;}}y=z.concat(aa);}return y;}function v(w,x){if(w._pendingThreadIds[x])delete w._pendingThreadIds[x];if(Object.keys(w._pendingThreadIds).length===0){if(!w._iterative)w._active=false;w._requestInFlight=false;if(w._requestIsQueued){w._requestIsQueued=false;t(w);}}}e.exports=s;},null);
__d("WebMessengerAdsControl",["AdsMouseStateStore","Animation","Arbiter","CSS","CurrentUser","DOM","EgoAdsObjectSet","Event","KeyedCallbackManager","MercuryIDs","UIPagelet","URI","UserActivity","Vector","WebMessengerAdsConfig","WebMessengerStateManager","cx","shield","WebMessengerSubscriptionsHandler","cx","csx","throttle","WebMessengerConstants","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,w,z,aa,ba){b.__markCompiled&&b.__markCompiled();var ca=b('MercuryThreads').get(),da=600,ea=ba.ADS_ROTATION_INTERVAL_PASSIVE,fa=ba.ADS_ROTATION_THRESHOLD_ACTIVE,ga=ba.MAX_ADS,ha=2,ia=165,ja=g.STATES,ka='data-height',la=new o(),ma='webMessengerAdsStage',na=0,oa={};function pa(){}Object.assign(pa,{init:function(){this._ads=new m();this._initializedAds=false;this._loadingCount=null;this._stage=null;this._drawCount=0;this._lastRefresh=0;this._pageletInProgress=null;this._lastMousedOnAds=false;this._waitOn(['codes','container','sidebar','footer'],this.start.bind(this));y.addSubscriptions(s.subscribe(x(this._refreshIfReady,this)),i.subscribe('footerLoaded',function(){la.setResource('footer',1);}),i.subscribe(['sidebar/initialized','sidebar/show','sidebar/hide','minisidebar/show'],this._sideBarChanged.bind(this)),la);return this;},setContainer:function(wa){la.setResource('container',wa);this._container=wa;},setTrackingCodes:function(wa){la.setResource('codes',wa);},getTrackingCodes:function(){return la.getResource('codes');},updateRhcID:function(){var wa=l.scry(this._container,'div.ego_section')[0];if(!wa)return;g.updateRhcID(l.getID(wa));},start:function(){this._stage=l.create('div',{id:ma,className:"_2rn"});this._ego=l.find(this._container,"._81");l.insertAfter(this._ego,this._stage);this.updateRhcID();this._updateFooterHeight();this.waitForAdsLoad(this._container,this._processOnPageUnits.bind(this));y.addSubscriptions(n.listen(window,'resize',aa(this.draw,100,this)),n.listen(this._ego,'mouseenter',x(this._mouseEvent,this,true)),n.listen(this._ego,'mouseleave',x(this._mouseEvent,this,false)));},stateChanged:function(wa,xa){wa=wa||{};xa=xa||{};if(wa.thread_id&&xa.thread_id&&xa.thread_id!==wa.thread_id)this._refreshIfReady(true);},draw:function(){var wa=this._loadingCount<=0;if(!this._initializedAds||!this._drawCount&&!wa)return;this._adjustAdsToFit();},_processOnPageUnits:function(){this._ads.init(ua(this._ego));this._initializedAds=true;this._adjustAdsToFit();},_processStagedUnits:function(){this._pageletInProgress=false;var wa=ua(this._stage);if(!this._lastMousedOnAds&&wa.length&&!this._focusedOnAds()){l.empty(this._ego);while(this._stage.childNodes.length)l.appendContent(this._ego,this._stage.firstChild);this._ads.init(wa);this._lastRefresh=Date.now();this._adjustAdsToFit();}},waitForAdsLoad:function(wa,xa){var ya=ua(wa);this._loadingCount=ya.length;if(!this._loadingCount){this._lastRefresh=Date.now()-ea/2;this._pageletInProgress=false;return;}var za=function(ab){ta(ab);if(--this._loadingCount<=0)xa();}.bind(this);ya.forEach(function(ab){function bb(){setTimeout(za.bind(null,ab),0);}var cb=l.scry(ab,'img.img')[0];if(!cb||cb.complete){bb();}else n.listen(cb,{load:bb,error:bb,abort:bb});}.bind(this));},_adjustAdsToFit:function(){this._drawCount++;var wa=t.getViewportDimensions().y,xa=wa-this._footerHeight-ia,ya=xa,za=0;while(ya>0&&za<this._ads.getCount()){ya-=sa(this._ads.getUnit(za));if(ya>=0)za++;}za=Math.max(za,ha);for(var ab=0;ab<this._ads.getCount();ab++)ra(this._ads.getUnit(ab),ab>=za);j.conditionShow(this._ego,za);j.addClass(this._ads.getUnit(0),'ego_unit_no_top_border');var bb=l.scry(this._container,'.ego_section');bb.forEach(function(cb){qa(cb,l.scry(cb,'[data-onscreen]').length);});qa(this._container,true);this._registerImpressions(za);this._registerHoldoutImpressions(xa);i.inform('WebMessengerAdsControl/adjustAds');},_waitOn:function(wa,xa){la.executeOrEnqueue(wa,xa);},_mouseEvent:function(wa){this._lastMousedOnAds=wa;},intentShown:function(){if(!u.stateRefresh)return false;var wa=g.getState();switch(wa){case ja.STATIONARY:return !u.refreshOnStationary;case ja.INTENT:case ja.HOVER:return true;default:return false;}},_focusedOnAds:function(){return l.contains(this._container,document.activeElement);},_refreshIfReady:function(wa){var xa=wa?fa:ea;if(this._lastRefresh===0){this._lastRefresh=Date.now();return;}else if(this._pageletInProgress||!this._drawCount||this._lastMousedOnAds||this._focusedOnAds()||this.intentShown()||this._lastRefresh+xa>Date.now())return;la.reset();this._waitOn(['codes'],this.waitForAdsLoad.bind(this,this._stage,this._processStagedUnits.bind(this)));this._pageletInProgress=q.loadFromEndpoint('WebEgoPane',ma,{pid:43,data:[k.getID(),ga,++na,va()]},{crossPage:true,bundle:false,handler:this.onLoadHandler.bind(this)});},onLoadHandler:function(){if(!u.fade)return;(new h(this._container)).from('opacity',0).to('opacity',1).duration(da).go();},_updateFooterHeight:function(){j.hide(this._ego);this._footerHeight=t.getElementDimensions(this._container).y;j.show(this._ego);},_registerImpression:function(wa){var xa=this.getTrackingCodes();if(!xa||!xa[wa])return null;var ya=l.create('iframe',{src:new r('/ai.php').addQueryData({aed:xa[wa]}),width:0,height:0,frameborder:0,scrolling:'no',className:'fbEmuTracking'});ya.setAttribute('aria-hidden','true');l.appendContent(this._container,ya);return ya;},_registerImpressions:function(wa){var xa=this.getTrackingCodes(),ya=oa;oa={};for(var za=0;za<wa;za++){if(!this._ads.getUnit(za))continue;var ab=l.scry(this._ads.getUnit(za),"div._4u8");if(!ab.length)continue;var bb=ab[0].getAttribute('data-ad'),cb=JSON.parse(bb).adid;if(cb in ya){oa[cb]=ya[cb];delete ya[cb];}else{if(!xa||!xa[cb])continue;var db=this._registerImpression(cb);delete xa[cb];if(db)oa[cb]=db;}}for(cb in ya)l.remove(ya[cb]);},_registerHoldoutImpressions:function(wa){var xa=this._ads.getHoldoutAdIDsForSpace(wa,sa);if(xa)xa.forEach(this._registerImpression.bind(this));},_sideBarChanged:function(wa,xa){if(wa=='sidebar/initialized')la.setResource('sidebar',1);this._initializedAds&&this.draw();}});function qa(wa,xa){j.conditionClass(wa,"_2rn",!xa);}function ra(wa,xa){j.conditionClass(wa,"_22r",xa);wa.setAttribute('aria-hidden',xa?'true':'false');if(xa){wa.removeAttribute('data-onscreen');}else wa.setAttribute('data-onscreen','1');}function sa(wa){if(!wa)return 0;var xa=wa.getAttribute(ka)||ta(wa);return parseInt(xa,10);}function ta(wa){var xa=t.getElementDimensions(wa).y;wa.setAttribute(ka,xa);return xa;}function ua(wa){return l.scry(wa,'div.ego_unit');}function va(){var wa=v.getCurrentStateData();if(wa.thread_id){var xa=ca.getThreadMetaNow(wa.thread_id);if(xa)return xa.participants.map(function(ya){return p.getUserIDFromParticipantID(ya);}).filter(function(ya){return ya&&ya!=k.getID();});}return [];}e.exports=pa;},null);
__d("WebMessengerApp",["Arbiter","CSS","WebMessengerDetailViewControlManager","DOM","WebMessengerMasterViewControlManager","MercuryStateCheck","WebMessengerPageTitleControl","PageTransitions","WebMessengerPermalinks","WebMessengerShortcuts","SnowflakePermalinkUtils","WebMessengerStateConstants","WebMessengerStateManager","WebMessengerStateStore","WebMessengerThreadMessagesAgent","URI","WebMessengerAdsControl","cx","emptyFunction","WebMessengerSubscriptionsHandler","WebMessengerWidthControl","clickRefAction","WebMessengerTemplates","MercuryServerPayloadPreprocessor","MercuryThreadInformer","MercuryDeliveryState"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca){b.__markCompiled&&b.__markCompiled();var da=b('MercuryServerPayloadPreprocessor').get(),ea=b('MercuryThreadInformer').get();b('MercuryDeliveryState').get();d(['VideoCallCore'],y);var fa,ga;function ha(na,oa){var pa=oa&&oa.getQueryData().hasOwnProperty('theater'),qa=oa&&q.isPermalinkURI(oa);if(pa){fa=g.subscribe('PhotoSnowlift.CLOSE',ia.bind(null,na),g.SUBSCRIBE_NEW);return false;}else if(qa){ga=g.subscribe('PhotoSnowflake.CLOSE',ia.bind(null,na),g.SUBSCRIBE_NEW);return false;}var ra=o.processURI(oa);if(ra){var sa=s.getCurrentStateData();if(ra.redirect){o.goNextURI(ra.master_state,ra.detail_state,ra.data,ra.replace);}else s.updateStateOnURI(ra.master_state,ra.detail_state,ra.data);n.transitionComplete();na._adsControl.stateChanged(sa,s.getCurrentStateData());return true;}ma(na);return false;}function ia(na){n.registerHandler(ha.bind(null,na),6);if(fa){fa.unsubscribe();fa=null;}if(ga){ga.unsubscribe();ga=null;}}function ja(){var na=s.getCurrentStateData();t.setLastSeen(na.folder,na.thread_id);}function ka(na,oa,pa,qa,ra,sa){z.engage();ia(this);g.inform('chat/set_does_page_occlude_tabs',true,g.BEHAVIOR_PERSISTENT);g.inform('chat/set_show_tab_unread_ui',false,g.BEHAVIOR_PERSISTENT);new u();s.setStandaloneMode(sa);da.handleUpdate(oa);l.get();j.empty(na);var ta=ca[':fb:web-messenger:page-skeleton'].build();j.setContent(na,ta.getRoot());if(s.getStandaloneMode())h.addClass(document.body,"_k0_");p.registerGeneralShortcuts();this._masterViewManager=new k(ta.getNode('masterView'));this._detailViewManager=new i(ta.getNode('detailView'));this._pageTitleControl=new m();qa&&j.prependContent(ta.getRoot(),qa);if(s.getStandaloneMode()){this._widthControl=null;this._masterViewManager.resizeTo(null);this._detailViewManager.resizeTo(null);}else this._widthControl=new aa(this._masterViewManager.resizeTo.bind(this._masterViewManager),this._detailViewManager.resizeTo.bind(this._detailViewManager),ra);this._adsControl=w.init();var ua=pa?new v(pa):o.getDefaultURI();ha(this,ua);ba('web_messenger').set_namespace('web_messenger');z.addSubscriptions(ea.subscribe('threads-deleted',function(va,wa){var xa=s.getCurrentStateData().thread_id,ya=s.getCurrentDetailState();if(ya==r.DETAIL.RECENT_MESSAGES&&wa[xa]){s.updateDetailState(r.DETAIL.RECENT_MESSAGES,{thread_id:null});}else ja();}),s.subscribe(r.STATE_CHANGE_EVENT,ja));d(['MercuryBrowserAlerts'],function(va){z.addSubscriptions(ea.subscribe('messages-received',function(wa,xa){for(var ya in xa){var za=xa[ya];for(var ab=0;ab<za.length;ab++)va.messageReceived(za[ab]);}}));va.subscribe('before-alert',function(wa,event){if(event.threadID==la())event.cancelAlert();});});}function la(){var na=s.getCurrentDetailState(),oa=s.getCurrentStateData();if(na==r.DETAIL.RECENT_MESSAGES||na==r.DETAIL.SEARCH_CONTEXT)return oa.thread_id;return null;}function ma(na){var oa=true;d(['ChatTabActions'],function(pa){oa&&pa.persistLocalState();});z.release();g.inform('chat/set_does_page_occlude_tabs',false,g.BEHAVIOR_PERSISTENT);g.inform('chat/set_show_tab_unread_ui',true,g.BEHAVIOR_PERSISTENT);na._masterViewManager.destroy();na._detailViewManager.destroy();oa=false;}e.exports=ka;},null);
__d("WebMessengerDetailViewCallButtonManagerImpl",["BanzaiLogger","CurrentUser","FBRTCCallabilityStore","FBRTCCore","FBRTCLogger","MercuryIDs","MercuryParticipants","Tooltip","invariant"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){b.__markCompiled&&b.__markCompiled();'use strict';var p={onCallClicked:function(q){g.log('VideoCallLoggerConfig',{event:'web_messenger_call_click'});var r=l.getUserIDFromThreadID(q);o(r);j.startOutgoingCall(r,k.Trigger.WEB_MESSENGER,false);},isVideoCallableThread:function(q){if(q){var r=l.getUserIDFromThreadID(q);if(r&&r!==h.getID())return true;}return false;},updateVideoCallButton:function(q,r){if(!r||!p.isVideoCallableThread(r))return;var s=l.getUserIDFromThreadID(r);o(s);q.disabled=!i.isCallable(s);m.get(l.getParticipantIDFromUserID(s),function(t){n.set(q,i.callButtonTooltip(s,t.short_name));});}};e.exports=p;},null);