/*!CK:3698600505!*//*1438116458,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["wvBf5"]); }

__d("WindowComm",["URI"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();var h={_callbacks:{},makeHandler:function(i,j,k){j=j||'opener';if(!k)k='f'+(Math.random()*(1<<30)).toString(16).replace('.','');h._callbacks[k]=i;return new g('/connect/window_comm.php').setQueryData({_id:k,_relation:j}).getQualifiedURI().toString();},_recv:function(i){var j=new g(i).getQueryData();h._callbacks[j._id](j);}};e.exports=h;a.WindowComm=h;},null);
__d("OpenIDRequest",["AsyncRequest","AsyncSignal","URI","UserAgent_DEPRECATED","PHPQuerySerializer","coalesce","createArrayFromMixed","errorCode"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){b.__markCompiled&&b.__markCompiled();function o(){var p=new g().setReadOnly(true).setHandler(this.asyncResponseHandler.bind(this)).setErrorHandler(this.asyncErrorHandler.bind(this));Object.assign(this,{openidUrl:null,requestId:o.maxRequestId++,successResponseHandler:null,cancelHandler:null,intermediateHandler:null,immediateMode:false,useExtensions:true,thirdPartyLogin:false,popupWindow:null,asyncRequest:p,retryCount:0});o.requests[this.requestId]=this;}o.getRequestById=function(p){return o.requests[p];};o.prototype.setOpenIDUrl=function(p){this.openidUrl=p;return this;};o.prototype.setSuccessHandler=function(p){this.successResponseHandler=p;return this;};o.prototype.setErrorHandler=function(p){this.errorHandler=p;return this;};o.prototype.setCancelHandler=function(p){this.cancelHandler=p;return this;};o.prototype.setImmediateMode=function(p){this.immediateMode=p;return this;};o.prototype.setUseExtensions=function(p){this.useExtensions=p;return this;};o.prototype.setIntermediateHandler=function(p){this.intermediateHandler=p;return this;};o.prototype.setThirdPartyLogin=function(p){this.thirdPartyLogin=p;return this;};o.prototype.send=function(){if(!this.openidUrl)throw "openidUrl is a required parameter. Call setOpenIDUrl()";var p=this.calculateRedirectUrl();if(!p){this.logMetrics('redirectUrlNotFound');return;}if(this.immediateMode){this.createHiddenIframe(p);}else{if(this.popupWindow)throw "OpenID popup is already in progress";this.showPopup(p);}this.logMetrics('requestSent');};o.prototype.calculateRedirectUrl=function(p){var q=this.immediateMode?'checkid_immediate':'checkid_setup',r={'openid.mode':q},s;if(!o.cache[this.openidUrl])return null;s=o.cache[this.openidUrl].url;var t=new i(new i(s).getQueryData()['openid.return_to']);t.addQueryData({context:o.context,request_id:this.requestId});r['openid.return_to']=t.toString();r.third_party_login=this.thirdPartyLogin;return new i(s).addQueryData(r).getQualifiedURI();};o.prototype.createHiddenIframe=function(p){var q='openid_request_'+this.requestId,r=document.body.appendChild(document.createElement('div')),s=function(){r.innerHTML=('<iframe name="'+q+'"'+' src="'+p.toString()+'"'+' scrolling="no" '+' frameborder="0" class="hidden_elem"></iframe>');};if(j.ie()){r.innerHTML='<iframe src="javascript:false"></iframe>';setTimeout(s,0);}else s();};o.prototype.showPopup=function(p){var q;if(o.cache[this.openidUrl])q=o.cache[this.openidUrl].popup_dimensions;if(!q||!q.height||!q.width)q={height:'580',width:'790'};var r={x:l(window.screenX,window.screenLeft),y:l(window.screenY,window.screenTop),width:l(window.outerWidth,document.body.clientWidth),height:l(window.outerHeight,document.body.clientHeight)},s=r.x+((r.width-q.width)/2),t=r.y+((r.height-q.height)/2),u=["location=yes","scrollbars=1","left="+s,"top="+t,"resizable=yes","height="+q.height,"width="+q.width].join(",");this.popupWindow=window.open(p.toString(),'_blank',u);this.popupPollInterval=setInterval(this.pollPopupWindow.bind(this),100);this.popupWindow.focus();};o.prototype.pollPopupWindow=function(){if(!(this.popupPollInterval&&this.popupWindow))return;if(this.popupWindow.closed){clearInterval(this.popupPollInterval);this.cancel();}};o.prototype.closePopupIfOpen=function(){if(this.popupWindow){if(this.popupPollInterval)clearInterval(this.popupPollInterval);this.popupWindow.close();}this.popupWindow=null;};o.prototype.cancel=function(){this.closePopupIfOpen();if(this.cancelHandler)this.cancelHandler();this.logMetrics('requestCanceled');};o.prototype.logMetrics=function(p){new h('/ajax/openid/metrics.php',{metric:p,immediate:this.immediateMode,context:o.context,openid_url:this.openidUrl}).send();};o.prototype.triggerCompleteAuthAsync=function(p){if(p.charAt(0)=='?'||p.charAt(0)=='&')p=p.substr(1);var q=k.deserialize(p);this.closePopupIfOpen();if(q['openid.mode']=='cancel'){this.cancel();return;}if(this.intermediateHandler)this.intermediateHandler();this.asyncRequest.setData({openid_params:q}).send();};o.prototype.asyncResponseHandler=function(p){var q=p.getPayload();if(this.successResponseHandler)this.successResponseHandler(q);this.closePopupIfOpen();};o.prototype.cleanHandleResponse=function(p){if(p.css)p.css=m(p.css);this.asyncRequest.handleResponse(p);};o.prototype.asyncErrorHandler=function(p){this.closePopupIfOpen();if(p.error==1428010||p.error==1428011){this.cancel();return;}if(this.errorHandler)this.errorHandler(p);};o.prototype.retry=function(){++this.retryCount;this.requestId=o.maxRequestId++;this.send();};o.prototype.setProviderCache=function(p){o.cache=p;return this;};o.cache={};o.requests=[];o.maxRequestId=0;o.context='default';e.exports=o;},null);
__d("WidgetArbiter",["createArrayFromMixed"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();var h={_findSiblings:function(){if(h._siblings)return;h._siblings=[];for(var i=parent.frames.length-1;i>=0;i--)try{if(parent.frames[i]&&parent.frames[i].Arbiter&&parent.frames[i].Arbiter.inform)h._siblings.push(parent.frames[i].Arbiter);}catch(j){}},inform:function(){h._findSiblings();var i=g(arguments);h._siblings.forEach(function(j){j.inform.apply(j,i);});}};e.exports=h;},null);
__d("CommentAdminPanelController",["Arbiter","AsyncRequest","Button","ChannelConstants","CSS","DOM","Event","Toggler","URI","Vector","$","ge","XD","MultiLoginPopup"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){b.__markCompiled&&b.__markCompiled();var s=b('XD').UnverifiedXD,t=function(u){Object.assign(this,{locale:u.locale,channel:u.channel,controllerID:u.controllerID,commentIDs:u.commentIDs,domIDs:u.domIDs,duplicateComments:[],fetchMoreCommentsIsPending:{},blacklistedActors:u.blacklistedActors,actorToCommentInfoMap:u.actorToCommentIDMap,commentInfoMap:u.commentInfoMap,inAggregatedView:u.inAggregatedView,inModerationQueue:u.inModerationQueue,inContextualDialog:u.inContextualDialog,isTopLevelCommentPollingEnabled:false,loggedIn:u.loggedIn,newestCommentTimestamp:u.newestCommentTimestamp,realTimePollingParams:{},userOwnsPages:u.userOwnsPages,recentlyBlacklistedActors:u.blacklistedActors});g.subscribe(j.getArbiterType('comments_plugin_new_post'),function(v,w){if(w.obj.target===this.realTimePollingParams.target){if(r(w.obj.comment_element_id))return;var x=Object.assign({},this.realTimePollingParams);x.post_fbid=w.obj.post_fbid;var y=w.obj.parent_comment_id;if(y){var z=r(y);if(!z)return;var aa=l.scry(z,'.fbFeedbackPager.uiMorePager');if(aa.length>0)return;x.parent_comment_id=y;x.is_reply_thread=true;}else{if(!this.isTopLevelCommentPollingEnabled)return;x.is_reply_thread=false;}this.pollForComments(x);}}.bind(this));this.controlledRegion=q(this.controllerID);this.attachClickHandlers();if(this.inModerationQueue)this.registerModeratorQueueHandlers(true);};Object.assign(t,{allControllers:{},mainController:null,contextualControllers:{},initController:function(u){var v=new t(u),w=u.controllerID;t.allControllers[w]=v;if(v.inContextualDialog){t.contextualControllers[w]=v;}else t.mainController=v;},syncController:function(u,v){var w=t.allControllers[u];w.attachClickHandlers();if(!w.isControllingModerationQueue())return;w.deselectComments(v);w.registerModeratorQueueHandlers(false);w.synchronizeModeratorQueueUI();},resetController:function(u){var v=t.allControllers[u];v.resetController();},appendComments:function(u,v,w){var x=t.allControllers[u];x.appendComments(v,w);},prependComments:function(u,v,w){var x=t.allControllers[u];x.prependComments(v,w);},updateController:function(u,v,w,x,y,z,aa){var ba=t.allControllers[u];ba.updateController(v,w,x,y,z,aa);if(!t.mainController.loggedIn)b('MultiLoginPopup').reattachLoginInterceptors();if(!ba.isControllingModerationQueue())return;ba.registerModeratorQueueHandlers(false);ba.synchronizeModeratorQueueUI();},updatePollingParamsCommentas:function(u,v){var w=t.allControllers[u];w.updatePollingParamsCommentas(v);},registerMoreCommentsLinkHandler:function(u,v){var w=t.allControllers[u];w.registerMoreCommentsLinkHandler(v);},replaceContentMaybe:function(u,v){var w=l.scry(document.documentElement,u)[0];if(w)l.replace(w,v);},notifyCommentCreated:function(u){if(!t.mainController.channel)return;s.send({type:'commentCreated',href:u.href,parentCommentID:u.parentCommentID,commentID:u.commentID,message:u.message});},notifyCommentRemoved:function(u){if(!t.mainController.channel)return;s.send({type:'commentRemoved',href:u.href,commentID:u.commentID});},markAsShowingAllReplies:function(u){var v=u+' a.fbUpDownVoteOption',w=l.scry(document.documentElement,v),x=u+' li.fbUpDownVoteOption a.itemAnchor',y=l.scry(document.documentElement,x),z=w.concat(y);for(var aa=0;aa<z.length;aa++){var ba=z[aa],ca=new o(ba.getAttribute('ajaxify'));ca.addQueryData({show_all_replies:1});ba.setAttribute('ajaxify',ca.toString());}},setLoggedIn:function(u){t.mainController.loggedIn=u;},blacklistChangeListener:function(u,v,w){var x=q(v);m.listen(u,'change',function(){if(u.options[u.selectedIndex].value==w){k.show(x);}else k.hide(x);});}});Object.assign(t.prototype,{isControllingModerationQueue:function(){var u=this==t.mainController&&this.inModerationQueue;return u;},resetController:function(){this.commentIDs=[];this.domIDs=[];},updateController:function(u,v,w,x,y,z){u.forEach(function(ba){this.commentIDs.push(ba);},this);v.forEach(function(ba){this.domIDs.push(ba);},this);Object.assign(this.blacklistedActors,x);for(var aa in y){if(!this.actorToCommentInfoMap[aa])this.actorToCommentInfoMap[aa]=[];y[aa].forEach(function(ba){this.actorToCommentInfoMap[aa].push(ba);},this);}this.newestCommentTimestamp=Math.max(this.newestCommentTimestamp,w);Object.assign(this.commentInfoMap,z);this.attachClickHandlers();},updatePollingParamsCommentas:function(u){this.realTimePollingParams.commentas=u;},attachClickHandlers:function(){for(var u=0;u<this.domIDs.length;u++){var v='li[id="'+this.domIDs[u]+'"]',w=l.scry(this.controlledRegion,v);if(w.length===0)continue;var x=w[0],y=l.scry(x,'a.uiCloseButton');m.listen(x,'mouseleave',this.closeStickyMenuFlyouts.bind(this,y));var z=l.scry(x,'.fbModerateDropdownContainer');if(z.length>0){var aa=z[0],ba=l.find(aa,'.fbModerateDropdownLink');m.listen(ba,'mouseover',function(ka,event){k.addClass(ka,'fbUnderlineText');}.bind(null,ba));m.listen(ba,'mouseout',function(ka,event){k.removeClass(ka,'fbUnderlineText');}.bind(null,ba));var ca=l.find(aa,'.fbModerationDropdownList');m.listen(ba,'click',this.exposeDropDownMenu.bind(this,ba,ca));m.listen(ca.parentNode,'mouseleave',this.concealDropDownMenu.bind(this,ba,ca));this.attachDropDownHandlers(x,this.commentIDs[u],ca);}var da=this.commentInfoMap[this.commentIDs[u]].actor,ea=!!this.recentlyBlacklistedActors[da];if(ea){var fa=l.scry(x,'.fbUndoBlacklistLink');if(fa.length>0){var ga=fa[0];m.listen(ga,'click',this.toggleBlackListAndSync.bind(this,this.commentIDs[u]));}}}var ha=l.scry(this.controlledRegion,'.fbReplyButton'),ia=l.scry(this.controlledRegion,'.fbReplyAfterLoginButton');for(var ja=0;ja<ha.length;ja++)if(this.loggedIn){k.show(ha[ja]);k.hide(ia[ja]);}else{k.hide(ha[ja]);k.show(ia[ja]);}},closeStickyMenuFlyouts:function(u,event){n.hide();for(var v=0;v<u.length;v++)u[v].blur();},attachDropDownHandlers:function(u,v,w){var x=l.scry(w,'.fbBanUser');if(x.length>0){var y=x[0],z=l.find(y,'^.fbFeedbackPost');if(z.id.startsWith(v))m.listen(y,'click',this.toggleBlackListAndSync.bind(this,v));}},exposeDropDownMenu:function(u,v,event){if(k.shown(v))return this.concealDropDownMenu(u,v,event);m.stop(event);k.show(v);v.focus();u.blur();var w=l.find(document.documentElement,'.commentContent'),x=p.getElementPosition(v).y+p.getElementDimensions(v).y-p.getElementDimensions(w).y;if(x>0){x=x+2;this.menuBuffer=l.create('div',{className:'menuBuffer',style:{height:x+'px'}});l.appendContent(w,this.menuBuffer);}return false;},concealDropDownMenu:function(u,v,event){m.stop(event);k.removeClass(u,'fbUnderlineText');k.hide(v);u.blur();if(this.menuBuffer){l.remove(this.menuBuffer);delete this.menuBuffer;}return false;},registerMoreCommentsLinkHandler:function(u){var v=u.pager_id;if(!r(v))return;var w=q(v);m.listen(w,'click',this.fetchMoreComments.bind(this,u,w));},deselectComments:function(u){for(var v=0;v<u.length;v++)delete this.selectedCommentsMap[u[v]];},registerModeratorQueueHandlers:function(u){if(u)this.selectedCommentsMap={};this.selectableComments=this.findSelectableComments();this.selectableCheckboxes=[];this.selectAllCheckBoxes=l.scry(this.controlledRegion,'.fbSelectAllCheckbox');this.approveButtons=l.scry(this.controlledRegion,'.fbApproveButton');this.removeButtons=l.scry(this.controlledRegion,'.fbRemoveButton');for(var v=0;v<this.selectableComments.length;v++){var w=this.selectableComments[v].id,x=!!this.selectedCommentsMap[w];this.setCommentSelection(this.selectableComments[v],x);var y=l.find(this.selectableComments[v],'.fbCommentCheckbox');m.listen(y,'click',this.toggleCommentSelection.bind(this));m.listen(this.selectableComments[v],'click',this.toggleCommentSelection.bind(this));y.checked=x;this.selectableCheckboxes.push(y);}for(var z=0;z<this.selectAllCheckBoxes.length;z++){this.selectAllCheckBoxes[z].checked=false;this.selectAllCheckBoxes[z].disabled=this.selectableComments.length===0;m.listen(this.selectAllCheckBoxes[z],'click',this.toggleSelectAllCheckbox.bind(this,this.selectAllCheckBoxes[z]));}for(var aa=0;aa<this.approveButtons.length;aa++)m.listen(this.approveButtons[aa],'click',this.setBulkPrivacy.bind(this,false));for(var ba=0;ba<this.removeButtons.length;ba++)m.listen(this.removeButtons[ba],'click',this.setBulkPrivacy.bind(this,true));},findSelectableComments:function(){var u=l.scry(this.controlledRegion,'.fbTopLevelComment'),v=[];for(var w=0;w<u.length;w++)if((l.scry(u[w],'.fbCommentCheckbox').length===1)&&(l.scry(u[w],'.fbCommentOverlay').length===0))v.push(u[w]);return v;},toggleCommentSelection:function(event){var u={a:true},v=event.getTarget(),w=v.tagName.toLowerCase(),x=v.parentNode.tagName.toLowerCase();if(u[w]||u[x])return;var y=k.hasClass(v,'fbFeedbackPost')?v:l.find(v,'^.fbFeedbackPost'),z=this.commentIsSelected(y),aa=!z;this.setCommentSelection(y,aa);this.synchronizeModeratorQueueUI();if(k.hasClass(v,'fbCommentCheckbox'))m.stop(event);},commentIsSelected:function(u){return k.hasClass(u,'fbCommentSelected');},setCommentSelection:function(u,v){if(v){this.selectComment(u);}else this.deselectComment(u);},selectComment:function(u){k.addClass(u,'fbCommentSelected');this.selectedCommentsMap[u.id]=true;l.find(u,'.fbCommentCheckbox').checked=true;},deselectComment:function(u){k.removeClass(u,'fbCommentSelected');delete this.selectedCommentsMap[u.id];l.find(u,'.fbCommentCheckbox').checked=false;},toggleSelectAllCheckbox:function(u,event){m.stop(event);var v=u.checked;for(var w=0;w<this.selectableComments.length;w++){this.setCommentSelection(this.selectableComments[w],u.checked);this.selectableCheckboxes[w].checked=v;}this.synchronizeBulkModerationCheckboxes(v);this.synchronizeBulkModerationButtons(v);},synchronizeModeratorQueueUI:function(){var u=0;for(var v=0;v<this.selectableCheckboxes.length;v++)if(this.selectableCheckboxes[v].checked)u++;var w=this.selectableCheckboxes.length>0&&u==this.selectableCheckboxes.length;this.synchronizeBulkModerationCheckboxes(w);this.synchronizeBulkModerationButtons(u>0);},synchronizeBulkModerationCheckboxes:function(u){for(var v=0;v<this.selectAllCheckBoxes.length;v++)this.selectAllCheckBoxes[v].checked=u;},synchronizeBulkModerationButtons:function(u){for(var v=0;v<this.approveButtons.length;v++)i.setEnabled(this.approveButtons[v],u);for(var w=0;w<this.removeButtons.length;w++)i.setEnabled(this.removeButtons[w],u);},setBulkPrivacy:function(u,event){m.stop(event);this.synchronizeBulkModerationButtons(false);var v=[];for(var w in this.selectedCommentsMap)v.push(w);var x={is_private:u,in_moderation_queue:true,comment_ids:v,uniqids:v,controller_id:this.controllerID,locale:this.locale,owns_pages:this.userOwnsPages,in_aggregated_view:this.inAggregatedView,in_contextual_dialog:this.inContextualDialog};new h().setURI('/ajax/connect/comments/set_bulk_private.php').setData(x).send();return false;},toggleBlackListAndSync:function(u,event){m.stop(event);var v=this.commentInfoMap[u].actor,w={blacklist:!this.blacklistedActors[v],in_moderation_queue:this.inModerationQueue,comment_id:u,other_comment_ids:this.getOtherCommentsByActor(v,u),uniqid:u,controller_id:this.controllerID,locale:this.locale,owns_pages:this.userOwnsPages,in_aggregated_view:this.inAggregatedView,in_contextual_dialog:this.inContextualDialog};new h().setURI('/ajax/connect/comments/set_blacklist.php').setData(w).setHandler(function(x){this.blacklistedActors[v]=!this.blacklistedActors[v];if(this.blacklistedActors[v]){this.recentlyBlacklistedActors[v]=true;}else delete this.recentlyBlacklistedActors[v];}.bind(this)).send();return false;},getOtherCommentsByActor:function(u,v){return this.actorToCommentInfoMap[u].filter(function(w){return w!=v;});},fetchMoreComments:function(u,v,event){m.kill(event);k.addClass(v,'async_saving');if(this.fetchMoreCommentsIsPending[u.pager_id]===true)return;this.fetchMoreCommentsIsPending[u.pager_id]=true;var w={is_reply_thread:false,in_moderation_queue:false,view_as_moderator:false};Object.assign(w,u);var x=l.scry(q(w.controller_id),this.getCommentsSelector(w));x=x.concat(l.scry(q(w.controller_id),this.getCollapsedCommentsSelector(w)));var y=0,z=0;for(var aa=0;aa<x.length;aa++)if(!k.hasClass(x[aa],'fbCommentIgnored'))if(k.hasClass(x[aa],'fbCommentHidden')){z++;}else y++;if(w.is_reply_thread)w.offset=y;w.hidden_offset=z;if(!w.aggregate_view)delete w.aggregate_view;if(!w.comment_id)delete w.comment_id;if(!w.is_reply_thread)w.comment_ids=this.commentIDs;if(!w.commentas){var ba=t.allControllers[w.controller_id];w.commentas=ba.realTimePollingParams.commentas;}new h().setURI('/ajax/connect/feedback.php').setReadOnly(true).setData(w).setHandler(function(ca){this.fetchMoreCommentsIsPending[u.pager_id]=false;}.bind(this)).send();},getCommentsSelector:function(u){var v=u.is_reply_thread?'li.fbCommentReply':'li.fbTopLevelComment';if(u.controller_id!=u.uniqid)v='div[id="'+u.uniqid+'"] '+v;return v;},getCollapsedCommentsSelector:function(u){var v=u.is_reply_thread?'div.fbCommentReply':'div.fbTopLevelComment';if(u.controller_id!=u.uniqid)v='div[id="'+u.uniqid+'"] '+v;return v;},getRecentlyBlacklistedActors:function(){var u=[];for(var v in this.recentlyBlacklistedActors)u.push(v);return u;},appendComments:function(u,v){var w=r(u);if(!w)return;var x=l.scry(w,'.fbFeedbackReplies')[0];if(!x)return;l.appendContent(x,v);},prependComments:function(u,v){var w=l.scry(document.documentElement,u)[0];if(!w)return;var x=v.getNodes(),y=[];for(var z=x.length;z-->0;){var aa={id:l.getID(x[z]),element:x[z]};y.push(aa);var ba=r(aa.id);if(ba){k.hide(aa.element);this.duplicateComments.push(aa.element);for(var ca=0;ca<y.length;++ca)l.insertAfter(ba,y[ca].element);y=[];}}for(z=0;z<y.length;++z)l.prependContent(w,y[z].element);setTimeout(this.removeDuplicateComments.bind(this),0);},removeDuplicateComments:function(){for(var u=0;u<this.duplicateComments.length;++u)l.remove(this.duplicateComments[u]);this.duplicateComments=[];},pollForComments:function(u){var v={locale:this.locale};Object.assign(v,u);if(!v.is_reply_thread)v.comment_ids=this.commentIDs;v.newest_comment_timestamp=this.newestCommentTimestamp;var w=this.handlePollResponse.bind(this),x=this.handlePollError.bind(this),y=this.handlePollFinally.bind(this);new h().setURI('/plugins/comments/poll').setReadOnly(true).setData(v).setMethod('GET').setHandler(w).setErrorHandler(x).setFinallyHandler(y).send();},handlePollResponse:function(u){},handlePollError:function(u){},handlePollFinally:function(u){}});e.exports=window.CommentAdminPanelController||t;},null);