"use strict";function debug_msg(t,e){var i=0;0!==i&&("undefined"==typeof t&&(t="debug msg"),"undefined"==typeof e&&(e=2),"undefined"!=typeof console&&"undefined"!=typeof console.log&&i===e&&console.log(t))}var Nutrish={currMQ:null,currPage:null,resizeTM:null,firstLoad:!0,pages:{bv:function(t){Nutrish.Bv.init(t)},contact:function(t){Nutrish.Contact.init(t)},faq:function(t){Nutrish.Faq.init(t)},home:function(){Nutrish.Home.init()},landing:function(t){Nutrish.Products.Landing.init(t)},maketheswitch:function(t){Nutrish.Maketheswitch.init(t)},meta:function(t){Nutrish.Meta.init(t)},petmoments:function(t){Nutrish.Petmoments.init(t)},products:function(t){Nutrish.Products.Details.init(t)},switchto:function(t){Nutrish.Switchto.init(t)},wheretobuy:function(t){Nutrish.Wheretobuy.init(t)},whynutrish:function(t){Nutrish.Whynutrish.init(t)}},init:function(){this.currMQ=this.getCurrMQ(),this.handleTimeoutResizeEvent(),this.handleConstantResizeEvent(),this.addGlobalEventListeners(),this.Nav.addEventListeners(),this.gaEvents(),this.pageTaskRunner()},addGlobalEventListeners:function(){$(window).resize(function(){clearTimeout(Nutrish.resizeTM),Nutrish.resizeTM=setTimeout(function(){Nutrish.handleTimeoutResizeEvent()},500),Nutrish.handleConstantResizeEvent()}),$("#search_bar_form").on("submit",function(){Nutrish.gaButton("search_bar query: "+$(this).find("#q").val())}),$("#ftr_logo").find("a").on("click",function(){Nutrish.gaButton("footer logo")}),$("#ftr_dog").on("click",function(){Nutrish.gaButton("footer for dog")}),$("#ftr_cat").on("click",function(){Nutrish.gaButton("footer for cat")}),$("#ftr_whynutrish").on("click",function(){Nutrish.gaButton("footer why-nutrish")}),$("#ftr_wheretobuy").on("click",function(){Nutrish.gaButton("footer wheretobuy")}),$("#ftr_coinfo").on("click",function(){Nutrish.gaButton("footer ")}),$("#ftr_faq").on("click",function(){Nutrish.gaButton("footer faq")}),$("#ftr_contactus").on("click",function(){Nutrish.gaButton("footer contactus text link")}),$("#ftr_privacy").on("click",function(){Nutrish.gaButton("footer privacy")}),$("#ftr_legal").on("click",function(){Nutrish.gaButton("footer legal")}),$("#ftr_sitemap").on("click",function(){Nutrish.gaButton("footer sitemap")}),$("#ftr_contactus_callout_xs").on("click",function(){Nutrish.gaButton("footer contactus callout")}),$("#ftr_newsletter").find("a").on("click",function(){Nutrish.gaButton("footer newsletter")}),$("#ftr_fb_nutrish").on("click",function(){Nutrish.gaButton("footer FB nutrish")}),$("#ftr_fb_cats").on("click",function(){Nutrish.gaButton("footer FB cats")}),$("#ftr_twitter").on("click",function(){Nutrish.gaButton("footer twitter")}),$("#ftr_instagram").on("click",function(){Nutrish.gaButton("footer instagram")}),$("#ftr_youtube").on("click",function(){Nutrish.gaButton("footer youtube")}),$("#ftr_contactus_callout_sm").on("click",function(){Nutrish.gaButton("footer contactus callout")})},addIframe:function(t,e,i,o,n,s){if("string"!=typeof t||""===t)return!1;if("string"!=typeof e||""===e)return!1;if("string"!=typeof i||""===i)return!1;if("string"!=typeof o||""===n)return!1;if("string"!=typeof n||""===n)return!1;debug_msg("addIframe('"+t+"', '"+e+"', '"+i+"', '"+o+"', '"+n+"', '"+s+"')");var a=document.getElementsByTagName(e)[0],r=document.createElement("IFRAME");r.setAttribute("src",t),r.style.width=i,r.style.height=o,r.style.display=n,r.frameBorder=s,a.appendChild(r)},arrayTest:function(t){return void 0===t?!1:!0},floodlightScript:function(t,e,i){debug_msg("floodlightScript('"+t+"', '"+e+"', '"+i+"')");var o=Math.random()+"",n=1e13*o;this.addIframe("http://"+t+".fls.doubleclick.net/activityi;src="+t+";type="+e+";cat="+i+";ord="+n+"?","body","1px","1px","none","0")},gaButton:function(t){if(debug_msg("gaButton()"),"string"==typeof t&&null!==t&&""!==t){var e="["+window.location.pathname+"]",i=e+" - page button - click - "+t;debug_msg("ga_label = "+i),dataLayer.push({category:e+" page button",action:"click",label:i,event:"ga_event"})}},gaEvents:function(){var t=/-/gi,e=window.location.pathname.toLowerCase().trim().replace(t,"");"/"===e.charAt(0)&&(e=e.slice(1)),"/"===e.charAt(e.length-1)&&(e=e.slice(0,-1));var i=e.split("/"),o="",n="",s="";Nutrish.arrayTest(i)&&("undefined"!=typeof i[0]&&"products"===i[0]&&"undefined"!=typeof i[1]&&"detail"===i[1]?(o="products",n=i.join("_")):"undefined"!=typeof i[0]&&"maketheswitch"===i[0]&&"undefined"!=typeof i[1]&&"recommend"===i[1]?(o="maketheswitch",n="recommend",s=i[2]):"undefined"!=typeof i[0]&&"search"===i[0]?(o="search",n=Nutrish.getURLParam(window.location,"q")):(o=i.shift(),""===o&&(o="home"),i.length>0&&(n=i.join("_")))),debug_msg("ga_action = "+o),debug_msg("ga_label  = "+n),debug_msg("ga_value  = "+s),""===n?(debug_msg("GTM, action, no label, no value"),dataLayer.push({category:"pageview",action:o,event:"ga_event"})):""===s?(debug_msg("GTM, action, label, no value"),dataLayer.push({category:"pageview",action:o,label:n,event:"ga_event"})):(debug_msg("GTM, action, label, value"),dataLayer.push({category:"pageview",action:o,label:n,value:s,event:"ga_event"}))},getCurrMQ:function(){var t=parseInt($("body").css("z-index"));switch(t){case 3:this.currMQ="lg";break;case 2:this.currMQ="md";break;case 1:this.currMQ="sm";break;default:this.currMQ="xs"}return this.currMQ},getURLParam:function(t,e){return decodeURI(t.search.replace(new RegExp("^(?:.*[&\\?]"+encodeURI(e).replace(/[\.\+\*]/g,"\\$&")+"(?:\\=([^&]*))?)?.*$","i"),"$1"))},handleConstantResizeEvent:function(){Nutrish.Nav.handleConstantResizeEvent(),"products"===this.currPage&&this.Products.Details.setHeight(),"xs"===this.currMQ&&Nutrish.Footer.handleConstantResizeEvent(),$("#video-player").length>0&&Nutrish.Youtube.handleConstantResizeEvent()},handleTimeoutResizeEvent:function(){(this.isDifferentMQ()||this.firstLoad)&&(debug_msg("Current MQ is now: "+this.currMQ),"xs"===this.currMQ||"sm"===this.currMQ?$(".container").length>0&&!this.isIE()&&$(".container").removeClass("container").addClass("container-fluid"):$(".container-fluid").length>0&&$(".container-fluid").removeClass("container-fluid").addClass("container"),this.firstLoad=!1)},isDifferentMQ:function(){var t=this.currMQ,e=this.getCurrMQ();return t!==e?(this.currMQ=e,!0):!1},isIE:function(){var t=window.navigator.userAgent,e=t.indexOf("MSIE "),i=t.indexOf("Trident/");return e>-1||i>-1?!0:!1},pageTaskRunner:function(){var t=$("body").attr("class").toLowerCase().trim().split(" ");this.currPage=t[0],t.shift(),"undefined"!=typeof this.pages[this.currPage]?"index"===t[0]?this.pages[this.currPage]():this.pages[this.currPage](t):debug_msg("No init defined for this page (this.pages["+this.currPage+"])")},windowScrollTo:function(t){debug_msg("windowScrollTo(): typeof $.scrollTo = "+typeof $.scrollTo),"undefined"!=typeof $.scrollTo&&"function"==typeof $.scrollTo&&$.scrollTo(t,500)},Footer:{handleConstantResizeEvent:function(){var t=$("footer"),e=t.height();$("body").css("padding-bottom",e+"px")}},Form:{errors:0,recaptchaKey_public:"",remote:"",reqText:"This field is required.",invalidText:"This field is in an invalid format.",noNumbers:"This field cannot have numbers.",validateSelect:function(t){var e=t.val();if(""===e){var i=t.parent().parent().find(".error_msg");i.text(this.reqText),this.errors++,debug_msg("select failed")}},validateEmail:function(t){debug_msg("Nutrish.form.validateEmail()");var e=t.val(),i=/^.+@.+\..{2,5}$/,o=/[\(\)<\>\,\;\:\\\/\"\[\]]/;(!i.test(e)||e.match(o))&&($(t).parents(".row").eq(0).find(".error_msg").text(this.invalidText),this.errors++,debug_msg("email failed"))},validateZip:function(t){var e=t.val(),i=[/^[ABCEGHJKLMNPRSTVXY]\d[ABCEGHJKLMNPRSTVWXYZ]( )?\d[ABCEGHJKLMNPRSTVWXYZ]\d$/i,/^\d{5}(-\d{4})?$/],o=[!1,!1];$(i).each(function(t){var n=new RegExp(i[t]);o[t]=n.test(e)}),o[0]||o[1]||""===e||(t.parent().find(".error_msg").text(this.invalidText),this.errors++,debug_msg("zip failed"))},validateEmpty:function(t){var e=t.val();""===e&&(t.parent().find(".error_msg").text(this.reqText),this.errors++,debug_msg("empty failed"))},validatePhone:function(t){var e=t.val(),i=e.replace(/[\(\)\.\-\ ]/g,"");(isNaN(i)&&0!==i.length||10!==i.length&&0!==i.length)&&(t.parent().find(".error_msg").text(this.invalidText),this.errors++,debug_msg("phone failed"))},validateRadio:function(t){0===$("input[name='"+t+"']:checked").length&&($(".error_msg.large").text(this.mustSelect),this.errors++,debug_msg("radio failed"))},validateOptin:function(t){t.is(":checked")||(t.parent().parent().find(".error_msg").text(this.reqText),this.errors++,debug_msg("optin failed"))},hasNumbers:function(t){var e=t.val(),i=/\d/;i.test(e)&&(t.parent().find(".error_msg").text(this.noNumbers),this.errors++,debug_msg("hasNumbers failed"))},initSpinner:function(){$(".error_msg").text(""),$("input[type=submit]").prop("disabled",!0),$("#spinner").addClass("active"),$("input[type=submit], input[type=reset]").addClass("disable")},disableSpinner:function(){$("input[type=submit]").prop("disabled",!1),$("#spinner").removeClass("active"),$("input[type=submit], input[type=reset]").removeClass("disable")},validateForm:function(t){this.errors>0?(debug_msg("not submitting due to errors = "+this.errors),t.preventDefault(),Nutrish.Form.disableSpinner(),this.errors=0):Nutrish.gaButton("submitting a valid form")}},Nav:{navState:null,currSupCat:null,currSubCat:null,openLevelOne:function(t,e){this.closeNav(!1);var i=$("#subnav2");i.find(".row, .row ul").removeClass("active"),("dogs"===t||"cats"===t)&&($("#subnav1_wrap, ."+t+"_sub, ."+t+"_sub li."+t+"_dry_food, #subnav_"+t+"_dry_food").addClass("active"),i.addClass("subnav1_open"),this.openLevelTwo(t+"_dry_food",!1)),this.adjustArrow(e,t,!0),e.addClass("active"),i.addClass("active"),$("#subnav_"+t).addClass("active"),t===this.currSupCat&&"open"===this.navState?this.closeNav(!0):(this.currSupCat=t,this.navState="open")},openLevelTwo:function(t,e){if(t!==Nutrish.Nav.currSubCat){Nutrish.Nav.currSubCat=t,e&&this.adjustArrow($("."+t+" span"),this.currSupCat,!1);var i=t.split("_"),o=$("#subnav_"+i[0]),n=o.find(".scroll_pane"),s=$("#subnav_"+t);s.addClass("active"),n.find(".jspPane").css("left","0px");var a;a="lg"===Nutrish.currMQ?194.3:165,n.jScrollPane({showArrows:!0,arrowButtonSpeed:a,animateScroll:!0})}},closeNav:function(t){var e=$("#subnav1_wrap"),i=$("#subnav2"),o=$("#main_nav");o.find("li").removeClass("active"),Nutrish.currPage===this.currSupCat&&o.find('li[data-navitem="'+Nutrish.currPage+'"]').addClass("active"),e.removeClass("active"),e.find("ul, li").removeClass("active"),i.removeClass("subnav1_open active"),i.find(".row, .row ul").removeClass("active"),$(".overlay").removeClass("open").addClass("close"),$("#mob_btn").removeClass("open"),t&&(this.navState="closed")},adjustArrow:function(t,e,i){var o,n,s,a=$("#indicator"),r=a.width()/2;if("dogs"===e||"cats"===e)a.addClass("small"),i&&(t=$("."+e+"_dry_food span")),o=t.position().left,n=t.width()/2,s=o+n-r,i?a.css("left",s+"px"):a.stop().animate({left:s+"px"},400);else{a.removeClass("small"),n=t.width()/2;var l=parseInt(t.css("margin-left"));o=t.position().left;var u=t.parent().position().left,d=o+u-10,c=d+l;s=c+n-r,a.css("left",s+"px")}},handleConstantResizeEvent:function(){this.closeNav(!0)},addEventListeners:function(){$(".logo img").on("click",function(){Nutrish.gaButton("Top Nav NutrishLogo")}),$("#mob_btn").on("click",function(){var t=$(this);Nutrish.gaButton("Top Nav Mobile Nav Button"),t.hasClass("opened")?($("#overlay").removeClass("open").addClass("close"),t.removeClass("opened")):($("#overlay").removeClass("close").addClass("open"),t.addClass("opened"))}),$("#main_nav li").on("click",function(){var t=$(this),e=t.attr("data-navitem").toLowerCase();Nutrish.gaButton("Top Nav "+e),$("#main_nav li").removeClass("active"),Nutrish.Nav.openLevelOne(e,t)}),$("#subnav1 ul li span").on("click",function(){var t=$(this).parent(),e=t.attr("class");Nutrish.gaButton("Sub Nav "+e),t.hasClass("active")||($("#subnav1 ."+Nutrish.Nav.currSupCat+"_sub li, #subnav2 ul").removeClass("active"),t.addClass("active"),Nutrish.Nav.openLevelTwo(e,!0))}),$("#nav-where-to-buy").on("submit",function(t){var e=$("#navLocation").val();""===e&&(t.preventDefault(),window.location.href="/where-to-buy")}),$("#subnav_dogs").find(".brown_bar").find("a").on("click",function(){Nutrish.gaButton("View All Products - Dogs")}),$("#subnav_cats").find(".brown_bar").find("a").on("click",function(){Nutrish.gaButton("View All Products - Cats")}),$("#dogs_sub").find(".dogs_about").find("a").on("click",function(){Nutrish.gaButton("About our Dog Products")}),$("#cats_sub").find(".cats_about").find("a").on("click",function(){Nutrish.gaButton("About our Cat Products")}),$("body").on("click",function(t){var e=$(t.target.offsetParent).attr("id"),i=$(t.target.offsetParent).attr("class");void 0!==i&&(i=i.split(" "));var o,n=["main_nav","subnav2","subnav1_wrap","dogs_sub","cats_sub"],s=["jspPane","jspTrack","jspHorizontalBar","row","active"],a=!0;o=n.length>s.length?n.length:s.length;for(var r=0;o>r;r++)(-1!==$.inArray(s[r],i)||n[r]===e)&&(a=!1);a&&"xs"!==Nutrish.currMQ&&"sm"!==Nutrish.currMQ&&Nutrish.Nav.closeNav(!0)})}},Bv:{init:function(t){debug_msg("Nutrish.Bv.init()"),Nutrish.arrayTest(t)&&"submit"===t[0]&&this.submit()},inlineRatings:function(){debug_msg("Nutrish.Bv.inlineRatings()");var t=$("#bvProdIds").data("ids");"object"!=typeof t||t.length<1?debug_msg("Nutrish.Bv.inlineRatings(): ERROR: no product IDs defined/retreived from the DOM"):"undefined"==typeof $BV?debug_msg("Nutrish.Bv.inlineRatings(): ERROR: $BV is undefined"):"undefined"==typeof $BV.ui?debug_msg("Nutrish.Bv.inlineRatings(): ERROR: $BV.ui is undefined"):(debug_msg("Nutrish.Bv.inlineRatings(): requesting inline ratings"),$BV.ui("rr","inline_ratings",{productIds:t,containerPrefix:"BVRRInlineRating"}))},roi_trackConversion:function(t,e,i){if(debug_msg("roi_trackConversion(type = '"+t+"', label = '"+e+"', value = '"+i+"')"),"undefined"==typeof t||null===t||""===t)return debug_msg("'t' has an invalid value, returning 'false'"),!1;if("undefined"==typeof e||null===e||""===e)return debug_msg("'l' has an invalid value, returning 'false'"),!1;if("undefined"==typeof i||null===i||""===i)return debug_msg("'v' has an invalid value, returning 'false'"),!1;if("undefined"==typeof $BV)return debug_msg("$BV is undefined, returning 'false'"),!1;if("undefined"==typeof $BV.SI)return debug_msg("$BV.SI is undefined, returning 'false'"),!1;if("undefined"==typeof $BV.SI.trackConversion)return debug_msg("$BV.SI.trackConversion is undefined, returning 'false'"),!1;var o={type:t,label:e,value:i};$BV.SI.trackConversion(o)},roi_trackTransactionPageView:function(t){"undefined"==typeof $BV?debug_msg("ERROR: no BV call to make, $BV is undefined"):"undefined"==typeof t?debug_msg("ERROR: no BV call to make, trans is undefined"):"undefined"==typeof $BV.SI?debug_msg("ERROR: no BV call to make, $BV.SI is undefined"):"undefined"==typeof $BV.SI.trackTransactionPageView?debug_msg("ERROR: no BV call to make, $BV.SI.trackTransactionPageView is undefined"):(debug_msg("Sending BV ROI pageView"),$BV.SI.trackTransactionPageView(t))},socialContent:function(t,e){debug_msg("Nutrish.Bv.socialContent()");var i={};"undefined"!=typeof BVWidgets&&"undefined"!=typeof BVWidgets.display?(debug_msg("Nutrish.bvSocialContent(): BVWidgets IS found"),Array.isArray(t)&&(i.groups=t),Array.isArray(e)&&(i.tags=e),BVWidgets.display(i)):debug_msg("Nutrish.Bv.socialContent(): BVWidgets NOT found")},submit:function(){debug_msg("Nutrish.Bv.submit()"),"undefined"!=typeof $BV&&"undefined"!=typeof $BV.ui?(debug_msg("Nutrish.Bv.submit(): Bv exists"),$BV.ui("submission_container")):debug_msg("Nutrish.Bv.submit(): Bv.ui does NOT exists")}},Contact:{init:function(t){Nutrish.arrayTest(t)?"newsletter"===t[0]&&Nutrish.Contact.Newsletter.init():Nutrish.Contact.ContactPage.init()},ContactPage:{init:function(){this.addEventListeners()},validateForm:function(t){Nutrish.Form.validateEmail($("#email")),Nutrish.Form.hasNumbers($("#city")),Nutrish.Form.hasNumbers($("#first_name")),Nutrish.Form.hasNumbers($("#last_name")),Nutrish.Form.validateZip($("#zip")),Nutrish.Form.validatePhone($("#phone")),Nutrish.Form.validatePhone($("#mobile")),Nutrish.Form.validateSelect($("#state")),Nutrish.Form.validateSelect($("#contact_method")),Nutrish.Form.validateEmpty($("#first_name")),Nutrish.Form.validateEmpty($("#last_name")),Nutrish.Form.validateEmpty($("#email")),Nutrish.Form.validateEmpty($("#address1")),Nutrish.Form.validateEmpty($("#city")),Nutrish.Form.validateEmpty($("#zip")),Nutrish.Form.validateEmpty($("#phone")),Nutrish.Form.validateEmpty($("#comment")),Nutrish.Form.validateForm(t)},addEventListeners:function(){$("#contactusForm").on("submit",function(t){Nutrish.Form.initSpinner(),Nutrish.Contact.ContactPage.validateForm(t)}),$("input[type=text]").on("focusout",function(){var t=$(this),e=t.val();t.val($.trim(e))})}},Newsletter:{init:function(){this.addEventListeners()},validateForm:function(t){Nutrish.Form.validateEmail($("#email")),Nutrish.Form.hasNumbers($("#city")),Nutrish.Form.hasNumbers($("#first_name")),Nutrish.Form.hasNumbers($("#last_name")),Nutrish.Form.validateZip($("#zip")),Nutrish.Form.validateEmpty($("#first_name")),Nutrish.Form.validateEmpty($("#last_name")),Nutrish.Form.validateEmpty($("#email")),Nutrish.Form.validateForm(t)},addEventListeners:function(){$("#signupForm").on("submit",function(t){Nutrish.Form.initSpinner(),Nutrish.Contact.Newsletter.validateForm(t)}),$("input[type=text]").on("focusout",function(){var t=$(this),e=t.val();t.val($.trim(e))}),$("#pod_pairs").find("a").on("click",function(){Nutrish.gaButton($(this).html()+" callout")})}}},Faq:{init:function(){debug_msg("Nutrish.Faq.init()"),this.addeventlisteners()},addeventlisteners:function(){$(".ctg_link").on("click",function(){Nutrish.gaButton("category "+$(this).data("gtm"))}),$(".breadcrumbs").find("a").on("click",function(){Nutrish.gaButton("breadcrumb back to index")})}},Home:{$flexslider:null,init:function(){debug_msg("Home.init");var t=$(".flexslider").find(".fs_controls"),e=$(".flexslider").flexslider({animation:"slide",controlsContainer:t,start:function(){Nutrish.Home.updateActiveState(0)},after:function(t){Nutrish.Home.updateActiveState(t.currentSlide)}});this.$flexslider=e.data("flexslider"),Nutrish.Bv.socialContent(),this.addEventListeners()},updateActiveState:function(t){var e=$('.flex-nav[data-index="'+t+'"]'),i=$(".flex-indicator"),o=e.find(".flex-indicator");i.removeClass("up"),$(".flex-nav").removeClass("active"),e.addClass("active"),o.addClass("up")},addEventListeners:function(){$(".flex-nav").on("click",function(){var t=$(this),e=parseInt(t.attr("data-index"));Nutrish.gaButton("slider control - "+(e+1)+" "+t.find("span").html()),Nutrish.Home.$flexslider.pause(),Nutrish.Home.$flexslider.flexAnimate(e)}),$("#top-section").find("a.cta_white").on("click",function(){Nutrish.gaButton("why-nutrish callout")}),$("#top-section").find("a.cta_green").on("click",function(){Nutrish.gaButton("make-the-switch callout")}),$("#for_dogs").on("click",function(){Nutrish.gaButton("for dogs callout")}),$("#for_cats").on("click",function(){Nutrish.gaButton("for cats callout")}),$(".slide").find("a").on("click",function(){Nutrish.gaButton("slide "+$(this).parent().find("span").html())}),$("#pod_pairs").find("a").on("click",function(){Nutrish.gaButton($(this).html()+" callout")})}},Maketheswitch:{init:function(t){debug_msg("Nutrish.Maketheswitch.init()"),Nutrish.arrayTest(t)&&("selector"===t[0]&&this.selector(),"recommend"===t[0]&&this.recommend())},selector:function(){debug_msg("Nutrish.Maketheswitch.Selector()"),$(".coupon_link").find("a").on("click",function(){Nutrish.gaButton("save on nutrish today")})},recommend:function(){debug_msg("Nutrish.Maketheswitch.Recommend()"),$("#buttons").find("a").on("click",function(){Nutrish.gaButton($(this).html())}),$("a.start-over").on("click",function(){Nutrish.gaButton("start over")}),$(".buy_now").find("a").filter(".btn").on("click",function(){$(this).parent().find("ul").toggleClass("active")})}},Meta:{init:function(t){debug_msg("Nutrish.Meta.init()"),Nutrish.arrayTest(t)&&"catcon"===t[0]&&Nutrish.Bv.socialContent(["catcon"]),Nutrish.arrayTest(t)&&"news"===t[0]&&$(".pagenav.sticky").stickyPanel(),Nutrish.arrayTest(t)&&"search"===t[0]&&(debug_msg("Nutrish.Meta.search()"),function(){var t="010479195008126427606:wv-oymzqc6o",e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src=("https:"===document.location.protocol?"https:":"http:")+"//cse.google.com/cse.js?cx="+t,"xs"===Nutrish.getCurrMQ();var i=document.getElementsByTagName("script")[0];i.parentNode.insertBefore(e,i)}())}},Petmoments:{bannerHeight:38,init:function(t){debug_msg("Nutrish.Petmoments.init()"),$(".browse-gallery").on("click",function(){Nutrish.gaButton("browse gallery")}),Nutrish.arrayTest(t)&&"gallery"===t[0]?this.gallery():Nutrish.arrayTest(t)&&"meme"===t[0]?this.meme():Nutrish.arrayTest(t)&&"share"===t[0]?this.share():this.index()},gallery:function(){debug_msg("Nutrish.Petmoments.gallery()"),$(".loadmore").prop({disabled:!1}),$("a").filter(".create-own").on("click",function(){debug_msg("Nutrish.Petmoments.gallery: create-own"),Nutrish.gaButton("create your own")}),$("body").on("click","a.facebook_share",function(t){if(t.preventDefault(),debug_msg("Nutrish.Petmoments.gallery: facebook_share",2),"undefined"!=typeof FB&&"function"===$.type(FB.ui)){var e="http://bit.ly/1VN7ByU",i="Check out this Nutrish Fur Real Pet Moment",o="#NutrishPetMoments",n=$(this).data("imgurl"),s="Want to make your own? Click here ("+e+")";FB.ui({method:"feed",link:e,name:i,caption:o,picture:n,description:s},function(t){debug_msg("Nutrish.Petmoments.share(): FB.ui response = "+t,2)})}}),$(".loadmore").on("click",function(t){t.preventDefault(),debug_msg("Nutrish.Petmoments.gallery(): loadmore clicked");var e=$("#img-grid"),i=e.data("total"),o=e.data("showing"),n=e.data("imgsperload");if(debug_msg("Nutrish.Petmoments.gallery(): total = "+i),debug_msg("Nutrish.Petmoments.gallery(): showing = "+o),debug_msg("Nutrish.Petmoments.gallery(): imgsPerLoad= "+n),o>=i)$(this).prop({disabled:!0});else{debug_msg("Nutrish.Petmoments.gallery(): request more imgs");var s=Nutrish.API.getGalleryImgs({data:{start:o,num:n},url:"/pet-moments/get_gallery_imgs"});s.done(function(t){debug_msg("Nutrish.Petmoments.gallery(): data returned"),debug_msg("Nutrish.Petmoments.gallery(): imgs = ",3),debug_msg(t,3);var s=t.length;if(s>0){for(var a=0,r=[];s>a;++a)r.push('<div class="col-xs-12 col-sm-6 col-md-3 text-center">'),r.push('<div class="entry">'),r.push('<img data-featherlight="#img_'+t[a].id+'_lightbox" data-featherlight-variant="on" src="'+t[a].filename+'" alt="">'),r.push('<div class="lightbox" id="img_'+t[a].id+'_lightbox">'),r.push('<div class="the_img">'),r.push('<img src="'+t[a].filename+'" alt="">'),r.push("</div>"),r.push('<div class="share_btns">'),r.push('<a class="facebook_share" target="_blank" href="javascript:void(0);" data-imgurl="'+t[a].filename+'"><img src="/imgs/petmoments/facebook_circle.png" alt="f"></a>'),r.push('<a class="twitter_share"  target="_blank" href="https://twitter.com/intent/tweet?text='+t[a].tweet+'"><img src="/imgs/petmoments/twitter_circle.png" alt="T"></a>'),r.push("</div>"),r.push("</div>"),r.push("</div>"),r.push("</div>");$("#img-grid").eq(0).append(r.join("\n")),e.data("showing",o+s)}debug_msg("Nutrish.Petmoments.gallery(): size = "+s),debug_msg("Nutrish.Petmoments.gallery(): imgsPerLoad= "+n),debug_msg("Nutrish.Petmoments.gallery(): showing + size = "+(o+s)),debug_msg("Nutrish.Petmoments.gallery(): total = "+i),(n>s||o+s>=i)&&($(".loadmore").prop({disabled:!0}),$(".loadmore").css({display:"none"}))}),s.fail(function(){debug_msg("Nutrish.Petmoments.gallery(): request FAILED"),$(".loadmore").prop({disabled:!0})})}})},getCreateButtonStatus:function(){debug_msg("Nutrish.Petmoments.getCreateButtonStatus()");var t=$(".category_captions").find("li").filter(".selected").length>0?!0:!1,e="yes"===$("#canvases").data("userimg")?!0:!1;return t===!0?$(".captions").find("h3").filter(".checkable").addClass("checked"):$(".captions").find("h3").filter(".checkable").removeClass("checked"),e===!0?$(".canvas_wrap").find("h3").filter(".checkable").addClass("checked"):$(".canvas_wrap").find("h3").filter(".checkable").removeClass("checked"),t&&e?(debug_msg("Nutrish.Petmoments.getCreateButtonStatus(): returning true"),!0):(debug_msg("Nutrish.Petmoments.getCreateButtonStatus(): returning false"),!1)},imgPreviewFailed:function(){debug_msg("Nutrish.Petmoments.imgPreviewFailed()"),$("#messages").html("<strong>The image preview failed</strong> for that file. There could be something wrong with the file, or your device could be out of memory.");var t=document.getElementById("user_img"),e=50,i=30,o=t.getContext("2d");o.font="30px Arial",o.fillStyle="#ffffff",o.fillText("ERROR.",10,e),o.fillText("Your image could",10,e+2*i),o.fillText("not be loaded.",10,e+3*i),o.fillText("See below for",10,e+5*i),o.fillText("more details.",10,e+6*i)},index:function(){debug_msg("Nutrish.Petmoments.index()"),$("#meme_entry_form").on("submit",function(t){Nutrish.Form.initSpinner(),Nutrish.Petmoments.indexValidateForm(t)}),$("button").filter(".go").on("click",function(){Nutrish.gaButton("go button")}),$("#optin").on("change",function(){$(this).parents(".optin").find(".warning").toggleClass("visible")})},indexValidateForm:function(t){debug_msg("Nutrish.Petmoments.indexValidateForm()"),Nutrish.Form.validateEmail($("#email")),Nutrish.Form.validateForm(t)},meme:function(){debug_msg("Nutrish.Petmoments.meme()"),$("#user_file").on("change",Nutrish.Petmoments.previewImg),$("li").filter(".caption").on("click",Nutrish.Petmoments.setCanvasCaptions),$("button").filter(".create_meme_btn").on("click",Nutrish.Petmoments.submitImg),$(".categories").find(".category").on("click",Nutrish.Petmoments.setActiveCaptions),$("#next_category").on("click",Nutrish.Petmoments.nextCaptions),$("#prev_category").on("click",Nutrish.Petmoments.prevCaptions),Nutrish.Petmoments.setCanvasImg(),Nutrish.Petmoments.setCanvasCaptions(),Nutrish.Petmoments.setCanvasBanner(),Nutrish.windowScrollTo($(".meme_creator").eq(0))},nextCaptions:function(){debug_msg("Nutrish.Petmoments.nextCaptions()");var t=$(".categories").find(".category");if(t.length>1){var e=t.filter(".selected"),i=e.next(".category");0===i.length&&(i=t.first()),e.removeClass("selected"),i.addClass("selected"),i.click()}},prevCaptions:function(){debug_msg("Nutrish.Petmoments.prevCaptions()");var t=$(".categories").find(".category");if(t.length>1){var e=t.filter(".selected"),i=e.prev(".category");0===i.length&&(i=t.last()),e.removeClass("selected"),i.addClass("selected"),i.click()}},previewImg:function(){debug_msg("Nutrish.Petmoments.previewImg()");var t=$("#messages"),e=this.files[0],i=e.type,o=!1;t.empty(),"undefined"!=typeof i&&null!==i&&("image/jpeg"===i||"image/jpg"===i||"image/png"===i)&&(o=!0),o===!1?t.html("There was an error uploading your image. Make sure you chose a valid image file (only JPG and PNG images are allowed)."):loadImage.parseMetaData(e,function(t){var i=loadImage(e,function(i){var o=1;"error"===i.type?(debug_msg("Error parsing the EXIF information. Loading the img as is.",1),Nutrish.Petmoments.setCanvasImg(e,o)):("undefined"!==$.type(t)&&"undefined"!==$.type(t.exif)&&"function"===$.type(t.exif.get)&&(o=t.exif.get("Orientation")),Nutrish.Petmoments.setCanvasImg(i,o))},{canvas:!0});i===!1&&Nutrish.Petmoments.imgPreviewFailed()},{})},setActiveCaptions:function(){debug_msg("Nutrish.Petmoments.setActiveCaptions()");var t=$(this).data("category");$(".categories").find(".category").removeClass("selected"),$(this).addClass("selected"),$(".category_captions").removeClass("selected").filter(".category_"+t).addClass("selected")},setCanvasBanner:function(){debug_msg("Nutrish.Petmoments.setCanvasBanner()");var t=$("#canvases"),e=document.getElementById("img_banner");if(e.setAttribute("height",Nutrish.Petmoments.bannerHeight),e.setAttribute("width",t.width()),e.getContext){var i=e.getContext("2d"),o=new Image;o.src="/imgs/petmoments/banner.png",o.onload=function(){debug_msg("Nutrish.Petmoments.setCanvasBanner(): img.onload()",3),i.clearRect(0,0,e.width,e.height),i.drawImage(o,0,0,t.width(),Nutrish.Petmoments.bannerHeight)}}},setCanvasCaptions:function(){debug_msg("Nutrish.Petmoments.updateCanvasCaptions()");var t=$(this),e=t.data("captionid"),i=$("#canvases"),o=document.getElementById("img_captions");if(o.setAttribute("height",i.height()-Nutrish.Petmoments.bannerHeight),o.setAttribute("width",i.width()),o.getContext){var n=o.getContext("2d"),s=0,a=0,r=new Image;r.src="/imgs/petmoments/memes/meme_captions_"+e+".png",r.onload=function(){debug_msg("Nutrish.Petmoments.setCanvasCaption(): img.onload()",3),n.clearRect(0,0,o.width,o.height),a=o.width,s=o.width*r.height/r.width,n.drawImage(r,0,0,a,s),Nutrish.Petmoments.setCreateButtonStatus()},$(".category_captions").find("li").removeClass("selected"),t.addClass("selected")}},setCanvasImg:function(t,e){debug_msg("Nutrish.Petmoments.setCanvasImg()");var i=$("#canvases"),o=document.getElementById("user_img");if(("undefined"==typeof e||null===e)&&(e=1),"undefined"!==$.type(o)){if(o.setAttribute("height",i.height()-Nutrish.Petmoments.bannerHeight),o.setAttribute("width",i.width()),o.getContext){var n=o.getContext("2d"),s=0,a=0,r=0,l=0;if("undefined"===$.type(t)||null===t){debug_msg("Nutrish.Petmoments.setCanvasImg(): populate the canvas with the default image");var u=$('<img src="/imgs/petmoments/default_image.png" />');u.error(function(){debug_msg("Nutrish.Petmoments.setCanvasImg(): error loading the default image",1),Nutrish.Petmoments.imgPreviewFailed()}),u.load(function(){var t=u[0];debug_msg("Nutrish.Petmoments.setCanvasImg(): img.onload()"),n.fillStyle="black",n.fillRect(0,0,o.width,o.height),a=o.width,s=o.width*t.height/t.width,a<o.width&&(r=Math.floor((o.width-a)/2)),s<o.height&&(l=Math.floor((o.height-s)/2));try{n.drawImage(t,r,l,a,s),n.setTransform(1,0,0,1,0,0)}catch(e){Nutrish.Petmoments.imgPreviewFailed()}})}else if("object"==typeof t&&"[object File]"===Object.prototype.toString.call(t)){debug_msg("Nutrish.Petmoments.setCanvasImg(): populate the canvas from a File",1);var d=new FileReader;d.onload=function(){var t=new Image;t.onload=function(){a=o.width,s=o.width*t.height/t.width,a<o.width&&(r=Math.floor((o.width-a)/2)),s<o.height&&(l=Math.floor((o.height-s)/2));try{n.drawImage(t,r,l,a,s),n.setTransform(1,0,0,1,0,0),$("#canvases").data("userimg","yes")}catch(e){Nutrish.Petmoments.imgPreviewFailed()}},t.src=d.result},d.readAsDataURL(t)}else{debug_msg("Nutrish.Petmoments.setCanvasImg(): populate from another canvas",1),debug_msg("Nutrish.Petmoments.setCanvasImg(): exif orientation = "+e,1),"undefined"==typeof t.height&&(t.height=o.height),"undefined"==typeof t.width&&(t.width=o.width),a=o.width,s=o.width*t.height/t.width,3===e?(debug_msg("3: img needs to be rotated 180 degrees"),n.translate(o.width/2,o.height/2),n.rotate(180*Math.PI/180),n.translate(-o.width/2,-o.height/2)):6===e?(debug_msg("6: img needs to be rotated 90 degrees"),n.translate(o.width/2,o.height/2),n.rotate(90*Math.PI/180),n.translate(-o.width/2,-o.height/2),s=o.height,a=o.height*t.width/t.height):8===e&&(debug_msg("8: img needs to be rotated 270 degrees"),n.translate(o.width/2,o.height/2),n.rotate(270*Math.PI/180),n.translate(-o.width/2,-o.height/2),s=o.height,a=o.height*t.width/t.height,r=a-o.height,r=-1*Math.floor(r)),a<o.width&&(r=Math.floor((o.width-a)/2)),s<o.height&&(l=Math.floor((o.height-s)/2));try{n.drawImage(t,r,l,a,s),n.setTransform(1,0,0,1,0,0),$("#canvases").data("userimg","yes")}catch(c){Nutrish.Petmoments.imgPreviewFailed()}}}Nutrish.Petmoments.setCreateButtonStatus()}},setCreateButtonStatus:function(){debug_msg("Nutrish.Petmoments.setCreateButtonStatus()");var t=Nutrish.Petmoments.getCreateButtonStatus();$(".create_meme_btn").prop(t===!0?{disabled:!1}:{disabled:!0})},share:function(){debug_msg("Nutrish.Petmoments.share()"),Nutrish.windowScrollTo($(".entry").eq(0)),$(".share_buttons").find(".gallery").on("click",function(){Nutrish.gaButton("browse gallery - first")
}),$(".share_buttons").find(".btn.download").on("click",function(){Nutrish.gaButton("download")}),$(".share_buttons").find(".btn.facebook").on("click",function(){if(debug_msg("Nutrish.Petmoments.share(): FB click"),Nutrish.gaButton("facebook"),"undefined"!=typeof FB&&"function"===$.type(FB.ui)){var t="http://bit.ly/1VN7ByU",e="Check out my Nutrish Fur Real Pet Moment",i="#NutrishPetMoments",o=$(this).data("imgurl"),n="Want to make your own? Click here ("+t+")";FB.ui({method:"feed",link:t,name:e,caption:i,picture:o,description:n},function(t){debug_msg("Nutrish.Petmoments.share(): FB.ui response = "+t)})}}),$(".share_buttons").find(".btn.twitter").on("click",function(){Nutrish.gaButton("twitter")}),$(".start-over").on("click",function(){Nutrish.gaButton("start over")})},submitImg:function(){if(debug_msg("Nutrish.Petmoments.submitImg()"),Nutrish.Petmoments.getCreateButtonStatus()===!0){Nutrish.gaButton("create meme");var t=$("#messages");$(this).prop("disabled",!0),$(this).toggleClass("busy"),t.empty();var e=$("#canvases"),i=document.getElementById("user_img"),o=document.getElementById("img_captions"),n=document.getElementById("img_banner"),s=document.createElement("canvas");if(s.setAttribute("height",e.height()),s.setAttribute("width",e.width()),s.getContext){var a=s.getContext("2d");a.fillStyle="black",a.fillRect(0,0,e.width(),e.height()),a.drawImage(i,0,0),a.drawImage(o,0,0),a.drawImage(n,0,e.height()-Nutrish.Petmoments.bannerHeight);var r=$("li.caption").filter(".selected").first().data("captionid"),l=$("#user_ca").data("caid"),u=$("#user_email").data("cemail"),d=$("#user_id").data("cid"),c=s.toDataURL(),g={caId:l,captionId:r,imgData:c,userId:d,userEmail:u},h=Nutrish.API.uploadImg({data:g,url:"/pet-moments/upload_img"});h===!1?(debug_msg("could not get an AJAX promise. Check the data passed to the server."),t.html("Failed to upload an image. Please try again.")):(h.done(function(e){debug_msg("Nutrish.Petmoments.submitImg(): the upload succeeeded: msg = "),debug_msg(e),t.html("Success! You are being redirected <a href='/pet-moments/share'>here</a>."),Nutrish.Petmoments.uploadComplete()}),h.fail(function(e,i,o){debug_msg("Nutrish.Petmoments.index(): the upload failed: the exception:"),debug_msg(o),t.html("Failed to upload an image. Please try again.")}))}}else debug_msg("Nutrish.Petmoments.submitImg(): no img or caption so doing nothing")},uploadComplete:function(){debug_msg("Nutrish.Petmoments.uploadComplete()"),document.location="/pet-moments/share"}},Products:{Landing:{init:function(t){if(Nutrish.arrayTest(t)&&(Nutrish.Bv.inlineRatings(),("dog"===t[0]||"cat"===t[0])&&t.shift(),"undefined"!=typeof t[0]&&""!==t[0]&&"index"!==t[0])){var e=$('a[name="'+t[0]+'"]');e.length>0&&Nutrish.windowScrollTo(e)}this.addEventListeners()},addEventListeners:function(){$(".jumplinks li").on("click",function(){var t=$(this),e=t.attr("class");t.hasClass("jump")||Nutrish.windowScrollTo($('a[name="'+e+'"]'))})}},Details:{$slider:null,currSlide:null,init:function(t){debug_msg("Details.init"),this.currSlide="ingredients";var e=0;("guaranteed-analysis"===t[1]||"guaranteedanalysis"===t[1])&&$("#tabs-btns-container").find("li[data-name='analysis']").length&&(e=1),("feeding-guidelines"===t[1]||"feedingguidelines"===t[1])&&(e=2);var i=$(".flexslider").flexslider({animation:"fade",slideshow:!1,directionNav:!1,controlNav:!1,smoothHeight:!0,startAt:e,start:function(){Nutrish.Products.Details.updateActiveState(e),Nutrish.Products.Details.setHeight()},after:function(t){Nutrish.Products.Details.updateActiveState(t.currentSlide)}});if(this.$slider=i.data("flexslider"),0!==e&&Nutrish.windowScrollTo($('a[name="tabs"]')),"undefined"!=typeof $BV){var o=$("#detail").data("bvid");$BV.configure("global",{productId:o.toString()}),$BV.ui("rr","show_reviews",{doShowContent:function(){}})}this.addEventListeners()},updateActiveState:function(t){var e=$("#tabs-btns-container li"),i=$("#tabs-btns-container li:eq("+t+")");this.currSlide=i.attr("data-name"),e.removeClass("active"),i.addClass("active")},setHeight:function(){var t=$("#"+Nutrish.Products.Details.currSlide).height();$(".slider-window").height(t)},addEventListeners:function(){$("#tabs-btns-container li").on("click",function(){var t=$(this),e=t.index();Nutrish.Products.Details.updateActiveState(e),Nutrish.Products.Details.$slider.flexAnimate(e)}),$(".buy_now").find("a").filter(".btn").on("click",function(){$(this).parent().find("ul").toggleClass("active")}),$("#copy-container").find("a").on("click",function(){Nutrish.gaButton($(this).find("span").html())}),$("#tabs-btns-container").find("li").on("click",function(){Nutrish.gaButton($(this).data("name")+" tab")}),$("body").on("click",'a[title="Write a review"]',function(){Nutrish.gaButton("BV Write a review link")})}}},Switchto:{init:function(t){if(debug_msg("Nutrish.Switchto.init()"),this.addEventListeners(),Nutrish.arrayTest(t)&&"register"===t[0]){var e=$.parseJSON($("#bv_pie_trans").val());debug_msg("Nutrish.Switchto.init(): transaction = "),debug_msg(e),Nutrish.Bv.roi_trackTransactionPageView(e)}},validateForm:function(t){Nutrish.Form.validateEmail($("#email")),Nutrish.Form.hasNumbers($("#city")),Nutrish.Form.hasNumbers($("#first_name")),Nutrish.Form.hasNumbers($("#last_name")),Nutrish.Form.validateZip($("#zip")),Nutrish.Form.validatePhone($("#mobile")),Nutrish.Form.validateRadio("which_coupon"),Nutrish.Form.validateOptin($("#optin")),Nutrish.Form.validateSelect($("#state")),Nutrish.Form.validateEmpty($("#first_name")),Nutrish.Form.validateEmpty($("#last_name")),Nutrish.Form.validateEmpty($("#email")),Nutrish.Form.validateEmpty($("#address1")),Nutrish.Form.validateEmpty($("#city")),Nutrish.Form.validateEmpty($("#zip")),Nutrish.Form.validateForm(t)},addEventListeners:function(){$("#switchForm").on("submit",function(t){Nutrish.Form.initSpinner(),Nutrish.Switchto.validateForm(t)}),$("input[type=reset]").on("click",function(){$(".error_msg").text("")}),$("input[type=text]").on("focusout",function(){var t=$(this),e=t.val();t.val($.trim(e))}),$("#thankyoubutton").on("click",function(){Nutrish.gaButton("print your coupon"),dataLayer.push({category:"switchto_thankyou_button",action:"click",event:"fl_event"})})}},Wheretobuy:{init:function(){debug_msg("Nutrish.Wheretobuy.init()"),$.store_locator($("#uri_query").attr("data-query")),$(".buy-online").find("a").on("click",function(){Nutrish.gaButton("buy online at "+$(this).data("gtm"))}),$("body").on("click","a.popup_dir_link",function(){Nutrish.gaButton("popup directions link")}),$("body").on("click","a.popup_tel_link",function(){Nutrish.gaButton("popup telephone link")}),$("body").on("click","a.mobile_dir_link",function(){Nutrish.gaButton("mobile directions link")}),$("body").on("click","a.mobile_tel_link",function(){Nutrish.gaButton("mobile telephone link")})},highlight:function(t){debug_msg("Nutrish.Wheretobuy.highlight(id = "+t+")"),$("#map-results li").removeClass("active"),$("#result_"+t).addClass("active");var e=$("#map-results-wrap").get(0).scrollHeight,i=$("#map-results-wrap").scrollTop(),o=$("#result_"+t).position().top-60+i;0>o&&(o=0),o>e&&(o=e),debug_msg("maxHeight = "+e),debug_msg("curScrollTop = "+i),debug_msg("sTop = "+o),$("#map-results-wrap").animate({scrollTop:o},200)}},Whynutrish:{init:function(t){debug_msg("Nutrish.Whynutrish.init()"),Nutrish.arrayTest(t)&&"real_stories"===t[0]?this.realStories():Nutrish.arrayTest(t)&&"real_recipes"===t[0]?this.realRecipes():Nutrish.arrayTest(t)&&"real_ingredients"===t[0]?this.realIngredients():Nutrish.arrayTest(t)&&"real_good"===t[0]?this.realGood():this.index(),this.addEventListeners()},addEventListeners:function(){$(".mts_callout").find(".cta").on("click",function(){Nutrish.gaButton("Make the Switch callout")}),$(".links_callout").find(".cta").find("a").on("click",function(){Nutrish.gaButton("callout "+$(this).attr("id"))}),$(".selector_callout").find("a.btn").on("click",function(){Nutrish.gaButton("product selector")})},index:function(){debug_msg("Nutrish.Whynutrish.index()"),$(".stories").find("a").on("click",function(){Nutrish.gaButton("Tell Us (your stories) callout")}),$(".real_recipes").find("a").on("click",function(){Nutrish.gaButton("real-recipes learn more")}),$(".real_ingredients").find("a").on("click",function(){Nutrish.gaButton("real-ingredients learn more")}),$(".real_good").find("a").on("click",function(){Nutrish.gaButton("real-good learn more")});var t=$(".flexslider").find(".fs_controls");$(".flexslider").flexslider({animation:"slide",controlNav:"thumbnails",controlsContainer:t})},realGood:function(){debug_msg("Nutrish.Whynutrish.realGood()")},realRecipes:function(){debug_msg("Nutrish.Whynutrish.realRecipes()")},realIngredients:function(){debug_msg("Nutrish.Whynutrish.realIngredients()"),$("ul.brands").find("a").on("click",function(){Nutrish.gaButton($(this).data("gtm"))})},realStories:function(){debug_msg("Nutrish.Whynutrish.real_stories()"),$("#tellStory").on("click",function(){Nutrish.gaButton("Tell Us your story!")}),"undefined"!=typeof $BV&&"object"==typeof $BV?(debug_msg("Nutrish.Whynutrish.real_stories(): requesting stories"),$BV.configure("global",{submissionContainerUrl:"http://nutrish.rachaelray.com/submit"}),$BV.ui("sy","show_stories",{categoryId:"1",subjectType:"category"})):debug_msg("Nutrish.Whynutrish.real_stories(): no BV object")}},Youtube:{$modal:null,YTPlayer:null,apiLoaded:!1,init:function(){this.YTPlayer=new YT.Player("video-player",{height:"100%",width:"100%",videoId:videoID,events:{onReady:function(){}}}),this.$modal=$("#video-player-container"),this.addEventListeners()},openModal:function(){var t=navigator.userAgent.match(/(iPad|iPhone|iPod)/g)?!0:!1;t===!1&&this.apiLoaded===!0?(this.$modal.show(),this.handleConstantResizeEvent(),this.YTPlayer.hasOwnProperty("playVideo")&&this.YTPlayer.playVideo()):window.open("https://www.youtube.com/watch?v="+videoID,"_blank")},closeModal:function(){this.$modal.hide(),Nutrish.Youtube.YTPlayer.stopVideo()},addEventListeners:function(){$("#video-player-close,#video-player-bg").on("click",function(){Nutrish.Youtube.closeModal()})},handleConstantResizeEvent:function(){var t=$(window).height(),e=$("#video-player").height(),i=t/2-e/2;$("#video-player-plaque").css("top",i+"px")}},API:{getGalleryImgs:function(t){debug_msg("Nutrish.API.getGalleryImgs()");var e={},i={data:null,dataType:"json",method:"POST",processData:!0,url:null},o=$.extend(e,i,t);return"string"===$.type(o.url)?(debug_msg("Nutrish.API.uploadImg(): returning a promise"),$.ajax(o)):(debug_msg("Nutrish.API.uploadImg(): returning false"),!1)},uploadImg:function(t){debug_msg("Nutrish.API.uploadImg()");var e={},i={cache:!1,data:null,dataType:"json",method:"POST",processData:!0,url:null},o=$.extend(e,i,t);return"string"===$.type(o.url)?(debug_msg("Nutrish.API.uploadImg(): returning a promise"),$.ajax(o)):(debug_msg("Nutrish.API.uploadImg(): returning false"),!1)}}};$(document).ready(function(){Nutrish.init()}),window.onYouTubeIframeAPIReady=function(){Nutrish.Youtube.apiLoaded=!0,Nutrish.Youtube.init()},function(t){function e(){1===L&&console.log("add_default_marker()");var t="<h2>No location provided yet.</h2><div>To see stores near you, enter your location.</div>",e="",i=38.354367,o=-99.998241;r(t,t,e,i,o)}function i(e,i,o){3===L&&console.log("add_marker()"),3===L&&console.log("add_marker(): store = "),3===L&&console.log(e),3===L&&console.log("id = "),3===L&&console.log(i),3===L&&console.log("store.lat = "),3===L&&console.log(e.lat),3===L&&console.log("store.lng = "),3===L&&console.log(e.lng);var n="",s=new google.maps.Marker({map:O,position:new google.maps.LatLng(e.lat,e.lng)});if(null!==z&&s.setIcon(z),D.push(s),"undefined"!=typeof o&&null!==o&&""!==t.trim(o))n='<div class="marker_popup" id="popup_'+i+'">'+o+"</div>";else{var a="ainsworth_main"===e.store_type?", ":" ",r=t.trim(d(e.city)+a+e.state.toUpperCase()+" "+e.zip),l="http://www.google.com/maps/dir/?daddr="+encodeURIComponent(e.address1+" "+r),c="";n='<div class="marker_popup" id="popup_'+i+'">',n+="<h2>"+d(e.name).toUpperCase()+"</h2>",n+='<div class="add1">'+d(e.address1)+"</div>","undefined"!=typeof e.address2&&""!==e.address2&&null!==e.address2&&(n+='<div class="add2">'+d(e.address2)+"</div>"),"undefined"!=typeof r&&null!==r&&""!==r&&(n+='<div class="csz">',n+=r,n+="</div>",c+='<div class="directions"><a class="popup_dir_link" target="_blank" href="'+l+'">GET DIRECTIONS</a></div>'),"undefined"!=typeof e.phone&&null!==e.phone&&""!==e.phone&&(n+='<div class="phone"><a class="popup_tel_link" target="_blank" href="tel:'+e.phone+'">'+u(e.phone)+"</a></div>"),n+=c,"undefined"!=typeof e.store_type&&null!==e.store_type&&"ainsworth_main"===e.store_type&&(n+='<div class="note"><strong>Please note</strong>: check with this supplier for exact product availability.</div>'),n+="</div>"}s.set("content",n),google.maps.event.addListener(s,"click",function(t){j.setContent(this.get("content")),j.open(O,this),N(t,this,i,e.id),Nutrish.Wheretobuy.highlight(i)}),3===L&&console.log("add_marker(): marker "+i+" added")}function o(e,i,o){3===L&&console.log("add_results_li(id = "+i+")"),3===L&&console.log("store = "),3===L&&console.log(e);var n="";if("undefined"==typeof o||null===o||""===t.trim(o)){var s=d(e.address1),a="",r=t.trim(d(e.city)+" "+e.state.toUpperCase()+" "+e.zip),l="http://www.google.com/maps/dir/?daddr="+encodeURIComponent(s+" "+r),c="",g=e.brands,h="";"undefined"!=typeof e.address2&&null!==e.address2&&""!==e.address2&&(a=d(e.address2)+" "),"undefined"!=typeof e.phone&&null!==e.phone&&""!==e.phone&&(c='<div class="phone visible-xs">tel: <a class="mobile_tel_link" target="_blank" href="tel:'+e.phone+'">'+u(e.phone)+"</a></div>");for(var m in g)g.hasOwnProperty(m)&&(h+='<img src="/imgs/icon_'+g[m]+'.png" />');n='<li id="result_'+i+'" class="">',n+="<h2>"+d(e.name).toUpperCase()+"</h2>",n+='<div class="hidden-xs">',q===!0?(n+='<div class="add1">'+s+"</div>",""!==a&&(n+='<div class="add2">'+a+"</div>"),n+='<div class="csz">'+r+"</div>"):n+="<div>"+s+" "+r+"</div>",n+="</div>",n+='<div class="visible-xs"> <a class="mobile_dir_link" href="'+l+'" target="_blank">'+s+" "+r+"</a></div>",n+=c,Z===!0&&(n+='<div class="filters_icons">'+h+"</div>"),n+="</li>"}else n='<li id="result_'+i+'" class="selected">'+o+"</li>";E.append(n),t("#result_"+i).on("click",function(){j.setContent(D[i].get("content")),j.open(O,D[i]),Nutrish.Wheretobuy.highlight(i),Nutrish.gaButton("store name in result list")}),3===L&&console.log("add_results_li(): added an LI")}function n(t){var e="no error passed to browser_geo_failure()";if("object"==typeof t)switch(t.code){case t.PERMISSION_DENIED:e="User denied the request for Geolocation.";break;case t.POSITION_UNAVAILABLE:e="Location information is unavailable for the location that was provided.";break;case t.TIMEOUT:e="The request to get the user's location timed out.";break;case t.UNKNOWN_ERROR:e="An unknown error occured."}1===L&&console.log("browser_geo_failure(): "+e)}function s(t){1===L&&console.log("browser_geo_success()");var e=new google.maps.LatLng(t.coords.latitude,t.coords.longitude);$(e)}function a(t,e){2===L&&console.log("create_map(map_id = '"+t+"', query = '"+e+"')");var i={zoom:7,maxZoom:18,minZoom:7,center:new google.maps.LatLng(48.354367,-99.998241),mapTypeId:google.maps.MapTypeId.ROADMAP};O=new google.maps.Map(document.getElementById(t),i),O.set("user_query",e),google.maps.event.addListener(O,"idle",function(){2===L&&console.log("idle event"),f()}),google.maps.event.addListener(O,"dragend",function(){2===L&&console.log("dragend event"),T()}),google.maps.event.addListener(O,"zoom_changed",function(){2===L&&console.log("zoom_changed event, zoom_level = "+O.getZoom());var t=google.maps.event.addListener(O,"bounds_changed",function(){T(),google.maps.event.removeListener(t)})}),2===L&&console.log("create_map(): done, typeof map = "+typeof O)}function r(t,e,n,s,a){X=!0,C();var r=O.getCenter();"string"!=typeof t&&(t="<h2>An unknown error occured.</h2><div>Please try a different location.</div>"),"string"!=typeof e&&(e=t),"string"!=typeof n&&(n=" "),(void 0===typeof s||""===s||"number"!=typeof s)&&(s=r.lat()),(void 0===typeof a||""===a||"number"!=typeof a)&&(a=r.lng());var l={lat:s,lng:a};o(l,0,t),i(l,0,e),I(n),j.close(O),j.setContent(D[0].content),j.open(O,D[0]),1===L&&console.log("error_results(): ALLOW future updates"),X=!1}function l(){2===L&&console.log("filterChange()");var e=t(this).prop("id"),i=t("#pet_type"),o=t("#category"),n=t("#recipe"),s=t("#size");2===L&&console.log("filterChange(): curId = "+e),"pet_type"===e?(o.prop("disabled",!0).find("option:gt(0)").remove(),n.prop("disabled",!0).find("option:gt(0)").remove(),s.prop("disabled",!0).find("option:gt(0)").remove(),""===i.val()?b():w("category",i.val(),"","")):"category"===e?(n.prop("disabled",!0).find("option:gt(0)").remove(),s.prop("disabled",!0).find("option:gt(0)").remove(),""===o.val()?b():w("recipe",i.val(),o.val(),"")):"recipe"===e?(s.prop("disabled",!0).find("option:gt(0)").remove(),""===n.val()?b():w("size",i.val(),o.val(),n.val())):"size"===e&&b()}function u(t){var e=t.replace(/\D/g,"");return"undefined"==typeof e||null===e||""===e||10!==e.length?"":10!==e.length?e:e.substring(0,3)+"."+e.substring(3,6)+"."+e.substring(6)}function d(t){if("undefined"==typeof t||null===t||""===t)return t;for(var e=t.split(" "),i=e.length;i--;)e[i]=k(e[i]);return e.join(" ")}function c(){2===L&&console.log("get_filters()");var e={petType:t("#pet_type").val()||"",category:t("#category").val()||"",recipe:t("#recipe").val()||"",size:t("#size").val()||""};return 2===L&&console.log("get_filters(): returning filters = "),2===L&&console.log(e),e}function g(){var t=!1;if(navigator&&navigator.geolocation){1===L&&console.log("get_user_location_from_browser_geolocation(): browser has geoloation");var e=7e3,i=setTimeout(n,e);navigator.geolocation.getCurrentPosition(function(e){clearTimeout(i),1===L&&console.log("get_user_location_from_browser_geolocation(): browser successfully found a location"),t||(t=!0,s(e))},function(e){clearTimeout(i),1===L&&console.log("get_user_location_from_browser_geolocation(): browser failed to find a location"),t||(t=!0,n(e))},{timeout:e})}else 1===L&&console.log("get_user_location_from_browser_geolocation(): browser does not have geoloation")}function h(){1===L&&console.log("get_user_location_from_ip_lookup()"),"undefined"==typeof geoip2?v():geoip2.city(_,v,{w3c_geolocation_disabled:!0})}function m(){2===L&&console.log("get_url_from_filters()");var e=location.protocol+"//"+location.host+location.pathname,i=[],o=t("#query").val()||"";""!==o&&i.push("query="+o);var n=t("#pet_type").val()||"";""!==n&&i.push("pet_type="+n);var s=t("#category").val()||"";""!==s&&i.push("category="+s);var a=t("#recipe").val()||"";""!==a&&i.push("recipe="+a);var r=t("#size").val()||"";return""!==r&&i.push("size="+r),i.length>0&&(e+="?"+i.join("&")),2===L&&console.log("get_url_from_filters(): returning url = "+e),e}function f(){if(2===L&&console.log("idle_event()"),H===!1){2===L&&console.log("idle_event(): the map is loaded"),H=!0,google.maps.event.clearListeners(O,"idle"),2===L&&console.log("idle_event(): idle event listener removed");var t=O.get("user_query");"undefined"!=typeof t&&null!==t&&""!==t?(2===L&&console.log("idle_event(): first event, user provided a query"),y(t)):(2===L&&console.log("idle_event(): first event, no query"),e(),K===!0?(2===L&&console.log("idle_event(): first event, user IP lookup"),h()):J===!0?(2===L&&console.log("idle_event(): first event, user browser geolocation"),g()):2===L&&console.log("idle_event(): first event, add_default_marker()"))}}function p(){2===L&&console.log("indicate_busy()"),I(""),o({lat:0,lng:0},0,'<div class="loading"><img src="/imgs/wheretobuy/ajax-loader.gif" /></div>')}function v(t){"object"==typeof t?1===L&&console.log("ip_geo_failure(): error code = "+t.code+", description = "+t.error):1===L&&console.log("ip_geo_failure(): an unknown error code passed back from call")}function _(t){1===L&&console.log("ip_geo_success()");var e=new google.maps.LatLng(t.location.latitude,t.location.longitude);$(e)}function b(){if(2===L&&console.log("load_stores()"),X)2===L&&console.log("load_stores(): WAIT to update b/c another update is in process"),setTimeout(b,500);else if("undefined"==typeof O||"object"!=typeof O)2===L&&console.log("load_stores(): WAIT to update b/c 'map' is undefined, typeof map = ["+typeof O+"]"),setTimeout(b,500);else{2===L&&console.log("load_stores: OK to query the map for details");var e,n=O.getBounds(),s=O.getCenter(),a=G,l=O.getZoom(),u=n.getNorthEast(),d=0;if("undefined"==typeof n||"undefined"==typeof u||"undefined"==typeof s)2===L&&console.log("load_stores(): WAIT to update, the map is not ready to provide bounds or a center"),setTimeout(b,500);else{2===L&&console.log("load_stores(): OK to update map"),X=!0,B()&&P(),C(),E.empty();var g=s.lat()/57.2958,h=s.lng()/57.2958,m=u.lat()/57.2958,f=u.lng()/57.2958,v=3963;if(a=Math.max(1,Math.floor(v*Math.acos(Math.sin(g)*Math.sin(m)+Math.cos(g)*Math.cos(m)*Math.cos(f-h)))-1),2===L&&console.log("load_stores(): cur_zoom = "+l+", cur_distance = "+a),Q>=a){2===L&&console.log("load_stores(): cur_distance is low enough to send a request for stores"),p(),G>a&&(a=G);var _=c(),y=_.petType+"_"+_.category+"_"+_.recipe+"_"+_.size;2===L&&console.log("load_stores(): cur_filters = ["+y+"]"),Nutrish.gaButton("searching for stores carrying filters ["+y+"]"),t.post(Y,{user_lat:s.lat(),user_lng:s.lng(),filters:_,distance:a,max_stores:U},function(t){if(2===L&&console.log("load_stores(): stores returned"),3===L&&console.log("load_stores(): stores = "),3===L&&console.log(t),E.empty(),d=t.length,2===L&&console.log("load_stores(): the API returned = "+d+" stores"),1>d){1===L&&console.log("load_stores(): too few stores("+d+")");var n=["<h2>There are currently no stores in this area that sell the Nutrish pet food products you are looking for.</h2>","<p>Please try zooming out or dragging the map to a different location or changing your filters.</p>"].join("\n"),s=["<h2>There are currently no stores in this area that sell the Nutrish pet food products you are looking for.</h2>","<p>Please try zooming out or dragging the map to a different location or changing your filters.</p>","<p>Nutrish pet food products are also available online. See our links above.</p>"].join("\n"),l="No results";r(n,s,l)}else if(d>U)1===L&&console.log("load_stores(): too many stores("+d+")"),r("<h2>Too many results</h2><div>Try zooming in on you location.</div>");else{1===L&&console.log("load_stores(): adding "+d+" stores");for(var u={ainsworth_main:0,wilke:0},c=0;d>c;++c)3===L&&console.log("load_stores(): stores[i] = "+t[c]),e=t[c],"wilke"===e.store_type?++u.wilke:++u.ainsworth_main,o(e,c,""),i(e,c,"");1===L&&console.log("load_stores():  - ainsworth_main: "+u.ainsworth_main),1===L&&console.log("load_stores():  - wilke: "+u.wilke),S.scrollTop(0),X=!1,I(d+" results found within "+a+" miles")}},"json")}else 1===L&&console.log("load_stores(): cur_distance is too high to send a request for stores"),1===L&&console.log("load_stores(): this should never happen on mobile"),r("<h2>Zoom Too High</h2><div>Try zooming in on you location.</div>")}}}function y(e){2===L&&console.log("manual_search("+e+")"),void 0!==typeof e&&null!==e&&""!==e&&(Nutrish.gaButton("submit location form"),t.post(V,{user_loc:e},function(t){if(2===L&&console.log("manual_search(): data returned, latLngPair = "),2===L&&console.log(t),"undefined"==typeof t||null===t||""===t||t.length<1)2===L&&console.log("manual_search(): no location found"),I("Could not find the location that was provided.");else{2===L&&console.log("manual_search(): geocoded the query");var e=new google.maps.LatLng(t.lat,t.lng);$(e)}},"json"))}function N(t,e,i,o){1===L&&console.log("marker_click()"),X?(1===L&&console.log("marker_click(): WAIT to update"),setTimeout(N(t,e,i,o),500)):(1===L&&console.log("marker_click(): OK to update"),Nutrish.gaButton("pin/marker [store id: "+o+"]"))}function $(t){if(2===L&&console.log("populate_map()"),X)2===L&&console.log("populate_map(): WAIT to update"),setTimeout($(t),500);else{2===L&&console.log("populate_map(): OK to update");var e=O.getCenter(),i=O.getZoom();e.lat()!==t.lat()||e.lng()!==t.lng()||i!==A?(O.setCenter(t),O.setZoom(A)):(1===L&&console.log("populate_map(): same center and zoom, manually trigger the dragend event to re-calculate the filters"),google.maps.event.trigger(O,"dragend"))}}function w(e,i,o,n){2===L&&console.log("populateSelect()"),2===L&&console.log("populateSelect(): selectId = "+e),2===L&&console.log("populateSelect(): petType = "+i),2===L&&console.log("populateSelect(): category = "+o),2===L&&console.log("populateSelect(): recipe = "+n);var s=t("#"+e),a=null,r=0;t.post("where-to-buy/get_options",{selectId:e,petType:i,category:o,recipe:n},function(i){2===L&&console.log("populateSelect()"),2===L&&console.log("populateSelect(): data = "),2===L&&console.log(i),3===L&&console.log(typeof i),r=i.count,s.prop("disabled",!0).find("option:gt(0)").remove(),i.selectId!==e&&1===L&&console.log("populateSelect(): ERROR: the wrong select was returned"),1>r?(1===L&&console.log("populateSelect(): no options returned, nothing further to do"),b()):t.each(i.options,function(e,o){2===L&&console.log("populateSelect(): opt = "),2===L&&console.log(o),a=t("<option></option").attr("value",o.val).text(o.text),s.append(a),--r,0===r&&(1===i.count?(a.prop("selected","selected"),s.selectedIndex=a.index()):s.prop("disabled",!1),b())})},"json")}function k(t){return t.match(/^\d*$/)?t:t.match(/^mc/i)?"Mc"+t.charAt(2).toUpperCase()+t.substring(3).toLowerCase():t.charAt(0).toUpperCase()+t.substring(1).toLowerCase()}function C(){for(var t=0,e=D.length;e>t;++t)D[t].setMap(null);D.length=0}function B(){return 2===L&&console.log("supports_history_api()"),!(!window.history||!history.pushState)}function P(){2===L&&console.log("update_history()");var t=m();window.location.href!==t&&(2===L&&console.log("update_history(): updating the history to the new state"),history.replaceState(null,null,t))}function T(){2===L&&console.log("update_map()"),H&&b()}function I(t){2===L&&console.log("update_status()"),R.text(t)}var x=null,S=null,E=null,F=null,R=null,M=null,L=0,A=11,V="",z=null,j={},q=!0,O={},D=[],W="",H=!1,Q=2500,U=500,G=15,Y="",Z=!1,K=!0,J=!1,X=!1;t.store_locator=function(e){2===L&&console.log("store_locator() INIT"),x=t("#manual_search"),S=t("#map-results-wrap"),E=t("#map-results"),F=t("#query"),R=t("#map-status"),M=t(".filters").find("select"),z="/imgs/wheretobuy/store_pin.png",V="/where-to-buy/geocode",W="map-canvas",Y="/where-to-buy/get_store_list",j=new google.maps.InfoWindow,D=[],M.on("change",l),x.submit(function(e){e.preventDefault();var i=t.trim(F.val());""!==i&&y(i)}),a(W,e)}}(jQuery);