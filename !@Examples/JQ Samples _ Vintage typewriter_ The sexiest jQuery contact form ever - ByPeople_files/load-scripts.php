/*! jQuery UI - v1.10.1 - 2013-02-15
* http://jqueryui.com
* Includes: jquery.ui.core.js, jquery.ui.widget.js, jquery.ui.mouse.js, jquery.ui.draggable.js, jquery.ui.droppable.js, jquery.ui.resizable.js, jquery.ui.selectable.js, jquery.ui.sortable.js, jquery.ui.effect.js, jquery.ui.accordion.js, jquery.ui.autocomplete.js, jquery.ui.button.js, jquery.ui.datepicker.js, jquery.ui.dialog.js, jquery.ui.effect-blind.js, jquery.ui.effect-bounce.js, jquery.ui.effect-clip.js, jquery.ui.effect-drop.js, jquery.ui.effect-explode.js, jquery.ui.effect-fade.js, jquery.ui.effect-fold.js, jquery.ui.effect-highlight.js, jquery.ui.effect-pulsate.js, jquery.ui.effect-scale.js, jquery.ui.effect-shake.js, jquery.ui.effect-slide.js, jquery.ui.effect-transfer.js, jquery.ui.menu.js, jquery.ui.position.js, jquery.ui.progressbar.js, jquery.ui.slider.js, jquery.ui.spinner.js, jquery.ui.tabs.js, jquery.ui.tooltip.js
* Copyright 2013 jQuery Foundation and other contributors; Licensed MIT */
(function(e,t){function i(t,n){var r,i,o,u=t.nodeName.toLowerCase();return"area"===u?(r=t.parentNode,i=r.name,!t.href||!i||r.nodeName.toLowerCase()!=="map"?!1:(o=e("img[usemap=#"+i+"]")[0],!!o&&s(o))):(/input|select|textarea|button|object/.test(u)?!t.disabled:"a"===u?t.href||n:n)&&s(t)}function s(t){return e.expr.filters.visible(t)&&!e(t).parents().addBack().filter(function(){return e.css(this,"visibility")==="hidden"}).length}var n=0,r=/^ui-id-\d+$/;e.ui=e.ui||{};if(e.ui.version)return;e.extend(e.ui,{version:"1.10.1",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}),e.fn.extend({_focus:e.fn.focus,focus:function(t,n){return typeof t=="number"?this.each(function(){var r=this;setTimeout(function(){e(r).focus(),n&&n.call(r)},t)}):this._focus.apply(this,arguments)},scrollParent:function(){var t;return e.ui.ie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?t=this.parents().filter(function(){return/(relative|absolute|fixed)/.test(e.css(this,"position"))&&/(auto|scroll)/.test(e.css(this,"overflow")+e.css(this,"overflow-y")+e.css(this,"overflow-x"))}).eq(0):t=this.parents().filter(function(){return/(auto|scroll)/.test(e.css(this,"overflow")+e.css(this,"overflow-y")+e.css(this,"overflow-x"))}).eq(0),/fixed/.test(this.css("position"))||!t.length?e(document):t},zIndex:function(n){if(n!==t)return this.css("zIndex",n);if(this.length){var r=e(this[0]),i,s;while(r.length&&r[0]!==document){i=r.css("position");if(i==="absolute"||i==="relative"||i==="fixed"){s=parseInt(r.css("zIndex"),10);if(!isNaN(s)&&s!==0)return s}r=r.parent()}}return 0},uniqueId:function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++n)})},removeUniqueId:function(){return this.each(function(){r.test(this.id)&&e(this).removeAttr("id")})}}),e.extend(e.expr[":"],{data:e.expr.createPseudo?e.expr.createPseudo(function(t){return function(n){return!!e.data(n,t)}}):function(t,n,r){return!!e.data(t,r[3])},focusable:function(t){return i(t,!isNaN(e.attr(t,"tabindex")))},tabbable:function(t){var n=e.attr(t,"tabindex"),r=isNaN(n);return(r||n>=0)&&i(t,!r)}}),e("<a>").outerWidth(1).jquery||e.each(["Width","Height"],function(n,r){function u(t,n,r,s){return e.each(i,function(){n-=parseFloat(e.css(t,"padding"+this))||0,r&&(n-=parseFloat(e.css(t,"border"+this+"Width"))||0),s&&(n-=parseFloat(e.css(t,"margin"+this))||0)}),n}var i=r==="Width"?["Left","Right"]:["Top","Bottom"],s=r.toLowerCase(),o={innerWidth:e.fn.innerWidth,innerHeight:e.fn.innerHeight,outerWidth:e.fn.outerWidth,outerHeight:e.fn.outerHeight};e.fn["inner"+r]=function(n){return n===t?o["inner"+r].call(this):this.each(function(){e(this).css(s,u(this,n)+"px")})},e.fn["outer"+r]=function(t,n){return typeof t!="number"?o["outer"+r].call(this,t):this.each(function(){e(this).css(s,u(this,t,!0,n)+"px")})}}),e.fn.addBack||(e.fn.addBack=function(e){return this.add(e==null?this.prevObject:this.prevObject.filter(e))}),e("<a>").data("a-b","a").removeData("a-b").data("a-b")&&(e.fn.removeData=function(t){return function(n){return arguments.length?t.call(this,e.camelCase(n)):t.call(this)}}(e.fn.removeData)),e.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase()),e.support.selectstart="onselectstart"in document.createElement("div"),e.fn.extend({disableSelection:function(){return this.bind((e.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(e){e.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}}),e.extend(e.ui,{plugin:{add:function(t,n,r){var i,s=e.ui[t].prototype;for(i in r)s.plugins[i]=s.plugins[i]||[],s.plugins[i].push([n,r[i]])},call:function(e,t,n){var r,i=e.plugins[t];if(!i||!e.element[0].parentNode||e.element[0].parentNode.nodeType===11)return;for(r=0;r<i.length;r++)e.options[i[r][0]]&&i[r][1].apply(e.element,n)}},hasScroll:function(t,n){if(e(t).css("overflow")==="hidden")return!1;var r=n&&n==="left"?"scrollLeft":"scrollTop",i=!1;return t[r]>0?!0:(t[r]=1,i=t[r]>0,t[r]=0,i)}})})(jQuery),function(e,t){var n=0,r=Array.prototype.slice,i=e.cleanData;e.cleanData=function(t){for(var n=0,r;(r=t[n])!=null;n++)try{e(r).triggerHandler("remove")}catch(s){}i(t)},e.widget=function(t,n,r){var i,s,o,u,a={},f=t.split(".")[0];t=t.split(".")[1],i=f+"-"+t,r||(r=n,n=e.Widget),e.expr[":"][i.toLowerCase()]=function(t){return!!e.data(t,i)},e[f]=e[f]||{},s=e[f][t],o=e[f][t]=function(e,t){if(!this._createWidget)return new o(e,t);arguments.length&&this._createWidget(e,t)},e.extend(o,s,{version:r.version,_proto:e.extend({},r),_childConstructors:[]}),u=new n,u.options=e.widget.extend({},u.options),e.each(r,function(t,r){if(!e.isFunction(r)){a[t]=r;return}a[t]=function(){var e=function(){return n.prototype[t].apply(this,arguments)},i=function(e){return n.prototype[t].apply(this,e)};return function(){var t=this._super,n=this._superApply,s;return this._super=e,this._superApply=i,s=r.apply(this,arguments),this._super=t,this._superApply=n,s}}()}),o.prototype=e.widget.extend(u,{widgetEventPrefix:s?u.widgetEventPrefix:t},a,{constructor:o,namespace:f,widgetName:t,widgetFullName:i}),s?(e.each(s._childConstructors,function(t,n){var r=n.prototype;e.widget(r.namespace+"."+r.widgetName,o,n._proto)}),delete s._childConstructors):n._childConstructors.push(o),e.widget.bridge(t,o)},e.widget.extend=function(n){var i=r.call(arguments,1),s=0,o=i.length,u,a;for(;s<o;s++)for(u in i[s])a=i[s][u],i[s].hasOwnProperty(u)&&a!==t&&(e.isPlainObject(a)?n[u]=e.isPlainObject(n[u])?e.widget.extend({},n[u],a):e.widget.extend({},a):n[u]=a);return n},e.widget.bridge=function(n,i){var s=i.prototype.widgetFullName||n;e.fn[n]=function(o){var u=typeof o=="string",a=r.call(arguments,1),f=this;return o=!u&&a.length?e.widget.extend.apply(null,[o].concat(a)):o,u?this.each(function(){var r,i=e.data(this,s);if(!i)return e.error("cannot call methods on "+n+" prior to initialization; "+"attempted to call method '"+o+"'");if(!e.isFunction(i[o])||o.charAt(0)==="_")return e.error("no such method '"+o+"' for "+n+" widget instance");r=i[o].apply(i,a);if(r!==i&&r!==t)return f=r&&r.jquery?f.pushStack(r.get()):r,!1}):this.each(function(){var t=e.data(this,s);t?t.option(o||{})._init():e.data(this,s,new i(o,this))}),f}},e.Widget=function(){},e.Widget._childConstructors=[],e.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(t,r){r=e(r||this.defaultElement||this)[0],this.element=e(r),this.uuid=n++,this.eventNamespace="."+this.widgetName+this.uuid,this.options=e.widget.extend({},this.options,this._getCreateOptions(),t),this.bindings=e(),this.hoverable=e(),this.focusable=e(),r!==this&&(e.data(r,this.widgetFullName,this),this._on(!0,this.element,{remove:function(e){e.target===r&&this.destroy()}}),this.document=e(r.style?r.ownerDocument:r.document||r),this.window=e(this.document[0].defaultView||this.document[0].parentWindow)),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:e.noop,_getCreateEventData:e.noop,_create:e.noop,_init:e.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData(e.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled "+"ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:e.noop,widget:function(){return this.element},option:function(n,r){var i=n,s,o,u;if(arguments.length===0)return e.widget.extend({},this.options);if(typeof n=="string"){i={},s=n.split("."),n=s.shift();if(s.length){o=i[n]=e.widget.extend({},this.options[n]);for(u=0;u<s.length-1;u++)o[s[u]]=o[s[u]]||{},o=o[s[u]];n=s.pop();if(r===t)return o[n]===t?null:o[n];o[n]=r}else{if(r===t)return this.options[n]===t?null:this.options[n];i[n]=r}}return this._setOptions(i),this},_setOptions:function(e){var t;for(t in e)this._setOption(t,e[t]);return this},_setOption:function(e,t){return this.options[e]=t,e==="disabled"&&(this.widget().toggleClass(this.widgetFullName+"-disabled ui-state-disabled",!!t).attr("aria-disabled",t),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")),this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_on:function(t,n,r){var i,s=this;typeof t!="boolean"&&(r=n,n=t,t=!1),r?(n=i=e(n),this.bindings=this.bindings.add(n)):(r=n,n=this.element,i=this.widget()),e.each(r,function(r,o){function u(){if(!t&&(s.options.disabled===!0||e(this).hasClass("ui-state-disabled")))return;return(typeof o=="string"?s[o]:o).apply(s,arguments)}typeof o!="string"&&(u.guid=o.guid=o.guid||u.guid||e.guid++);var a=r.match(/^(\w+)\s*(.*)$/),f=a[1]+s.eventNamespace,l=a[2];l?i.delegate(l,f,u):n.bind(f,u)})},_off:function(e,t){t=(t||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,e.unbind(t).undelegate(t)},_delay:function(e,t){function n(){return(typeof e=="string"?r[e]:e).apply(r,arguments)}var r=this;return setTimeout(n,t||0)},_hoverable:function(t){this.hoverable=this.hoverable.add(t),this._on(t,{mouseenter:function(t){e(t.currentTarget).addClass("ui-state-hover")},mouseleave:function(t){e(t.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(t){this.focusable=this.focusable.add(t),this._on(t,{focusin:function(t){e(t.currentTarget).addClass("ui-state-focus")},focusout:function(t){e(t.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(t,n,r){var i,s,o=this.options[t];r=r||{},n=e.Event(n),n.type=(t===this.widgetEventPrefix?t:this.widgetEventPrefix+t).toLowerCase(),n.target=this.element[0],s=n.originalEvent;if(s)for(i in s)i in n||(n[i]=s[i]);return this.element.trigger(n,r),!(e.isFunction(o)&&o.apply(this.element[0],[n].concat(r))===!1||n.isDefaultPrevented())}},e.each({show:"fadeIn",hide:"fadeOut"},function(t,n){e.Widget.prototype["_"+t]=function(r,i,s){typeof i=="string"&&(i={effect:i});var o,u=i?i===!0||typeof i=="number"?n:i.effect||n:t;i=i||{},typeof i=="number"&&(i={duration:i}),o=!e.isEmptyObject(i),i.complete=s,i.delay&&r.delay(i.delay),o&&e.effects&&e.effects.effect[u]?r[t](i):u!==t&&r[u]?r[u](i.duration,i.easing,s):r.queue(function(n){e(this)[t](),s&&s.call(r[0]),n()})}})}(jQuery),function(e,t){var n=!1;e(document).mouseup(function(){n=!1}),e.widget("ui.mouse",{version:"1.10.1",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function(){var t=this;this.element.bind("mousedown."+this.widgetName,function(e){return t._mouseDown(e)}).bind("click."+this.widgetName,function(n){if(!0===e.data(n.target,t.widgetName+".preventClickEvent"))return e.removeData(n.target,t.widgetName+".preventClickEvent"),n.stopImmediatePropagation(),!1}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName),this._mouseMoveDelegate&&e(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(t){if(n)return;this._mouseStarted&&this._mouseUp(t),this._mouseDownEvent=t;var r=this,i=t.which===1,s=typeof this.options.cancel=="string"&&t.target.nodeName?e(t.target).closest(this.options.cancel).length:!1;if(!i||s||!this._mouseCapture(t))return!0;this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){r.mouseDelayMet=!0},this.options.delay));if(this._mouseDistanceMet(t)&&this._mouseDelayMet(t)){this._mouseStarted=this._mouseStart(t)!==!1;if(!this._mouseStarted)return t.preventDefault(),!0}return!0===e.data(t.target,this.widgetName+".preventClickEvent")&&e.removeData(t.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(e){return r._mouseMove(e)},this._mouseUpDelegate=function(e){return r._mouseUp(e)},e(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),t.preventDefault(),n=!0,!0},_mouseMove:function(t){return e.ui.ie&&(!document.documentMode||document.documentMode<9)&&!t.button?this._mouseUp(t):this._mouseStarted?(this._mouseDrag(t),t.preventDefault()):(this._mouseDistanceMet(t)&&this._mouseDelayMet(t)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,t)!==!1,this._mouseStarted?this._mouseDrag(t):this._mouseUp(t)),!this._mouseStarted)},_mouseUp:function(t){return e(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,t.target===this._mouseDownEvent.target&&e.data(t.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(t)),!1},_mouseDistanceMet:function(e){return Math.max(Math.abs(this._mouseDownEvent.pageX-e.pageX),Math.abs(this._mouseDownEvent.pageY-e.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}})}(jQuery),function(e,t){e.widget("ui.draggable",e.ui.mouse,{version:"1.10.1",widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1,drag:null,start:null,stop:null},_create:function(){this.options.helper==="original"&&!/^(?:r|a|f)/.test(this.element.css("position"))&&(this.element[0].style.position="relative"),this.options.addClasses&&this.element.addClass("ui-draggable"),this.options.disabled&&this.element.addClass("ui-draggable-disabled"),this._mouseInit()},_destroy:function(){this.element.removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled"),this._mouseDestroy()},_mouseCapture:function(t){var n=this.options;return this.helper||n.disabled||e(t.target).closest(".ui-resizable-handle").length>0?!1:(this.handle=this._getHandle(t),this.handle?(e(n.iframeFix===!0?"iframe":n.iframeFix).each(function(){e("<div class='ui-draggable-iframeFix' style='background: #fff;'></div>").css({width:this.offsetWidth+"px",height:this.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1e3}).css(e(this).offset()).appendTo("body")}),!0):!1)},_mouseStart:function(t){var n=this.options;return this.helper=this._createHelper(t),this.helper.addClass("ui-draggable-dragging"),this._cacheHelperProportions(),e.ui.ddmanager&&(e.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(),this.offset=this.positionAbs=this.element.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},e.extend(this.offset,{click:{left:t.pageX-this.offset.left,top:t.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.originalPosition=this.position=this._generatePosition(t),this.originalPageX=t.pageX,this.originalPageY=t.pageY,n.cursorAt&&this._adjustOffsetFromHelper(n.cursorAt),n.containment&&this._setContainment(),this._trigger("start",t)===!1?(this._clear(),!1):(this._cacheHelperProportions(),e.ui.ddmanager&&!n.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t),this._mouseDrag(t,!0),e.ui.ddmanager&&e.ui.ddmanager.dragStart(this,t),!0)},_mouseDrag:function(t,n){this.position=this._generatePosition(t),this.positionAbs=this._convertPositionTo("absolute");if(!n){var r=this._uiHash();if(this._trigger("drag",t,r)===!1)return this._mouseUp({}),!1;this.position=r.position}if(!this.options.axis||this.options.axis!=="y")this.helper[0].style.left=this.position.left+"px";if(!this.options.axis||this.options.axis!=="x")this.helper[0].style.top=this.position.top+"px";return e.ui.ddmanager&&e.ui.ddmanager.drag(this,t),!1},_mouseStop:function(t){var n,r=this,i=!1,s=!1;e.ui.ddmanager&&!this.options.dropBehaviour&&(s=e.ui.ddmanager.drop(this,t)),this.dropped&&(s=this.dropped,this.dropped=!1),n=this.element[0];while(n&&(n=n.parentNode))n===document&&(i=!0);return!i&&this.options.helper==="original"?!1:(this.options.revert==="invalid"&&!s||this.options.revert==="valid"&&s||this.options.revert===!0||e.isFunction(this.options.revert)&&this.options.revert.call(this.element,s)?e(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){r._trigger("stop",t)!==!1&&r._clear()}):this._trigger("stop",t)!==!1&&this._clear(),!1)},_mouseUp:function(t){return e("div.ui-draggable-iframeFix").each(function(){this.parentNode.removeChild(this)}),e.ui.ddmanager&&e.ui.ddmanager.dragStop(this,t),e.ui.mouse.prototype._mouseUp.call(this,t)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp({}):this._clear(),this},_getHandle:function(t){var n=!this.options.handle||!e(this.options.handle,this.element).length?!0:!1;return e(this.options.handle,this.element).find("*").addBack().each(function(){this===t.target&&(n=!0)}),n},_createHelper:function(t){var n=this.options,r=e.isFunction(n.helper)?e(n.helper.apply(this.element[0],[t])):n.helper==="clone"?this.element.clone().removeAttr("id"):this.element;return r.parents("body").length||r.appendTo(n.appendTo==="parent"?this.element[0].parentNode:n.appendTo),r[0]!==this.element[0]&&!/(fixed|absolute)/.test(r.css("position"))&&r.css("position","absolute"),r},_adjustOffsetFromHelper:function(t){typeof t=="string"&&(t=t.split(" ")),e.isArray(t)&&(t={left:+t[0],top:+t[1]||0}),"left"in t&&(this.offset.click.left=t.left+this.margins.left),"right"in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left),"top"in t&&(this.offset.click.top=t.top+this.margins.top),"bottom"in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var t=this.offsetParent.offset();this.cssPosition==="absolute"&&this.scrollParent[0]!==document&&e.contains(this.scrollParent[0],this.offsetParent[0])&&(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop());if(this.offsetParent[0]===document.body||this.offsetParent[0].tagName&&this.offsetParent[0].tagName.toLowerCase()==="html"&&e.ui.ie)t={top:0,left:0};return{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if(this.cssPosition==="relative"){var e=this.element.position();return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:e.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var t,n,r,i=this.options;i.containment==="parent"&&(i.containment=this.helper[0].parentNode);if(i.containment==="document"||i.containment==="window")this.containment=[i.containment==="document"?0:e(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,i.containment==="document"?0:e(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,(i.containment==="document"?0:e(window).scrollLeft())+e(i.containment==="document"?document:window).width()-this.helperProportions.width-this.margins.left,(i.containment==="document"?0:e(window).scrollTop())+(e(i.containment==="document"?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top];if(!/^(document|window|parent)$/.test(i.containment)&&i.containment.constructor!==Array){n=e(i.containment),r=n[0];if(!r)return;t=e(r).css("overflow")!=="hidden",this.containment=[(parseInt(e(r).css("borderLeftWidth"),10)||0)+(parseInt(e(r).css("paddingLeft"),10)||0),(parseInt(e(r).css("borderTopWidth"),10)||0)+(parseInt(e(r).css("paddingTop"),10)||0),(t?Math.max(r.scrollWidth,r.offsetWidth):r.offsetWidth)-(parseInt(e(r).css("borderLeftWidth"),10)||0)-(parseInt(e(r).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(t?Math.max(r.scrollHeight,r.offsetHeight):r.offsetHeight)-(parseInt(e(r).css("borderTopWidth"),10)||0)-(parseInt(e(r).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relative_container=n}else i.containment.constructor===Array&&(this.containment=i.containment)},_convertPositionTo:function(t,n){n||(n=this.position);var r=t==="absolute"?1:-1,i=this.cssPosition!=="absolute"||this.scrollParent[0]!==document&&!!e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,s=/(html|body)/i.test(i[0].tagName);return{top:n.top+this.offset.relative.top*r+this.offset.parent.top*r-(this.cssPosition==="fixed"?-this.scrollParent.scrollTop():s?0:i.scrollTop())*r,left:n.left+this.offset.relative.left*r+this.offset.parent.left*r-(this.cssPosition==="fixed"?-this.scrollParent.scrollLeft():s?0:i.scrollLeft())*r}},_generatePosition:function(t){var n,r,i,s,o=this.options,u=this.cssPosition!=="absolute"||this.scrollParent[0]!==document&&!!e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,a=/(html|body)/i.test(u[0].tagName),f=t.pageX,l=t.pageY;return this.originalPosition&&(this.containment&&(this.relative_container?(r=this.relative_container.offset(),n=[this.containment[0]+r.left,this.containment[1]+r.top,this.containment[2]+r.left,this.containment[3]+r.top]):n=this.containment,t.pageX-this.offset.click.left<n[0]&&(f=n[0]+this.offset.click.left),t.pageY-this.offset.click.top<n[1]&&(l=n[1]+this.offset.click.top),t.pageX-this.offset.click.left>n[2]&&(f=n[2]+this.offset.click.left),t.pageY-this.offset.click.top>n[3]&&(l=n[3]+this.offset.click.top)),o.grid&&(i=o.grid[1]?this.originalPageY+Math.round((l-this.originalPageY)/o.grid[1])*o.grid[1]:this.originalPageY,l=n?i-this.offset.click.top>=n[1]||i-this.offset.click.top>n[3]?i:i-this.offset.click.top>=n[1]?i-o.grid[1]:i+o.grid[1]:i,s=o.grid[0]?this.originalPageX+Math.round((f-this.originalPageX)/o.grid[0])*o.grid[0]:this.originalPageX,f=n?s-this.offset.click.left>=n[0]||s-this.offset.click.left>n[2]?s:s-this.offset.click.left>=n[0]?s-o.grid[0]:s+o.grid[0]:s)),{top:l-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+(this.cssPosition==="fixed"?-this.scrollParent.scrollTop():a?0:u.scrollTop()),left:f-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+(this.cssPosition==="fixed"?-this.scrollParent.scrollLeft():a?0:u.scrollLeft())}},_clear:function(){this.helper.removeClass("ui-draggable-dragging"),this.helper[0]!==this.element[0]&&!this.cancelHelperRemoval&&this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1},_trigger:function(t,n,r){return r=r||this._uiHash(),e.ui.plugin.call(this,t,[n,r]),t==="drag"&&(this.positionAbs=this._convertPositionTo("absolute")),e.Widget.prototype._trigger.call(this,t,n,r)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),e.ui.plugin.add("draggable","connectToSortable",{start:function(t,n){var r=e(this).data("ui-draggable"),i=r.options,s=e.extend({},n,{item:r.element});r.sortables=[],e(i.connectToSortable).each(function(){var n=e.data(this,"ui-sortable");n&&!n.options.disabled&&(r.sortables.push({instance:n,shouldRevert:n.options.revert}),n.refreshPositions(),n._trigger("activate",t,s))})},stop:function(t,n){var r=e(this).data("ui-draggable"),i=e.extend({},n,{item:r.element});e.each(r.sortables,function(){this.instance.isOver?(this.instance.isOver=0,r.cancelHelperRemoval=!0,this.instance.cancelHelperRemoval=!1,this.shouldRevert&&(this.instance.options.revert=!0),this.instance._mouseStop(t),this.instance.options.helper=this.instance.options._helper,r.options.helper==="original"&&this.instance.currentItem.css({top:"auto",left:"auto"})):(this.instance.cancelHelperRemoval=!1,this.instance._trigger("deactivate",t,i))})},drag:function(t,n){var r=e(this).data("ui-draggable"),i=this;e.each(r.sortables,function(){var s=!1,o=this;this.instance.positionAbs=r.positionAbs,this.instance.helperProportions=r.helperProportions,this.instance.offset.click=r.offset.click,this.instance._intersectsWith(this.instance.containerCache)&&(s=!0,e.each(r.sortables,function(){return this.instance.positionAbs=r.positionAbs,this.instance.helperProportions=r.helperProportions,this.instance.offset.click=r.offset.click,this!==o&&this.instance._intersectsWith(this.instance.containerCache)&&e.contains(o.instance.element[0],this.instance.element[0])&&(s=!1),s})),s?(this.instance.isOver||(this.instance.isOver=1,this.instance.currentItem=e(i).clone().removeAttr("id").appendTo(this.instance.element).data("ui-sortable-item",!0),this.instance.options._helper=this.instance.options.helper,this.instance.options.helper=function(){return n.helper[0]},t.target=this.instance.currentItem[0],this.instance._mouseCapture(t,!0),this.instance._mouseStart(t,!0,!0),this.instance.offset.click.top=r.offset.click.top,this.instance.offset.click.left=r.offset.click.left,this.instance.offset.parent.left-=r.offset.parent.left-this.instance.offset.parent.left,this.instance.offset.parent.top-=r.offset.parent.top-this.instance.offset.parent.top,r._trigger("toSortable",t),r.dropped=this.instance.element,r.currentItem=r.element,this.instance.fromOutside=r),this.instance.currentItem&&this.instance._mouseDrag(t)):this.instance.isOver&&(this.instance.isOver=0,this.instance.cancelHelperRemoval=!0,this.instance.options.revert=!1,this.instance._trigger("out",t,this.instance._uiHash(this.instance)),this.instance._mouseStop(t,!0),this.instance.options.helper=this.instance.options._helper,this.instance.currentItem.remove(),this.instance.placeholder&&this.instance.placeholder.remove(),r._trigger("fromSortable",t),r.dropped=!1)})}}),e.ui.plugin.add("draggable","cursor",{start:function(){var t=e("body"),n=e(this).data("ui-draggable").options;t.css("cursor")&&(n._cursor=t.css("cursor")),t.css("cursor",n.cursor)},stop:function(){var t=e(this).data("ui-draggable").options;t._cursor&&e("body").css("cursor",t._cursor)}}),e.ui.plugin.add("draggable","opacity",{start:function(t,n){var r=e(n.helper),i=e(this).data("ui-draggable").options;r.css("opacity")&&(i._opacity=r.css("opacity")),r.css("opacity",i.opacity)},stop:function(t,n){var r=e(this).data("ui-draggable").options;r._opacity&&e(n.helper).css("opacity",r._opacity)}}),e.ui.plugin.add("draggable","scroll",{start:function(){var t=e(this).data("ui-draggable");t.scrollParent[0]!==document&&t.scrollParent[0].tagName!=="HTML"&&(t.overflowOffset=t.scrollParent.offset())},drag:function(t){var n=e(this).data("ui-draggable"),r=n.options,i=!1;if(n.scrollParent[0]!==document&&n.scrollParent[0].tagName!=="HTML"){if(!r.axis||r.axis!=="x")n.overflowOffset.top+n.scrollParent[0].offsetHeight-t.pageY<r.scrollSensitivity?n.scrollParent[0].scrollTop=i=n.scrollParent[0].scrollTop+r.scrollSpeed:t.pageY-n.overflowOffset.top<r.scrollSensitivity&&(n.scrollParent[0].scrollTop=i=n.scrollParent[0].scrollTop-r.scrollSpeed);if(!r.axis||r.axis!=="y")n.overflowOffset.left+n.scrollParent[0].offsetWidth-t.pageX<r.scrollSensitivity?n.scrollParent[0].scrollLeft=i=n.scrollParent[0].scrollLeft+r.scrollSpeed:t.pageX-n.overflowOffset.left<r.scrollSensitivity&&(n.scrollParent[0].scrollLeft=i=n.scrollParent[0].scrollLeft-r.scrollSpeed)}else{if(!r.axis||r.axis!=="x")t.pageY-e(document).scrollTop()<r.scrollSensitivity?i=e(document).scrollTop(e(document).scrollTop()-r.scrollSpeed):e(window).height()-(t.pageY-e(document).scrollTop())<r.scrollSensitivity&&(i=e(document).scrollTop(e(document).scrollTop()+r.scrollSpeed));if(!r.axis||r.axis!=="y")t.pageX-e(document).scrollLeft()<r.scrollSensitivity?i=e(document).scrollLeft(e(document).scrollLeft()-r.scrollSpeed):e(window).width()-(t.pageX-e(document).scrollLeft())<r.scrollSensitivity&&(i=e(document).scrollLeft(e(document).scrollLeft()+r.scrollSpeed))}i!==!1&&e.ui.ddmanager&&!r.dropBehaviour&&e.ui.ddmanager.prepareOffsets(n,t)}}),e.ui.plugin.add("draggable","snap",{start:function(){var t=e(this).data("ui-draggable"),n=t.options;t.snapElements=[],e(n.snap.constructor!==String?n.snap.items||":data(ui-draggable)":n.snap).each(function(){var n=e(this),r=n.offset();this!==t.element[0]&&t.snapElements.push({item:this,width:n.outerWidth(),height:n.outerHeight(),top:r.top,left:r.left})})},drag:function(t,n){var r,i,s,o,u,a,f,l,c,h,p=e(this).data("ui-draggable"),d=p.options,v=d.snapTolerance,m=n.offset.left,g=m+p.helperProportions.width,y=n.offset.top,b=y+p.helperProportions.height;for(c=p.snapElements.length-1;c>=0;c--){u=p.snapElements[c].left,a=u+p.snapElements[c].width,f=p.snapElements[c].top,l=f+p.snapElements[c].height;if(!(u-v<m&&m<a+v&&f-v<y&&y<l+v||u-v<m&&m<a+v&&f-v<b&&b<l+v||u-v<g&&g<a+v&&f-v<y&&y<l+v||u-v<g&&g<a+v&&f-v<b&&b<l+v)){p.snapElements[c].snapping&&p.options.snap.release&&p.options.snap.release.call(p.element,t,e.extend(p._uiHash(),{snapItem:p.snapElements[c].item})),p.snapElements[c].snapping=!1;continue}d.snapMode!=="inner"&&(r=Math.abs(f-b)<=v,i=Math.abs(l-y)<=v,s=Math.abs(u-g)<=v,o=Math.abs(a-m)<=v,r&&(n.position.top=p._convertPositionTo("relative",{top:f-p.helperProportions.height,left:0}).top-p.margins.top),i&&(n.position.top=p._convertPositionTo("relative",{top:l,left:0}).top-p.margins.top),s&&(n.position.left=p._convertPositionTo("relative",{top:0,left:u-p.helperProportions.width}).left-p.margins.left),o&&(n.position.left=p._convertPositionTo("relative",{top:0,left:a}).left-p.margins.left)),h=r||i||s||o,d.snapMode!=="outer"&&(r=Math.abs(f-y)<=v,i=Math.abs(l-b)<=v,s=Math.abs(u-m)<=v,o=Math.abs(a-g)<=v,r&&(n.position.top=p._convertPositionTo("relative",{top:f,left:0}).top-p.margins.top),i&&(n.position.top=p._convertPositionTo("relative",{top:l-p.helperProportions.height,left:0}).top-p.margins.top),s&&(n.position.left=p._convertPositionTo("relative",{top:0,left:u}).left-p.margins.left),o&&(n.position.left=p._convertPositionTo("relative",{top:0,left:a-p.helperProportions.width}).left-p.margins.left)),!p.snapElements[c].snapping&&(r||i||s||o||h)&&p.options.snap.snap&&p.options.snap.snap.call(p.element,t,e.extend(p._uiHash(),{snapItem:p.snapElements[c].item})),p.snapElements[c].snapping=r||i||s||o||h}}}),e.ui.plugin.add("draggable","stack",{start:function(){var t,n=this.data("ui-draggable").options,r=e.makeArray(e(n.stack)).sort(function(t,n){return(parseInt(e(t).css("zIndex"),10)||0)-(parseInt(e(n).css("zIndex"),10)||0)});if(!r.length)return;t=parseInt(e(r[0]).css("zIndex"),10)||0,e(r).each(function(n){e(this).css("zIndex",t+n)}),this.css("zIndex",t+r.length)}}),e.ui.plugin.add("draggable","zIndex",{start:function(t,n){var r=e(n.helper),i=e(this).data("ui-draggable").options;r.css("zIndex")&&(i._zIndex=r.css("zIndex")),r.css("zIndex",i.zIndex)},stop:function(t,n){var r=e(this).data("ui-draggable").options;r._zIndex&&e(n.helper).css("zIndex",r._zIndex)}})}(jQuery),function(e,t){function n(e,t,n){return e>t&&e<t+n}e.widget("ui.droppable",{version:"1.10.1",widgetEventPrefix:"drop",options:{accept:"*",activeClass:!1,addClasses:!0,greedy:!1,hoverClass:!1,scope:"default",tolerance:"intersect",activate:null,deactivate:null,drop:null,out:null,over:null},_create:function(){var t=this.options,n=t.accept;this.isover=!1,this.isout=!0,this.accept=e.isFunction(n)?n:function(e){return e.is(n)},this.proportions={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight},e.ui.ddmanager.droppables[t.scope]=e.ui.ddmanager.droppables[t.scope]||[],e.ui.ddmanager.droppables[t.scope].push(this),t.addClasses&&this.element.addClass("ui-droppable")},_destroy:function(){var t=0,n=e.ui.ddmanager.droppables[this.options.scope];for(;t<n.length;t++)n[t]===this&&n.splice(t,1);this.element.removeClass("ui-droppable ui-droppable-disabled")},_setOption:function(t,n){t==="accept"&&(this.accept=e.isFunction(n)?n:function(e){return e.is(n)}),e.Widget.prototype._setOption.apply(this,arguments)},_activate:function(t){var n=e.ui.ddmanager.current;this.options.activeClass&&this.element.addClass(this.options.activeClass),n&&this._trigger("activate",t,this.ui(n))},_deactivate:function(t){var n=e.ui.ddmanager.current;this.options.activeClass&&this.element.removeClass(this.options.activeClass),n&&this._trigger("deactivate",t,this.ui(n))},_over:function(t){var n=e.ui.ddmanager.current;if(!n||(n.currentItem||n.element)[0]===this.element[0])return;this.accept.call(this.element[0],n.currentItem||n.element)&&(this.options.hoverClass&&this.element.addClass(this.options.hoverClass),this._trigger("over",t,this.ui(n)))},_out:function(t){var n=e.ui.ddmanager.current;if(!n||(n.currentItem||n.element)[0]===this.element[0])return;this.accept.call(this.element[0],n.currentItem||n.element)&&(this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("out",t,this.ui(n)))},_drop:function(t,n){var r=n||e.ui.ddmanager.current,i=!1;return!r||(r.currentItem||r.element)[0]===this.element[0]?!1:(this.element.find(":data(ui-droppable)").not(".ui-draggable-dragging").each(function(){var t=e.data(this,"ui-droppable");if(t.options.greedy&&!t.options.disabled&&t.options.scope===r.options.scope&&t.accept.call(t.element[0],r.currentItem||r.element)&&e.ui.intersect(r,e.extend(t,{offset:t.element.offset()}),t.options.tolerance))return i=!0,!1}),i?!1:this.accept.call(this.element[0],r.currentItem||r.element)?(this.options.activeClass&&this.element.removeClass(this.options.activeClass),this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("drop",t,this.ui(r)),this.element):!1)},ui:function(e){return{draggable:e.currentItem||e.element,helper:e.helper,position:e.position,offset:e.positionAbs}}}),e.ui.intersect=function(e,t,r){if(!t.offset)return!1;var i,s,o=(e.positionAbs||e.position.absolute).left,u=o+e.helperProportions.width,a=(e.positionAbs||e.position.absolute).top,f=a+e.helperProportions.height,l=t.offset.left,c=l+t.proportions.width,h=t.offset.top,p=h+t.proportions.height;switch(r){case"fit":return l<=o&&u<=c&&h<=a&&f<=p;case"intersect":return l<o+e.helperProportions.width/2&&u-e.helperProportions.width/2<c&&h<a+e.helperProportions.height/2&&f-e.helperProportions.height/2<p;case"pointer":return i=(e.positionAbs||e.position.absolute).left+(e.clickOffset||e.offset.click).left,s=(e.positionAbs||e.position.absolute).top+(e.clickOffset||e.offset.click).top,n(s,h,t.proportions.height)&&n(i,l,t.proportions.width);case"touch":return(a>=h&&a<=p||f>=h&&f<=p||a<h&&f>p)&&(o>=l&&o<=c||u>=l&&u<=c||o<l&&u>c);default:return!1}},e.ui.ddmanager={current:null,droppables:{"default":[]},prepareOffsets:function(t,n){var r,i,s=e.ui.ddmanager.droppables[t.options.scope]||[],o=n?n.type:null,u=(t.currentItem||t.element).find(":data(ui-droppable)").addBack();e:for(r=0;r<s.length;r++){if(s[r].options.disabled||t&&!s[r].accept.call(s[r].element[0],t.currentItem||t.element))continue;for(i=0;i<u.length;i++)if(u[i]===s[r].element[0]){s[r].proportions.height=0;continue e}s[r].visible=s[r].element.css("display")!=="none";if(!s[r].visible)continue;o==="mousedown"&&s[r]._activate.call(s[r],n),s[r].offset=s[r].element.offset(),s[r].proportions={width:s[r].element[0].offsetWidth,height:s[r].element[0].offsetHeight}}},drop:function(t,n){var r=!1;return e.each(e.ui.ddmanager.droppables[t.options.scope]||[],function(){if(!this.options)return;!this.options.disabled&&this.visible&&e.ui.intersect(t,this,this.options.tolerance)&&(r=this._drop.call(this,n)||r),!this.options.disabled&&this.visible&&this.accept.call(this.element[0],t.currentItem||t.element)&&(this.isout=!0,this.isover=!1,this._deactivate.call(this,n))}),r},dragStart:function(t,n){t.element.parentsUntil("body").bind("scroll.droppable",function(){t.options.refreshPositions||e.ui.ddmanager.prepareOffsets(t,n)})},drag:function(t,n){t.options.refreshPositions&&e.ui.ddmanager.prepareOffsets(t,n),e.each(e.ui.ddmanager.droppables[t.options.scope]||[],function(){if(this.options.disabled||this.greedyChild||!this.visible)return;var r,i,s,o=e.ui.intersect(t,this,this.options.tolerance),u=!o&&this.isover?"isout":o&&!this.isover?"isover":null;if(!u)return;this.options.greedy&&(i=this.options.scope,s=this.element.parents(":data(ui-droppable)").filter(function(){return e.data(this,"ui-droppable").options.scope===i}),s.length&&(r=e.data(s[0],"ui-droppable"),r.greedyChild=u==="isover")),r&&u==="isover"&&(r.isover=!1,r.isout=!0,r._out.call(r,n)),this[u]=!0,this[u==="isout"?"isover":"isout"]=!1,this[u==="isover"?"_over":"_out"].call(this,n),r&&u==="isout"&&(r.isout=!1,r.isover=!0,r._over.call(r,n))})},dragStop:function(t,n){t.element.parentsUntil("body").unbind("scroll.droppable"),t.options.refreshPositions||e.ui.ddmanager.prepareOffsets(t,n)}}}(jQuery),function(e,t){function n(e){return parseInt(e,10)||0}function r(e){return!isNaN(parseInt(e,10))}e.widget("ui.resizable",e.ui.mouse,{version:"1.10.1",widgetEventPrefix:"resize",options:{alsoResize:!1,animate:!1,animateDuration:"slow",animateEasing:"swing",aspectRatio:!1,autoHide:!1,containment:!1,ghost:!1,grid:!1,handles:"e,s,se",helper:!1,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:90,resize:null,start:null,stop:null},_create:function(){var t,n,r,i,s,o=this,u=this.options;this.element.addClass("ui-resizable"),e.extend(this,{_aspectRatio:!!u.aspectRatio,aspectRatio:u.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],_helper:u.helper||u.ghost||u.animate?u.helper||"ui-resizable-helper":null}),this.element[0].nodeName.match(/canvas|textarea|input|select|button|img/i)&&(this.element.wrap(e("<div class='ui-wrapper' style='overflow: hidden;'></div>").css({position:this.element.css("position"),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css("top"),left:this.element.css("left")})),this.element=this.element.parent().data("ui-resizable",this.element.data("ui-resizable")),this.elementIsWrapper=!0,this.element.css({marginLeft:this.originalElement.css("marginLeft"),marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom")}),this.originalElement.css({marginLeft:0,marginTop:0,marginRight:0,marginBottom:0}),this.originalResizeStyle=this.originalElement.css("resize"),this.originalElement.css("resize","none"),this._proportionallyResizeElements.push(this.originalElement.css({position:"static",zoom:1,display:"block"})),this.originalElement.css({margin:this.originalElement.css("margin")}),this._proportionallyResize()),this.handles=u.handles||(e(".ui-resizable-handle",this.element).length?{n:".ui-resizable-n",e:".ui-resizable-e",s:".ui-resizable-s",w:".ui-resizable-w",se:".ui-resizable-se",sw:".ui-resizable-sw",ne:".ui-resizable-ne",nw:".ui-resizable-nw"}:"e,s,se");if(this.handles.constructor===String){this.handles==="all"&&(this.handles="n,e,s,w,se,sw,ne,nw"),t=this.handles.split(","),this.handles={};for(n=0;n<t.length;n++)r=e.trim(t[n]),s="ui-resizable-"+r,i=e("<div class='ui-resizable-handle "+s+"'></div>"),i.css({zIndex:u.zIndex}),"se"===r&&i.addClass("ui-icon ui-icon-gripsmall-diagonal-se"),this.handles[r]=".ui-resizable-"+r,this.element.append(i)}this._renderAxis=function(t){var n,r,i,s;t=t||this.element;for(n in this.handles){this.handles[n].constructor===String&&(this.handles[n]=e(this.handles[n],this.element).show()),this.elementIsWrapper&&this.originalElement[0].nodeName.match(/textarea|input|select|button/i)&&(r=e(this.handles[n],this.element),s=/sw|ne|nw|se|n|s/.test(n)?r.outerHeight():r.outerWidth(),i=["padding",/ne|nw|n/.test(n)?"Top":/se|sw|s/.test(n)?"Bottom":/^e$/.test(n)?"Right":"Left"].join(""),t.css(i,s),this._proportionallyResize());if(!e(this.handles[n]).length)continue}},this._renderAxis(this.element),this._handles=e(".ui-resizable-handle",this.element).disableSelection(),this._handles.mouseover(function(){o.resizing||(this.className&&(i=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i)),o.axis=i&&i[1]?i[1]:"se")}),u.autoHide&&(this._handles.hide(),e(this.element).addClass("ui-resizable-autohide").mouseenter(function(){if(u.disabled)return;e(this).removeClass("ui-resizable-autohide"),o._handles.show()}).mouseleave(function(){if(u.disabled)return;o.resizing||(e(this).addClass("ui-resizable-autohide"),o._handles.hide())})),this._mouseInit()},_destroy:function(){this._mouseDestroy();var t,n=function(t){e(t).removeClass("ui-resizable ui-resizable-disabled ui-resizable-resizing").removeData("resizable").removeData("ui-resizable").unbind(".resizable").find(".ui-resizable-handle").remove()};return this.elementIsWrapper&&(n(this.element),t=this.element,this.originalElement.css({position:t.css("position"),width:t.outerWidth(),height:t.outerHeight(),top:t.css("top"),left:t.css("left")}).insertAfter(t),t.remove()),this.originalElement.css("resize",this.originalResizeStyle),n(this.originalElement),this},_mouseCapture:function(t){var n,r,i=!1;for(n in this.handles){r=e(this.handles[n])[0];if(r===t.target||e.contains(r,t.target))i=!0}return!this.options.disabled&&i},_mouseStart:function(t){var r,i,s,o=this.options,u=this.element.position(),a=this.element;return this.resizing=!0,/absolute/.test(a.css("position"))?a.css({position:"absolute",top:a.css("top"),left:a.css("left")}):a.is(".ui-draggable")&&a.css({position:"absolute",top:u.top,left:u.left}),this._renderProxy(),r=n(this.helper.css("left")),i=n(this.helper.css("top")),o.containment&&(r+=e(o.containment).scrollLeft()||0,i+=e(o.containment).scrollTop()||0),this.offset=this.helper.offset(),this.position={left:r,top:i},this.size=this._helper?{width:a.outerWidth(),height:a.outerHeight()}:{width:a.width(),height:a.height()},this.originalSize=this._helper?{width:a.outerWidth(),height:a.outerHeight()}:{width:a.width(),height:a.height()},this.originalPosition={left:r,top:i},this.sizeDiff={width:a.outerWidth()-a.width(),height:a.outerHeight()-a.height()},this.originalMousePosition={left:t.pageX,top:t.pageY},this.aspectRatio=typeof o.aspectRatio=="number"?o.aspectRatio:this.originalSize.width/this.originalSize.height||1,s=e(".ui-resizable-"+this.axis).css("cursor"),e("body").css("cursor",s==="auto"?this.axis+"-resize":s),a.addClass("ui-resizable-resizing"),this._propagate("start",t),!0},_mouseDrag:function(t){var n,r=this.helper,i={},s=this.originalMousePosition,o=this.axis,u=this.position.top,a=this.position.left,f=this.size.width,l=this.size.height,c=t.pageX-s.left||0,h=t.pageY-s.top||0,p=this._change[o];if(!p)return!1;n=p.apply(this,[t,c,h]),this._updateVirtualBoundaries(t.shiftKey);if(this._aspectRatio||t.shiftKey)n=this._updateRatio(n,t);return n=this._respectSize(n,t),this._updateCache(n),this._propagate("resize",t),this.position.top!==u&&(i.top=this.position.top+"px"),this.position.left!==a&&(i.left=this.position.left+"px"),this.size.width!==f&&(i.width=this.size.width+"px"),this.size.height!==l&&(i.height=this.size.height+"px"),r.css(i),!this._helper&&this._proportionallyResizeElements.length&&this._proportionallyResize(),e.isEmptyObject(i)||this._trigger("resize",t,this.ui()),!1},_mouseStop:function(t){this.resizing=!1;var n,r,i,s,o,u,a,f=this.options,l=this;return this._helper&&(n=this._proportionallyResizeElements,r=n.length&&/textarea/i.test(n[0].nodeName),i=r&&e.ui.hasScroll(n[0],"left")?0:l.sizeDiff.height,s=r?0:l.sizeDiff.width,o={width:l.helper.width()-s,height:l.helper.height()-i},u=parseInt(l.element.css("left"),10)+(l.position.left-l.originalPosition.left)||null,a=parseInt(l.element.css("top"),10)+(l.position.top-l.originalPosition.top)||null,f.animate||this.element.css(e.extend(o,{top:a,left:u})),l.helper.height(l.size.height),l.helper.width(l.size.width),this._helper&&!f.animate&&this._proportionallyResize()),e("body").css("cursor","auto"),this.element.removeClass("ui-resizable-resizing"),this._propagate("stop",t),this._helper&&this.helper.remove(),!1},_updateVirtualBoundaries:function(e){var t,n,i,s,o,u=this.options;o={minWidth:r(u.minWidth)?u.minWidth:0,maxWidth:r(u.maxWidth)?u.maxWidth:Infinity,minHeight:r(u.minHeight)?u.minHeight:0,maxHeight:r(u.maxHeight)?u.maxHeight:Infinity};if(this._aspectRatio||e)t=o.minHeight*this.aspectRatio,i=o.minWidth/this.aspectRatio,n=o.maxHeight*this.aspectRatio,s=o.maxWidth/this.aspectRatio,t>o.minWidth&&(o.minWidth=t),i>o.minHeight&&(o.minHeight=i),n<o.maxWidth&&(o.maxWidth=n),s<o.maxHeight&&(o.maxHeight=s);this._vBoundaries=o},_updateCache:function(e){this.offset=this.helper.offset(),r(e.left)&&(this.position.left=e.left),r(e.top)&&(this.position.top=e.top),r(e.height)&&(this.size.height=e.height),r(e.width)&&(this.size.width=e.width)},_updateRatio:function(e){var t=this.position,n=this.size,i=this.axis;return r(e.height)?e.width=e.height*this.aspectRatio:r(e.width)&&(e.height=e.width/this.aspectRatio),i==="sw"&&(e.left=t.left+(n.width-e.width),e.top=null),i==="nw"&&(e.top=t.top+(n.height-e.height),e.left=t.left+(n.width-e.width)),e},_respectSize:function(e){var t=this._vBoundaries,n=this.axis,i=r(e.width)&&t.maxWidth&&t.maxWidth<e.width,s=r(e.height)&&t.maxHeight&&t.maxHeight<e.height,o=r(e.width)&&t.minWidth&&t.minWidth>e.width,u=r(e.height)&&t.minHeight&&t.minHeight>e.height,a=this.originalPosition.left+this.originalSize.width,f=this.position.top+this.size.height,l=/sw|nw|w/.test(n),c=/nw|ne|n/.test(n);return o&&(e.width=t.minWidth),u&&(e.height=t.minHeight),i&&(e.width=t.maxWidth),s&&(e.height=t.maxHeight),o&&l&&(e.left=a-t.minWidth),i&&l&&(e.left=a-t.maxWidth),u&&c&&(e.top=f-t.minHeight),s&&c&&(e.top=f-t.maxHeight),!e.width&&!e.height&&!e.left&&e.top?e.top=null:!e.width&&!e.height&&!e.top&&e.left&&(e.left=null),e},_proportionallyResize:function(){if(!this._proportionallyResizeElements.length)return;var e,t,n,r,i,s=this.helper||this.element;for(e=0;e<this._proportionallyResizeElements.length;e++){i=this._proportionallyResizeElements[e];if(!this.borderDif){this.borderDif=[],n=[i.css("borderTopWidth"),i.css("borderRightWidth"),i.css("borderBottomWidth"),i.css("borderLeftWidth")],r=[i.css("paddingTop"),i.css("paddingRight"),i.css("paddingBottom"),i.css("paddingLeft")];for(t=0;t<n.length;t++)this.borderDif[t]=(parseInt(n[t],10)||0)+(parseInt(r[t],10)||0)}i.css({height:s.height()-this.borderDif[0]-this.borderDif[2]||0,width:s.width()-this.borderDif[1]-this.borderDif[3]||0})}},_renderProxy:function(){var t=this.element,n=this.options;this.elementOffset=t.offset(),this._helper?(this.helper=this.helper||e("<div style='overflow:hidden;'></div>"),this.helper.addClass(this._helper).css({width:this.element.outerWidth()-1,height:this.element.outerHeight()-1,position:"absolute",left:this.elementOffset.left+"px",top:this.elementOffset.top+"px",zIndex:++n.zIndex}),this.helper.appendTo("body").disableSelection()):this.helper=this.element},_change:{e:function(e,t){return{width:this.originalSize.width+t}},w:function(e,t){var n=this.originalSize,r=this.originalPosition;return{left:r.left+t,width:n.width-t}},n:function(e,t,n){var r=this.originalSize,i=this.originalPosition;return{top:i.top+n,height:r.height-n}},s:function(e,t,n){return{height:this.originalSize.height+n}},se:function(t,n,r){return e.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[t,n,r]))},sw:function(t,n,r){return e.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[t,n,r]))},ne:function(t,n,r){return e.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[t,n,r]))},nw:function(t,n,r){return e.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[t,n,r]))}},_propagate:function(t,n){e.ui.plugin.call(this,t,[n,this.ui()]),t!=="resize"&&this._trigger(t,n,this.ui())},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition}}}),e.ui.plugin.add("resizable","animate",{stop:function(t){var n=e(this).data("ui-resizable"),r=n.options,i=n._proportionallyResizeElements,s=i.length&&/textarea/i.test(i[0].nodeName),o=s&&e.ui.hasScroll(i[0],"left")?0:n.sizeDiff.height,u=s?0:n.sizeDiff.width,a={width:n.size.width-u,height:n.size.height-o},f=parseInt(n.element.css("left"),10)+(n.position.left-n.originalPosition.left)||null,l=parseInt(n.element.css("top"),10)+(n.position.top-n.originalPosition.top)||null;n.element.animate(e.extend(a,l&&f?{top:l,left:f}:{}),{duration:r.animateDuration,easing:r.animateEasing,step:function(){var r={width:parseInt(n.element.css("width"),10),height:parseInt(n.element.css("height"),10),top:parseInt(n.element.css("top"),10),left:parseInt(n.element.css("left"),10)};i&&i.length&&e(i[0]).css({width:r.width,height:r.height}),n._updateCache(r),n._propagate("resize",t)}})}}),e.ui.plugin.add("resizable","containment",{start:function(){var t,r,i,s,o,u,a,f=e(this).data("ui-resizable"),l=f.options,c=f.element,h=l.containment,p=h instanceof e?h.get(0):/parent/.test(h)?c.parent().get(0):h;if(!p)return;f.containerElement=e(p),/document/.test(h)||h===document?(f.containerOffset={left:0,top:0},f.containerPosition={left:0,top:0},f.parentData={element:e(document),left:0,top:0,width:e(document).width(),height:e(document).height()||document.body.parentNode.scrollHeight}):(t=e(p),r=[],e(["Top","Right","Left","Bottom"]).each(function(e,i){r[e]=n(t.css("padding"+i))}),f.containerOffset=t.offset(),f.containerPosition=t.position(),f.containerSize={height:t.innerHeight()-r[3],width:t.innerWidth()-r[1]},i=f.containerOffset,s=f.containerSize.height,o=f.containerSize.width,u=e.ui.hasScroll(p,"left")?p.scrollWidth:o,a=e.ui.hasScroll(p)?p.scrollHeight:s,f.parentData={element:p,left:i.left,top:i.top,width:u,height:a})},resize:function(t){var n,r,i,s,o=e(this).data("ui-resizable"),u=o.options,a=o.containerOffset,f=o.position,l=o._aspectRatio||t.shiftKey,c={top:0,left:0},h=o.containerElement;h[0]!==document&&/static/.test(h.css("position"))&&(c=a),f.left<(o._helper?a.left:0)&&(o.size.width=o.size.width+(o._helper?o.position.left-a.left:o.position.left-c.left),l&&(o.size.height=o.size.width/o.aspectRatio),o.position.left=u.helper?a.left:0),f.top<(o._helper?a.top:0)&&(o.size.height=o.size.height+(o._helper?o.position.top-a.top:o.position.top),l&&(o.size.width=o.size.height*o.aspectRatio),o.position.top=o._helper?a.top:0),o.offset.left=o.parentData.left+o.position.left,o.offset.top=o.parentData.top+o.position.top,n=Math.abs((o._helper?o.offset.left-c.left:o.offset.left-c.left)+o.sizeDiff.width),r=Math.abs((o._helper?o.offset.top-c.top:o.offset.top-a.top)+o.sizeDiff.height),i=o.containerElement.get(0)===o.element.parent().get(0),s=/relative|absolute/.test(o.containerElement.css("position")),i&&s&&(n-=o.parentData.left),n+o.size.width>=o.parentData.width&&(o.size.width=o.parentData.width-n,l&&(o.size.height=o.size.width/o.aspectRatio)),r+o.size.height>=o.parentData.height&&(o.size.height=o.parentData.height-r,l&&(o.size.width=o.size.height*o.aspectRatio))},stop:function(){var t=e(this).data("ui-resizable"),n=t.options,r=t.containerOffset,i=t.containerPosition,s=t.containerElement,o=e(t.helper),u=o.offset(),a=o.outerWidth()-t.sizeDiff.width,f=o.outerHeight()-t.sizeDiff.height;t._helper&&!n.animate&&/relative/.test(s.css("position"))&&e(this).css({left:u.left-i.left-r.left,width:a,height:f}),t._helper&&!n.animate&&/static/.test(s.css("position"))&&e(this).css({left:u.left-i.left-r.left,width:a,height:f})}}),e.ui.plugin.add("resizable","alsoResize",{start:function(){var t=e(this).data("ui-resizable"),n=t.options,r=function(t){e(t).each(function(){var t=e(this);t.data("ui-resizable-alsoresize",{width:parseInt(t.width(),10),height:parseInt(t.height(),10),left:parseInt(t.css("left"),10),top:parseInt(t.css("top"),10)})})};typeof n.alsoResize=="object"&&!n.alsoResize.parentNode?n.alsoResize.length?(n.alsoResize=n.alsoResize[0],r(n.alsoResize)):e.each(n.alsoResize,function(e){r(e)}):r(n.alsoResize)},resize:function(t,n){var r=e(this).data("ui-resizable"),i=r.options,s=r.originalSize,o=r.originalPosition,u={height:r.size.height-s.height||0,width:r.size.width-s.width||0,top:r.position.top-o.top||0,left:r.position.left-o.left||0},a=function(t,r){e(t).each(function(){var t=e(this),i=e(this).data("ui-resizable-alsoresize"),s={},o=r&&r.length?r:t.parents(n.originalElement[0]).length?["width","height"]:["width","height","top","left"];e.each(o,function(e,t){var n=(i[t]||0)+(u[t]||0);n&&n>=0&&(s[t]=n||null)}),t.css(s)})};typeof i.alsoResize=="object"&&!i.alsoResize.nodeType?e.each(i.alsoResize,function(e,t){a(e,t)}):a(i.alsoResize)},stop:function(){e(this).removeData("resizable-alsoresize")}}),e.ui.plugin.add("resizable","ghost",{start:function(){var t=e(this).data("ui-resizable"),n=t.options,r=t.size;t.ghost=t.originalElement.clone(),t.ghost.css({opacity:.25,display:"block",position:"relative",height:r.height,width:r.width,margin:0,left:0,top:0}).addClass("ui-resizable-ghost").addClass(typeof n.ghost=="string"?n.ghost:""),t.ghost.appendTo(t.helper)},resize:function(){var t=e(this).data("ui-resizable");t.ghost&&t.ghost.css({position:"relative",height:t.size.height,width:t.size.width})},stop:function(){var t=e(this).data("ui-resizable");t.ghost&&t.helper&&t.helper.get(0).removeChild(t.ghost.get(0))}}),e.ui.plugin.add("resizable","grid",{resize:function(){var t=e(this).data("ui-resizable"),n=t.options,r=t.size,i=t.originalSize,s=t.originalPosition,o=t.axis,u=typeof n.grid=="number"?[n.grid,n.grid]:n.grid,a=u[0]||1,f=u[1]||1,l=Math.round((r.width-i.width)/a)*a,c=Math.round((r.height-i.height)/f)*f,h=i.width+l,p=i.height+c,d=n.maxWidth&&n.maxWidth<h,v=n.maxHeight&&n.maxHeight<p,m=n.minWidth&&n.minWidth>h,g=n.minHeight&&n.minHeight>p;n.grid=u,m&&(h+=a),g&&(p+=f),d&&(h-=a),v&&(p-=f),/^(se|s|e)$/.test(o)?(t.size.width=h,t.size.height=p):/^(ne)$/.test(o)?(t.size.width=h,t.size.height=p,t.position.top=s.top-c):/^(sw)$/.test(o)?(t.size.width=h,t.size.height=p,t.position.left=s.left-l):(t.size.width=h,t.size.height=p,t.position.top=s.top-c,t.position.left=s.left-l)}})}(jQuery),function(e,t){e.widget("ui.selectable",e.ui.mouse,{version:"1.10.1",options:{appendTo:"body",autoRefresh:!0,distance:0,filter:"*",tolerance:"touch",selected:null,selecting:null,start:null,stop:null,unselected:null,unselecting:null},_create:function(){var t,n=this;this.element.addClass("ui-selectable"),this.dragged=!1,this.refresh=function(){t=e(n.options.filter,n.element[0]),t.addClass("ui-selectee"),t.each(function(){var t=e(this),n=t.offset();e.data(this,"selectable-item",{element:this,$element:t,left:n.left,top:n.top,right:n.left+t.outerWidth(),bottom:n.top+t.outerHeight(),startselected:!1,selected:t.hasClass("ui-selected"),selecting:t.hasClass("ui-selecting"),unselecting:t.hasClass("ui-unselecting")})})},this.refresh(),this.selectees=t.addClass("ui-selectee"),this._mouseInit(),this.helper=e("<div class='ui-selectable-helper'></div>")},_destroy:function(){this.selectees.removeClass("ui-selectee").removeData("selectable-item"),this.element.removeClass("ui-selectable ui-selectable-disabled"),this._mouseDestroy()},_mouseStart:function(t){var n=this,r=this.options;this.opos=[t.pageX,t.pageY];if(this.options.disabled)return;this.selectees=e(r.filter,this.element[0]),this._trigger("start",t),e(r.appendTo).append(this.helper),this.helper.css({left:t.pageX,top:t.pageY,width:0,height:0}),r.autoRefresh&&this.refresh(),this.selectees.filter(".ui-selected").each(function(){var r=e.data(this,"selectable-item");r.startselected=!0,!t.metaKey&&!t.ctrlKey&&(r.$element.removeClass("ui-selected"),r.selected=!1,r.$element.addClass("ui-unselecting"),r.unselecting=!0,n._trigger("unselecting",t,{unselecting:r.element}))}),e(t.target).parents().addBack().each(function(){var r,i=e.data(this,"selectable-item");if(i)return r=!t.metaKey&&!t.ctrlKey||!i.$element.hasClass("ui-selected"),i.$element.removeClass(r?"ui-unselecting":"ui-selected").addClass(r?"ui-selecting":"ui-unselecting"),i.unselecting=!r,i.selecting=r,i.selected=r,r?n._trigger("selecting",t,{selecting:i.element}):n._trigger("unselecting",t,{unselecting:i.element}),!1})},_mouseDrag:function(t){this.dragged=!0;if(this.options.disabled)return;var n,r=this,i=this.options,s=this.opos[0],o=this.opos[1],u=t.pageX,a=t.pageY;return s>u&&(n=u,u=s,s=n),o>a&&(n=a,a=o,o=n),this.helper.css({left:s,top:o,width:u-s,height:a-o}),this.selectees.each(function(){var n=e.data(this,"selectable-item"),f=!1;if(!n||n.element===r.element[0])return;i.tolerance==="touch"?f=!(n.left>u||n.right<s||n.top>a||n.bottom<o):i.tolerance==="fit"&&(f=n.left>s&&n.right<u&&n.top>o&&n.bottom<a),f?(n.selected&&(n.$element.removeClass("ui-selected"),n.selected=!1),n.unselecting&&(n.$element.removeClass("ui-unselecting"),n.unselecting=!1),n.selecting||(n.$element.addClass("ui-selecting"),n.selecting=!0,r._trigger("selecting",t,{selecting:n.element}))):(n.selecting&&((t.metaKey||t.ctrlKey)&&n.startselected?(n.$element.removeClass("ui-selecting"),n.selecting=!1,n.$element.addClass("ui-selected"),n.selected=!0):(n.$element.removeClass("ui-selecting"),n.selecting=!1,n.startselected&&(n.$element.addClass("ui-unselecting"),n.unselecting=!0),r._trigger("unselecting",t,{unselecting:n.element}))),n.selected&&!t.metaKey&&!t.ctrlKey&&!n.startselected&&(n.$element.removeClass("ui-selected"),n.selected=!1,n.$element.addClass("ui-unselecting"),n.unselecting=!0,r._trigger("unselecting",t,{unselecting:n.element})))}),!1},_mouseStop:function(t){var n=this;return this.dragged=!1,e(".ui-unselecting",this.element[0]).each(function(){var r=e.data(this,"selectable-item");r.$element.removeClass("ui-unselecting"),r.unselecting=!1,r.startselected=!1,n._trigger("unselected",t,{unselected:r.element})}),e(".ui-selecting",this.element[0]).each(function(){var r=e.data(this,"selectable-item");r.$element.removeClass("ui-selecting").addClass("ui-selected"),r.selecting=!1,r.selected=!0,r.startselected=!0,n._trigger("selected",t,{selected:r.element})}),this._trigger("stop",t),this.helper.remove(),!1}})}(jQuery),function(e,t){function n(e,t,n){return e>t&&e<t+n}e.widget("ui.sortable",e.ui.mouse,{version:"1.10.1",widgetEventPrefix:"sort",ready:!1,options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3,activate:null,beforeStop:null,change:null,deactivate:null,out:null,over:null,receive:null,remove:null,sort:null,start:null,stop:null,update:null},_create:function(){var e=this.options;this.containerCache={},this.element.addClass("ui-sortable"),this.refresh(),this.floating=this.items.length?e.axis==="x"||/left|right/.test(this.items[0].item.css("float"))||/inline|table-cell/.test(this.items[0].item.css("display")):!1,this.offset=this.element.offset(),this._mouseInit(),this.ready=!0},_destroy:function(){this.element.removeClass("ui-sortable ui-sortable-disabled"),this._mouseDestroy();for(var e=this.items.length-1;e>=0;e--)this.items[e].item.removeData(this.widgetName+"-item");return this},_setOption:function(t,n){t==="disabled"?(this.options[t]=n,this.widget().toggleClass("ui-sortable-disabled",!!n)):e.Widget.prototype._setOption.apply(this,arguments)},_mouseCapture:function(t,n){var r=null,i=!1,s=this;if(this.reverting)return!1;if(this.options.disabled||this.options.type==="static")return!1;this._refreshItems(t),e(t.target).parents().each(function(){if(e.data(this,s.widgetName+"-item")===s)return r=e(this),!1}),e.data(t.target,s.widgetName+"-item")===s&&(r=e(t.target));if(!r)return!1;if(this.options.handle&&!n){e(this.options.handle,r).find("*").addBack().each(function(){this===t.target&&(i=!0)});if(!i)return!1}return this.currentItem=r,this._removeCurrentsFromItems(),!0},_mouseStart:function(t,n,r){var i,s=this.options;this.currentContainer=this,this.refreshPositions(),this.helper=this._createHelper(t),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},e.extend(this.offset,{click:{left:t.pageX-this.offset.left,top:t.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),this.originalPosition=this._generatePosition(t),this.originalPageX=t.pageX,this.originalPageY=t.pageY,s.cursorAt&&this._adjustOffsetFromHelper(s.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!==this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),s.containment&&this._setContainment(),s.cursor&&(e("body").css("cursor")&&(this._storedCursor=e("body").css("cursor")),e("body").css("cursor",s.cursor)),s.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",s.opacity)),s.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",s.zIndex)),this.scrollParent[0]!==document&&this.scrollParent[0].tagName!=="HTML"&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",t,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions();if(!r)for(i=this.containers.length-1;i>=0;i--)this.containers[i]._trigger("activate",t,this._uiHash(this));return e.ui.ddmanager&&(e.ui.ddmanager.current=this),e.ui.ddmanager&&!s.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t),this.dragging=!0,this.helper.addClass("ui-sortable-helper"),this._mouseDrag(t),!0},_mouseDrag:function(t){var n,r,i,s,o=this.options,u=!1;this.position=this._generatePosition(t),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs),this.options.scroll&&(this.scrollParent[0]!==document&&this.scrollParent[0].tagName!=="HTML"?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-t.pageY<o.scrollSensitivity?this.scrollParent[0].scrollTop=u=this.scrollParent[0].scrollTop+o.scrollSpeed:t.pageY-this.overflowOffset.top<o.scrollSensitivity&&(this.scrollParent[0].scrollTop=u=this.scrollParent[0].scrollTop-o.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-t.pageX<o.scrollSensitivity?this.scrollParent[0].scrollLeft=u=this.scrollParent[0].scrollLeft+o.scrollSpeed:t.pageX-this.overflowOffset.left<o.scrollSensitivity&&(this.scrollParent[0].scrollLeft=u=this.scrollParent[0].scrollLeft-o.scrollSpeed)):(t.pageY-e(document).scrollTop()<o.scrollSensitivity?u=e(document).scrollTop(e(document).scrollTop()-o.scrollSpeed):e(window).height()-(t.pageY-e(document).scrollTop())<o.scrollSensitivity&&(u=e(document).scrollTop(e(document).scrollTop()+o.scrollSpeed)),t.pageX-e(document).scrollLeft()<o.scrollSensitivity?u=e(document).scrollLeft(e(document).scrollLeft()-o.scrollSpeed):e(window).width()-(t.pageX-e(document).scrollLeft())<o.scrollSensitivity&&(u=e(document).scrollLeft(e(document).scrollLeft()+o.scrollSpeed))),u!==!1&&e.ui.ddmanager&&!o.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t)),this.positionAbs=this._convertPositionTo("absolute");if(!this.options.axis||this.options.axis!=="y")this.helper[0].style.left=this.position.left+"px";if(!this.options.axis||this.options.axis!=="x")this.helper[0].style.top=this.position.top+"px";for(n=this.items.length-1;n>=0;n--){r=this.items[n],i=r.item[0],s=this._intersectsWithPointer(r);if(!s)continue;if(r.instance!==this.currentContainer)continue;if(i!==this.currentItem[0]&&this.placeholder[s===1?"next":"prev"]()[0]!==i&&!e.contains(this.placeholder[0],i)&&(this.options.type==="semi-dynamic"?!e.contains(this.element[0],i):!0)){this.direction=s===1?"down":"up";if(this.options.tolerance!=="pointer"&&!this._intersectsWithSides(r))break;this._rearrange(t,r),this._trigger("change",t,this._uiHash());break}}return this._contactContainers(t),e.ui.ddmanager&&e.ui.ddmanager.drag(this,t),this._trigger("sort",t,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(t,n){if(!t)return;e.ui.ddmanager&&!this.options.dropBehaviour&&e.ui.ddmanager.drop(this,t);if(this.options.revert){var r=this,i=this.placeholder.offset();this.reverting=!0,e(this.helper).animate({left:i.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]===document.body?0:this.offsetParent[0].scrollLeft),top:i.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]===document.body?0:this.offsetParent[0].scrollTop)},parseInt(this.options.revert,10)||500,function(){r._clear(t)})}else this._clear(t,n);return!1},cancel:function(){if(this.dragging){this._mouseUp({target:null}),this.options.helper==="original"?this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper"):this.currentItem.show();for(var t=this.containers.length-1;t>=0;t--)this.containers[t]._trigger("deactivate",null,this._uiHash(this)),this.containers[t].containerCache.over&&(this.containers[t]._trigger("out",null,this._uiHash(this)),this.containers[t].containerCache.over=0)}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.options.helper!=="original"&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),e.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?e(this.domPosition.prev).after(this.currentItem):e(this.domPosition.parent).prepend(this.currentItem)),this},serialize:function(t){var n=this._getItemsAsjQuery(t&&t.connected),r=[];return t=t||{},e(n).each(function(){var n=(e(t.item||this).attr(t.attribute||"id")||"").match(t.expression||/(.+)[\-=_](.+)/);n&&r.push((t.key||n[1]+"[]")+"="+(t.key&&t.expression?n[1]:n[2]))}),!r.length&&t.key&&r.push(t.key+"="),r.join("&")},toArray:function(t){var n=this._getItemsAsjQuery(t&&t.connected),r=[];return t=t||{},n.each(function(){r.push(e(t.item||this).attr(t.attribute||"id")||"")}),r},_intersectsWith:function(e){var t=this.positionAbs.left,n=t+this.helperProportions.width,r=this.positionAbs.top,i=r+this.helperProportions.height,s=e.left,o=s+e.width,u=e.top,a=u+e.height,f=this.offset.click.top,l=this.offset.click.left,c=r+f>u&&r+f<a&&t+l>s&&t+l<o;return this.options.tolerance==="pointer"||this.options.forcePointerForContainers||this.options.tolerance!=="pointer"&&this.helperProportions[this.floating?"width":"height"]>e[this.floating?"width":"height"]?c:s<t+this.helperProportions.width/2&&n-this.helperProportions.width/2<o&&u<r+this.helperProportions.height/2&&i-this.helperProportions.height/2<a},_intersectsWithPointer:function(e){var t=this.options.axis==="x"||n(this.positionAbs.top+this.offset.click.top,e.top,e.height),r=this.options.axis==="y"||n(this.positionAbs.left+this.offset.click.left,e.left,e.width),i=t&&r,s=this._getDragVerticalDirection(),o=this._getDragHorizontalDirection();return i?this.floating?o&&o==="right"||s==="down"?2:1:s&&(s==="down"?2:1):!1},_intersectsWithSides:function(e){var t=n(this.positionAbs.top+this.offset.click.top,e.top+e.height/2,e.height),r=n(this.positionAbs.left+this.offset.click.left,e.left+e.width/2,e.width),i=this._getDragVerticalDirection(),s=this._getDragHorizontalDirection();return this.floating&&s?s==="right"&&r||s==="left"&&!r:i&&(i==="down"&&t||i==="up"&&!t)},_getDragVerticalDirection:function(){var e=this.positionAbs.top-this.lastPositionAbs.top;return e!==0&&(e>0?"down":"up")},_getDragHorizontalDirection:function(){var e=this.positionAbs.left-this.lastPositionAbs.left;return e!==0&&(e>0?"right":"left")},refresh:function(e){return this._refreshItems(e),this.refreshPositions(),this},_connectWith:function(){var e=this.options;return e.connectWith.constructor===String?[e.connectWith]:e.connectWith},_getItemsAsjQuery:function(t){var n,r,i,s,o=[],u=[],a=this._connectWith();if(a&&t)for(n=a.length-1;n>=0;n--){i=e(a[n]);for(r=i.length-1;r>=0;r--)s=e.data(i[r],this.widgetFullName),s&&s!==this&&!s.options.disabled&&u.push([e.isFunction(s.options.items)?s.options.items.call(s.element):e(s.options.items,s.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),s])}u.push([e.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):e(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]);for(n=u.length-1;n>=0;n--)u[n][0].each(function(){o.push(this)});return e(o)},_removeCurrentsFromItems:function(){var t=this.currentItem.find(":data("+this.widgetName+"-item)");this.items=e.grep(this.items,function(e){for(var n=0;n<t.length;n++)if(t[n]===e.item[0])return!1;return!0})},_refreshItems:function(t){this.items=[],this.containers=[this];var n,r,i,s,o,u,a,f,l=this.items,c=[[e.isFunction(this.options.items)?this.options.items.call(this.element[0],t,{item:this.currentItem}):e(this.options.items,this.element),this]],h=this._connectWith();if(h&&this.ready)for(n=h.length-1;n>=0;n--){i=e(h[n]);for(r=i.length-1;r>=0;r--)s=e.data(i[r],this.widgetFullName),s&&s!==this&&!s.options.disabled&&(c.push([e.isFunction(s.options.items)?s.options.items.call(s.element[0],t,{item:this.currentItem}):e(s.options.items,s.element),s]),this.containers.push(s))}for(n=c.length-1;n>=0;n--){o=c[n][1],u=c[n][0];for(r=0,f=u.length;r<f;r++)a=e(u[r]),a.data(this.widgetName+"-item",o),l.push({item:a,instance:o,width:0,height:0,left:0,top:0})}},refreshPositions:function(t){this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset());var n,r,i,s;for(n=this.items.length-1;n>=0;n--){r=this.items[n];if(r.instance!==this.currentContainer&&this.currentContainer&&r.item[0]!==this.currentItem[0])continue;i=this.options.toleranceElement?e(this.options.toleranceElement,r.item):r.item,t||(r.width=i.outerWidth(),r.height=i.outerHeight()),s=i.offset(),r.left=s.left,r.top=s.top}if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(n=this.containers.length-1;n>=0;n--)s=this.containers[n].element.offset(),this.containers[n].containerCache.left=s.left,this.containers[n].containerCache.top=s.top,this.containers[n].containerCache.width=this.containers[n].element.outerWidth(),this.containers[n].containerCache.height=this.containers[n].element.outerHeight();return this},_createPlaceholder:function(t){t=t||this;var n,r=t.options;if(!r.placeholder||r.placeholder.constructor===String)n=r.placeholder,r.placeholder={element:function(){var r=e(document.createElement(t.currentItem[0].nodeName)).addClass(n||t.currentItem[0].className+" ui-sortable-placeholder").removeClass("ui-sortable-helper")[0];return n||(r.style.visibility="hidden"),r},update:function(e,i){if(n&&!r.forcePlaceholderSize)return;i.height()||i.height(t.currentItem.innerHeight()-parseInt(t.currentItem.css("paddingTop")||0,10)-parseInt(t.currentItem.css("paddingBottom")||0,10)),i.width()||i.width(t.currentItem.innerWidth()-parseInt(t.currentItem.css("paddingLeft")||0,10)-parseInt(t.currentItem.css("paddingRight")||0,10))}};t.placeholder=e(r.placeholder.element.call(t.element,t.currentItem)),t.currentItem.after(t.placeholder),r.placeholder.update(t,t.placeholder)},_contactContainers:function(t){var n,r,i,s,o,u,a,f,l,c=null,h=null;for(n=this.containers.length-1;n>=0;n--){if(e.contains(this.currentItem[0],this.containers[n].element[0]))continue;if(this._intersectsWith(this.containers[n].containerCache)){if(c&&e.contains(this.containers[n].element[0],c.element[0]))continue;c=this.containers[n],h=n}else this.containers[n].containerCache.over&&(this.containers[n]._trigger("out",t,this._uiHash(this)),this.containers[n].containerCache.over=0)}if(!c)return;if(this.containers.length===1)this.containers[h]._trigger("over",t,this._uiHash(this)),this.containers[h].containerCache.over=1;else{i=1e4,s=null,o=this.containers[h].floating?"left":"top",u=this.containers[h].floating?"width":"height",a=this.positionAbs[o]+this.offset.click[o];for(r=this.items.length-1;r>=0;r--){if(!e.contains(this.containers[h].element[0],this.items[r].item[0]))continue;if(this.items[r].item[0]===this.currentItem[0])continue;f=this.items[r].item.offset()[o],l=!1,Math.abs(f-a)>Math.abs(f+this.items[r][u]-a)&&(l=!0,f+=this.items[r][u]),Math.abs(f-a)<i&&(i=Math.abs(f-a),s=this.items[r],this.direction=l?"up":"down")}if(!s&&!this.options.dropOnEmpty)return;this.currentContainer=this.containers[h],s?this._rearrange(t,s,null,!0):this._rearrange(t,null,this.containers[h].element,!0),this._trigger("change",t,this._uiHash()),this.containers[h]._trigger("change",t,this._uiHash(this)),this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[h]._trigger("over",t,this._uiHash(this)),this.containers[h].containerCache.over=1}},_createHelper:function(t){var n=this.options,r=e.isFunction(n.helper)?e(n.helper.apply(this.element[0],[t,this.currentItem])):n.helper==="clone"?this.currentItem.clone():this.currentItem;return r.parents("body").length||e(n.appendTo!=="parent"?n.appendTo:this.currentItem[0].parentNode)[0].appendChild(r[0]),r[0]===this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),(!r[0].style.width||n.forceHelperSize)&&r.width(this.currentItem.width()),(!r[0].style.height||n.forceHelperSize)&&r.height(this.currentItem.height()),r},_adjustOffsetFromHelper:function(t){typeof t=="string"&&(t=t.split(" ")),e.isArray(t)&&(t={left:+t[0],top:+t[1]||0}),"left"in t&&(this.offset.click.left=t.left+this.margins.left),"right"in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left),"top"in t&&(this.offset.click.top=t.top+this.margins.top),"bottom"in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var t=this.offsetParent.offset();this.cssPosition==="absolute"&&this.scrollParent[0]!==document&&e.contains(this.scrollParent[0],this.offsetParent[0])&&(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop());if(this.offsetParent[0]===document.body||this.offsetParent[0].tagName&&this.offsetParent[0].tagName.toLowerCase()==="html"&&e.ui.ie)t={top:0,left:0};return{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if(this.cssPosition==="relative"){var e=this.currentItem.position();return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:e.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var t,n,r,i=this.options;i.containment==="parent"&&(i.containment=this.helper[0].parentNode);if(i.containment==="document"||i.containment==="window")this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,e(i.containment==="document"?document:window).width()-this.helperProportions.width-this.margins.left,(e(i.containment==="document"?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top];/^(document|window|parent)$/.test(i.containment)||(t=e(i.containment)[0],n=e(i.containment).offset(),r=e(t).css("overflow")!=="hidden",this.containment=[n.left+(parseInt(e(t).css("borderLeftWidth"),10)||0)+(parseInt(e(t).css("paddingLeft"),10)||0)-this.margins.left,n.top+(parseInt(e(t).css("borderTopWidth"),10)||0)+(parseInt(e(t).css("paddingTop"),10)||0)-this.margins.top,n.left+(r?Math.max(t.scrollWidth,t.offsetWidth):t.offsetWidth)-(parseInt(e(t).css("borderLeftWidth"),10)||0)-(parseInt(e(t).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,n.top+(r?Math.max(t.scrollHeight,t.offsetHeight):t.offsetHeight)-(parseInt(e(t).css("borderTopWidth"),10)||0)-(parseInt(e(t).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top])},_convertPositionTo:function(t,n){n||(n=this.position);var r=t==="absolute"?1:-1,i=this.cssPosition!=="absolute"||this.scrollParent[0]!==document&&!!e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,s=/(html|body)/i.test(i[0].tagName);return{top:n.top+this.offset.relative.top*r+this.offset.parent.top*r-(this.cssPosition==="fixed"?-this.scrollParent.scrollTop():s?0:i.scrollTop())*r,left:n.left+this.offset.relative.left*r+this.offset.parent.left*r-(this.cssPosition==="fixed"?-this.scrollParent.scrollLeft():s?0:i.scrollLeft())*r}},_generatePosition:function(t){var n,r,i=this.options,s=t.pageX,o=t.pageY,u=this.cssPosition!=="absolute"||this.scrollParent[0]!==document&&!!e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,a=/(html|body)/i.test(u[0].tagName);return this.cssPosition==="relative"&&(this.scrollParent[0]===document||this.scrollParent[0]===this.offsetParent[0])&&(this.offset.relative=this._getRelativeOffset()),this.originalPosition&&(this.containment&&(t.pageX-this.offset.click.left<this.containment[0]&&(s=this.containment[0]+this.offset.click.left),t.pageY-this.offset.click.top<this.containment[1]&&(o=this.containment[1]+this.offset.click.top),t.pageX-this.offset.click.left>this.containment[2]&&(s=this.containment[2]+this.offset.click.left),t.pageY-this.offset.click.top>this.containment[3]&&(o=this.containment[3]+this.offset.click.top)),i.grid&&(n=this.originalPageY+Math.round((o-this.originalPageY)/i.grid[1])*i.grid[1],o=this.containment?n-this.offset.click.top>=this.containment[1]&&n-this.offset.click.top<=this.containment[3]?n:n-this.offset.click.top>=this.containment[1]?n-i.grid[1]:n+i.grid[1]:n,r=this.originalPageX+Math.round((s-this.originalPageX)/i.grid[0])*i.grid[0],s=this.containment?r-this.offset.click.left>=this.containment[0]&&r-this.offset.click.left<=this.containment[2]?r:r-this.offset.click.left>=this.containment[0]?r-i.grid[0]:r+i.grid[0]:r)),{top:o-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+(this.cssPosition==="fixed"?-this.scrollParent.scrollTop():a?0:u.scrollTop()),left:s-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+(this.cssPosition==="fixed"?-this.scrollParent.scrollLeft():a?0:u.scrollLeft())}},_rearrange:function(e,t,n,r){n?n[0].appendChild(this.placeholder[0]):t.item[0].parentNode.insertBefore(this.placeholder[0],this.direction==="down"?t.item[0]:t.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var i=this.counter;this._delay(function(){i===this.counter&&this.refreshPositions(!r)})},_clear:function(t,n){this.reverting=!1;var r,i=[];!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem),this._noFinalSort=null;if(this.helper[0]===this.currentItem[0]){for(r in this._storedCSS)if(this._storedCSS[r]==="auto"||this._storedCSS[r]==="static")this._storedCSS[r]="";this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")}else this.currentItem.show();this.fromOutside&&!n&&i.push(function(e){this._trigger("receive",e,this._uiHash(this.fromOutside))}),(this.fromOutside||this.domPosition.prev!==this.currentItem.prev().not(".ui-sortable-helper")[0]||this.domPosition.parent!==this.currentItem.parent()[0])&&!n&&i.push(function(e){this._trigger("update",e,this._uiHash())}),this!==this.currentContainer&&(n||(i.push(function(e){this._trigger("remove",e,this._uiHash())}),i.push(function(e){return function(t){e._trigger("receive",t,this._uiHash(this))}}.call(this,this.currentContainer)),i.push(function(e){return function(t){e._trigger("update",t,this._uiHash(this))}}.call(this,this.currentContainer))));for(r=this.containers.length-1;r>=0;r--)n||i.push(function(e){return function(t){e._trigger("deactivate",t,this._uiHash(this))}}.call(this,this.containers[r])),this.containers[r].containerCache.over&&(i.push(function(e){return function(t){e._trigger("out",t,this._uiHash(this))}}.call(this,this.containers[r])),this.containers[r].containerCache.over=0);this._storedCursor&&e("body").css("cursor",this._storedCursor),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),this._storedZIndex&&this.helper.css("zIndex",this._storedZIndex==="auto"?"":this._storedZIndex),this.dragging=!1;if(this.cancelHelperRemoval){if(!n){this._trigger("beforeStop",t,this._uiHash());for(r=0;r<i.length;r++)i[r].call(this,t);this._trigger("stop",t,this._uiHash())}return this.fromOutside=!1,!1}n||this._trigger("beforeStop",t,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.helper[0]!==this.currentItem[0]&&this.helper.remove(),this.helper=null;if(!n){for(r=0;r<i.length;r++)i[r].call(this,t);this._trigger("stop",t,this._uiHash())}return this.fromOutside=!1,!0},_trigger:function(){e.Widget.prototype._trigger.apply(this,arguments)===!1&&this.cancel()},_uiHash:function(t){var n=t||this;return{helper:n.helper,placeholder:n.placeholder||e([]),position:n.position,originalPosition:n.originalPosition,offset:n.positionAbs,item:n.currentItem,sender:t?t.element:null}}})}(jQuery),jQuery.effects||function(e,t){var n="ui-effects-";e.effects={effect:{}},function(e,t){function h(e,t,n){var r=u[t.type]||{};return e==null?n||!t.def?null:t.def:(e=r.floor?~~e:parseFloat(e),isNaN(e)?t.def:r.mod?(e+r.mod)%r.mod:0>e?0:r.max<e?r.max:e)}function p(t){var n=s(),r=n._rgba=[];return t=t.toLowerCase(),c(i,function(e,i){var s,u=i.re.exec(t),a=u&&i.parse(u),f=i.space||"rgba";if(a)return s=n[f](a),n[o[f].cache]=s[o[f].cache],r=n._rgba=s._rgba,!1}),r.length?(r.join()==="0,0,0,0"&&e.extend(r,l.transparent),n):l[t]}function d(e,t,n){return n=(n+1)%1,n*6<1?e+(t-e)*n*6:n*2<1?t:n*3<2?e+(t-e)*(2/3-n)*6:e}var n="backgroundColor borderBottomColor borderLeftColor borderRightColor borderTopColor color columnRuleColor outlineColor textDecorationColor textEmphasisColor",r=/^([\-+])=\s*(\d+\.?\d*)/,i=[{re:/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(e){return[e[1],e[2],e[3],e[4]]}},{re:/rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(e){return[e[1]*2.55,e[2]*2.55,e[3]*2.55,e[4]]}},{re:/#([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})/,parse:function(e){return[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16)]}},{re:/#([a-f0-9])([a-f0-9])([a-f0-9])/,parse:function(e){return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)]}},{re:/hsla?\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,space:"hsla",parse:function(e){return[e[1],e[2]/100,e[3]/100,e[4]]}}],s=e.Color=function(t,n,r,i){return new e.Color.fn.parse(t,n,r,i)},o={rgba:{props:{red:{idx:0,type:"byte"},green:{idx:1,type:"byte"},blue:{idx:2,type:"byte"}}},hsla:{props:{hue:{idx:0,type:"degrees"},saturation:{idx:1,type:"percent"},lightness:{idx:2,type:"percent"}}}},u={"byte":{floor:!0,max:255},percent:{max:1},degrees:{mod:360,floor:!0}},a=s.support={},f=e("<p>")[0],l,c=e.each;f.style.cssText="background-color:rgba(1,1,1,.5)",a.rgba=f.style.backgroundColor.indexOf("rgba")>-1,c(o,function(e,t){t.cache="_"+e,t.props.alpha={idx:3,type:"percent",def:1}}),s.fn=e.extend(s.prototype,{parse:function(n,r,i,u){if(n===t)return this._rgba=[null,null,null,null],this;if(n.jquery||n.nodeType)n=e(n).css(r),r=t;var a=this,f=e.type(n),d=this._rgba=[];r!==t&&(n=[n,r,i,u],f="array");if(f==="string")return this.parse(p(n)||l._default);if(f==="array")return c(o.rgba.props,function(e,t){d[t.idx]=h(n[t.idx],t)}),this;if(f==="object")return n instanceof s?c(o,function(e,t){n[t.cache]&&(a[t.cache]=n[t.cache].slice())}):c(o,function(t,r){var i=r.cache;c(r.props,function(e,t){if(!a[i]&&r.to){if(e==="alpha"||n[e]==null)return;a[i]=r.to(a._rgba)}a[i][t.idx]=h(n[e],t,!0)}),a[i]&&e.inArray(null,a[i].slice(0,3))<0&&(a[i][3]=1,r.from&&(a._rgba=r.from(a[i])))}),this},is:function(e){var t=s(e),n=!0,r=this;return c(o,function(e,i){var s,o=t[i.cache];return o&&(s=r[i.cache]||i.to&&i.to(r._rgba)||[],c(i.props,function(e,t){if(o[t.idx]!=null)return n=o[t.idx]===s[t.idx],n})),n}),n},_space:function(){var e=[],t=this;return c(o,function(n,r){t[r.cache]&&e.push(n)}),e.pop()},transition:function(e,t){var n=s(e),r=n._space(),i=o[r],a=this.alpha()===0?s("transparent"):this,f=a[i.cache]||i.to(a._rgba),l=f.slice();return n=n[i.cache],c(i.props,function(e,r){var i=r.idx,s=f[i],o=n[i],a=u[r.type]||{};if(o===null)return;s===null?l[i]=o:(a.mod&&(o-s>a.mod/2?s+=a.mod:s-o>a.mod/2&&(s-=a.mod)),l[i]=h((o-s)*t+s,r))}),this[r](l)},blend:function(t){if(this._rgba[3]===1)return this;var n=this._rgba.slice(),r=n.pop(),i=s(t)._rgba;return s(e.map(n,function(e,t){return(1-r)*i[t]+r*e}))},toRgbaString:function(){var t="rgba(",n=e.map(this._rgba,function(e,t){return e==null?t>2?1:0:e});return n[3]===1&&(n.pop(),t="rgb("),t+n.join()+")"},toHslaString:function(){var t="hsla(",n=e.map(this.hsla(),function(e,t){return e==null&&(e=t>2?1:0),t&&t<3&&(e=Math.round(e*100)+"%"),e});return n[3]===1&&(n.pop(),t="hsl("),t+n.join()+")"},toHexString:function(t){var n=this._rgba.slice(),r=n.pop();return t&&n.push(~~(r*255)),"#"+e.map(n,function(e){return e=(e||0).toString(16),e.length===1?"0"+e:e}).join("")},toString:function(){return this._rgba[3]===0?"transparent":this.toRgbaString()}}),s.fn.parse.prototype=s.fn,o.hsla.to=function(e){if(e[0]==null||e[1]==null||e[2]==null)return[null,null,null,e[3]];var t=e[0]/255,n=e[1]/255,r=e[2]/255,i=e[3],s=Math.max(t,n,r),o=Math.min(t,n,r),u=s-o,a=s+o,f=a*.5,l,c;return o===s?l=0:t===s?l=60*(n-r)/u+360:n===s?l=60*(r-t)/u+120:l=60*(t-n)/u+240,u===0?c=0:f<=.5?c=u/a:c=u/(2-a),[Math.round(l)%360,c,f,i==null?1:i]},o.hsla.from=function(e){if(e[0]==null||e[1]==null||e[2]==null)return[null,null,null,e[3]];var t=e[0]/360,n=e[1],r=e[2],i=e[3],s=r<=.5?r*(1+n):r+n-r*n,o=2*r-s;return[Math.round(d(o,s,t+1/3)*255),Math.round(d(o,s,t)*255),Math.round(d(o,s,t-1/3)*255),i]},c(o,function(n,i){var o=i.props,u=i.cache,a=i.to,f=i.from;s.fn[n]=function(n){a&&!this[u]&&(this[u]=a(this._rgba));if(n===t)return this[u].slice();var r,i=e.type(n),l=i==="array"||i==="object"?n:arguments,p=this[u].slice();return c(o,function(e,t){var n=l[i==="object"?e:t.idx];n==null&&(n=p[t.idx]),p[t.idx]=h(n,t)}),f?(r=s(f(p)),r[u]=p,r):s(p)},c(o,function(t,i){if(s.fn[t])return;s.fn[t]=function(s){var o=e.type(s),u=t==="alpha"?this._hsla?"hsla":"rgba":n,a=this[u](),f=a[i.idx],l;return o==="undefined"?f:(o==="function"&&(s=s.call(this,f),o=e.type(s)),s==null&&i.empty?this:(o==="string"&&(l=r.exec(s),l&&(s=f+parseFloat(l[2])*(l[1]==="+"?1:-1))),a[i.idx]=s,this[u](a)))}})}),s.hook=function(t){var n=t.split(" ");c(n,function(t,n){e.cssHooks[n]={set:function(t,r){var i,o,u="";if(r!=="transparent"&&(e.type(r)!=="string"||(i=p(r)))){r=s(i||r);if(!a.rgba&&r._rgba[3]!==1){o=n==="backgroundColor"?t.parentNode:t;while((u===""||u==="transparent")&&o&&o.style)try{u=e.css(o,"backgroundColor"),o=o.parentNode}catch(f){}r=r.blend(u&&u!=="transparent"?u:"_default")}r=r.toRgbaString()}try{t.style[n]=r}catch(f){}}},e.fx.step[n]=function(t){t.colorInit||(t.start=s(t.elem,n),t.end=s(t.end),t.colorInit=!0),e.cssHooks[n].set(t.elem,t.start.transition(t.end,t.pos))}})},s.hook(n),e.cssHooks.borderColor={expand:function(e){var t={};return c(["Top","Right","Bottom","Left"],function(n,r){t["border"+r+"Color"]=e}),t}},l=e.Color.names={aqua:"#00ffff",black:"#000000",blue:"#0000ff",fuchsia:"#ff00ff",gray:"#808080",green:"#008000",lime:"#00ff00",maroon:"#800000",navy:"#000080",olive:"#808000",purple:"#800080",red:"#ff0000",silver:"#c0c0c0",teal:"#008080",white:"#ffffff",yellow:"#ffff00",transparent:[null,null,null,0],_default:"#ffffff"}}(jQuery),function(){function i(t){var n,r,i=t.ownerDocument.defaultView?t.ownerDocument.defaultView.getComputedStyle(t,null):t.currentStyle,s={};if(i&&i.length&&i[0]&&i[i[0]]){r=i.length;while(r--)n=i[r],typeof i[n]=="string"&&(s[e.camelCase(n)]=i[n])}else for(n in i)typeof i[n]=="string"&&(s[n]=i[n]);return s}function s(t,n){var i={},s,o;for(s in n)o=n[s],t[s]!==o&&!r[s]&&(e.fx.step[s]||!isNaN(parseFloat(o)))&&(i[s]=o);return i}var n=["add","remove","toggle"],r={border:1,borderBottom:1,borderColor:1,borderLeft:1,borderRight:1,borderTop:1,borderWidth:1,margin:1,padding:1};e.each(["borderLeftStyle","borderRightStyle","borderBottomStyle","borderTopStyle"],function(t,n){e.fx.step[n]=function(e){if(e.end!=="none"&&!e.setAttr||e.pos===1&&!e.setAttr)jQuery.style(e.elem,n,e.end),e.setAttr=!0}}),e.fn.addBack||(e.fn.addBack=function(e){return this.add(e==null?this.prevObject:this.prevObject.filter(e))}),e.effects.animateClass=function(t,r,o,u){var a=e.speed(r,o,u);return this.queue(function(){var r=e(this),o=r.attr("class")||"",u,f=a.children?r.find("*").addBack():r;f=f.map(function(){var t=e(this);return{el:t,start:i(this)}}),u=function(){e.each(n,function(e,n){t[n]&&r[n+"Class"](t[n])})},u(),f=f.map(function(){return this.end=i(this.el[0]),this.diff=s(this.start,this.end),this}),r.attr("class",o),f=f.map(function(){var t=this,n=e.Deferred(),r=e.extend({},a,{queue:!1,complete:function(){n.resolve(t)}});return this.el.animate(this.diff,r),n.promise()}),e.when.apply(e,f.get()).done(function(){u(),e.each(arguments,function(){var t=this.el;e.each(this.diff,function(e){t.css(e,"")})}),a.complete.call(r[0])})})},e.fn.extend({_addClass:e.fn.addClass,addClass:function(t,n,r,i){return n?e.effects.animateClass.call(this,{add:t},n,r,i):this._addClass(t)},_removeClass:e.fn.removeClass,removeClass:function(t,n,r,i){return arguments.length>1?e.effects.animateClass.call(this,{remove:t},n,r,i):this._removeClass.apply(this,arguments)},_toggleClass:e.fn.toggleClass,toggleClass:function(n,r,i,s,o){return typeof r=="boolean"||r===t?i?e.effects.animateClass.call(this,r?{add:n}:{remove:n},i,s,o):this._toggleClass(n,r):e.effects.animateClass.call(this,{toggle:n},r,i,s)},switchClass:function(t,n,r,i,s){return e.effects.animateClass.call(this,{add:n,remove:t},r,i,s)}})}(),function(){function r(t,n,r,i){e.isPlainObject(t)&&(n=t,t=t.effect),t={effect:t},n==null&&(n={}),e.isFunction(n)&&(i=n,r=null,n={});if(typeof n=="number"||e.fx.speeds[n])i=r,r=n,n={};return e.isFunction(r)&&(i=r,r=null),n&&e.extend(t,n),r=r||n.duration,t.duration=e.fx.off?0:typeof r=="number"?r:r in e.fx.speeds?e.fx.speeds[r]:e.fx.speeds._default,t.complete=i||n.complete,t}function i(t){return!t||typeof t=="number"||e.fx.speeds[t]?!0:typeof t=="string"&&!e.effects.effect[t]}e.extend(e.effects,{version:"1.10.1",save:function(e,t){for(var r=0;r<t.length;r++)t[r]!==null&&e.data(n+t[r],e[0].style[t[r]])},restore:function(e,r){var i,s;for(s=0;s<r.length;s++)r[s]!==null&&(i=e.data(n+r[s]),i===t&&(i=""),e.css(r[s],i))},setMode:function(e,t){return t==="toggle"&&(t=e.is(":hidden")?"show":"hide"),t},getBaseline:function(e,t){var n,r;switch(e[0]){case"top":n=0;break;case"middle":n=.5;break;case"bottom":n=1;break;default:n=e[0]/t.height}switch(e[1]){case"left":r=0;break;case"center":r=.5;break;case"right":r=1;break;default:r=e[1]/t.width}return{x:r,y:n}},createWrapper:function(t){if(t.parent().is(".ui-effects-wrapper"))return t.parent();var n={width:t.outerWidth(!0),height:t.outerHeight(!0),"float":t.css("float")},r=e("<div></div>").addClass("ui-effects-wrapper").css({fontSize:"100%",background:"transparent",border:"none",margin:0,padding:0}),i={width:t.width(),height:t.height()},s=document.activeElement;try{s.id}catch(o){s=document.body}return t.wrap(r),(t[0]===s||e.contains(t[0],s))&&e(s).focus(),r=t.parent(),t.css("position")==="static"?(r.css({position:"relative"}),t.css({position:"relative"})):(e.extend(n,{position:t.css("position"),zIndex:t.css("z-index")}),e.each(["top","left","bottom","right"],function(e,r){n[r]=t.css(r),isNaN(parseInt(n[r],10))&&(n[r]="auto")}),t.css({position:"relative",top:0,left:0,right:"auto",bottom:"auto"})),t.css(i),r.css(n).show()},removeWrapper:function(t){var n=document.activeElement;return t.parent().is(".ui-effects-wrapper")&&(t.parent().replaceWith(t),(t[0]===n||e.contains(t[0],n))&&e(n).focus()),t},setTransition:function(t,n,r,i){return i=i||{},e.each(n,function(e,n){var s=t.cssUnit(n);s[0]>0&&(i[n]=s[0]*r+s[1])}),i}}),e.fn.extend({effect:function(){function o(n){function u(){e.isFunction(i)&&i.call(r[0]),e.isFunction(n)&&n()}var r=e(this),i=t.complete,o=t.mode;(r.is(":hidden")?o==="hide":o==="show")?u():s.call(r[0],t,u)}var t=r.apply(this,arguments),n=t.mode,i=t.queue,s=e.effects.effect[t.effect];return e.fx.off||!s?n?this[n](t.duration,t.complete):this.each(function(){t.complete&&t.complete.call(this)}):i===!1?this.each(o):this.queue(i||"fx",o)},_show:e.fn.show,show:function(e){if(i(e))return this._show.apply(this,arguments);var t=r.apply(this,arguments);return t.mode="show",this.effect.call(this,t)},_hide:e.fn.hide,hide:function(e){if(i(e))return this._hide.apply(this,arguments);var t=r.apply(this,arguments);return t.mode="hide",this.effect.call(this,t)},__toggle:e.fn.toggle,toggle:function(t){if(i(t)||typeof t=="boolean"||e.isFunction(t))return this.__toggle.apply(this,arguments);var n=r.apply(this,arguments);return n.mode="toggle",this.effect.call(this,n)},cssUnit:function(t){var n=this.css(t),r=[];return e.each(["em","px","%","pt"],function(e,t){n.indexOf(t)>0&&(r=[parseFloat(n),t])}),r}})}(),function(){var t={};e.each(["Quad","Cubic","Quart","Quint","Expo"],function(e,n){t[n]=function(t){return Math.pow(t,e+2)}}),e.extend(t,{Sine:function(e){return 1-Math.cos(e*Math.PI/2)},Circ:function(e){return 1-Math.sqrt(1-e*e)},Elastic:function(e){return e===0||e===1?e:-Math.pow(2,8*(e-1))*Math.sin(((e-1)*80-7.5)*Math.PI/15)},Back:function(e){return e*e*(3*e-2)},Bounce:function(e){var t,n=4;while(e<((t=Math.pow(2,--n))-1)/11);return 1/Math.pow(4,3-n)-7.5625*Math.pow((t*3-2)/22-e,2)}}),e.each(t,function(t,n){e.easing["easeIn"+t]=n,e.easing["easeOut"+t]=function(e){return 1-n(1-e)},e.easing["easeInOut"+t]=function(e){return e<.5?n(e*2)/2:1-n(e*-2+2)/2}})}()}(jQuery),function(e,t){var n=0,r={},i={};r.height=r.paddingTop=r.paddingBottom=r.borderTopWidth=r.borderBottomWidth="hide",i.height=i.paddingTop=i.paddingBottom=i.borderTopWidth=i.borderBottomWidth="show",e.widget("ui.accordion",{version:"1.10.1",options:{active:0,animate:{},collapsible:!1,event:"click",header:"> li > :first-child,> :not(li):even",heightStyle:"auto",icons:{activeHeader:"ui-icon-triangle-1-s",header:"ui-icon-triangle-1-e"},activate:null,beforeActivate:null},_create:function(){var t=this.options;this.prevShow=this.prevHide=e(),this.element.addClass("ui-accordion ui-widget ui-helper-reset").attr("role","tablist"),!t.collapsible&&(t.active===!1||t.active==null)&&(t.active=0),this._processPanels(),t.active<0&&(t.active+=this.headers.length),this._refresh()},_getCreateEventData:function(){return{header:this.active,panel:this.active.length?this.active.next():e(),content:this.active.length?this.active.next():e()}},_createIcons:function(){var t=this.options.icons;t&&(e("<span>").addClass("ui-accordion-header-icon ui-icon "+t.header).prependTo(this.headers),this.active.children(".ui-accordion-header-icon").removeClass(t.header).addClass(t.activeHeader),this.headers.addClass("ui-accordion-icons"))},_destroyIcons:function(){this.headers.removeClass("ui-accordion-icons").children(".ui-accordion-header-icon").remove()},_destroy:function(){var e;this.element.removeClass("ui-accordion ui-widget ui-helper-reset").removeAttr("role"),this.headers.removeClass("ui-accordion-header ui-accordion-header-active ui-helper-reset ui-state-default ui-corner-all ui-state-active ui-state-disabled ui-corner-top").removeAttr("role").removeAttr("aria-selected").removeAttr("aria-controls").removeAttr("tabIndex").each(function(){/^ui-accordion/.test(this.id)&&this.removeAttribute("id")}),this._destroyIcons(),e=this.headers.next().css("display","").removeAttr("role").removeAttr("aria-expanded").removeAttr("aria-hidden").removeAttr("aria-labelledby").removeClass("ui-helper-reset ui-widget-content ui-corner-bottom ui-accordion-content ui-accordion-content-active ui-state-disabled").each(function(){/^ui-accordion/.test(this.id)&&this.removeAttribute("id")}),this.options.heightStyle!=="content"&&e.css("height","")},_setOption:function(e,t){if(e==="active"){this._activate(t);return}e==="event"&&(this.options.event&&this._off(this.headers,this.options.event),this._setupEvents(t)),this._super(e,t),e==="collapsible"&&!t&&this.options.active===!1&&this._activate(0),e==="icons"&&(this._destroyIcons(),t&&this._createIcons()),e==="disabled"&&this.headers.add(this.headers.next()).toggleClass("ui-state-disabled",!!t)},_keydown:function(t){if(t.altKey||t.ctrlKey)return;var n=e.ui.keyCode,r=this.headers.length,i=this.headers.index(t.target),s=!1;switch(t.keyCode){case n.RIGHT:case n.DOWN:s=this.headers[(i+1)%r];break;case n.LEFT:case n.UP:s=this.headers[(i-1+r)%r];break;case n.SPACE:case n.ENTER:this._eventHandler(t);break;case n.HOME:s=this.headers[0];break;case n.END:s=this.headers[r-1]}s&&(e(t.target).attr("tabIndex",-1),e(s).attr("tabIndex",0),s.focus(),t.preventDefault())},_panelKeyDown:function(t){t.keyCode===e.ui.keyCode.UP&&t.ctrlKey&&e(t.currentTarget).prev().focus()},refresh:function(){var t=this.options;this._processPanels();if(t.active===!1&&t.collapsible===!0||!this.headers.length)t.active=!1,this.active=e();t.active===!1?this._activate(0):this.active.length&&!e.contains(this.element[0],this.active[0])?this.headers.length===this.headers.find(".ui-state-disabled").length?(t.active=!1,this.active=e()):this._activate(Math.max(0,t.active-1)):t.active=this.headers.index(this.active),this._destroyIcons(),this._refresh()},_processPanels:function(){this.headers=this.element.find(this.options.header).addClass("ui-accordion-header ui-helper-reset ui-state-default ui-corner-all"),this.headers.next().addClass("ui-accordion-content ui-helper-reset ui-widget-content ui-corner-bottom").filter(":not(.ui-accordion-content-active)").hide()},_refresh:function(){var t,r=this.options,i=r.heightStyle,s=this.element.parent(),o=this.accordionId="ui-accordion-"+(this.element.attr("id")||++n);this.active=this._findActive(r.active).addClass("ui-accordion-header-active ui-state-active ui-corner-top").removeClass("ui-corner-all"),this.active.next().addClass("ui-accordion-content-active").show(),this.headers.attr("role","tab").each(function(t){var n=e(this),r=n.attr("id"),i=n.next(),s=i.attr("id");r||(r=o+"-header-"+t,n.attr("id",r)),s||(s=o+"-panel-"+t,i.attr("id",s)),n.attr("aria-controls",s),i.attr("aria-labelledby",r)}).next().attr("role","tabpanel"),this.headers.not(this.active).attr({"aria-selected":"false",tabIndex:-1}).next().attr({"aria-expanded":"false","aria-hidden":"true"}).hide(),this.active.length?this.active.attr({"aria-selected":"true",tabIndex:0}).next().attr({"aria-expanded":"true","aria-hidden":"false"}):this.headers.eq(0).attr("tabIndex",0),this._createIcons(),this._setupEvents(r.event),i==="fill"?(t=s.height(),this.element.siblings(":visible").each(function(){var n=e(this),r=n.css("position");if(r==="absolute"||r==="fixed")return;t-=n.outerHeight(!0)}),this.headers.each(function(){t-=e(this).outerHeight(!0)}),this.headers.next().each(function(){e(this).height(Math.max(0,t-e(this).innerHeight()+e(this).height()))}).css("overflow","auto")):i==="auto"&&(t=0,this.headers.next().each(function(){t=Math.max(t,e(this).css("height","").height())}).height(t))},_activate:function(t){var n=this._findActive(t)[0];if(n===this.active[0])return;n=n||this.active[0],this._eventHandler({target:n,currentTarget:n,preventDefault:e.noop})},_findActive:function(t){return typeof t=="number"?this.headers.eq(t):e()},_setupEvents:function(t){var n={keydown:"_keydown"};t&&e.each(t.split(" "),function(e,t){n[t]="_eventHandler"}),this._off(this.headers.add(this.headers.next())),this._on(this.headers,n),this._on(this.headers.next(),{keydown:"_panelKeyDown"}),this._hoverable(this.headers),this._focusable(this.headers)},_eventHandler:function(t){var n=this.options,r=this.active,i=e(t.currentTarget),s=i[0]===r[0],o=s&&n.collapsible,u=o?e():i.next(),a=r.next(),f={oldHeader:r,oldPanel:a,newHeader:o?e():i,newPanel:u};t.preventDefault();if(s&&!n.collapsible||this._trigger("beforeActivate",t,f)===!1)return;n.active=o?!1:this.headers.index(i),this.active=s?e():i,this._toggle(f),r.removeClass("ui-accordion-header-active ui-state-active"),n.icons&&r.children(".ui-accordion-header-icon").removeClass(n.icons.activeHeader).addClass(n.icons.header),s||(i.removeClass("ui-corner-all").addClass("ui-accordion-header-active ui-state-active ui-corner-top"),n.icons&&i.children(".ui-accordion-header-icon").removeClass(n.icons.header).addClass(n.icons.activeHeader),i.next().addClass("ui-accordion-content-active"))},_toggle:function(t){var n=t.newPanel,r=this.prevShow.length?this.prevShow:t.oldPanel;this.prevShow.add(this.prevHide).stop(!0,!0),this.prevShow=n,this.prevHide=r,this.options.animate?this._animate(n,r,t):(r.hide(),n.show(),this._toggleComplete(t)),r.attr({"aria-expanded":"false","aria-hidden":"true"}),r.prev().attr("aria-selected","false"),n.length&&r.length?r.prev().attr("tabIndex",-1):n.length&&this.headers.filter(function(){return e(this).attr("tabIndex")===0}).attr("tabIndex",-1),n.attr({"aria-expanded":"true","aria-hidden":"false"}).prev().attr({"aria-selected":"true",tabIndex:0})},_animate:function(e,t,n){var s,o,u,a=this,f=0,l=e.length&&(!t.length||e.index()<t.index()),c=this.options.animate||{},h=l&&c.down||c,p=function(){a._toggleComplete(n)};typeof h=="number"&&(u=h),typeof h=="string"&&(o=h),o=o||h.easing||c.easing,u=u||h.duration||c.duration;if(!t.length)return e.animate(i,u,o,p);if(!e.length)return t.animate(r,u,o,p);s=e.show().outerHeight(),t.animate(r,{duration:u,easing:o,step:function(e,t){t.now=Math.round(e)}}),e.hide().animate(i,{duration:u,easing:o,complete:p,step:function(e,n){n.now=Math.round(e),n.prop!=="height"?f+=n.now:a.options.heightStyle!=="content"&&(n.now=Math.round(s-t.outerHeight()-f),f=0)}})},_toggleComplete:function(e){var t=e.oldPanel;t.removeClass("ui-accordion-content-active").prev().removeClass("ui-corner-top").addClass("ui-corner-all"),t.length&&(t.parent()[0].className=t.parent()[0].className),this._trigger("activate",null,e)}})}(jQuery),function(e,t){var n=0;e.widget("ui.autocomplete",{version:"1.10.1",defaultElement:"<input>",options:{appendTo:null,autoFocus:!1,delay:300,minLength:1,position:{my:"left top",at:"left bottom",collision:"none"},source:null,change:null,close:null,focus:null,open:null,response:null,search:null,select:null},pending:0,_create:function(){var t,n,r,i=this.element[0].nodeName.toLowerCase(),s=i==="textarea",o=i==="input";this.isMultiLine=s?!0:o?!1:this.element.prop("isContentEditable"),this.valueMethod=this.element[s||o?"val":"text"],this.isNewMenu=!0,this.element.addClass("ui-autocomplete-input").attr("autocomplete","off"),this._on(this.element,{keydown:function(i){if(this.element.prop("readOnly")){t=!0,r=!0,n=!0;return}t=!1,r=!1,n=!1;var s=e.ui.keyCode;switch(i.keyCode){case s.PAGE_UP:t=!0,this._move("previousPage",i);break;case s.PAGE_DOWN:t=!0,this._move("nextPage",i);break;case s.UP:t=!0,this._keyEvent("previous",i);break;case s.DOWN:t=!0,this._keyEvent("next",i);break;case s.ENTER:case s.NUMPAD_ENTER:this.menu.active&&(t=!0,i.preventDefault(),this.menu.select(i));break;case s.TAB:this.menu.active&&this.menu.select(i);break;case s.ESCAPE:this.menu.element.is(":visible")&&(this._value(this.term),this.close(i),i.preventDefault());break;default:n=!0,this._searchTimeout(i)}},keypress:function(r){if(t){t=!1,r.preventDefault();return}if(n)return;var i=e.ui.keyCode;switch(r.keyCode){case i.PAGE_UP:this._move("previousPage",r);break;case i.PAGE_DOWN:this._move("nextPage",r);break;case i.UP:this._keyEvent("previous",r);break;case i.DOWN:this._keyEvent("next",r)}},input:function(e){if(r){r=!1,e.preventDefault();return}this._searchTimeout(e)},focus:function(){this.selectedItem=null,this.previous=this._value()},blur:function(e){if(this.cancelBlur){delete this.cancelBlur;return}clearTimeout(this.searching),this.close(e),this._change(e)}}),this._initSource(),this.menu=e("<ul>").addClass("ui-autocomplete ui-front").appendTo(this._appendTo()).menu({input:e(),role:null}).hide().data("ui-menu"),this._on(this.menu.element,{mousedown:function(t){t.preventDefault(),this.cancelBlur=!0,this._delay(function(){delete this.cancelBlur});var n=this.menu.element[0];e(t.target).closest(".ui-menu-item").length||this._delay(function(){var t=this;this.document.one("mousedown",function(r){r.target!==t.element[0]&&r.target!==n&&!e.contains(n,r.target)&&t.close()})})},menufocus:function(t,n){if(this.isNewMenu){this.isNewMenu=!1;if(t.originalEvent&&/^mouse/.test(t.originalEvent.type)){this.menu.blur(),this.document.one("mousemove",function(){e(t.target).trigger(t.originalEvent)});return}}var r=n.item.data("ui-autocomplete-item");!1!==this._trigger("focus",t,{item:r})?t.originalEvent&&/^key/.test(t.originalEvent.type)&&this._value(r.value):this.liveRegion.text(r.value)},menuselect:function(e,t){var n=t.item.data("ui-autocomplete-item"),r=this.previous;this.element[0]!==this.document[0].activeElement&&(this.element.focus(),this.previous=r,this._delay(function(){this.previous=r,this.selectedItem=n})),!1!==this._trigger("select",e,{item:n})&&this._value(n.value),this.term=this._value(),this.close(e),this.selectedItem=n}}),this.liveRegion=e("<span>",{role:"status","aria-live":"polite"}).addClass("ui-helper-hidden-accessible").insertAfter(this.element),this._on(this.window,{beforeunload:function(){this.element.removeAttr("autocomplete")}})},_destroy:function(){clearTimeout(this.searching),this.element.removeClass("ui-autocomplete-input").removeAttr("autocomplete"),this.menu.element.remove(),this.liveRegion.remove()},_setOption:function(e,t){this._super(e,t),e==="source"&&this._initSource(),e==="appendTo"&&this.menu.element.appendTo(this._appendTo()),e==="disabled"&&t&&this.xhr&&this.xhr.abort()},_appendTo:function(){var t=this.options.appendTo;return t&&(t=t.jquery||t.nodeType?e(t):this.document.find(t).eq(0)),t||(t=this.element.closest(".ui-front")),t.length||(t=this.document[0].body),t},_initSource:function(){var t,n,r=this;e.isArray(this.options.source)?(t=this.options.source,this.source=function(n,r){r(e.ui.autocomplete.filter(t,n.term))}):typeof this.options.source=="string"?(n=this.options.source,this.source=function(t,i){r.xhr&&r.xhr.abort(),r.xhr=e.ajax({url:n,data:t,dataType:"json",success:function(e){i(e)},error:function(){i([])}})}):this.source=this.options.source},_searchTimeout:function(e){clearTimeout(this.searching),this.searching=this._delay(function(){this.term!==this._value()&&(this.selectedItem=null,this.search(null,e))},this.options.delay)},search:function(e,t){e=e!=null?e:this._value(),this.term=this._value();if(e.length<this.options.minLength)return this.close(t);if(this._trigger("search",t)===!1)return;return this._search(e)},_search:function(e){this.pending++,this.element.addClass("ui-autocomplete-loading"),this.cancelSearch=!1,this.source({term:e},this._response())},_response:function(){var e=this,t=++n;return function(r){t===n&&e.__response(r),e.pending--,e.pending||e.element.removeClass("ui-autocomplete-loading")}},__response:function(e){e&&(e=this._normalize(e)),this._trigger("response",null,{content:e}),!this.options.disabled&&e&&e.length&&!this.cancelSearch?(this._suggest(e),this._trigger("open")):this._close()},close:function(e){this.cancelSearch=!0,this._close(e)},_close:function(e){this.menu.element.is(":visible")&&(this.menu.element.hide(),this.menu.blur(),this.isNewMenu=!0,this._trigger("close",e))},_change:function(e){this.previous!==this._value()&&this._trigger("change",e,{item:this.selectedItem})},_normalize:function(t){return t.length&&t[0].label&&t[0].value?t:e.map(t,function(t){return typeof t=="string"?{label:t,value:t}:e.extend({label:t.label||t.value,value:t.value||t.label},t)})},_suggest:function(t){var n=this.menu.element.empty();this._renderMenu(n,t),this.menu.refresh(),n.show(),this._resizeMenu(),n.position(e.extend({of:this.element},this.options.position)),this.options.autoFocus&&this.menu.next()},_resizeMenu:function(){var e=this.menu.element;e.outerWidth(Math.max(e.width("").outerWidth()+1,this.element.outerWidth()))},_renderMenu:function(t,n){var r=this;e.each(n,function(e,n){r._renderItemData(t,n)})},_renderItemData:function(e,t){return this._renderItem(e,t).data("ui-autocomplete-item",t)},_renderItem:function(t,n){return e("<li>").append(e("<a>").text(n.label)).appendTo(t)},_move:function(e,t){if(!this.menu.element.is(":visible")){this.search(null,t);return}if(this.menu.isFirstItem()&&/^previous/.test(e)||this.menu.isLastItem()&&/^next/.test(e)){this._value(this.term),this.menu.blur();return}this.menu[e](t)},widget:function(){return this.menu.element},_value:function(){return this.valueMethod.apply(this.element,arguments)},_keyEvent:function(e,t){if(!this.isMultiLine||this.menu.element.is(":visible"))this._move(e,t),t.preventDefault()}}),e.extend(e.ui.autocomplete,{escapeRegex:function(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")},filter:function(t,n){var r=new RegExp(e.ui.autocomplete.escapeRegex(n),"i");return e.grep(t,function(e){return r.test(e.label||e.value||e)})}}),e.widget("ui.autocomplete",e.ui.autocomplete,{options:{messages:{noResults:"No search results.",results:function(e){return e+(e>1?" results are":" result is")+" available, use up and down arrow keys to navigate."}}},__response:function(e){var t;this._superApply(arguments);if(this.options.disabled||this.cancelSearch)return;e&&e.length?t=this.options.messages.results(e.length):t=this.options.messages.noResults,this.liveRegion.text(t)}})}(jQuery),function(e,t){var n,r,i,s,o="ui-button ui-widget ui-state-default ui-corner-all",u="ui-state-hover ui-state-active ",a="ui-button-icons-only ui-button-icon-only ui-button-text-icons ui-button-text-icon-primary ui-button-text-icon-secondary ui-button-text-only",f=function(){var t=e(this).find(":ui-button");setTimeout(function(){t.button("refresh")},1)},l=function(t){var n=t.name,r=t.form,i=e([]);return n&&(n=n.replace(/'/g,"\\'"),r?i=e(r).find("[name='"+n+"']"):i=e("[name='"+n+"']",t.ownerDocument).filter(function(){return!this.form})),i};e.widget("ui.button",{version:"1.10.1",defaultElement:"<button>",options:{disabled:null,text:!0,label:null,icons:{primary:null,secondary:null}},_create:function(){this.element.closest("form").unbind("reset"+this.eventNamespace).bind("reset"+this.eventNamespace,f),typeof this.options.disabled!="boolean"?this.options.disabled=!!this.element.prop("disabled"):this.element.prop("disabled",this.options.disabled),this._determineButtonType(),this.hasTitle=!!this.buttonElement.attr("title");var t=this,u=this.options,a=this.type==="checkbox"||this.type==="radio",c=a?"":"ui-state-active",h="ui-state-focus";u.label===null&&(u.label=this.type==="input"?this.buttonElement.val():this.buttonElement.html()),this._hoverable(this.buttonElement),this.buttonElement.addClass(o).attr("role","button").bind("mouseenter"+this.eventNamespace,function(){if(u.disabled)return;this===n&&e(this).addClass("ui-state-active")}).bind("mouseleave"+this.eventNamespace,function(){if(u.disabled)return;e(this).removeClass(c)}).bind("click"+this.eventNamespace,function(e){u.disabled&&(e.preventDefault(),e.stopImmediatePropagation())}),this.element.bind("focus"+this.eventNamespace,function(){t.buttonElement.addClass(h)}).bind("blur"+this.eventNamespace,function(){t.buttonElement.removeClass(h)}),a&&(this.element.bind("change"+this.eventNamespace,function(){if(s)return;t.refresh()}),this.buttonElement.bind("mousedown"+this.eventNamespace,function(e){if(u.disabled)return;s=!1,r=e.pageX,i=e.pageY}).bind("mouseup"+this.eventNamespace,function(e){if(u.disabled)return;if(r!==e.pageX||i!==e.pageY)s=!0})),this.type==="checkbox"?this.buttonElement.bind("click"+this.eventNamespace,function(){if(u.disabled||s)return!1}):this.type==="radio"?this.buttonElement.bind("click"+this.eventNamespace,function(){if(u.disabled||s)return!1;e(this).addClass("ui-state-active"),t.buttonElement.attr("aria-pressed","true");var n=t.element[0];l(n).not(n).map(function(){return e(this).button("widget")[0]}).removeClass("ui-state-active").attr("aria-pressed","false")}):(this.buttonElement.bind("mousedown"+this.eventNamespace,function(){if(u.disabled)return!1;e(this).addClass("ui-state-active"),n=this,t.document.one("mouseup",function(){n=null})}).bind("mouseup"+this.eventNamespace,function(){if(u.disabled)return!1;e(this).removeClass("ui-state-active")}).bind("keydown"+this.eventNamespace,function(t){if(u.disabled)return!1;(t.keyCode===e.ui.keyCode.SPACE||t.keyCode===e.ui.keyCode.ENTER)&&e(this).addClass("ui-state-active")}).bind("keyup"+this.eventNamespace+" blur"+this.eventNamespace,function(){e(this).removeClass("ui-state-active")}),this.buttonElement.is("a")&&this.buttonElement.keyup(function(t){t.keyCode===e.ui.keyCode.SPACE&&e(this).click()})),this._setOption("disabled",u.disabled),this._resetButton()},_determineButtonType:function(){var e,t,n;this.element.is("[type=checkbox]")?this.type="checkbox":this.element.is("[type=radio]")?this.type="radio":this.element.is("input")?this.type="input":this.type="button",this.type==="checkbox"||this.type==="radio"?(e=this.element.parents().last(),t="label[for='"+this.element.attr("id")+"']",this.buttonElement=e.find(t),this.buttonElement.length||(e=e.length?e.siblings():this.element.siblings(),this.buttonElement=e.filter(t),this.buttonElement.length||(this.buttonElement=e.find(t))),this.element.addClass("ui-helper-hidden-accessible"),n=this.element.is(":checked"),n&&this.buttonElement.addClass("ui-state-active"),this.buttonElement.prop("aria-pressed",n)):this.buttonElement=this.element},widget:function(){return this.buttonElement},_destroy:function(){this.element.removeClass("ui-helper-hidden-accessible"),this.buttonElement.removeClass(o+" "+u+" "+a).removeAttr("role").removeAttr("aria-pressed").html(this.buttonElement.find(".ui-button-text").html()),this.hasTitle||this.buttonElement.removeAttr("title")},_setOption:function(e,t){this._super(e,t);if(e==="disabled"){t?this.element.prop("disabled",!0):this.element.prop("disabled",!1);return}this._resetButton()},refresh:function(){var t=this.element.is("input, button")?this.element.is(":disabled"):this.element.hasClass("ui-button-disabled");t!==this.options.disabled&&this._setOption("disabled",t),this.type==="radio"?l(this.element[0]).each(function(){e(this).is(":checked")?e(this).button("widget").addClass("ui-state-active").attr("aria-pressed","true"):e(this).button("widget").removeClass("ui-state-active").attr("aria-pressed","false")}):this.type==="checkbox"&&(this.element.is(":checked")?this.buttonElement.addClass("ui-state-active").attr("aria-pressed","true"):this.buttonElement.removeClass("ui-state-active").attr("aria-pressed","false"))},_resetButton:function(){if(this.type==="input"){this.options.label&&this.element.val(this.options.label);return}var t=this.buttonElement.removeClass(a),n=e("<span></span>",this.document[0]).addClass("ui-button-text").html(this.options.label).appendTo(t.empty()).text(),r=this.options.icons,i=r.primary&&r.secondary,s=[];r.primary||r.secondary?(this.options.text&&s.push("ui-button-text-icon"+(i?"s":r.primary?"-primary":"-secondary")),r.primary&&t.prepend("<span class='ui-button-icon-primary ui-icon "+r.primary+"'></span>"),r.secondary&&t.append("<span class='ui-button-icon-secondary ui-icon "+r.secondary+"'></span>"),this.options.text||(s.push(i?"ui-button-icons-only":"ui-button-icon-only"),this.hasTitle||t.attr("title",e.trim(n)))):s.push("ui-button-text-only"),t.addClass(s.join(" "))}}),e.widget("ui.buttonset",{version:"1.10.1",options:{items:"button, input[type=button], input[type=submit], input[type=reset], input[type=checkbox], input[type=radio], a, :data(ui-button)"},_create:function(){this.element.addClass("ui-buttonset")},_init:function(){this.refresh()},_setOption:function(e,t){e==="disabled"&&this.buttons.button("option",e,t),this._super(e,t)},refresh:function(){var t=this.element.css("direction")==="rtl";this.buttons=this.element.find(this.options.items).filter(":ui-button").button("refresh").end().not(":ui-button").button().end().map(function(){return e(this).button("widget")[0]}).removeClass("ui-corner-all ui-corner-left ui-corner-right").filter(":first").addClass(t?"ui-corner-right":"ui-corner-left").end().filter(":last").addClass(t?"ui-corner-left":"ui-corner-right").end().end()},_destroy:function(){this.element.removeClass("ui-buttonset"),this.buttons.map(function(){return e(this).button("widget")[0]}).removeClass("ui-corner-left ui-corner-right").end().button("destroy")}})}(jQuery),function(e,t){function s(){this._curInst=null,this._keyEvent=!1,this._disabledInputs=[],this._datepickerShowing=!1,this._inDialog=!1,this._mainDivId="ui-datepicker-div",this._inlineClass="ui-datepicker-inline",this._appendClass="ui-datepicker-append",this._triggerClass="ui-datepicker-trigger",this._dialogClass="ui-datepicker-dialog",this._disableClass="ui-datepicker-disabled",this._unselectableClass="ui-datepicker-unselectable",this._currentClass="ui-datepicker-current-day",this._dayOverClass="ui-datepicker-days-cell-over",this.regional=[],this.regional[""]={closeText:"Done",prevText:"Prev",nextText:"Next",currentText:"Today",monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dayNamesMin:["Su","Mo","Tu","We","Th","Fr","Sa"],weekHeader:"Wk",dateFormat:"mm/dd/yy",firstDay:0,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},this._defaults={showOn:"focus",showAnim:"fadeIn",showOptions:{},defaultDate:null,appendText:"",buttonText:"...",buttonImage:"",buttonImageOnly:!1,hideIfNoPrevNext:!1,navigationAsDateFormat:!1,gotoCurrent:!1,changeMonth:!1,changeYear:!1,yearRange:"c-10:c+10",showOtherMonths:!1,selectOtherMonths:!1,showWeek:!1,calculateWeek:this.iso8601Week,shortYearCutoff:"+10",minDate:null,maxDate:null,duration:"fast",beforeShowDay:null,beforeShow:null,onSelect:null,onChangeMonthYear:null,onClose:null,numberOfMonths:1,showCurrentAtPos:0,stepMonths:1,stepBigMonths:12,altField:"",altFormat:"",constrainInput:!0,showButtonPanel:!1,autoSize:!1,disabled:!1},e.extend(this._defaults,this.regional[""]),this.dpDiv=o(e("<div id='"+this._mainDivId+"' class='ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>"))}function o(t){var n="button, .ui-datepicker-prev, .ui-datepicker-next, .ui-datepicker-calendar td a";return t.delegate(n,"mouseout",function(){e(this).removeClass("ui-state-hover"),this.className.indexOf("ui-datepicker-prev")!==-1&&e(this).removeClass("ui-datepicker-prev-hover"),this.className.indexOf("ui-datepicker-next")!==-1&&e(this).removeClass("ui-datepicker-next-hover")}).delegate(n,"mouseover",function(){e.datepicker._isDisabledDatepicker(i.inline?t.parent()[0]:i.input[0])||(e(this).parents(".ui-datepicker-calendar").find("a").removeClass("ui-state-hover"),e(this).addClass("ui-state-hover"),this.className.indexOf("ui-datepicker-prev")!==-1&&e(this).addClass("ui-datepicker-prev-hover"),this.className.indexOf("ui-datepicker-next")!==-1&&e(this).addClass("ui-datepicker-next-hover"))})}function u(t,n){e.extend(t,n);for(var r in n)n[r]==null&&(t[r]=n[r]);return t}e.extend(e.ui,{datepicker:{version:"1.10.1"}});var n="datepicker",r=(new Date).getTime(),i;e.extend(s.prototype,{markerClassName:"hasDatepicker",maxRows:4,_widgetDatepicker:function(){return this.dpDiv},setDefaults:function(e){return u(this._defaults,e||{}),this},_attachDatepicker:function(t,n){var r,i,s;r=t.nodeName.toLowerCase(),i=r==="div"||r==="span",t.id||(this.uuid+=1,t.id="dp"+this.uuid),s=this._newInst(e(t),i),s.settings=e.extend({},n||{}),r==="input"?this._connectDatepicker(t,s):i&&this._inlineDatepicker(t,s)},_newInst:function(t,n){var r=t[0].id.replace(/([^A-Za-z0-9_\-])/g,"\\\\$1");return{id:r,input:t,selectedDay:0,selectedMonth:0,selectedYear:0,drawMonth:0,drawYear:0,inline:n,dpDiv:n?o(e("<div class='"+this._inlineClass+" ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>")):this.dpDiv}},_connectDatepicker:function(t,r){var i=e(t);r.append=e([]),r.trigger=e([]);if(i.hasClass(this.markerClassName))return;this._attachments(i,r),i.addClass(this.markerClassName).keydown(this._doKeyDown).keypress(this._doKeyPress).keyup(this._doKeyUp),this._autoSize(r),e.data(t,n,r),r.settings.disabled&&this._disableDatepicker(t)},_attachments:function(t,n){var r,i,s,o=this._get(n,"appendText"),u=this._get(n,"isRTL");n.append&&n.append.remove(),o&&(n.append=e("<span class='"+this._appendClass+"'>"+o+"</span>"),t[u?"before":"after"](n.append)),t.unbind("focus",this._showDatepicker),n.trigger&&n.trigger.remove(),r=this._get(n,"showOn"),(r==="focus"||r==="both")&&t.focus(this._showDatepicker);if(r==="button"||r==="both")i=this._get(n,"buttonText"),s=this._get(n,"buttonImage"),n.trigger=e(this._get(n,"buttonImageOnly")?e("<img/>").addClass(this._triggerClass).attr({src:s,alt:i,title:i}):e("<button type='button'></button>").addClass(this._triggerClass).html(s?e("<img/>").attr({src:s,alt:i,title:i}):i)),t[u?"before":"after"](n.trigger),n.trigger.click(function(){return e.datepicker._datepickerShowing&&e.datepicker._lastInput===t[0]?e.datepicker._hideDatepicker():e.datepicker._datepickerShowing&&e.datepicker._lastInput!==t[0]?(e.datepicker._hideDatepicker(),e.datepicker._showDatepicker(t[0])):e.datepicker._showDatepicker(t[0]),!1})},_autoSize:function(e){if(this._get(e,"autoSize")&&!e.inline){var t,n,r,i,s=new Date(2009,11,20),o=this._get(e,"dateFormat");o.match(/[DM]/)&&(t=function(e){n=0,r=0;for(i=0;i<e.length;i++)e[i].length>n&&(n=e[i].length,r=i);return r},s.setMonth(t(this._get(e,o.match(/MM/)?"monthNames":"monthNamesShort"))),s.setDate(t(this._get(e,o.match(/DD/)?"dayNames":"dayNamesShort"))+20-s.getDay())),e.input.attr("size",this._formatDate(e,s).length)}},_inlineDatepicker:function(t,r){var i=e(t);if(i.hasClass(this.markerClassName))return;i.addClass(this.markerClassName).append(r.dpDiv),e.data(t,n,r),this._setDate(r,this._getDefaultDate(r),!0),this._updateDatepicker(r),this._updateAlternate(r),r.settings.disabled&&this._disableDatepicker(t),r.dpDiv.css("display","block")},_dialogDatepicker:function(t,r,i,s,o){var a,f,l,c,h,p=this._dialogInst;return p||(this.uuid+=1,a="dp"+this.uuid,this._dialogInput=e("<input type='text' id='"+a+"' style='position: absolute; top: -100px; width: 0px;'/>"),this._dialogInput.keydown(this._doKeyDown),e("body").append(this._dialogInput),p=this._dialogInst=this._newInst(this._dialogInput,!1),p.settings={},e.data(this._dialogInput[0],n,p)),u(p.settings,s||{}),r=r&&r.constructor===Date?this._formatDate(p,r):r,this._dialogInput.val(r),this._pos=o?o.length?o:[o.pageX,o.pageY]:null,this._pos||(f=document.documentElement.clientWidth,l=document.documentElement.clientHeight,c=document.documentElement.scrollLeft||document.body.scrollLeft,h=document.documentElement.scrollTop||document.body.scrollTop,this._pos=[f/2-100+c,l/2-150+h]),this._dialogInput.css("left",this._pos[0]+20+"px").css("top",this._pos[1]+"px"),p.settings.onSelect=i,this._inDialog=!0,this.dpDiv.addClass(this._dialogClass),this._showDatepicker(this._dialogInput[0]),e.blockUI&&e.blockUI(this.dpDiv),e.data(this._dialogInput[0],n,p),this},_destroyDatepicker:function(t){var r,i=e(t),s=e.data(t,n);if(!i.hasClass(this.markerClassName))return;r=t.nodeName.toLowerCase(),e.removeData(t,n),r==="input"?(s.append.remove(),s.trigger.remove(),i.removeClass(this.markerClassName).unbind("focus",this._showDatepicker).unbind("keydown",this._doKeyDown).unbind("keypress",this._doKeyPress).unbind("keyup",this._doKeyUp)):(r==="div"||r==="span")&&i.removeClass(this.markerClassName).empty()},_enableDatepicker:function(t){var r,i,s=e(t),o=e.data(t,n);if(!s.hasClass(this.markerClassName))return;r=t.nodeName.toLowerCase();if(r==="input")t.disabled=!1,o.trigger.filter("button").each(function(){this.disabled=!1}).end().filter("img").css({opacity:"1.0",cursor:""});else if(r==="div"||r==="span")i=s.children("."+this._inlineClass),i.children().removeClass("ui-state-disabled"),i.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",!1);this._disabledInputs=e.map(this._disabledInputs,function(e){return e===t?null:e})},_disableDatepicker:function(t){var r,i,s=e(t),o=e.data(t,n);if(!s.hasClass(this.markerClassName))return;r=t.nodeName.toLowerCase();if(r==="input")t.disabled=!0,o.trigger.filter("button").each(function(){this.disabled=!0}).end().filter("img").css({opacity:"0.5",cursor:"default"});else if(r==="div"||r==="span")i=s.children("."+this._inlineClass),i.children().addClass("ui-state-disabled"),i.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",!0);this._disabledInputs=e.map(this._disabledInputs,function(e){return e===t?null:e}),this._disabledInputs[this._disabledInputs.length]=t},_isDisabledDatepicker:function(e){if(!e)return!1;for(var t=0;t<this._disabledInputs.length;t++)if(this._disabledInputs[t]===e)return!0;return!1},_getInst:function(t){try{return e.data(t,n)}catch(r){throw"Missing instance data for this datepicker"}},_optionDatepicker:function(n,r,i){var s,o,a,f,l=this._getInst(n);if(arguments.length===2&&typeof r=="string")return r==="defaults"?e.extend({},e.datepicker._defaults):l?r==="all"?e.extend({},l.settings):this._get(l,r):null;s=r||{},typeof r=="string"&&(s={},s[r]=i),l&&(this._curInst===l&&this._hideDatepicker(),o=this._getDateDatepicker(n,!0),a=this._getMinMaxDate(l,"min"),f=this._getMinMaxDate(l,"max"),u(l.settings,s),a!==null&&s.dateFormat!==t&&s.minDate===t&&(l.settings.minDate=this._formatDate(l,a)),f!==null&&s.dateFormat!==t&&s.maxDate===t&&(l.settings.maxDate=this._formatDate(l,f)),"disabled"in s&&(s.disabled?this._disableDatepicker(n):this._enableDatepicker(n)),this._attachments(e(n),l),this._autoSize(l),this._setDate(l,o),this._updateAlternate(l),this._updateDatepicker(l))},_changeDatepicker:function(e,t,n){this._optionDatepicker(e,t,n)},_refreshDatepicker:function(e){var t=this._getInst(e);t&&this._updateDatepicker(t)},_setDateDatepicker:function(e,t){var n=this._getInst(e);n&&(this._setDate(n,t),this._updateDatepicker(n),this._updateAlternate(n))},_getDateDatepicker:function(e,t){var n=this._getInst(e);return n&&!n.inline&&this._setDateFromField(n,t),n?this._getDate(n):null},_doKeyDown:function(t){var n,r,i,s=e.datepicker._getInst(t.target),o=!0,u=s.dpDiv.is(".ui-datepicker-rtl");s._keyEvent=!0;if(e.datepicker._datepickerShowing)switch(t.keyCode){case 9:e.datepicker._hideDatepicker(),o=!1;break;case 13:return i=e("td."+e.datepicker._dayOverClass+":not(."+e.datepicker._currentClass+")",s.dpDiv),i[0]&&e.datepicker._selectDay(t.target,s.selectedMonth,s.selectedYear,i[0]),n=e.datepicker._get(s,"onSelect"),n?(r=e.datepicker._formatDate(s),n.apply(s.input?s.input[0]:null,[r,s])):e.datepicker._hideDatepicker(),!1;case 27:e.datepicker._hideDatepicker();break;case 33:e.datepicker._adjustDate(t.target,t.ctrlKey?-e.datepicker._get(s,"stepBigMonths"):-e.datepicker._get(s,"stepMonths"),"M");break;case 34:e.datepicker._adjustDate(t.target,t.ctrlKey?+e.datepicker._get(s,"stepBigMonths"):+e.datepicker._get(s,"stepMonths"),"M");break;case 35:(t.ctrlKey||t.metaKey)&&e.datepicker._clearDate(t.target),o=t.ctrlKey||t.metaKey;break;case 36:(t.ctrlKey||t.metaKey)&&e.datepicker._gotoToday(t.target),o=t.ctrlKey||t.metaKey;break;case 37:(t.ctrlKey||t.metaKey)&&e.datepicker._adjustDate(t.target,u?1:-1,"D"),o=t.ctrlKey||t.metaKey,t.originalEvent.altKey&&e.datepicker._adjustDate(t.target,t.ctrlKey?-e.datepicker._get(s,"stepBigMonths"):-e.datepicker._get(s,"stepMonths"),"M");break;case 38:(t.ctrlKey||t.metaKey)&&e.datepicker._adjustDate(t.target,-7,"D"),o=t.ctrlKey||t.metaKey;break;case 39:(t.ctrlKey||t.metaKey)&&e.datepicker._adjustDate(t.target,u?-1:1,"D"),o=t.ctrlKey||t.metaKey,t.originalEvent.altKey&&e.datepicker._adjustDate(t.target,t.ctrlKey?+e.datepicker._get(s,"stepBigMonths"):+e.datepicker._get(s,"stepMonths"),"M");break;case 40:(t.ctrlKey||t.metaKey)&&e.datepicker._adjustDate(t.target,7,"D"),o=t.ctrlKey||t.metaKey;break;default:o=!1}else t.keyCode===36&&t.ctrlKey?e.datepicker._showDatepicker(this):o=!1;o&&(t.preventDefault(),t.stopPropagation())},_doKeyPress:function(t){var n,r,i=e.datepicker._getInst(t.target);if(e.datepicker._get(i,"constrainInput"))return n=e.datepicker._possibleChars(e.datepicker._get(i,"dateFormat")),r=String.fromCharCode(t.charCode==null?t.keyCode:t.charCode),t.ctrlKey||t.metaKey||r<" "||!n||n.indexOf(r)>-1},_doKeyUp:function(t){var n,r=e.datepicker._getInst(t.target);if(r.input.val()!==r.lastVal)try{n=e.datepicker.parseDate(e.datepicker._get(r,"dateFormat"),r.input?r.input.val():null,e.datepicker._getFormatConfig(r)),n&&(e.datepicker._setDateFromField(r),e.datepicker._updateAlternate(r),e.datepicker._updateDatepicker(r))}catch(i){}return!0},_showDatepicker:function(t){t=t.target||t,t.nodeName.toLowerCase()!=="input"&&(t=e("input",t.parentNode)[0]);if(e.datepicker._isDisabledDatepicker(t)||e.datepicker._lastInput===t)return;var n,r,i,s,o,a,f;n=e.datepicker._getInst(t),e.datepicker._curInst&&e.datepicker._curInst!==n&&(e.datepicker._curInst.dpDiv.stop(!0,!0),n&&e.datepicker._datepickerShowing&&e.datepicker._hideDatepicker(e.datepicker._curInst.input[0])),r=e.datepicker._get(n,"beforeShow"),i=r?r.apply(t,[t,n]):{};if(i===!1)return;u(n.settings,i),n.lastVal=null,e.datepicker._lastInput=t,e.datepicker._setDateFromField(n),e.datepicker._inDialog&&(t.value=""),e.datepicker._pos||(e.datepicker._pos=e.datepicker._findPos(t),e.datepicker._pos[1]+=t.offsetHeight),s=!1,e(t).parents().each(function(){return s|=e(this).css("position")==="fixed",!s}),o={left:e.datepicker._pos[0],top:e.datepicker._pos[1]},e.datepicker._pos=null,n.dpDiv.empty(),n.dpDiv.css({position:"absolute",display:"block",top:"-1000px"}),e.datepicker._updateDatepicker(n),o=e.datepicker._checkOffset(n,o,s),n.dpDiv.css({position:e.datepicker._inDialog&&e.blockUI?"static":s?"fixed":"absolute",display:"none",left:o.left+"px",top:o.top+"px"}),n.inline||(a=e.datepicker._get(n,"showAnim"),f=e.datepicker._get(n,"duration"),n.dpDiv.zIndex(e(t).zIndex()+1),e.datepicker._datepickerShowing=!0,e.effects&&e.effects.effect[a]?n.dpDiv.show(a,e.datepicker._get(n,"showOptions"),f):n.dpDiv[a||"show"](a?f:null),n.input.is(":visible")&&!n.input.is(":disabled")&&n.input.focus(),e.datepicker._curInst=n)},_updateDatepicker:function(t){this.maxRows=4,i=t,t.dpDiv.empty().append(this._generateHTML(t)),this._attachHandlers(t),t.dpDiv.find("."+this._dayOverClass+" a").mouseover();var n,r=this._getNumberOfMonths(t),s=r[1],o=17;t.dpDiv.removeClass("ui-datepicker-multi-2 ui-datepicker-multi-3 ui-datepicker-multi-4").width(""),s>1&&t.dpDiv.addClass("ui-datepicker-multi-"+s).css("width",o*s+"em"),t.dpDiv[(r[0]!==1||r[1]!==1?"add":"remove")+"Class"]("ui-datepicker-multi"),t.dpDiv[(this._get(t,"isRTL")?"add":"remove")+"Class"]("ui-datepicker-rtl"),t===e.datepicker._curInst&&e.datepicker._datepickerShowing&&t.input&&t.input.is(":visible")&&!t.input.is(":disabled")&&t.input[0]!==document.activeElement&&t.input.focus(),t.yearshtml&&(n=t.yearshtml,setTimeout(function(){n===t.yearshtml&&t.yearshtml&&t.dpDiv.find("select.ui-datepicker-year:first").replaceWith(t.yearshtml),n=t.yearshtml=null},0))},_getBorders:function(e){var t=function(e){return{thin:1,medium:2,thick:3}[e]||e};return[parseFloat(t(e.css("border-left-width"))),parseFloat(t(e.css("border-top-width")))]},_checkOffset:function(t,n,r){var i=t.dpDiv.outerWidth(),s=t.dpDiv.outerHeight(),o=t.input?t.input.outerWidth():0,u=t.input?t.input.outerHeight():0,a=document.documentElement.clientWidth+(r?0:e(document).scrollLeft()),f=document.documentElement.clientHeight+(r?0:e(document).scrollTop());return n.left-=this._get(t,"isRTL")?i-o:0,n.left-=r&&n.left===t.input.offset().left?e(document).scrollLeft():0,n.top-=r&&n.top===t.input.offset().top+u?e(document).scrollTop():0,n.left-=Math.min(n.left,n.left+i>a&&a>i?Math.abs(n.left+i-a):0),n.top-=Math.min(n.top,n.top+s>f&&f>s?Math.abs(s+u):0),n},_findPos:function(t){var n,r=this._getInst(t),i=this._get(r,"isRTL");while(t&&(t.type==="hidden"||t.nodeType!==1||e.expr.filters.hidden(t)))t=t[i?"previousSibling":"nextSibling"];return n=e(t).offset(),[n.left,n.top]},_hideDatepicker:function(t){var r,i,s,o,u=this._curInst;if(!u||t&&u!==e.data(t,n))return;this._datepickerShowing&&(r=this._get(u,"showAnim"),i=this._get(u,"duration"),s=function(){e.datepicker._tidyDialog(u)},e.effects&&(e.effects.effect[r]||e.effects[r])?u.dpDiv.hide(r,e.datepicker._get(u,"showOptions"),i,s):u.dpDiv[r==="slideDown"?"slideUp":r==="fadeIn"?"fadeOut":"hide"](r?i:null,s),r||s(),this._datepickerShowing=!1,o=this._get(u,"onClose"),o&&o.apply(u.input?u.input[0]:null,[u.input?u.input.val():"",u]),this._lastInput=null,this._inDialog&&(this._dialogInput.css({position:"absolute",left:"0",top:"-100px"}),e.blockUI&&(e.unblockUI(),e("body").append(this.dpDiv))),this._inDialog=!1)},_tidyDialog:function(e){e.dpDiv.removeClass(this._dialogClass).unbind(".ui-datepicker-calendar")},_checkExternalClick:function(t){if(!e.datepicker._curInst)return;var n=e(t.target),r=e.datepicker._getInst(n[0]);(n[0].id!==e.datepicker._mainDivId&&n.parents("#"+e.datepicker._mainDivId).length===0&&!n.hasClass(e.datepicker.markerClassName)&&!n.closest("."+e.datepicker._triggerClass).length&&e.datepicker._datepickerShowing&&(!e.datepicker._inDialog||!e.blockUI)||n.hasClass(e.datepicker.markerClassName)&&e.datepicker._curInst!==r)&&e.datepicker._hideDatepicker()},_adjustDate:function(t,n,r){var i=e(t),s=this._getInst(i[0]);if(this._isDisabledDatepicker(i[0]))return;this._adjustInstDate(s,n+(r==="M"?this._get(s,"showCurrentAtPos"):0),r),this._updateDatepicker(s)},_gotoToday:function(t){var n,r=e(t),i=this._getInst(r[0]);this._get(i,"gotoCurrent")&&i.currentDay?(i.selectedDay=i.currentDay,i.drawMonth=i.selectedMonth=i.currentMonth,i.drawYear=i.selectedYear=i.currentYear):(n=new Date,i.selectedDay=n.getDate(),i.drawMonth=i.selectedMonth=n.getMonth(),i.drawYear=i.selectedYear=n.getFullYear()),this._notifyChange(i),this._adjustDate(r)},_selectMonthYear:function(t,n,r){var i=e(t),s=this._getInst(i[0]);s["selected"+(r==="M"?"Month":"Year")]=s["draw"+(r==="M"?"Month":"Year")]=parseInt(n.options[n.selectedIndex].value,10),this._notifyChange(s),this._adjustDate(i)},_selectDay:function(t,n,r,i){var s,o=e(t);if(e(i).hasClass(this._unselectableClass)||this._isDisabledDatepicker(o[0]))return;s=this._getInst(o[0]),s.selectedDay=s.currentDay=e("a",i).html(),s.selectedMonth=s.currentMonth=n,s.selectedYear=s.currentYear=r,this._selectDate(t,this._formatDate(s,s.currentDay,s.currentMonth,s.currentYear))},_clearDate:function(t){var n=e(t);this._selectDate(n,"")},_selectDate:function(t,n){var r,i=e(t),s=this._getInst(i[0]);n=n!=null?n:this._formatDate(s),s.input&&s.input.val(n),this._updateAlternate(s),r=this._get(s,"onSelect"),r?r.apply(s.input?s.input[0]:null,[n,s]):s.input&&s.input.trigger("change"),s.inline?this._updateDatepicker(s):(this._hideDatepicker(),this._lastInput=s.input[0],typeof s.input[0]!="object"&&s.input.focus(),this._lastInput=null)},_updateAlternate:function(t){var n,r,i,s=this._get(t,"altField");s&&(n=this._get(t,"altFormat")||this._get(t,"dateFormat"),r=this._getDate(t),i=this.formatDate(n,r,this._getFormatConfig(t)),e(s).each(function(){e(this).val(i)}))},noWeekends:function(e){var t=e.getDay();return[t>0&&t<6,""]},iso8601Week:function(e){var t,n=new Date(e.getTime());return n.setDate(n.getDate()+4-(n.getDay()||7)),t=n.getTime(),n.setMonth(0),n.setDate(1),Math.floor(Math.round((t-n)/864e5)/7)+1},parseDate:function(t,n,r){if(t==null||n==null)throw"Invalid arguments";n=typeof n=="object"?n.toString():n+"";if(n==="")return null;var i,s,o,u=0,a=(r?r.shortYearCutoff:null)||this._defaults.shortYearCutoff,f=typeof a!="string"?a:(new Date).getFullYear()%100+parseInt(a,10),l=(r?r.dayNamesShort:null)||this._defaults.dayNamesShort,c=(r?r.dayNames:null)||this._defaults.dayNames,h=(r?r.monthNamesShort:null)||this._defaults.monthNamesShort,p=(r?r.monthNames:null)||this._defaults.monthNames,d=-1,v=-1,m=-1,g=-1,y=!1,b,w=function(e){var n=i+1<t.length&&t.charAt(i+1)===e;return n&&i++,n},E=function(e){var t=w(e),r=e==="@"?14:e==="!"?20:e==="y"&&t?4:e==="o"?3:2,i=new RegExp("^\\d{1,"+r+"}"),s=n.substring(u).match(i);if(!s)throw"Missing number at position "+u;return u+=s[0].length,parseInt(s[0],10)},S=function(t,r,i){var s=-1,o=e.map(w(t)?i:r,function(e,t){return[[t,e]]}).sort(function(e,t){return-(e[1].length-t[1].length)});e.each(o,function(e,t){var r=t[1];if(n.substr(u,r.length).toLowerCase()===r.toLowerCase())return s=t[0],u+=r.length,!1});if(s!==-1)return s+1;throw"Unknown name at position "+u},x=function(){if(n.charAt(u)!==t.charAt(i))throw"Unexpected literal at position "+u;u++};for(i=0;i<t.length;i++)if(y)t.charAt(i)==="'"&&!w("'")?y=!1:x();else switch(t.charAt(i)){case"d":m=E("d");break;case"D":S("D",l,c);break;case"o":g=E("o");break;case"m":v=E("m");break;case"M":v=S("M",h,p);break;case"y":d=E("y");break;case"@":b=new Date(E("@")),d=b.getFullYear(),v=b.getMonth()+1,m=b.getDate();break;case"!":b=new Date((E("!")-this._ticksTo1970)/1e4),d=b.getFullYear(),v=b.getMonth()+1,m=b.getDate();break;case"'":w("'")?x():y=!0;break;default:x()}if(u<n.length){o=n.substr(u);if(!/^\s+/.test(o))throw"Extra/unparsed characters found in date: "+o}d===-1?d=(new Date).getFullYear():d<100&&(d+=(new Date).getFullYear()-(new Date).getFullYear()%100+(d<=f?0:-100));if(g>-1){v=1,m=g;do{s=this._getDaysInMonth(d,v-1);if(m<=s)break;v++,m-=s}while(!0)}b=this._daylightSavingAdjust(new Date(d,v-1,m));if(b.getFullYear()!==d||b.getMonth()+1!==v||b.getDate()!==m)throw"Invalid date";return b},ATOM:"yy-mm-dd",COOKIE:"D, dd M yy",ISO_8601:"yy-mm-dd",RFC_822:"D, d M y",RFC_850:"DD, dd-M-y",RFC_1036:"D, d M y",RFC_1123:"D, d M yy",RFC_2822:"D, d M yy",RSS:"D, d M y",TICKS:"!",TIMESTAMP:"@",W3C:"yy-mm-dd",_ticksTo1970:(718685+Math.floor(492.5)-Math.floor(19.7)+Math.floor(4.925))*24*60*60*1e7,formatDate:function(e,t,n){if(!t)return"";var r,i=(n?n.dayNamesShort:null)||this._defaults.dayNamesShort,s=(n?n.dayNames:null)||this._defaults.dayNames,o=(n?n.monthNamesShort:null)||this._defaults.monthNamesShort,u=(n?n.monthNames:null)||this._defaults.monthNames,a=function(t){var n=r+1<e.length&&e.charAt(r+1)===t;return n&&r++,n},f=function(e,t,n){var r=""+t;if(a(e))while(r.length<n)r="0"+r;return r},l=function(e,t,n,r){return a(e)?r[t]:n[t]},c="",h=!1;if(t)for(r=0;r<e.length;r++)if(h)e.charAt(r)==="'"&&!a("'")?h=!1:c+=e.charAt(r);else switch(e.charAt(r)){case"d":c+=f("d",t.getDate(),2);break;case"D":c+=l("D",t.getDay(),i,s);break;case"o":c+=f("o",Math.round(((new Date(t.getFullYear(),t.getMonth(),t.getDate())).getTime()-(new Date(t.getFullYear(),0,0)).getTime())/864e5),3);break;case"m":c+=f("m",t.getMonth()+1,2);break;case"M":c+=l("M",t.getMonth(),o,u);break;case"y":c+=a("y")?t.getFullYear():(t.getYear()%100<10?"0":"")+t.getYear()%100;break;case"@":c+=t.getTime();break;case"!":c+=t.getTime()*1e4+this._ticksTo1970;break;case"'":a("'")?c+="'":h=!0;break;default:c+=e.charAt(r)}return c},_possibleChars:function(e){var t,n="",r=!1,i=function(n){var r=t+1<e.length&&e.charAt(t+1)===n;return r&&t++,r};for(t=0;t<e.length;t++)if(r)e.charAt(t)==="'"&&!i("'")?r=!1:n+=e.charAt(t);else switch(e.charAt(t)){case"d":case"m":case"y":case"@":n+="0123456789";break;case"D":case"M":return null;case"'":i("'")?n+="'":r=!0;break;default:n+=e.charAt(t)}return n},_get:function(e,n){return e.settings[n]!==t?e.settings[n]:this._defaults[n]},_setDateFromField:function(e,t){if(e.input.val()===e.lastVal)return;var n=this._get(e,"dateFormat"),r=e.lastVal=e.input?e.input.val():null,i=this._getDefaultDate(e),s=i,o=this._getFormatConfig(e);try{s=this.parseDate(n,r,o)||i}catch(u){r=t?"":r}e.selectedDay=s.getDate(),e.drawMonth=e.selectedMonth=s.getMonth(),e.drawYear=e.selectedYear=s.getFullYear(),e.currentDay=r?s.getDate():0,e.currentMonth=r?s.getMonth():0,e.currentYear=r?s.getFullYear():0,this._adjustInstDate(e)},_getDefaultDate:function(e){return this._restrictMinMax(e,this._determineDate(e,this._get(e,"defaultDate"),new Date))},_determineDate:function(t,n,r){var i=function(e){var t=new Date;return t.setDate(t.getDate()+e),t},s=function(n){try{return e.datepicker.parseDate(e.datepicker._get(t,"dateFormat"),n,e.datepicker._getFormatConfig(t))}catch(r){}var i=(n.toLowerCase().match(/^c/)?e.datepicker._getDate(t):null)||new Date,s=i.getFullYear(),o=i.getMonth(),u=i.getDate(),a=/([+\-]?[0-9]+)\s*(d|D|w|W|m|M|y|Y)?/g,f=a.exec(n);while(f){switch(f[2]||"d"){case"d":case"D":u+=parseInt(f[1],10);break;case"w":case"W":u+=parseInt(f[1],10)*7;break;case"m":case"M":o+=parseInt(f[1],10),u=Math.min(u,e.datepicker._getDaysInMonth(s,o));break;case"y":case"Y":s+=parseInt(f[1],10),u=Math.min(u,e.datepicker._getDaysInMonth(s,o))}f=a.exec(n)}return new Date(s,o,u)},o=n==null||n===""?r:typeof n=="string"?s(n):typeof n=="number"?isNaN(n)?r:i(n):new Date(n.getTime());return o=o&&o.toString()==="Invalid Date"?r:o,o&&(o.setHours(0),o.setMinutes(0),o.setSeconds(0),o.setMilliseconds(0)),this._daylightSavingAdjust(o)},_daylightSavingAdjust:function(e){return e?(e.setHours(e.getHours()>12?e.getHours()+2:0),e):null},_setDate:function(e,t,n){var r=!t,i=e.selectedMonth,s=e.selectedYear,o=this._restrictMinMax(e,this._determineDate(e,t,new Date));e.selectedDay=e.currentDay=o.getDate(),e.drawMonth=e.selectedMonth=e.currentMonth=o.getMonth(),e.drawYear=e.selectedYear=e.currentYear=o.getFullYear(),(i!==e.selectedMonth||s!==e.selectedYear)&&!n&&this._notifyChange(e),this._adjustInstDate(e),e.input&&e.input.val(r?"":this._formatDate(e))},_getDate:function(e){var t=!e.currentYear||e.input&&e.input.val()===""?null:this._daylightSavingAdjust(new Date(e.currentYear,e.currentMonth,e.currentDay));return t},_attachHandlers:function(t){var n=this._get(t,"stepMonths"),i="#"+t.id.replace(/\\\\/g,"\\");t.dpDiv.find("[data-handler]").map(function(){var t={prev:function(){window["DP_jQuery_"+r].datepicker._adjustDate(i,-n,"M")},next:function(){window["DP_jQuery_"+r].datepicker._adjustDate(i,+n,"M")},hide:function(){window["DP_jQuery_"+r].datepicker._hideDatepicker()},today:function(){window["DP_jQuery_"+r].datepicker._gotoToday(i)},selectDay:function(){return window["DP_jQuery_"+r].datepicker._selectDay(i,+this.getAttribute("data-month"),+this.getAttribute("data-year"),this),!1},selectMonth:function(){return window["DP_jQuery_"+r].datepicker._selectMonthYear(i,this,"M"),!1},selectYear:function(){return window["DP_jQuery_"+r].datepicker._selectMonthYear(i,this,"Y"),!1}};e(this).bind(this.getAttribute("data-event"),t[this.getAttribute("data-handler")])})},_generateHTML:function(e){var t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H,B,j,F,I,q=new Date,R=this._daylightSavingAdjust(new Date(q.getFullYear(),q.getMonth(),q.getDate())),U=this._get(e,"isRTL"),z=this._get(e,"showButtonPanel"),W=this._get(e,"hideIfNoPrevNext"),X=this._get(e,"navigationAsDateFormat"),V=this._getNumberOfMonths(e),$=this._get(e,"showCurrentAtPos"),J=this._get(e,"stepMonths"),K=V[0]!==1||V[1]!==1,Q=this._daylightSavingAdjust(e.currentDay?new Date(e.currentYear,e.currentMonth,e.currentDay):new Date(9999,9,9)),G=this._getMinMaxDate(e,"min"),Y=this._getMinMaxDate(e,"max"),Z=e.drawMonth-$,et=e.drawYear;Z<0&&(Z+=12,et--);if(Y){t=this._daylightSavingAdjust(new Date(Y.getFullYear(),Y.getMonth()-V[0]*V[1]+1,Y.getDate())),t=G&&t<G?G:t;while(this._daylightSavingAdjust(new Date(et,Z,1))>t)Z--,Z<0&&(Z=11,et--)}e.drawMonth=Z,e.drawYear=et,n=this._get(e,"prevText"),n=X?this.formatDate(n,this._daylightSavingAdjust(new Date(et,Z-J,1)),this._getFormatConfig(e)):n,r=this._canAdjustMonth(e,-1,et,Z)?"<a class='ui-datepicker-prev ui-corner-all' data-handler='prev' data-event='click' title='"+n+"'><span class='ui-icon ui-icon-circle-triangle-"+(U?"e":"w")+"'>"+n+"</span></a>":W?"":"<a class='ui-datepicker-prev ui-corner-all ui-state-disabled' title='"+n+"'><span class='ui-icon ui-icon-circle-triangle-"+(U?"e":"w")+"'>"+n+"</span></a>",i=this._get(e,"nextText"),i=X?this.formatDate(i,this._daylightSavingAdjust(new Date(et,Z+J,1)),this._getFormatConfig(e)):i,s=this._canAdjustMonth(e,1,et,Z)?"<a class='ui-datepicker-next ui-corner-all' data-handler='next' data-event='click' title='"+i+"'><span class='ui-icon ui-icon-circle-triangle-"+(U?"w":"e")+"'>"+i+"</span></a>":W?"":"<a class='ui-datepicker-next ui-corner-all ui-state-disabled' title='"+i+"'><span class='ui-icon ui-icon-circle-triangle-"+(U?"w":"e")+"'>"+i+"</span></a>",o=this._get(e,"currentText"),u=this._get(e,"gotoCurrent")&&e.currentDay?Q:R,o=X?this.formatDate(o,u,this._getFormatConfig(e)):o,a=e.inline?"":"<button type='button' class='ui-datepicker-close ui-state-default ui-priority-primary ui-corner-all' data-handler='hide' data-event='click'>"+this._get(e,"closeText")+"</button>",f=z?"<div class='ui-datepicker-buttonpane ui-widget-content'>"+(U?a:"")+(this._isInRange(e,u)?"<button type='button' class='ui-datepicker-current ui-state-default ui-priority-secondary ui-corner-all' data-handler='today' data-event='click'>"+o+"</button>":"")+(U?"":a)+"</div>":"",l=parseInt(this._get(e,"firstDay"),10),l=isNaN(l)?0:l,c=this._get(e,"showWeek"),h=this._get(e,"dayNames"),p=this._get(e,"dayNamesMin"),d=this._get(e,"monthNames"),v=this._get(e,"monthNamesShort"),m=this._get(e,"beforeShowDay"),g=this._get(e,"showOtherMonths"),y=this._get(e,"selectOtherMonths"),b=this._getDefaultDate(e),w="",E;for(S=0;S<V[0];S++){x="",this.maxRows=4;for(T=0;T<V[1];T++){N=this._daylightSavingAdjust(new Date(et,Z,e.selectedDay)),C=" ui-corner-all",k="";if(K){k+="<div class='ui-datepicker-group";if(V[1]>1)switch(T){case 0:k+=" ui-datepicker-group-first",C=" ui-corner-"+(U?"right":"left");break;case V[1]-1:k+=" ui-datepicker-group-last",C=" ui-corner-"+(U?"left":"right");break;default:k+=" ui-datepicker-group-middle",C=""}k+="'>"}k+="<div class='ui-datepicker-header ui-widget-header ui-helper-clearfix"+C+"'>"+(/all|left/.test(C)&&S===0?U?s:r:"")+(/all|right/.test(C)&&S===0?U?r:s:"")+this._generateMonthYearHeader(e,Z,et,G,Y,S>0||T>0,d,v)+"</div><table class='ui-datepicker-calendar'><thead>"+"<tr>",L=c?"<th class='ui-datepicker-week-col'>"+this._get(e,"weekHeader")+"</th>":"";for(E=0;E<7;E++)A=(E+l)%7,L+="<th"+((E+l+6)%7>=5?" class='ui-datepicker-week-end'":"")+">"+"<span title='"+h[A]+"'>"+p[A]+"</span></th>";k+=L+"</tr></thead><tbody>",O=this._getDaysInMonth(et,Z),et===e.selectedYear&&Z===e.selectedMonth&&(e.selectedDay=Math.min(e.selectedDay,O)),M=(this._getFirstDayOfMonth(et,Z)-l+7)%7,_=Math.ceil((M+O)/7),D=K?this.maxRows>_?this.maxRows:_:_,this.maxRows=D,P=this._daylightSavingAdjust(new Date(et,Z,1-M));for(H=0;H<D;H++){k+="<tr>",B=c?"<td class='ui-datepicker-week-col'>"+this._get(e,"calculateWeek")(P)+"</td>":"";for(E=0;E<7;E++)j=m?m.apply(e.input?e.input[0]:null,[P]):[!0,""],F=P.getMonth()!==Z,I=F&&!y||!j[0]||G&&P<G||Y&&P>Y,B+="<td class='"+((E+l+6)%7>=5?" ui-datepicker-week-end":"")+(F?" ui-datepicker-other-month":"")+(P.getTime()===N.getTime()&&Z===e.selectedMonth&&e._keyEvent||b.getTime()===P.getTime()&&b.getTime()===N.getTime()?" "+this._dayOverClass:"")+(I?" "+this._unselectableClass+" ui-state-disabled":"")+(F&&!g?"":" "+j[1]+(P.getTime()===Q.getTime()?" "+this._currentClass:"")+(P.getTime()===R.getTime()?" ui-datepicker-today":""))+"'"+((!F||g)&&j[2]?" title='"+j[2].replace(/'/g,"&#39;")+"'":"")+(I?"":" data-handler='selectDay' data-event='click' data-month='"+P.getMonth()+"' data-year='"+P.getFullYear()+"'")+">"+(F&&!g?"&#xa0;":I?"<span class='ui-state-default'>"+P.getDate()+"</span>":"<a class='ui-state-default"+(P.getTime()===R.getTime()?" ui-state-highlight":"")+(P.getTime()===Q.getTime()?" ui-state-active":"")+(F?" ui-priority-secondary":"")+"' href='#'>"+P.getDate()+"</a>")+"</td>",P.setDate(P.getDate()+1),P=this._daylightSavingAdjust(P);k+=B+"</tr>"}Z++,Z>11&&(Z=0,et++),k+="</tbody></table>"+(K?"</div>"+(V[0]>0&&T===V[1]-1?"<div class='ui-datepicker-row-break'></div>":""):""),x+=k}w+=x}return w+=f,e._keyEvent=!1,w},_generateMonthYearHeader:function(e,t,n,r,i,s,o,u){var a,f,l,c,h,p,d,v,m=this._get(e,"changeMonth"),g=this._get(e,"changeYear"),y=this._get(e,"showMonthAfterYear"),b="<div class='ui-datepicker-title'>",w="";if(s||!m)w+="<span class='ui-datepicker-month'>"+o[t]+"</span>";else{a=r&&r.getFullYear()===n,f=i&&i.getFullYear()===n,w+="<select class='ui-datepicker-month' data-handler='selectMonth' data-event='change'>";for(l=0;l<12;l++)(!a||l>=r.getMonth())&&(!f||l<=i.getMonth())&&(w+="<option value='"+l+"'"+(l===t?" selected='selected'":"")+">"+u[l]+"</option>");w+="</select>"}y||(b+=w+(s||!m||!g?"&#xa0;":""));if(!e.yearshtml){e.yearshtml="";if(s||!g)b+="<span class='ui-datepicker-year'>"+n+"</span>";else{c=this._get(e,"yearRange").split(":"),h=(new Date).getFullYear(),p=function(e){var t=e.match(/c[+\-].*/)?n+parseInt(e.substring(1),10):e.match(/[+\-].*/)?h+parseInt(e,10):parseInt(e,10);return isNaN(t)?h:t},d=p(c[0]),v=Math.max(d,p(c[1]||"")),d=r?Math.max(d,r.getFullYear()):d,v=i?Math.min(v,i.getFullYear()):v,e.yearshtml+="<select class='ui-datepicker-year' data-handler='selectYear' data-event='change'>";for(;d<=v;d++)e.yearshtml+="<option value='"+d+"'"+(d===n?" selected='selected'":"")+">"+d+"</option>";e.yearshtml+="</select>",b+=e.yearshtml,e.yearshtml=null}}return b+=this._get(e,"yearSuffix"),y&&(b+=(s||!m||!g?"&#xa0;":"")+w),b+="</div>",b},_adjustInstDate:function(e,t,n){var r=e.drawYear+(n==="Y"?t:0),i=e.drawMonth+(n==="M"?t:0),s=Math.min(e.selectedDay,this._getDaysInMonth(r,i))+(n==="D"?t:0),o=this._restrictMinMax(e,this._daylightSavingAdjust(new Date(r,i,s)));e.selectedDay=o.getDate(),e.drawMonth=e.selectedMonth=o.getMonth(),e.drawYear=e.selectedYear=o.getFullYear(),(n==="M"||n==="Y")&&this._notifyChange(e)},_restrictMinMax:function(e,t){var n=this._getMinMaxDate(e,"min"),r=this._getMinMaxDate(e,"max"),i=n&&t<n?n:t;return r&&i>r?r:i},_notifyChange:function(e){var t=this._get(e,"onChangeMonthYear");t&&t.apply(e.input?e.input[0]:null,[e.selectedYear,e.selectedMonth+1,e])},_getNumberOfMonths:function(e){var t=this._get(e,"numberOfMonths");return t==null?[1,1]:typeof t=="number"?[1,t]:t},_getMinMaxDate:function(e,t){return this._determineDate(e,this._get(e,t+"Date"),null)},_getDaysInMonth:function(e,t){return 32-this._daylightSavingAdjust(new Date(e,t,32)).getDate()},_getFirstDayOfMonth:function(e,t){return(new Date(e,t,1)).getDay()},_canAdjustMonth:function(e,t,n,r){var i=this._getNumberOfMonths(e),s=this._daylightSavingAdjust(new Date(n,r+(t<0?t:i[0]*i[1]),1));return t<0&&s.setDate(this._getDaysInMonth(s.getFullYear(),s.getMonth())),this._isInRange(e,s)},_isInRange:function(e,t){var n,r,i=this._getMinMaxDate(e,"min"),s=this._getMinMaxDate(e,"max"),o=null,u=null,a=this._get(e,"yearRange");return a&&(n=a.split(":"),r=(new Date).getFullYear(),o=parseInt(n[0],10),u=parseInt(n[1],10),n[0].match(/[+\-].*/)&&(o+=r),n[1].match(/[+\-].*/)&&(u+=r)),(!i||t.getTime()>=i.getTime())&&(!s||t.getTime()<=s.getTime())&&(!o||t.getFullYear()>=o)&&(!u||t.getFullYear()<=u)},_getFormatConfig:function(e){var t=this._get(e,"shortYearCutoff");return t=typeof t!="string"?t:(new Date).getFullYear()%100+parseInt(t,10),{shortYearCutoff:t,dayNamesShort:this._get(e,"dayNamesShort"),dayNames:this._get(e,"dayNames"),monthNamesShort:this._get(e,"monthNamesShort"),monthNames:this._get(e,"monthNames")}},_formatDate:function(e,t,n,r){t||(e.currentDay=e.selectedDay,e.currentMonth=e.selectedMonth,e.currentYear=e.selectedYear);var i=t?typeof t=="object"?t:this._daylightSavingAdjust(new Date(r,n,t)):this._daylightSavingAdjust(new Date(e.currentYear,e.currentMonth,e.currentDay));return this.formatDate(this._get(e,"dateFormat"),i,this._getFormatConfig(e))}}),e.fn.datepicker=function(t){if(!this.length)return this;e.datepicker.initialized||(e(document).mousedown(e.datepicker._checkExternalClick),e.datepicker.initialized=!0),e("#"+e.datepicker._mainDivId).length===0&&e("body").append(e.datepicker.dpDiv);var n=Array.prototype.slice.call(arguments,1);return typeof t!="string"||t!=="isDisabled"&&t!=="getDate"&&t!=="widget"?t==="option"&&arguments.length===2&&typeof arguments[1]=="string"?e.datepicker["_"+t+"Datepicker"].apply(e.datepicker,[this[0]].concat(n)):this.each(function(){typeof t=="string"?e.datepicker["_"+t+"Datepicker"].apply(e.datepicker,[this].concat(n)):e.datepicker._attachDatepicker(this,t)}):e.datepicker["_"+t+"Datepicker"].apply(e.datepicker,[this[0]].concat(n))},e.datepicker=new s,e.datepicker.initialized=!1,e.datepicker.uuid=(new Date).getTime(),e.datepicker.version="1.10.1",window["DP_jQuery_"+r]=e}(jQuery),function(e,t){var n={buttons:!0,height:!0,maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0,width:!0},r={maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0};e.widget("ui.dialog",{version:"1.10.1",options:{appendTo:"body",autoOpen:!0,buttons:[],closeOnEscape:!0,closeText:"close",dialogClass:"",draggable:!0,hide:null,height:"auto",maxHeight:null,maxWidth:null,minHeight:150,minWidth:150,modal:!1,position:{my:"center",at:"center",of:window,collision:"fit",using:function(t){var n=e(this).css(t).offset().top;n<0&&e(this).css("top",t.top-n)}},resizable:!0,show:null,title:null,width:300,beforeClose:null,close:null,drag:null,dragStart:null,dragStop:null,focus:null,open:null,resize:null,resizeStart:null,resizeStop:null},_create:function(){this.originalCss={display:this.element[0].style.display,width:this.element[0].style.width,minHeight:this.element[0].style.minHeight,maxHeight:this.element[0].style.maxHeight,height:this.element[0].style.height},this.originalPosition={parent:this.element.parent(),index:this.element.parent().children().index(this.element)},this.originalTitle=this.element.attr("title"),this.options.title=this.options.title||this.originalTitle,this._createWrapper(),this.element.show().removeAttr("title").addClass("ui-dialog-content ui-widget-content").appendTo(this.uiDialog),this._createTitlebar(),this._createButtonPane(),this.options.draggable&&e.fn.draggable&&this._makeDraggable(),this.options.resizable&&e.fn.resizable&&this._makeResizable(),this._isOpen=!1},_init:function(){this.options.autoOpen&&this.open()},_appendTo:function(){var t=this.options.appendTo;return t&&(t.jquery||t.nodeType)?e(t):this.document.find(t||"body").eq(0)},_destroy:function(){var e,t=this.originalPosition;this._destroyOverlay(),this.element.removeUniqueId().removeClass("ui-dialog-content ui-widget-content").css(this.originalCss).detach(),this.uiDialog.stop(!0,!0).remove(),this.originalTitle&&this.element.attr("title",this.originalTitle),e=t.parent.children().eq(t.index),e.length&&e[0]!==this.element[0]?e.before(this.element):t.parent.append(this.element)},widget:function(){return this.uiDialog},disable:e.noop,enable:e.noop,close:function(t){var n=this;if(!this._isOpen||this._trigger("beforeClose",t)===!1)return;this._isOpen=!1,this._destroyOverlay(),this.opener.filter(":focusable").focus().length||e(this.document[0].activeElement).blur(),this._hide(this.uiDialog,this.options.hide,function(){n._trigger("close",t)})},isOpen:function(){return this._isOpen},moveToTop:function(){this._moveToTop()},_moveToTop:function(e,t){var n=!!this.uiDialog.nextAll(":visible").insertBefore(this.uiDialog).length;return n&&!t&&this._trigger("focus",e),n},open:function(){var t=this;if(this._isOpen){this._moveToTop()&&this._focusTabbable();return}this._isOpen=!0,this.opener=e(this.document[0].activeElement),this._size(),this._position(),this._createOverlay(),this._moveToTop(null,!0),this._show(this.uiDialog,this.options.show,function(){t._focusTabbable(),t._trigger("focus")}),this._trigger("open")},_focusTabbable:function(){var e=this.element.find("[autofocus]");e.length||(e=this.element.find(":tabbable")),e.length||(e=this.uiDialogButtonPane.find(":tabbable")),e.length||(e=this.uiDialogTitlebarClose.filter(":tabbable")),e.length||(e=this.uiDialog),e.eq(0).focus()},_keepFocus:function(t){function n(){var t=this.document[0].activeElement,n=this.uiDialog[0]===t||e.contains(this.uiDialog[0],t);n||this._focusTabbable()}t.preventDefault(),n.call(this),this._delay(n)},_createWrapper:function(){this.uiDialog=e("<div>").addClass("ui-dialog ui-widget ui-widget-content ui-corner-all ui-front "+this.options.dialogClass).hide().attr({tabIndex:-1,role:"dialog"}).appendTo(this._appendTo()),this._on(this.uiDialog,{keydown:function(t){if(this.options.closeOnEscape&&!t.isDefaultPrevented()&&t.keyCode&&t.keyCode===e.ui.keyCode.ESCAPE){t.preventDefault(),this.close(t);return}if(t.keyCode!==e.ui.keyCode.TAB)return;var n=this.uiDialog.find(":tabbable"),r=n.filter(":first"),i=n.filter(":last");t.target!==i[0]&&t.target!==this.uiDialog[0]||!!t.shiftKey?(t.target===r[0]||t.target===this.uiDialog[0])&&t.shiftKey&&(i.focus(1),t.preventDefault()):(r.focus(1),t.preventDefault())},mousedown:function(e){this._moveToTop(e)&&this._focusTabbable()}}),this.element.find("[aria-describedby]").length||this.uiDialog.attr({"aria-describedby":this.element.uniqueId().attr("id")})},_createTitlebar:function(){var t;this.uiDialogTitlebar=e("<div>").addClass("ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix").prependTo(this.uiDialog),this._on(this.uiDialogTitlebar,{mousedown:function(t){e(t.target).closest(".ui-dialog-titlebar-close")||this.uiDialog.focus()}}),this.uiDialogTitlebarClose=e("<button></button>").button({label:this.options.closeText,icons:{primary:"ui-icon-closethick"},text:!1}).addClass("ui-dialog-titlebar-close").appendTo(this.uiDialogTitlebar),this._on(this.uiDialogTitlebarClose,{click:function(e){e.preventDefault(),this.close(e)}}),t=e("<span>").uniqueId().addClass("ui-dialog-title").prependTo(this.uiDialogTitlebar),this._title(t),this.uiDialog.attr({"aria-labelledby":t.attr("id")})},_title:function(e){this.options.title||e.html("&#160;"),e.text(this.options.title)},_createButtonPane:function(){this.uiDialogButtonPane=e("<div>").addClass("ui-dialog-buttonpane ui-widget-content ui-helper-clearfix"),this.uiButtonSet=e("<div>").addClass("ui-dialog-buttonset").appendTo(this.uiDialogButtonPane),this._createButtons()},_createButtons:function(){var t=this,n=this.options.buttons;this.uiDialogButtonPane.remove(),this.uiButtonSet.empty();if(e.isEmptyObject(n)||e.isArray(n)&&!n.length){this.uiDialog.removeClass("ui-dialog-buttons");return}e.each(n,function(n,r){var i,s;r=e.isFunction(r)?{click:r,text:n}:r,r=e.extend({type:"button"},r),i=r.click,r.click=function(){i.apply(t.element[0],arguments)},s={icons:r.icons,text:r.showText},delete r.icons,delete r.showText,e("<button></button>",r).button(s).appendTo(t.uiButtonSet)}),this.uiDialog.addClass("ui-dialog-buttons"),this.uiDialogButtonPane.appendTo(this.uiDialog)},_makeDraggable:function(){function r(e){return{position:e.position,offset:e.offset}}var t=this,n=this.options;this.uiDialog.draggable({cancel:".ui-dialog-content, .ui-dialog-titlebar-close",handle:".ui-dialog-titlebar",containment:"document",start:function(n,i){e(this).addClass("ui-dialog-dragging"),t._blockFrames(),t._trigger("dragStart",n,r(i))},drag:function(e,n){t._trigger("drag",e,r(n))},stop:function(i,s){n.position=[s.position.left-t.document.scrollLeft(),s.position.top-t.document.scrollTop()],e(this).removeClass("ui-dialog-dragging"),t._unblockFrames(),t._trigger("dragStop",i,r(s))}})},_makeResizable:function(){function o(e){return{originalPosition:e.originalPosition,originalSize:e.originalSize,position:e.position,size:e.size}}var t=this,n=this.options,r=n.resizable,i=this.uiDialog.css("position"),s=typeof r=="string"?r:"n,e,s,w,se,sw,ne,nw";this.uiDialog.resizable({cancel:".ui-dialog-content",containment:"document",alsoResize:this.element,maxWidth:n.maxWidth,maxHeight:n.maxHeight,minWidth:n.minWidth,minHeight:this._minHeight(),handles:s,start:function(n,r){e(this).addClass("ui-dialog-resizing"),t._blockFrames(),t._trigger("resizeStart",n,o(r))},resize:function(e,n){t._trigger("resize",e,o(n))},stop:function(r,i){n.height=e(this).height(),n.width=e(this).width(),e(this).removeClass("ui-dialog-resizing"),t._unblockFrames(),t._trigger("resizeStop",r,o(i))}}).css("position",i)},_minHeight:function(){var e=this.options;return e.height==="auto"?e.minHeight:Math.min(e.minHeight,e.height)},_position:function(){var e=this.uiDialog.is(":visible");e||this.uiDialog.show(),this.uiDialog.position(this.options.position),e||this.uiDialog.hide()},_setOptions:function(t){var i=this,s=!1,o={};e.each(t,function(e,t){i._setOption(e,t),e in n&&(s=!0),e in r&&(o[e]=t)}),s&&(this._size(),this._position()),this.uiDialog.is(":data(ui-resizable)")&&this.uiDialog.resizable("option",o)},_setOption:function(e,t){var n,r,i=this.uiDialog;e==="dialogClass"&&i.removeClass(this.options.dialogClass).addClass(t);if(e==="disabled")return;this._super(e,t),e==="appendTo"&&this.uiDialog.appendTo(this._appendTo()),e==="buttons"&&this._createButtons(),e==="closeText"&&this.uiDialogTitlebarClose.button({label:""+t}),e==="draggable"&&(n=i.is(":data(ui-draggable)"),n&&!t&&i.draggable("destroy"),!n&&t&&this._makeDraggable()),e==="position"&&this._position(),e==="resizable"&&(r=i.is(":data(ui-resizable)"),r&&!t&&i.resizable("destroy"),r&&typeof t=="string"&&i.resizable("option","handles",t),!r&&t!==!1&&this._makeResizable()),e==="title"&&this._title(this.uiDialogTitlebar.find(".ui-dialog-title"))},_size:function(){var e,t,n,r=this.options;this.element.show().css({width:"auto",minHeight:0,maxHeight:"none",height:0}),r.minWidth>r.width&&(r.width=r.minWidth),e=this.uiDialog.css({height:"auto",width:r.width}).outerHeight(),t=Math.max(0,r.minHeight-e),n=typeof r.maxHeight=="number"?Math.max(0,r.maxHeight-e):"none",r.height==="auto"?this.element.css({minHeight:t,maxHeight:n,height:"auto"}):this.element.height(Math.max(0,r.height-e)),this.uiDialog.is(":data(ui-resizable)")&&this.uiDialog.resizable("option","minHeight",this._minHeight())},_blockFrames:function(){this.iframeBlocks=this.document.find("iframe").map(function(){var t=e(this);return e("<div>").css({position:"absolute",width:t.outerWidth(),height:t.outerHeight()}).appendTo(t.parent()).offset(t.offset())[0]})},_unblockFrames:function(){this.iframeBlocks&&(this.iframeBlocks.remove(),delete this.iframeBlocks)},_createOverlay:function(){if(!this.options.modal)return;e.ui.dialog.overlayInstances||this._delay(function(){e.ui.dialog.overlayInstances&&this.document.bind("focusin.dialog",function(t){!e(t.target).closest(".ui-dialog").length&&!e(t.target).closest(".ui-datepicker").length&&(t.preventDefault(),e(".ui-dialog:visible:last .ui-dialog-content").data("ui-dialog")._focusTabbable())})}),this.overlay=e("<div>").addClass("ui-widget-overlay ui-front").appendTo(this._appendTo()),this._on(this.overlay,{mousedown:"_keepFocus"}),e.ui.dialog.overlayInstances++},_destroyOverlay:function(){if(!this.options.modal)return;this.overlay&&(e.ui.dialog.overlayInstances--,e.ui.dialog.overlayInstances||this.document.unbind("focusin.dialog"),this.overlay.remove(),this.overlay=null)}}),e.ui.dialog.overlayInstances=0,e.uiBackCompat!==!1&&e.widget("ui.dialog",e.ui.dialog,{_position:function(){var t=this.options.position,n=[],r=[0,0],i;if(t){if(typeof t=="string"||typeof t=="object"&&"0"in t)n=t.split?t.split(" "):[t[0],t[1]],n.length===1&&(n[1]=n[0]),e.each(["left","top"],function(e,t){+n[e]===n[e]&&(r[e]=n[e],n[e]=t)}),t={my:n[0]+(r[0]<0?r[0]:"+"+r[0])+" "+n[1]+(r[1]<0?r[1]:"+"+r[1]),at:n.join(" ")};t=e.extend({},e.ui.dialog.prototype.options.position,t)}else t=e.ui.dialog.prototype.options.position;i=this.uiDialog.is(":visible"),i||this.uiDialog.show(),this.uiDialog.position(t),i||this.uiDialog.hide()}})}(jQuery),function(e,t){var n=/up|down|vertical/,r=/up|left|vertical|horizontal/;e.effects.effect.blind=function(t,i){var s=e(this),o=["position","top","bottom","left","right","height","width"],u=e.effects.setMode(s,t.mode||"hide"),a=t.direction||"up",f=n.test(a),l=f?"height":"width",c=f?"top":"left",h=r.test(a),p={},d=u==="show",v,m,g;s.parent().is(".ui-effects-wrapper")?e.effects.save(s.parent(),o):e.effects.save(s,o),s.show(),v=e.effects.createWrapper(s).css({overflow:"hidden"}),m=v[l](),g=parseFloat(v.css(c))||0,p[l]=d?m:0,h||(s.css(f?"bottom":"right",0).css(f?"top":"left","auto").css({position:"absolute"}),p[c]=d?g:m+g),d&&(v.css(l,0),h||v.css(c,g+m)),v.animate(p,{duration:t.duration,easing:t.easing,queue:!1,complete:function(){u==="hide"&&s.hide(),e.effects.restore(s,o),e.effects.removeWrapper(s),i()}})}}(jQuery),function(e,t){e.effects.effect.bounce=function(t,n){var r=e(this),i=["position","top","bottom","left","right","height","width"],s=e.effects.setMode(r,t.mode||"effect"),o=s==="hide",u=s==="show",a=t.direction||"up",f=t.distance,l=t.times||5,c=l*2+(u||o?1:0),h=t.duration/c,p=t.easing,d=a==="up"||a==="down"?"top":"left",v=a==="up"||a==="left",m,g,y,b=r.queue(),w=b.length;(u||o)&&i.push("opacity"),e.effects.save(r,i),r.show(),e.effects.createWrapper(r),f||(f=r[d==="top"?"outerHeight":"outerWidth"]()/3),u&&(y={opacity:1},y[d]=0,r.css("opacity",0).css(d,v?-f*2:f*2).animate(y,h,p)),o&&(f/=Math.pow(2,l-1)),y={},y[d]=0;for(m=0;m<l;m++)g={},g[d]=(v?"-=":"+=")+f,r.animate(g,h,p).animate(y,h,p),f=o?f*2:f/2;o&&(g={opacity:0},g[d]=(v?"-=":"+=")+f,r.animate(g,h,p)),r.queue(function(){o&&r.hide(),e.effects.restore(r,i),e.effects.removeWrapper(r),n()}),w>1&&b.splice.apply(b,[1,0].concat(b.splice(w,c+1))),r.dequeue()}}(jQuery),function(e,t){e.effects.effect.clip=function(t,n){var r=e(this),i=["position","top","bottom","left","right","height","width"],s=e.effects.setMode(r,t.mode||"hide"),o=s==="show",u=t.direction||"vertical",a=u==="vertical",f=a?"height":"width",l=a?"top":"left",c={},h,p,d;e.effects.save(r,i),r.show(),h=e.effects.createWrapper(r).css({overflow:"hidden"}),p=r[0].tagName==="IMG"?h:r,d=p[f](),o&&(p.css(f,0),p.css(l,d/2)),c[f]=o?d:0,c[l]=o?0:d/2,p.animate(c,{queue:!1,duration:t.duration,easing:t.easing,complete:function(){o||r.hide(),e.effects.restore(r,i),e.effects.removeWrapper(r),n()}})}}(jQuery),function(e,t){e.effects.effect.drop=function(t,n){var r=e(this),i=["position","top","bottom","left","right","opacity","height","width"],s=e.effects.setMode(r,t.mode||"hide"),o=s==="show",u=t.direction||"left",a=u==="up"||u==="down"?"top":"left",f=u==="up"||u==="left"?"pos":"neg",l={opacity:o?1:0},c;e.effects.save(r,i),r.show(),e.effects.createWrapper(r),c=t.distance||r[a==="top"?"outerHeight":"outerWidth"](!0)/2,o&&r.css("opacity",0).css(a,f==="pos"?-c:c),l[a]=(o?f==="pos"?"+=":"-=":f==="pos"?"-=":"+=")+c,r.animate(l,{queue:!1,duration:t.duration,easing:t.easing,complete:function(){s==="hide"&&r.hide(),e.effects.restore(r,i),e.effects.removeWrapper(r),n()}})}}(jQuery),function(e,t){e.effects.effect.explode=function(t,n){function y(){c.push(this),c.length===r*i&&b()}function b(){s.css({visibility:"visible"}),e(c).remove(),u||s.hide(),n()}var r=t.pieces?Math.round(Math.sqrt(t.pieces)):3,i=r,s=e(this),o=e.effects.setMode(s,t.mode||"hide"),u=o==="show",a=s.show().css("visibility","hidden").offset(),f=Math.ceil(s.outerWidth()/i),l=Math.ceil(s.outerHeight()/r),c=[],h,p,d,v,m,g;for(h=0;h<r;h++){v=a.top+h*l,g=h-(r-1)/2;for(p=0;p<i;p++)d=a.left+p*f,m=p-(i-1)/2,s.clone().appendTo("body").wrap("<div></div>").css({position:"absolute",visibility:"visible",left:-p*f,top:-h*l}).parent().addClass("ui-effects-explode").css({position:"absolute",overflow:"hidden",width:f,height:l,left:d+(u?m*f:0),top:v+(u?g*l:0),opacity:u?0:1}).animate({left:d+(u?0:m*f),top:v+(u?0:g*l),opacity:u?1:0},t.duration||500,t.easing,y)}}}(jQuery),function(e,t){e.effects.effect.fade=function(t,n){var r=e(this),i=e.effects.setMode(r,t.mode||"toggle");r.animate({opacity:i},{queue:!1,duration:t.duration,easing:t.easing,complete:n})}}(jQuery),function(e,t){e.effects.effect.fold=function(t,n){var r=e(this),i=["position","top","bottom","left","right","height","width"],s=e.effects.setMode(r,t.mode||"hide"),o=s==="show",u=s==="hide",a=t.size||15,f=/([0-9]+)%/.exec(a),l=!!t.horizFirst,c=o!==l,h=c?["width","height"]:["height","width"],p=t.duration/2,d,v,m={},g={};e.effects.save(r,i),r.show(),d=e.effects.createWrapper(r).css({overflow:"hidden"}),v=c?[d.width(),d.height()]:[d.height(),d.width()],f&&(a=parseInt(f[1],10)/100*v[u?0:1]),o&&d.css(l?{height:0,width:a}:{height:a,width:0}),m[h[0]]=o?v[0]:a,g[h[1]]=o?v[1]:0,d.animate(m,p,t.easing).animate(g,p,t.easing,function(){u&&r.hide(),e.effects.restore(r,i),e.effects.removeWrapper(r),n()})}}(jQuery),function(e,t){e.effects.effect.highlight=function(t,n){var r=e(this),i=["backgroundImage","backgroundColor","opacity"],s=e.effects.setMode(r,t.mode||"show"),o={backgroundColor:r.css("backgroundColor")};s==="hide"&&(o.opacity=0),e.effects.save(r,i),r.show().css({backgroundImage:"none",backgroundColor:t.color||"#ffff99"}).animate(o,{queue:!1,duration:t.duration,easing:t.easing,complete:function(){s==="hide"&&r.hide(),e.effects.restore(r,i),n()}})}}(jQuery),function(e,t){e.effects.effect.pulsate=function(t,n){var r=e(this),i=e.effects.setMode(r,t.mode||"show"),s=i==="show",o=i==="hide",u=s||i==="hide",a=(t.times||5)*2+(u?1:0),f=t.duration/a,l=0,c=r.queue(),h=c.length,p;if(s||!r.is(":visible"))r.css("opacity",0).show(),l=1;for(p=1;p<a;p++)r.animate({opacity:l},f,t.easing),l=1-l;r.animate({opacity:l},f,t.easing),r.queue(function(){o&&r.hide(),n()}),h>1&&c.splice.apply(c,[1,0].concat(c.splice(h,a+1))),r.dequeue()}}(jQuery),function(e,t){e.effects.effect.puff=function(t,n){var r=e(this),i=e.effects.setMode(r,t.mode||"hide"),s=i==="hide",o=parseInt(t.percent,10)||150,u=o/100,a={height:r.height(),width:r.width(),outerHeight:r.outerHeight(),outerWidth:r.outerWidth()};e.extend(t,{effect:"scale",queue:!1,fade:!0,mode:i,complete:n,percent:s?o:100,from:s?a:{height:a.height*u,width:a.width*u,outerHeight:a.outerHeight*u,outerWidth:a.outerWidth*u}}),r.effect(t)},e.effects.effect.scale=function(t,n){var r=e(this),i=e.extend(!0,{},t),s=e.effects.setMode(r,t.mode||"effect"),o=parseInt(t.percent,10)||(parseInt(t.percent,10)===0?0:s==="hide"?0:100),u=t.direction||"both",a=t.origin,f={height:r.height(),width:r.width(),outerHeight:r.outerHeight(),outerWidth:r.outerWidth()},l={y:u!=="horizontal"?o/100:1,x:u!=="vertical"?o/100:1};i.effect="size",i.queue=!1,i.complete=n,s!=="effect"&&(i.origin=a||["middle","center"],i.restore=!0),i.from=t.from||(s==="show"?{height:0,width:0,outerHeight:0,outerWidth:0}:f),i.to={height:f.height*l.y,width:f.width*l.x,outerHeight:f.outerHeight*l.y,outerWidth:f.outerWidth*l.x},i.fade&&(s==="show"&&(i.from.opacity=0,i.to.opacity=1),s==="hide"&&(i.from.opacity=1,i.to.opacity=0)),r.effect(i)},e.effects.effect.size=function(t,n){var r,i,s,o=e(this),u=["position","top","bottom","left","right","width","height","overflow","opacity"],a=["position","top","bottom","left","right","overflow","opacity"],f=["width","height","overflow"],l=["fontSize"],c=["borderTopWidth","borderBottomWidth","paddingTop","paddingBottom"],h=["borderLeftWidth","borderRightWidth","paddingLeft","paddingRight"],p=e.effects.setMode(o,t.mode||"effect"),d=t.restore||p!=="effect",v=t.scale||"both",m=t.origin||["middle","center"],g=o.css("position"),y=d?u:a,b={height:0,width:0,outerHeight:0,outerWidth:0};p==="show"&&o.show(),r={height:o.height(),width:o.width(),outerHeight:o.outerHeight(),outerWidth:o.outerWidth()},t.mode==="toggle"&&p==="show"?(o.from=t.to||b,o.to=t.from||r):(o.from=t.from||(p==="show"?b:r),o.to=t.to||(p==="hide"?b:r)),s={from:{y:o.from.height/r.height,x:o.from.width/r.width},to:{y:o.to.height/r.height,x:o.to.width/r.width}};if(v==="box"||v==="both")s.from.y!==s.to.y&&(y=y.concat(c),o.from=e.effects.setTransition(o,c,s.from.y,o.from),o.to=e.effects.setTransition(o,c,s.to.y,o.to)),s.from.x!==s.to.x&&(y=y.concat(h),o.from=e.effects.setTransition(o,h,s.from.x,o.from),o.to=e.effects.setTransition(o,h,s.to.x,o.to));(v==="content"||v==="both")&&s.from.y!==s.to.y&&(y=y.concat(l).concat(f),o.from=e.effects.setTransition(o,l,s.from.y,o.from),o.to=e.effects.setTransition(o,l,s.to.y,o.to)),e.effects.save(o,y),o.show(),e.effects.createWrapper(o),o.css("overflow","hidden").css(o.from),m&&(i=e.effects.getBaseline(m,r),o.from.top=(r.outerHeight-o.outerHeight())*i.y,o.from.left=(r.outerWidth-o.outerWidth())*i.x,o.to.top=(r.outerHeight-o.to.outerHeight)*i.y,o.to.left=(r.outerWidth-o.to.outerWidth)*i.x),o.css(o.from);if(v==="content"||v==="both")c=c.concat(["marginTop","marginBottom"]).concat(l),h=h.concat(["marginLeft","marginRight"]),f=u.concat(c).concat(h),o.find("*[width]").each(function(){var n=e(this),r={height:n.height(),width:n.width(),outerHeight:n.outerHeight(),outerWidth:n.outerWidth()};d&&e.effects.save(n,f),n.from={height:r.height*s.from.y,width:r.width*s.from.x,outerHeight:r.outerHeight*s.from.y,outerWidth:r.outerWidth*s.from.x},n.to={height:r.height*s.to.y,width:r.width*s.to.x,outerHeight:r.height*s.to.y,outerWidth:r.width*s.to.x},s.from.y!==s.to.y&&(n.from=e.effects.setTransition(n,c,s.from.y,n.from),n.to=e.effects.setTransition(n,c,s.to.y,n.to)),s.from.x!==s.to.x&&(n.from=e.effects.setTransition(n,h,s.from.x,n.from),n.to=e.effects.setTransition(n,h,s.to.x,n.to)),n.css(n.from),n.animate(n.to,t.duration,t.easing,function(){d&&e.effects.restore(n,f)})});o.animate(o.to,{queue:!1,duration:t.duration,easing:t.easing,complete:function(){o.to.opacity===0&&o.css("opacity",o.from.opacity),p==="hide"&&o.hide(),e.effects.restore(o,y),d||(g==="static"?o.css({position:"relative",top:o.to.top,left:o.to.left}):e.each(["top","left"],function(e,t){o.css(t,function(t,n){var r=parseInt(n,10),i=e?o.to.left:o.to.top;return n==="auto"?i+"px":r+i+"px"})})),e.effects.removeWrapper(o),n()}})}}(jQuery),function(e,t){e.effects.effect.shake=function(t,n){var r=e(this),i=["position","top","bottom","left","right","height","width"],s=e.effects.setMode(r,t.mode||"effect"),o=t.direction||"left",u=t.distance||20,a=t.times||3,f=a*2+1,l=Math.round(t.duration/f),c=o==="up"||o==="down"?"top":"left",h=o==="up"||o==="left",p={},d={},v={},m,g=r.queue(),y=g.length;e.effects.save(r,i),r.show(),e.effects.createWrapper(r),p[c]=(h?"-=":"+=")+u,d[c]=(h?"+=":"-=")+u*2,v[c]=(h?"-=":"+=")+u*2,r.animate(p,l,t.easing);for(m=1;m<a;m++)r.animate(d,l,t.easing).animate(v,l,t.easing);r.animate(d,l,t.easing).animate(p,l/2,t.easing).queue(function(){s==="hide"&&r.hide(),e.effects.restore(r,i),e.effects.removeWrapper(r),n()}),y>1&&g.splice.apply(g,[1,0].concat(g.splice(y,f+1))),r.dequeue()}}(jQuery),function(e,t){e.effects.effect.slide=function(t,n){var r=e(this),i=["position","top","bottom","left","right","width","height"],s=e.effects.setMode(r,t.mode||"show"),o=s==="show",u=t.direction||"left",a=u==="up"||u==="down"?"top":"left",f=u==="up"||u==="left",l,c={};e.effects.save(r,i),r.show(),l=t.distance||r[a==="top"?"outerHeight":"outerWidth"](!0),e.effects.createWrapper(r).css({overflow:"hidden"}),o&&r.css(a,f?isNaN(l)?"-"+l:-l:l),c[a]=(o?f?"+=":"-=":f?"-=":"+=")+l,r.animate(c,{queue:!1,duration:t.duration,easing:t.easing,complete:function(){s==="hide"&&r.hide(),e.effects.restore(r,i),e.effects.removeWrapper(r),n()}})}}(jQuery),function(e,t){e.effects.effect.transfer=function(t,n){var r=e(this),i=e(t.to),s=i.css("position")==="fixed",o=e("body"),u=s?o.scrollTop():0,a=s?o.scrollLeft():0,f=i.offset(),l={top:f.top-u,left:f.left-a,height:i.innerHeight(),width:i.innerWidth()},c=r.offset(),h=e("<div class='ui-effects-transfer'></div>").appendTo(document.body).addClass(t.className).css({top:c.top-u,left:c.left-a,height:r.innerHeight(),width:r.innerWidth(),position:s?"fixed":"absolute"}).animate(l,t.duration,t.easing,function(){h.remove(),n()})}}(jQuery),function(e,t){e.widget("ui.menu",{version:"1.10.1",defaultElement:"<ul>",delay:300,options:{icons:{submenu:"ui-icon-carat-1-e"},menus:"ul",position:{my:"left top",at:"right top"},role:"menu",blur:null,focus:null,select:null},_create:function(){this.activeMenu=this.element,this.mouseHandled=!1,this.element.uniqueId().addClass("ui-menu ui-widget ui-widget-content ui-corner-all").toggleClass("ui-menu-icons",!!this.element.find(".ui-icon").length).attr({role:this.options.role,tabIndex:0}).bind("click"+this.eventNamespace,e.proxy(function(e){this.options.disabled&&e.preventDefault()},this)),this.options.disabled&&this.element.addClass("ui-state-disabled").attr("aria-disabled","true"),this._on({"mousedown .ui-menu-item > a":function(e){e.preventDefault()},"click .ui-state-disabled > a":function(e){e.preventDefault()},"click .ui-menu-item:has(a)":function(t){var n=e(t.target).closest(".ui-menu-item");!this.mouseHandled&&n.not(".ui-state-disabled").length&&(this.mouseHandled=!0,this.select(t),n.has(".ui-menu").length?this.expand(t):this.element.is(":focus")||(this.element.trigger("focus",[!0]),this.active&&this.active.parents(".ui-menu").length===1&&clearTimeout(this.timer)))},"mouseenter .ui-menu-item":function(t){var n=e(t.currentTarget);n.siblings().children(".ui-state-active").removeClass("ui-state-active"),this.focus(t,n)},mouseleave:"collapseAll","mouseleave .ui-menu":"collapseAll",focus:function(e,t){var n=this.active||this.element.children(".ui-menu-item").eq(0);t||this.focus(e,n)},blur:function(t){this._delay(function(){e.contains(this.element[0],this.document[0].activeElement)||this.collapseAll(t)})},keydown:"_keydown"}),this.refresh(),this._on(this.document,{click:function(t){e(t.target).closest(".ui-menu").length||this.collapseAll(t),this.mouseHandled=!1}})},_destroy:function(){this.element.removeAttr("aria-activedescendant").find(".ui-menu").addBack().removeClass("ui-menu ui-widget ui-widget-content ui-corner-all ui-menu-icons").removeAttr("role").removeAttr("tabIndex").removeAttr("aria-labelledby").removeAttr("aria-expanded").removeAttr("aria-hidden").removeAttr("aria-disabled").removeUniqueId().show(),this.element.find(".ui-menu-item").removeClass("ui-menu-item").removeAttr("role").removeAttr("aria-disabled").children("a").removeUniqueId().removeClass("ui-corner-all ui-state-hover").removeAttr("tabIndex").removeAttr("role").removeAttr("aria-haspopup").children().each(function(){var t=e(this);t.data("ui-menu-submenu-carat")&&t.remove()}),this.element.find(".ui-menu-divider").removeClass("ui-menu-divider ui-widget-content")},_keydown:function(t){function a(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}var n,r,i,s,o,u=!0;switch(t.keyCode){case e.ui.keyCode.PAGE_UP:this.previousPage(t);break;case e.ui.keyCode.PAGE_DOWN:this.nextPage(t);break;case e.ui.keyCode.HOME:this._move("first","first",t);break;case e.ui.keyCode.END:this._move("last","last",t);break;case e.ui.keyCode.UP:this.previous(t);break;case e.ui.keyCode.DOWN:this.next(t);break;case e.ui.keyCode.LEFT:this.collapse(t);break;case e.ui.keyCode.RIGHT:this.active&&!this.active.is(".ui-state-disabled")&&this.expand(t);break;case e.ui.keyCode.ENTER:case e.ui.keyCode.SPACE:this._activate(t);break;case e.ui.keyCode.ESCAPE:this.collapse(t);break;default:u=!1,r=this.previousFilter||"",i=String.fromCharCode(t.keyCode),s=!1,clearTimeout(this.filterTimer),i===r?s=!0:i=r+i,o=new RegExp("^"+a(i),"i"),n=this.activeMenu.children(".ui-menu-item").filter(function(){return o.test(e(this).children("a").text())}),n=s&&n.index(this.active.next())!==-1?this.active.nextAll(".ui-menu-item"):n,n.length||(i=String.fromCharCode(t.keyCode),o=new RegExp("^"+a(i),"i"),n=this.activeMenu.children(".ui-menu-item").filter(function(){return o.test(e(this).children("a").text())})),n.length?(this.focus(t,n),n.length>1?(this.previousFilter=i,this.filterTimer=this._delay(function(){delete this.previousFilter},1e3)):delete this.previousFilter):delete this.previousFilter}u&&t.preventDefault()},_activate:function(e){this.active.is(".ui-state-disabled")||(this.active.children("a[aria-haspopup='true']").length?this.expand(e):this.select(e))},refresh:function(){var t,n=this.options.icons.submenu,r=this.element.find(this.options.menus);r.filter(":not(.ui-menu)").addClass("ui-menu ui-widget ui-widget-content ui-corner-all").hide().attr({role:this.options.role,"aria-hidden":"true","aria-expanded":"false"}).each(function(){var t=e(this),r=t.prev("a"),i=e("<span>").addClass("ui-menu-icon ui-icon "+n).data("ui-menu-submenu-carat",!0);r.attr("aria-haspopup","true").prepend(i),t.attr("aria-labelledby",r.attr("id"))}),t=r.add(this.element),t.children(":not(.ui-menu-item):has(a)").addClass("ui-menu-item").attr("role","presentation").children("a").uniqueId().addClass("ui-corner-all").attr({tabIndex:-1,role:this._itemRole()}),t.children(":not(.ui-menu-item)").each(function(){var t=e(this);/[^\-\u2014\u2013\s]/.test(t.text())||t.addClass("ui-widget-content ui-menu-divider")}),t.children(".ui-state-disabled").attr("aria-disabled","true"),this.active&&!e.contains(this.element[0],this.active[0])&&this.blur()},_itemRole:function(){return{menu:"menuitem",listbox:"option"}[this.options.role]},_setOption:function(e,t){e==="icons"&&this.element.find(".ui-menu-icon").removeClass(this.options.icons.submenu).addClass(t.submenu),this._super(e,t)},focus:function(e,t){var n,r;this.blur(e,e&&e.type==="focus"),this._scrollIntoView(t),this.active=t.first(),r=this.active.children("a").addClass("ui-state-focus"),this.options.role&&this.element.attr("aria-activedescendant",r.attr("id")),this.active.parent().closest(".ui-menu-item").children("a:first").addClass("ui-state-active"),e&&e.type==="keydown"?this._close():this.timer=this._delay(function(){this._close()},this.delay),n=t.children(".ui-menu"),n.length&&/^mouse/.test(e.type)&&this._startOpening(n),this.activeMenu=t.parent(),this._trigger("focus",e,{item:t})},_scrollIntoView:function(t){var n,r,i,s,o,u;this._hasScroll()&&(n=parseFloat(e.css(this.activeMenu[0],"borderTopWidth"))||0,r=parseFloat(e.css(this.activeMenu[0],"paddingTop"))||0,i=t.offset().top-this.activeMenu.offset().top-n-r,s=this.activeMenu.scrollTop(),o=this.activeMenu.height(),u=t.height(),i<0?this.activeMenu.scrollTop(s+i):i+u>o&&this.activeMenu.scrollTop(s+i-o+u))},blur:function(e,t){t||clearTimeout(this.timer);if(!this.active)return;this.active.children("a").removeClass("ui-state-focus"),this.active=null,this._trigger("blur",e,{item:this.active})},_startOpening:function(e){clearTimeout(this.timer);if(e.attr("aria-hidden")!=="true")return;this.timer=this._delay(function(){this._close(),this._open(e)},this.delay)},_open:function(t){var n=e.extend({of:this.active},this.options.position);clearTimeout(this.timer),this.element.find(".ui-menu").not(t.parents(".ui-menu")).hide().attr("aria-hidden","true"),t.show().removeAttr("aria-hidden").attr("aria-expanded","true").position(n)},collapseAll:function(t,n){clearTimeout(this.timer),this.timer=this._delay(function(){var r=n?this.element:e(t&&t.target).closest(this.element.find(".ui-menu"));r.length||(r=this.element),this._close(r),this.blur(t),this.activeMenu=r},this.delay)},_close:function(e){e||(e=this.active?this.active.parent():this.element),e.find(".ui-menu").hide().attr("aria-hidden","true").attr("aria-expanded","false").end().find("a.ui-state-active").removeClass("ui-state-active")},collapse:function(e){var t=this.active&&this.active.parent().closest(".ui-menu-item",this.element);t&&t.length&&(this._close(),this.focus(e,t))},expand:function(e){var t=this.active&&this.active.children(".ui-menu ").children(".ui-menu-item").first();t&&t.length&&(this._open(t.parent()),this._delay(function(){this.focus(e,t)}))},next:function(e){this._move("next","first",e)},previous:function(e){this._move("prev","last",e)},isFirstItem:function(){return this.active&&!this.active.prevAll(".ui-menu-item").length},isLastItem:function(){return this.active&&!this.active.nextAll(".ui-menu-item").length},_move:function(e,t,n){var r;this.active&&(e==="first"||e==="last"?r=this.active[e==="first"?"prevAll":"nextAll"](".ui-menu-item").eq(-1):r=this.active[e+"All"](".ui-menu-item").eq(0));if(!r||!r.length||!this.active)r=this.activeMenu.children(".ui-menu-item")[t]();this.focus(n,r)},nextPage:function(t){var n,r,i;if(!this.active){this.next(t);return}if(this.isLastItem())return;this._hasScroll()?(r=this.active.offset().top,i=this.element.height(),this.active.nextAll(".ui-menu-item").each(function(){return n=e(this),n.offset().top-r-i<0}),this.focus(t,n)):this.focus(t,this.activeMenu.children(".ui-menu-item")[this.active?"last":"first"]())},previousPage:function(t){var n,r,i;if(!this.active){this.next(t);return}if(this.isFirstItem())return;this._hasScroll()?(r=this.active.offset().top,i=this.element.height(),this.active.prevAll(".ui-menu-item").each(function(){return n=e(this),n.offset().top-r+i>0}),this.focus(t,n)):this.focus(t,this.activeMenu.children(".ui-menu-item").first())},_hasScroll:function(){return this.element.outerHeight()<this.element.prop("scrollHeight")},select:function(t){this.active=this.active||e(t.target).closest(".ui-menu-item");var n={item:this.active};this.active.has(".ui-menu").length||this.collapseAll(t,!0),this._trigger("select",t,n)}})}(jQuery),function(e,t){function h(e,t,n){return[parseFloat(e[0])*(l.test(e[0])?t/100:1),parseFloat(e[1])*(l.test(e[1])?n/100:1)]}function p(t,n){return parseInt(e.css(t,n),10)||0}function d(t){var n=t[0];return n.nodeType===9?{width:t.width(),height:t.height(),offset:{top:0,left:0}}:e.isWindow(n)?{width:t.width(),height:t.height(),offset:{top:t.scrollTop(),left:t.scrollLeft()}}:n.preventDefault?{width:0,height:0,offset:{top:n.pageY,left:n.pageX}}:{width:t.outerWidth(),height:t.outerHeight(),offset:t.offset()}}e.ui=e.ui||{};var n,r=Math.max,i=Math.abs,s=Math.round,o=/left|center|right/,u=/top|center|bottom/,a=/[\+\-]\d+(\.[\d]+)?%?/,f=/^\w+/,l=/%$/,c=e.fn.position;e.position={scrollbarWidth:function(){if(n!==t)return n;var r,i,s=e("<div style='display:block;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"),o=s.children()[0];return e("body").append(s),r=o.offsetWidth,s.css("overflow","scroll"),i=o.offsetWidth,r===i&&(i=s[0].clientWidth),s.remove(),n=r-i},getScrollInfo:function(t){var n=t.isWindow?"":t.element.css("overflow-x"),r=t.isWindow?"":t.element.css("overflow-y"),i=n==="scroll"||n==="auto"&&t.width<t.element[0].scrollWidth,s=r==="scroll"||r==="auto"&&t.height<t.element[0].scrollHeight;return{width:i?e.position.scrollbarWidth():0,height:s?e.position.scrollbarWidth():0}},getWithinInfo:function(t){var n=e(t||window),r=e.isWindow(n[0]);return{element:n,isWindow:r,offset:n.offset()||{left:0,top:0},scrollLeft:n.scrollLeft(),scrollTop:n.scrollTop(),width:r?n.width():n.outerWidth(),height:r?n.height():n.outerHeight()}}},e.fn.position=function(t){if(!t||!t.of)return c.apply(this,arguments);t=e.extend({},t);var n,l,v,m,g,y,b=e(t.of),w=e.position.getWithinInfo(t.within),E=e.position.getScrollInfo(w),S=(t.collision||"flip").split(" "),x={};return y=d(b),b[0].preventDefault&&(t.at="left top"),l=y.width,v=y.height,m=y.offset,g=e.extend({},m),e.each(["my","at"],function(){var e=(t[this]||"").split(" "),n,r;e.length===1&&(e=o.test(e[0])?e.concat(["center"]):u.test(e[0])?["center"].concat(e):["center","center"]),e[0]=o.test(e[0])?e[0]:"center",e[1]=u.test(e[1])?e[1]:"center",n=a.exec(e[0]),r=a.exec(e[1]),x[this]=[n?n[0]:0,r?r[0]:0],t[this]=[f.exec(e[0])[0],f.exec(e[1])[0]]}),S.length===1&&(S[1]=S[0]),t.at[0]==="right"?g.left+=l:t.at[0]==="center"&&(g.left+=l/2),t.at[1]==="bottom"?g.top+=v:t.at[1]==="center"&&(g.top+=v/2),n=h(x.at,l,v),g.left+=n[0],g.top+=n[1],this.each(function(){var o,u,a=e(this),f=a.outerWidth(),c=a.outerHeight(),d=p(this,"marginLeft"),y=p(this,"marginTop"),T=f+d+p(this,"marginRight")+E.width,N=c+y+p(this,"marginBottom")+E.height,C=e.extend({},g),k=h(x.my,a.outerWidth(),a.outerHeight());t.my[0]==="right"?C.left-=f:t.my[0]==="center"&&(C.left-=f/2),t.my[1]==="bottom"?C.top-=c:t.my[1]==="center"&&(C.top-=c/2),C.left+=k[0],C.top+=k[1],e.support.offsetFractions||(C.left=s(C.left),C.top=s(C.top)),o={marginLeft:d,marginTop:y},e.each(["left","top"],function(r,i){e.ui.position[S[r]]&&e.ui.position[S[r]][i](C,{targetWidth:l,targetHeight:v,elemWidth:f,elemHeight:c,collisionPosition:o,collisionWidth:T,collisionHeight:N,offset:[n[0]+k[0],n[1]+k[1]],my:t.my,at:t.at,within:w,elem:a})}),t.using&&(u=function(e){var n=m.left-C.left,s=n+l-f,o=m.top-C.top,u=o+v-c,h={target:{element:b,left:m.left,top:m.top,width:l,height:v},element:{element:a,left:C.left,top:C.top,width:f,height:c},horizontal:s<0?"left":n>0?"right":"center",vertical:u<0?"top":o>0?"bottom":"middle"};l<f&&i(n+s)<l&&(h.horizontal="center"),v<c&&i(o+u)<v&&(h.vertical="middle"),r(i(n),i(s))>r(i(o),i(u))?h.important="horizontal":h.important="vertical",t.using.call(this,e,h)}),a.offset(e.extend(C,{using:u}))})},e.ui.position={fit:{left:function(e,t){var n=t.within,i=n.isWindow?n.scrollLeft:n.offset.left,s=n.width,o=e.left-t.collisionPosition.marginLeft,u=i-o,a=o+t.collisionWidth-s-i,f;t.collisionWidth>s?u>0&&a<=0?(f=e.left+u+t.collisionWidth-s-i,e.left+=u-f):a>0&&u<=0?e.left=i:u>a?e.left=i+s-t.collisionWidth:e.left=i:u>0?e.left+=u:a>0?e.left-=a:e.left=r(e.left-o,e.left)},top:function(e,t){var n=t.within,i=n.isWindow?n.scrollTop:n.offset.top,s=t.within.height,o=e.top-t.collisionPosition.marginTop,u=i-o,a=o+t.collisionHeight-s-i,f;t.collisionHeight>s?u>0&&a<=0?(f=e.top+u+t.collisionHeight-s-i,e.top+=u-f):a>0&&u<=0?e.top=i:u>a?e.top=i+s-t.collisionHeight:e.top=i:u>0?e.top+=u:a>0?e.top-=a:e.top=r(e.top-o,e.top)}},flip:{left:function(e,t){var n=t.within,r=n.offset.left+n.scrollLeft,s=n.width,o=n.isWindow?n.scrollLeft:n.offset.left,u=e.left-t.collisionPosition.marginLeft,a=u-o,f=u+t.collisionWidth-s-o,l=t.my[0]==="left"?-t.elemWidth:t.my[0]==="right"?t.elemWidth:0,c=t.at[0]==="left"?t.targetWidth:t.at[0]==="right"?-t.targetWidth:0,h=-2*t.offset[0],p,d;if(a<0){p=e.left+l+c+h+t.collisionWidth-s-r;if(p<0||p<i(a))e.left+=l+c+h}else if(f>0){d=e.left-t.collisionPosition.marginLeft+l+c+h-o;if(d>0||i(d)<f)e.left+=l+c+h}},top:function(e,t){var n=t.within,r=n.offset.top+n.scrollTop,s=n.height,o=n.isWindow?n.scrollTop:n.offset.top,u=e.top-t.collisionPosition.marginTop,a=u-o,f=u+t.collisionHeight-s-o,l=t.my[1]==="top",c=l?-t.elemHeight:t.my[1]==="bottom"?t.elemHeight:0,h=t.at[1]==="top"?t.targetHeight:t.at[1]==="bottom"?-t.targetHeight:0,p=-2*t.offset[1],d,v;a<0?(v=e.top+c+h+p+t.collisionHeight-s-r,e.top+c+h+p>a&&(v<0||v<i(a))&&(e.top+=c+h+p)):f>0&&(d=e.top-t.collisionPosition.marginTop+c+h+p-o,e.top+c+h+p>f&&(d>0||i(d)<f)&&(e.top+=c+h+p))}},flipfit:{left:function(){e.ui.position.flip.left.apply(this,arguments),e.ui.position.fit.left.apply(this,arguments)},top:function(){e.ui.position.flip.top.apply(this,arguments),e.ui.position.fit.top.apply(this,arguments)}}},function(){var t,n,r,i,s,o=document.getElementsByTagName("body")[0],u=document.createElement("div");t=document.createElement(o?"div":"body"),r={visibility:"hidden",width:0,height:0,border:0,margin:0,background:"none"},o&&e.extend(r,{position:"absolute",left:"-1000px",top:"-1000px"});for(s in r)t.style[s]=r[s];t.appendChild(u),n=o||document.documentElement,n.insertBefore(t,n.firstChild),u.style.cssText="position: absolute; left: 10.7432222px;",i=e(u).offset().left,e.support.offsetFractions=i>10&&i<11,t.innerHTML="",n.removeChild(t)}()}(jQuery),function(e,t){e.widget("ui.progressbar",{version:"1.10.1",options:{max:100,value:0,change:null,complete:null},min:0,_create:function(){this.oldValue=this.options.value=this._constrainedValue(),this.element.addClass("ui-progressbar ui-widget ui-widget-content ui-corner-all").attr({role:"progressbar","aria-valuemin":this.min}),this.valueDiv=e("<div class='ui-progressbar-value ui-widget-header ui-corner-left'></div>").appendTo(this.element),this._refreshValue()},_destroy:function(){this.element.removeClass("ui-progressbar ui-widget ui-widget-content ui-corner-all").removeAttr("role").removeAttr("aria-valuemin").removeAttr("aria-valuemax").removeAttr("aria-valuenow"),this.valueDiv.remove()},value:function(e){if(e===t)return this.options.value;this.options.value=this._constrainedValue(e),this._refreshValue()},_constrainedValue:function(e){return e===t&&(e=this.options.value),this.indeterminate=e===!1,typeof e!="number"&&(e=0),this.indeterminate?!1:Math.min(this.options.max,Math.max(this.min,e))},_setOptions:function(e){var t=e.value;delete e.value,this._super(e),this.options.value=this._constrainedValue(t),this._refreshValue()},_setOption:function(e,t){e==="max"&&(t=Math.max(this.min,t)),this._super(e,t)},_percentage:function(){return this.indeterminate?100:100*(this.options.value-this.min)/(this.options.max-this.min)},_refreshValue:function(){var t=this.options.value,n=this._percentage();this.valueDiv.toggle(this.indeterminate||t>this.min).toggleClass("ui-corner-right",t===this.options.max).width(n.toFixed(0)+"%"),this.element.toggleClass("ui-progressbar-indeterminate",this.indeterminate),this.indeterminate?(this.element.removeAttr("aria-valuenow"),this.overlayDiv||(this.overlayDiv=e("<div class='ui-progressbar-overlay'></div>").appendTo(this.valueDiv))):(this.element.attr({"aria-valuemax":this.options.max,"aria-valuenow":t}),this.overlayDiv&&(this.overlayDiv.remove(),this.overlayDiv=null)),this.oldValue!==t&&(this.oldValue=t,this._trigger("change")),t===this.options.max&&this._trigger("complete")}})}(jQuery),function(e,t){var n=5;e.widget("ui.slider",e.ui.mouse,{version:"1.10.1",widgetEventPrefix:"slide",options:{animate:!1,distance:0,max:100,min:0,orientation:"horizontal",range:!1,step:1,value:0,values:null,change:null,slide:null,start:null,stop:null},_create:function(){this._keySliding=!1,this._mouseSliding=!1,this._animateOff=!0,this._handleIndex=null,this._detectOrientation(),this._mouseInit(),this.element.addClass("ui-slider ui-slider-"+this.orientation+" ui-widget"+" ui-widget-content"+" ui-corner-all"),this._refresh(),this._setOption("disabled",this.options.disabled),this._animateOff=!1},_refresh:function(){this._createRange(),this._createHandles(),this._setupEvents(),this._refreshValue()},_createHandles:function(){var t,n,r=this.options,i=this.element.find(".ui-slider-handle").addClass("ui-state-default ui-corner-all"),s="<a class='ui-slider-handle ui-state-default ui-corner-all' href='#'></a>",o=[];n=r.values&&r.values.length||1,i.length>n&&(i.slice(n).remove(),i=i.slice(0,n));for(t=i.length;t<n;t++)o.push(s);this.handles=i.add(e(o.join("")).appendTo(this.element)),this.handle=this.handles.eq(0),this.handles.each(function(t){e(this).data("ui-slider-handle-index",t)})},_createRange:function(){var t=this.options,n="";t.range?(t.range===!0&&(t.values?t.values.length&&t.values.length!==2?t.values=[t.values[0],t.values[0]]:e.isArray(t.values)&&(t.values=t.values.slice(0)):t.values=[this._valueMin(),this._valueMin()]),!this.range||!this.range.length?(this.range=e("<div></div>").appendTo(this.element),n="ui-slider-range ui-widget-header ui-corner-all"):this.range.removeClass("ui-slider-range-min ui-slider-range-max").css({left:"",bottom:""}),this.range.addClass(n+(t.range==="min"||t.range==="max"?" ui-slider-range-"+t.range:""))):this.range=e([])},_setupEvents:function(){var e=this.handles.add(this.range).filter("a");this._off(e),this._on(e,this._handleEvents),this._hoverable(e),this._focusable(e)},_destroy:function(){this.handles.remove(),this.range.remove(),this.element.removeClass("ui-slider ui-slider-horizontal ui-slider-vertical ui-widget ui-widget-content ui-corner-all"),this._mouseDestroy()},_mouseCapture:function(t){var n,r,i,s,o,u,a,f,l=this,c=this.options;return c.disabled?!1:(this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()},this.elementOffset=this.element.offset(),n={x:t.pageX,y:t.pageY},r=this._normValueFromMouse(n),i=this._valueMax()-this._valueMin()+1,this.handles.each(function(t){var n=Math.abs(r-l.values(t));if(i>n||i===n&&(t===l._lastChangedValue||l.values(t)===c.min))i=n,s=e(this),o=t}),u=this._start(t,o),u===!1?!1:(this._mouseSliding=!0,this._handleIndex=o,s.addClass("ui-state-active").focus(),a=s.offset(),f=!e(t.target).parents().addBack().is(".ui-slider-handle"),this._clickOffset=f?{left:0,top:0}:{left:t.pageX-a.left-s.width()/2,top:t.pageY-a.top-s.height()/2-(parseInt(s.css("borderTopWidth"),10)||0)-(parseInt(s.css("borderBottomWidth"),10)||0)+(parseInt(s.css("marginTop"),10)||0)},this.handles.hasClass("ui-state-hover")||this._slide(t,o,r),this._animateOff=!0,!0))},_mouseStart:function(){return!0},_mouseDrag:function(e){var t={x:e.pageX,y:e.pageY},n=this._normValueFromMouse(t);return this._slide(e,this._handleIndex,n),!1},_mouseStop:function(e){return this.handles.removeClass("ui-state-active"),this._mouseSliding=!1,this._stop(e,this._handleIndex),this._change(e,this._handleIndex),this._handleIndex=null,this._clickOffset=null,this._animateOff=!1,!1},_detectOrientation:function(){this.orientation=this.options.orientation==="vertical"?"vertical":"horizontal"},_normValueFromMouse:function(e){var t,n,r,i,s;return this.orientation==="horizontal"?(t=this.elementSize.width,n=e.x-this.elementOffset.left-(this._clickOffset?this._clickOffset.left:0)):(t=this.elementSize.height,n=e.y-this.elementOffset.top-(this._clickOffset?this._clickOffset.top:0)),r=n/t,r>1&&(r=1),r<0&&(r=0),this.orientation==="vertical"&&(r=1-r),i=this._valueMax()-this._valueMin(),s=this._valueMin()+r*i,this._trimAlignValue(s)},_start:function(e,t){var n={handle:this.handles[t],value:this.value()};return this.options.values&&this.options.values.length&&(n.value=this.values(t),n.values=this.values()),this._trigger("start",e,n)},_slide:function(e,t,n){var r,i,s;this.options.values&&this.options.values.length?(r=this.values(t?0:1),this.options.values.length===2&&this.options.range===!0&&(t===0&&n>r||t===1&&n<r)&&(n=r),n!==this.values(t)&&(i=this.values(),i[t]=n,s=this._trigger("slide",e,{handle:this.handles[t],value:n,values:i}),r=this.values(t?0:1),s!==!1&&this.values(t,n,!0))):n!==this.value()&&(s=this._trigger("slide",e,{handle:this.handles[t],value:n}),s!==!1&&this.value(n))},_stop:function(e,t){var n={handle:this.handles[t],value:this.value()};this.options.values&&this.options.values.length&&(n.value=this.values(t),n.values=this.values()),this._trigger("stop",e,n)},_change:function(e,t){if(!this._keySliding&&!this._mouseSliding){var n={handle:this.handles[t],value:this.value()};this.options.values&&this.options.values.length&&(n.value=this.values(t),n.values=this.values()),this._lastChangedValue=t,this._trigger("change",e,n)}},value:function(e){if(arguments.length){this.options.value=this._trimAlignValue(e),this._refreshValue(),this._change(null,0);return}return this._value()},values:function(t,n){var r,i,s;if(arguments.length>1){this.options.values[t]=this._trimAlignValue(n),this._refreshValue(),this._change(null,t);return}if(!arguments.length)return this._values();if(!e.isArray(arguments[0]))return this.options.values&&this.options.values.length?this._values(t):this.value();r=this.options.values,i=arguments[0];for(s=0;s<r.length;s+=1)r[s]=this._trimAlignValue(i[s]),this._change(null,s);this._refreshValue()},_setOption:function(t,n){var r,i=0;t==="range"&&this.options.range===!0&&(n==="min"?(this.options.value=this._values(0),this.options.values=null):n==="max"&&(this.options.value=this._values(this.options.values.length-1),this.options.values=null)),e.isArray(this.options.values)&&(i=this.options.values.length),e.Widget.prototype._setOption.apply(this,arguments);switch(t){case"orientation":this._detectOrientation(),this.element.removeClass("ui-slider-horizontal ui-slider-vertical").addClass("ui-slider-"+this.orientation),this._refreshValue();break;case"value":this._animateOff=!0,this._refreshValue(),this._change(null,0),this._animateOff=!1;break;case"values":this._animateOff=!0,this._refreshValue();for(r=0;r<i;r+=1)this._change(null,r);this._animateOff=!1;break;case"min":case"max":this._animateOff=!0,this._refreshValue(),this._animateOff=!1;break;case"range":this._animateOff=!0,this._refresh(),this._animateOff=!1}},_value:function(){var e=this.options.value;return e=this._trimAlignValue(e),e},_values:function(e){var t,n,r;if(arguments.length)return t=this.options.values[e],t=this._trimAlignValue(t),t;if(this.options.values&&this.options.values.length){n=this.options.values.slice();for(r=0;r<n.length;r+=1)n[r]=this._trimAlignValue(n[r]);return n}return[]},_trimAlignValue:function(e){if(e<=this._valueMin())return this._valueMin();if(e>=this._valueMax())return this._valueMax();var t=this.options.step>0?this.options.step:1,n=(e-this._valueMin())%t,r=e-n;return Math.abs(n)*2>=t&&(r+=n>0?t:-t),parseFloat(r.toFixed(5))},_valueMin:function(){return this.options.min},_valueMax:function(){return this.options.max},_refreshValue:function(){var t,n,r,i,s,o=this.options.range,u=this.options,a=this,f=this._animateOff?!1:u.animate,l={};this.options.values&&this.options.values.length?this.handles.each(function(r){n=(a.values(r)-a._valueMin())/(a._valueMax()-a._valueMin())*100,l[a.orientation==="horizontal"?"left":"bottom"]=n+"%",e(this).stop(1,1)[f?"animate":"css"](l,u.animate),a.options.range===!0&&(a.orientation==="horizontal"?(r===0&&a.range.stop(1,1)[f?"animate":"css"]({left:n+"%"},u.animate),r===1&&a.range[f?"animate":"css"]({width:n-t+"%"},{queue:!1,duration:u.animate})):(r===0&&a.range.stop(1,1)[f?"animate":"css"]({bottom:n+"%"},u.animate),r===1&&a.range[f?"animate":"css"]({height:n-t+"%"},{queue:!1,duration:u.animate}))),t=n}):(r=this.value(),i=this._valueMin(),s=this._valueMax(),n=s!==i?(r-i)/(s-i)*100:0,l[this.orientation==="horizontal"?"left":"bottom"]=n+"%",this.handle.stop(1,1)[f?"animate":"css"](l,u.animate),o==="min"&&this.orientation==="horizontal"&&this.range.stop(1,1)[f?"animate":"css"]({width:n+"%"},u.animate),o==="max"&&this.orientation==="horizontal"&&this.range[f?"animate":"css"]({width:100-n+"%"},{queue:!1,duration:u.animate}),o==="min"&&this.orientation==="vertical"&&this.range.stop(1,1)[f?"animate":"css"]({height:n+"%"},u.animate),o==="max"&&this.orientation==="vertical"&&this.range[f?"animate":"css"]({height:100-n+"%"},{queue:!1,duration:u.animate}))},_handleEvents:{keydown:function(t){var r,i,s,o,u=e(t.target).data("ui-slider-handle-index");switch(t.keyCode){case e.ui.keyCode.HOME:case e.ui.keyCode.END:case e.ui.keyCode.PAGE_UP:case e.ui.keyCode.PAGE_DOWN:case e.ui.keyCode.UP:case e.ui.keyCode.RIGHT:case e.ui.keyCode.DOWN:case e.ui.keyCode.LEFT:t.preventDefault();if(!this._keySliding){this._keySliding=!0,e(t.target).addClass("ui-state-active"),r=this._start(t,u);if(r===!1)return}}o=this.options.step,this.options.values&&this.options.values.length?i=s=this.values(u):i=s=this.value();switch(t.keyCode){case e.ui.keyCode.HOME:s=this._valueMin();break;case e.ui.keyCode.END:s=this._valueMax();break;case e.ui.keyCode.PAGE_UP:s=this._trimAlignValue(i+(this._valueMax()-this._valueMin())/n);break;case e.ui.keyCode.PAGE_DOWN:s=this._trimAlignValue(i-(this._valueMax()-this._valueMin())/n);break;case e.ui.keyCode.UP:case e.ui.keyCode.RIGHT:if(i===this._valueMax())return;s=this._trimAlignValue(i+o);break;case e.ui.keyCode.DOWN:case e.ui.keyCode.LEFT:if(i===this._valueMin())return;s=this._trimAlignValue(i-o)}this._slide(t,u,s)},click:function(e){e.preventDefault()},keyup:function(t){var n=e(t.target).data("ui-slider-handle-index");this._keySliding&&(this._keySliding=!1,this._stop(t,n),this._change(t,n),e(t.target).removeClass("ui-state-active"))}}})}(jQuery),function(e){function t(e){return function(){var t=this.element.val();e.apply(this,arguments),this._refresh(),t!==this.element.val()&&this._trigger("change")}}e.widget("ui.spinner",{version:"1.10.1",defaultElement:"<input>",widgetEventPrefix:"spin",options:{culture:null,icons:{down:"ui-icon-triangle-1-s",up:"ui-icon-triangle-1-n"},incremental:!0,max:null,min:null,numberFormat:null,page:10,step:1,change:null,spin:null,start:null,stop:null},_create:function(){this._setOption("max",this.options.max),this._setOption("min",this.options.min),this._setOption("step",this.options.step),this._value(this.element.val(),!0),this._draw(),this._on(this._events),this._refresh(),this._on(this.window,{beforeunload:function(){this.element.removeAttr("autocomplete")}})},_getCreateOptions:function(){var t={},n=this.element;return e.each(["min","max","step"],function(e,r){var i=n.attr(r);i!==undefined&&i.length&&(t[r]=i)}),t},_events:{keydown:function(e){this._start(e)&&this._keydown(e)&&e.preventDefault()},keyup:"_stop",focus:function(){this.previous=this.element.val()},blur:function(e){if(this.cancelBlur){delete this.cancelBlur;return}this._refresh(),this.previous!==this.element.val()&&this._trigger("change",e)},mousewheel:function(e,t){if(!t)return;if(!this.spinning&&!this._start(e))return!1;this._spin((t>0?1:-1)*this.options.step,e),clearTimeout(this.mousewheelTimer),this.mousewheelTimer=this._delay(function(){this.spinning&&this._stop(e)},100),e.preventDefault()},"mousedown .ui-spinner-button":function(t){function r(){var e=this.element[0]===this.document[0].activeElement;e||(this.element.focus(),this.previous=n,this._delay(function(){this.previous=n}))}var n;n=this.element[0]===this.document[0].activeElement?this.previous:this.element.val(),t.preventDefault(),r.call(this),this.cancelBlur=!0,this._delay(function(){delete this.cancelBlur,r.call(this)});if(this._start(t)===!1)return;this._repeat(null,e(t.currentTarget).hasClass("ui-spinner-up")?1:-1,t)},"mouseup .ui-spinner-button":"_stop","mouseenter .ui-spinner-button":function(t){if(!e(t.currentTarget).hasClass("ui-state-active"))return;if(this._start(t)===!1)return!1;this._repeat(null,e(t.currentTarget).hasClass("ui-spinner-up")?1:-1,t)},"mouseleave .ui-spinner-button":"_stop"},_draw:function(){var e=this.uiSpinner=this.element.addClass("ui-spinner-input").attr("autocomplete","off").wrap(this._uiSpinnerHtml()).parent().append(this._buttonHtml());this.element.attr("role","spinbutton"),this.buttons=e.find(".ui-spinner-button").attr("tabIndex",-1).button().removeClass("ui-corner-all"),this.buttons.height()>Math.ceil(e.height()*.5)&&e.height()>0&&e.height(e.height()),this.options.disabled&&this.disable()},_keydown:function(t){var n=this.options,r=e.ui.keyCode;switch(t.keyCode){case r.UP:return this._repeat(null,1,t),!0;case r.DOWN:return this._repeat(null,-1,t),!0;case r.PAGE_UP:return this._repeat(null,n.page,t),!0;case r.PAGE_DOWN:return this._repeat(null,-n.page,t),!0}return!1},_uiSpinnerHtml:function(){return"<span class='ui-spinner ui-widget ui-widget-content ui-corner-all'></span>"},_buttonHtml:function(){return"<a class='ui-spinner-button ui-spinner-up ui-corner-tr'><span class='ui-icon "+this.options.icons.up+"'>&#9650;</span>"+"</a>"+"<a class='ui-spinner-button ui-spinner-down ui-corner-br'>"+"<span class='ui-icon "+this.options.icons.down+"'>&#9660;</span>"+"</a>"},_start:function(e){return!this.spinning&&this._trigger("start",e)===!1?!1:(this.counter||(this.counter=1),this.spinning=!0,!0)},_repeat:function(e,t,n){e=e||500,clearTimeout(this.timer),this.timer=this._delay(function(){this._repeat(40,t,n)},e),this._spin(t*this.options.step,n)},_spin:function(e,t){var n=this.value()||0;this.counter||(this.counter=1),n=this._adjustValue(n+e*this._increment(this.counter));if(!this.spinning||this._trigger("spin",t,{value:n})!==!1)this._value(n),this.counter++},_increment:function(t){var n=this.options.incremental;return n?e.isFunction(n)?n(t):Math.floor(t*t*t/5e4-t*t/500+17*t/200+1):1},_precision:function(){var e=this._precisionOf(this.options.step);return this.options.min!==null&&(e=Math.max(e,this._precisionOf(this.options.min))),e},_precisionOf:function(e){var t=e.toString(),n=t.indexOf(".");return n===-1?0:t.length-n-1},_adjustValue:function(e){var t,n,r=this.options;return t=r.min!==null?r.min:0,n=e-t,n=Math.round(n/r.step)*r.step,e=t+n,e=parseFloat(e.toFixed(this._precision())),r.max!==null&&e>r.max?r.max:r.min!==null&&e<r.min?r.min:e},_stop:function(e){if(!this.spinning)return;clearTimeout(this.timer),clearTimeout(this.mousewheelTimer),this.counter=0,this.spinning=!1,this._trigger("stop",e)},_setOption:function(e,t){if(e==="culture"||e==="numberFormat"){var n=this._parse(this.element.val());this.options[e]=t,this.element.val(this._format(n));return}(e==="max"||e==="min"||e==="step")&&typeof t=="string"&&(t=this._parse(t)),e==="icons"&&(this.buttons.first().find(".ui-icon").removeClass(this.options.icons.up).addClass(t.up),this.buttons.last().find(".ui-icon").removeClass(this.options.icons.down).addClass(t.down)),this._super(e,t),e==="disabled"&&(t?(this.element.prop("disabled",!0),this.buttons.button("disable")):(this.element.prop("disabled",!1),this.buttons.button("enable")))},_setOptions:t(function(e){this._super(e),this._value(this.element.val())}),_parse:function(e){return typeof e=="string"&&e!==""&&(e=window.Globalize&&this.options.numberFormat?Globalize.parseFloat(e,10,this.options.culture):+e),e===""||isNaN(e)?null:e},_format:function(e){return e===""?"":window.Globalize&&this.options.numberFormat?Globalize.format(e,this.options.numberFormat,this.options.culture):e},_refresh:function(){this.element.attr({"aria-valuemin":this.options.min,"aria-valuemax":this.options.max,"aria-valuenow":this._parse(this.element.val())})},_value:function(e,t){var n;e!==""&&(n=this._parse(e),n!==null&&(t||(n=this._adjustValue(n)),e=this._format(n))),this.element.val(e),this._refresh()},_destroy:function(){this.element.removeClass("ui-spinner-input").prop("disabled",!1).removeAttr("autocomplete").removeAttr("role").removeAttr("aria-valuemin").removeAttr("aria-valuemax").removeAttr("aria-valuenow"),this.uiSpinner.replaceWith(this.element)},stepUp:t(function(e){this._stepUp(e)}),_stepUp:function(e){this._start()&&(this._spin((e||1)*this.options.step),this._stop())},stepDown:t(function(e){this._stepDown(e)}),_stepDown:function(e){this._start()&&(this._spin((e||1)*-this.options.step),this._stop())},pageUp:t(function(e){this._stepUp((e||1)*this.options.page)}),pageDown:t(function(e){this._stepDown((e||1)*this.options.page)}),value:function(e){if(!arguments.length)return this._parse(this.element.val());t(this._value).call(this,e)},widget:function(){return this.uiSpinner}})}(jQuery),function(e,t){function i(){return++n}function s(e){return e.hash.length>1&&decodeURIComponent(e.href.replace(r,""))===decodeURIComponent(location.href.replace(r,""))}var n=0,r=/#.*$/;e.widget("ui.tabs",{version:"1.10.1",delay:300,options:{active:null,collapsible:!1,event:"click",heightStyle:"content",hide:null,show:null,activate:null,beforeActivate:null,beforeLoad:null,load:null},_create:function(){var t=this,n=this.options;this.running=!1,this.element.addClass("ui-tabs ui-widget ui-widget-content ui-corner-all").toggleClass("ui-tabs-collapsible",n.collapsible).delegate(".ui-tabs-nav > li","mousedown"+this.eventNamespace,function(t){e(this).is(".ui-state-disabled")&&t.preventDefault()}).delegate(".ui-tabs-anchor","focus"+this.eventNamespace,function(){e(this).closest("li").is(".ui-state-disabled")&&this.blur()}),this._processTabs(),n.active=this._initialActive(),e.isArray(n.disabled)&&(n.disabled=e.unique(n.disabled.concat(e.map(this.tabs.filter(".ui-state-disabled"),function(e){return t.tabs.index(e)}))).sort()),this.options.active!==!1&&this.anchors.length?this.active=this._findActive(n.active):this.active=e(),this._refresh(),this.active.length&&this.load(n.active)},_initialActive:function(){var t=this.options.active,n=this.options.collapsible,r=location.hash.substring(1);if(t===null){r&&this.tabs.each(function(n,i){if(e(i).attr("aria-controls")===r)return t=n,!1}),t===null&&(t=this.tabs.index(this.tabs.filter(".ui-tabs-active")));if(t===null||t===-1)t=this.tabs.length?0:!1}return t!==!1&&(t=this.tabs.index(this.tabs.eq(t)),t===-1&&(t=n?!1:0)),!n&&t===!1&&this.anchors.length&&(t=0),t},_getCreateEventData:function(){return{tab:this.active,panel:this.active.length?this._getPanelForTab(this.active):e()}},_tabKeydown:function(t){var n=e(this.document[0].activeElement).closest("li"),r=this.tabs.index(n),i=!0;if(this._handlePageNav(t))return;switch(t.keyCode){case e.ui.keyCode.RIGHT:case e.ui.keyCode.DOWN:r++;break;case e.ui.keyCode.UP:case e.ui.keyCode.LEFT:i=!1,r--;break;case e.ui.keyCode.END:r=this.anchors.length-1;break;case e.ui.keyCode.HOME:r=0;break;case e.ui.keyCode.SPACE:t.preventDefault(),clearTimeout(this.activating),this._activate(r);return;case e.ui.keyCode.ENTER:t.preventDefault(),clearTimeout(this.activating),this._activate(r===this.options.active?!1:r);return;default:return}t.preventDefault(),clearTimeout(this.activating),r=this._focusNextTab(r,i),t.ctrlKey||(n.attr("aria-selected","false"),this.tabs.eq(r).attr("aria-selected","true"),this.activating=this._delay(function(){this.option("active",r)},this.delay))},_panelKeydown:function(t){if(this._handlePageNav(t))return;t.ctrlKey&&t.keyCode===e.ui.keyCode.UP&&(t.preventDefault(),this.active.focus())},_handlePageNav:function(t){if(t.altKey&&t.keyCode===e.ui.keyCode.PAGE_UP)return this._activate(this._focusNextTab(this.options.active-1,!1)),!0;if(t.altKey&&t.keyCode===e.ui.keyCode.PAGE_DOWN)return this._activate(this._focusNextTab(this.options.active+1,!0)),!0},_findNextTab:function(t,n){function i(){return t>r&&(t=0),t<0&&(t=r),t}var r=this.tabs.length-1;while(e.inArray(i(),this.options.disabled)!==-1)t=n?t+1:t-1;return t},_focusNextTab:function(e,t){return e=this._findNextTab(e,t),this.tabs.eq(e).focus(),e},_setOption:function(e,t){if(e==="active"){this._activate(t);return}if(e==="disabled"){this._setupDisabled(t);return}this._super(e,t),e==="collapsible"&&(this.element.toggleClass("ui-tabs-collapsible",t),!t&&this.options.active===!1&&this._activate(0)),e==="event"&&this._setupEvents(t),e==="heightStyle"&&this._setupHeightStyle(t)},_tabId:function(e){return e.attr("aria-controls")||"ui-tabs-"+i()},_sanitizeSelector:function(e){return e?e.replace(/[!"$%&'()*+,.\/:;<=>?@\[\]\^`{|}~]/g,"\\$&"):""},refresh:function(){var t=this.options,n=this.tablist.children(":has(a[href])");t.disabled=e.map(n.filter(".ui-state-disabled"),function(e){return n.index(e)}),this._processTabs(),t.active===!1||!this.anchors.length?(t.active=!1,this.active=e()):this.active.length&&!e.contains(this.tablist[0],this.active[0])?this.tabs.length===t.disabled.length?(t.active=!1,this.active=e()):this._activate(this._findNextTab(Math.max(0,t.active-1),!1)):t.active=this.tabs.index(this.active),this._refresh()},_refresh:function(){this._setupDisabled(this.options.disabled),this._setupEvents(this.options.event),this._setupHeightStyle(this.options.heightStyle),this.tabs.not(this.active).attr({"aria-selected":"false",tabIndex:-1}),this.panels.not(this._getPanelForTab(this.active)).hide().attr({"aria-expanded":"false","aria-hidden":"true"}),this.active.length?(this.active.addClass("ui-tabs-active ui-state-active").attr({"aria-selected":"true",tabIndex:0}),this._getPanelForTab(this.active).show().attr({"aria-expanded":"true","aria-hidden":"false"})):this.tabs.eq(0).attr("tabIndex",0)},_processTabs:function(){var t=this;this.tablist=this._getList().addClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all").attr("role","tablist"),this.tabs=this.tablist.find("> li:has(a[href])").addClass("ui-state-default ui-corner-top").attr({role:"tab",tabIndex:-1}),this.anchors=this.tabs.map(function(){return e("a",this)[0]}).addClass("ui-tabs-anchor").attr({role:"presentation",tabIndex:-1}),this.panels=e(),this.anchors.each(function(n,r){var i,o,u,a=e(r).uniqueId().attr("id"),f=e(r).closest("li"),l=f.attr("aria-controls");s(r)?(i=r.hash,o=t.element.find(t._sanitizeSelector(i))):(u=t._tabId(f),i="#"+u,o=t.element.find(i),o.length||(o=t._createPanel(u),o.insertAfter(t.panels[n-1]||t.tablist)),o.attr("aria-live","polite")),o.length&&(t.panels=t.panels.add(o)),l&&f.data("ui-tabs-aria-controls",l),f.attr({"aria-controls":i.substring(1),"aria-labelledby":a}),o.attr("aria-labelledby",a)}),this.panels.addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").attr("role","tabpanel")},_getList:function(){return this.element.find("ol,ul").eq(0)},_createPanel:function(t){return e("<div>").attr("id",t).addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").data("ui-tabs-destroy",!0)},_setupDisabled:function(t){e.isArray(t)&&(t.length?t.length===this.anchors.length&&(t=!0):t=!1);for(var n=0,r;r=this.tabs[n];n++)t===!0||e.inArray(n,t)!==-1?e(r).addClass("ui-state-disabled").attr("aria-disabled","true"):e(r).removeClass("ui-state-disabled").removeAttr("aria-disabled");this.options.disabled=t},_setupEvents:function(t){var n={click:function(e){e.preventDefault()}};t&&e.each(t.split(" "),function(e,t){n[t]="_eventHandler"}),this._off(this.anchors.add(this.tabs).add(this.panels)),this._on(this.anchors,n),this._on(this.tabs,{keydown:"_tabKeydown"}),this._on(this.panels,{keydown:"_panelKeydown"}),this._focusable(this.tabs),this._hoverable(this.tabs)},_setupHeightStyle:function(t){var n,r=this.element.parent();t==="fill"?(n=r.height(),n-=this.element.outerHeight()-this.element.height(),this.element.siblings(":visible").each(function(){var t=e(this),r=t.css("position");if(r==="absolute"||r==="fixed")return;n-=t.outerHeight(!0)}),this.element.children().not(this.panels).each(function(){n-=e(this).outerHeight(!0)}),this.panels.each(function(){e(this).height(Math.max(0,n-e(this).innerHeight()+e(this).height()))}).css("overflow","auto")):t==="auto"&&(n=0,this.panels.each(function(){n=Math.max(n,e(this).height("").height())}).height(n))},_eventHandler:function(t){var n=this.options,r=this.active,i=e(t.currentTarget),s=i.closest("li"),o=s[0]===r[0],u=o&&n.collapsible,a=u?e():this._getPanelForTab(s),f=r.length?this._getPanelForTab(r):e(),l={oldTab:r,oldPanel:f,newTab:u?e():s,newPanel:a};t.preventDefault();if(s.hasClass("ui-state-disabled")||s.hasClass("ui-tabs-loading")||this.running||o&&!n.collapsible||this._trigger("beforeActivate",t,l)===!1)return;n.active=u?!1:this.tabs.index(s),this.active=o?e():s,this.xhr&&this.xhr.abort(),!f.length&&!a.length&&e.error("jQuery UI Tabs: Mismatching fragment identifier."),a.length&&this.load(this.tabs.index(s),t),this._toggle(t,l)},_toggle:function(t,n){function o(){r.running=!1,r._trigger("activate",t,n)}function u(){n.newTab.closest("li").addClass("ui-tabs-active ui-state-active"),i.length&&r.options.show?r._show(i,r.options.show,o):(i.show(),o())}var r=this,i=n.newPanel,s=n.oldPanel;this.running=!0,s.length&&this.options.hide?this._hide(s,this.options.hide,function(){n.oldTab.closest("li").removeClass("ui-tabs-active ui-state-active"),u()}):(n.oldTab.closest("li").removeClass("ui-tabs-active ui-state-active"),s.hide(),u()),s.attr({"aria-expanded":"false","aria-hidden":"true"}),n.oldTab.attr("aria-selected","false"),i.length&&s.length?n.oldTab.attr("tabIndex",-1):i.length&&this.tabs.filter(function(){return e(this).attr("tabIndex")===0}).attr("tabIndex",-1),i.attr({"aria-expanded":"true","aria-hidden":"false"}),n.newTab.attr({"aria-selected":"true",tabIndex:0})},_activate:function(t){var n,r=this._findActive(t);if(r[0]===this.active[0])return;r.length||(r=this.active),n=r.find(".ui-tabs-anchor")[0],this._eventHandler({target:n,currentTarget:n,preventDefault:e.noop})},_findActive:function(t){return t===!1?e():this.tabs.eq(t)},_getIndex:function(e){return typeof e=="string"&&(e=this.anchors.index(this.anchors.filter("[href$='"+e+"']"))),e},_destroy:function(){this.xhr&&this.xhr.abort(),this.element.removeClass("ui-tabs ui-widget ui-widget-content ui-corner-all ui-tabs-collapsible"),this.tablist.removeClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all").removeAttr("role"),this.anchors.removeClass("ui-tabs-anchor").removeAttr("role").removeAttr("tabIndex").removeUniqueId(),this.tabs.add(this.panels).each(function(){e.data(this,"ui-tabs-destroy")?e(this).remove():e(this).removeClass("ui-state-default ui-state-active ui-state-disabled ui-corner-top ui-corner-bottom ui-widget-content ui-tabs-active ui-tabs-panel").removeAttr("tabIndex").removeAttr("aria-live").removeAttr("aria-busy").removeAttr("aria-selected").removeAttr("aria-labelledby").removeAttr("aria-hidden").removeAttr("aria-expanded").removeAttr("role")}),this.tabs.each(function(){var t=e(this),n=t.data("ui-tabs-aria-controls");n?t.attr("aria-controls",n).removeData("ui-tabs-aria-controls"):t.removeAttr("aria-controls")}),this.panels.show(),this.options.heightStyle!=="content"&&this.panels.css("height","")},enable:function(n){var r=this.options.disabled;if(r===!1)return;n===t?r=!1:(n=this._getIndex(n),e.isArray(r)?r=e.map(r,function(e){return e!==n?e:null}):r=e.map(this.tabs,function(e,t){return t!==n?t:null})),this._setupDisabled(r)},disable:function(n){var r=this.options.disabled;if(r===!0)return;if(n===t)r=!0;else{n=this._getIndex(n);if(e.inArray(n,r)!==-1)return;e.isArray(r)?r=e.merge([n],r).sort():r=[n]}this._setupDisabled(r)},load:function(t,n){t=this._getIndex(t);var r=this,i=this.tabs.eq(t),o=i.find(".ui-tabs-anchor"),u=this._getPanelForTab(i),a={tab:i,panel:u};if(s(o[0]))return;this.xhr=e.ajax(this._ajaxSettings(o,n,a)),this.xhr&&this.xhr.statusText!=="canceled"&&(i.addClass("ui-tabs-loading"),u.attr("aria-busy","true"),this.xhr.success(function(e){setTimeout(function(){u.html(e),r._trigger("load",n,a)},1)}).complete(function(e,t){setTimeout(function(){t==="abort"&&r.panels.stop(!1,!0),i.removeClass("ui-tabs-loading"),u.removeAttr("aria-busy"),e===r.xhr&&delete r.xhr},1)}))},_ajaxSettings:function(t,n,r){var i=this;return{url:t.attr("href"),beforeSend:function(t,s){return i._trigger("beforeLoad",n,e.extend({jqXHR:t,ajaxSettings:s},r))}}},_getPanelForTab:function(t){var n=e(t).attr("aria-controls");return this.element.find(this._sanitizeSelector("#"+n))}})}(jQuery),function(e){function n(t,n){var r=(t.attr("aria-describedby")||"").split(/\s+/);r.push(n),t.data("ui-tooltip-id",n).attr("aria-describedby",e.trim(r.join(" ")))}function r(t){var n=t.data("ui-tooltip-id"),r=(t.attr("aria-describedby")||"").split(/\s+/),i=e.inArray(n,r);i!==-1&&r.splice(i,1),t.removeData("ui-tooltip-id"),r=e.trim(r.join(" ")),r?t.attr("aria-describedby",r):t.removeAttr("aria-describedby")}var t=0;e.widget("ui.tooltip",{version:"1.10.1",options:{content:function(){var t=e(this).attr("title")||"";return e("<a>").text(t).html()},hide:!0,items:"[title]:not([disabled])",position:{my:"left top+15",at:"left bottom",collision:"flipfit flip"},show:!0,tooltipClass:null,track:!1,close:null,open:null},_create:function(){this._on({mouseover:"open",focusin:"open"}),this.tooltips={},this.parents={},this.options.disabled&&this._disable()},_setOption:function(t,n){var r=this;if(t==="disabled"){this[n?"_disable":"_enable"](),this.options[t]=n;return}this._super(t,n),t==="content"&&e.each(this.tooltips,function(e,t){r._updateContent(t)})},_disable:function(){var t=this;e.each(this.tooltips,function(n,r){var i=e.Event("blur");i.target=i.currentTarget=r[0],t.close(i,!0)}),this.element.find(this.options.items).addBack().each(function(){var t=e(this);t.is("[title]")&&t.data("ui-tooltip-title",t.attr("title")).attr("title","")})},_enable:function(){this.element.find(this.options.items).addBack().each(function(){var t=e(this);t.data("ui-tooltip-title")&&t.attr("title",t.data("ui-tooltip-title"))})},open:function(t){var n=this,r=e(t?t.target:this.element).closest(this.options.items);if(!r.length||r.data("ui-tooltip-id"))return;r.attr("title")&&r.data("ui-tooltip-title",r.attr("title")),r.data("ui-tooltip-open",!0),t&&t.type==="mouseover"&&r.parents().each(function(){var t=e(this),r;t.data("ui-tooltip-open")&&(r=e.Event("blur"),r.target=r.currentTarget=this,n.close(r,!0)),t.attr("title")&&(t.uniqueId(),n.parents[this.id]={element:this,title:t.attr("title")},t.attr("title",""))}),this._updateContent(r,t)},_updateContent:function(e,t){var n,r=this.options.content,i=this,s=t?t.type:null;if(typeof r=="string")return this._open(t,e,r);n=r.call(e[0],function(n){if(!e.data("ui-tooltip-open"))return;i._delay(function(){t&&(t.type=s),this._open(t,e,n)})}),n&&this._open(t,e,n)},_open:function(t,r,i){function f(e){a.of=e;if(s.is(":hidden"))return;s.position(a)}var s,o,u,a=e.extend({},this.options.position);if(!i)return;s=this._find(r);if(s.length){s.find(".ui-tooltip-content").html(i);return}r.is("[title]")&&(t&&t.type==="mouseover"?r.attr("title",""):r.removeAttr("title")),s=this._tooltip(r),n(r,s.attr("id")),s.find(".ui-tooltip-content").html(i),this.options.track&&t&&/^mouse/.test(t.type)?(this._on(this.document,{mousemove:f}),f(t)):s.position(e.extend({of:r},this.options.position)),s.hide(),this._show(s,this.options.show),this.options.show&&this.options.show.delay&&(u=this.delayedShow=setInterval(function(){s.is(":visible")&&(f(a.of),clearInterval(u))},e.fx.interval)),this._trigger("open",t,{tooltip:s}),o={keyup:function(t){if(t.keyCode===e.ui.keyCode.ESCAPE){var n=e.Event(t);n.currentTarget=r[0],this.close(n,!0)}},remove:function(){this._removeTooltip(s)}};if(!t||t.type==="mouseover")o.mouseleave="close";if(!t||t.type==="focusin")o.focusout="close";this._on(!0,r,o)},close:function(t){var n=this,i=e(t?t.currentTarget:this.element),s=this._find(i);if(this.closing)return;clearInterval(this.delayedShow),i.data("ui-tooltip-title")&&i.attr("title",i.data("ui-tooltip-title")),r(i),s.stop(!0),this._hide(s,this.options.hide,function(){n._removeTooltip(e(this))}),i.removeData("ui-tooltip-open"),this._off(i,"mouseleave focusout keyup"),i[0]!==this.element[0]&&this._off(i,"remove"),this._off(this.document,"mousemove"),t&&t.type==="mouseleave"&&e.each(this.parents,function(t,r){e(r.element).attr("title",r.title),delete n.parents[t]}),this.closing=!0,this._trigger("close",t,{tooltip:s}),this.closing=!1},_tooltip:function(n){var r="ui-tooltip-"+t++,i=e("<div>").attr({id:r,role:"tooltip"}).addClass("ui-tooltip ui-widget ui-corner-all ui-widget-content "+(this.options.tooltipClass||""));return e("<div>").addClass("ui-tooltip-content").appendTo(i),i.appendTo(this.document[0].body),this.tooltips[r]=n,i},_find:function(t){var n=t.data("ui-tooltip-id");return n?e("#"+n):e()},_removeTooltip:function(e){e.remove(),delete this.tooltips[e.attr("id")]},_destroy:function(){var t=this;e.each(this.tooltips,function(n,r){var i=e.Event("blur");i.target=i.currentTarget=r[0],t.close(i,!0),e("#"+n).remove(),r.data("ui-tooltip-title")&&(r.attr("title",r.data("ui-tooltip-title")),r.removeData("ui-tooltip-title"))})}})}(jQuery);
/*
    json2.js
    2012-10-08

    Public Domain.

    NO WARRANTY EXPRESSED OR IMPLIED. USE AT YOUR OWN RISK.

    See http://www.JSON.org/js.html


    This code should be minified before deployment.
    See http://javascript.crockford.com/jsmin.html

    USE YOUR OWN COPY. IT IS EXTREMELY UNWISE TO LOAD CODE FROM SERVERS YOU DO
    NOT CONTROL.


    This file creates a global JSON object containing two methods: stringify
    and parse.

        JSON.stringify(value, replacer, space)
            value       any JavaScript value, usually an object or array.

            replacer    an optional parameter that determines how object
                        values are stringified for objects. It can be a
                        function or an array of strings.

            space       an optional parameter that specifies the indentation
                        of nested structures. If it is omitted, the text will
                        be packed without extra whitespace. If it is a number,
                        it will specify the number of spaces to indent at each
                        level. If it is a string (such as '\t' or '&nbsp;'),
                        it contains the characters used to indent at each level.

            This method produces a JSON text from a JavaScript value.

            When an object value is found, if the object contains a toJSON
            method, its toJSON method will be called and the result will be
            stringified. A toJSON method does not serialize: it returns the
            value represented by the name/value pair that should be serialized,
            or undefined if nothing should be serialized. The toJSON method
            will be passed the key associated with the value, and this will be
            bound to the value

            For example, this would serialize Dates as ISO strings.

                Date.prototype.toJSON = function (key) {
                    function f(n) {
                        // Format integers to have at least two digits.
                        return n < 10 ? '0' + n : n;
                    }

                    return this.getUTCFullYear()   + '-' +
                         f(this.getUTCMonth() + 1) + '-' +
                         f(this.getUTCDate())      + 'T' +
                         f(this.getUTCHours())     + ':' +
                         f(this.getUTCMinutes())   + ':' +
                         f(this.getUTCSeconds())   + 'Z';
                };

            You can provide an optional replacer method. It will be passed the
            key and value of each member, with this bound to the containing
            object. The value that is returned from your method will be
            serialized. If your method returns undefined, then the member will
            be excluded from the serialization.

            If the replacer parameter is an array of strings, then it will be
            used to select the members to be serialized. It filters the results
            such that only members with keys listed in the replacer array are
            stringified.

            Values that do not have JSON representations, such as undefined or
            functions, will not be serialized. Such values in objects will be
            dropped; in arrays they will be replaced with null. You can use
            a replacer function to replace those with JSON values.
            JSON.stringify(undefined) returns undefined.

            The optional space parameter produces a stringification of the
            value that is filled with line breaks and indentation to make it
            easier to read.

            If the space parameter is a non-empty string, then that string will
            be used for indentation. If the space parameter is a number, then
            the indentation will be that many spaces.

            Example:

            text = JSON.stringify(['e', {pluribus: 'unum'}]);
            // text is '["e",{"pluribus":"unum"}]'


            text = JSON.stringify(['e', {pluribus: 'unum'}], null, '\t');
            // text is '[\n\t"e",\n\t{\n\t\t"pluribus": "unum"\n\t}\n]'

            text = JSON.stringify([new Date()], function (key, value) {
                return this[key] instanceof Date ?
                    'Date(' + this[key] + ')' : value;
            });
            // text is '["Date(---current time---)"]'


        JSON.parse(text, reviver)
            This method parses a JSON text to produce an object or array.
            It can throw a SyntaxError exception.

            The optional reviver parameter is a function that can filter and
            transform the results. It receives each of the keys and values,
            and its return value is used instead of the original value.
            If it returns what it received, then the structure is not modified.
            If it returns undefined then the member is deleted.

            Example:

            // Parse the text. Values that look like ISO date strings will
            // be converted to Date objects.

            myData = JSON.parse(text, function (key, value) {
                var a;
                if (typeof value === 'string') {
                    a =
/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2}(?:\.\d*)?)Z$/.exec(value);
                    if (a) {
                        return new Date(Date.UTC(+a[1], +a[2] - 1, +a[3], +a[4],
                            +a[5], +a[6]));
                    }
                }
                return value;
            });

            myData = JSON.parse('["Date(09/09/2001)"]', function (key, value) {
                var d;
                if (typeof value === 'string' &&
                        value.slice(0, 5) === 'Date(' &&
                        value.slice(-1) === ')') {
                    d = new Date(value.slice(5, -1));
                    if (d) {
                        return d;
                    }
                }
                return value;
            });


    This is a reference implementation. You are free to copy, modify, or
    redistribute.
*/

/*jslint evil: true, regexp: true */

/*members "", "\b", "\t", "\n", "\f", "\r", "\"", JSON, "\\", apply,
    call, charCodeAt, getUTCDate, getUTCFullYear, getUTCHours,
    getUTCMinutes, getUTCMonth, getUTCSeconds, hasOwnProperty, join,
    lastIndex, length, parse, prototype, push, replace, slice, stringify,
    test, toJSON, toString, valueOf
*/


// Create a JSON object only if one does not already exist. We create the
// methods in a closure to avoid creating global variables.

if (typeof JSON !== 'object') {
    JSON = {};
}

(function () {
    'use strict';

    function f(n) {
        // Format integers to have at least two digits.
        return n < 10 ? '0' + n : n;
    }

    if (typeof Date.prototype.toJSON !== 'function') {

        Date.prototype.toJSON = function (key) {

            return isFinite(this.valueOf())
                ? this.getUTCFullYear()     + '-' +
                    f(this.getUTCMonth() + 1) + '-' +
                    f(this.getUTCDate())      + 'T' +
                    f(this.getUTCHours())     + ':' +
                    f(this.getUTCMinutes())   + ':' +
                    f(this.getUTCSeconds())   + 'Z'
                : null;
        };

        String.prototype.toJSON      =
            Number.prototype.toJSON  =
            Boolean.prototype.toJSON = function (key) {
                return this.valueOf();
            };
    }

    var cx = /[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
        escapable = /[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
        gap,
        indent,
        meta = {    // table of character substitutions
            '\b': '\\b',
            '\t': '\\t',
            '\n': '\\n',
            '\f': '\\f',
            '\r': '\\r',
            '"' : '\\"',
            '\\': '\\\\'
        },
        rep;


    function quote(string) {

// If the string contains no control characters, no quote characters, and no
// backslash characters, then we can safely slap some quotes around it.
// Otherwise we must also replace the offending characters with safe escape
// sequences.

        escapable.lastIndex = 0;
        return escapable.test(string) ? '"' + string.replace(escapable, function (a) {
            var c = meta[a];
            return typeof c === 'string'
                ? c
                : '\\u' + ('0000' + a.charCodeAt(0).toString(16)).slice(-4);
        }) + '"' : '"' + string + '"';
    }


    function str(key, holder) {

// Produce a string from holder[key].

        var i,          // The loop counter.
            k,          // The member key.
            v,          // The member value.
            length,
            mind = gap,
            partial,
            value = holder[key];

// If the value has a toJSON method, call it to obtain a replacement value.

        if (value && typeof value === 'object' &&
                typeof value.toJSON === 'function') {
            value = value.toJSON(key);
        }

// If we were called with a replacer function, then call the replacer to
// obtain a replacement value.

        if (typeof rep === 'function') {
            value = rep.call(holder, key, value);
        }

// What happens next depends on the value's type.

        switch (typeof value) {
        case 'string':
            return quote(value);

        case 'number':

// JSON numbers must be finite. Encode non-finite numbers as null.

            return isFinite(value) ? String(value) : 'null';

        case 'boolean':
        case 'null':

// If the value is a boolean or null, convert it to a string. Note:
// typeof null does not produce 'null'. The case is included here in
// the remote chance that this gets fixed someday.

            return String(value);

// If the type is 'object', we might be dealing with an object or an array or
// null.

        case 'object':

// Due to a specification blunder in ECMAScript, typeof null is 'object',
// so watch out for that case.

            if (!value) {
                return 'null';
            }

// Make an array to hold the partial results of stringifying this object value.

            gap += indent;
            partial = [];

// Is the value an array?

            if (Object.prototype.toString.apply(value) === '[object Array]') {

// The value is an array. Stringify every element. Use null as a placeholder
// for non-JSON values.

                length = value.length;
                for (i = 0; i < length; i += 1) {
                    partial[i] = str(i, value) || 'null';
                }

// Join all of the elements together, separated with commas, and wrap them in
// brackets.

                v = partial.length === 0
                    ? '[]'
                    : gap
                    ? '[\n' + gap + partial.join(',\n' + gap) + '\n' + mind + ']'
                    : '[' + partial.join(',') + ']';
                gap = mind;
                return v;
            }

// If the replacer is an array, use it to select the members to be stringified.

            if (rep && typeof rep === 'object') {
                length = rep.length;
                for (i = 0; i < length; i += 1) {
                    if (typeof rep[i] === 'string') {
                        k = rep[i];
                        v = str(k, value);
                        if (v) {
                            partial.push(quote(k) + (gap ? ': ' : ':') + v);
                        }
                    }
                }
            } else {

// Otherwise, iterate through all of the keys in the object.

                for (k in value) {
                    if (Object.prototype.hasOwnProperty.call(value, k)) {
                        v = str(k, value);
                        if (v) {
                            partial.push(quote(k) + (gap ? ': ' : ':') + v);
                        }
                    }
                }
            }

// Join all of the member texts together, separated with commas,
// and wrap them in braces.

            v = partial.length === 0
                ? '{}'
                : gap
                ? '{\n' + gap + partial.join(',\n' + gap) + '\n' + mind + '}'
                : '{' + partial.join(',') + '}';
            gap = mind;
            return v;
        }
    }

// If the JSON object does not yet have a stringify method, give it one.

    if (typeof JSON.stringify !== 'function') {
        JSON.stringify = function (value, replacer, space) {

// The stringify method takes a value and an optional replacer, and an optional
// space parameter, and returns a JSON text. The replacer can be a function
// that can replace values, or an array of strings that will select the keys.
// A default replacer method can be provided. Use of the space parameter can
// produce text that is more easily readable.

            var i;
            gap = '';
            indent = '';

// If the space parameter is a number, make an indent string containing that
// many spaces.

            if (typeof space === 'number') {
                for (i = 0; i < space; i += 1) {
                    indent += ' ';
                }

// If the space parameter is a string, it will be used as the indent string.

            } else if (typeof space === 'string') {
                indent = space;
            }

// If there is a replacer, it must be a function or an array.
// Otherwise, throw an error.

            rep = replacer;
            if (replacer && typeof replacer !== 'function' &&
                    (typeof replacer !== 'object' ||
                    typeof replacer.length !== 'number')) {
                throw new Error('JSON.stringify');
            }

// Make a fake root object containing our value under the key of ''.
// Return the result of stringifying the value.

            return str('', {'': value});
        };
    }


// If the JSON object does not yet have a parse method, give it one.

    if (typeof JSON.parse !== 'function') {
        JSON.parse = function (text, reviver) {

// The parse method takes a text and an optional reviver function, and returns
// a JavaScript value if the text is a valid JSON text.

            var j;

            function walk(holder, key) {

// The walk method is used to recursively walk the resulting structure so
// that modifications can be made.

                var k, v, value = holder[key];
                if (value && typeof value === 'object') {
                    for (k in value) {
                        if (Object.prototype.hasOwnProperty.call(value, k)) {
                            v = walk(value, k);
                            if (v !== undefined) {
                                value[k] = v;
                            } else {
                                delete value[k];
                            }
                        }
                    }
                }
                return reviver.call(holder, key, value);
            }


// Parsing happens in four stages. In the first stage, we replace certain
// Unicode characters with escape sequences. JavaScript handles many characters
// incorrectly, either silently deleting them, or treating them as line endings.

            text = String(text);
            cx.lastIndex = 0;
            if (cx.test(text)) {
                text = text.replace(cx, function (a) {
                    return '\\u' +
                        ('0000' + a.charCodeAt(0).toString(16)).slice(-4);
                });
            }

// In the second stage, we run the text against regular expressions that look
// for non-JSON patterns. We are especially concerned with '()' and 'new'
// because they can cause invocation, and '=' because it can cause mutation.
// But just to be safe, we want to reject all unexpected forms.

// We split the second stage into 4 regexp operations in order to work around
// crippling inefficiencies in IE's and Safari's regexp engines. First we
// replace the JSON backslash pairs with '@' (a non-JSON character). Second, we
// replace all simple value tokens with ']' characters. Third, we delete all
// open brackets that follow a colon or comma or that begin the text. Finally,
// we look to see that the remaining characters are only whitespace or ']' or
// ',' or ':' or '{' or '}'. If that is so, then the text is safe for eval.

            if (/^[\],:{}\s]*$/
                    .test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g, '@')
                        .replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g, ']')
                        .replace(/(?:^|:|,)(?:\s*\[)+/g, ''))) {

// In the third stage we use the eval function to compile the text into a
// JavaScript structure. The '{' operator is subject to a syntactic ambiguity
// in JavaScript: it can begin a block or an object literal. We wrap the text
// in parens to eliminate the ambiguity.

                j = eval('(' + text + ')');

// In the optional fourth stage, we recursively walk the new structure, passing
// each name/value pair to a reviver function for possible transformation.

                return typeof reviver === 'function'
                    ? walk({'': j}, '')
                    : j;
            }

// If the text is not JSON parseable, then a SyntaxError is thrown.

            throw new SyntaxError('JSON.parse');
        };
    }
}());/**
 * History.js jQuery Adapter
 * @author Benjamin Arthur Lupton <contact@balupton.com>
 * @copyright 2010-2011 Benjamin Arthur Lupton <contact@balupton.com>
 * @license New BSD License <http://creativecommons.org/licenses/BSD/>
 */

// Closure
(function(window,undefined){
	"use strict";

	// Localise Globals
	var
		History = window.History = window.History||{},
		jQuery = window.jQuery;

	// Check Existence
	if ( typeof History.Adapter !== 'undefined' ) {
		throw new Error('History.js Adapter has already been loaded...');
	}

	// Add the Adapter
	History.Adapter = {
		/**
		 * History.Adapter.bind(el,event,callback)
		 * @param {Element|string} el
		 * @param {string} event - custom and standard events
		 * @param {function} callback
		 * @return {void}
		 */
		bind: function(el,event,callback){
			jQuery(el).bind(event,callback);
		},

		/**
		 * History.Adapter.trigger(el,event)
		 * @param {Element|string} el
		 * @param {string} event - custom and standard events
		 * @param {Object=} extra - a object of extra event data (optional)
		 * @return {void}
		 */
		trigger: function(el,event,extra){
			jQuery(el).trigger(event,extra);
		},

		/**
		 * History.Adapter.extractEventData(key,event,extra)
		 * @param {string} key - key for the event data to extract
		 * @param {string} event - custom and standard events
		 * @param {Object=} extra - a object of extra event data (optional)
		 * @return {mixed}
		 */
		extractEventData: function(key,event,extra){
			// jQuery Native then jQuery Custom
			var result = (event && event.originalEvent && event.originalEvent[key]) || (extra && extra[key]) || undefined;

			// Return
			return result;
		},

		/**
		 * History.Adapter.onDomLoad(callback)
		 * @param {function} callback
		 * @return {void}
		 */
		onDomLoad: function(callback) {
			jQuery(callback);
		}
	};

	// Try and Initialise History
	if ( typeof History.init !== 'undefined' ) {
		History.init();
	}

})(window);

/**
 * History.js HTML4 Support
 * Depends on the HTML5 Support
 * @author Benjamin Arthur Lupton <contact@balupton.com>
 * @copyright 2010-2011 Benjamin Arthur Lupton <contact@balupton.com>
 * @license New BSD License <http://creativecommons.org/licenses/BSD/>
 */

(function(window,undefined){
	"use strict";

	// ========================================================================
	// Initialise

	// Localise Globals
	var
		document = window.document, // Make sure we are using the correct document
		setTimeout = window.setTimeout||setTimeout,
		clearTimeout = window.clearTimeout||clearTimeout,
		setInterval = window.setInterval||setInterval,
		History = window.History = window.History||{}; // Public History Object

	// Check Existence
	if ( typeof History.initHtml4 !== 'undefined' ) {
		throw new Error('History.js HTML4 Support has already been loaded...');
	}


	// ========================================================================
	// Initialise HTML4 Support

	// Initialise HTML4 Support
	History.initHtml4 = function(){
		// Initialise
		if ( typeof History.initHtml4.initialized !== 'undefined' ) {
			// Already Loaded
			return false;
		}
		else {
			History.initHtml4.initialized = true;
		}


		// ====================================================================
		// Properties

		/**
		 * History.enabled
		 * Is History enabled?
		 */
		History.enabled = true;


		// ====================================================================
		// Hash Storage

		/**
		 * History.savedHashes
		 * Store the hashes in an array
		 */
		History.savedHashes = [];

		/**
		 * History.isLastHash(newHash)
		 * Checks if the hash is the last hash
		 * @param {string} newHash
		 * @return {boolean} true
		 */
		History.isLastHash = function(newHash){
			// Prepare
			var oldHash = History.getHashByIndex(),
				isLast;

			// Check
			isLast = newHash === oldHash;

			// Return isLast
			return isLast;
		};

		/**
		 * History.isHashEqual(newHash, oldHash)
		 * Checks to see if two hashes are functionally equal
		 * @param {string} newHash
		 * @param {string} oldHash
		 * @return {boolean} true
		 */
		History.isHashEqual = function(newHash, oldHash){
			newHash = encodeURIComponent(newHash).replace(/%25/g, "%");
			oldHash = encodeURIComponent(oldHash).replace(/%25/g, "%");
			return newHash === oldHash;
		};

		/**
		 * History.saveHash(newHash)
		 * Push a Hash
		 * @param {string} newHash
		 * @return {boolean} true
		 */
		History.saveHash = function(newHash){
			// Check Hash
			if ( History.isLastHash(newHash) ) {
				return false;
			}

			// Push the Hash
			History.savedHashes.push(newHash);

			// Return true
			return true;
		};

		/**
		 * History.getHashByIndex()
		 * Gets a hash by the index
		 * @param {integer} index
		 * @return {string}
		 */
		History.getHashByIndex = function(index){
			// Prepare
			var hash = null;

			// Handle
			if ( typeof index === 'undefined' ) {
				// Get the last inserted
				hash = History.savedHashes[History.savedHashes.length-1];
			}
			else if ( index < 0 ) {
				// Get from the end
				hash = History.savedHashes[History.savedHashes.length+index];
			}
			else {
				// Get from the beginning
				hash = History.savedHashes[index];
			}

			// Return hash
			return hash;
		};


		// ====================================================================
		// Discarded States

		/**
		 * History.discardedHashes
		 * A hashed array of discarded hashes
		 */
		History.discardedHashes = {};

		/**
		 * History.discardedStates
		 * A hashed array of discarded states
		 */
		History.discardedStates = {};

		/**
		 * History.discardState(State)
		 * Discards the state by ignoring it through History
		 * @param {object} State
		 * @return {true}
		 */
		History.discardState = function(discardedState,forwardState,backState){
			//History.debug('History.discardState', arguments);
			// Prepare
			var discardedStateHash = History.getHashByState(discardedState),
				discardObject;

			// Create Discard Object
			discardObject = {
				'discardedState': discardedState,
				'backState': backState,
				'forwardState': forwardState
			};

			// Add to DiscardedStates
			History.discardedStates[discardedStateHash] = discardObject;

			// Return true
			return true;
		};

		/**
		 * History.discardHash(hash)
		 * Discards the hash by ignoring it through History
		 * @param {string} hash
		 * @return {true}
		 */
		History.discardHash = function(discardedHash,forwardState,backState){
			//History.debug('History.discardState', arguments);
			// Create Discard Object
			var discardObject = {
				'discardedHash': discardedHash,
				'backState': backState,
				'forwardState': forwardState
			};

			// Add to discardedHash
			History.discardedHashes[discardedHash] = discardObject;

			// Return true
			return true;
		};

		/**
		 * History.discardedState(State)
		 * Checks to see if the state is discarded
		 * @param {object} State
		 * @return {bool}
		 */
		History.discardedState = function(State){
			// Prepare
			var StateHash = History.getHashByState(State),
				discarded;

			// Check
			discarded = History.discardedStates[StateHash]||false;

			// Return true
			return discarded;
		};

		/**
		 * History.discardedHash(hash)
		 * Checks to see if the state is discarded
		 * @param {string} State
		 * @return {bool}
		 */
		History.discardedHash = function(hash){
			// Check
			var discarded = History.discardedHashes[hash]||false;

			// Return true
			return discarded;
		};

		/**
		 * History.recycleState(State)
		 * Allows a discarded state to be used again
		 * @param {object} data
		 * @param {string} title
		 * @param {string} url
		 * @return {true}
		 */
		History.recycleState = function(State){
			//History.debug('History.recycleState', arguments);
			// Prepare
			var StateHash = History.getHashByState(State);

			// Remove from DiscardedStates
			if ( History.discardedState(State) ) {
				delete History.discardedStates[StateHash];
			}

			// Return true
			return true;
		};


		// ====================================================================
		// HTML4 HashChange Support

		if ( History.emulated.hashChange ) {
			/*
			 * We must emulate the HTML4 HashChange Support by manually checking for hash changes
			 */

			/**
			 * History.hashChangeInit()
			 * Init the HashChange Emulation
			 */
			History.hashChangeInit = function(){
				// Define our Checker Function
				History.checkerFunction = null;

				// Define some variables that will help in our checker function
				var lastDocumentHash = '',
					iframeId, iframe,
					lastIframeHash, checkerRunning,
					startedWithHash = Boolean(History.getHash());

				// Handle depending on the browser
				if ( History.isInternetExplorer() ) {
					// IE6 and IE7
					// We need to use an iframe to emulate the back and forward buttons

					// Create iFrame
					iframeId = 'historyjs-iframe';
					iframe = document.createElement('iframe');

					// Adjust iFarme
					// IE 6 requires iframe to have a src on HTTPS pages, otherwise it will throw a
					// "This page contains both secure and nonsecure items" warning.
					iframe.setAttribute('id', iframeId);
					iframe.setAttribute('src', '#');
					iframe.style.display = 'none';

					// Append iFrame
					document.body.appendChild(iframe);

					// Create initial history entry
					iframe.contentWindow.document.open();
					iframe.contentWindow.document.close();

					// Define some variables that will help in our checker function
					lastIframeHash = '';
					checkerRunning = false;

					// Define the checker function
					History.checkerFunction = function(){
						// Check Running
						if ( checkerRunning ) {
							return false;
						}

						// Update Running
						checkerRunning = true;

						// Fetch
						var
							documentHash = History.getHash(),
							iframeHash = History.getHash(iframe.contentWindow.document);

						// The Document Hash has changed (application caused)
						if ( documentHash !== lastDocumentHash ) {
							// Equalise
							lastDocumentHash = documentHash;

							// Create a history entry in the iframe
							if ( iframeHash !== documentHash ) {
								//History.debug('hashchange.checker: iframe hash change', 'documentHash (new):', documentHash, 'iframeHash (old):', iframeHash);

								// Equalise
								lastIframeHash = iframeHash = documentHash;

								// Create History Entry
								iframe.contentWindow.document.open();
								iframe.contentWindow.document.close();

								// Update the iframe's hash
								iframe.contentWindow.document.location.hash = History.escapeHash(documentHash);
							}

							// Trigger Hashchange Event
							History.Adapter.trigger(window,'hashchange');
						}

						// The iFrame Hash has changed (back button caused)
						else if ( iframeHash !== lastIframeHash ) {
							//History.debug('hashchange.checker: iframe hash out of sync', 'iframeHash (new):', iframeHash, 'documentHash (old):', documentHash);

							// Equalise
							lastIframeHash = iframeHash;
							
							// If there is no iframe hash that means we're at the original
							// iframe state.
							// And if there was a hash on the original request, the original
							// iframe state was replaced instantly, so skip this state and take
							// the user back to where they came from.
							if (startedWithHash && iframeHash === '') {
								History.back();
							}
							else {
								// Update the Hash
								History.setHash(iframeHash,false);
							}
						}

						// Reset Running
						checkerRunning = false;

						// Return true
						return true;
					};
				}
				else {
					// We are not IE
					// Firefox 1 or 2, Opera

					// Define the checker function
					History.checkerFunction = function(){
						// Prepare
						var documentHash = History.getHash()||'';

						// The Document Hash has changed (application caused)
						if ( documentHash !== lastDocumentHash ) {
							// Equalise
							lastDocumentHash = documentHash;

							// Trigger Hashchange Event
							History.Adapter.trigger(window,'hashchange');
						}

						// Return true
						return true;
					};
				}

				// Apply the checker function
				History.intervalList.push(setInterval(History.checkerFunction, History.options.hashChangeInterval));

				// Done
				return true;
			}; // History.hashChangeInit

			// Bind hashChangeInit
			History.Adapter.onDomLoad(History.hashChangeInit);

		} // History.emulated.hashChange


		// ====================================================================
		// HTML5 State Support

		// Non-Native pushState Implementation
		if ( History.emulated.pushState ) {
			/*
			 * We must emulate the HTML5 State Management by using HTML4 HashChange
			 */

			/**
			 * History.onHashChange(event)
			 * Trigger HTML5's window.onpopstate via HTML4 HashChange Support
			 */
			History.onHashChange = function(event){
				//History.debug('History.onHashChange', arguments);

				// Prepare
				var currentUrl = ((event && event.newURL) || History.getLocationHref()),
					currentHash = History.getHashByUrl(currentUrl),
					currentState = null,
					currentStateHash = null,
					currentStateHashExits = null,
					discardObject;

				// Check if we are the same state
				if ( History.isLastHash(currentHash) ) {
					// There has been no change (just the page's hash has finally propagated)
					//History.debug('History.onHashChange: no change');
					History.busy(false);
					return false;
				}

				// Reset the double check
				History.doubleCheckComplete();

				// Store our location for use in detecting back/forward direction
				History.saveHash(currentHash);

				// Expand Hash
				if ( currentHash && History.isTraditionalAnchor(currentHash) ) {
					//History.debug('History.onHashChange: traditional anchor', currentHash);
					// Traditional Anchor Hash
					History.Adapter.trigger(window,'anchorchange');
					History.busy(false);
					return false;
				}

				// Create State
				currentState = History.extractState(History.getFullUrl(currentHash||History.getLocationHref()),true);

				// Check if we are the same state
				if ( History.isLastSavedState(currentState) ) {
					//History.debug('History.onHashChange: no change');
					// There has been no change (just the page's hash has finally propagated)
					History.busy(false);
					return false;
				}

				// Create the state Hash
				currentStateHash = History.getHashByState(currentState);

				// Check if we are DiscardedState
				discardObject = History.discardedState(currentState);
				if ( discardObject ) {
					// Ignore this state as it has been discarded and go back to the state before it
					if ( History.getHashByIndex(-2) === History.getHashByState(discardObject.forwardState) ) {
						// We are going backwards
						//History.debug('History.onHashChange: go backwards');
						History.back(false);
					} else {
						// We are going forwards
						//History.debug('History.onHashChange: go forwards');
						History.forward(false);
					}
					return false;
				}

				// Push the new HTML5 State
				//History.debug('History.onHashChange: success hashchange');
				History.pushState(currentState.data,currentState.title,encodeURI(currentState.url),false);

				// End onHashChange closure
				return true;
			};
			History.Adapter.bind(window,'hashchange',History.onHashChange);

			/**
			 * History.pushState(data,title,url)
			 * Add a new State to the history object, become it, and trigger onpopstate
			 * We have to trigger for HTML4 compatibility
			 * @param {object} data
			 * @param {string} title
			 * @param {string} url
			 * @return {true}
			 */
			History.pushState = function(data,title,url,queue){
				//History.debug('History.pushState: called', arguments);

				// We assume that the URL passed in is URI-encoded, but this makes
				// sure that it's fully URI encoded; any '%'s that are encoded are
				// converted back into '%'s
				url = encodeURI(url).replace(/%25/g, "%");

				// Check the State
				if ( History.getHashByUrl(url) ) {
					throw new Error('History.js does not support states with fragment-identifiers (hashes/anchors).');
				}

				// Handle Queueing
				if ( queue !== false && History.busy() ) {
					// Wait + Push to Queue
					//History.debug('History.pushState: we must wait', arguments);
					History.pushQueue({
						scope: History,
						callback: History.pushState,
						args: arguments,
						queue: queue
					});
					return false;
				}

				// Make Busy
				History.busy(true);

				// Fetch the State Object
				var newState = History.createStateObject(data,title,url),
					newStateHash = History.getHashByState(newState),
					oldState = History.getState(false),
					oldStateHash = History.getHashByState(oldState),
					html4Hash = History.getHash(),
					wasExpected = History.expectedStateId == newState.id;

				// Store the newState
				History.storeState(newState);
				History.expectedStateId = newState.id;

				// Recycle the State
				History.recycleState(newState);

				// Force update of the title
				History.setTitle(newState);

				// Check if we are the same State
				if ( newStateHash === oldStateHash ) {
					//History.debug('History.pushState: no change', newStateHash);
					History.busy(false);
					return false;
				}

				// Update HTML5 State
				History.saveState(newState);

				// Fire HTML5 Event
				if(!wasExpected)
					History.Adapter.trigger(window,'statechange');

				// Update HTML4 Hash
				if ( !History.isHashEqual(newStateHash, html4Hash) && !History.isHashEqual(newStateHash, History.getShortUrl(History.getLocationHref())) ) {
					History.setHash(newStateHash,false);
				}
				
				History.busy(false);

				// End pushState closure
				return true;
			};

			/**
			 * History.replaceState(data,title,url)
			 * Replace the State and trigger onpopstate
			 * We have to trigger for HTML4 compatibility
			 * @param {object} data
			 * @param {string} title
			 * @param {string} url
			 * @return {true}
			 */
			History.replaceState = function(data,title,url,queue){
				//History.debug('History.replaceState: called', arguments);

				// We assume that the URL passed in is URI-encoded, but this makes
				// sure that it's fully URI encoded; any '%'s that are encoded are
				// converted back into '%'s
				url = encodeURI(url).replace(/%25/g, "%");

				// Check the State
				if ( History.getHashByUrl(url) ) {
					throw new Error('History.js does not support states with fragment-identifiers (hashes/anchors).');
				}

				// Handle Queueing
				if ( queue !== false && History.busy() ) {
					// Wait + Push to Queue
					//History.debug('History.replaceState: we must wait', arguments);
					History.pushQueue({
						scope: History,
						callback: History.replaceState,
						args: arguments,
						queue: queue
					});
					return false;
				}

				// Make Busy
				History.busy(true);

				// Fetch the State Objects
				var newState        = History.createStateObject(data,title,url),
					newStateHash = History.getHashByState(newState),
					oldState        = History.getState(false),
					oldStateHash = History.getHashByState(oldState),
					previousState   = History.getStateByIndex(-2);

				// Discard Old State
				History.discardState(oldState,newState,previousState);

				// If the url hasn't changed, just store and save the state
				// and fire a statechange event to be consistent with the
				// html 5 api
				if ( newStateHash === oldStateHash ) {
					// Store the newState
					History.storeState(newState);
					History.expectedStateId = newState.id;
	
					// Recycle the State
					History.recycleState(newState);
	
					// Force update of the title
					History.setTitle(newState);
					
					// Update HTML5 State
					History.saveState(newState);

					// Fire HTML5 Event
					//History.debug('History.pushState: trigger popstate');
					History.Adapter.trigger(window,'statechange');
					History.busy(false);
				}
				else {
					// Alias to PushState
					History.pushState(newState.data,newState.title,newState.url,false);
				}

				// End replaceState closure
				return true;
			};

		} // History.emulated.pushState



		// ====================================================================
		// Initialise

		// Non-Native pushState Implementation
		if ( History.emulated.pushState ) {
			/**
			 * Ensure initial state is handled correctly
			 */
			if ( History.getHash() && !History.emulated.hashChange ) {
				History.Adapter.onDomLoad(function(){
					History.Adapter.trigger(window,'hashchange');
				});
			}

		} // History.emulated.pushState

	}; // History.initHtml4

	// Try to Initialise History
	if ( typeof History.init !== 'undefined' ) {
		History.init();
	}

})(window);
/**
 * History.js Core
 * @author Benjamin Arthur Lupton <contact@balupton.com>
 * @copyright 2010-2011 Benjamin Arthur Lupton <contact@balupton.com>
 * @license New BSD License <http://creativecommons.org/licenses/BSD/>
 */

(function(window,undefined){
	"use strict";

	// ========================================================================
	// Initialise

	// Localise Globals
	var
		console = window.console||undefined, // Prevent a JSLint complain
		document = window.document, // Make sure we are using the correct document
		navigator = window.navigator, // Make sure we are using the correct navigator
		sessionStorage = false, // sessionStorage
		setTimeout = window.setTimeout,
		clearTimeout = window.clearTimeout,
		setInterval = window.setInterval,
		clearInterval = window.clearInterval,
		JSON = window.JSON,
		alert = window.alert,
		History = window.History = window.History||{}, // Public History Object
		history = window.history; // Old History Object

	try {
		sessionStorage = window.sessionStorage; // This will throw an exception in some browsers when cookies/localStorage are explicitly disabled (i.e. Chrome)
		sessionStorage.setItem('TEST', '1');
		sessionStorage.removeItem('TEST');
	} catch(e) {
		sessionStorage = false;
	}

	// MooTools Compatibility
	JSON.stringify = JSON.stringify||JSON.encode;
	JSON.parse = JSON.parse||JSON.decode;

	// Check Existence
	if ( typeof History.init !== 'undefined' ) {
		throw new Error('History.js Core has already been loaded...');
	}

	// Initialise History
	History.init = function(options){
		// Check Load Status of Adapter
		if ( typeof History.Adapter === 'undefined' ) {
			return false;
		}

		// Check Load Status of Core
		if ( typeof History.initCore !== 'undefined' ) {
			History.initCore();
		}

		// Check Load Status of HTML4 Support
		if ( typeof History.initHtml4 !== 'undefined' ) {
			History.initHtml4();
		}

		// Return true
		return true;
	};


	// ========================================================================
	// Initialise Core

	// Initialise Core
	History.initCore = function(options){
		// Initialise
		if ( typeof History.initCore.initialized !== 'undefined' ) {
			// Already Loaded
			return false;
		}
		else {
			History.initCore.initialized = true;
		}


		// ====================================================================
		// Options

		/**
		 * History.options
		 * Configurable options
		 */
		History.options = History.options||{};

		/**
		 * History.options.hashChangeInterval
		 * How long should the interval be before hashchange checks
		 */
		History.options.hashChangeInterval = History.options.hashChangeInterval || 100;

		/**
		 * History.options.safariPollInterval
		 * How long should the interval be before safari poll checks
		 */
		History.options.safariPollInterval = History.options.safariPollInterval || 500;

		/**
		 * History.options.doubleCheckInterval
		 * How long should the interval be before we perform a double check
		 */
		History.options.doubleCheckInterval = History.options.doubleCheckInterval || 500;

		/**
		 * History.options.disableSuid
		 * Force History not to append suid
		 */
		History.options.disableSuid = History.options.disableSuid || false;

		/**
		 * History.options.storeInterval
		 * How long should we wait between store calls
		 */
		History.options.storeInterval = History.options.storeInterval || 1000;

		/**
		 * History.options.busyDelay
		 * How long should we wait between busy events
		 */
		History.options.busyDelay = History.options.busyDelay || 250;

		/**
		 * History.options.debug
		 * If true will enable debug messages to be logged
		 */
		History.options.debug = History.options.debug || false;

		/**
		 * History.options.initialTitle
		 * What is the title of the initial state
		 */
		History.options.initialTitle = History.options.initialTitle || document.title;

		/**
		 * History.options.html4Mode
		 * If true, will force HTMl4 mode (hashtags)
		 */
		History.options.html4Mode = History.options.html4Mode || false;

		/**
		 * History.options.delayInit
		 * Want to override default options and call init manually.
		 */
		History.options.delayInit = History.options.delayInit || false;


		// ====================================================================
		// Interval record

		/**
		 * History.intervalList
		 * List of intervals set, to be cleared when document is unloaded.
		 */
		History.intervalList = [];

		/**
		 * History.clearAllIntervals
		 * Clears all setInterval instances.
		 */
		History.clearAllIntervals = function(){
			var i, il = History.intervalList;
			if (typeof il !== "undefined" && il !== null) {
				for (i = 0; i < il.length; i++) {
					clearInterval(il[i]);
				}
				History.intervalList = null;
			}
		};


		// ====================================================================
		// Debug

		/**
		 * History.debug(message,...)
		 * Logs the passed arguments if debug enabled
		 */
		History.debug = function(){
			if ( (History.options.debug||false) ) {
				History.log.apply(History,arguments);
			}
		};

		/**
		 * History.log(message,...)
		 * Logs the passed arguments
		 */
		History.log = function(){
			// Prepare
			var
				consoleExists = !(typeof console === 'undefined' || typeof console.log === 'undefined' || typeof console.log.apply === 'undefined'),
				textarea = document.getElementById('log'),
				message,
				i,n,
				args,arg
				;

			// Write to Console
			if ( consoleExists ) {
				args = Array.prototype.slice.call(arguments);
				message = args.shift();
				if ( typeof console.debug !== 'undefined' ) {
					console.debug.apply(console,[message,args]);
				}
				else {
					console.log.apply(console,[message,args]);
				}
			}
			else {
				message = ("\n"+arguments[0]+"\n");
			}

			// Write to log
			for ( i=1,n=arguments.length; i<n; ++i ) {
				arg = arguments[i];
				if ( typeof arg === 'object' && typeof JSON !== 'undefined' ) {
					try {
						arg = JSON.stringify(arg);
					}
					catch ( Exception ) {
						// Recursive Object
					}
				}
				message += "\n"+arg+"\n";
			}

			// Textarea
			if ( textarea ) {
				textarea.value += message+"\n-----\n";
				textarea.scrollTop = textarea.scrollHeight - textarea.clientHeight;
			}
			// No Textarea, No Console
			else if ( !consoleExists ) {
				alert(message);
			}

			// Return true
			return true;
		};


		// ====================================================================
		// Emulated Status

		/**
		 * History.getInternetExplorerMajorVersion()
		 * Get's the major version of Internet Explorer
		 * @return {integer}
		 * @license Public Domain
		 * @author Benjamin Arthur Lupton <contact@balupton.com>
		 * @author James Padolsey <https://gist.github.com/527683>
		 */
		History.getInternetExplorerMajorVersion = function(){
			var result = History.getInternetExplorerMajorVersion.cached =
					(typeof History.getInternetExplorerMajorVersion.cached !== 'undefined')
				?	History.getInternetExplorerMajorVersion.cached
				:	(function(){
						var v = 3,
								div = document.createElement('div'),
								all = div.getElementsByTagName('i');
						while ( (div.innerHTML = '<!--[if gt IE ' + (++v) + ']><i></i><![endif]-->') && all[0] ) {}
						return (v > 4) ? v : false;
					})()
				;
			return result;
		};

		/**
		 * History.isInternetExplorer()
		 * Are we using Internet Explorer?
		 * @return {boolean}
		 * @license Public Domain
		 * @author Benjamin Arthur Lupton <contact@balupton.com>
		 */
		History.isInternetExplorer = function(){
			var result =
				History.isInternetExplorer.cached =
				(typeof History.isInternetExplorer.cached !== 'undefined')
					?	History.isInternetExplorer.cached
					:	Boolean(History.getInternetExplorerMajorVersion())
				;
			return result;
		};

		/**
		 * History.emulated
		 * Which features require emulating?
		 */

		if (History.options.html4Mode) {
			History.emulated = {
				pushState : true,
				hashChange: true
			};
		}

		else {

			History.emulated = {
				pushState: !Boolean(
					window.history && window.history.pushState && window.history.replaceState
					&& !(
						(/ Mobile\/([1-7][a-z]|(8([abcde]|f(1[0-8]))))/i).test(navigator.userAgent) /* disable for versions of iOS before version 4.3 (8F190) */
						|| (/AppleWebKit\/5([0-2]|3[0-2])/i).test(navigator.userAgent) /* disable for the mercury iOS browser, or at least older versions of the webkit engine */
					)
				),
				hashChange: Boolean(
					!(('onhashchange' in window) || ('onhashchange' in document))
					||
					(History.isInternetExplorer() && History.getInternetExplorerMajorVersion() < 8)
				)
			};
		}

		/**
		 * History.enabled
		 * Is History enabled?
		 */
		History.enabled = !History.emulated.pushState;

		/**
		 * History.bugs
		 * Which bugs are present
		 */
		History.bugs = {
			/**
			 * Safari 5 and Safari iOS 4 fail to return to the correct state once a hash is replaced by a `replaceState` call
			 * https://bugs.webkit.org/show_bug.cgi?id=56249
			 */
			setHash: Boolean(!History.emulated.pushState && navigator.vendor === 'Apple Computer, Inc.' && /AppleWebKit\/5([0-2]|3[0-3])/.test(navigator.userAgent)),

			/**
			 * Safari 5 and Safari iOS 4 sometimes fail to apply the state change under busy conditions
			 * https://bugs.webkit.org/show_bug.cgi?id=42940
			 */
			safariPoll: Boolean(!History.emulated.pushState && navigator.vendor === 'Apple Computer, Inc.' && /AppleWebKit\/5([0-2]|3[0-3])/.test(navigator.userAgent)),

			/**
			 * MSIE 6 and 7 sometimes do not apply a hash even it was told to (requiring a second call to the apply function)
			 */
			ieDoubleCheck: Boolean(History.isInternetExplorer() && History.getInternetExplorerMajorVersion() < 8),

			/**
			 * MSIE 6 requires the entire hash to be encoded for the hashes to trigger the onHashChange event
			 */
			hashEscape: Boolean(History.isInternetExplorer() && History.getInternetExplorerMajorVersion() < 7)
		};

		/**
		 * History.isEmptyObject(obj)
		 * Checks to see if the Object is Empty
		 * @param {Object} obj
		 * @return {boolean}
		 */
		History.isEmptyObject = function(obj) {
			for ( var name in obj ) {
				if ( obj.hasOwnProperty(name) ) {
					return false;
				}
			}
			return true;
		};

		/**
		 * History.cloneObject(obj)
		 * Clones a object and eliminate all references to the original contexts
		 * @param {Object} obj
		 * @return {Object}
		 */
		History.cloneObject = function(obj) {
			var hash,newObj;
			if ( obj ) {
				hash = JSON.stringify(obj);
				newObj = JSON.parse(hash);
			}
			else {
				newObj = {};
			}
			return newObj;
		};


		// ====================================================================
		// URL Helpers

		/**
		 * History.getRootUrl()
		 * Turns "http://mysite.com/dir/page.html?asd" into "http://mysite.com"
		 * @return {String} rootUrl
		 */
		History.getRootUrl = function(){
			// Create
			var rootUrl = document.location.protocol+'//'+(document.location.hostname||document.location.host);
			if ( document.location.port||false ) {
				rootUrl += ':'+document.location.port;
			}
			rootUrl += '/';

			// Return
			return rootUrl;
		};

		/**
		 * History.getBaseHref()
		 * Fetches the `href` attribute of the `<base href="...">` element if it exists
		 * @return {String} baseHref
		 */
		History.getBaseHref = function(){
			// Create
			var
				baseElements = document.getElementsByTagName('base'),
				baseElement = null,
				baseHref = '';

			// Test for Base Element
			if ( baseElements.length === 1 ) {
				// Prepare for Base Element
				baseElement = baseElements[0];
				baseHref = baseElement.href.replace(/[^\/]+$/,'');
			}

			// Adjust trailing slash
			baseHref = baseHref.replace(/\/+$/,'');
			if ( baseHref ) baseHref += '/';

			// Return
			return baseHref;
		};

		/**
		 * History.getBaseUrl()
		 * Fetches the baseHref or basePageUrl or rootUrl (whichever one exists first)
		 * @return {String} baseUrl
		 */
		History.getBaseUrl = function(){
			// Create
			var baseUrl = History.getBaseHref()||History.getBasePageUrl()||History.getRootUrl();

			// Return
			return baseUrl;
		};

		/**
		 * History.getPageUrl()
		 * Fetches the URL of the current page
		 * @return {String} pageUrl
		 */
		History.getPageUrl = function(){
			// Fetch
			var
				State = History.getState(false,false),
				stateUrl = (State||{}).url||History.getLocationHref(),
				pageUrl;

			// Create
			pageUrl = stateUrl.replace(/\/+$/,'').replace(/[^\/]+$/,function(part,index,string){
				return (/\./).test(part) ? part : part+'/';
			});

			// Return
			return pageUrl;
		};

		/**
		 * History.getBasePageUrl()
		 * Fetches the Url of the directory of the current page
		 * @return {String} basePageUrl
		 */
		History.getBasePageUrl = function(){
			// Create
			var basePageUrl = (History.getLocationHref()).replace(/[#\?].*/,'').replace(/[^\/]+$/,function(part,index,string){
				return (/[^\/]$/).test(part) ? '' : part;
			}).replace(/\/+$/,'')+'/';

			// Return
			return basePageUrl;
		};

		/**
		 * History.getFullUrl(url)
		 * Ensures that we have an absolute URL and not a relative URL
		 * @param {string} url
		 * @param {Boolean} allowBaseHref
		 * @return {string} fullUrl
		 */
		History.getFullUrl = function(url,allowBaseHref){
			// Prepare
			var fullUrl = url, firstChar = url.substring(0,1);
			allowBaseHref = (typeof allowBaseHref === 'undefined') ? true : allowBaseHref;

			// Check
			if ( /[a-z]+\:\/\//.test(url) ) {
				// Full URL
			}
			else if ( firstChar === '/' ) {
				// Root URL
				fullUrl = History.getRootUrl()+url.replace(/^\/+/,'');
			}
			else if ( firstChar === '#' ) {
				// Anchor URL
				fullUrl = History.getPageUrl().replace(/#.*/,'')+url;
			}
			else if ( firstChar === '?' ) {
				// Query URL
				fullUrl = History.getPageUrl().replace(/[\?#].*/,'')+url;
			}
			else {
				// Relative URL
				if ( allowBaseHref ) {
					fullUrl = History.getBaseUrl()+url.replace(/^(\.\/)+/,'');
				} else {
					fullUrl = History.getBasePageUrl()+url.replace(/^(\.\/)+/,'');
				}
				// We have an if condition above as we do not want hashes
				// which are relative to the baseHref in our URLs
				// as if the baseHref changes, then all our bookmarks
				// would now point to different locations
				// whereas the basePageUrl will always stay the same
			}

			// Return
			return fullUrl.replace(/\#$/,'');
		};

		/**
		 * History.getShortUrl(url)
		 * Ensures that we have a relative URL and not a absolute URL
		 * @param {string} url
		 * @return {string} url
		 */
		History.getShortUrl = function(url){
			// Prepare
			var shortUrl = url, baseUrl = History.getBaseUrl(), rootUrl = History.getRootUrl();

			// Trim baseUrl
			if ( History.emulated.pushState ) {
				// We are in a if statement as when pushState is not emulated
				// The actual url these short urls are relative to can change
				// So within the same session, we the url may end up somewhere different
				shortUrl = shortUrl.replace(baseUrl,'');
			}

			// Trim rootUrl
			shortUrl = shortUrl.replace(rootUrl,'/');

			// Ensure we can still detect it as a state
			if ( History.isTraditionalAnchor(shortUrl) ) {
				shortUrl = './'+shortUrl;
			}

			// Clean It
			shortUrl = shortUrl.replace(/^(\.\/)+/g,'./').replace(/\#$/,'');

			// Return
			return shortUrl;
		};

		/**
		 * History.getLocationHref(document)
		 * Returns a normalized version of document.location.href
		 * accounting for browser inconsistencies, etc.
		 *
		 * This URL will be URI-encoded and will include the hash
		 *
		 * @param {object} document
		 * @return {string} url
		 */
		History.getLocationHref = function(doc) {
			doc = doc || document;

			// most of the time, this will be true
			if (doc.URL === doc.location.href)
				return doc.location.href;

			// some versions of webkit URI-decode document.location.href
			// but they leave document.URL in an encoded state
			if (doc.location.href === decodeURIComponent(doc.URL))
				return doc.URL;

			// FF 3.6 only updates document.URL when a page is reloaded
			// document.location.href is updated correctly
			if (doc.location.hash && decodeURIComponent(doc.location.href.replace(/^[^#]+/, "")) === doc.location.hash)
				return doc.location.href;

			if (doc.URL.indexOf('#') == -1 && doc.location.href.indexOf('#') != -1)
				return doc.location.href;
			
			return doc.URL || doc.location.href;
		};


		// ====================================================================
		// State Storage

		/**
		 * History.store
		 * The store for all session specific data
		 */
		History.store = {};

		/**
		 * History.idToState
		 * 1-1: State ID to State Object
		 */
		History.idToState = History.idToState||{};

		/**
		 * History.stateToId
		 * 1-1: State String to State ID
		 */
		History.stateToId = History.stateToId||{};

		/**
		 * History.urlToId
		 * 1-1: State URL to State ID
		 */
		History.urlToId = History.urlToId||{};

		/**
		 * History.storedStates
		 * Store the states in an array
		 */
		History.storedStates = History.storedStates||[];

		/**
		 * History.savedStates
		 * Saved the states in an array
		 */
		History.savedStates = History.savedStates||[];

		/**
		 * History.noramlizeStore()
		 * Noramlize the store by adding necessary values
		 */
		History.normalizeStore = function(){
			History.store.idToState = History.store.idToState||{};
			History.store.urlToId = History.store.urlToId||{};
			History.store.stateToId = History.store.stateToId||{};
		};

		/**
		 * History.getState()
		 * Get an object containing the data, title and url of the current state
		 * @param {Boolean} friendly
		 * @param {Boolean} create
		 * @return {Object} State
		 */
		History.getState = function(friendly,create){
			// Prepare
			if ( typeof friendly === 'undefined' ) { friendly = true; }
			if ( typeof create === 'undefined' ) { create = true; }

			// Fetch
			var State = History.getLastSavedState();

			// Create
			if ( !State && create ) {
				State = History.createStateObject();
			}

			// Adjust
			if ( friendly ) {
				State = History.cloneObject(State);
				State.url = State.cleanUrl||State.url;
			}

			// Return
			return State;
		};

		/**
		 * History.getIdByState(State)
		 * Gets a ID for a State
		 * @param {State} newState
		 * @return {String} id
		 */
		History.getIdByState = function(newState){

			// Fetch ID
			var id = History.extractId(newState.url),
				str;

			if ( !id ) {
				// Find ID via State String
				str = History.getStateString(newState);
				if ( typeof History.stateToId[str] !== 'undefined' ) {
					id = History.stateToId[str];
				}
				else if ( typeof History.store.stateToId[str] !== 'undefined' ) {
					id = History.store.stateToId[str];
				}
				else {
					// Generate a new ID
					while ( true ) {
						id = (new Date()).getTime() + String(Math.random()).replace(/\D/g,'');
						if ( typeof History.idToState[id] === 'undefined' && typeof History.store.idToState[id] === 'undefined' ) {
							break;
						}
					}

					// Apply the new State to the ID
					History.stateToId[str] = id;
					History.idToState[id] = newState;
				}
			}

			// Return ID
			return id;
		};

		/**
		 * History.normalizeState(State)
		 * Expands a State Object
		 * @param {object} State
		 * @return {object}
		 */
		History.normalizeState = function(oldState){
			// Variables
			var newState, dataNotEmpty;

			// Prepare
			if ( !oldState || (typeof oldState !== 'object') ) {
				oldState = {};
			}

			// Check
			if ( typeof oldState.normalized !== 'undefined' ) {
				return oldState;
			}

			// Adjust
			if ( !oldState.data || (typeof oldState.data !== 'object') ) {
				oldState.data = {};
			}

			// ----------------------------------------------------------------

			// Create
			newState = {};
			newState.normalized = true;
			newState.title = oldState.title||'';
			newState.url = History.getFullUrl(oldState.url?oldState.url:(History.getLocationHref()));
			newState.hash = History.getShortUrl(newState.url);
			newState.data = History.cloneObject(oldState.data);

			// Fetch ID
			newState.id = History.getIdByState(newState);

			// ----------------------------------------------------------------

			// Clean the URL
			newState.cleanUrl = newState.url.replace(/\??\&_suid.*/,'');
			newState.url = newState.cleanUrl;

			// Check to see if we have more than just a url
			dataNotEmpty = !History.isEmptyObject(newState.data);

			// Apply
			if ( (newState.title || dataNotEmpty) && History.options.disableSuid !== true ) {
				// Add ID to Hash
				newState.hash = History.getShortUrl(newState.url).replace(/\??\&_suid.*/,'');
				if ( !/\?/.test(newState.hash) ) {
					newState.hash += '?';
				}
				newState.hash += '&_suid='+newState.id;
			}

			// Create the Hashed URL
			newState.hashedUrl = History.getFullUrl(newState.hash);

			// ----------------------------------------------------------------

			// Update the URL if we have a duplicate
			if ( (History.emulated.pushState || History.bugs.safariPoll) && History.hasUrlDuplicate(newState) ) {
				newState.url = newState.hashedUrl;
			}

			// ----------------------------------------------------------------

			// Return
			return newState;
		};

		/**
		 * History.createStateObject(data,title,url)
		 * Creates a object based on the data, title and url state params
		 * @param {object} data
		 * @param {string} title
		 * @param {string} url
		 * @return {object}
		 */
		History.createStateObject = function(data,title,url){
			// Hashify
			var State = {
				'data': data,
				'title': title,
				'url': url
			};

			// Expand the State
			State = History.normalizeState(State);

			// Return object
			return State;
		};

		/**
		 * History.getStateById(id)
		 * Get a state by it's UID
		 * @param {String} id
		 */
		History.getStateById = function(id){
			// Prepare
			id = String(id);

			// Retrieve
			var State = History.idToState[id] || History.store.idToState[id] || undefined;

			// Return State
			return State;
		};

		/**
		 * Get a State's String
		 * @param {State} passedState
		 */
		History.getStateString = function(passedState){
			// Prepare
			var State, cleanedState, str;

			// Fetch
			State = History.normalizeState(passedState);

			// Clean
			cleanedState = {
				data: State.data,
				title: passedState.title,
				url: passedState.url
			};

			// Fetch
			str = JSON.stringify(cleanedState);

			// Return
			return str;
		};

		/**
		 * Get a State's ID
		 * @param {State} passedState
		 * @return {String} id
		 */
		History.getStateId = function(passedState){
			// Prepare
			var State, id;

			// Fetch
			State = History.normalizeState(passedState);

			// Fetch
			id = State.id;

			// Return
			return id;
		};

		/**
		 * History.getHashByState(State)
		 * Creates a Hash for the State Object
		 * @param {State} passedState
		 * @return {String} hash
		 */
		History.getHashByState = function(passedState){
			// Prepare
			var State, hash;

			// Fetch
			State = History.normalizeState(passedState);

			// Hash
			hash = State.hash;

			// Return
			return hash;
		};

		/**
		 * History.extractId(url_or_hash)
		 * Get a State ID by it's URL or Hash
		 * @param {string} url_or_hash
		 * @return {string} id
		 */
		History.extractId = function ( url_or_hash ) {
			// Prepare
			var id,parts,url, tmp;

			// Extract
			
			// If the URL has a #, use the id from before the #
			if (url_or_hash.indexOf('#') != -1)
			{
				tmp = url_or_hash.split("#")[0];
			}
			else
			{
				tmp = url_or_hash;
			}
			
			parts = /(.*)\&_suid=([0-9]+)$/.exec(tmp);
			url = parts ? (parts[1]||url_or_hash) : url_or_hash;
			id = parts ? String(parts[2]||'') : '';

			// Return
			return id||false;
		};

		/**
		 * History.isTraditionalAnchor
		 * Checks to see if the url is a traditional anchor or not
		 * @param {String} url_or_hash
		 * @return {Boolean}
		 */
		History.isTraditionalAnchor = function(url_or_hash){
			// Check
			var isTraditional = !(/[\/\?\.]/.test(url_or_hash));

			// Return
			return isTraditional;
		};

		/**
		 * History.extractState
		 * Get a State by it's URL or Hash
		 * @param {String} url_or_hash
		 * @return {State|null}
		 */
		History.extractState = function(url_or_hash,create){
			// Prepare
			var State = null, id, url;
			create = create||false;

			// Fetch SUID
			id = History.extractId(url_or_hash);
			if ( id ) {
				State = History.getStateById(id);
			}

			// Fetch SUID returned no State
			if ( !State ) {
				// Fetch URL
				url = History.getFullUrl(url_or_hash);

				// Check URL
				id = History.getIdByUrl(url)||false;
				if ( id ) {
					State = History.getStateById(id);
				}

				// Create State
				if ( !State && create && !History.isTraditionalAnchor(url_or_hash) ) {
					State = History.createStateObject(null,null,url);
				}
			}

			// Return
			return State;
		};

		/**
		 * History.getIdByUrl()
		 * Get a State ID by a State URL
		 */
		History.getIdByUrl = function(url){
			// Fetch
			var id = History.urlToId[url] || History.store.urlToId[url] || undefined;

			// Return
			return id;
		};

		/**
		 * History.getLastSavedState()
		 * Get an object containing the data, title and url of the current state
		 * @return {Object} State
		 */
		History.getLastSavedState = function(){
			return History.savedStates[History.savedStates.length-1]||undefined;
		};

		/**
		 * History.getLastStoredState()
		 * Get an object containing the data, title and url of the current state
		 * @return {Object} State
		 */
		History.getLastStoredState = function(){
			return History.storedStates[History.storedStates.length-1]||undefined;
		};

		/**
		 * History.hasUrlDuplicate
		 * Checks if a Url will have a url conflict
		 * @param {Object} newState
		 * @return {Boolean} hasDuplicate
		 */
		History.hasUrlDuplicate = function(newState) {
			// Prepare
			var hasDuplicate = false,
				oldState;

			// Fetch
			oldState = History.extractState(newState.url);

			// Check
			hasDuplicate = oldState && oldState.id !== newState.id;

			// Return
			return hasDuplicate;
		};

		/**
		 * History.storeState
		 * Store a State
		 * @param {Object} newState
		 * @return {Object} newState
		 */
		History.storeState = function(newState){
			// Store the State
			History.urlToId[newState.url] = newState.id;

			// Push the State
			History.storedStates.push(History.cloneObject(newState));

			// Return newState
			return newState;
		};

		/**
		 * History.isLastSavedState(newState)
		 * Tests to see if the state is the last state
		 * @param {Object} newState
		 * @return {boolean} isLast
		 */
		History.isLastSavedState = function(newState){
			// Prepare
			var isLast = false,
				newId, oldState, oldId;

			// Check
			if ( History.savedStates.length ) {
				newId = newState.id;
				oldState = History.getLastSavedState();
				oldId = oldState.id;

				// Check
				isLast = (newId === oldId);
			}

			// Return
			return isLast;
		};

		/**
		 * History.saveState
		 * Push a State
		 * @param {Object} newState
		 * @return {boolean} changed
		 */
		History.saveState = function(newState){
			// Check Hash
			if ( History.isLastSavedState(newState) ) {
				return false;
			}

			// Push the State
			History.savedStates.push(History.cloneObject(newState));

			// Return true
			return true;
		};

		/**
		 * History.getStateByIndex()
		 * Gets a state by the index
		 * @param {integer} index
		 * @return {Object}
		 */
		History.getStateByIndex = function(index){
			// Prepare
			var State = null;

			// Handle
			if ( typeof index === 'undefined' ) {
				// Get the last inserted
				State = History.savedStates[History.savedStates.length-1];
			}
			else if ( index < 0 ) {
				// Get from the end
				State = History.savedStates[History.savedStates.length+index];
			}
			else {
				// Get from the beginning
				State = History.savedStates[index];
			}

			// Return State
			return State;
		};
		
		/**
		 * History.getCurrentIndex()
		 * Gets the current index
		 * @return (integer)
		*/
		History.getCurrentIndex = function(){
			// Prepare
			var index = null;
			
			// No states saved
			if(History.savedStates.length < 1) {
				index = 0;
			}
			else {
				index = History.savedStates.length-1;
			}
			return index;
		};

		// ====================================================================
		// Hash Helpers

		/**
		 * History.getHash()
		 * @param {Location=} location
		 * Gets the current document hash
		 * Note: unlike location.hash, this is guaranteed to return the escaped hash in all browsers
		 * @return {string}
		 */
		History.getHash = function(doc){
			var url = History.getLocationHref(doc),
				hash;
			hash = History.getHashByUrl(url);
			return hash;
		};

		/**
		 * History.unescapeHash()
		 * normalize and Unescape a Hash
		 * @param {String} hash
		 * @return {string}
		 */
		History.unescapeHash = function(hash){
			// Prepare
			var result = History.normalizeHash(hash);

			// Unescape hash
			result = decodeURIComponent(result);

			// Return result
			return result;
		};

		/**
		 * History.normalizeHash()
		 * normalize a hash across browsers
		 * @return {string}
		 */
		History.normalizeHash = function(hash){
			// Prepare
			var result = hash.replace(/[^#]*#/,'').replace(/#.*/, '');

			// Return result
			return result;
		};

		/**
		 * History.setHash(hash)
		 * Sets the document hash
		 * @param {string} hash
		 * @return {History}
		 */
		History.setHash = function(hash,queue){
			// Prepare
			var State, pageUrl;

			// Handle Queueing
			if ( queue !== false && History.busy() ) {
				// Wait + Push to Queue
				//History.debug('History.setHash: we must wait', arguments);
				History.pushQueue({
					scope: History,
					callback: History.setHash,
					args: arguments,
					queue: queue
				});
				return false;
			}

			// Log
			//History.debug('History.setHash: called',hash);

			// Make Busy + Continue
			History.busy(true);

			// Check if hash is a state
			State = History.extractState(hash,true);
			if ( State && !History.emulated.pushState ) {
				// Hash is a state so skip the setHash
				//History.debug('History.setHash: Hash is a state so skipping the hash set with a direct pushState call',arguments);

				// PushState
				History.pushState(State.data,State.title,State.url,false);
			}
			else if ( History.getHash() !== hash ) {
				// Hash is a proper hash, so apply it

				// Handle browser bugs
				if ( History.bugs.setHash ) {
					// Fix Safari Bug https://bugs.webkit.org/show_bug.cgi?id=56249

					// Fetch the base page
					pageUrl = History.getPageUrl();

					// Safari hash apply
					History.pushState(null,null,pageUrl+'#'+hash,false);
				}
				else {
					// Normal hash apply
					document.location.hash = hash;
				}
			}

			// Chain
			return History;
		};

		/**
		 * History.escape()
		 * normalize and Escape a Hash
		 * @return {string}
		 */
		History.escapeHash = function(hash){
			// Prepare
			var result = History.normalizeHash(hash);

			// Escape hash
			result = window.encodeURIComponent(result);

			// IE6 Escape Bug
			if ( !History.bugs.hashEscape ) {
				// Restore common parts
				result = result
					.replace(/\%21/g,'!')
					.replace(/\%26/g,'&')
					.replace(/\%3D/g,'=')
					.replace(/\%3F/g,'?');
			}

			// Return result
			return result;
		};

		/**
		 * History.getHashByUrl(url)
		 * Extracts the Hash from a URL
		 * @param {string} url
		 * @return {string} url
		 */
		History.getHashByUrl = function(url){
			// Extract the hash
			var hash = String(url)
				.replace(/([^#]*)#?([^#]*)#?(.*)/, '$2')
				;

			// Unescape hash
			hash = History.unescapeHash(hash);

			// Return hash
			return hash;
		};

		/**
		 * History.setTitle(title)
		 * Applies the title to the document
		 * @param {State} newState
		 * @return {Boolean}
		 */
		History.setTitle = function(newState){
			// Prepare
			var title = newState.title,
				firstState;

			// Initial
			if ( !title ) {
				firstState = History.getStateByIndex(0);
				if ( firstState && firstState.url === newState.url ) {
					title = firstState.title||History.options.initialTitle;
				}
			}

			// Apply
			try {
				document.getElementsByTagName('title')[0].innerHTML = title.replace('<','&lt;').replace('>','&gt;').replace(' & ',' &amp; ');
			}
			catch ( Exception ) { }
			document.title = title;

			// Chain
			return History;
		};


		// ====================================================================
		// Queueing

		/**
		 * History.queues
		 * The list of queues to use
		 * First In, First Out
		 */
		History.queues = [];

		/**
		 * History.busy(value)
		 * @param {boolean} value [optional]
		 * @return {boolean} busy
		 */
		History.busy = function(value){
			// Apply
			if ( typeof value !== 'undefined' ) {
				//History.debug('History.busy: changing ['+(History.busy.flag||false)+'] to ['+(value||false)+']', History.queues.length);
				History.busy.flag = value;
			}
			// Default
			else if ( typeof History.busy.flag === 'undefined' ) {
				History.busy.flag = false;
			}

			// Queue
			if ( !History.busy.flag ) {
				// Execute the next item in the queue
				clearTimeout(History.busy.timeout);
				var fireNext = function(){
					var i, queue, item;
					if ( History.busy.flag ) return;
					for ( i=History.queues.length-1; i >= 0; --i ) {
						queue = History.queues[i];
						if ( queue.length === 0 ) continue;
						item = queue.shift();
						History.fireQueueItem(item);
						History.busy.timeout = setTimeout(fireNext,History.options.busyDelay);
					}
				};
				History.busy.timeout = setTimeout(fireNext,History.options.busyDelay);
			}

			// Return
			return History.busy.flag;
		};

		/**
		 * History.busy.flag
		 */
		History.busy.flag = false;

		/**
		 * History.fireQueueItem(item)
		 * Fire a Queue Item
		 * @param {Object} item
		 * @return {Mixed} result
		 */
		History.fireQueueItem = function(item){
			return item.callback.apply(item.scope||History,item.args||[]);
		};

		/**
		 * History.pushQueue(callback,args)
		 * Add an item to the queue
		 * @param {Object} item [scope,callback,args,queue]
		 */
		History.pushQueue = function(item){
			// Prepare the queue
			History.queues[item.queue||0] = History.queues[item.queue||0]||[];

			// Add to the queue
			History.queues[item.queue||0].push(item);

			// Chain
			return History;
		};

		/**
		 * History.queue (item,queue), (func,queue), (func), (item)
		 * Either firs the item now if not busy, or adds it to the queue
		 */
		History.queue = function(item,queue){
			// Prepare
			if ( typeof item === 'function' ) {
				item = {
					callback: item
				};
			}
			if ( typeof queue !== 'undefined' ) {
				item.queue = queue;
			}

			// Handle
			if ( History.busy() ) {
				History.pushQueue(item);
			} else {
				History.fireQueueItem(item);
			}

			// Chain
			return History;
		};

		/**
		 * History.clearQueue()
		 * Clears the Queue
		 */
		History.clearQueue = function(){
			History.busy.flag = false;
			History.queues = [];
			return History;
		};


		// ====================================================================
		// IE Bug Fix

		/**
		 * History.stateChanged
		 * States whether or not the state has changed since the last double check was initialised
		 */
		History.stateChanged = false;

		/**
		 * History.doubleChecker
		 * Contains the timeout used for the double checks
		 */
		History.doubleChecker = false;

		/**
		 * History.doubleCheckComplete()
		 * Complete a double check
		 * @return {History}
		 */
		History.doubleCheckComplete = function(){
			// Update
			History.stateChanged = true;

			// Clear
			History.doubleCheckClear();

			// Chain
			return History;
		};

		/**
		 * History.doubleCheckClear()
		 * Clear a double check
		 * @return {History}
		 */
		History.doubleCheckClear = function(){
			// Clear
			if ( History.doubleChecker ) {
				clearTimeout(History.doubleChecker);
				History.doubleChecker = false;
			}

			// Chain
			return History;
		};

		/**
		 * History.doubleCheck()
		 * Create a double check
		 * @return {History}
		 */
		History.doubleCheck = function(tryAgain){
			// Reset
			History.stateChanged = false;
			History.doubleCheckClear();

			// Fix IE6,IE7 bug where calling history.back or history.forward does not actually change the hash (whereas doing it manually does)
			// Fix Safari 5 bug where sometimes the state does not change: https://bugs.webkit.org/show_bug.cgi?id=42940
			if ( History.bugs.ieDoubleCheck ) {
				// Apply Check
				History.doubleChecker = setTimeout(
					function(){
						History.doubleCheckClear();
						if ( !History.stateChanged ) {
							//History.debug('History.doubleCheck: State has not yet changed, trying again', arguments);
							// Re-Attempt
							tryAgain();
						}
						return true;
					},
					History.options.doubleCheckInterval
				);
			}

			// Chain
			return History;
		};


		// ====================================================================
		// Safari Bug Fix

		/**
		 * History.safariStatePoll()
		 * Poll the current state
		 * @return {History}
		 */
		History.safariStatePoll = function(){
			// Poll the URL

			// Get the Last State which has the new URL
			var
				urlState = History.extractState(History.getLocationHref()),
				newState;

			// Check for a difference
			if ( !History.isLastSavedState(urlState) ) {
				newState = urlState;
			}
			else {
				return;
			}

			// Check if we have a state with that url
			// If not create it
			if ( !newState ) {
				//History.debug('History.safariStatePoll: new');
				newState = History.createStateObject();
			}

			// Apply the New State
			//History.debug('History.safariStatePoll: trigger');
			History.Adapter.trigger(window,'popstate');

			// Chain
			return History;
		};


		// ====================================================================
		// State Aliases

		/**
		 * History.back(queue)
		 * Send the browser history back one item
		 * @param {Integer} queue [optional]
		 */
		History.back = function(queue){
			//History.debug('History.back: called', arguments);

			// Handle Queueing
			if ( queue !== false && History.busy() ) {
				// Wait + Push to Queue
				//History.debug('History.back: we must wait', arguments);
				History.pushQueue({
					scope: History,
					callback: History.back,
					args: arguments,
					queue: queue
				});
				return false;
			}

			// Make Busy + Continue
			History.busy(true);

			// Fix certain browser bugs that prevent the state from changing
			History.doubleCheck(function(){
				History.back(false);
			});

			// Go back
			history.go(-1);

			// End back closure
			return true;
		};

		/**
		 * History.forward(queue)
		 * Send the browser history forward one item
		 * @param {Integer} queue [optional]
		 */
		History.forward = function(queue){
			//History.debug('History.forward: called', arguments);

			// Handle Queueing
			if ( queue !== false && History.busy() ) {
				// Wait + Push to Queue
				//History.debug('History.forward: we must wait', arguments);
				History.pushQueue({
					scope: History,
					callback: History.forward,
					args: arguments,
					queue: queue
				});
				return false;
			}

			// Make Busy + Continue
			History.busy(true);

			// Fix certain browser bugs that prevent the state from changing
			History.doubleCheck(function(){
				History.forward(false);
			});

			// Go forward
			history.go(1);

			// End forward closure
			return true;
		};

		/**
		 * History.go(index,queue)
		 * Send the browser history back or forward index times
		 * @param {Integer} queue [optional]
		 */
		History.go = function(index,queue){
			//History.debug('History.go: called', arguments);

			// Prepare
			var i;

			// Handle
			if ( index > 0 ) {
				// Forward
				for ( i=1; i<=index; ++i ) {
					History.forward(queue);
				}
			}
			else if ( index < 0 ) {
				// Backward
				for ( i=-1; i>=index; --i ) {
					History.back(queue);
				}
			}
			else {
				throw new Error('History.go: History.go requires a positive or negative integer passed.');
			}

			// Chain
			return History;
		};


		// ====================================================================
		// HTML5 State Support

		// Non-Native pushState Implementation
		if ( History.emulated.pushState ) {
			/*
			 * Provide Skeleton for HTML4 Browsers
			 */

			// Prepare
			var emptyFunction = function(){};
			History.pushState = History.pushState||emptyFunction;
			History.replaceState = History.replaceState||emptyFunction;
		} // History.emulated.pushState

		// Native pushState Implementation
		else {
			/*
			 * Use native HTML5 History API Implementation
			 */

			/**
			 * History.onPopState(event,extra)
			 * Refresh the Current State
			 */
			History.onPopState = function(event,extra){
				// Prepare
				var stateId = false, newState = false, currentHash, currentState;

				// Reset the double check
				History.doubleCheckComplete();

				// Check for a Hash, and handle apporiatly
				currentHash = History.getHash();
				if ( currentHash ) {
					// Expand Hash
					currentState = History.extractState(currentHash||History.getLocationHref(),true);
					if ( currentState ) {
						// We were able to parse it, it must be a State!
						// Let's forward to replaceState
						//History.debug('History.onPopState: state anchor', currentHash, currentState);
						History.replaceState(currentState.data, currentState.title, currentState.url, false);
					}
					else {
						// Traditional Anchor
						//History.debug('History.onPopState: traditional anchor', currentHash);
						History.Adapter.trigger(window,'anchorchange');
						History.busy(false);
					}

					// We don't care for hashes
					History.expectedStateId = false;
					return false;
				}

				// Ensure
				stateId = History.Adapter.extractEventData('state',event,extra) || false;

				// Fetch State
				if ( stateId ) {
					// Vanilla: Back/forward button was used
					newState = History.getStateById(stateId);
				}
				else if ( History.expectedStateId ) {
					// Vanilla: A new state was pushed, and popstate was called manually
					newState = History.getStateById(History.expectedStateId);
				}
				else {
					// Initial State
					newState = History.extractState(History.getLocationHref());
				}

				// The State did not exist in our store
				if ( !newState ) {
					// Regenerate the State
					newState = History.createStateObject(null,null,History.getLocationHref());
				}

				// Clean
				History.expectedStateId = false;

				// Check if we are the same state
				if ( History.isLastSavedState(newState) ) {
					// There has been no change (just the page's hash has finally propagated)
					//History.debug('History.onPopState: no change', newState, History.savedStates);
					History.busy(false);
					return false;
				}

				// Store the State
				History.storeState(newState);
				History.saveState(newState);

				// Force update of the title
				History.setTitle(newState);

				// Fire Our Event
				History.Adapter.trigger(window,'statechange');
				History.busy(false);

				// Return true
				return true;
			};
			History.Adapter.bind(window,'popstate',History.onPopState);

			/**
			 * History.pushState(data,title,url)
			 * Add a new State to the history object, become it, and trigger onpopstate
			 * We have to trigger for HTML4 compatibility
			 * @param {object} data
			 * @param {string} title
			 * @param {string} url
			 * @return {true}
			 */
			History.pushState = function(data,title,url,queue){
				//History.debug('History.pushState: called', arguments);

				// Check the State
				if ( History.getHashByUrl(url) && History.emulated.pushState ) {
					throw new Error('History.js does not support states with fragement-identifiers (hashes/anchors).');
				}

				// Handle Queueing
				if ( queue !== false && History.busy() ) {
					// Wait + Push to Queue
					//History.debug('History.pushState: we must wait', arguments);
					History.pushQueue({
						scope: History,
						callback: History.pushState,
						args: arguments,
						queue: queue
					});
					return false;
				}

				// Make Busy + Continue
				History.busy(true);

				// Create the newState
				var newState = History.createStateObject(data,title,url);

				// Check it
				if ( History.isLastSavedState(newState) ) {
					// Won't be a change
					History.busy(false);
				}
				else {
					// Store the newState
					History.storeState(newState);
					History.expectedStateId = newState.id;

					// Push the newState
					history.pushState(newState.id,newState.title,newState.url);

					// Fire HTML5 Event
					History.Adapter.trigger(window,'popstate');
				}

				// End pushState closure
				return true;
			};

			/**
			 * History.replaceState(data,title,url)
			 * Replace the State and trigger onpopstate
			 * We have to trigger for HTML4 compatibility
			 * @param {object} data
			 * @param {string} title
			 * @param {string} url
			 * @return {true}
			 */
			History.replaceState = function(data,title,url,queue){
				//History.debug('History.replaceState: called', arguments);

				// Check the State
				if ( History.getHashByUrl(url) && History.emulated.pushState ) {
					throw new Error('History.js does not support states with fragement-identifiers (hashes/anchors).');
				}

				// Handle Queueing
				if ( queue !== false && History.busy() ) {
					// Wait + Push to Queue
					//History.debug('History.replaceState: we must wait', arguments);
					History.pushQueue({
						scope: History,
						callback: History.replaceState,
						args: arguments,
						queue: queue
					});
					return false;
				}

				// Make Busy + Continue
				History.busy(true);

				// Create the newState
				var newState = History.createStateObject(data,title,url);

				// Check it
				if ( History.isLastSavedState(newState) ) {
					// Won't be a change
					History.busy(false);
				}
				else {
					// Store the newState
					History.storeState(newState);
					History.expectedStateId = newState.id;

					// Push the newState
					history.replaceState(newState.id,newState.title,newState.url);

					// Fire HTML5 Event
					History.Adapter.trigger(window,'popstate');
				}

				// End replaceState closure
				return true;
			};

		} // !History.emulated.pushState


		// ====================================================================
		// Initialise

		/**
		 * Load the Store
		 */
		if ( sessionStorage ) {
			// Fetch
			try {
				History.store = JSON.parse(sessionStorage.getItem('History.store'))||{};
			}
			catch ( err ) {
				History.store = {};
			}

			// Normalize
			History.normalizeStore();
		}
		else {
			// Default Load
			History.store = {};
			History.normalizeStore();
		}

		/**
		 * Clear Intervals on exit to prevent memory leaks
		 */
		History.Adapter.bind(window,"unload",History.clearAllIntervals);

		/**
		 * Create the initial State
		 */
		History.saveState(History.storeState(History.extractState(History.getLocationHref(),true)));

		/**
		 * Bind for Saving Store
		 */
		if ( sessionStorage ) {
			// When the page is closed
			History.onUnload = function(){
				// Prepare
				var	currentStore, item, currentStoreString;

				// Fetch
				try {
					currentStore = JSON.parse(sessionStorage.getItem('History.store'))||{};
				}
				catch ( err ) {
					currentStore = {};
				}

				// Ensure
				currentStore.idToState = currentStore.idToState || {};
				currentStore.urlToId = currentStore.urlToId || {};
				currentStore.stateToId = currentStore.stateToId || {};

				// Sync
				for ( item in History.idToState ) {
					if ( !History.idToState.hasOwnProperty(item) ) {
						continue;
					}
					currentStore.idToState[item] = History.idToState[item];
				}
				for ( item in History.urlToId ) {
					if ( !History.urlToId.hasOwnProperty(item) ) {
						continue;
					}
					currentStore.urlToId[item] = History.urlToId[item];
				}
				for ( item in History.stateToId ) {
					if ( !History.stateToId.hasOwnProperty(item) ) {
						continue;
					}
					currentStore.stateToId[item] = History.stateToId[item];
				}

				// Update
				History.store = currentStore;
				History.normalizeStore();

				// In Safari, going into Private Browsing mode causes the
				// Session Storage object to still exist but if you try and use
				// or set any property/function of it it throws the exception
				// "QUOTA_EXCEEDED_ERR: DOM Exception 22: An attempt was made to
				// add something to storage that exceeded the quota." infinitely
				// every second.
				currentStoreString = JSON.stringify(currentStore);
				try {
					// Store
					sessionStorage.setItem('History.store', currentStoreString);
				}
				catch (e) {
					if (e.code === DOMException.QUOTA_EXCEEDED_ERR) {
						if (sessionStorage.length) {
							// Workaround for a bug seen on iPads. Sometimes the quota exceeded error comes up and simply
							// removing/resetting the storage can work.
							sessionStorage.removeItem('History.store');
							sessionStorage.setItem('History.store', currentStoreString);
						} else {
							// Otherwise, we're probably private browsing in Safari, so we'll ignore the exception.
						}
					} else {
						throw e;
					}
				}
			};

			// For Internet Explorer
			History.intervalList.push(setInterval(History.onUnload,History.options.storeInterval));

			// For Other Browsers
			History.Adapter.bind(window,'beforeunload',History.onUnload);
			History.Adapter.bind(window,'unload',History.onUnload);

			// Both are enabled for consistency
		}

		// Non-Native pushState Implementation
		if ( !History.emulated.pushState ) {
			// Be aware, the following is only for native pushState implementations
			// If you are wanting to include something for all browsers
			// Then include it above this if block

			/**
			 * Setup Safari Fix
			 */
			if ( History.bugs.safariPoll ) {
				History.intervalList.push(setInterval(History.safariStatePoll, History.options.safariPollInterval));
			}

			/**
			 * Ensure Cross Browser Compatibility
			 */
			if ( navigator.vendor === 'Apple Computer, Inc.' || (navigator.appCodeName||'') === 'Mozilla' ) {
				/**
				 * Fix Safari HashChange Issue
				 */

				// Setup Alias
				History.Adapter.bind(window,'hashchange',function(){
					History.Adapter.trigger(window,'popstate');
				});

				// Initialise Alias
				if ( History.getHash() ) {
					History.Adapter.onDomLoad(function(){
						History.Adapter.trigger(window,'hashchange');
					});
				}
			}

		} // !History.emulated.pushState


	}; // History.initCore

	// Try to Initialise History
	if (!History.options || !History.options.delayInit) {
		History.init();
	}

})(window);

var q=null;window.PR_SHOULD_USE_CONTINUATION=!0;
(function(){function L(a){function m(a){var f=a.charCodeAt(0);if(f!==92)return f;var b=a.charAt(1);return(f=r[b])?f:"0"<=b&&b<="7"?parseInt(a.substring(1),8):b==="u"||b==="x"?parseInt(a.substring(2),16):a.charCodeAt(1)}function e(a){if(a<32)return(a<16?"\\x0":"\\x")+a.toString(16);a=String.fromCharCode(a);if(a==="\\"||a==="-"||a==="["||a==="]")a="\\"+a;return a}function h(a){for(var f=a.substring(1,a.length-1).match(/\\u[\dA-Fa-f]{4}|\\x[\dA-Fa-f]{2}|\\[0-3][0-7]{0,2}|\\[0-7]{1,2}|\\[\S\s]|[^\\]/g),a=
[],b=[],o=f[0]==="^",c=o?1:0,i=f.length;c<i;++c){var j=f[c];if(/\\[bdsw]/i.test(j))a.push(j);else{var j=m(j),d;c+2<i&&"-"===f[c+1]?(d=m(f[c+2]),c+=2):d=j;b.push([j,d]);d<65||j>122||(d<65||j>90||b.push([Math.max(65,j)|32,Math.min(d,90)|32]),d<97||j>122||b.push([Math.max(97,j)&-33,Math.min(d,122)&-33]))}}b.sort(function(a,f){return a[0]-f[0]||f[1]-a[1]});f=[];j=[NaN,NaN];for(c=0;c<b.length;++c)i=b[c],i[0]<=j[1]+1?j[1]=Math.max(j[1],i[1]):f.push(j=i);b=["["];o&&b.push("^");b.push.apply(b,a);for(c=0;c<
f.length;++c)i=f[c],b.push(e(i[0])),i[1]>i[0]&&(i[1]+1>i[0]&&b.push("-"),b.push(e(i[1])));b.push("]");return b.join("")}function y(a){for(var f=a.source.match(/\[(?:[^\\\]]|\\[\S\s])*]|\\u[\dA-Fa-f]{4}|\\x[\dA-Fa-f]{2}|\\\d+|\\[^\dux]|\(\?[!:=]|[()^]|[^()[\\^]+/g),b=f.length,d=[],c=0,i=0;c<b;++c){var j=f[c];j==="("?++i:"\\"===j.charAt(0)&&(j=+j.substring(1))&&j<=i&&(d[j]=-1)}for(c=1;c<d.length;++c)-1===d[c]&&(d[c]=++t);for(i=c=0;c<b;++c)j=f[c],j==="("?(++i,d[i]===void 0&&(f[c]="(?:")):"\\"===j.charAt(0)&&
(j=+j.substring(1))&&j<=i&&(f[c]="\\"+d[i]);for(i=c=0;c<b;++c)"^"===f[c]&&"^"!==f[c+1]&&(f[c]="");if(a.ignoreCase&&s)for(c=0;c<b;++c)j=f[c],a=j.charAt(0),j.length>=2&&a==="["?f[c]=h(j):a!=="\\"&&(f[c]=j.replace(/[A-Za-z]/g,function(a){a=a.charCodeAt(0);return"["+String.fromCharCode(a&-33,a|32)+"]"}));return f.join("")}for(var t=0,s=!1,l=!1,p=0,d=a.length;p<d;++p){var g=a[p];if(g.ignoreCase)l=!0;else if(/[a-z]/i.test(g.source.replace(/\\u[\da-f]{4}|\\x[\da-f]{2}|\\[^UXux]/gi,""))){s=!0;l=!1;break}}for(var r=
{b:8,t:9,n:10,v:11,f:12,r:13},n=[],p=0,d=a.length;p<d;++p){g=a[p];if(g.global||g.multiline)throw Error(""+g);n.push("(?:"+y(g)+")")}return RegExp(n.join("|"),l?"gi":"g")}function M(a){function m(a){switch(a.nodeType){case 1:if(e.test(a.className))break;for(var g=a.firstChild;g;g=g.nextSibling)m(g);g=a.nodeName;if("BR"===g||"LI"===g)h[s]="\n",t[s<<1]=y++,t[s++<<1|1]=a;break;case 3:case 4:g=a.nodeValue,g.length&&(g=p?g.replace(/\r\n?/g,"\n"):g.replace(/[\t\n\r ]+/g," "),h[s]=g,t[s<<1]=y,y+=g.length,
t[s++<<1|1]=a)}}var e=/(?:^|\s)nocode(?:\s|$)/,h=[],y=0,t=[],s=0,l;a.currentStyle?l=a.currentStyle.whiteSpace:window.getComputedStyle&&(l=document.defaultView.getComputedStyle(a,q).getPropertyValue("white-space"));var p=l&&"pre"===l.substring(0,3);m(a);return{a:h.join("").replace(/\n$/,""),c:t}}function B(a,m,e,h){m&&(a={a:m,d:a},e(a),h.push.apply(h,a.e))}function x(a,m){function e(a){for(var l=a.d,p=[l,"pln"],d=0,g=a.a.match(y)||[],r={},n=0,z=g.length;n<z;++n){var f=g[n],b=r[f],o=void 0,c;if(typeof b===
"string")c=!1;else{var i=h[f.charAt(0)];if(i)o=f.match(i[1]),b=i[0];else{for(c=0;c<t;++c)if(i=m[c],o=f.match(i[1])){b=i[0];break}o||(b="pln")}if((c=b.length>=5&&"lang-"===b.substring(0,5))&&!(o&&typeof o[1]==="string"))c=!1,b="src";c||(r[f]=b)}i=d;d+=f.length;if(c){c=o[1];var j=f.indexOf(c),k=j+c.length;o[2]&&(k=f.length-o[2].length,j=k-c.length);b=b.substring(5);B(l+i,f.substring(0,j),e,p);B(l+i+j,c,C(b,c),p);B(l+i+k,f.substring(k),e,p)}else p.push(l+i,b)}a.e=p}var h={},y;(function(){for(var e=a.concat(m),
l=[],p={},d=0,g=e.length;d<g;++d){var r=e[d],n=r[3];if(n)for(var k=n.length;--k>=0;)h[n.charAt(k)]=r;r=r[1];n=""+r;p.hasOwnProperty(n)||(l.push(r),p[n]=q)}l.push(/[\S\s]/);y=L(l)})();var t=m.length;return e}function u(a){var m=[],e=[];a.tripleQuotedStrings?m.push(["str",/^(?:'''(?:[^'\\]|\\[\S\s]|''?(?=[^']))*(?:'''|$)|"""(?:[^"\\]|\\[\S\s]|""?(?=[^"]))*(?:"""|$)|'(?:[^'\\]|\\[\S\s])*(?:'|$)|"(?:[^"\\]|\\[\S\s])*(?:"|$))/,q,"'\""]):a.multiLineStrings?m.push(["str",/^(?:'(?:[^'\\]|\\[\S\s])*(?:'|$)|"(?:[^"\\]|\\[\S\s])*(?:"|$)|`(?:[^\\`]|\\[\S\s])*(?:`|$))/,
q,"'\"`"]):m.push(["str",/^(?:'(?:[^\n\r'\\]|\\.)*(?:'|$)|"(?:[^\n\r"\\]|\\.)*(?:"|$))/,q,"\"'"]);a.verbatimStrings&&e.push(["str",/^@"(?:[^"]|"")*(?:"|$)/,q]);var h=a.hashComments;h&&(a.cStyleComments?(h>1?m.push(["com",/^#(?:##(?:[^#]|#(?!##))*(?:###|$)|.*)/,q,"#"]):m.push(["com",/^#(?:(?:define|elif|else|endif|error|ifdef|include|ifndef|line|pragma|undef|warning)\b|[^\n\r]*)/,q,"#"]),e.push(["str",/^<(?:(?:(?:\.\.\/)*|\/?)(?:[\w-]+(?:\/[\w-]+)+)?[\w-]+\.h|[a-z]\w*)>/,q])):m.push(["com",/^#[^\n\r]*/,
q,"#"]));a.cStyleComments&&(e.push(["com",/^\/\/[^\n\r]*/,q]),e.push(["com",/^\/\*[\S\s]*?(?:\*\/|$)/,q]));a.regexLiterals&&e.push(["lang-regex",/^(?:^^\.?|[!+-]|!=|!==|#|%|%=|&|&&|&&=|&=|\(|\*|\*=|\+=|,|-=|->|\/|\/=|:|::|;|<|<<|<<=|<=|=|==|===|>|>=|>>|>>=|>>>|>>>=|[?@[^]|\^=|\^\^|\^\^=|{|\||\|=|\|\||\|\|=|~|break|case|continue|delete|do|else|finally|instanceof|return|throw|try|typeof)\s*(\/(?=[^*/])(?:[^/[\\]|\\[\S\s]|\[(?:[^\\\]]|\\[\S\s])*(?:]|$))+\/)/]);(h=a.types)&&e.push(["typ",h]);a=(""+a.keywords).replace(/^ | $/g,
"");a.length&&e.push(["kwd",RegExp("^(?:"+a.replace(/[\s,]+/g,"|")+")\\b"),q]);m.push(["pln",/^\s+/,q," \r\n\t\xa0"]);e.push(["lit",/^@[$_a-z][\w$@]*/i,q],["typ",/^(?:[@_]?[A-Z]+[a-z][\w$@]*|\w+_t\b)/,q],["pln",/^[$_a-z][\w$@]*/i,q],["lit",/^(?:0x[\da-f]+|(?:\d(?:_\d+)*\d*(?:\.\d*)?|\.\d\+)(?:e[+-]?\d+)?)[a-z]*/i,q,"0123456789"],["pln",/^\\[\S\s]?/,q],["pun",/^.[^\s\w"-$'./@\\`]*/,q]);return x(m,e)}function D(a,m){function e(a){switch(a.nodeType){case 1:if(k.test(a.className))break;if("BR"===a.nodeName)h(a),
a.parentNode&&a.parentNode.removeChild(a);else for(a=a.firstChild;a;a=a.nextSibling)e(a);break;case 3:case 4:if(p){var b=a.nodeValue,d=b.match(t);if(d){var c=b.substring(0,d.index);a.nodeValue=c;(b=b.substring(d.index+d[0].length))&&a.parentNode.insertBefore(s.createTextNode(b),a.nextSibling);h(a);c||a.parentNode.removeChild(a)}}}}function h(a){function b(a,d){var e=d?a.cloneNode(!1):a,f=a.parentNode;if(f){var f=b(f,1),g=a.nextSibling;f.appendChild(e);for(var h=g;h;h=g)g=h.nextSibling,f.appendChild(h)}return e}
for(;!a.nextSibling;)if(a=a.parentNode,!a)return;for(var a=b(a.nextSibling,0),e;(e=a.parentNode)&&e.nodeType===1;)a=e;d.push(a)}var k=/(?:^|\s)nocode(?:\s|$)/,t=/\r\n?|\n/,s=a.ownerDocument,l;a.currentStyle?l=a.currentStyle.whiteSpace:window.getComputedStyle&&(l=s.defaultView.getComputedStyle(a,q).getPropertyValue("white-space"));var p=l&&"pre"===l.substring(0,3);for(l=s.createElement("LI");a.firstChild;)l.appendChild(a.firstChild);for(var d=[l],g=0;g<d.length;++g)e(d[g]);m===(m|0)&&d[0].setAttribute("value",
m);var r=s.createElement("OL");r.className="linenums";for(var n=Math.max(0,m-1|0)||0,g=0,z=d.length;g<z;++g)l=d[g],l.className="L"+(g+n)%10,l.firstChild||l.appendChild(s.createTextNode("\xa0")),r.appendChild(l);a.appendChild(r)}function k(a,m){for(var e=m.length;--e>=0;){var h=m[e];A.hasOwnProperty(h)?window.console&&console.warn("cannot override language handler %s",h):A[h]=a}}function C(a,m){if(!a||!A.hasOwnProperty(a))a=/^\s*</.test(m)?"default-markup":"default-code";return A[a]}function E(a){var m=
a.g;try{var e=M(a.h),h=e.a;a.a=h;a.c=e.c;a.d=0;C(m,h)(a);var k=/\bMSIE\b/.test(navigator.userAgent),m=/\n/g,t=a.a,s=t.length,e=0,l=a.c,p=l.length,h=0,d=a.e,g=d.length,a=0;d[g]=s;var r,n;for(n=r=0;n<g;)d[n]!==d[n+2]?(d[r++]=d[n++],d[r++]=d[n++]):n+=2;g=r;for(n=r=0;n<g;){for(var z=d[n],f=d[n+1],b=n+2;b+2<=g&&d[b+1]===f;)b+=2;d[r++]=z;d[r++]=f;n=b}for(d.length=r;h<p;){var o=l[h+2]||s,c=d[a+2]||s,b=Math.min(o,c),i=l[h+1],j;if(i.nodeType!==1&&(j=t.substring(e,b))){k&&(j=j.replace(m,"\r"));i.nodeValue=
j;var u=i.ownerDocument,v=u.createElement("SPAN");v.className=d[a+1];var x=i.parentNode;x.replaceChild(v,i);v.appendChild(i);e<o&&(l[h+1]=i=u.createTextNode(t.substring(b,o)),x.insertBefore(i,v.nextSibling))}e=b;e>=o&&(h+=2);e>=c&&(a+=2)}}catch(w){"console"in window&&console.log(w&&w.stack?w.stack:w)}}var v=["break,continue,do,else,for,if,return,while"],w=[[v,"auto,case,char,const,default,double,enum,extern,float,goto,int,long,register,short,signed,sizeof,static,struct,switch,typedef,union,unsigned,void,volatile"],
"catch,class,delete,false,import,new,operator,private,protected,public,this,throw,true,try,typeof"],F=[w,"alignof,align_union,asm,axiom,bool,concept,concept_map,const_cast,constexpr,decltype,dynamic_cast,explicit,export,friend,inline,late_check,mutable,namespace,nullptr,reinterpret_cast,static_assert,static_cast,template,typeid,typename,using,virtual,where"],G=[w,"abstract,boolean,byte,extends,final,finally,implements,import,instanceof,null,native,package,strictfp,super,synchronized,throws,transient"],
H=[G,"as,base,by,checked,decimal,delegate,descending,dynamic,event,fixed,foreach,from,group,implicit,in,interface,internal,into,is,lock,object,out,override,orderby,params,partial,readonly,ref,sbyte,sealed,stackalloc,string,select,uint,ulong,unchecked,unsafe,ushort,var"],w=[w,"debugger,eval,export,function,get,null,set,undefined,var,with,Infinity,NaN"],I=[v,"and,as,assert,class,def,del,elif,except,exec,finally,from,global,import,in,is,lambda,nonlocal,not,or,pass,print,raise,try,with,yield,False,True,None"],
J=[v,"alias,and,begin,case,class,def,defined,elsif,end,ensure,false,in,module,next,nil,not,or,redo,rescue,retry,self,super,then,true,undef,unless,until,when,yield,BEGIN,END"],v=[v,"case,done,elif,esac,eval,fi,function,in,local,set,then,until"],K=/^(DIR|FILE|vector|(de|priority_)?queue|list|stack|(const_)?iterator|(multi)?(set|map)|bitset|u?(int|float)\d*)/,N=/\S/,O=u({keywords:[F,H,w,"caller,delete,die,do,dump,elsif,eval,exit,foreach,for,goto,if,import,last,local,my,next,no,our,print,package,redo,require,sub,undef,unless,until,use,wantarray,while,BEGIN,END"+
I,J,v],hashComments:!0,cStyleComments:!0,multiLineStrings:!0,regexLiterals:!0}),A={};k(O,["default-code"]);k(x([],[["pln",/^[^<?]+/],["dec",/^<!\w[^>]*(?:>|$)/],["com",/^<\!--[\S\s]*?(?:--\>|$)/],["lang-",/^<\?([\S\s]+?)(?:\?>|$)/],["lang-",/^<%([\S\s]+?)(?:%>|$)/],["pun",/^(?:<[%?]|[%?]>)/],["lang-",/^<xmp\b[^>]*>([\S\s]+?)<\/xmp\b[^>]*>/i],["lang-js",/^<script\b[^>]*>([\S\s]*?)(<\/script\b[^>]*>)/i],["lang-css",/^<style\b[^>]*>([\S\s]*?)(<\/style\b[^>]*>)/i],["lang-in.tag",/^(<\/?[a-z][^<>]*>)/i]]),
["default-markup","htm","html","mxml","xhtml","xml","xsl"]);k(x([["pln",/^\s+/,q," \t\r\n"],["atv",/^(?:"[^"]*"?|'[^']*'?)/,q,"\"'"]],[["tag",/^^<\/?[a-z](?:[\w-.:]*\w)?|\/?>$/i],["atn",/^(?!style[\s=]|on)[a-z](?:[\w:-]*\w)?/i],["lang-uq.val",/^=\s*([^\s"'>]*(?:[^\s"'/>]|\/(?=\s)))/],["pun",/^[/<->]+/],["lang-js",/^on\w+\s*=\s*"([^"]+)"/i],["lang-js",/^on\w+\s*=\s*'([^']+)'/i],["lang-js",/^on\w+\s*=\s*([^\s"'>]+)/i],["lang-css",/^style\s*=\s*"([^"]+)"/i],["lang-css",/^style\s*=\s*'([^']+)'/i],["lang-css",
/^style\s*=\s*([^\s"'>]+)/i]]),["in.tag"]);k(x([],[["atv",/^[\S\s]+/]]),["uq.val"]);k(u({keywords:F,hashComments:!0,cStyleComments:!0,types:K}),["c","cc","cpp","cxx","cyc","m"]);k(u({keywords:"null,true,false"}),["json"]);k(u({keywords:H,hashComments:!0,cStyleComments:!0,verbatimStrings:!0,types:K}),["cs"]);k(u({keywords:G,cStyleComments:!0}),["java"]);k(u({keywords:v,hashComments:!0,multiLineStrings:!0}),["bsh","csh","sh"]);k(u({keywords:I,hashComments:!0,multiLineStrings:!0,tripleQuotedStrings:!0}),
["cv","py"]);k(u({keywords:"caller,delete,die,do,dump,elsif,eval,exit,foreach,for,goto,if,import,last,local,my,next,no,our,print,package,redo,require,sub,undef,unless,until,use,wantarray,while,BEGIN,END",hashComments:!0,multiLineStrings:!0,regexLiterals:!0}),["perl","pl","pm"]);k(u({keywords:J,hashComments:!0,multiLineStrings:!0,regexLiterals:!0}),["rb"]);k(u({keywords:w,cStyleComments:!0,regexLiterals:!0}),["js"]);k(u({keywords:"all,and,by,catch,class,else,extends,false,finally,for,if,in,is,isnt,loop,new,no,not,null,of,off,on,or,return,super,then,true,try,unless,until,when,while,yes",
hashComments:3,cStyleComments:!0,multilineStrings:!0,tripleQuotedStrings:!0,regexLiterals:!0}),["coffee"]);k(x([],[["str",/^[\S\s]+/]]),["regex"]);window.prettyPrintOne=function(a,m,e){var h=document.createElement("PRE");h.innerHTML=a;e&&D(h,e);E({g:m,i:e,h:h});return h.innerHTML};window.prettyPrint=function(a){function m(){for(var e=window.PR_SHOULD_USE_CONTINUATION?l.now()+250:Infinity;p<h.length&&l.now()<e;p++){var n=h[p],k=n.className;if(k.indexOf("prettyprint")>=0){var k=k.match(g),f,b;if(b=
!k){b=n;for(var o=void 0,c=b.firstChild;c;c=c.nextSibling)var i=c.nodeType,o=i===1?o?b:c:i===3?N.test(c.nodeValue)?b:o:o;b=(f=o===b?void 0:o)&&"CODE"===f.tagName}b&&(k=f.className.match(g));k&&(k=k[1]);b=!1;for(o=n.parentNode;o;o=o.parentNode)if((o.tagName==="pre"||o.tagName==="code"||o.tagName==="xmp")&&o.className&&o.className.indexOf("prettyprint")>=0){b=!0;break}b||((b=(b=n.className.match(/\blinenums\b(?::(\d+))?/))?b[1]&&b[1].length?+b[1]:!0:!1)&&D(n,b),d={g:k,h:n,i:b},E(d))}}p<h.length?setTimeout(m,
250):a&&a()}for(var e=[document.getElementsByTagName("pre"),document.getElementsByTagName("code"),document.getElementsByTagName("xmp")],h=[],k=0;k<e.length;++k)for(var t=0,s=e[k].length;t<s;++t)h.push(e[k][t]);var e=q,l=Date;l.now||(l={now:function(){return+new Date}});var p=0,d,g=/\blang(?:uage)?-([\w.]+)(?!\S)/;m()};window.PR={createSimpleLexer:x,registerLangHandler:k,sourceDecorator:u,PR_ATTRIB_NAME:"atn",PR_ATTRIB_VALUE:"atv",PR_COMMENT:"com",PR_DECLARATION:"dec",PR_KEYWORD:"kwd",PR_LITERAL:"lit",
PR_NOCODE:"nocode",PR_PLAIN:"pln",PR_PUNCTUATION:"pun",PR_SOURCE:"src",PR_STRING:"str",PR_TAG:"tag",PR_TYPE:"typ"}})();

var qq=qq||{};qq.extend=function(first,second){for(var prop in second)first[prop]=second[prop]};qq.indexOf=function(arr,elt,from){if(arr.indexOf)return arr.indexOf(elt,from);from=from||0;var len=arr.length;if(from<0)from+=len;for(;from<len;from++)if(from in arr&&arr[from]===elt)return from;return-1};qq.getUniqueId=(function(){var id=0;return function(){return id++}})();qq.ie=function(){return navigator.userAgent.indexOf('MSIE')!=-1};qq.safari=function(){return navigator.vendor!=undefined&&navigator.vendor.indexOf("Apple")!=-1};qq.chrome=function(){return navigator.vendor!=undefined&&navigator.vendor.indexOf('Google')!=-1};qq.firefox=function(){return(navigator.userAgent.indexOf('Mozilla')!=-1&&navigator.vendor!=undefined&&navigator.vendor=='')};qq.windows=function(){return navigator.platform=="Win32"};qq.attach=function(element,type,fn){if(element.addEventListener){element.addEventListener(type,fn,false)}else if(element.attachEvent)element.attachEvent('on'+type,fn);return function(){qq.detach(element,type,fn)}};qq.detach=function(element,type,fn){if(element.removeEventListener){element.removeEventListener(type,fn,false)}else if(element.attachEvent)element.detachEvent('on'+type,fn)};qq.preventDefault=function(e){if(e.preventDefault){e.preventDefault()}else e.returnValue=false};qq.insertBefore=function(a,b){b.parentNode.insertBefore(a,b)};qq.remove=function(element){element.parentNode.removeChild(element)};qq.contains=function(parent,descendant){if(parent==descendant)return true;if(parent.contains){return parent.contains(descendant)}else return!!(descendant.compareDocumentPosition(parent)&8)};qq.toElement=(function(){var div=document.createElement('div');return function(html){div.innerHTML=html;var element=div.firstChild;div.removeChild(element);return element}})();qq.css=function(element,styles){if(styles.opacity!=null)if(typeof element.style.opacity!='string'&&typeof(element.filters)!='undefined')styles.filter='alpha(opacity='+Math.round(100*styles.opacity)+')';qq.extend(element.style,styles)};qq.hasClass=function(element,name){var re=new RegExp('(^| )'+name+'( |$)');return re.test(element.className)};qq.addClass=function(element,name){if(!qq.hasClass(element,name))element.className+=' '+name};qq.removeClass=function(element,name){var re=new RegExp('(^| )'+name+'( |$)');element.className=element.className.replace(re,' ').replace(/^\s+|\s+$/g,"")};qq.setText=function(element,text){element.innerText=text;element.textContent=text};qq.children=function(element){var children=[],child=element.firstChild;while(child){if(child.nodeType==1)children.push(child);child=child.nextSibling};return children};qq.getByClass=function(element,className){if(element.querySelectorAll)return element.querySelectorAll('.'+className);var result=[],candidates=element.getElementsByTagName("*"),len=candidates.length;for(var i=0;i<len;i++)if(qq.hasClass(candidates[i],className))result.push(candidates[i]);return result};qq.obj2url=function(obj,temp,prefixDone){var uristrings=[],prefix='&',add=function(nextObj,i){var nextTemp=temp?(/\[\]$/.test(temp))?temp:temp+'['+i+']':i;if((nextTemp!='undefined')&&(i!='undefined'))uristrings.push((typeof nextObj==='object')?qq.obj2url(nextObj,nextTemp,true):(Object.prototype.toString.call(nextObj)==='[object Function]')?encodeURIComponent(nextTemp)+'='+encodeURIComponent(nextObj()):encodeURIComponent(nextTemp)+'='+encodeURIComponent(nextObj))};if(!prefixDone&&temp){prefix=(/\?/.test(temp))?(/\?$/.test(temp))?'':'&':'?';uristrings.push(temp);uristrings.push(qq.obj2url(obj))}else if((Object.prototype.toString.call(obj)==='[object Array]')&&(typeof obj!='undefined')){for(var i=0,len=obj.length;i<len;++i)add(obj[i],i)}else if((typeof obj!='undefined')&&(obj!==null)&&(typeof obj==="object")){for(var i in obj)add(obj[i],i)}else uristrings.push(encodeURIComponent(temp)+'='+encodeURIComponent(obj));return uristrings.join(prefix).replace(/^&/,'').replace(/%20/g,'+')};var qq=qq||{};qq.FileUploaderBasic=function(o){var that=this;this._options={debug:false,action:'/server/upload',params:{},customHeaders:{},button:null,multiple:true,maxConnections:3,disableCancelForFormUploads:false,autoUpload:true,allowedExtensions:[],acceptFiles:null,sizeLimit:0,minSizeLimit:0,onSubmit:function(id,fileName){},onComplete:function(id,fileName,responseJSON){},onCancel:function(id,fileName){},onUpload:function(id,fileName,xhr){},onProgress:function(id,fileName,loaded,total){if(loaded===total){var item=that._getItemByFileId(id),cancelLink=that._find(item,'cancel');cancelLink.style.display='none'}},onError:function(id,fileName,xhr){},messages:{typeError:"{file} has an invalid extension. Only {extensions} {isAre} allowed.",sizeError:"{file} is too large, maximum file size is {sizeLimit}.",minSizeError:"{file} is too small, minimum file size is {minSizeLimit}.",emptyError:"{file} is empty, please select files again without it.",noFilesError:"No files to upload.",onLeave:"The files are being uploaded, if you leave now the upload will be cancelled."},showMessage:function(message){alert(message)},inputName:'qqfile',extraDropzones:[]};qq.extend(this._options,o);qq.extend(this,qq.DisposeSupport);this._filesInProgress=0;this._storedFiles=[];this._handler=this._createUploadHandler();if(this._options.button)this._button=this._createUploadButton(this._options.button);this._preventLeaveInProgress()};qq.FileUploaderBasic.prototype={setParams:function(params){this._options.params=params},getInProgress:function(){return this._filesInProgress},uploadStoredFiles:function(){for(var i=0;i<this._storedFiles.length;i++){var item=this._getItemByFileId(this._storedFiles[i]);this._find(item,'spinner').style.display="";this._filesInProgress++;this._handler.upload(this._storedFiles[i],this._options.params)}},clearStoredFiles:function(){this._storedFiles=[];this._options.listElement.innerHTML=""},_createUploadButton:function(element){var self=this,button=new qq.UploadButton({element:element,multiple:this._options.multiple&&qq.UploadHandlerXhr.isSupported(),acceptFiles:this._options.acceptFiles,onChange:function(input){self._onInputChange(input)}});this.addDisposer(function(){button.dispose()});return button},_createUploadHandler:function(){var self=this,handlerClass;if(qq.UploadHandlerXhr.isSupported()){handlerClass='UploadHandlerXhr'}else handlerClass='UploadHandlerForm';var handler=new qq[handlerClass]({debug:this._options.debug,action:this._options.action,encoding:this._options.encoding,maxConnections:this._options.maxConnections,customHeaders:this._options.customHeaders,inputName:this._options.inputName,extraDropzones:this._options.extraDropzones,demoMode:this._options.demoMode,onProgress:function(id,fileName,loaded,total){self._onProgress(id,fileName,loaded,total);self._options.onProgress(id,fileName,loaded,total)},onComplete:function(id,fileName,result){self._onComplete(id,fileName,result);self._options.onComplete(id,fileName,result)},onCancel:function(id,fileName){self._onCancel(id,fileName);self._options.onCancel(id,fileName)},onError:self._options.onError,onUpload:function(id,fileName,xhr){self._onUpload(id,fileName,xhr);self._options.onUpload(id,fileName,xhr)}});return handler},_preventLeaveInProgress:function(){var self=this;this._attach(window,'beforeunload',function(e){if(!self._filesInProgress)return;var e=e||window.event;e.returnValue=self._options.messages.onLeave;return self._options.messages.onLeave})},_onSubmit:function(id,fileName){if(this._options.autoUpload)this._filesInProgress++},_onProgress:function(id,fileName,loaded,total){},_onComplete:function(id,fileName,result){this._filesInProgress--;if(result.error)this._options.showMessage(result.error)},_onCancel:function(id,fileName){if(this._options.autoUpload)this._filesInProgress--},_onUpload:function(id,fileName,xhr){},_onInputChange:function(input){if(this._handler instanceof qq.UploadHandlerXhr){this._uploadFileList(input.files)}else if(this._validateFile(input)){this._uploadFile(input);console.log(input)};this._button.reset()},_uploadFileList:function(files){if(files.length>0){for(var i=0;i<files.length;i++)if(!this._validateFile(files[i]))return;for(var i=0;i<files.length;i++)this._uploadFile(files[i])}else this._error('noFilesError',"")},_uploadFile:function(fileContainer){var id=this._handler.add(fileContainer),fileName=this._handler.getName(id);if(this._options.onSubmit(id,fileName)!==false){this._onSubmit(id,fileName);if(this._options.autoUpload){this._handler.upload(id,this._options.params)}else{var item=this._getItemByFileId(id);this._find(item,'spinner').style.display="none";this._storedFiles.push(id)}}},_validateFile:function(file){var name,size;if(file.value){name=file.value.replace(/.*(\/|\\)/,"")}else{name=(file.fileName!==null&&file.fileName!==undefined)?file.fileName:file.name;size=(file.fileSize!==null&&file.fileSize!==undefined)?file.fileSize:file.size};if(!this._isAllowedExtension(name)){this._error('typeError',name);return false}else if(size===0){this._error('emptyError',name);return false}else if(size&&this._options.sizeLimit&&size>this._options.sizeLimit){this._error('sizeError',name);return false}else if(size&&size<this._options.minSizeLimit){this._error('minSizeError',name);return false};return true},_error:function(code,fileName){var message=this._options.messages[code]
function r(name,replacement){message=message.replace(name,replacement)};var extensions=this._options.allowedExtensions.join(', ');r('{file}',this._formatFileName(fileName));r('{extensions}',extensions);r('{sizeLimit}',this._formatSize(this._options.sizeLimit));r('{minSizeLimit}',this._formatSize(this._options.minSizeLimit));r('{isAre}',extensions.indexOf(",")!=-1?"are":"is");this._options.showMessage(message)},_formatFileName:function(name){if(name.length>33)name=name.slice(0,19)+'...'+name.slice(-13);return name},_isAllowedExtension:function(fileName){var ext=(-1!==fileName.indexOf('.'))?fileName.replace(/.*[.]/,'').toLowerCase():'',allowed=this._options.allowedExtensions;if(!allowed.length)return true;for(var i=0;i<allowed.length;i++)if(allowed[i].toLowerCase()==ext)return true;return false},_formatSize:function(bytes){var i=-1;do{bytes=bytes/1024;i++}while(bytes>99);return Math.max(bytes,0.1).toFixed(1)+['kB','MB','GB','TB','PB','EB'][i]}};qq.FileUploader=function(o){qq.FileUploaderBasic.apply(this,arguments);qq.extend(this._options,{element:null,listElement:null,dragText:'Drop files here to upload',uploadButtonText:'Upload a file',cancelButtonText:'Cancel',failUploadText:'Upload failed',template:'<div class="qq-uploader"><div class="qq-upload-drop-area"><span>{dragText}</span></div><div class="qq-upload-button">{uploadButtonText}</div><ul class="qq-upload-list"></ul></div>',fileTemplate:'<li><span class="qq-progress-bar"></span><span class="qq-upload-spinner">+</span><span class="qq-upload-finished"></span><span class="qq-upload-file"></span><span class="qq-upload-size"></span><a class="qq-upload-cancel" href="#">{cancelButtonText}</a><span class="qq-upload-failed-text">{failUploadtext}</span></li>',classes:{button:'qq-upload-button',drop:'qq-upload-drop-area',dropActive:'qq-upload-drop-area-active',dropDisabled:'qq-upload-drop-area-disabled',list:'qq-upload-list',progressBar:'qq-progress-bar',file:'qq-upload-file',spinner:'qq-upload-spinner',finished:'qq-upload-finished',size:'qq-upload-size',cancel:'qq-upload-cancel',success:'qq-upload-success',fail:'qq-upload-fail',successIcon:null,failIcon:null}});qq.extend(this._options,o);this._options.template=this._options.template.replace(/\{dragText\}/g,this._options.dragText);this._options.template=this._options.template.replace(/\{uploadButtonText\}/g,this._options.uploadButtonText);this._options.fileTemplate=this._options.fileTemplate.replace(/\{cancelButtonText\}/g,this._options.cancelButtonText);this._options.fileTemplate=this._options.fileTemplate.replace(/\{failUploadtext\}/g,this._options.failUploadText);this._element=this._options.element;this._element.innerHTML=this._options.template;this._listElement=this._options.listElement||this._find(this._element,'list');this._classes=this._options.classes;this._button=this._createUploadButton(this._find(this._element,'button'));this._bindCancelEvent();this._setupDragDrop()};qq.extend(qq.FileUploader.prototype,qq.FileUploaderBasic.prototype);qq.extend(qq.FileUploader.prototype,{addExtraDropzone:function(element){this._setupExtraDropzone(element)},removeExtraDropzone:function(element){var dzs=this._options.extraDropzones;for(var i in dzs)if(dzs[i]===element)return this._options.extraDropzones.splice(i,1)},_leaving_document_out:function(e){return((qq.chrome()||(qq.safari()&&qq.windows()))&&e.clientX==0&&e.clientY==0)||(qq.firefox()&&!e.relatedTarget)},_find:function(parent,type){var element=qq.getByClass(parent,this._options.classes[type])[0];if(!element)throw new Error('element not found '+type);return element},_setupExtraDropzone:function(element){this._options.extraDropzones.push(element);this._setupDropzone(element)},_setupDropzone:function(dropArea){var self=this,dz=new qq.UploadDropZone({element:dropArea,onEnter:function(e){qq.addClass(dropArea,self._classes.dropActive);e.stopPropagation()},onLeave:function(e){},onLeaveNotDescendants:function(e){qq.removeClass(dropArea,self._classes.dropActive)},onDrop:function(e){dropArea.style.display='none';qq.removeClass(dropArea,self._classes.dropActive);self._uploadFileList(e.dataTransfer.files)}});this.addDisposer(function(){dz.dispose()});dropArea.style.display='none'},_setupDragDrop:function(){var dropArea=this._find(this._element,'drop'),self=this;this._options.extraDropzones.push(dropArea);var dropzones=this._options.extraDropzones,i;for(i=0;i<dropzones.length;i++)this._setupDropzone(dropzones[i]);if(!qq.ie())this._attach(document,'dragenter',function(e){if(qq.hasClass(dropArea,self._classes.dropDisabled))return;dropArea.style.display='block';for(i=0;i<dropzones.length;i++)dropzones[i].style.display='block'});this._attach(document,'dragleave',function(e){var relatedTarget=document.elementFromPoint(e.clientX,e.clientY);if(qq.FileUploader.prototype._leaving_document_out(e))for(i=0;i<dropzones.length;i++)dropzones[i].style.display='none'});qq.attach(document,'drop',function(e){for(i=0;i<dropzones.length;i++)dropzones[i].style.display='none';e.preventDefault()})},_onSubmit:function(id,fileName){qq.FileUploaderBasic.prototype._onSubmit.apply(this,arguments);this._addToList(id,fileName)},_onProgress:function(id,fileName,loaded,total){qq.FileUploaderBasic.prototype._onProgress.apply(this,arguments);var item=this._getItemByFileId(id),size=this._find(item,'size');size.style.display='inline';var text,percent=Math.round(loaded/total*100);if(loaded!=total){text=percent+'% from '+this._formatSize(total)}else text=this._formatSize(total);this._find(item,'progressBar').style.width=percent+'%';qq.setText(size,text)},_onComplete:function(id,fileName,result){qq.FileUploaderBasic.prototype._onComplete.apply(this,arguments);var item=this._getItemByFileId(id);if(!this._options.disableCancelForFormUploads||qq.UploadHandlerXhr.isSupported())qq.remove(this._find(item,'cancel'));qq.remove(this._find(item,'spinner'));if(result.success){qq.addClass(item,this._classes.success);if(this._classes.successIcon){this._find(item,'finished').style.display="inline-block";qq.addClass(item,this._classes.successIcon)}}else{var errorReason=result.reason?result.reason:"Unknown error";qq.addClass(item,this._classes.fail);if(this._classes.failIcon){this._find(item,'finished').style.display="inline-block";qq.addClass(item,this._classes.failIcon)};item.title=errorReason}},_addToList:function(id,fileName){var item=qq.toElement(this._options.fileTemplate);if(this._options.disableCancelForFormUploads&&!qq.UploadHandlerXhr.isSupported()){var cancelLink=this._find(item,'cancel');qq.remove(cancelLink)};item.qqFileId=id;var fileElement=this._find(item,'file');qq.setText(fileElement,this._formatFileName(fileName));this._find(item,'size').style.display='none';if(!this._options.multiple)this._clearList();this._listElement.appendChild(item)},_clearList:function(){this._listElement.innerHTML=''},_getItemByFileId:function(id){var item=this._listElement.firstChild;while(item){if(item.qqFileId==id)return item;item=item.nextSibling}},_bindCancelEvent:function(){var self=this,list=this._listElement;this._attach(list,'click',function(e){e=e||window.event;var target=e.target||e.srcElement;if(qq.hasClass(target,self._classes.cancel)){qq.preventDefault(e);var item=target.parentNode;self._handler.cancel(item.qqFileId);qq.remove(item)}})}});qq.UploadDropZone=function(o){this._options={element:null,onEnter:function(e){},onLeave:function(e){},onLeaveNotDescendants:function(e){},onDrop:function(e){}};qq.extend(this._options,o);qq.extend(this,qq.DisposeSupport);this._element=this._options.element;this._disableDropOutside();this._attachEvents()};qq.UploadDropZone.prototype={_dragover_should_be_canceled:function(){return qq.safari()||(qq.firefox()&&qq.windows())},_disableDropOutside:function(e){if(!qq.UploadDropZone.dropOutsideDisabled){if(this._dragover_should_be_canceled){qq.attach(document,'dragover',function(e){e.preventDefault()})}else qq.attach(document,'dragover',function(e){if(e.dataTransfer){e.dataTransfer.dropEffect='none';e.preventDefault()}});qq.UploadDropZone.dropOutsideDisabled=true}},_attachEvents:function(){var self=this;self._attach(self._element,'dragover',function(e){if(!self._isValidFileDrag(e))return;var effect=qq.ie()?null:e.dataTransfer.effectAllowed;if(effect=='move'||effect=='linkMove'){e.dataTransfer.dropEffect='move'}else e.dataTransfer.dropEffect='copy';e.stopPropagation();e.preventDefault()});self._attach(self._element,'dragenter',function(e){if(!self._isValidFileDrag(e))return;self._options.onEnter(e)});self._attach(self._element,'dragleave',function(e){if(!self._isValidFileDrag(e))return;self._options.onLeave(e);var relatedTarget=document.elementFromPoint(e.clientX,e.clientY);if(qq.contains(this,relatedTarget))return;self._options.onLeaveNotDescendants(e)});self._attach(self._element,'drop',function(e){if(!self._isValidFileDrag(e))return;e.preventDefault();self._options.onDrop(e)})},_isValidFileDrag:function(e){if(qq.ie())return false;var dt=e.dataTransfer,isSafari=qq.safari();return dt&&dt.effectAllowed!='none'&&(dt.files||(!isSafari&&dt.types.contains&&dt.types.contains('Files')))}};qq.UploadButton=function(o){this._options={element:null,multiple:false,acceptFiles:null,name:'file',onChange:function(input){},hoverClass:'qq-upload-button-hover',focusClass:'qq-upload-button-focus'};qq.extend(this._options,o);qq.extend(this,qq.DisposeSupport);this._element=this._options.element;qq.css(this._element,{position:'absolute',overflow:'hidden',direction:'ltr'});this._input=this._createInput()};qq.UploadButton.prototype={getInput:function(){return this._input},reset:function(){if(this._input.parentNode)qq.remove(this._input);qq.removeClass(this._element,this._options.focusClass);this._input=this._createInput()},_createInput:function(){var input=document.createElement("input");if(this._options.multiple)input.setAttribute("multiple","multiple");if(this._options.acceptFiles)input.setAttribute("accept",this._options.acceptFiles);input.setAttribute("type","file");input.setAttribute("name",this._options.name);input.setAttribute('id','fileUploaderButton');qq.css(input,{position:'absolute',right:0,top:0,fontFamily:'Arial',fontSize:'118px',margin:0,padding:0,cursor:'pointer',opacity:0});this._element.appendChild(input);var self=this;this._attach(input,'change',function(){self._options.onChange(input)});this._attach(input,'mouseover',function(){qq.addClass(self._element,self._options.hoverClass)});this._attach(input,'mouseout',function(){qq.removeClass(self._element,self._options.hoverClass)});this._attach(input,'focus',function(){qq.addClass(self._element,self._options.focusClass)});this._attach(input,'blur',function(){qq.removeClass(self._element,self._options.focusClass)});if(window.attachEvent)input.setAttribute('tabIndex',"-1");return input}};qq.UploadHandlerAbstract=function(o){this._options={debug:false,action:'/upload.php',maxConnections:999,onProgress:function(id,fileName,loaded,total){},onComplete:function(id,fileName,response){},onCancel:function(id,fileName){},onUpload:function(id,fileName,xhr){}};qq.extend(this._options,o);this._queue=[];this._params=[]};qq.UploadHandlerAbstract.prototype={log:function(str){if(this._options.debug&&window.console)console.log('[uploader] '+str)},add:function(file){},upload:function(id,params){var len=this._queue.push(id),copy={};qq.extend(copy,params);this._params[id]=copy;if(len<=this._options.maxConnections)this._upload(id,this._params[id])},cancel:function(id){this._cancel(id);this._dequeue(id)},cancelAll:function(){for(var i=0;i<this._queue.length;i++)this._cancel(this._queue[i]);this._queue=[]},getName:function(id){},getSize:function(id){},getQueue:function(){return this._queue},_upload:function(id){},_cancel:function(id){},_dequeue:function(id){var i=qq.indexOf(this._queue,id);this._queue.splice(i,1);var max=this._options.maxConnections;if(this._queue.length>=max&&i<max){var nextId=this._queue[max-1];this._upload(nextId,this._params[nextId])}}};qq.UploadHandlerForm=function(o){qq.UploadHandlerAbstract.apply(this,arguments);this._inputs={}};qq.extend(qq.UploadHandlerForm.prototype,qq.UploadHandlerAbstract.prototype);qq.extend(qq.UploadHandlerForm.prototype,{add:function(fileInput){fileInput.setAttribute('name',this._options.inputName);var id='qq-upload-handler-iframe'+qq.getUniqueId();this._inputs[id]=fileInput;if(fileInput.parentNode)qq.remove(fileInput);return id},getName:function(id){return this._inputs[id].value.replace(/.*(\/|\\)/,"")},_cancel:function(id){this._options.onCancel(id,this.getName(id));delete this._inputs[id];var iframe=document.getElementById(id);if(iframe){iframe.setAttribute('src','javascript:false;');qq.remove(iframe)}},_upload:function(id,params){this._options.onUpload(id,this.getName(id),false);var input=this._inputs[id];if(!input)throw new Error('file with passed id was not added, or already uploaded or cancelled');var fileName=this.getName(id),iframe=this._createIframe(id),form=this._createForm(iframe,params);form.appendChild(input);var self=this;this._attachLoadEvent(iframe,function(){self.log('iframe loaded');var response=self._getIframeContentJSON(iframe);self._options.onComplete(id,fileName,response);self._dequeue(id);delete self._inputs[id];setTimeout(function(){self._detach_event();qq.remove(iframe)},1)});form.submit();qq.remove(form);return id},_attachLoadEvent:function(iframe,callback){this._detach_event=qq.attach(iframe,'load',function(){if(!iframe.parentNode)return;try{if(iframe.contentDocument&&iframe.contentDocument.body&&iframe.contentDocument.body.innerHTML=="false")return}catch(error){};callback()})},_getIframeContentJSON:function(iframe){try{var doc=iframe.contentDocument?iframe.contentDocument:iframe.contentWindow.document,response,innerHTML=doc.body.innerHTML;this.log("converting iframe's innerHTML to JSON");this.log("innerHTML = "+innerHTML);if(innerHTML.slice(0,5).toLowerCase()=='<pre>'&&innerHTML.slice(-6).toLowerCase()=='</pre>')innerHTML=doc.body.firstChild.firstChild.nodeValue;response=eval("("+innerHTML+")")}catch(err){response={success:false}};return response},_createIframe:function(id){var iframe=qq.toElement('<iframe src="javascript:false;" name="'+id+'" />');iframe.setAttribute('id',id);iframe.style.display='none';document.body.appendChild(iframe);return iframe},_createForm:function(iframe,params){var protocol=this._options.demoMode?"GET":"POST",form=qq.toElement('<form method="'+protocol+'" enctype="multipart/form-data"></form>'),queryString=qq.obj2url(params,this._options.action);form.setAttribute('action',queryString);form.setAttribute('target',iframe.name);form.style.display='none';document.body.appendChild(form);return form}});qq.UploadHandlerXhr=function(o){qq.UploadHandlerAbstract.apply(this,arguments);this._files=[];this._xhrs=[];this._loaded=[]};qq.UploadHandlerXhr.isSupported=function(){var input=document.createElement('input');input.type='file';return('multiple'in input&&typeof File!="undefined"&&typeof FormData!="undefined"&&typeof(new XMLHttpRequest()).upload!="undefined")};qq.extend(qq.UploadHandlerXhr.prototype,qq.UploadHandlerAbstract.prototype);qq.extend(qq.UploadHandlerXhr.prototype,{add:function(file){if(!(file instanceof File))throw new Error('Passed obj in not a File (in qq.UploadHandlerXhr)');return this._files.push(file)-1},getName:function(id){var file=this._files[id];return(file.fileName!==null&&file.fileName!==undefined)?file.fileName:file.name},getSize:function(id){var file=this._files[id];return file.fileSize!=null?file.fileSize:file.size},getLoaded:function(id){return this._loaded[id]||0},_upload:function(id,params){this._options.onUpload(id,this.getName(id),true);var file=this._files[id],name=this.getName(id),size=this.getSize(id);this._loaded[id]=0;var xhr=this._xhrs[id]=new XMLHttpRequest(),self=this;xhr.upload.onprogress=function(e){if(e.lengthComputable){self._loaded[id]=e.loaded;self._options.onProgress(id,name,e.loaded,e.total)}};xhr.onreadystatechange=function(){if(xhr.readyState==4)self._onComplete(id,xhr)};params=params||{};params[this._options.inputName]=name;var queryString=qq.obj2url(params,this._options.action),protocol=this._options.demoMode?"GET":"POST";xhr.open(protocol,queryString,true);xhr.setRequestHeader("X-Requested-With","XMLHttpRequest");xhr.setRequestHeader("X-File-Name",encodeURIComponent(name));if(this._options.encoding=='multipart'){var formData=new FormData();formData.append(name,file);file=formData}else{xhr.setRequestHeader("Content-Type","application/octet-stream");xhr.setRequestHeader("X-Mime-Type",file.type)};for(key in this._options.customHeaders)xhr.setRequestHeader(key,this._options.customHeaders[key]);xhr.send(file)},_onComplete:function(id,xhr){if(!this._files[id])return;var name=this.getName(id),size=this.getSize(id);this._options.onProgress(id,name,size,size);if(xhr.status==200){this.log("xhr - server response received");this.log("responseText = "+xhr.responseText);var response;try{response=eval("("+xhr.responseText+")")}catch(err){response={}};this._options.onComplete(id,name,response)}else{this._options.onError(id,name,xhr);this._options.onComplete(id,name,{})};this._files[id]=null;this._xhrs[id]=null;this._dequeue(id)},_cancel:function(id){this._options.onCancel(id,this.getName(id));this._files[id]=null;if(this._xhrs[id]){this._xhrs[id].abort();this._xhrs[id]=null}}});qq.DisposeSupport={_disposers:[],dispose:function(){var disposer;while(disposer=this._disposers.shift())disposer()},addDisposer:function(disposeFunction){this._disposers.push(disposeFunction)},_attach:function(){this.addDisposer(qq.attach.apply(this,arguments))}};
/**
 * Timeago is a jQuery plugin that makes it easy to support automatically
 * updating fuzzy timestamps (e.g. "4 minutes ago" or "about 1 day ago").
 *
 * @name timeago
 * @version 1.3.0
 * @requires jQuery v1.2.3+
 * @author Ryan McGeary
 * @license MIT License - http://www.opensource.org/licenses/mit-license.php
 *
 * For usage and examples, visit:
 * http://timeago.yarp.com/
 *
 * Copyright (c) 2008-2013, Ryan McGeary (ryan -[at]- mcgeary [*dot*] org)
 */

(function (factory) {
  if (typeof define === 'function' && define.amd) {
    // AMD. Register as an anonymous module.
    define(['jquery'], factory);
  } else {
    // Browser globals
    factory(jQuery);
  }
}(function ($) {
  $.timeago = function(timestamp) {
    if (timestamp instanceof Date) {
      return inWords(timestamp);
    } else if (typeof timestamp === "string") {
      return inWords($.timeago.parse(timestamp));
    } else if (typeof timestamp === "number") {
      return inWords(new Date(timestamp));
    } else {
      return inWords($.timeago.datetime(timestamp));
    }
  };
  var $t = $.timeago;

  $.extend($.timeago, {
    settings: {
      refreshMillis: 60000,
      allowFuture: false,
      localeTitle: false,
      cutoff: 0,
      strings: {
        prefixAgo: null,
        prefixFromNow: null,
        suffixAgo: "ago",
        suffixFromNow: "from now",
        seconds: "less than a minute",
        minute: "about a minute",
        minutes: "%d minutes",
        hour: "about an hour",
        hours: "about %d hours",
        day: "a day",
        days: "%d days",
        month: "about a month",
        months: "%d months",
        year: "about a year",
        years: "%d years",
        wordSeparator: " ",
        numbers: []
      }
    },
    inWords: function(distanceMillis) {
      var $l = this.settings.strings;
      var prefix = $l.prefixAgo;
      var suffix = $l.suffixAgo;
      if (this.settings.allowFuture) {
        if (distanceMillis < 0) {
          prefix = $l.prefixFromNow;
          suffix = $l.suffixFromNow;
        }
      }

      var seconds = Math.abs(distanceMillis) / 1000;
      var minutes = seconds / 60;
      var hours = minutes / 60;
      var days = hours / 24;
      var years = days / 365;

      function substitute(stringOrFunction, number) {
        var string = $.isFunction(stringOrFunction) ? stringOrFunction(number, distanceMillis) : stringOrFunction;
        var value = ($l.numbers && $l.numbers[number]) || number;
        return string.replace(/%d/i, value);
      }

      var words = seconds < 45 && substitute($l.seconds, Math.round(seconds)) ||
        seconds < 90 && substitute($l.minute, 1) ||
        minutes < 45 && substitute($l.minutes, Math.round(minutes)) ||
        minutes < 90 && substitute($l.hour, 1) ||
        hours < 24 && substitute($l.hours, Math.round(hours)) ||
        hours < 42 && substitute($l.day, 1) ||
        days < 30 && substitute($l.days, Math.round(days)) ||
        days < 45 && substitute($l.month, 1) ||
        days < 365 && substitute($l.months, Math.round(days / 30)) ||
        years < 1.5 && substitute($l.year, 1) ||
        substitute($l.years, Math.round(years));

      var separator = $l.wordSeparator || "";
      if ($l.wordSeparator === undefined) { separator = " "; }
      return $.trim([prefix, words, suffix].join(separator));
    },
    parse: function(iso8601) {
      var s = $.trim(iso8601);
      s = s.replace(/\.\d+/,""); // remove milliseconds
      s = s.replace(/-/,"/").replace(/-/,"/");
      s = s.replace(/T/," ").replace(/Z/," UTC");
      s = s.replace(/([\+\-]\d\d)\:?(\d\d)/," $1$2"); // -04:00 -> -0400
      return new Date(s);
    },
    datetime: function(elem) {
      var iso8601 = $t.isTime(elem) ? $(elem).attr("datetime") : $(elem).attr("title");
      return $t.parse(iso8601);
    },
    isTime: function(elem) {
      // jQuery's `is()` doesn't play well with HTML5 in IE
      return $(elem).get(0).tagName.toLowerCase() === "time"; // $(elem).is("time");
    }
  });

  // functions that can be called via $(el).timeago('action')
  // init is default when no action is given
  // functions are called with context of a single element
  var functions = {
    init: function(){
      var refresh_el = $.proxy(refresh, this);
      refresh_el();
      var $s = $t.settings;
      if ($s.refreshMillis > 0) {
        setInterval(refresh_el, $s.refreshMillis);
      }
    },
    update: function(time){
      $(this).data('timeago', { datetime: $t.parse(time) });
      refresh.apply(this);
    },
    updateFromDOM: function(){
      $(this).data('timeago', { datetime: $t.parse( $t.isTime(this) ? $(this).attr("datetime") : $(this).attr("title") ) });
      refresh.apply(this);
    }
  };

  $.fn.timeago = function(action, options) {
    var fn = action ? functions[action] : functions.init;
    if(!fn){
      throw new Error("Unknown function name '"+ action +"' for timeago");
    }
    // each over objects here and call the requested function
    this.each(function(){
      fn.call(this, options);
    });
    return this;
  };

  function refresh() {
    var data = prepareData(this);
    var $s = $t.settings;

    if (!isNaN(data.datetime)) {
      if ( $s.cutoff == 0 || distance(data.datetime) < $s.cutoff) {
        $(this).text(inWords(data.datetime));
      }
    }
    return this;
  }

  function prepareData(element) {
    element = $(element);
    if (!element.data("timeago")) {
      element.data("timeago", { datetime: $t.datetime(element) });
      var text = $.trim(element.text());
      if ($t.settings.localeTitle) {
        element.attr("title", element.data('timeago').datetime.toLocaleString());
      } else if (text.length > 0 && !($t.isTime(element) && element.attr("title"))) {
        element.attr("title", text);
      }
    }
    return element.data("timeago");
  }

  function inWords(date) {
    return $t.inWords(distance(date));
  }

  function distance(date) {
    return (new Date().getTime() - date.getTime());
  }

  // fix for IE6 suckage
  document.createElement("abbr");
  document.createElement("time");
}));

/* ========================================================================
 * Bootstrap: tooltip.js v3.0.2
 * http://getbootstrap.com/javascript/#tooltip
 * Inspired by the original jQuery.tipsy by Jason Frame
 * ========================================================================
 * Copyright 2013 Twitter, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * ======================================================================== */


+function ($) { "use strict";

  // TOOLTIP PUBLIC CLASS DEFINITION
  // ===============================

  var Tooltip = function (element, options) {
    this.type       =
    this.options    =
    this.enabled    =
    this.timeout    =
    this.hoverState =
    this.$element   = null

    this.init('tooltip', element, options)
  }

  Tooltip.DEFAULTS = {
    animation: true
  , placement: 'top'
  , selector: false
  , template: '<div class="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>'
  , trigger: 'hover focus'
  , title: ''
  , delay: 0
  , html: false
  , container: false
  }

  Tooltip.prototype.init = function (type, element, options) {
    this.enabled  = true
    this.type     = type
    this.$element = $(element)
    this.options  = this.getOptions(options)

    var triggers = this.options.trigger.split(' ')

    for (var i = triggers.length; i--;) {
      var trigger = triggers[i]

      if (trigger == 'click') {
        this.$element.on('click.' + this.type, this.options.selector, $.proxy(this.toggle, this))
      } else if (trigger != 'manual') {
        var eventIn  = trigger == 'hover' ? 'mouseenter' : 'focus'
        var eventOut = trigger == 'hover' ? 'mouseleave' : 'blur'

        this.$element.on(eventIn  + '.' + this.type, this.options.selector, $.proxy(this.enter, this))
        this.$element.on(eventOut + '.' + this.type, this.options.selector, $.proxy(this.leave, this))
      }
    }

    this.options.selector ?
      (this._options = $.extend({}, this.options, { trigger: 'manual', selector: '' })) :
      this.fixTitle()
  }

  Tooltip.prototype.getDefaults = function () {
    return Tooltip.DEFAULTS
  }

  Tooltip.prototype.getOptions = function (options) {
    options = $.extend({}, this.getDefaults(), this.$element.data(), options)

    if (options.delay && typeof options.delay == 'number') {
      options.delay = {
        show: options.delay
      , hide: options.delay
      }
    }

    return options
  }

  Tooltip.prototype.getDelegateOptions = function () {
    var options  = {}
    var defaults = this.getDefaults()

    this._options && $.each(this._options, function (key, value) {
      if (defaults[key] != value) options[key] = value
    })

    return options
  }

  Tooltip.prototype.enter = function (obj) {
    var self = obj instanceof this.constructor ?
      obj : $(obj.currentTarget)[this.type](this.getDelegateOptions()).data('bs.' + this.type)

    clearTimeout(self.timeout)

    self.hoverState = 'in'

    if (!self.options.delay || !self.options.delay.show) return self.show()

    self.timeout = setTimeout(function () {
      if (self.hoverState == 'in') self.show()
    }, self.options.delay.show)
  }

  Tooltip.prototype.leave = function (obj) {
    var self = obj instanceof this.constructor ?
      obj : $(obj.currentTarget)[this.type](this.getDelegateOptions()).data('bs.' + this.type)

    clearTimeout(self.timeout)

    self.hoverState = 'out'

    if (!self.options.delay || !self.options.delay.hide) return self.hide()

    self.timeout = setTimeout(function () {
      if (self.hoverState == 'out') self.hide()
    }, self.options.delay.hide)
  }

  Tooltip.prototype.show = function () {
    var e = $.Event('show.bs.'+ this.type)

    if (this.hasContent() && this.enabled) {
      this.$element.trigger(e)

      if (e.isDefaultPrevented()) return

      var $tip = this.tip()

      this.setContent()

      if (this.options.animation) $tip.addClass('fade')

      var placement = typeof this.options.placement == 'function' ?
        this.options.placement.call(this, $tip[0], this.$element[0]) :
        this.options.placement

      var autoToken = /\s?auto?\s?/i
      var autoPlace = autoToken.test(placement)
      if (autoPlace) placement = placement.replace(autoToken, '') || 'top'

      $tip
        .detach()
        .css({ top: 0, left: 0, display: 'block' })
        .addClass(placement)

      this.options.container ? $tip.appendTo(this.options.container) : $tip.insertAfter(this.$element)

      var pos          = this.getPosition()
      var actualWidth  = $tip[0].offsetWidth
      var actualHeight = $tip[0].offsetHeight

      if (autoPlace) {
        var $parent = this.$element.parent()

        var orgPlacement = placement
        var docScroll    = document.documentElement.scrollTop || document.body.scrollTop
        var parentWidth  = this.options.container == 'body' ? window.innerWidth  : $parent.outerWidth()
        var parentHeight = this.options.container == 'body' ? window.innerHeight : $parent.outerHeight()
        var parentLeft   = this.options.container == 'body' ? 0 : $parent.offset().left

        placement = placement == 'bottom' && pos.top   + pos.height  + actualHeight - docScroll > parentHeight  ? 'top'    :
                    placement == 'top'    && pos.top   - docScroll   - actualHeight < 0                         ? 'bottom' :
                    placement == 'right'  && pos.right + actualWidth > parentWidth                              ? 'left'   :
                    placement == 'left'   && pos.left  - actualWidth < parentLeft                               ? 'right'  :
                    placement

        $tip
          .removeClass(orgPlacement)
          .addClass(placement)
      }

      var calculatedOffset = this.getCalculatedOffset(placement, pos, actualWidth, actualHeight)

      this.applyPlacement(calculatedOffset, placement)
      this.$element.trigger('shown.bs.' + this.type)
    }
  }

  Tooltip.prototype.applyPlacement = function(offset, placement) {
    var replace
    var $tip   = this.tip()
    var width  = $tip[0].offsetWidth
    var height = $tip[0].offsetHeight

    // manually read margins because getBoundingClientRect includes difference
    var marginTop = parseInt($tip.css('margin-top'), 10)
    var marginLeft = parseInt($tip.css('margin-left'), 10)

    // we must check for NaN for ie 8/9
    if (isNaN(marginTop))  marginTop  = 0
    if (isNaN(marginLeft)) marginLeft = 0

    offset.top  = offset.top  + marginTop
    offset.left = offset.left + marginLeft

    $tip
      .offset(offset)
      .addClass('in')

    // check to see if placing tip in new offset caused the tip to resize itself
    var actualWidth  = $tip[0].offsetWidth
    var actualHeight = $tip[0].offsetHeight

    if (placement == 'top' && actualHeight != height) {
      replace = true
      offset.top = offset.top + height - actualHeight
    }

    if (/bottom|top/.test(placement)) {
      var delta = 0

      if (offset.left < 0) {
        delta       = offset.left * -2
        offset.left = 0

        $tip.offset(offset)

        actualWidth  = $tip[0].offsetWidth
        actualHeight = $tip[0].offsetHeight
      }

      this.replaceArrow(delta - width + actualWidth, actualWidth, 'left')
    } else {
      this.replaceArrow(actualHeight - height, actualHeight, 'top')
    }

    if (replace) $tip.offset(offset)
  }

  Tooltip.prototype.replaceArrow = function(delta, dimension, position) {
    this.arrow().css(position, delta ? (50 * (1 - delta / dimension) + "%") : '')
  }

  Tooltip.prototype.setContent = function () {
    var $tip  = this.tip()
    var title = this.getTitle()

    $tip.find('.tooltip-inner')[this.options.html ? 'html' : 'text'](title)
    $tip.removeClass('fade in top bottom left right')
  }

  Tooltip.prototype.hide = function () {
    var that = this
    var $tip = this.tip()
    var e    = $.Event('hide.bs.' + this.type)

    function complete() {
      if (that.hoverState != 'in') $tip.detach()
    }

    this.$element.trigger(e)

    if (e.isDefaultPrevented()) return

    $tip.removeClass('in')

    $.support.transition && this.$tip.hasClass('fade') ?
      $tip
        .one($.support.transition.end, complete)
        .emulateTransitionEnd(150) :
      complete()

    this.$element.trigger('hidden.bs.' + this.type)

    return this
  }

  Tooltip.prototype.fixTitle = function () {
    var $e = this.$element
    if ($e.attr('title') || typeof($e.attr('data-original-title')) != 'string') {
      $e.attr('data-original-title', $e.attr('title') || '').attr('title', '')
    }
  }

  Tooltip.prototype.hasContent = function () {
    return this.getTitle()
  }

  Tooltip.prototype.getPosition = function () {
    var el = this.$element[0]
    return $.extend({}, (typeof el.getBoundingClientRect == 'function') ? el.getBoundingClientRect() : {
      width: el.offsetWidth
    , height: el.offsetHeight
    }, this.$element.offset())
  }

  Tooltip.prototype.getCalculatedOffset = function (placement, pos, actualWidth, actualHeight) {
    return placement == 'bottom' ? { top: pos.top + pos.height,   left: pos.left + pos.width / 2 - actualWidth / 2  } :
           placement == 'top'    ? { top: pos.top - actualHeight, left: pos.left + pos.width / 2 - actualWidth / 2  } :
           placement == 'left'   ? { top: pos.top + pos.height / 2 - actualHeight / 2, left: pos.left - actualWidth } :
        /* placement == 'right' */ { top: pos.top + pos.height / 2 - actualHeight / 2, left: pos.left + pos.width   }
  }

  Tooltip.prototype.getTitle = function () {
    var title
    var $e = this.$element
    var o  = this.options

    title = $e.attr('data-original-title')
      || (typeof o.title == 'function' ? o.title.call($e[0]) :  o.title)

    return title
  }

  Tooltip.prototype.tip = function () {
    return this.$tip = this.$tip || $(this.options.template)
  }

  Tooltip.prototype.arrow = function () {
    return this.$arrow = this.$arrow || this.tip().find('.tooltip-arrow')
  }

  Tooltip.prototype.validate = function () {
    if (!this.$element[0].parentNode) {
      this.hide()
      this.$element = null
      this.options  = null
    }
  }

  Tooltip.prototype.enable = function () {
    this.enabled = true
  }

  Tooltip.prototype.disable = function () {
    this.enabled = false
  }

  Tooltip.prototype.toggleEnabled = function () {
    this.enabled = !this.enabled
  }

  Tooltip.prototype.toggle = function (e) {
    var self = e ? $(e.currentTarget)[this.type](this.getDelegateOptions()).data('bs.' + this.type) : this
    self.tip().hasClass('in') ? self.leave(self) : self.enter(self)
  }

  Tooltip.prototype.destroy = function () {
    this.hide().$element.off('.' + this.type).removeData('bs.' + this.type)
  }


  // TOOLTIP PLUGIN DEFINITION
  // =========================

  var old = $.fn.tooltip

  $.fn.tooltip = function (option) {
    return this.each(function () {
      var $this   = $(this)
      var data    = $this.data('bs.tooltip')
      var options = typeof option == 'object' && option

      if (!data) $this.data('bs.tooltip', (data = new Tooltip(this, options)))
      if (typeof option == 'string') data[option]()
    })
  }

  $.fn.tooltip.Constructor = Tooltip


  // TOOLTIP NO CONFLICT
  // ===================

  $.fn.tooltip.noConflict = function () {
    $.fn.tooltip = old
    return this
  }

}(jQuery);

/* ========================================================================
 * Bootstrap: popover.js v3.0.2
 * http://getbootstrap.com/javascript/#popovers
 * ========================================================================
 * Copyright 2013 Twitter, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * ======================================================================== */


+function ($) { "use strict";

  // POPOVER PUBLIC CLASS DEFINITION
  // ===============================

  var Popover = function (element, options) {
    this.init('popover', element, options)
  }

  if (!$.fn.tooltip) throw new Error('Popover requires tooltip.js')

  Popover.DEFAULTS = $.extend({} , $.fn.tooltip.Constructor.DEFAULTS, {
    placement: 'right'
  , trigger: 'click'
  , content: ''
  , template: '<div class="popover"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'
  })


  // NOTE: POPOVER EXTENDS tooltip.js
  // ================================

  Popover.prototype = $.extend({}, $.fn.tooltip.Constructor.prototype)

  Popover.prototype.constructor = Popover

  Popover.prototype.getDefaults = function () {
    return Popover.DEFAULTS
  }

  Popover.prototype.setContent = function () {
    var $tip    = this.tip()
    var title   = this.getTitle()
    var content = this.getContent()

    $tip.find('.popover-title')[this.options.html ? 'html' : 'text'](title)
    $tip.find('.popover-content')[this.options.html ? 'html' : 'text'](content)

    $tip.removeClass('fade top bottom left right in')

    // IE8 doesn't accept hiding via the `:empty` pseudo selector, we have to do
    // this manually by checking the contents.
    if (!$tip.find('.popover-title').html()) $tip.find('.popover-title').hide()
  }

  Popover.prototype.hasContent = function () {
    return this.getTitle() || this.getContent()
  }

  Popover.prototype.getContent = function () {
    var $e = this.$element
    var o  = this.options

    return $e.attr('data-content')
      || (typeof o.content == 'function' ?
            o.content.call($e[0]) :
            o.content)
  }

  Popover.prototype.arrow = function () {
    return this.$arrow = this.$arrow || this.tip().find('.arrow')
  }

  Popover.prototype.tip = function () {
    if (!this.$tip) this.$tip = $(this.options.template)
    return this.$tip
  }


  // POPOVER PLUGIN DEFINITION
  // =========================

  var old = $.fn.popover

  $.fn.popover = function (option) {
    return this.each(function () {
      var $this   = $(this)
      var data    = $this.data('bs.popover')
      var options = typeof option == 'object' && option

      if (!data) $this.data('bs.popover', (data = new Popover(this, options)))
      if (typeof option == 'string') data[option]()
    })
  }

  $.fn.popover.Constructor = Popover


  // POPOVER NO CONFLICT
  // ===================

  $.fn.popover.noConflict = function () {
    $.fn.popover = old
    return this
  }

}(jQuery);

(function(){
    

var rsplit = function(string, regex) {
	var result = regex.exec(string),retArr = new Array(), first_idx, last_idx, first_bit;
	while (result != null)
	{
		first_idx = result.index; last_idx = regex.lastIndex;
		if ((first_idx) != 0)
		{
			first_bit = string.substring(0,first_idx);
			retArr.push(string.substring(0,first_idx));
			string = string.slice(first_idx);
		}		
		retArr.push(result[0]);
		string = string.slice(result[0].length);
		result = regex.exec(string);	
	}
	if (! string == '')
	{
		retArr.push(string);
	}
	return retArr;
},
chop =  function(string){
    return string.substr(0, string.length - 1);
},
extend = function(d, s){
    for(var n in s){
        if(s.hasOwnProperty(n))  d[n] = s[n]
    }
}


EJS = function( options ){
	options = typeof options == "string" ? {view: options} : options
    this.set_options(options);
	if(options.precompiled){
		this.template = {};
		this.template.process = options.precompiled;
		EJS.update(this.name, this);
		return;
	}
    if(options.element)
	{
		if(typeof options.element == 'string'){
			var name = options.element
			options.element = document.getElementById(  options.element )
			if(options.element == null) throw name+'does not exist!'
		}
		if(options.element.value){
			this.text = options.element.value
		}else{
			this.text = options.element.innerHTML
		}
		this.name = options.element.id
		this.type = '['
	}else if(options.url){
        options.url = EJS.endExt(options.url, this.extMatch);
		this.name = this.name ? this.name : options.url;
        var url = options.url
        //options.view = options.absolute_url || options.view || options.;
		var template = EJS.get(this.name /*url*/, this.cache);
		if (template) return template;
	    if (template == EJS.INVALID_PATH) return null;
        try{
            this.text = EJS.request( url+(this.cache ? '' : '?'+Math.random() ));
        }catch(e){}

		if(this.text == null){
            throw( {type: 'EJS', message: 'There is no template at '+url}  );
		}
		//this.name = url;
	}
	var template = new EJS.Compiler(this.text, this.type);

	template.compile(options, this.name);

	
	EJS.update(this.name, this);
	this.template = template;
};
/* @Prototype*/
EJS.prototype = {
	/**
	 * Renders an object with extra view helpers attached to the view.
	 * @param {Object} object data to be rendered
	 * @param {Object} extra_helpers an object with additonal view helpers
	 * @return {String} returns the result of the string
	 */
    render : function(object, extra_helpers){
        object = object || {};
        this._extra_helpers = extra_helpers;
		var v = new EJS.Helpers(object, extra_helpers || {});
		return this.template.process.call(object, object,v);
	},
    update : function(element, options){
        if(typeof element == 'string'){
			element = document.getElementById(element)
		}
		if(options == null){
			_template = this;
			return function(object){
				EJS.prototype.update.call(_template, element, object)
			}
		}
		if(typeof options == 'string'){
			params = {}
			params.url = options
			_template = this;
			params.onComplete = function(request){
				var object = eval( request.responseText )
				EJS.prototype.update.call(_template, element, object)
			}
			EJS.ajax_request(params)
		}else
		{
			element.innerHTML = this.render(options)
		}
    },
	out : function(){
		return this.template.out;
	},
    /**
     * Sets options on this view to be rendered with.
     * @param {Object} options
     */
	set_options : function(options){
        this.type = options.type || EJS.type;
		this.cache = options.cache != null ? options.cache : EJS.cache;
		this.text = options.text || null;
		this.name =  options.name || null;
		this.ext = options.ext || EJS.ext;
		this.extMatch = new RegExp(this.ext.replace(/\./, '\.'));
	}
};
EJS.endExt = function(path, match){
	if(!path) return null;
	match.lastIndex = 0
	return path+ (match.test(path) ? '' : this.ext )
}




/* @Static*/
EJS.Scanner = function(source, left, right) {
	
    extend(this,
        {left_delimiter: 	left +'%',
         right_delimiter: 	'%'+right,
         double_left: 		left+'%%',
         double_right:  	'%%'+right,
         left_equal: 		left+'%=',
         left_comment: 	left+'%#'})

	this.SplitRegexp = left=='[' ? /(\[%%)|(%%\])|(\[%=)|(\[%#)|(\[%)|(%\]\n)|(%\])|(\n)/ : new RegExp('('+this.double_left+')|(%%'+this.double_right+')|('+this.left_equal+')|('+this.left_comment+')|('+this.left_delimiter+')|('+this.right_delimiter+'\n)|('+this.right_delimiter+')|(\n)') ;
	
	this.source = source;
	this.stag = null;
	this.lines = 0;
};

EJS.Scanner.to_text = function(input){
	if(input == null || input === undefined)
        return '';
    if(input instanceof Date)
		return input.toDateString();
	if(input.toString) 
        return input.toString();
	return '';
};

EJS.Scanner.prototype = {
  scan: function(block) {
     scanline = this.scanline;
	 regex = this.SplitRegexp;
	 if (! this.source == '')
	 {
	 	 var source_split = rsplit(this.source, /\n/);
	 	 for(var i=0; i<source_split.length; i++) {
		 	 var item = source_split[i];
			 this.scanline(item, regex, block);
		 }
	 }
  },
  scanline: function(line, regex, block) {
	 this.lines++;
	 var line_split = rsplit(line, regex);
 	 for(var i=0; i<line_split.length; i++) {
	   var token = line_split[i];
       if (token != null) {
		   	try{
	         	block(token, this);
		 	}catch(e){
				throw {type: 'EJS.Scanner', line: this.lines};
			}
       }
	 }
  }
};


EJS.Buffer = function(pre_cmd, post_cmd) {
	this.line = new Array();
	this.script = "";
	this.pre_cmd = pre_cmd;
	this.post_cmd = post_cmd;
	for (var i=0; i<this.pre_cmd.length; i++)
	{
		this.push(pre_cmd[i]);
	}
};
EJS.Buffer.prototype = {
	
  push: function(cmd) {
	this.line.push(cmd);
  },

  cr: function() {
	this.script = this.script + this.line.join('; ');
	this.line = new Array();
	this.script = this.script + "\n";
  },

  close: function() {
	if (this.line.length > 0)
	{
		for (var i=0; i<this.post_cmd.length; i++){
			this.push(pre_cmd[i]);
		}
		this.script = this.script + this.line.join('; ');
		line = null;
	}
  }
 	
};


EJS.Compiler = function(source, left) {
    this.pre_cmd = ['var ___ViewO = [];'];
	this.post_cmd = new Array();
	this.source = ' ';	
	if (source != null)
	{
		if (typeof source == 'string')
		{
		    source = source.replace(/\r\n/g, "\n");
            source = source.replace(/\r/g,   "\n");
			this.source = source;
		}else if (source.innerHTML){
			this.source = source.innerHTML;
		} 
		if (typeof this.source != 'string'){
			this.source = "";
		}
	}
	left = left || '<';
	var right = '>';
	switch(left) {
		case '[':
			right = ']';
			break;
		case '<':
			break;
		default:
			throw left+' is not a supported deliminator';
			break;
	}
	this.scanner = new EJS.Scanner(this.source, left, right);
	this.out = '';
};
EJS.Compiler.prototype = {
  compile: function(options, name) {
  	options = options || {};
	this.out = '';
	var put_cmd = "___ViewO.push(";
	var insert_cmd = put_cmd;
	var buff = new EJS.Buffer(this.pre_cmd, this.post_cmd);		
	var content = '';
	var clean = function(content)
	{
	    content = content.replace(/\\/g, '\\\\');
        content = content.replace(/\n/g, '\\n');
        content = content.replace(/"/g,  '\\"');
        return content;
	};
	this.scanner.scan(function(token, scanner) {
		if (scanner.stag == null)
		{
			switch(token) {
				case '\n':
					content = content + "\n";
					buff.push(put_cmd + '"' + clean(content) + '");');
					buff.cr();
					content = '';
					break;
				case scanner.left_delimiter:
				case scanner.left_equal:
				case scanner.left_comment:
					scanner.stag = token;
					if (content.length > 0)
					{
						buff.push(put_cmd + '"' + clean(content) + '")');
					}
					content = '';
					break;
				case scanner.double_left:
					content = content + scanner.left_delimiter;
					break;
				default:
					content = content + token;
					break;
			}
		}
		else {
			switch(token) {
				case scanner.right_delimiter:
					switch(scanner.stag) {
						case scanner.left_delimiter:
							if (content[content.length - 1] == '\n')
							{
								content = chop(content);
								buff.push(content);
								buff.cr();
							}
							else {
								buff.push(content);
							}
							break;
						case scanner.left_equal:
							buff.push(insert_cmd + "(EJS.Scanner.to_text(" + content + ")))");
							break;
					}
					scanner.stag = null;
					content = '';
					break;
				case scanner.double_right:
					content = content + scanner.right_delimiter;
					break;
				default:
					content = content + token;
					break;
			}
		}
	});
	if (content.length > 0)
	{
		// Chould be content.dump in Ruby
		buff.push(put_cmd + '"' + clean(content) + '")');
	}
	buff.close();
	this.out = buff.script + ";";
	var to_be_evaled = '/*'+name+'*/this.process = function(_CONTEXT,_VIEW) { try { with(_VIEW) { with (_CONTEXT) {'+this.out+" return ___ViewO.join('');}}}catch(e){e.lineNumber=null;throw e;}};";
	
	try{
		eval(to_be_evaled);
	}catch(e){
		if(typeof JSLINT != 'undefined'){
			JSLINT(this.out);
			for(var i = 0; i < JSLINT.errors.length; i++){
				var error = JSLINT.errors[i];
				if(error.reason != "Unnecessary semicolon."){
					error.line++;
					var e = new Error();
					e.lineNumber = error.line;
					e.message = error.reason;
					if(options.view)
						e.fileName = options.view;
					throw e;
				}
			}
		}else{
			throw e;
		}
	}
  }
};


//type, cache, folder
/**
 * Sets default options for all views
 * @param {Object} options Set view with the following options
 * <table class="options">
				<tbody><tr><th>Option</th><th>Default</th><th>Description</th></tr>
				<tr>
					<td>type</td>
					<td>'<'</td>
					<td>type of magic tags.  Options are '&lt;' or '['
					</td>
				</tr>
				<tr>
					<td>cache</td>
					<td>true in production mode, false in other modes</td>
					<td>true to cache template.
					</td>
				</tr>
	</tbody></table>
 * 
 */
EJS.config = function(options){
	EJS.cache = options.cache != null ? options.cache : EJS.cache;
	EJS.type = options.type != null ? options.type : EJS.type;
	EJS.ext = options.ext != null ? options.ext : EJS.ext;
	
	var templates_directory = EJS.templates_directory || {}; //nice and private container
	EJS.templates_directory = templates_directory;
	EJS.get = function(path, cache){
		if(cache == false) return null;
		if(templates_directory[path]) return templates_directory[path];
  		return null;
	};
	
	EJS.update = function(path, template) { 
		if(path == null) return;
		templates_directory[path] = template ;
	};
	
	EJS.INVALID_PATH =  -1;
};
EJS.config( {cache: true, type: '<', ext: '.ejs' } );



/**
 * @constructor
 * By adding functions to EJS.Helpers.prototype, those functions will be available in the 
 * views.
 * @init Creates a view helper.  This function is called internally.  You should never call it.
 * @param {Object} data The data passed to the view.  Helpers have access to it through this._data
 */
EJS.Helpers = function(data, extras){
	this._data = data;
    this._extras = extras;
    extend(this, extras );
};
/* @prototype*/
EJS.Helpers.prototype = {
    /**
     * Renders a new view.  If data is passed in, uses that to render the view.
     * @param {Object} options standard options passed to a new view.
     * @param {optional:Object} data
     * @return {String}
     */
	view: function(options, data, helpers){
        if(!helpers) helpers = this._extras
		if(!data) data = this._data;
		return new EJS(options).render(data, helpers);
	},
    /**
     * For a given value, tries to create a human representation.
     * @param {Object} input the value being converted.
     * @param {Object} null_text what text should be present if input == null or undefined, defaults to ''
     * @return {String} 
     */
	to_text: function(input, null_text) {
	    if(input == null || input === undefined) return null_text || '';
	    if(input instanceof Date) return input.toDateString();
		if(input.toString) return input.toString().replace(/\n/g, '<br />').replace(/''/g, "'");
		return '';
	}
};
    EJS.newRequest = function(){
	   var factories = [function() { return new ActiveXObject("Msxml2.XMLHTTP"); },function() { return new XMLHttpRequest(); },function() { return new ActiveXObject("Microsoft.XMLHTTP"); }];
	   for(var i = 0; i < factories.length; i++) {
	        try {
	            var request = factories[i]();
	            if (request != null)  return request;
	        }
	        catch(e) { continue;}
	   }
	}
	
	EJS.request = function(path){
	   var request = new EJS.newRequest()
	   request.open("GET", path, false);
	   
	   try{request.send(null);}
	   catch(e){return null;}
	   
	   if ( request.status == 404 || request.status == 2 ||(request.status == 0 && request.responseText == '') ) return null;
	   
	   return request.responseText
	}
	EJS.ajax_request = function(params){
		params.method = ( params.method ? params.method : 'GET')
		
		var request = new EJS.newRequest();
		request.onreadystatechange = function(){
			if(request.readyState == 4){
				if(request.status == 200){
					params.onComplete(request)
				}else
				{
					params.onComplete(request)
				}
			}
		}
		request.open(params.method, params.url)
		request.send(null)
	}


})();
/**
* Gillie 0.3
* Micro Framework
*
* MIT Licensed.
* (c) 2013, Pablo Vallejo - https://PabloVallejo.github.io/gillie
*
* Based on Simple JavaScript Inheritance by John Resig, Backbone, jQuery and Underscore.
*/
( function( $, window ) {

    var

        // Gillie version
        version = '0.3'

    ,   initializing = false
    ,   fnTest = /xyz/.test( function(){ xyz; }) ? /\b_super\b/ : /.*/

        // Base class implementation
    ,   Gillie = function() { }

        // Extend a given object with all the properties in passed-in object(s)
        // Adapted from underscore `extend`
        // https://github.com/jashkenas/underscore/blob/master/underscore.js#L786
    ,   _extend = function( obj ) {

            $.each( [].slice.call( arguments, 1 ), function( key, source ) {

                if ( source ) {
                    for ( var prop in source ) {
                        obj[ prop ] = source[ prop ];
                    }
                }
            });

            return obj;
        };


    // Gillie.Events,
    // Events API which can be used for triggering `trigger` and
    // listening `on` to events.
    // Adapted from `Backbone.Events`
    // https://github.com/jashkenas/backbone/blob/master/backbone.js#L69
    var Events = Gillie.Events = {

            // Bind to events.
            on: function( name, callback, context ) {

                if ( ! eventsApi( this, 'on', name, [ callback, context ] ) || ! callback ) return this;
                this._events || ( this._events = {} );

                var events = this._events[ name ] || ( this._events[ name ] = [] );
                events.push({ callback: callback, context: context, ctx: context || this });
                return this;
            }

            // Trigger the callbacks for the event or events that have been bound.
        ,   trigger: function( name ) {

                if ( ! this._events ) return this;
                var args = [].slice.call( arguments, 1 );
                if ( ! eventsApi( this, 'trigger', name, args ) ) return this;

                var events = this._events[ name ];
                if ( events ) triggerEvents( events, args );
                return this;
            }

    };

    // Regex to split words.
    var  eventSplitter = /\s+/

        // API for events.
    ,   eventsApi = function( obj, action, name, rest ) {

            if ( ! name ) return;

            // Handle event maps.
            //
            //   { evt1: handle, evt2: handle2 }
            //
            if ( typeof name === 'object' ) {
                for ( var key in name ) {
                    obj[ action ].apply( obj, [ key, name[key] ].concat( rest ) );
                }
                return false;
            }


            // Handle space separated event names 'event1 event2 ...'.
            if ( eventSplitter.test( name ) ) {
                var names = name.split( eventSplitter );

                for ( var i = 0, l = names.length; i < l; i++ ) {
                    obj[ action ].apply( obj, [ names[i] ].concat( rest ) );
                }
                return false;
            }

            return true;
        }

        // Trigger events
    ,   triggerEvents = function( events, args ) {

            var ev, i = -1, l = events.length, a1 = args[ 0 ], a2 = args[ 1 ], a3 = args[ 2 ];

            switch( args.length ) {

                case 0: while( ++i < l ) ( ev = events[ i ] ).callback.call( ev.ctx ); return;
                case 1: while( ++i < l ) ( ev = events[ i ] ).callback.call( ev.ctx, a1 ); return;
                case 2: while( ++i < l ) ( ev = events[ i ] ).callback.call( ev.ctx, a1, a2 ); return;
                case 3: while( ++i < l ) ( ev = events[ i ] ).callback.call( ev.ctx, a1, a2, a3 ); return;
                default: while( ++i < l ) ( ev = events[ i ] ).callback.apply( ev.ctx, args );
            }

        };

    var listenMethods = { on: 'listenTo' };

    // Inversion-of-control versions of `on` and `once`. Tell *this* object to
    // listen to an event in another object ... keeping track of what it's
    // listening to.
    $.each( listenMethods, function( implementation, method ) {

        Events[ method ] = function( obj, name, callback ) {

            var listeners = this._listeners || ( this._listeners = {} )
            ,   id = obj._listenerId || ( obj._listenerId = uniqueId( 'l' ) );

            listeners[ id ] = obj;
            if ( typeof name === 'object' ) callback = this;
            obj[ implementation ]( name, callback, this );

            return this;
        };

    });


    // Gillie.Handler
    // Handlers are used to listen for DOM events, get data from them
    // and then route that data to a controller, view or model.
    var Handler = Gillie.Handler = function( options ) {

            if ( this.initialize ) this.initialize.apply( this, arguments );
            this.delegateEvents();
        }

        // Regex to split keys for `delegate` method.
    ,   delegateEventSplitter = /^(\S+)\s*(.*)$/;


    _extend( Handler.prototype, Events, {

            // Create a function that bound to a given object.
            // Adapted from underscore `_.bind()`.
            // https://github.com/jashkenas/underscore/blob/master/underscore.js#L583
            bind: function( func, context ) {
                return function() {
                    return func.apply( context, arguments );
                }
            }

            // Delegate the events passed from the `events` object.
            // https://github.com/jashkenas/backbone/blob/master/backbone.js#L1048
        ,   delegateEvents: function( events ) {

                if ( ! ( events || ( events = this.events ) ) ) return this;

                for( var key in events ) {
                    var method = events[ key ];

                    method = this[ events[ key ] ];
                    if ( ! method ) continue;

                    var match = key.match( delegateEventSplitter );
                    var eventName = match[ 1 ], selector = match[ 2 ]

                    // Element to bind events to. Take document as fallback.
                    ,   el = this.el || document;

                    // Method
                    method = this.bind( method, this );

                    if ( selector === '' ) {
                        $( el ).on( eventName, method );
                    } else {
                        $( el ).on( eventName, selector, method );
                    }
                }

                return this;
            }

    });


    // Gillie.Controller
    // Controllers are intended to handle the application main logic,
    // that is, handler methods call controller methods passing them data
    // from the DOM, then controller decides what to do with that data,
    // whether to send it to the server via the model, or just to process it
    // and send it to a view etc.
    var Controller = Gillie.Controller = function( options ) {

        if ( this.initialize ) this.initialize();
    }

    _extend( Controller.prototype, Events );


    // Gillie.Model
    // Models take care of talking to the server by making AJAX requests
    // and then triggering events so that views that are listening to them
    // can do actions with the returned data.
    var Model = Gillie.Model = function( attributes ) {
        var defaults;
        var attrs = attributes || {};
        this.cid = uniqueId( 'c' );
        this.attributes = {};
        if ( defaults = this.defaults ) {
            attrs = $.extend( {}, defaults, attrs );
        }

        // Set new attributes
        //
        //      this.set( attrs );
        //
        this.attributes = attrs;
        if ( this.initialize ) this.initialize();

        }

    // Cached regular expressions for matching named param parts and splatted
    // parts of route strings.
    // Adapted from https://github.com/jashkenas/backbone/blob/master/backbone.js#L1219
    ,   namedParam    = /(\(\?)?:\w+/g

    // Cached regexp for removing a trailing slash.
    ,   trailingSlash = /\/$/;


    _extend( Model.prototype, Events, {


            // Set one attribute or several attributes, on the model.
            //
            //      // Setting attributes in a model instance.
            //      model.set({ foo: 1, bar: 2 });
            //
            set: function( key, val, options ) {
                var attr,  attrs, current, unset;

                if ( key == null ) return this;

                // As Backbone's "set", handle both `"key"`, value
                // and `{ key: value }` - style arguments.
                if ( typeof key === 'object' ) {
                    attrs = key;
                    options = val;

                } else {
                    ( attrs = {} )[ key ] = val;
                }

                options || ( options = {} );

                // Get options
                unset = options.unset;

                // Store current attributes.
                current = this.attributes;

                // Set every attribute that was passed.
                for ( attr in attrs ) {
                    val = attrs[ attr ];

                    // Always update the attribute.
                    unset ? delete current[ attr ] : current[ attr ] = val;
                }

                return this;

            }

            // Backbone's "get", which get the value of an attribute.
        ,   get: function( attr ) {
                return this.attributes[ attr ];
            }

            // Remove an attribute from the model.
        ,   unset: function( attr, options ) {
                return this.set( attr, void 0, _extend( {}, options, { unset: true } ) );
            }

            // Return a copy of the model's "attributes" object
        ,   toJSON: function() {
                return $.extend( {}, this.attributes );
            }

            // Parse a router string setting the respective values of named
            // variables based on model attributes.
            //
            //      var route = this.buildRequestUrl( 'user/:id/statuses/:page' );
            //
        ,   buildRequestUrl: function( route ) {

                var varName, modelVar, _this = this
                ,   route;

                route = route.replace( namedParam, function( match, optional ) {

                    // Loop through each name variable getting value from model
                    varName = match.replace( ':', '' );
                    modelVar = _this.get( varName );

                    return optional ? match : modelVar || match;
                });

                return this.url ? this.url + route :
                    window.location.href + '/' + route;

            }

            // Proxy to `Gillie.sync` by default
        ,   sync: function() {
                return Gillie.sync.apply( this, arguments );
            }

    });

    // Request wrappers that will be implements on model
    var methodsAlias = [
                [ '_get', 'read' ], [ '_post', 'create' ]
            ,   [ '_put', 'update' ], [ '_delete', 'delete' ]
            ,   [ '_patch', 'patch' ]
        ]
    ,   requestMethods = {};

    // Create each method in the `requestMethods` object so that we can
    // extend the model with it.
    $.each( methodsAlias , function( k, v ) {

        // Request methods
        //
        //      // Make a post request to the specified path with named
        //      // variables, in this case `:query` and `:page` which match model attributes.
        //
        //      // Note that each request takes `model.url` as the base for the AJAX URL
        //      // and when it isn't present, uses `window.location.href` as base URL.
        //      model._post( 'search/:query/:page', 'custom_event', options );
        //
        requestMethods[ v[ 0 ] ] = function( path, event, options ) {

                var xhr, model = this
                ,   success = options.success;

                // Default success function
                options.success = function( resp ) {

                    // Call passed "success" function if specified.
                    if ( success ) success( model, resp, options );
                    model.trigger( event, model, resp, options );
                }

                // Add path to the base URL.
                options.url = this.buildRequestUrl( path );

                xhr = this.sync( v[ 1 ], this, options );
                return xhr;

            }
    });

    // Add request methods to model
    _extend( Model.prototype, requestMethods );


    // Gillie.View
    // In Gillie, views are taken care of affecting DOM elements,
    // that means, they subscribe to models events, when these events
    // are triggered, views print the new data, of show feedback, etc.
    var View = Gillie.View = Controller;

    // Gillie.sync
    //
    Gillie.sync = function( method, model, options ) {

        var type = methodMap[ method ];

        // Default JSON-request options
        var params = { type: type, dataType: 'json' };

        // Make sure we have an URL.
        if ( ! options.url ) {
            params.url = model.url;
        }

        // Ensure that we have the appropriate data
        if ( options.data == null && model && ( method === 'create' || method === 'update' || method === 'patch' ) ) {
            params.contentType = 'application/json';
            params.data = JSON.stringify( options.attrs || model.toJSON() );
        }

        // Don't process data on a non-GET request.
        if ( params.type !== 'GET' ) {
            params.processData = false;
        }

        // If we're sending a `PATCH` request and we're in an old Internet Explorer browser
        // that still has ActiveX enabled by default, override jQuery or Zepto to use that
        // for XHR instead.
        if ( params.type === 'PATCH' && noXhrPatch ) {
            params.xhr = function() {
                return new ActiveXObject( "Microsoft.XMLHTTP" );
            }
        }

        // Make the request, allowing the user to override any AJAX options.
        var xhr = options.xhr = Gillie.ajax( $.extend( params, options ) );
        model.trigger( 'request', model, xhr, options );
        return xhr;

    }

    var noXhrPatch = typeof window !== 'undefined' && !! window.ActiveXObject && !( window.XMLHttpRequest && ( new XMLHttpRequest ).dispatchEvent )

    // Map from CRUD to HTTP for our default `Gillie.Model.sync` implementation
    ,   methodMap = {
            'create': 'POST'
        ,   'update': 'PUT'
        ,   'patch': 'PATCH'
        ,   'delete': 'DELETE'
        ,   'read': 'GET'
    };

    // Set the default implementation of `Gillie.ajax` to proxy through to `$`.
    Gillie.ajax = function() {
        return $.ajax.apply( $, arguments );
    };

    // Helpers
    var extend = function( prop ) {

        var _super = this.prototype, parent = this;

        // Instantiate a base class
        initializing = true;
        var prototype = new this();
        initializing = false;


        // Copy the properties over onto the new prototype
        for ( var name in prop ) {

            // Check whether we're overwriting an existing function
            prototype[ name ] = typeof prop[ name ] == "function" &&
                typeof _super[ name ] == "function" && fnTest.test( prop[ name ] ) ?
                ( function( name, fn ) {
                    return function() {
                        var tmp = this._super;

                        // Add a new ._super() method that is the same
                        // methods but on the super-class
                        this._super = _super[ name ];

                        // The method only need to be bound temporarily, so we
                        // remove it when we're done executing
                        var ret = fn.apply( this, arguments );
                        this._super = tmp;

                        return ret;
                    };
                })( name, prop[ name ] ) :
                prop[ name ];
        }


        // Class constructor
        function Gillie() {

            if ( ! initializing ) {
                parent.apply( this, arguments );
            }
        }

        // Populate our constructed prototype object
        Gillie.prototype = prototype;

        // Enforce the constructor to be what we expect
        Gillie.prototype.constructor = Gillie;

        // Make this class expendable
        Gillie.extend = arguments.callee;

        return Gillie;
    };

    // Generate a unique integer id ( unique within the entire client session ).
    // Useful for temporary DOM ids
    var idCounter = 0

    ,   uniqueId = function( prefix ) {
            var id = ++ idCounter + '';
            return prefix ? prefix + id : id;
        };



    // Make Handler, Model, View and Controller be extensible
    Gillie.Handler.extend = Gillie.Model.extend = Gillie.Controller.extend = Gillie.View.extend = extend;


    // Expose Gillie to the global scope
    window.Gillie = Gillie;

})( jQuery, this );
/*!
 * mustache.js - Logic-less {{mustache}} templates with JavaScript
 * http://github.com/janl/mustache.js
 */

/*global define: false*/

(function (root, factory) {
  if (typeof exports === "object" && exports) {
    module.exports = factory; // CommonJS
  } else if (typeof define === "function" && define.amd) {
    define(factory); // AMD
  } else {
    root.Mustache = factory; // <script>
  }
}(this, (function () {

  var exports = {};

  exports.name = "mustache.js";
  exports.version = "0.7.2";
  exports.tags = ["{{", "}}"];

  exports.Scanner = Scanner;
  exports.Context = Context;
  exports.Writer = Writer;

  var whiteRe = /\s*/;
  var spaceRe = /\s+/;
  var nonSpaceRe = /\S/;
  var eqRe = /\s*=/;
  var curlyRe = /\s*\}/;
  var tagRe = /#|\^|\/|>|\{|&|=|!/;

  // Workaround for https://issues.apache.org/jira/browse/COUCHDB-577
  // See https://github.com/janl/mustache.js/issues/189
  function testRe(re, string) {
    return RegExp.prototype.test.call(re, string);
  }

  function isWhitespace(string) {
    return !testRe(nonSpaceRe, string);
  }

  var isArray = Array.isArray || function (obj) {
    return Object.prototype.toString.call(obj) === "[object Array]";
  };

  function escapeRe(string) {
    return string.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g, "\\$&");
  }

  var entityMap = {
    "&": "&amp;",
    "<": "&lt;",
    ">": "&gt;",
    '"': '&quot;',
    "'": '&#39;',
    "/": '&#x2F;'
  };


  function escapeHtml(string) {
    return String(string).replace(/[&<>"'\/]/g, function (s) {
      return entityMap[s];
    });
  }

  // Export the escaping function so that the user may override it.
  // See https://github.com/janl/mustache.js/issues/244
  exports.escape = escapeHtml;

  function Scanner(string) {
    this.string = string;
    this.tail = string;
    this.pos = 0;
  }

  /**
   * Returns `true` if the tail is empty (end of string).
   */
  Scanner.prototype.eos = function () {
    return this.tail === "";
  };

  /**
   * Tries to match the given regular expression at the current position.
   * Returns the matched text if it can match, the empty string otherwise.
   */
  Scanner.prototype.scan = function (re) {
    var match = this.tail.match(re);

    if (match && match.index === 0) {
      this.tail = this.tail.substring(match[0].length);
      this.pos += match[0].length;
      return match[0];
    }

    return "";
  };

  /**
   * Skips all text until the given regular expression can be matched. Returns
   * the skipped string, which is the entire tail if no match can be made.
   */
  Scanner.prototype.scanUntil = function (re) {
    var match, pos = this.tail.search(re);

    switch (pos) {
    case -1:
      match = this.tail;
      this.pos += this.tail.length;
      this.tail = "";
      break;
    case 0:
      match = "";
      break;
    default:
      match = this.tail.substring(0, pos);
      this.tail = this.tail.substring(pos);
      this.pos += pos;
    }

    return match;
  };

  function Context(view, parent) {
    this.view = view;
    this.parent = parent;
    this.clearCache();
  }

  Context.make = function (view) {
    return (view instanceof Context) ? view : new Context(view);
  };

  Context.prototype.clearCache = function () {
    this._cache = {};
  };

  Context.prototype.push = function (view) {
    return new Context(view, this);
  };

  Context.prototype.lookup = function (name) {
    var value = this._cache[name];

    if (!value) {
      if (name === ".") {
        value = this.view;
      } else {
        var context = this;

        while (context) {
          if (name.indexOf(".") > 0) {
            var names = name.split("."), i = 0;

            value = context.view;

            while (value && i < names.length) {
              value = value[names[i++]];
            }
          } else {
            value = context.view[name];
          }

          if (value != null) {
            break;
          }

          context = context.parent;
        }
      }

      this._cache[name] = value;
    }

    if (typeof value === "function") {
      value = value.call(this.view);
    }

    return value;
  };

  function Writer() {
    this.clearCache();
  }

  Writer.prototype.clearCache = function () {
    this._cache = {};
    this._partialCache = {};
  };

  Writer.prototype.compile = function (template, tags) {
    var fn = this._cache[template];

    if (!fn) {
      var tokens = exports.parse(template, tags);
      fn = this._cache[template] = this.compileTokens(tokens, template);
    }

    return fn;
  };

  Writer.prototype.compilePartial = function (name, template, tags) {
    var fn = this.compile(template, tags);
    this._partialCache[name] = fn;
    return fn;
  };

  Writer.prototype.compileTokens = function (tokens, template) {
    var fn = compileTokens(tokens);
    var self = this;

    return function (view, partials) {
      if (partials) {
        if (typeof partials === "function") {
          self._loadPartial = partials;
        } else {
          for (var name in partials) {
            self.compilePartial(name, partials[name]);
          }
        }
      }

      return fn(self, Context.make(view), template);
    };
  };

  Writer.prototype.render = function (template, view, partials) {
    return this.compile(template)(view, partials);
  };

  Writer.prototype._section = function (name, context, text, callback) {
    var value = context.lookup(name);

    switch (typeof value) {
    case "object":
      if (isArray(value)) {
        var buffer = "";

        for (var i = 0, len = value.length; i < len; ++i) {
          buffer += callback(this, context.push(value[i]));
        }

        return buffer;
      }

      return value ? callback(this, context.push(value)) : "";
    case "function":
      var self = this;
      var scopedRender = function (template) {
        return self.render(template, context);
      };

      var result = value.call(context.view, text, scopedRender);
      return result != null ? result : "";
    default:
      if (value) {
        return callback(this, context);
      }
    }

    return "";
  };

  Writer.prototype._inverted = function (name, context, callback) {
    var value = context.lookup(name);

    // Use JavaScript's definition of falsy. Include empty arrays.
    // See https://github.com/janl/mustache.js/issues/186
    if (!value || (isArray(value) && value.length === 0)) {
      return callback(this, context);
    }

    return "";
  };

  Writer.prototype._partial = function (name, context) {
    if (!(name in this._partialCache) && this._loadPartial) {
      this.compilePartial(name, this._loadPartial(name));
    }

    var fn = this._partialCache[name];

    return fn ? fn(context) : "";
  };

  Writer.prototype._name = function (name, context) {
    var value = context.lookup(name);

    if (typeof value === "function") {
      value = value.call(context.view);
    }

    return (value == null) ? "" : String(value);
  };

  Writer.prototype._escaped = function (name, context) {
    return exports.escape(this._name(name, context));
  };

  /**
   * Low-level function that compiles the given `tokens` into a function
   * that accepts three arguments: a Writer, a Context, and the template.
   */
  function compileTokens(tokens) {
    var subRenders = {};

    function subRender(i, tokens, template) {
      if (!subRenders[i]) {
        var fn = compileTokens(tokens);
        subRenders[i] = function (writer, context) {
          return fn(writer, context, template);
        };
      }

      return subRenders[i];
    }

    return function (writer, context, template) {
      var buffer = "";
      var token, sectionText;

      for (var i = 0, len = tokens.length; i < len; ++i) {
        token = tokens[i];

        switch (token[0]) {
        case "#":
          sectionText = template.slice(token[3], token[5]);
          buffer += writer._section(token[1], context, sectionText, subRender(i, token[4], template));
          break;
        case "^":
          buffer += writer._inverted(token[1], context, subRender(i, token[4], template));
          break;
        case ">":
          buffer += writer._partial(token[1], context);
          break;
        case "&":
          buffer += writer._name(token[1], context);
          break;
        case "name":
          buffer += writer._escaped(token[1], context);
          break;
        case "text":
          buffer += token[1];
          break;
        }
      }

      return buffer;
    };
  }

  /**
   * Forms the given array of `tokens` into a nested tree structure where
   * tokens that represent a section have two additional items: 1) an array of
   * all tokens that appear in that section and 2) the index in the original
   * template that represents the end of that section.
   */
  function nestTokens(tokens) {
    var tree = [];
    var collector = tree;
    var sections = [];

    var token;
    for (var i = 0, len = tokens.length; i < len; ++i) {
      token = tokens[i];
      switch (token[0]) {
      case '#':
      case '^':
        sections.push(token);
        collector.push(token);
        collector = token[4] = [];
        break;
      case '/':
        var section = sections.pop();
        section[5] = token[2];
        collector = sections.length > 0 ? sections[sections.length - 1][4] : tree;
        break;
      default:
        collector.push(token);
      }
    }

    return tree;
  }

  /**
   * Combines the values of consecutive text tokens in the given `tokens` array
   * to a single token.
   */
  function squashTokens(tokens) {
    var squashedTokens = [];

    var token, lastToken;
    for (var i = 0, len = tokens.length; i < len; ++i) {
      token = tokens[i];
      if (token[0] === 'text' && lastToken && lastToken[0] === 'text') {
        lastToken[1] += token[1];
        lastToken[3] = token[3];
      } else {
        lastToken = token;
        squashedTokens.push(token);
      }
    }

    return squashedTokens;
  }

  function escapeTags(tags) {
    return [
      new RegExp(escapeRe(tags[0]) + "\\s*"),
      new RegExp("\\s*" + escapeRe(tags[1]))
    ];
  }

  /**
   * Breaks up the given `template` string into a tree of token objects. If
   * `tags` is given here it must be an array with two string values: the
   * opening and closing tags used in the template (e.g. ["<%", "%>"]). Of
   * course, the default is to use mustaches (i.e. Mustache.tags).
   */
  exports.parse = function (template, tags) {
    template = template || '';
    tags = tags || exports.tags;

    if (typeof tags === 'string') tags = tags.split(spaceRe);
    if (tags.length !== 2) {
      throw new Error('Invalid tags: ' + tags.join(', '));
    }

    var tagRes = escapeTags(tags);
    var scanner = new Scanner(template);

    var sections = [];     // Stack to hold section tokens
    var tokens = [];       // Buffer to hold the tokens
    var spaces = [];       // Indices of whitespace tokens on the current line
    var hasTag = false;    // Is there a {{tag}} on the current line?
    var nonSpace = false;  // Is there a non-space char on the current line?

    // Strips all whitespace tokens array for the current line
    // if there was a {{#tag}} on it and otherwise only space.
    function stripSpace() {
      if (hasTag && !nonSpace) {
        while (spaces.length) {
          tokens.splice(spaces.pop(), 1);
        }
      } else {
        spaces = [];
      }

      hasTag = false;
      nonSpace = false;
    }

    var start, type, value, chr;
    while (!scanner.eos()) {
      start = scanner.pos;
      value = scanner.scanUntil(tagRes[0]);

      if (value) {
        for (var i = 0, len = value.length; i < len; ++i) {
          chr = value.charAt(i);

          if (isWhitespace(chr)) {
            spaces.push(tokens.length);
          } else {
            nonSpace = true;
          }

          tokens.push(["text", chr, start, start + 1]);
          start += 1;

          if (chr === "\n") {
            stripSpace(); // Check for whitespace on the current line.
          }
        }
      }

      start = scanner.pos;

      // Match the opening tag.
      if (!scanner.scan(tagRes[0])) {
        break;
      }

      hasTag = true;
      type = scanner.scan(tagRe) || "name";

      // Skip any whitespace between tag and value.
      scanner.scan(whiteRe);

      // Extract the tag value.
      if (type === "=") {
        value = scanner.scanUntil(eqRe);
        scanner.scan(eqRe);
        scanner.scanUntil(tagRes[1]);
      } else if (type === "{") {
        var closeRe = new RegExp("\\s*" + escapeRe("}" + tags[1]));
        value = scanner.scanUntil(closeRe);
        scanner.scan(curlyRe);
        scanner.scanUntil(tagRes[1]);
        type = "&";
      } else {
        value = scanner.scanUntil(tagRes[1]);
      }

      // Match the closing tag.
      if (!scanner.scan(tagRes[1])) {
        throw new Error('Unclosed tag at ' + scanner.pos);
      }

      // Check section nesting.
      if (type === '/') {
        if (sections.length === 0) {
          throw new Error('Unopened section "' + value + '" at ' + start);
        }

        var section = sections.pop();

        if (section[1] !== value) {
          throw new Error('Unclosed section "' + section[1] + '" at ' + start);
        }
      }

      var token = [type, value, start, scanner.pos];
      tokens.push(token);

      if (type === '#' || type === '^') {
        sections.push(token);
      } else if (type === "name" || type === "{" || type === "&") {
        nonSpace = true;
      } else if (type === "=") {
        // Set the tags for the next time around.
        tags = value.split(spaceRe);

        if (tags.length !== 2) {
          throw new Error('Invalid tags at ' + start + ': ' + tags.join(', '));
        }

        tagRes = escapeTags(tags);
      }
    }

    // Make sure there are no open sections when we're done.
    var section = sections.pop();
    if (section) {
      throw new Error('Unclosed section "' + section[1] + '" at ' + scanner.pos);
    }

    return nestTokens(squashTokens(tokens));
  };

  // The high-level clearCache, compile, compilePartial, and render functions
  // use this default writer.
  var _writer = new Writer();

  /**
   * Clears all cached templates and partials in the default writer.
   */
  exports.clearCache = function () {
    return _writer.clearCache();
  };

  /**
   * Compiles the given `template` to a reusable function using the default
   * writer.
   */
  exports.compile = function (template, tags) {
    return _writer.compile(template, tags);
  };

  /**
   * Compiles the partial with the given `name` and `template` to a reusable
   * function using the default writer.
   */
  exports.compilePartial = function (name, template, tags) {
    return _writer.compilePartial(name, template, tags);
  };

  /**
   * Compiles the given array of tokens (the output of a parse) to a reusable
   * function using the default writer.
   */
  exports.compileTokens = function (tokens, template) {
    return _writer.compileTokens(tokens, template);
  };

  /**
   * Renders the `template` with the given `view` and `partials` using the
   * default writer.
   */
  exports.render = function (template, view, partials) {
    return _writer.render(template, view, partials);
  };

  // This is here for backwards compatibility with 0.4.x.
  exports.to_html = function (template, view, partials, send) {
    var result = exports.render(template, view, partials);

    if (typeof send === "function") {
      send(result);
    } else {
      return result;
    }
  };

  return exports;

}())));
//     Underscore.js 1.5.2
//     http://underscorejs.org
//     (c) 2009-2013 Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
//     Underscore may be freely distributed under the MIT license.

(function() {

  // Baseline setup
  // --------------

  // Establish the root object, `window` in the browser, or `exports` on the server.
  var root = this;

  // Save the previous value of the `_` variable.
  var previousUnderscore = root._;

  // Establish the object that gets returned to break out of a loop iteration.
  var breaker = {};

  // Save bytes in the minified (but not gzipped) version:
  var ArrayProto = Array.prototype, ObjProto = Object.prototype, FuncProto = Function.prototype;

  // Create quick reference variables for speed access to core prototypes.
  var
    push             = ArrayProto.push,
    slice            = ArrayProto.slice,
    concat           = ArrayProto.concat,
    toString         = ObjProto.toString,
    hasOwnProperty   = ObjProto.hasOwnProperty;

  // All **ECMAScript 5** native function implementations that we hope to use
  // are declared here.
  var
    nativeForEach      = ArrayProto.forEach,
    nativeMap          = ArrayProto.map,
    nativeReduce       = ArrayProto.reduce,
    nativeReduceRight  = ArrayProto.reduceRight,
    nativeFilter       = ArrayProto.filter,
    nativeEvery        = ArrayProto.every,
    nativeSome         = ArrayProto.some,
    nativeIndexOf      = ArrayProto.indexOf,
    nativeLastIndexOf  = ArrayProto.lastIndexOf,
    nativeIsArray      = Array.isArray,
    nativeKeys         = Object.keys,
    nativeBind         = FuncProto.bind;

  // Create a safe reference to the Underscore object for use below.
  var _ = function(obj) {
    if (obj instanceof _) return obj;
    if (!(this instanceof _)) return new _(obj);
    this._wrapped = obj;
  };

  // Export the Underscore object for **Node.js**, with
  // backwards-compatibility for the old `require()` API. If we're in
  // the browser, add `_` as a global object via a string identifier,
  // for Closure Compiler "advanced" mode.
  if (typeof exports !== 'undefined') {
    if (typeof module !== 'undefined' && module.exports) {
      exports = module.exports = _;
    }
    exports._ = _;
  } else {
    root._ = _;
  }

  // Current version.
  _.VERSION = '1.5.2';

  // Collection Functions
  // --------------------

  // The cornerstone, an `each` implementation, aka `forEach`.
  // Handles objects with the built-in `forEach`, arrays, and raw objects.
  // Delegates to **ECMAScript 5**'s native `forEach` if available.
  var each = _.each = _.forEach = function(obj, iterator, context) {
    if (obj == null) return;
    if (nativeForEach && obj.forEach === nativeForEach) {
      obj.forEach(iterator, context);
    } else if (obj.length === +obj.length) {
      for (var i = 0, length = obj.length; i < length; i++) {
        if (iterator.call(context, obj[i], i, obj) === breaker) return;
      }
    } else {
      var keys = _.keys(obj);
      for (var i = 0, length = keys.length; i < length; i++) {
        if (iterator.call(context, obj[keys[i]], keys[i], obj) === breaker) return;
      }
    }
  };

  // Return the results of applying the iterator to each element.
  // Delegates to **ECMAScript 5**'s native `map` if available.
  _.map = _.collect = function(obj, iterator, context) {
    var results = [];
    if (obj == null) return results;
    if (nativeMap && obj.map === nativeMap) return obj.map(iterator, context);
    each(obj, function(value, index, list) {
      results.push(iterator.call(context, value, index, list));
    });
    return results;
  };

  var reduceError = 'Reduce of empty array with no initial value';

  // **Reduce** builds up a single result from a list of values, aka `inject`,
  // or `foldl`. Delegates to **ECMAScript 5**'s native `reduce` if available.
  _.reduce = _.foldl = _.inject = function(obj, iterator, memo, context) {
    var initial = arguments.length > 2;
    if (obj == null) obj = [];
    if (nativeReduce && obj.reduce === nativeReduce) {
      if (context) iterator = _.bind(iterator, context);
      return initial ? obj.reduce(iterator, memo) : obj.reduce(iterator);
    }
    each(obj, function(value, index, list) {
      if (!initial) {
        memo = value;
        initial = true;
      } else {
        memo = iterator.call(context, memo, value, index, list);
      }
    });
    if (!initial) throw new TypeError(reduceError);
    return memo;
  };

  // The right-associative version of reduce, also known as `foldr`.
  // Delegates to **ECMAScript 5**'s native `reduceRight` if available.
  _.reduceRight = _.foldr = function(obj, iterator, memo, context) {
    var initial = arguments.length > 2;
    if (obj == null) obj = [];
    if (nativeReduceRight && obj.reduceRight === nativeReduceRight) {
      if (context) iterator = _.bind(iterator, context);
      return initial ? obj.reduceRight(iterator, memo) : obj.reduceRight(iterator);
    }
    var length = obj.length;
    if (length !== +length) {
      var keys = _.keys(obj);
      length = keys.length;
    }
    each(obj, function(value, index, list) {
      index = keys ? keys[--length] : --length;
      if (!initial) {
        memo = obj[index];
        initial = true;
      } else {
        memo = iterator.call(context, memo, obj[index], index, list);
      }
    });
    if (!initial) throw new TypeError(reduceError);
    return memo;
  };

  // Return the first value which passes a truth test. Aliased as `detect`.
  _.find = _.detect = function(obj, iterator, context) {
    var result;
    any(obj, function(value, index, list) {
      if (iterator.call(context, value, index, list)) {
        result = value;
        return true;
      }
    });
    return result;
  };

  // Return all the elements that pass a truth test.
  // Delegates to **ECMAScript 5**'s native `filter` if available.
  // Aliased as `select`.
  _.filter = _.select = function(obj, iterator, context) {
    var results = [];
    if (obj == null) return results;
    if (nativeFilter && obj.filter === nativeFilter) return obj.filter(iterator, context);
    each(obj, function(value, index, list) {
      if (iterator.call(context, value, index, list)) results.push(value);
    });
    return results;
  };

  // Return all the elements for which a truth test fails.
  _.reject = function(obj, iterator, context) {
    return _.filter(obj, function(value, index, list) {
      return !iterator.call(context, value, index, list);
    }, context);
  };

  // Determine whether all of the elements match a truth test.
  // Delegates to **ECMAScript 5**'s native `every` if available.
  // Aliased as `all`.
  _.every = _.all = function(obj, iterator, context) {
    iterator || (iterator = _.identity);
    var result = true;
    if (obj == null) return result;
    if (nativeEvery && obj.every === nativeEvery) return obj.every(iterator, context);
    each(obj, function(value, index, list) {
      if (!(result = result && iterator.call(context, value, index, list))) return breaker;
    });
    return !!result;
  };

  // Determine if at least one element in the object matches a truth test.
  // Delegates to **ECMAScript 5**'s native `some` if available.
  // Aliased as `any`.
  var any = _.some = _.any = function(obj, iterator, context) {
    iterator || (iterator = _.identity);
    var result = false;
    if (obj == null) return result;
    if (nativeSome && obj.some === nativeSome) return obj.some(iterator, context);
    each(obj, function(value, index, list) {
      if (result || (result = iterator.call(context, value, index, list))) return breaker;
    });
    return !!result;
  };

  // Determine if the array or object contains a given value (using `===`).
  // Aliased as `include`.
  _.contains = _.include = function(obj, target) {
    if (obj == null) return false;
    if (nativeIndexOf && obj.indexOf === nativeIndexOf) return obj.indexOf(target) != -1;
    return any(obj, function(value) {
      return value === target;
    });
  };

  // Invoke a method (with arguments) on every item in a collection.
  _.invoke = function(obj, method) {
    var args = slice.call(arguments, 2);
    var isFunc = _.isFunction(method);
    return _.map(obj, function(value) {
      return (isFunc ? method : value[method]).apply(value, args);
    });
  };

  // Convenience version of a common use case of `map`: fetching a property.
  _.pluck = function(obj, key) {
    return _.map(obj, function(value){ return value[key]; });
  };

  // Convenience version of a common use case of `filter`: selecting only objects
  // containing specific `key:value` pairs.
  _.where = function(obj, attrs, first) {
    if (_.isEmpty(attrs)) return first ? void 0 : [];
    return _[first ? 'find' : 'filter'](obj, function(value) {
      for (var key in attrs) {
        if (attrs[key] !== value[key]) return false;
      }
      return true;
    });
  };

  // Convenience version of a common use case of `find`: getting the first object
  // containing specific `key:value` pairs.
  _.findWhere = function(obj, attrs) {
    return _.where(obj, attrs, true);
  };

  // Return the maximum element or (element-based computation).
  // Can't optimize arrays of integers longer than 65,535 elements.
  // See [WebKit Bug 80797](https://bugs.webkit.org/show_bug.cgi?id=80797)
  _.max = function(obj, iterator, context) {
    if (!iterator && _.isArray(obj) && obj[0] === +obj[0] && obj.length < 65535) {
      return Math.max.apply(Math, obj);
    }
    if (!iterator && _.isEmpty(obj)) return -Infinity;
    var result = {computed : -Infinity, value: -Infinity};
    each(obj, function(value, index, list) {
      var computed = iterator ? iterator.call(context, value, index, list) : value;
      computed > result.computed && (result = {value : value, computed : computed});
    });
    return result.value;
  };

  // Return the minimum element (or element-based computation).
  _.min = function(obj, iterator, context) {
    if (!iterator && _.isArray(obj) && obj[0] === +obj[0] && obj.length < 65535) {
      return Math.min.apply(Math, obj);
    }
    if (!iterator && _.isEmpty(obj)) return Infinity;
    var result = {computed : Infinity, value: Infinity};
    each(obj, function(value, index, list) {
      var computed = iterator ? iterator.call(context, value, index, list) : value;
      computed < result.computed && (result = {value : value, computed : computed});
    });
    return result.value;
  };

  // Shuffle an array, using the modern version of the
  // [Fisher-Yates shuffle](http://en.wikipedia.org/wiki/FisherYates_shuffle).
  _.shuffle = function(obj) {
    var rand;
    var index = 0;
    var shuffled = [];
    each(obj, function(value) {
      rand = _.random(index++);
      shuffled[index - 1] = shuffled[rand];
      shuffled[rand] = value;
    });
    return shuffled;
  };

  // Sample **n** random values from an array.
  // If **n** is not specified, returns a single random element from the array.
  // The internal `guard` argument allows it to work with `map`.
  _.sample = function(obj, n, guard) {
    if (arguments.length < 2 || guard) {
      return obj[_.random(obj.length - 1)];
    }
    return _.shuffle(obj).slice(0, Math.max(0, n));
  };

  // An internal function to generate lookup iterators.
  var lookupIterator = function(value) {
    return _.isFunction(value) ? value : function(obj){ return obj[value]; };
  };

  // Sort the object's values by a criterion produced by an iterator.
  _.sortBy = function(obj, value, context) {
    var iterator = lookupIterator(value);
    return _.pluck(_.map(obj, function(value, index, list) {
      return {
        value: value,
        index: index,
        criteria: iterator.call(context, value, index, list)
      };
    }).sort(function(left, right) {
      var a = left.criteria;
      var b = right.criteria;
      if (a !== b) {
        if (a > b || a === void 0) return 1;
        if (a < b || b === void 0) return -1;
      }
      return left.index - right.index;
    }), 'value');
  };

  // An internal function used for aggregate "group by" operations.
  var group = function(behavior) {
    return function(obj, value, context) {
      var result = {};
      var iterator = value == null ? _.identity : lookupIterator(value);
      each(obj, function(value, index) {
        var key = iterator.call(context, value, index, obj);
        behavior(result, key, value);
      });
      return result;
    };
  };

  // Groups the object's values by a criterion. Pass either a string attribute
  // to group by, or a function that returns the criterion.
  _.groupBy = group(function(result, key, value) {
    (_.has(result, key) ? result[key] : (result[key] = [])).push(value);
  });

  // Indexes the object's values by a criterion, similar to `groupBy`, but for
  // when you know that your index values will be unique.
  _.indexBy = group(function(result, key, value) {
    result[key] = value;
  });

  // Counts instances of an object that group by a certain criterion. Pass
  // either a string attribute to count by, or a function that returns the
  // criterion.
  _.countBy = group(function(result, key) {
    _.has(result, key) ? result[key]++ : result[key] = 1;
  });

  // Use a comparator function to figure out the smallest index at which
  // an object should be inserted so as to maintain order. Uses binary search.
  _.sortedIndex = function(array, obj, iterator, context) {
    iterator = iterator == null ? _.identity : lookupIterator(iterator);
    var value = iterator.call(context, obj);
    var low = 0, high = array.length;
    while (low < high) {
      var mid = (low + high) >>> 1;
      iterator.call(context, array[mid]) < value ? low = mid + 1 : high = mid;
    }
    return low;
  };

  // Safely create a real, live array from anything iterable.
  _.toArray = function(obj) {
    if (!obj) return [];
    if (_.isArray(obj)) return slice.call(obj);
    if (obj.length === +obj.length) return _.map(obj, _.identity);
    return _.values(obj);
  };

  // Return the number of elements in an object.
  _.size = function(obj) {
    if (obj == null) return 0;
    return (obj.length === +obj.length) ? obj.length : _.keys(obj).length;
  };

  // Array Functions
  // ---------------

  // Get the first element of an array. Passing **n** will return the first N
  // values in the array. Aliased as `head` and `take`. The **guard** check
  // allows it to work with `_.map`.
  _.first = _.head = _.take = function(array, n, guard) {
    if (array == null) return void 0;
    return (n == null) || guard ? array[0] : slice.call(array, 0, n);
  };

  // Returns everything but the last entry of the array. Especially useful on
  // the arguments object. Passing **n** will return all the values in
  // the array, excluding the last N. The **guard** check allows it to work with
  // `_.map`.
  _.initial = function(array, n, guard) {
    return slice.call(array, 0, array.length - ((n == null) || guard ? 1 : n));
  };

  // Get the last element of an array. Passing **n** will return the last N
  // values in the array. The **guard** check allows it to work with `_.map`.
  _.last = function(array, n, guard) {
    if (array == null) return void 0;
    if ((n == null) || guard) {
      return array[array.length - 1];
    } else {
      return slice.call(array, Math.max(array.length - n, 0));
    }
  };

  // Returns everything but the first entry of the array. Aliased as `tail` and `drop`.
  // Especially useful on the arguments object. Passing an **n** will return
  // the rest N values in the array. The **guard**
  // check allows it to work with `_.map`.
  _.rest = _.tail = _.drop = function(array, n, guard) {
    return slice.call(array, (n == null) || guard ? 1 : n);
  };

  // Trim out all falsy values from an array.
  _.compact = function(array) {
    return _.filter(array, _.identity);
  };

  // Internal implementation of a recursive `flatten` function.
  var flatten = function(input, shallow, output) {
    if (shallow && _.every(input, _.isArray)) {
      return concat.apply(output, input);
    }
    each(input, function(value) {
      if (_.isArray(value) || _.isArguments(value)) {
        shallow ? push.apply(output, value) : flatten(value, shallow, output);
      } else {
        output.push(value);
      }
    });
    return output;
  };

  // Flatten out an array, either recursively (by default), or just one level.
  _.flatten = function(array, shallow) {
    return flatten(array, shallow, []);
  };

  // Return a version of the array that does not contain the specified value(s).
  _.without = function(array) {
    return _.difference(array, slice.call(arguments, 1));
  };

  // Produce a duplicate-free version of the array. If the array has already
  // been sorted, you have the option of using a faster algorithm.
  // Aliased as `unique`.
  _.uniq = _.unique = function(array, isSorted, iterator, context) {
    if (_.isFunction(isSorted)) {
      context = iterator;
      iterator = isSorted;
      isSorted = false;
    }
    var initial = iterator ? _.map(array, iterator, context) : array;
    var results = [];
    var seen = [];
    each(initial, function(value, index) {
      if (isSorted ? (!index || seen[seen.length - 1] !== value) : !_.contains(seen, value)) {
        seen.push(value);
        results.push(array[index]);
      }
    });
    return results;
  };

  // Produce an array that contains the union: each distinct element from all of
  // the passed-in arrays.
  _.union = function() {
    return _.uniq(_.flatten(arguments, true));
  };

  // Produce an array that contains every item shared between all the
  // passed-in arrays.
  _.intersection = function(array) {
    var rest = slice.call(arguments, 1);
    return _.filter(_.uniq(array), function(item) {
      return _.every(rest, function(other) {
        return _.indexOf(other, item) >= 0;
      });
    });
  };

  // Take the difference between one array and a number of other arrays.
  // Only the elements present in just the first array will remain.
  _.difference = function(array) {
    var rest = concat.apply(ArrayProto, slice.call(arguments, 1));
    return _.filter(array, function(value){ return !_.contains(rest, value); });
  };

  // Zip together multiple lists into a single array -- elements that share
  // an index go together.
  _.zip = function() {
    var length = _.max(_.pluck(arguments, "length").concat(0));
    var results = new Array(length);
    for (var i = 0; i < length; i++) {
      results[i] = _.pluck(arguments, '' + i);
    }
    return results;
  };

  // Converts lists into objects. Pass either a single array of `[key, value]`
  // pairs, or two parallel arrays of the same length -- one of keys, and one of
  // the corresponding values.
  _.object = function(list, values) {
    if (list == null) return {};
    var result = {};
    for (var i = 0, length = list.length; i < length; i++) {
      if (values) {
        result[list[i]] = values[i];
      } else {
        result[list[i][0]] = list[i][1];
      }
    }
    return result;
  };

  // If the browser doesn't supply us with indexOf (I'm looking at you, **MSIE**),
  // we need this function. Return the position of the first occurrence of an
  // item in an array, or -1 if the item is not included in the array.
  // Delegates to **ECMAScript 5**'s native `indexOf` if available.
  // If the array is large and already in sort order, pass `true`
  // for **isSorted** to use binary search.
  _.indexOf = function(array, item, isSorted) {
    if (array == null) return -1;
    var i = 0, length = array.length;
    if (isSorted) {
      if (typeof isSorted == 'number') {
        i = (isSorted < 0 ? Math.max(0, length + isSorted) : isSorted);
      } else {
        i = _.sortedIndex(array, item);
        return array[i] === item ? i : -1;
      }
    }
    if (nativeIndexOf && array.indexOf === nativeIndexOf) return array.indexOf(item, isSorted);
    for (; i < length; i++) if (array[i] === item) return i;
    return -1;
  };

  // Delegates to **ECMAScript 5**'s native `lastIndexOf` if available.
  _.lastIndexOf = function(array, item, from) {
    if (array == null) return -1;
    var hasIndex = from != null;
    if (nativeLastIndexOf && array.lastIndexOf === nativeLastIndexOf) {
      return hasIndex ? array.lastIndexOf(item, from) : array.lastIndexOf(item);
    }
    var i = (hasIndex ? from : array.length);
    while (i--) if (array[i] === item) return i;
    return -1;
  };

  // Generate an integer Array containing an arithmetic progression. A port of
  // the native Python `range()` function. See
  // [the Python documentation](http://docs.python.org/library/functions.html#range).
  _.range = function(start, stop, step) {
    if (arguments.length <= 1) {
      stop = start || 0;
      start = 0;
    }
    step = arguments[2] || 1;

    var length = Math.max(Math.ceil((stop - start) / step), 0);
    var idx = 0;
    var range = new Array(length);

    while(idx < length) {
      range[idx++] = start;
      start += step;
    }

    return range;
  };

  // Function (ahem) Functions
  // ------------------

  // Reusable constructor function for prototype setting.
  var ctor = function(){};

  // Create a function bound to a given object (assigning `this`, and arguments,
  // optionally). Delegates to **ECMAScript 5**'s native `Function.bind` if
  // available.
  _.bind = function(func, context) {
    var args, bound;
    if (nativeBind && func.bind === nativeBind) return nativeBind.apply(func, slice.call(arguments, 1));
    if (!_.isFunction(func)) throw new TypeError;
    args = slice.call(arguments, 2);
    return bound = function() {
      if (!(this instanceof bound)) return func.apply(context, args.concat(slice.call(arguments)));
      ctor.prototype = func.prototype;
      var self = new ctor;
      ctor.prototype = null;
      var result = func.apply(self, args.concat(slice.call(arguments)));
      if (Object(result) === result) return result;
      return self;
    };
  };

  // Partially apply a function by creating a version that has had some of its
  // arguments pre-filled, without changing its dynamic `this` context.
  _.partial = function(func) {
    var args = slice.call(arguments, 1);
    return function() {
      return func.apply(this, args.concat(slice.call(arguments)));
    };
  };

  // Bind all of an object's methods to that object. Useful for ensuring that
  // all callbacks defined on an object belong to it.
  _.bindAll = function(obj) {
    var funcs = slice.call(arguments, 1);
    if (funcs.length === 0) throw new Error("bindAll must be passed function names");
    each(funcs, function(f) { obj[f] = _.bind(obj[f], obj); });
    return obj;
  };

  // Memoize an expensive function by storing its results.
  _.memoize = function(func, hasher) {
    var memo = {};
    hasher || (hasher = _.identity);
    return function() {
      var key = hasher.apply(this, arguments);
      return _.has(memo, key) ? memo[key] : (memo[key] = func.apply(this, arguments));
    };
  };

  // Delays a function for the given number of milliseconds, and then calls
  // it with the arguments supplied.
  _.delay = function(func, wait) {
    var args = slice.call(arguments, 2);
    return setTimeout(function(){ return func.apply(null, args); }, wait);
  };

  // Defers a function, scheduling it to run after the current call stack has
  // cleared.
  _.defer = function(func) {
    return _.delay.apply(_, [func, 1].concat(slice.call(arguments, 1)));
  };

  // Returns a function, that, when invoked, will only be triggered at most once
  // during a given window of time. Normally, the throttled function will run
  // as much as it can, without ever going more than once per `wait` duration;
  // but if you'd like to disable the execution on the leading edge, pass
  // `{leading: false}`. To disable execution on the trailing edge, ditto.
  _.throttle = function(func, wait, options) {
    var context, args, result;
    var timeout = null;
    var previous = 0;
    options || (options = {});
    var later = function() {
      previous = options.leading === false ? 0 : new Date;
      timeout = null;
      result = func.apply(context, args);
    };
    return function() {
      var now = new Date;
      if (!previous && options.leading === false) previous = now;
      var remaining = wait - (now - previous);
      context = this;
      args = arguments;
      if (remaining <= 0) {
        clearTimeout(timeout);
        timeout = null;
        previous = now;
        result = func.apply(context, args);
      } else if (!timeout && options.trailing !== false) {
        timeout = setTimeout(later, remaining);
      }
      return result;
    };
  };

  // Returns a function, that, as long as it continues to be invoked, will not
  // be triggered. The function will be called after it stops being called for
  // N milliseconds. If `immediate` is passed, trigger the function on the
  // leading edge, instead of the trailing.
  _.debounce = function(func, wait, immediate) {
    var timeout, args, context, timestamp, result;
    return function() {
      context = this;
      args = arguments;
      timestamp = new Date();
      var later = function() {
        var last = (new Date()) - timestamp;
        if (last < wait) {
          timeout = setTimeout(later, wait - last);
        } else {
          timeout = null;
          if (!immediate) result = func.apply(context, args);
        }
      };
      var callNow = immediate && !timeout;
      if (!timeout) {
        timeout = setTimeout(later, wait);
      }
      if (callNow) result = func.apply(context, args);
      return result;
    };
  };

  // Returns a function that will be executed at most one time, no matter how
  // often you call it. Useful for lazy initialization.
  _.once = function(func) {
    var ran = false, memo;
    return function() {
      if (ran) return memo;
      ran = true;
      memo = func.apply(this, arguments);
      func = null;
      return memo;
    };
  };

  // Returns the first function passed as an argument to the second,
  // allowing you to adjust arguments, run code before and after, and
  // conditionally execute the original function.
  _.wrap = function(func, wrapper) {
    return function() {
      var args = [func];
      push.apply(args, arguments);
      return wrapper.apply(this, args);
    };
  };

  // Returns a function that is the composition of a list of functions, each
  // consuming the return value of the function that follows.
  _.compose = function() {
    var funcs = arguments;
    return function() {
      var args = arguments;
      for (var i = funcs.length - 1; i >= 0; i--) {
        args = [funcs[i].apply(this, args)];
      }
      return args[0];
    };
  };

  // Returns a function that will only be executed after being called N times.
  _.after = function(times, func) {
    return function() {
      if (--times < 1) {
        return func.apply(this, arguments);
      }
    };
  };

  // Object Functions
  // ----------------

  // Retrieve the names of an object's properties.
  // Delegates to **ECMAScript 5**'s native `Object.keys`
  _.keys = nativeKeys || function(obj) {
    if (obj !== Object(obj)) throw new TypeError('Invalid object');
    var keys = [];
    for (var key in obj) if (_.has(obj, key)) keys.push(key);
    return keys;
  };

  // Retrieve the values of an object's properties.
  _.values = function(obj) {
    var keys = _.keys(obj);
    var length = keys.length;
    var values = new Array(length);
    for (var i = 0; i < length; i++) {
      values[i] = obj[keys[i]];
    }
    return values;
  };

  // Convert an object into a list of `[key, value]` pairs.
  _.pairs = function(obj) {
    var keys = _.keys(obj);
    var length = keys.length;
    var pairs = new Array(length);
    for (var i = 0; i < length; i++) {
      pairs[i] = [keys[i], obj[keys[i]]];
    }
    return pairs;
  };

  // Invert the keys and values of an object. The values must be serializable.
  _.invert = function(obj) {
    var result = {};
    var keys = _.keys(obj);
    for (var i = 0, length = keys.length; i < length; i++) {
      result[obj[keys[i]]] = keys[i];
    }
    return result;
  };

  // Return a sorted list of the function names available on the object.
  // Aliased as `methods`
  _.functions = _.methods = function(obj) {
    var names = [];
    for (var key in obj) {
      if (_.isFunction(obj[key])) names.push(key);
    }
    return names.sort();
  };

  // Extend a given object with all the properties in passed-in object(s).
  _.extend = function(obj) {
    each(slice.call(arguments, 1), function(source) {
      if (source) {
        for (var prop in source) {
          obj[prop] = source[prop];
        }
      }
    });
    return obj;
  };

  // Return a copy of the object only containing the whitelisted properties.
  _.pick = function(obj) {
    var copy = {};
    var keys = concat.apply(ArrayProto, slice.call(arguments, 1));
    each(keys, function(key) {
      if (key in obj) copy[key] = obj[key];
    });
    return copy;
  };

   // Return a copy of the object without the blacklisted properties.
  _.omit = function(obj) {
    var copy = {};
    var keys = concat.apply(ArrayProto, slice.call(arguments, 1));
    for (var key in obj) {
      if (!_.contains(keys, key)) copy[key] = obj[key];
    }
    return copy;
  };

  // Fill in a given object with default properties.
  _.defaults = function(obj) {
    each(slice.call(arguments, 1), function(source) {
      if (source) {
        for (var prop in source) {
          if (obj[prop] === void 0) obj[prop] = source[prop];
        }
      }
    });
    return obj;
  };

  // Create a (shallow-cloned) duplicate of an object.
  _.clone = function(obj) {
    if (!_.isObject(obj)) return obj;
    return _.isArray(obj) ? obj.slice() : _.extend({}, obj);
  };

  // Invokes interceptor with the obj, and then returns obj.
  // The primary purpose of this method is to "tap into" a method chain, in
  // order to perform operations on intermediate results within the chain.
  _.tap = function(obj, interceptor) {
    interceptor(obj);
    return obj;
  };

  // Internal recursive comparison function for `isEqual`.
  var eq = function(a, b, aStack, bStack) {
    // Identical objects are equal. `0 === -0`, but they aren't identical.
    // See the [Harmony `egal` proposal](http://wiki.ecmascript.org/doku.php?id=harmony:egal).
    if (a === b) return a !== 0 || 1 / a == 1 / b;
    // A strict comparison is necessary because `null == undefined`.
    if (a == null || b == null) return a === b;
    // Unwrap any wrapped objects.
    if (a instanceof _) a = a._wrapped;
    if (b instanceof _) b = b._wrapped;
    // Compare `[[Class]]` names.
    var className = toString.call(a);
    if (className != toString.call(b)) return false;
    switch (className) {
      // Strings, numbers, dates, and booleans are compared by value.
      case '[object String]':
        // Primitives and their corresponding object wrappers are equivalent; thus, `"5"` is
        // equivalent to `new String("5")`.
        return a == String(b);
      case '[object Number]':
        // `NaN`s are equivalent, but non-reflexive. An `egal` comparison is performed for
        // other numeric values.
        return a != +a ? b != +b : (a == 0 ? 1 / a == 1 / b : a == +b);
      case '[object Date]':
      case '[object Boolean]':
        // Coerce dates and booleans to numeric primitive values. Dates are compared by their
        // millisecond representations. Note that invalid dates with millisecond representations
        // of `NaN` are not equivalent.
        return +a == +b;
      // RegExps are compared by their source patterns and flags.
      case '[object RegExp]':
        return a.source == b.source &&
               a.global == b.global &&
               a.multiline == b.multiline &&
               a.ignoreCase == b.ignoreCase;
    }
    if (typeof a != 'object' || typeof b != 'object') return false;
    // Assume equality for cyclic structures. The algorithm for detecting cyclic
    // structures is adapted from ES 5.1 section 15.12.3, abstract operation `JO`.
    var length = aStack.length;
    while (length--) {
      // Linear search. Performance is inversely proportional to the number of
      // unique nested structures.
      if (aStack[length] == a) return bStack[length] == b;
    }
    // Objects with different constructors are not equivalent, but `Object`s
    // from different frames are.
    var aCtor = a.constructor, bCtor = b.constructor;
    if (aCtor !== bCtor && !(_.isFunction(aCtor) && (aCtor instanceof aCtor) &&
                             _.isFunction(bCtor) && (bCtor instanceof bCtor))) {
      return false;
    }
    // Add the first object to the stack of traversed objects.
    aStack.push(a);
    bStack.push(b);
    var size = 0, result = true;
    // Recursively compare objects and arrays.
    if (className == '[object Array]') {
      // Compare array lengths to determine if a deep comparison is necessary.
      size = a.length;
      result = size == b.length;
      if (result) {
        // Deep compare the contents, ignoring non-numeric properties.
        while (size--) {
          if (!(result = eq(a[size], b[size], aStack, bStack))) break;
        }
      }
    } else {
      // Deep compare objects.
      for (var key in a) {
        if (_.has(a, key)) {
          // Count the expected number of properties.
          size++;
          // Deep compare each member.
          if (!(result = _.has(b, key) && eq(a[key], b[key], aStack, bStack))) break;
        }
      }
      // Ensure that both objects contain the same number of properties.
      if (result) {
        for (key in b) {
          if (_.has(b, key) && !(size--)) break;
        }
        result = !size;
      }
    }
    // Remove the first object from the stack of traversed objects.
    aStack.pop();
    bStack.pop();
    return result;
  };

  // Perform a deep comparison to check if two objects are equal.
  _.isEqual = function(a, b) {
    return eq(a, b, [], []);
  };

  // Is a given array, string, or object empty?
  // An "empty" object has no enumerable own-properties.
  _.isEmpty = function(obj) {
    if (obj == null) return true;
    if (_.isArray(obj) || _.isString(obj)) return obj.length === 0;
    for (var key in obj) if (_.has(obj, key)) return false;
    return true;
  };

  // Is a given value a DOM element?
  _.isElement = function(obj) {
    return !!(obj && obj.nodeType === 1);
  };

  // Is a given value an array?
  // Delegates to ECMA5's native Array.isArray
  _.isArray = nativeIsArray || function(obj) {
    return toString.call(obj) == '[object Array]';
  };

  // Is a given variable an object?
  _.isObject = function(obj) {
    return obj === Object(obj);
  };

  // Add some isType methods: isArguments, isFunction, isString, isNumber, isDate, isRegExp.
  each(['Arguments', 'Function', 'String', 'Number', 'Date', 'RegExp'], function(name) {
    _['is' + name] = function(obj) {
      return toString.call(obj) == '[object ' + name + ']';
    };
  });

  // Define a fallback version of the method in browsers (ahem, IE), where
  // there isn't any inspectable "Arguments" type.
  if (!_.isArguments(arguments)) {
    _.isArguments = function(obj) {
      return !!(obj && _.has(obj, 'callee'));
    };
  }

  // Optimize `isFunction` if appropriate.
  if (typeof (/./) !== 'function') {
    _.isFunction = function(obj) {
      return typeof obj === 'function';
    };
  }

  // Is a given object a finite number?
  _.isFinite = function(obj) {
    return isFinite(obj) && !isNaN(parseFloat(obj));
  };

  // Is the given value `NaN`? (NaN is the only number which does not equal itself).
  _.isNaN = function(obj) {
    return _.isNumber(obj) && obj != +obj;
  };

  // Is a given value a boolean?
  _.isBoolean = function(obj) {
    return obj === true || obj === false || toString.call(obj) == '[object Boolean]';
  };

  // Is a given value equal to null?
  _.isNull = function(obj) {
    return obj === null;
  };

  // Is a given variable undefined?
  _.isUndefined = function(obj) {
    return obj === void 0;
  };

  // Shortcut function for checking if an object has a given property directly
  // on itself (in other words, not on a prototype).
  _.has = function(obj, key) {
    return hasOwnProperty.call(obj, key);
  };

  // Utility Functions
  // -----------------

  // Run Underscore.js in *noConflict* mode, returning the `_` variable to its
  // previous owner. Returns a reference to the Underscore object.
  _.noConflict = function() {
    root._ = previousUnderscore;
    return this;
  };

  // Keep the identity function around for default iterators.
  _.identity = function(value) {
    return value;
  };

  // Run a function **n** times.
  _.times = function(n, iterator, context) {
    var accum = Array(Math.max(0, n));
    for (var i = 0; i < n; i++) accum[i] = iterator.call(context, i);
    return accum;
  };

  // Return a random integer between min and max (inclusive).
  _.random = function(min, max) {
    if (max == null) {
      max = min;
      min = 0;
    }
    return min + Math.floor(Math.random() * (max - min + 1));
  };

  // List of HTML entities for escaping.
  var entityMap = {
    escape: {
      '&': '&amp;',
      '<': '&lt;',
      '>': '&gt;',
      '"': '&quot;',
      "'": '&#x27;'
    }
  };
  entityMap.unescape = _.invert(entityMap.escape);

  // Regexes containing the keys and values listed immediately above.
  var entityRegexes = {
    escape:   new RegExp('[' + _.keys(entityMap.escape).join('') + ']', 'g'),
    unescape: new RegExp('(' + _.keys(entityMap.unescape).join('|') + ')', 'g')
  };

  // Functions for escaping and unescaping strings to/from HTML interpolation.
  _.each(['escape', 'unescape'], function(method) {
    _[method] = function(string) {
      if (string == null) return '';
      return ('' + string).replace(entityRegexes[method], function(match) {
        return entityMap[method][match];
      });
    };
  });

  // If the value of the named `property` is a function then invoke it with the
  // `object` as context; otherwise, return it.
  _.result = function(object, property) {
    if (object == null) return void 0;
    var value = object[property];
    return _.isFunction(value) ? value.call(object) : value;
  };

  // Add your own custom functions to the Underscore object.
  _.mixin = function(obj) {
    each(_.functions(obj), function(name) {
      var func = _[name] = obj[name];
      _.prototype[name] = function() {
        var args = [this._wrapped];
        push.apply(args, arguments);
        return result.call(this, func.apply(_, args));
      };
    });
  };

  // Generate a unique integer id (unique within the entire client session).
  // Useful for temporary DOM ids.
  var idCounter = 0;
  _.uniqueId = function(prefix) {
    var id = ++idCounter + '';
    return prefix ? prefix + id : id;
  };

  // By default, Underscore uses ERB-style template delimiters, change the
  // following template settings to use alternative delimiters.
  _.templateSettings = {
    evaluate    : /<%([\s\S]+?)%>/g,
    interpolate : /<%=([\s\S]+?)%>/g,
    escape      : /<%-([\s\S]+?)%>/g
  };

  // When customizing `templateSettings`, if you don't want to define an
  // interpolation, evaluation or escaping regex, we need one that is
  // guaranteed not to match.
  var noMatch = /(.)^/;

  // Certain characters need to be escaped so that they can be put into a
  // string literal.
  var escapes = {
    "'":      "'",
    '\\':     '\\',
    '\r':     'r',
    '\n':     'n',
    '\t':     't',
    '\u2028': 'u2028',
    '\u2029': 'u2029'
  };

  var escaper = /\\|'|\r|\n|\t|\u2028|\u2029/g;

  // JavaScript micro-templating, similar to John Resig's implementation.
  // Underscore templating handles arbitrary delimiters, preserves whitespace,
  // and correctly escapes quotes within interpolated code.
  _.template = function(text, data, settings) {
    var render;
    settings = _.defaults({}, settings, _.templateSettings);

    // Combine delimiters into one regular expression via alternation.
    var matcher = new RegExp([
      (settings.escape || noMatch).source,
      (settings.interpolate || noMatch).source,
      (settings.evaluate || noMatch).source
    ].join('|') + '|$', 'g');

    // Compile the template source, escaping string literals appropriately.
    var index = 0;
    var source = "__p+='";
    text.replace(matcher, function(match, escape, interpolate, evaluate, offset) {
      source += text.slice(index, offset)
        .replace(escaper, function(match) { return '\\' + escapes[match]; });

      if (escape) {
        source += "'+\n((__t=(" + escape + "))==null?'':_.escape(__t))+\n'";
      }
      if (interpolate) {
        source += "'+\n((__t=(" + interpolate + "))==null?'':__t)+\n'";
      }
      if (evaluate) {
        source += "';\n" + evaluate + "\n__p+='";
      }
      index = offset + match.length;
      return match;
    });
    source += "';\n";

    // If a variable is not specified, place data values in local scope.
    if (!settings.variable) source = 'with(obj||{}){\n' + source + '}\n';

    source = "var __t,__p='',__j=Array.prototype.join," +
      "print=function(){__p+=__j.call(arguments,'');};\n" +
      source + "return __p;\n";

    try {
      render = new Function(settings.variable || 'obj', '_', source);
    } catch (e) {
      e.source = source;
      throw e;
    }

    if (data) return render(data, _);
    var template = function(data) {
      return render.call(this, data, _);
    };

    // Provide the compiled function source as a convenience for precompilation.
    template.source = 'function(' + (settings.variable || 'obj') + '){\n' + source + '}';

    return template;
  };

  // Add a "chain" function, which will delegate to the wrapper.
  _.chain = function(obj) {
    return _(obj).chain();
  };

  // OOP
  // ---------------
  // If Underscore is called as a function, it returns a wrapped object that
  // can be used OO-style. This wrapper holds altered versions of all the
  // underscore functions. Wrapped objects may be chained.

  // Helper function to continue chaining intermediate results.
  var result = function(obj) {
    return this._chain ? _(obj).chain() : obj;
  };

  // Add all of the Underscore functions to the wrapper object.
  _.mixin(_);

  // Add all mutator Array functions to the wrapper.
  each(['pop', 'push', 'reverse', 'shift', 'sort', 'splice', 'unshift'], function(name) {
    var method = ArrayProto[name];
    _.prototype[name] = function() {
      var obj = this._wrapped;
      method.apply(obj, arguments);
      if ((name == 'shift' || name == 'splice') && obj.length === 0) delete obj[0];
      return result.call(this, obj);
    };
  });

  // Add all accessor Array functions to the wrapper.
  each(['concat', 'join', 'slice'], function(name) {
    var method = ArrayProto[name];
    _.prototype[name] = function() {
      return result.call(this, method.apply(this._wrapped, arguments));
    };
  });

  _.extend(_.prototype, {

    // Start chaining a wrapped Underscore object.
    chain: function() {
      this._chain = true;
      return this;
    },

    // Extracts the result from a wrapped and chained object.
    value: function() {
      return this._wrapped;
    }

  });

}).call(this);

// Generated by CoffeeScript 1.4.0

/*
countdown is a simple jquery plugin for countdowns

Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
and GPL-3.0 (http://opensource.org/licenses/GPL-3.0) licenses.

@source: http://github.com/rendro/countdown/
@autor: Robert Fleischmann
@version: 1.0.1
*/


(function() {

  (function($) {
    $.countdown = function(el, options) {
      var getDateData,
        _this = this;
      this.el = el;
      this.$el = $(el);
      this.$el.data("countdown", this);
      this.init = function() {
        _this.options = $.extend({}, $.countdown.defaultOptions, options);
        if (_this.options.refresh) {
          _this.interval = setInterval(function() {
            return _this.render();
          }, _this.options.refresh);
        }
        _this.render();
        return _this;
      };
      getDateData = function(endDate) {
        var dateData, diff;
        endDate = Date.parse($.isPlainObject(_this.options.date) ? _this.options.date : new Date(_this.options.date));
        diff = (endDate - Date.parse(new Date)) / 1000;
        if (diff <= 0) {
          diff = 0;
          if (_this.interval) {
            _this.stop();
          }
          _this.options.onEnd.apply(_this);
        }
        dateData = {
          years: 0,
          days: 0,
          hours: 0,
          min: 0,
          sec: 0,
          millisec: 0
        };
        if (diff >= (365.25 * 86400)) {
          dateData.years = Math.floor(diff / (365.25 * 86400));
          diff -= dateData.years * 365.25 * 86400;
        }
        if (diff >= 86400) {
          dateData.days = Math.floor(diff / 86400);
          diff -= dateData.days * 86400;
        }
        if (diff >= 3600) {
          dateData.hours = Math.floor(diff / 3600);
          diff -= dateData.hours * 3600;
        }
        if (diff >= 60) {
          dateData.min = Math.floor(diff / 60);
          diff -= dateData.min * 60;
        }
        dateData.sec = diff;
        return dateData;
      };
      this.leadingZeros = function(num, length) {
        if (length == null) {
          length = 2;
        }
        num = String(num);
        while (num.length < length) {
          num = "0" + num;
        }
        return num;
      };
      this.update = function(newDate) {
        _this.options.date = newDate;
        return _this;
      };
      this.render = function() {
        _this.options.render.apply(_this, [getDateData(_this.options.date)]);
        return _this;
      };
      this.stop = function() {
        if (_this.interval) {
          clearInterval(_this.interval);
        }
        _this.interval = null;
        return _this;
      };
      this.start = function(refresh) {
        if (refresh == null) {
          refresh = _this.options.refresh || $.countdown.defaultOptions.refresh;
        }
        if (_this.interval) {
          clearInterval(_this.interval);
        }
        _this.render();
        _this.options.refresh = refresh;
        _this.interval = setInterval(function() {
          return _this.render();
        }, _this.options.refresh);
        return _this;
      };
      return this.init();
    };
    $.countdown.defaultOptions = {
      date: "June 7, 2087 15:03:25",
      refresh: 1000,
      onEnd: $.noop,
      render: function(date) {
        return $(this.el).html( date.days + "d " + (this.leadingZeros(date.hours)) + "h " + (this.leadingZeros(date.min)) + "min " + (this.leadingZeros(date.sec)) + "secs" );
      }
    };
    $.fn.countdown = function(options) {
      return $.each(this, function(i, el) {
        var $el;
        $el = $(el);
        if (!$el.data('countdown')) {
          return $el.data('countdown', new $.countdown(el, options));
        }
      });
    };
    return void 0;
  })(jQuery);

}).call(this);
/*
 * Lazy Load - jQuery plugin for lazy loading images
 *
 * Copyright (c) 2007-2013 Mika Tuupola
 *
 * Licensed under the MIT license:
 *   http://www.opensource.org/licenses/mit-license.php
 *
 * Project home:
 *   http://www.appelsiini.net/projects/lazyload
 *
 * Version:  1.9.3
 *
 */

(function($, window, document, undefined) {
    var $window = $(window);

    $.fn.lazyload = function(options) {
        var elements = this;
        var $container;
        var settings = {
            threshold       : 0,
            failure_limit   : 0,
            event           : "scroll",
            effect          : "show",
            container       : window,
            data_attribute  : "original",
            skip_invisible  : true,
            appear          : null,
            load            : null,
            placeholder     : "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC"
        };

        function update() {
            var counter = 0;

            elements.each(function() {
                var $this = $(this);
                if (settings.skip_invisible && !$this.is(":visible")) {
                    return;
                }
                if ($.abovethetop(this, settings) ||
                    $.leftofbegin(this, settings)) {
                        /* Nothing. */
                } else if (!$.belowthefold(this, settings) &&
                    !$.rightoffold(this, settings)) {
                        $this.trigger("appear");
                        /* if we found an image we'll load, reset the counter */
                        counter = 0;
                } else {
                    if (++counter > settings.failure_limit) {
                        return false;
                    }
                }
            });

        }

        if(options) {
            /* Maintain BC for a couple of versions. */
            if (undefined !== options.failurelimit) {
                options.failure_limit = options.failurelimit;
                delete options.failurelimit;
            }
            if (undefined !== options.effectspeed) {
                options.effect_speed = options.effectspeed;
                delete options.effectspeed;
            }

            $.extend(settings, options);
        }

        /* Cache container as jQuery as object. */
        $container = (settings.container === undefined ||
                      settings.container === window) ? $window : $(settings.container);

        /* Fire one scroll event per scroll. Not one scroll event per image. */
        if (0 === settings.event.indexOf("scroll")) {
            $container.bind(settings.event, function() {
                return update();
            });
        }

        this.each(function() {
            var self = this;
            var $self = $(self);

            self.loaded = false;

            /* If no src attribute given use data:uri. */
            if ($self.attr("src") === undefined || $self.attr("src") === false) {
                if ($self.is("img")) {
                    $self.attr("src", settings.placeholder);
                }
            }

            /* When appear is triggered load original image. */
            $self.one("appear", function() {
                if (!this.loaded) {
                    if (settings.appear) {
                        var elements_left = elements.length;
                        settings.appear.call(self, elements_left, settings);
                    }
                    $("<img />")
                        .bind("load", function() {

                            var original = $self.attr("data-" + settings.data_attribute);
                            $self.hide();
                            if ($self.is("img")) {
                                $self.attr("src", original);
                            } else {
                                $self.css("background-image", "url('" + original + "')");
                            }
                            $self[settings.effect](settings.effect_speed);

                            self.loaded = true;

                            /* Remove image from array so it is not looped next time. */
                            var temp = $.grep(elements, function(element) {
                                return !element.loaded;
                            });
                            elements = $(temp);

                            if (settings.load) {
                                var elements_left = elements.length;
                                settings.load.call(self, elements_left, settings);
                            }
                        })
                        .attr("src", $self.attr("data-" + settings.data_attribute));
                }
            });

            /* When wanted event is triggered load original image */
            /* by triggering appear.                              */
            if (0 !== settings.event.indexOf("scroll")) {
                $self.bind(settings.event, function() {
                    if (!self.loaded) {
                        $self.trigger("appear");
                    }
                });
            }
        });

        /* Check if something appears when window is resized. */
        $window.bind("resize", function() {
            update();
        });

        /* With IOS5 force loading images when navigating with back button. */
        /* Non optimal workaround. */
        if ((/(?:iphone|ipod|ipad).*os 5/gi).test(navigator.appVersion)) {
            $window.bind("pageshow", function(event) {
                if (event.originalEvent && event.originalEvent.persisted) {
                    elements.each(function() {
                        $(this).trigger("appear");
                    });
                }
            });
        }

        /* Force initial check if images should appear. */
        $(document).ready(function() {
            update();
        });

        return this;
    };

    /* Convenience methods in jQuery namespace.           */
    /* Use as  $.belowthefold(element, {threshold : 100, container : window}) */

    $.belowthefold = function(element, settings) {
        var fold;

        if (settings.container === undefined || settings.container === window) {
            fold = (window.innerHeight ? window.innerHeight : $window.height()) + $window.scrollTop();
        } else {
            fold = $(settings.container).offset().top + $(settings.container).height();
        }

        return fold <= $(element).offset().top - settings.threshold;
    };

    $.rightoffold = function(element, settings) {
        var fold;

        if (settings.container === undefined || settings.container === window) {
            fold = $window.width() + $window.scrollLeft();
        } else {
            fold = $(settings.container).offset().left + $(settings.container).width();
        }

        return fold <= $(element).offset().left - settings.threshold;
    };

    $.abovethetop = function(element, settings) {
        var fold;

        if (settings.container === undefined || settings.container === window) {
            fold = $window.scrollTop();
        } else {
            fold = $(settings.container).offset().top;
        }

        return fold >= $(element).offset().top + settings.threshold  + $(element).height();
    };

    $.leftofbegin = function(element, settings) {
        var fold;

        if (settings.container === undefined || settings.container === window) {
            fold = $window.scrollLeft();
        } else {
            fold = $(settings.container).offset().left;
        }

        return fold >= $(element).offset().left + settings.threshold + $(element).width();
    };

    $.inviewport = function(element, settings) {
         return !$.rightoffold(element, settings) && !$.leftofbegin(element, settings) &&
                !$.belowthefold(element, settings) && !$.abovethetop(element, settings);
     };

    /* Custom selectors for your convenience.   */
    /* Use as $("img:below-the-fold").something() or */
    /* $("img").filter(":below-the-fold").something() which is faster */

    $.extend($.expr[":"], {
        "below-the-fold" : function(a) { return $.belowthefold(a, {threshold : 0}); },
        "above-the-top"  : function(a) { return !$.belowthefold(a, {threshold : 0}); },
        "right-of-screen": function(a) { return $.rightoffold(a, {threshold : 0}); },
        "left-of-screen" : function(a) { return !$.rightoffold(a, {threshold : 0}); },
        "in-viewport"    : function(a) { return $.inviewport(a, {threshold : 0}); },
        /* Maintain BC for couple of versions. */
        "above-the-fold" : function(a) { return !$.belowthefold(a, {threshold : 0}); },
        "right-of-fold"  : function(a) { return $.rightoffold(a, {threshold : 0}); },
        "left-of-fold"   : function(a) { return !$.rightoffold(a, {threshold : 0}); }
    });

})(jQuery, window, document);
/*
 * jQuery Plugin: Tokenizing Autocomplete Text Entry
 * Version 1.6.0
 *
 * Copyright (c) 2009 James Smith (http://loopj.com)
 * Licensed jointly under the GPL and MIT licenses,
 * choose which one suits your project best!
 *
 */

(function ($) {
// Default settings
var DEFAULT_SETTINGS = {
	// Search settings
    method: "GET",
    contentType: "json",
    queryParam: "q",
    searchDelay: 300,
    minChars: 1,
    propertyToSearch: "name",
    jsonContainer: null,

	// Display settings
    hintText: "Type in a search term",
    noResultsText: "No results",
    searchingText: "Searching...",
    deleteText: "&times;",
    animateDropdown: true,

	// Tokenization settings
    tokenLimit: null,
    tokenDelimiter: ",",
    preventDuplicates: false,

	// Output settings
    tokenValue: "id",

	// Prepopulation settings
    prePopulate: null,
    processPrePopulate: false,

	// Manipulation settings
    idPrefix: "token-input-",

	// Formatters
    resultsFormatter: function(item){ return "<li>" + item[this.propertyToSearch]+ "</li>" },
    tokenFormatter: function(item) { return "<li><p>" + item[this.propertyToSearch] + "</p></li>" },

	// Callbacks
    onResult: null,
    onAdd: null,
    onDelete: null,
    onReady: null
};

// Default classes to use when theming
var DEFAULT_CLASSES = {
    tokenList: "token-input-list",
    token: "token-input-token",
    tokenDelete: "token-input-delete-token",
    selectedToken: "token-input-selected-token",
    highlightedToken: "token-input-highlighted-token",
    dropdown: "token-input-dropdown",
    dropdownItem: "token-input-dropdown-item",
    dropdownItem2: "token-input-dropdown-item2",
    selectedDropdownItem: "token-input-selected-dropdown-item",
    inputToken: "token-input-input-token"
};

// Input box position "enum"
var POSITION = {
    BEFORE: 0,
    AFTER: 1,
    END: 2
};

// Keys "enum"
var KEY = {
    BACKSPACE: 8,
    TAB: 9,
    ENTER: 13,
    ESCAPE: 27,
    SPACE: 32,
    PAGE_UP: 33,
    PAGE_DOWN: 34,
    END: 35,
    HOME: 36,
    LEFT: 37,
    UP: 38,
    RIGHT: 39,
    DOWN: 40,
    NUMPAD_ENTER: 108,
    COMMA: 188
};

// Additional public (exposed) methods
var methods = {
    init: function(url_or_data_or_function, options) {
        var settings = $.extend({}, DEFAULT_SETTINGS, options || {});

        return this.each(function () {
            $(this).data("tokenInputObject", new $.TokenList(this, url_or_data_or_function, settings));
        });
    },
    clear: function() {
        this.data("tokenInputObject").clear();
        return this;
    },
    add: function(item) {
        this.data("tokenInputObject").add(item);
        return this;
    },
    remove: function(item) {
        this.data("tokenInputObject").remove(item);
        return this;
    },
    get: function() {
    	return this.data("tokenInputObject").getTokens();
   	}
}

// Expose the .tokenInput function to jQuery as a plugin
$.fn.tokenInput = function (method) {
    // Method calling and initialization logic
    if(methods[method]) {
        return methods[method].apply(this, Array.prototype.slice.call(arguments, 1));
    } else {
        return methods.init.apply(this, arguments);
    }
};

// TokenList class for each input
$.TokenList = function (input, url_or_data, settings) {
    //
    // Initialization
    //

    // Configure the data source
    if($.type(url_or_data) === "string" || $.type(url_or_data) === "function") {
        // Set the url to query against
        settings.url = url_or_data;

        // If the URL is a function, evaluate it here to do our initalization work
        var url = computeURL();

        // Make a smart guess about cross-domain if it wasn't explicitly specified
        if(settings.crossDomain === undefined) {
            if(url.indexOf("://") === -1) {
                settings.crossDomain = false;
            } else {
                settings.crossDomain = (location.href.split(/\/+/g)[1] !== url.split(/\/+/g)[1]);
            }
        }
    } else if(typeof(url_or_data) === "object") {
        // Set the local data to search through
        settings.local_data = url_or_data;
    }

    // Build class names
    if(settings.classes) {
        // Use custom class names
        settings.classes = $.extend({}, DEFAULT_CLASSES, settings.classes);
    } else if(settings.theme) {
        // Use theme-suffixed default class names
        settings.classes = {};
        $.each(DEFAULT_CLASSES, function(key, value) {
            settings.classes[key] = value + "-" + settings.theme;
        });
    } else {
        settings.classes = DEFAULT_CLASSES;
    }


    // Save the tokens
    var saved_tokens = [];

    // Keep track of the number of tokens in the list
    var token_count = 0;

    // Basic cache to save on db hits
    var cache = new $.TokenList.Cache();

    // Keep track of the timeout, old vals
    var timeout;
    var input_val;

    // Create a new text input an attach keyup events
    var input_box = $("<input type=\"text\"  autocomplete=\"off\">")
        .css({
            outline: "none"
        })
        .attr("id", settings.idPrefix + input.id)
        .focus(function () {
            if (settings.tokenLimit === null || settings.tokenLimit !== token_count) {
                show_dropdown_hint();
            }
        })
        .blur(function () {
            hide_dropdown();
            $(this).val("");
        })
        .bind("keyup keydown blur update", resize_input)
        .keydown(function (event) {
            var previous_token;
            var next_token;

            switch(event.keyCode) {
                case KEY.LEFT:
                case KEY.RIGHT:
                case KEY.UP:
                case KEY.DOWN:
                    if(!$(this).val()) {
                        previous_token = input_token.prev();
                        next_token = input_token.next();

                        if((previous_token.length && previous_token.get(0) === selected_token) || (next_token.length && next_token.get(0) === selected_token)) {
                            // Check if there is a previous/next token and it is selected
                            if(event.keyCode === KEY.LEFT || event.keyCode === KEY.UP) {
                                deselect_token($(selected_token), POSITION.BEFORE);
                            } else {
                                deselect_token($(selected_token), POSITION.AFTER);
                            }
                        } else if((event.keyCode === KEY.LEFT || event.keyCode === KEY.UP) && previous_token.length) {
                            // We are moving left, select the previous token if it exists
                            select_token($(previous_token.get(0)));
                        } else if((event.keyCode === KEY.RIGHT || event.keyCode === KEY.DOWN) && next_token.length) {
                            // We are moving right, select the next token if it exists
                            select_token($(next_token.get(0)));
                        }
                    } else {
                        var dropdown_item = null;

                        if(event.keyCode === KEY.DOWN || event.keyCode === KEY.RIGHT) {
                            dropdown_item = $(selected_dropdown_item).next();
                        } else {
                            dropdown_item = $(selected_dropdown_item).prev();
                        }

                        if(dropdown_item.length) {
                            select_dropdown_item(dropdown_item);
                        }
                        return false;
                    }
                    break;

                case KEY.BACKSPACE:
                    previous_token = input_token.prev();

                    if(!$(this).val().length) {
                        if(selected_token) {
                            delete_token($(selected_token));
                            hidden_input.change();
                        } else if(previous_token.length) {
                            select_token($(previous_token.get(0)));
                        }

                        return false;
                    } else if($(this).val().length === 1) {
                        hide_dropdown();
                    } else {
                        // set a timeout just long enough to let this function finish.
                        setTimeout(function(){do_search();}, 5);
                    }
                    break;

                case KEY.TAB:
                case KEY.ENTER:
                case KEY.NUMPAD_ENTER:
                case KEY.COMMA:
                  if(selected_dropdown_item) {
                    add_token($(selected_dropdown_item).data("tokeninput"));
                    hidden_input.change();
                    return false;
                  }
                  break;

                case KEY.ESCAPE:
                  hide_dropdown();
                  return true;

                default:
                    if(String.fromCharCode(event.which)) {
                        // set a timeout just long enough to let this function finish.
                        setTimeout(function(){do_search();}, 5);
                    }
                    break;
            }
        });

    // Keep a reference to the original input box
    var hidden_input = $(input)
                           .hide()
                           .val("")
                           .focus(function () {
                               input_box.focus();
                           })
                           .blur(function () {
                               input_box.blur();
                           });

    // Keep a reference to the selected token and dropdown item
    var selected_token = null;
    var selected_token_index = 0;
    var selected_dropdown_item = null;

    // The list to store the token items in
    var token_list = $("<ul />")
        .addClass(settings.classes.tokenList)
        .click(function (event) {
            var li = $(event.target).closest("li");
            if(li && li.get(0) && $.data(li.get(0), "tokeninput")) {
                toggle_select_token(li);
            } else {
                // Deselect selected token
                if(selected_token) {
                    deselect_token($(selected_token), POSITION.END);
                }

                // Focus input box
                input_box.focus();
            }
        })
        .mouseover(function (event) {
            var li = $(event.target).closest("li");
            if(li && selected_token !== this) {
                li.addClass(settings.classes.highlightedToken);
            }
        })
        .mouseout(function (event) {
            var li = $(event.target).closest("li");
            if(li && selected_token !== this) {
                li.removeClass(settings.classes.highlightedToken);
            }
        })
        .insertBefore(hidden_input);

    // The token holding the input box
    var input_token = $("<li />")
        .addClass(settings.classes.inputToken)
        .appendTo(token_list)
        .append(input_box);

    // The list to store the dropdown items in
    var dropdown = $("<div>")
        .addClass(settings.classes.dropdown)
        .appendTo("body")
        .hide();

    // Magic element to help us resize the text input
    var input_resizer = $("<tester/>")
        .insertAfter(input_box)
        .css({
            position: "absolute",
            top: -9999,
            left: -9999,
            width: "auto",
            fontSize: input_box.css("fontSize"),
            fontFamily: input_box.css("fontFamily"),
            fontWeight: input_box.css("fontWeight"),
            letterSpacing: input_box.css("letterSpacing"),
            whiteSpace: "nowrap"
        });

    // Pre-populate list if items exist
    hidden_input.val("");
    var li_data = settings.prePopulate || hidden_input.data("pre");
    if(settings.processPrePopulate && $.isFunction(settings.onResult)) {
        li_data = settings.onResult.call(hidden_input, li_data);
    }
    if(li_data && li_data.length) {
        $.each(li_data, function (index, value) {
            insert_token(value);
            checkTokenLimit();
        });
    }

    // Initialization is done
    if($.isFunction(settings.onReady)) {
        settings.onReady.call();
    }

    //
    // Public functions
    //

    this.clear = function() {
        token_list.children("li").each(function() {
            if ($(this).children("input").length === 0) {
                delete_token($(this));
            }
        });
    }

    this.add = function(item) {
        add_token(item);
    }

    this.remove = function(item) {
        token_list.children("li").each(function() {
            if ($(this).children("input").length === 0) {
                var currToken = $(this).data("tokeninput");
                var match = true;
                for (var prop in item) {
                    if (item[prop] !== currToken[prop]) {
                        match = false;
                        break;
                    }
                }
                if (match) {
                    delete_token($(this));
                }
            }
        });
    }
    
    this.getTokens = function() {
   		return saved_tokens;
   	}

    //
    // Private functions
    //

    function checkTokenLimit() {
        if(settings.tokenLimit !== null && token_count >= settings.tokenLimit) {
            input_box.hide();
            hide_dropdown();
            return;
        }
    }

    function resize_input() {
        if(input_val === (input_val = input_box.val())) {return;}

        // Enter new content into resizer and resize input accordingly
        var escaped = input_val.replace(/&/g, '&amp;').replace(/\s/g,' ').replace(/</g, '&lt;').replace(/>/g, '&gt;');
        input_resizer.html(escaped);
        input_box.width(input_resizer.width() + 30);
    }

    function is_printable_character(keycode) {
        return ((keycode >= 48 && keycode <= 90) ||     // 0-1a-z
                (keycode >= 96 && keycode <= 111) ||    // numpad 0-9 + - / * .
                (keycode >= 186 && keycode <= 192) ||   // ; = , - . / ^
                (keycode >= 219 && keycode <= 222));    // ( \ ) '
    }

    // Inner function to a token to the list
    function insert_token(item) {
        var this_token = settings.tokenFormatter(item);
        this_token = $(this_token)
          .addClass(settings.classes.token)
          .insertBefore(input_token);

        // The 'delete token' button
        $("<span>" + settings.deleteText + "</span>")
            .addClass(settings.classes.tokenDelete)
            .appendTo(this_token)
            .click(function () {
                delete_token($(this).parent());
                hidden_input.change();
                return false;
            });

        // Store data on the token
        var token_data = {"id": item.id};
        token_data[settings.propertyToSearch] = item[settings.propertyToSearch];
        $.data(this_token.get(0), "tokeninput", item);

        // Save this token for duplicate checking
        saved_tokens = saved_tokens.slice(0,selected_token_index).concat([token_data]).concat(saved_tokens.slice(selected_token_index));
        selected_token_index++;

        // Update the hidden input
        update_hidden_input(saved_tokens, hidden_input);

        token_count += 1;

        // Check the token limit
        if(settings.tokenLimit !== null && token_count >= settings.tokenLimit) {
            input_box.hide();
            hide_dropdown();
        }

        return this_token;
    }

    // Add a token to the token list based on user input
    function add_token (item) {
        var callback = settings.onAdd;

        // See if the token already exists and select it if we don't want duplicates
        if(token_count > 0 && settings.preventDuplicates) {
            var found_existing_token = null;
            token_list.children().each(function () {
                var existing_token = $(this);
                var existing_data = $.data(existing_token.get(0), "tokeninput");
                if(existing_data && existing_data.id === item.id) {
                    found_existing_token = existing_token;
                    return false;
                }
            });

            if(found_existing_token) {
                select_token(found_existing_token);
                input_token.insertAfter(found_existing_token);
                input_box.focus();
                return;
            }
        }

        // Insert the new tokens
        if(settings.tokenLimit == null || token_count < settings.tokenLimit) {
            insert_token(item);
            checkTokenLimit();
        }

        // Clear input box
        input_box.val("");

        // Don't show the help dropdown, they've got the idea
        hide_dropdown();

        // Execute the onAdd callback if defined
        if($.isFunction(callback)) {
            callback.call(hidden_input,item);
        }
    }

    // Select a token in the token list
    function select_token (token) {
        token.addClass(settings.classes.selectedToken);
        selected_token = token.get(0);

        // Hide input box
        input_box.val("");

        // Hide dropdown if it is visible (eg if we clicked to select token)
        hide_dropdown();
    }

    // Deselect a token in the token list
    function deselect_token (token, position) {
        token.removeClass(settings.classes.selectedToken);
        selected_token = null;

        if(position === POSITION.BEFORE) {
            input_token.insertBefore(token);
            selected_token_index--;
        } else if(position === POSITION.AFTER) {
            input_token.insertAfter(token);
            selected_token_index++;
        } else {
            input_token.appendTo(token_list);
            selected_token_index = token_count;
        }

        // Show the input box and give it focus again
        input_box.focus();
    }

    // Toggle selection of a token in the token list
    function toggle_select_token(token) {
        var previous_selected_token = selected_token;

        if(selected_token) {
            deselect_token($(selected_token), POSITION.END);
        }

        if(previous_selected_token === token.get(0)) {
            deselect_token(token, POSITION.END);
        } else {
            select_token(token);
        }
    }

    // Delete a token from the token list
    function delete_token (token) {
        // Remove the id from the saved list
        var token_data = $.data(token.get(0), "tokeninput");
        var callback = settings.onDelete;

        var index = token.prevAll().length;
        if(index > selected_token_index) index--;

        // Delete the token
        token.remove();
        selected_token = null;

        // Show the input box and give it focus again
        input_box.focus();

        // Remove this token from the saved list
        saved_tokens = saved_tokens.slice(0,index).concat(saved_tokens.slice(index+1));
        if(index < selected_token_index) selected_token_index--;

        // Update the hidden input
        update_hidden_input(saved_tokens, hidden_input);

        token_count -= 1;

        if(settings.tokenLimit !== null) {
            input_box
                .show()
                .val("")
                .focus();
        }

        // Execute the onDelete callback if defined
        if($.isFunction(callback)) {
            callback.call(hidden_input,token_data);
        }
    }

    // Update the hidden input box value
    function update_hidden_input(saved_tokens, hidden_input) {
        var token_values = $.map(saved_tokens, function (el) {
            return el[settings.tokenValue];
        });
        hidden_input.val(token_values.join(settings.tokenDelimiter));

    }

    // Hide and clear the results dropdown
    function hide_dropdown () {
        dropdown.hide().empty();
        selected_dropdown_item = null;
    }

    function show_dropdown() {
        dropdown
            .css({
                position: "absolute",
                top: $(token_list).offset().top + $(token_list).outerHeight(),
                left: $(token_list).offset().left,
                zindex: 999
            })
            .show();
    }

    function show_dropdown_searching () {
        if(settings.searchingText) {
            dropdown.html("<p>"+settings.searchingText+"</p>");
            show_dropdown();
        }
    }

    function show_dropdown_hint () {
        if(settings.hintText) {
            dropdown.html("<p>"+settings.hintText+"</p>");
            show_dropdown();
        }
    }

    // Highlight the query part of the search term
    function highlight_term(value, term) {
        return value.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)(" + term + ")(?![^<>]*>)(?![^&;]+;)", "gi"), "<b>$1</b>");
    }
    
    function find_value_and_highlight_term(template, value, term) {
        return template.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)(" + value + ")(?![^<>]*>)(?![^&;]+;)", "g"), highlight_term(value, term));
    }

    // Populate the results dropdown with some results
    function populate_dropdown (query, results) {
        if(results && results.length) {
            dropdown.empty();
            var dropdown_ul = $("<ul>")
                .appendTo(dropdown)
                .mouseover(function (event) {
                    select_dropdown_item($(event.target).closest("li"));
                })
                .mousedown(function (event) {
                    add_token($(event.target).closest("li").data("tokeninput"));
                    hidden_input.change();
                    return false;
                })
                .hide();

            $.each(results, function(index, value) {
                var this_li = settings.resultsFormatter(value);
                
                this_li = find_value_and_highlight_term(this_li ,value[settings.propertyToSearch], query);            
                
                this_li = $(this_li).appendTo(dropdown_ul);
                
                if(index % 2) {
                    this_li.addClass(settings.classes.dropdownItem);
                } else {
                    this_li.addClass(settings.classes.dropdownItem2);
                }

                if(index === 0) {
                    select_dropdown_item(this_li);
                }

                $.data(this_li.get(0), "tokeninput", value);
            });

            show_dropdown();

            if(settings.animateDropdown) {
                dropdown_ul.slideDown("fast");
            } else {
                dropdown_ul.show();
            }
        } else {
            if(settings.noResultsText) {
                dropdown.html("<p>"+settings.noResultsText+"</p>");
                show_dropdown();
            }
        }
    }

    // Highlight an item in the results dropdown
    function select_dropdown_item (item) {
        if(item) {
            if(selected_dropdown_item) {
                deselect_dropdown_item($(selected_dropdown_item));
            }

            item.addClass(settings.classes.selectedDropdownItem);
            selected_dropdown_item = item.get(0);
        }
    }

    // Remove highlighting from an item in the results dropdown
    function deselect_dropdown_item (item) {
        item.removeClass(settings.classes.selectedDropdownItem);
        selected_dropdown_item = null;
    }

    // Do a search and show the "searching" dropdown if the input is longer
    // than settings.minChars
    function do_search() {
        var query = input_box.val().toLowerCase();

        if(query && query.length) {
            if(selected_token) {
                deselect_token($(selected_token), POSITION.AFTER);
            }

            if(query.length >= settings.minChars) {
                show_dropdown_searching();
                clearTimeout(timeout);

                timeout = setTimeout(function(){
                    run_search(query);
                }, settings.searchDelay);
            } else {
                hide_dropdown();
            }
        }
    }

    // Do the actual search
    function run_search(query) {
        var cache_key = query + computeURL();
        var cached_results = cache.get(cache_key);
        if(cached_results) {
            populate_dropdown(query, cached_results);
        } else {
            // Are we doing an ajax search or local data search?
            if(settings.url) {
                var url = computeURL();
                // Extract exisiting get params
                var ajax_params = {};
                ajax_params.data = {};
                if(url.indexOf("?") > -1) {
                    var parts = url.split("?");
                    ajax_params.url = parts[0];

                    var param_array = parts[1].split("&");
                    $.each(param_array, function (index, value) {
                        var kv = value.split("=");
                        ajax_params.data[kv[0]] = kv[1];
                    });
                } else {
                    ajax_params.url = url;
                }

                // Prepare the request
                ajax_params.data[settings.queryParam] = query;
                ajax_params.type = settings.method;
                ajax_params.dataType = settings.contentType;
                if(settings.crossDomain) {
                    ajax_params.dataType = "jsonp";
                }

                // Attach the success callback
                ajax_params.success = function(results) {
                  if($.isFunction(settings.onResult)) {
                      results = settings.onResult.call(hidden_input, results);
                  }
                  cache.add(cache_key, settings.jsonContainer ? results[settings.jsonContainer] : results);

                  // only populate the dropdown if the results are associated with the active search query
                  if(input_box.val().toLowerCase() === query) {
                      populate_dropdown(query, settings.jsonContainer ? results[settings.jsonContainer] : results);
                  }
                };

                // Make the request
                $.ajax(ajax_params);
            } else if(settings.local_data) {
                // Do the search through local data
                var results = $.grep(settings.local_data, function (row) {
                    return row[settings.propertyToSearch].toLowerCase().indexOf(query.toLowerCase()) > -1;
                });

                if($.isFunction(settings.onResult)) {
                    results = settings.onResult.call(hidden_input, results);
                }
                cache.add(cache_key, results);
                populate_dropdown(query, results);
            }
        }
    }

    // compute the dynamic URL
    function computeURL() {
        var url = settings.url;
        if(typeof settings.url == 'function') {
            url = settings.url.call();
        }
        return url;
    }
};

// Really basic cache for the results
$.TokenList.Cache = function (options) {
    var settings = $.extend({
        max_size: 500
    }, options);

    var data = {};
    var size = 0;

    var flush = function () {
        data = {};
        size = 0;
    };

    this.add = function (query, results) {
        if(size > settings.max_size) {
            flush();
        }

        if(!data[query]) {
            size += 1;
        }

        data[query] = results;
    };

    this.get = function (query) {
        return data[query];
    };
};
}(jQuery));

Object.observe||function(e,t,n){"use strict";var r,o,i=["add","update","delete","reconfigure","setPrototype","preventExtensions"],s=t.isArray||function(e){return function(t){return"[object Array]"===e.call(t)}}(e.prototype.toString),c=t.prototype.indexOf?t.indexOf||function(e,n,r){return t.prototype.indexOf.call(e,n,r)}:function(e,t,n){for(var r=n||0;r<e.length;r++)if(e[r]===t)return r;return-1},a="undefined"!=typeof n.Map&&Map.prototype.forEach?function(){return new Map}:function(){var e=[],t=[];return{size:0,has:function(t){return c(e,t)>-1},get:function(n){return t[c(e,n)]},set:function(n,r){var o=c(e,n);-1===o?(e.push(n),t.push(r),this.size++):t[o]=r},"delete":function(n){var r=c(e,n);r>-1&&(e.splice(r,1),t.splice(r,1),this.size--)},forEach:function(n){for(var r=0;r<e.length;r++)n.call(arguments[1],t[r],e[r],this)}}},f=e.getOwnPropertyNames?function(){var t=e.getOwnPropertyNames;try{arguments.callee}catch(n){var r=(t(c).join(" ")+" ").replace(/prototype |length |name /g,"").slice(0,-1).split(" ");r.length&&(t=function(t){var n=e.getOwnPropertyNames(t);if("function"==typeof t)for(var o,i=0;i<r.length;)(o=c(n,r[i++]))>-1&&n.splice(o,1);return n})}return t}():function(t){var n,r,o=[];if("hasOwnProperty"in t)for(n in t)t.hasOwnProperty(n)&&o.push(n);else{r=e.hasOwnProperty;for(n in t)r.call(t,n)&&o.push(n)}return s(t)&&o.push("length"),o},u=e.getPrototypeOf,p=e.defineProperties&&e.getOwnPropertyDescriptor,l=n.requestAnimationFrame||n.webkitRequestAnimationFrame||function(){var e=+new Date,t=e;return function(n){return setTimeout(function(){n((t=+new Date)-e)},17)}}(),h=function(e,t,n){var o=r.get(e);o?j(e,o,t,n):(o=d(e),j(e,o,t,n),1===r.size&&l(v))},d=function(t,n){var o,i=f(t),s=[],c=0,n={handlers:a(),frozen:e.isFrozen?e.isFrozen(t):!1,extensible:e.isExtensible?e.isExtensible(t):!0,proto:u&&u(t),properties:i,values:s,notifier:y(t,n)};if(p)for(o=n.descriptors=[];c<i.length;)o[c]=p(t,i[c]),s[c]=t[i[c++]];else for(;c<i.length;)s[c]=t[i[c++]];return r.set(t,n),n},b=function(){var t=p?function(e,t,n,r,o){var i=t.properties[n],s=e[i],c=t.values[n],a=t.descriptors[n];"value"in o&&(c===s?0===c&&1/c!==1/s:c===c||s===s)&&(w(e,t,{name:i,type:"update",object:e,oldValue:c},r),t.values[n]=s),!a.configurable||o.configurable&&o.writable===a.writable&&o.enumerable===a.enumerable&&o.get===a.get&&o.set===a.set||(w(e,t,{name:i,type:"reconfigure",object:e,oldValue:c},r),t.descriptors[n]=o)}:function(e,t,n,r){var o=t.properties[n],i=e[o],s=t.values[n];(s===i?0===s&&1/s!==1/i:s===s||i===i)&&(w(e,t,{name:o,type:"update",object:e,oldValue:s},r),t.values[n]=i)},n=p?function(e,n,r,o,i){for(var s,c=n.length;r&&c--;)null!==n[c]&&(s=p(e,n[c]),r--,s?t(e,o,c,i,s):(w(e,o,{name:n[c],type:"delete",object:e,oldValue:o.values[c]},i),o.properties.splice(c,1),o.values.splice(c,1),o.descriptors.splice(c,1)))}:function(e,t,n,r,o){for(var i=t.length;n&&i--;)null!==t[i]&&(w(e,r,{name:t[i],type:"delete",object:e,oldValue:r.values[i]},o),r.properties.splice(i,1),r.values.splice(i,1),n--)};return function(r,o,i){if(r.handlers.size&&!r.frozen){var s,a,l,h,d,b,v,g,y=r.values,j=r.descriptors,m=0;if(r.extensible)if(s=r.properties.slice(),a=s.length,l=f(o),j){for(;m<l.length;)d=l[m++],h=c(s,d),g=p(o,d),-1===h?(w(o,r,{name:d,type:"add",object:o},i),r.properties.push(d),y.push(o[d]),j.push(g)):(s[h]=null,a--,t(o,r,h,i,g));n(o,s,a,r,i),e.isExtensible(o)||(r.extensible=!1,w(o,r,{type:"preventExtensions",object:o},i),r.frozen=e.isFrozen(o))}else{for(;m<l.length;)d=l[m++],h=c(s,d),b=o[d],-1===h?(w(o,r,{name:d,type:"add",object:o},i),r.properties.push(d),y.push(b)):(s[h]=null,a--,t(o,r,h,i));n(o,s,a,r,i)}else if(!r.frozen){for(;m<s.length;m++)d=s[m],t(o,r,m,i,p(o,d));e.isFrozen(o)&&(r.frozen=!0)}u&&(v=u(o),v!==r.proto&&(w(o,r,{type:"setPrototype",name:"__proto__",object:o,oldValue:r.proto}),r.proto=v))}}}(),v=function(){r.size&&(r.forEach(b),o.forEach(g),l(v))},g=function(e,t){e.changeRecords.length&&(t(e.changeRecords),e.changeRecords=[])},y=function(e,t){return arguments.length<2&&(t=r.get(e)),t&&t.notifier||{notify:function(t){t.type;var n=r.get(e);if(n){var o,i={object:e};for(o in t)"object"!==o&&(i[o]=t[o]);w(e,n,i)}},performChange:function(t,n){if("string"!=typeof t)throw new TypeError("Invalid non-string changeType");if("function"!=typeof n)throw new TypeError("Cannot perform non-function");var o,i,s=r.get(e),c=n.call(arguments[2]);if(s&&b(s,e,t),s&&c&&"object"==typeof c){i={object:e,type:t};for(o in c)"object"!==o&&"type"!==o&&(i[o]=c[o]);w(e,s,i)}}}},j=function(e,t,n,r){var i=o.get(n);i||o.set(n,i={observed:a(),changeRecords:[]}),i.observed.set(e,{acceptList:r.slice(),data:t}),t.handlers.set(n,i)},w=function(e,t,n,r){t.handlers.forEach(function(t){var o=t.observed.get(e).acceptList;("string"!=typeof r||-1===c(o,r))&&c(o,n.type)>-1&&t.changeRecords.push(n)})};r=a(),o=a(),e.observe=function(t,n,r){if(!t||"object"!=typeof t&&"function"!=typeof t)throw new TypeError("Object.observe cannot observe non-object");if("function"!=typeof n)throw new TypeError("Object.observe cannot deliver to non-function");if(e.isFrozen&&e.isFrozen(n))throw new TypeError("Object.observe cannot deliver to a frozen function object");if(arguments.length>2){if(!r||"object"!=typeof r)throw new TypeError("Object.observe cannot use non-object accept list")}else r=i;return h(t,n,r),t},e.unobserve=function(e,t){if(null===e||"object"!=typeof e&&"function"!=typeof e)throw new TypeError("Object.unobserve cannot unobserve non-object");if("function"!=typeof t)throw new TypeError("Object.unobserve cannot deliver to non-function");var n,i=o.get(t);return i&&(n=i.observed.get(e))&&(i.observed.forEach(function(e,t){b(e.data,t)}),l(function(){g(i,t)}),1===i.observed.size&&i.observed.has(e)?o["delete"](t):i.observed["delete"](e),1===n.data.handlers.size?r["delete"](e):n.data.handlers["delete"](t)),e},e.getNotifier=function(t){if(null===t||"object"!=typeof t&&"function"!=typeof t)throw new TypeError("Object.getNotifier cannot getNotifier non-object");return e.isFrozen&&e.isFrozen(t)?null:y(t)},e.deliverChangeRecords=function(e){if("function"!=typeof e)throw new TypeError("Object.deliverChangeRecords cannot deliver to non-function");var t=o.get(e);t&&(t.observed.forEach(function(e,t){b(e.data,t)}),g(t,e))}}(Object,Array,this);
//# sourceMappingURL=object-observe.min.map
/**
* Boot JavaScript File
* Crates the main namespace
*/
(function() {

	// Global events.
	var Event = Gillie.Model.extend({});

	window.Bppl = {
			Handlers: {}
		,	Models: {}
		,	Views: {}
		,	Controllers: {}
		,	Helpers: {}
		,	Config: {}
		,	Event: new Event()
	};

})();
/**
* Utility helper library
*
*/
( function( $, window, document ) {

    var UtilityHelper = function( a ) {

        // Array which will hold the sources of the images uploaded as additional
        this.smtImagesArray = [];

        // Array storing the source of the attachment, it is supposed to be just one
        // however we'll keep this as an array in the case we handle more than one attachment
        this.smtAttachmentsArray = [];

        //Array storing the tags of the current post, it is supposed to be as many tags as you need
        // that's why we'll keep this as an array in the case we handle more than one attachment
        this.smtDataTags = [];

        this.smtDataMarketCat = '';

        // Array storing last selected featured image
        this.smtFeaturedImage = '';

        // Store the value of the tags
        this.activeCategory = 'cat-graphic';

        // Store the list id for suggestion
        this.suggestList = 0;

        // Array of IDs for the bundle items
        this.premiumBundleItems = [];

        // Hanle global notification close
        this.handleGlobalNotificationClose();

        // Prototype month names
        this.protoMonthsNames();

        // Handle popovers close
        this.handlePopoverClose();

        // Use jQuery noconflict
        $.noConflict();

        // Mustache templates cache
        this.mustacheCache = {};

        // Open links in background
        // this.openInBackground();

    };

    UtilityHelper.prototype = {


            // Initializes some functions
            initialize: function() {

                this.toggleModal();
                this.materialModal();
                this.timeAgo();

                // Handle form submission
                this.formSubmit();
                this.CountdownTimer( '.countdown-timer' );

                $( document ).keyup( function( e ) {

                    if( e.keyCode == 27 ) {
                        $( '.sb-smt-overlay.sb-smt-overlay' ).hide();
                        $( '.overlay-search.in-photo-single, .overlay-search.in-photos' ).removeClass( 'hidden' );

                        $( '.feats' ).removeClass( 'active' );

                        // Use on social login
                        delete localStorage.dwnLink;
                    }
                });

                // if ( localStorage.dwnLink ) {
                //     // Take user to download
                //     $( '.in-download' ).show();
                //     // $( '.modal-backdrop' ).trigger( 'click' );
                //     setTimeout( function () {

                //         window.Bppl.Helpers.Utilities.downloadView();

                //         window.location = localStorage.dwnLink;

                //         // Use on social login
                //         delete localStorage.dwnLink;
                //     }, 1500 );

                // }
            }

            /**
            * Helps in the process of making a ajax requests
            *
            * @param { object } Options for configuring the ajax request
            * @param { object } data object to be sent
            */
        ,   ajax: function( options, data ) {
                // console.log( 'options:', options, ' data: ', data );return;
                var result
                ,   defaults = {
                        type: 'post'
                    ,   url: window.aUrl
                    ,   data: data
                    ,   async: false
                    ,   success: function( data ) {
                                result = data;
                        }

                    ,   error: function ( XMLHttpRequest, textStatus, errorThrown ) {
                                console.log( "you have and error :" + XMLHttpRequest.responseText );
                        }
                    }
                // console.log( 1, defaults, options );
                // Merge defaults and options
                options = $.extend( {}, defaults, options );
                // console.log( 2, defaults, options );

                // Do the ajax request
                $.ajax( options );

                // Return the response object
                return result;

            }

            /**
            * Sends an AJAX request to the database
            * in the specified `url` passing it `data` and
            * after that, triggers `event`
            *
            *   sync( 'wordpress_action', 'eventToTrigger', this, { arg1: 'value' } );
            *
            * @param { string } WordPress action name
            * @param { string } Event to trigger
            * @param { instance } instance
            * @return { obj } additional arguments
            */
        ,   sync: function( action, event, context, plusArgs ) {

                event || ( event == '' )
                var data = $.extend( {}, context.attributes, plusArgs, { action: action  } );

                for ( k in data ) {
                    if ( k == 'action' ) continue;
                    data[ k ] = JSON.stringify( data[ k ] );
                }
                // data = JSON.stringify( data );
                // console.log( data );
                options = {
                        async: true
                    ,   url: window.aUrl
                    ,   dataType: 'json'
                    ,   success: function( data ) {

                            if ( typeof context.attributes == 'object' ) {
                                return context.trigger( event, context.attributes, data );
                            }

                            return context.trigger( event, context.attributes, data );
                        }
                };

                return this.ajax( options, data );

            }


            /**
             * Little wrapper on $.post.
             */
        ,   post: function( action, data, callback ) {

                var data = $.extend( {}, { action: action }, data );

                this.ajax(
                    {       async: true
                        ,   success: callback
                        ,   dataType: 'json'
                }, data );

            }


            /**
            * Shows a global notification whith a message and a icon of success or failure
            *
            * @param { string text } ( Message to be displayed )
            * @param { string link } ( Link not currently used )
            * @param { string type } ( Success or failure )
            */
        ,   showGlobalNotification: function( text, link, type, callback, timeout ) {

                var gNotification = '.global-notifications'
                ,   message = '.message'
                ,   messageType = '.type'
                ,   icon = '.global-notification-icon'

                // Set the message
                $( gNotification ).find( message ).html( text )

                    // Clean the icon and global notification
                    .end().find( icon ).removeClass( 'icon-ok icon-remove icon-spinner' )
                    .end().removeClass( 'failure loading' );

                // Set icon
                if ( type === 'success' ) { }
                else if ( type === 'failure' ) {
                    $( gNotification ).addClass( 'failure' );
                }

                else if ( type === 'loading' ) {
                    $( gNotification ).find( icon ).addClass( 'icon-spinner' )
                    .end().addClass( 'loading' );
                }

                // Center the global notification to the middle of the screen
                var windowWidth = $( window ).width()
                ,   windowHalf = windowWidth / 2
                ,   notificationHalf = $( gNotification ).width() / 2
                ,   notificationLeft = windowHalf - notificationHalf;


                // Show notification
                $( gNotification ).css( 'left', notificationLeft + 'px' )
                    .show();

            }

            /**
            * Show a global notification.
            *
            * @param { str } Notification text.
            * @param { str } type of notification.
            * @param { int } Duration
            */
        ,   alert: function( text, type, callback, timeout ) {

                $( '.global-notifications.init' ).remove();

                timeout = ( timeout ) ? timeout : 4000;
                var fn = callback || null;

                if ( typeof type == 'undefined' ) type = 'success';
                return this.showGlobalNotification( text, '', type, fn, timeout );

            }

            /**
             * Close the global notification
             *
             * @param { fn } Callback
             * @return { void }
             */
        ,   closeAlert: function( fn ) {

                var gNotification = '.global-notifications';

                $( gNotification ).hide();
                if ( typeof fn == 'function' )  {
                    fn();
                }

            }

            // Create the thumbnail for the uploaded images
        ,   createImageThumb: function( imgPath, id ) {

                if ( imgPath == null ) {
                    imgPath = '';
                }

                var thumbsContainer = $( '#bp-smt-img-dragger' )
                ,   bpImageTemplate = "<div class='bp-smt-uploads-image-item item-number-" + id + "'>" +
                                        "<img src='" + imgPath +  "'>" +
                                        "<div class='bp-smt-uploads-image-loader'>" +
                                            "<div class='bp-smt-uploads-image-progress'></div>" +
                                        "</div>" +
                                     "</div>"
                ,   preview = $( bpImageTemplate )

                ,   previewImage = $( 'img', preview )

                // Define image width and height
                previewImage.width = 80
                previewImage.height = 70

                // Append the preview to the dropbox-> bpImagesDragger
                preview.appendTo( thumbsContainer );

                return preview;
            }

            /**
            * Checks whether the response happens to be an error
            * based on the status
            *
            * @param { object } ajax response object
            * @return { bool }
            */
        ,   isAjaxError: function( data ) {
                return data.status != 200;

                // if ( data.status == 200 ) {
                    // return false;
                // }
                // else {
                    // return true;
                // }

            }

        ,   refreshPage: function() {

                location.reload( true );
            }


        ,   popover: function( e, placement, elClass, content, title ) {

                var target = e.currentTarget
                ,   popoverBox = '<div class="popover ' + placement + ' popover-bppl ' + elClass + '"></div>'
                ,   popover = '.popover-bppl'
                ,   arrow = '<div class="arrow"></div>'
                ,   setTitle = '<h3 class="popover-title">' + title + '</h3>'
                ,   setContent = '<div class="popover-content">' + content + '</div>';

                // Popover
                $( target ).append( popoverBox );

                // Popover markup constructor
                if ( title )
                    $( popover )
                        .html( arrow + setTitle + setContent );
                else
                    $( popover )
                        .html( arrow + setContent );

                $( popover ).show();
            }

        /*
            =================
                Slideshow
            =================
        */

        ,   slideShow: function ( main , list , sizeHeight ) {

            var slideCount = $( list ).length
            ,   slideWidth = $( list ).width()
            ,   slideHeight = $( list ).height() + ( sizeHeight )
            ,   sliderUlWidth = ( slideCount * slideWidth );

            $( main ).css({ width: sliderUlWidth, height: slideHeight, marginLeft: - slideWidth });
            $( main ).css({ marginLeft: 0 });

            // $( list + ':last-child' ).prependTo( main );

        }

        ,   moveLeft: function ( e, slider ) {

                if ( e && e != null ) {
                    e.preventDefault();
                }

                // Remove the class into all sliders on the same page
                $( '.bp-slider' ).removeClass( 'current-slider' );

                // Assign variables
                var wrapper;

                if ( ! slider ) {

                    wrapper = $( 'a[data-action="true"]' ).parent().next().children();

                    wrapper.addClass( 'current-slider' );

                    $( wrapper ).animate({

                        left: - $( '.current-slider ul' ).width()
                    }, 200, function () {

                        $( '.current-slider ul:first-child' ).appendTo( wrapper );
                        $( wrapper ).css( 'left', '' );
                    });
                }
                else {

                    wrapper = slider;

                    // make the animation
                    $( wrapper ).animate({

                        left: - $( wrapper + ' ul' ).width()
                    }, 200, 'swing', function () {

                        $( wrapper + ' ul:first-child' ).appendTo( wrapper );
                        $( wrapper ).css( 'left', '' );

                        // Loading off ...
                        $( '.sc-position-next' ).removeClass( 'disabled' );
                    });
                }
            }

        ,   moveRight: function ( e, slider ) {

                if ( e && e != null ) {
                    e.preventDefault();
                }

                // Remove the class into all sliders on the same page
                $( '.bp-slider' ).removeClass( 'current-slider' );

                // Assign variables
                var wrapper;

                if ( ! slider ) {

                    wrapper = $( 'a[data-action="true"]' ).parent().next().children();

                    wrapper.addClass( 'current-slider' );

                    $( wrapper ).animate({

                        left: + $( '.current-slider ul' ).width()
                    }, 200, function () {

                        $( '.current-slider ul:last-child' ).prependTo( wrapper );
                        $( wrapper ).css( 'left', '' );
                    });
                }
                else {

                    wrapper = slider;

                    // pass last child and set css left property
                    $( wrapper + ' ul:last-child' ).prependTo( wrapper );
                    $( wrapper ).css( 'left', -$( wrapper + ' ul' ).width() );

                    // make the animation
                    $( wrapper ).animate({

                        // left: + $( wrapper + ' ul' ).width()
                        left: 0
                    }, 200, 'swing', function () {

                        // $( wrapper + ' ul:last-child' ).prependTo( wrapper );
                        // $( wrapper ).css( 'left', '' );
                    });
                }

            }


            /* Curators */

             ,   slideShowPlay: function ( main , list ) {

                var slideCount = $( list ).length
                ,   slideWidth = $( list ).width()
                ,   slideHeight = $( list ).height() + 10
                ,   sliderUlWidth = slideCount * slideWidth
                ,   timer;

                $( main ).css({ width: slideWidth, height: slideHeight });

                $( main ).css({ width: sliderUlWidth, marginLeft: - slideWidth });
                $( main ).css({ marginLeft: 0 });

                $( list + ':last-child' ).prependTo( main );

            }

        ,   moveLeftPlay: function( e , container , lists ) {

                if ( e ) {
                    e.preventDefault();
                    if ( typeof timer != 'undefined' )
                        clearInterval( timer );
                }

                $( container ).animate({

                    left: + $( lists ).width()
                }, 200, function () {

                    $( lists + ':first-child' ).appendTo( container );
                    $( container ).css( 'left', '' );
                });
            }

        ,   moveRightPlay: function ( e , container , lists ) {

                if ( e ) {
                    e.preventDefault();
                    if ( typeof timer != 'undefined' )
                        clearInterval( timer );
                }
                $( '.sc-slider' ).animate({

                    left: - $( '.sc-slider ul' ).width()
                }, 200, function () {

                    $( '.sc-slider ul:last-child' ).prependTo( '.sc-slider' );
                    $( '.sc-slider' ).css( 'left', '' );
                });
            }

        ,   sliderAutoPlay: function ( ) {

                timer = setInterval( this.moveRightPlay, 5000 );

            }

        /*
            =====================
                End Slideshow
            =====================
        */

            /**
             * Use this method to creating tooltips on bppl
             * @param  { ev } e  event passed
             * @param  { str } placement Position for the triangle
             * @param  { str } elClass   The class added to the tooltip
             * @param  { str } content   Your content
             * @return { void }
             */
        ,   tooltip: function( e, placement, elClass, content ) {

                var target = e.currentTarget
                ,   tooltipBox = '<div class="popover ' + placement + ' tooltip-bppl ' + elClass + '"></div>'
                ,   tooltip = '.tooltip-bppl'
                ,   arrow = '<div class="arrow"></div>'
                ,   setContent = '<div class="popover-content">' + content + '</div>';

                if ( $( '.' + elClass ).length >= 1 ) return;

                // tooltip
                $( target ).parent().append( tooltipBox );

                // tooltip markup constructor
                $( tooltip )
                    .html( arrow + setContent );

                $( tooltip ).show();
            }

            /**
            * Converts a cammelcased string to underscore one
            */
        ,   cammelCaseToUnderscore: function( string ) {

                return string.replace( /([A-Z])/g, function( $1 ) {

                    return "_" + $1 . toLowerCase();
                });
            }

            /**
            * Converts a cammelcased string to a spaced one.
            * `sampleStringHere` => `sample string here`
            */
        ,   cammelCaseToSpace: function( string ) {

                return string.replace( /([A-Z])/g, function( $1 ) {
                    return " " + $1 . toLowerCase();
                });
            }

            /**
            * Converts a cammelcased string to dashed one one
            * `sampleString`, `sample-string`
            */
        ,   cammelCaseToHyphen: function( string ) {

                return string.replace( /([A-Z])/g, function( $1 ) {

                    return "-" + $1 . toLowerCase();
                });
            }

            /**
            * Converts a dashed string `sample-string` to a
            * cammelcased one ``
            */
        ,   hyphenToCamelCase: function( string ) {

                return string.replace( /([-][a-z])/g, function( $1 ) {

                    return $1[ 1 ] . toUpperCase();
                });
            }

            /**
            * Converts hiphens to underscores
            */
        ,   hyphenToUnderscore: function( string ) {
                return string.replace( /([-])/g, function( $1 ) {

                    return "_";

                });
            }


            /**
            * Parses the content of a file and adds the nofollow rel to
            * all the links in the content
            */
        ,   parseAddNoFollow: function( string ) {

                return string.replace( /<a[^>]/g, function( $1 ) {

                    return '<a rel="nofollow" ';
                });
            }

            /**
            * Replaces spaces for hyphens
            * @param { string }
            */
        ,   spacesToHyphen: function( string ) {

                return string.replace( / /g, function( $1 ) {

                    return '-';
                });

            }

            /**
            * Replaces hyphes with spaces
            * @param { string }
            */
        ,   hyphenToSpace: function( string ) {

                 return string.replace( /([-])/g, function( $1 ) {

                    return " ";

                });
            }


            // Capitalizes a string
        ,   capitalize: function( str ) {

                str = str == null ? '' : String( str );
                return str.charAt( 0 ).toUpperCase() + str.slice( 1 );
            }

            // Title cases a string
        ,   titleize: function( str ) {

                if ( str == null ) return;

                str = String( str ).toLowerCase();
                return str.replace( /(?:^|\s|-)\S/g, function( c ) {
                    return c.toUpperCase();
                });

            }

            /**
            * Validate an string with te correct email format and
            * return false if it doesn't match
            */
        ,   validateEmailFormat: function( string ) {

                return this.isEmail( string );
            }

            /**
            * Check whether an string is a correct email
            * @param { str } String to test
            * @return { bool }
            */
        ,   isEmail: function( string ) {

                var emailExpression = /^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;

                return emailExpression.test( string );
            }

            /**
            * Check whether an string is a correct email
            * @param { str } String to test
            * @return { bool }
            */
        ,   isUrl: function( string ) {

                // var urlExpression = /^(ftp|http|https):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i;
                var urlExpression = /(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i;

                return urlExpression.test( string );
            }

            /**
            * Given an array of required fields, this function
            * checks whether the second argument have them
            */
        ,   validateEmptyFields: function( required, objectData, errors ) {

                $.each( required, function( key, value ) {

                    if ( objectData[ value ] == null || objectData[ value ] == "" ) {

                        errors.push( value );

                    }

                });

                return errors;

            }


            /**
            * Extract an object from form fields
            */
        ,   formToObject: function( formSelector, dropEmpty, convertCases ) {

                var object = {}
                ,   _this = this;

                if( convertCases == null || typeof convertCases == 'undefined' ) {
                    convertCases = true;
                }

                $( formSelector + ' :input' ).each(function() {

                    var idInput = $( this ).attr( 'id' )
                    ,   typeInput = $( this ).attr( 'type' )
                    ,   nameAttr = idInput;

                    // Convert the id to javascript variable format
                    if( convertCases && typeof idInput != 'undefined' ){
                        nameAttr = _this.hyphenToCamelCase( nameAttr );
                    }

                    // Validate the type of the element
                    switch ( typeInput ) {

                        case 'text':
                            object[ nameAttr ] = $( this ).val();
                            break;

                        case 'password':
                            object[ nameAttr ] = $( this ).val();
                            break;

                        case 'checkbox':
                            object[ nameAttr ] = $( this ).is( ':checked' );
                            break;

                        case 'radio':
                            nameAttr = $( this ).attr( 'name' );
                            nameAttr = _this.hyphenToCamelCase( nameAttr );
                            if( $( this ).is( ':checked' ) )
                                object[ nameAttr ] = $( this ).val();
                            break;
                    }

                });

                // get the text areas
                $( formSelector + ' textarea' ).each( function(){

                    var nameAttr = $( this ).data( 'name' );

                    if( convertCases ) {
                       nameAttr = _this.hyphenToCamelCase( nameAttr );
                    }

                    object[ nameAttr ] = $( this ).val();

                });


                // Drop empty attributes
                if( dropEmpty ) {

                    $.each( object, function( key, value ) {

                        if( object[ key ] == '' ) {

                            delete object[ key ];
                        }
                    });
                }


                return object;

            }


            /**
            * Removes the mce-data-href from a string
            */
        ,   removeMceHrefAttr: function( string ) {

                return string.replace( /data-mce-href="([^"]*)/g, function( $1 ) {

                    return '';

                });

            }

            /**
            * Turns an element fixed, receives four parameters and places the element
            * passed fixed at the specified topPosition.
            *
            * <code>
            *
            *       // Turn an element fixed at 390 pixels.
            *       utilities.turnFixed( 118, 100, 390, '.selector' );
            *
            * </code>
            *
            * @param { int } Position in which to leave the element when fixed
            * @param { int } left position in which to leave the element when fixed
            * @param { int } scrollTop size in which the element gets fixes
            * @param { string } element selector
            */
        ,   turnFixed: function( topPos, leftPos, fixedAt, selector ) {

                var scrollTop;

                // Bind to scroll event
                $( window ).scroll( function() {

                    scrollTop = $( window ).scrollTop();

                    if ( scrollTop >= fixedAt ) {
                        $( selector ).css({
                                'position': 'fixed'
                            ,   'top': topPos
                        });
                    }

                    else {
                        $( selector ).css({
                                'position': ''
                            ,   'top': ''
                        });
                    }

                });

            }


            /**
            * Trigger a fn when scrollTop is lower than triggerAt
            * otherwise, trigger fn2.
            *
            * @param { int } Where to trigger the first function
            * @param { fn } Function to execute when scrolltop
            *               is greather or equal than the passed.
            * @param { fn } Function to trigger when scrolltop
            *               is lower than the passed.
            * @return { void }
            */
        ,   scrollTopCallback: function( triggerAt, fn, fn2 ) {

                var scrollTop;

                // Bind to scroll event
                $( window ).scroll( function() {

                    scrollTop = $( window ).scrollTop();
                    if ( scrollTop >= triggerAt ) { fn(); }
                    else { fn2(); }

                });

            }

            /**
            * Maps form inputs generated when using serializeArray();
            * pusshes them to an array in a key( name ) value( value ) structure
            *
            * @param { array } serializeArray() generated array
            * @return { array } mapped array
            */
        ,   mapFormInputs: function( data, type, dropEmpty ) {

                var formData = type || []
                ,   _this = this;

                $.each( data, function( key, val ) {

                    replaced = _this.hyphenToUnderscore( val.name );

                    if ( dropEmpty ) {

                        if ( val.value != "" ) {
                            formData[ replaced ] = val.value;
                        }

                    }

                    else {
                        formData[ replaced ] = val.value;
                    }

                });

                return formData;

            }


            // Handle global notification closing
        ,   handleGlobalNotificationClose: function() {

                var wrapper = '.global-notifications'
                ,   message = '.message'
                ,   success = '.icon-ok'
                ,   failure = '.icon-bell'
                ,   closeBtn = '.global-notifications-close';

                $( document ).mouseup( function( e ) {

                    if ( $( wrapper ).has( e.target ).length === 0 ) {
                        $( wrapper ).hide()
                            .find( message ).text( '' ).end()
                            .find( success + ', ' + failure ).hide().end()
                            .css({ 'top': '', 'margin-left': '' })
                            .removeClass( 'centered' );

                    }

                });

                // CLose Button
                $( closeBtn ).click( function( e ) {

                    $( wrapper ).hide();
                        $( wrapper ).find( message ).text( '' ).end()
                            .find( success + ', ' + failure ).hide().end()
                            .css({ 'top': '', 'margin-left': '' })
                            .removeClass( 'centered' );

                });


            }


            // Hides an element when it is clicked outside
            //
            // @param { string } string for the jQuery selector like: ".my-class"
            // @return { null }
        ,   closeOnClickOut: function( selector, callback ) {

                $( document ).mouseup( function( e ) {

                    if ( ! $( selector ).is( ":visible" ) ) {
                        return;
                    }

                    if ( $( selector ).has( e.target ).length === 0 ) {

                        if ( callback != null ) {
                            callback.call();
                        }

                    }

                });

            }


            // Checks whether the passed element has the passed role
        ,   isRole: function( element, role ) {

                var elemRole = $( element ).data( "role" );

                if ( elemRole == role ) {
                    return true;
                }

                return false;

            }

            /*
            * Sanitizes the editor content so that it can be
            * better compared with the original
            *
            * @param { string } content to sanitize
            * @return { string } sanitized content
            */
        ,   sanitizeForkContent: function( string ) {

                return string.replace( /[&]nbsp[;]/gi, function( $1 ) {

                    return " ";

                });

            }

        ,   isTagAddedYet: function( collection, item ) {

                if ( collection.length > 0 ) {

                    if( $.inArray( item, collection ) != -1 ) {

                        this.showGlobalNotification( 'This tag was added previously','', 'failure', null, 3000 );
                        return true;
                    }
                }

                return false;

            }


            /**
            * Clears the inputs of a form
            * @param { object } Selector object for the form
            */
        ,   clearForm: function( form ) {

                $( form ).find( "input:text, input:password, input:file, select, textarea" ).val( '' );
                $( form ).find( "input:radio, input:checkbox" )
                    .removeAttr( "checked" ).removeAttr( "selected" );

            }

            /**
            * Gets the form data
            * @param { obj || str } form object or selector
            * @return { obj } mapped form
            */
        ,   getFormData: function( form, dropEmpty ) {

                var data, off, name
                ,   _this = this;

                if ( dropEmpty == null ) {
                    dropEmpty = true;
                }

                data = $( form ).serializeArray();
                data = this.mapFormInputs( data, {}, dropEmpty );

                $.each( data, function( key, value ) {
                    if ( value == "on" ) {
                        data[ key ] = true;
                    }
                });

                // Check for empty values
                $( form ).find( "input[ type=checkbox ]" ).each( function() {
                    if ( ! $( this ).is( ":checked" ) ) {

                        name = $( this ).attr( "name" );

                        // Continue to the next iteration
                        if ( ! name ) return;
                        name = _this.hyphenToUnderscore( name );

                        // Unchecked
                        off = $( this ).data( 'off' );

                        if ( typeof off != 'undefined' ) {
                            data[ name ] = off;

                        } else {
                            data[ name ] = false;
                        }

                    }

                });

                return data;

            }


                /**
                * Add useful atributes to the Date class
                */
            ,   protoMonthsNames: function() {

                    // Prototype Date function
                    Date.prototype.getMonthName = function() {
                        return Date.monthsNames[ this.getMonth() ];
                    };

                    Date.prototype.getMonthNameShort = function() {
                        return Date.monthsNamesShort[ this.getMonth() ];
                    }

                    // Add month names
                    Date.monthsNames = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
                    Date.monthsNamesShort = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];

                }

                /*
                * Cheks whether an string is empty
                *
                * @param { string } string to test
                * @return { bool }
                */
            ,   isEmptyString: function( string ) {

                    // var filter=/^[0-9A-Za-z][A-Za-z0-9_.-]*@[A-Za-z0-9_-]+\.[A-Za-z0-9_.]+[A-za-z]$/;

                }

                /**
                * Adds trim method to the string object
                * if it does not have it
                */
            ,   handleStringTrim: function() {

                    if ( ! ( 'trim' in String.prototype ) ) {
                        String.prototype.trim = function() {
                            return this.replace( /^\s+/, '' ).replace( /\s+$/, '' );
                        };
                    }

                }

                /**
                * Opens a new window in the passed url
                */
            ,   openWindow: function( url, width, height ) {

                    var width = 575
                        height = 400;

                    options = 'status=1'
                            + ',width=' + width
                            + ',height=' + height
                            + ',top='+ ( $( window ).height() - height ) / 2
                            + ',left='+ ( $( window ).width() - width ) /2;

                    window.open( url, 'twitter', options);

                    return false;

                }

                /**
                * Removes an element from an array and
                * Splice it out.
                */
            ,   remove: function( array, item ) {

                    var index = array.indexOf( item );

                    if ( index == -1 ) {
                        return false;
                    }

                    // Delete
                    delete array[ index ];
                    array.splice( index, 1 );

                    return array;
                }

                /**
                * Removes an element from an array if present
                * otherwise, removes it.
                *
                * Remove by ID
                */
            ,   toggle: function( array, item ) {

                    var item = JSON.stringify( item );
                    $.each( array, function( key, val ) {
                        array[ key ] = JSON.stringify( val );
                    });

                    var index = array.indexOf( item );
                    if ( index == -1 ) {
                        array.push( item );
                    }

                    else {
                        array = this.remove( array, item );
                    }

                    // Return affected array
                    $.each( array, function( key, val ) {
                        array[ key ] = JSON.parse( val );
                    });

                    return array;

                }


                // All treatment for modal window
            ,   toggleModal: function() {

                    var toggle = '.toggle-modal'
                    ,   backdrop = '.modal-backdrop';

                    $( document ).on( 'click', toggle, function( e ) {
                        e.preventDefault();

                        $( '.register-form' ).addClass( 'active' ); // !!!! make proofs

                        var selector = $( this ).data( 'modal' );

                        $( selector ).toggle();

                        // Reset the event stated in the hidden input `event`
                        // of the forms which is used to trigger such event
                        // when form operation ends.
                        $( selector ).find( 'input[name="event"]' )
                            .each( function() {
                                $( this ).attr( 'value', '' );
                            });

                        $( backdrop ).toggle();

                        if ( $( '#login-form' ).length >= 1 )
                            window.Bppl.Helpers.Utilities.removeDataAttributes( '#login-form' );

                    });

                    $( backdrop ).click( function( e ) {

                        e.preventDefault();

                        $( this ).hide();
                        $( '.modal' ).hide();
                    });

                    $( document ).keyup( function( e ) {

                        if( e.keyCode == 27 ) {

                            $( '.modal-backdrop' ).hide();
                            $( '.modal, .sb-smt-overlay' ).hide();
                            $( '.mt-modal' ).removeClass( 'is-visible' );
                            $( '.background-main-menu, .container-1200, .navbar' ).removeClass( 'mt-blurred' );
                        }
                    });
                }

            ,   materialModal: function() {

                    // $( '.register-form' ).addClass( 'active' ); // !!!! make proofs

                    // $( '.login-modal' ).click( function() {

                    // });

                    $( '.mt-modal .close, .mt-modal .close-cancel, .modal-backdrop, .search-modal .close' ).live( 'click', function( e ){
                        $( '.mt-modal' ).removeClass( 'is-visible' );
                        $( '.background-main-menu, .container-1200' ).removeClass( 'mt-blurred' );
                        $( '.overlay-search.in-photo-single, .overlay-search.in-photos' ).removeClass( 'hidden' );
                        $( '.navbar, .background-main-menu, .container-1200' ).removeClass( 'mt-blurred' );
                        $( '.feats' ).removeClass( 'active' );

                        // Use on social login
                        delete localStorage.dwnLink;
                    });

                    $( '.mt-btn, .premium-feature' ).live( 'click', function( e ) {

                        if ( $( e.currentTarget ).hasClass( 'premium-feature' ) )
                            e.preventDefault();

                        var dataModal = $( this ).data( 'modal' );
                        // console.log( dataModal );

                        $( '.mt-modal' ).removeClass( 'is-visible' ).hide();
                        $( '.overlay-search, .search-modal' ).removeClass( 'active' ).hide();
                        $( '.background-main-menu, .container-1200' ).removeClass( 'mt-blurred' );

                        if ( $( dataModal ).hasClass( 'is-visible' ) ) {
                            $( dataModal ).removeClass( 'is-visible' ).hide();
                            if ( dataModal == '.modal-photo-download' )
                                $( '.navbar, .background-main-menu, .container-1200' ).removeClass( 'mt-blurred' );
                            else
                                $( '.background-main-menu, .container-1200' ).removeClass( 'mt-blurred' );
                        } else {
                            $( dataModal ).addClass( 'is-visible' ).show();
                            if ( dataModal == '.modal-photo-download' )
                                $( '.navbar, .background-main-menu, .container-1200' ).addClass( 'mt-blurred' );
                            else
                                $( '.background-main-menu, .container-1200' ).addClass( 'mt-blurred' );
                        }

                        return false;
                    });

                    $( '.download-resource' ).live( 'click', function() {
                        $( '.modal-sharing-both' ).addClass( 'is-visible' ).show();
                        $( '.background-main-menu, .container-1200' ).addClass( 'mt-blurred' );
                        $( '.overlay-search.in-photo-single, .overlay-search.in-photos' ).addClass( 'hidden' );
                        $( '.modal-backdrop' ).addClass( 'hide' );
                    });

                    $( '.register-area #forgot-password' ).hide();

                    $( '.mt-modal .register' ).live( 'click', function() {

                        // $( '#login-form' ).addClass( 'hidden' );
                        $( '.social-area, .mt-modal .register-area' ).toggle();
                        $( '.forgot-btn, .register-area #register, .text-resgiter' ).show();
                        $( '.register-area #forgot-password, .text-forget' ).hide();
                    });

                    // coarse mode
                    $( '.mt-modal .cancel-down' ).live( 'click', function() {

                        // $( '#login-form' ).addClass( 'hidden' );
                        $( '.modal-sharing-both' ).find( '.social-area' ).show();
                        $( '.modal-sharing-both' ).find( '.forgot-btn, .register-area #register, .text-resgiter' ).show();
                        $( '.modal-sharing-both' ).find( '.register-area, .register-area #forgot-password, .text-forget' ).hide();
                        $( '.modal-sharing-both' ).find( '.login-area' ).addClass( 'hidden' );
                    });

                     $( '.mt-modal .register-down' ).live( 'click', function() {

                        // $( '#login-form' ).addClass( 'hidden' );
                        $( '.modal-sharing-both' ).find( '.social-area' ).hide();
                        $( '.modal-sharing-both' ).find( '.register-area, .forgot-btn, .register-area #register, .text-resgiter' ).show();
                        $( '.modal-sharing-both' ).find( '.register-area #forgot-password, .text-forget' ).hide();
                        $( '.modal-sharing-both' ).find( '.login-area' ).addClass( 'hidden' );
                    });


                    $( '.mt-modal .login-down' ).live( 'click', function() {

                        // $( '#login-form' ).addClass( 'hidden' );
                        $( '.modal-sharing-both' ).find( '.social-area, .register-area' ).hide();
                        $( '.modal-sharing-both' ).find( '.register-area #register, .text-resgiter' ).hide();
                        $( '.modal-sharing-both' ).find( '.forgot-btn, .register-area #forgot-password, .text-forget' ).show();
                        $( '.modal-sharing-both' ).find( '.login-area' ).removeClass( 'hidden' ).show();

                    });

                    $( '.forgot-btn-down' ).live( 'click', function() {
                        $( '.modal-sharing-both' ).find( '.forgot-btn, .register-area #register, .social-area, .text-resgiter' ).hide();
                        $( '.modal-sharing-both' ).find( '.register-area, .register-area #forgot-password, .text-forget' ).show();
                        $( '.modal-sharing-both' ).find( '.login-area' ).addClass( 'hidden' );
                    });

                    $( '.forgot-btn' ).live( 'click', function() {

                        $( '.forgot-btn, .register-area #register, .social-area, .text-resgiter' ).hide();
                        $( '.register-area, .register-area #forgot-password, .text-forget' ).show();
                    });

                    $( '.forgot-btn-mobile' ).live( 'click', function() {

                        $( '.login-area' ).hide();
                        $( '.register-area, .register-area #forgot-password, .text-forget' ).show();
                    });

                }

                // Open a modal
            ,   openModal: function( selector ) {

                    if ( selector != '.modal-sharing-both' ) {
                        $( selector ).toggle();
                        $( '.modal-backdrop' ).toggle();
                    }

                }

                // Calls the passed method with the
                // specified context
            ,   bind: function( fn, context ) {

                    return function() {
                        return fn.apply( context, arguments );
                    }

                }


                // Prevent the backspace key from navigating back.
            ,   preventBackBrowser: function() {

                    $( document ).keydown( function( e ){
                        if ( e.keyCode == 8 && e.target.tagName != 'INPUT' && e.target.tagName != 'TEXTAREA' ) {
                            e.preventDefault();
                        }
                    });
                }



                // Get the true hash value. Cannot use location.hash directly due to bug
                // in firefox where location.hash will always be decoded.
                // Adapted from backbone.
            ,   getHash: function() {

                    var match = window.location.href.match( /(.*)$/ );
                    return match ? match[ 1 ] : '';
                }

                // Get normalized URL path without slash at the beginning.
                //
                //      // When URL is: ".com/wordpress/page/1", this method
                //      // will return "wordpress/page/1"
                //      var path = Utilities.getPath();
                //
            ,   getPath: function() {

                    var routeStripper = /^[#\/]|\s+$/g;

                    return History.getState().hash.replace( routeStripper, '' );
                }

                // Update URL path using `pushState`.
                //
                //      // Will set the URL to ".com/wordpress/page/1"
                //      utilities.updatePath( 'wordpress/page/1' );
                //
                //
            ,   updatePath: function( fragment ) {

                    History.pushState( {}, null, '/' + fragment ); // window.location.origin before '/'
                }


                // Time ago to show the time live
            ,   timeAgo: function() {

                    $( "abbr.time-ago" ).timeago();
                }


                // Update the hash location by updating the current entry to
                // the browser history.
                // Adapted from backbone `_updateHash`.
                //
                // @param { string } hash to set
            ,   updateHash: function( fragment ) {

                    var location = window.location;
                    var href = location.href.replace( /(javascript:|#).*$/, '' );

                    location.replace( href + '#' + fragment );

                }

                // Set data-src to src on images in a list
            ,   setImageUrl: function( selector ) {

                    $.each( $( selector + ' img' ), function( key, image ) {

                        var dataSrc = $( image ).data( 'src' );

                        $( image ).attr( 'src', dataSrc );

                    });
                }


                // Pluralize a string.
                //
                // @param { int }
                // @param { string }
            ,   pluralize: function( count, singular, plural ) {

                    if ( plural == null )
                    plural = singular + 's';

                    return ( count == 1 ? singular : plural );
                }


                /**
                * Return a rendered template
                *
                * <code>
                *
                *       // Get template HTML.
                *       var html = utilities.render( 'person', { 'name': 'John' } );
                *
                *       // Use HTML.
                *       $( '.target' ).append( html );
                *
                * </code>
                *
                * @param { str } Template name
                * @param { obj } View object
                * @return { str } Rendered view
                */
            ,   render: function( templateName, data ) {

                    var template = this.mustacheCache[ templateName ]
                    ,   _this = this;

                    if ( ! template ) {

                        $.ajax({
                                url: window.Constants.JSTemplates + templateName + '.mustache'
                            ,   async: false
                            ,   type: 'get'
                            ,   data: null
                            ,   dataType: 'text'
                            ,   success: function( data )  {
                                    template = _this.mustacheCache[ templateName ] = data ;
                                }
                        });

                    }

                    return Mustache.to_html( template, data );
                }

                /**
                 * Get data from tag and return an object
                 * with underscored attribute names
                 *
                 * <code>
                 *
                 *       // Get clicked element data passing
                 *       // "event" as parameter.
                 *       var data = utilities.data( e );
                 *
                 * </code>
                 *
                 * @param { obj } "e" event from click
                 * @return { obj } underscored tag data object
                 */
            ,   data: function( e ) {

                    var target = e.currentTarget
                    ,   _this = this
                    ,   data = $( target ).data()
                    ,   clone = {};

                    $.each( data, function ( k, v ) {
                        clone[ _this.cammelCaseToUnderscore( k ) ] = v;
                    });

                    return clone;
                }

                /**
                 * Shorten a string
                 *
                 * <code>
                 *
                 *     // Return "This..."
                 *     utilities.limit( 'This is a very long string', 4 );
                 *
                 * </code>
                 */
            ,   limit: function( string, limit, end ) {

                    if ( typeof end != 'string' ) {
                        end = '...';
                    }

                    if ( typeof string != 'string' )
                        return;

                    if ( string.length <= limit ) {
                        return string;
                    }

                    return string.substring( 0, limit ) + end;

                }

                // Return the passed number of words
            ,   words: function( string, words, end ) {

                    if ( typeof end != 'string' ) {
                        end = '...';
                    }

                    if ( typeof string != 'string' ) {
                        return false;
                    }

                    var parsed = string.split( ' ' ).slice( 0, words ).join( ' ' );

                    if ( parsed.length < string.length )
                        return parsed + end;

                    return parsed;

                }

                // Wrapper on top of console.log, to prevent compatibility
                // issues when on IE
            ,   log: function() {

                    var args = arguments
                    ,   sliced;

                    if ( typeof console === "object" && typeof console.log === "function" ) {

                        sliced = Array.prototype.slice.call( args );

                        // Print using console
                        console.log.apply( console, args );
                    }

                }


                // Checks whether a form is loading
            ,   isWorking: function( sel ) {

                    var tagName = $( sel ).prop( 'tagName' )
                    ,   el = tagName == 'a' ? $( 'el' )
                            : $( sel ).find( 'input[type="submit"]' );

                    return el.hasClass( 'working' );
                }

                // Add loading state to the form
            ,   startWorking: function( sel ) {

                    var tagName = $( sel ).prop( 'tagName' )
                    ,   el, target, originalText, workingText = 'Working...'
                    ,   submitTrigger = 'input[name="submit-trigger"]'
                    ,   defaultSubmit = 'input[type="submit"]';

                    switch( tagName ) {

                        case 'A':
                            el = $( sel );
                            originalText = el.html();
                            break;

                        case 'FORM':
                            target = $( sel ).find( submitTrigger ).val();
                            el = target == 'undefined' ?
                                $( sel ).find( defaultSubmit ):
                                $( sel ).find( 'input[name="' + target + '"]' );
                            originalText = el.val();
                            break;
                    }
                    // Save attribute
                    el.attr( 'data-original-text', originalText );
                    tagName == 'FORM' ? $( el ).val( workingText )
                        : $( el ).text( workingText );

                    $( el ).addClass( 'clicked' );
                    $( el ).addClass( 'disabled' );

                }

                // Releases the working state
            ,   stopWorking: function( sel, original_text ) {

                    var tagName = $( sel ).prop( 'tagName' )
                    ,   el = tagName == 'A' ? $( sel ) : $( sel ).find( 'input[type="submit"].clicked' );

                    if ( original_text )
                        var originalText = original_text;
                    else
                        var originalText = el.data( 'original-text' );

                    // Restart text
                    el.removeClass( 'disabled' );
                    tagName == 'FORM' ? el.val( originalText )
                        : el.html( originalText );


                }

                // Form submit
            ,   formSubmit: function( e ) {

                    var input = 'form input[type="submit"]'
                    ,   className;

                    // Add hidden input after submit button
                    $( document ).on( 'click', input, function( e ) {

                        className = $( this ).attr( 'name' );
                        $( this ).after( '<input type="hidden" name="submit-trigger" value="' + className + '">' );
                    });

                }

                // Load twitter script if hasn't been loaded yet
            ,   loadTwitter: function() {

                    if ( typeof ( twttr ) != 'undefined' ) {

                        twttr.widgets.load();
                    }

                }


                // Load Google Plus script
            ,   loadGooglePlus: function() {

                    if ( typeof ( gapi ) != 'undefined' ) {

                        $( ".g-plusone" ).each( function () {
                            gapi.plusone.render( $( this ).get( 0 ) );
                        });
                    }
                }

                // Load pinterest script.
                // It doesn't check whether the script has already been loaded.
            ,   loadPinterest: function() {

                    $.getScript( '//assets.pinterest.com/js/pinit.js' );
                }

            ,   loadFacebook: function() {

                    if ( typeof ( FB ) != 'undefined' ) {

                        FB.init({ status: true, cookie: true, xfbml: true });
                    }

                }

                // Load bootstrap script.
                // It doesn't check whether the script has already been loaded.
            ,   loadBootstrap: function() {

                    $.getScript( '//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.js' );
                }

                // Close popover when they're clicked outside
            ,   handlePopoverClose: function() {

                    var popover = '.popover';
                    this.closeOnClickOut( popover );
                }

                /**
                 * Create cookie with javascript
                 *
                 * @param {string} name cookie name
                 * @param {string} value cookie value
                 * @param {int} days2expire
                 * @param {string} path
                 */
            ,   newCookie: function ( name, value, days2expire, path ) {

                    if ( typeof value === 'object' )
                        value = JSON.stringify( value );

                    if ( days2expire ) {

                        var date = new Date();
                        date.setTime( date.getTime() + ( days2expire * 24 * 60 * 60 * 1000 ) );
                        expires = date.toUTCString();
                    }

                    if ( typeof( days2expire ) === 'undefined' && typeof( path ) === 'undefined' )
                        document.cookie = name + '=' + value + ';'

                    else if ( typeof( path ) === 'undefined' ) {

                        document.cookie = name + '=' + value + ';' +
                        'expires=' + expires + ';'
                    }

                    else {

                        document.cookie = name + '=' + value + ';' +
                        'expires=' + expires + ';' +
                        'path=' + path + ';';
                    }
                }

                /**
                 * Check cookie with javascript
                 *
                 * @param {string} cname cookie name
                 */
            ,   chkCookie: function ( cname ) {

                    var cname = cname
                    ,   cookie = cname + "="
                    ,   cString = document.cookie.split( ';' )
                    ,   i, c;

                    for ( i = 0; i < cString.length; i++) {

                        c = cString[ i ];

                        while ( c.charAt( 0 ) == ' ' ) c = c.substring( 1, c.length );

                        if ( c.indexOf( cookie ) == 0 ) return c.substring( cookie.length, c.length );
                    }

                    return null;
                }

                /**
                 * Delete cookie with javascript
                 *
                 * @param {arr} cname cookie name
                 */
            ,   delCookie: function ( cname ) {

                    if ( cname.length < 1 )
                        var cname = [ 'bppl_user' ];
                    if ( cname.length == 1 )
                        var cname = [ cname ];

                    $.each( cname, function( index, value ) {
                        document.cookie = value + '=;expires=Thu, 01 Jan 1970 00:00:01 GMT;';
                    });
                }

                // Check timeStamp
            ,   addDays: function ( days ) {

                    var newDateObj = new Date();
                    newDateObj = newDateObj.getTime() + ( 1000 * 60 * 60 * 24 * days );
                    return newDateObj;
                }

                // Check timeStamp
            ,   addHours: function ( hours ) {

                    var newDateObj = new Date();
                    newDateObj = newDateObj.getTime() + ( 1000 * 60 * 60 * hours );
                    return newDateObj;
                }

                // Check timeStamp
            ,   addMins: function ( mins ) {

                    var newDateObj = new Date();
                    newDateObj = newDateObj.getTime() + ( 1000 * 60 * mins );
                    return newDateObj;
                }

                // Check timeStamp
            ,   addSecs: function ( secs ) {

                    var newDateObj = new Date();
                    newDateObj = newDateObj.getTime() + ( 1000 * secs )
                    return newDateObj;
                }

                // Countdown
            ,   CountdownTimer: function ( el ) {

                    $( el ).each( function() {
                        $( this ).countdown({
                                date: $( this ).data( 'time' ) + " 00:00:00"
                            ,    onEnd: function() {
                                    $( this ).html( 'The offer has expired' );
                                }
                        });
                    });
                }

                // Remove default text from `h3` on focus
            ,   emulatePlaceholder: function( e ) {

                    var target = e.currentTarget;

                    if ( $(  target ).data( 'cleaned' ) ) return;

                    // Add cleaned attribute and clean text
                    $( target ).attr( 'data-cleaned', 'true' )
                        .attr( 'data-original-text', $( target ).text() || $( target ).val() )
                        .text( '' ).val( '' );

                }

                // reset text ehwn data-clened isn't exist
            ,   resetPlaceholder: function ( e ) {

                    var target = e.currentTarget
                    ,   originalText = $( target ).data( 'original-text' );

                    if ( $( target ).text() != '' || $( target ).val() != '' ) return;

                    $( target ).removeAttr( 'data-cleaned' ).text( originalText ).val( originalText );
                }

                // Gallery show
            ,   bpGallery: function ( galleryClass ) {

                    var glide = $( galleryClass ).glide({
                        animationDuration: 1000
                    });

                }

            ,   downloadView: function () {

                    $( '.in-middle' ).animate({
                        bottom: '-200px',
                        opacity: 0
                    }, 3000, function() {
                        $( '.in-download' ).css( 'display', 'none' );
                        $( '.in-middle' ).css({
                                bottom: '0'
                            ,   opacity: 1
                        });
                    });
                }

                // Manage storage in Bppl
                /**
                 * [storageManager Use this method to manage sessionStorage or local storage with javascript]
                 * @param  { string } storage [local|session]
                 * @param  { string } type    [set|get]
                 * @param  { string } name    [key]
                 * @param  { string } value   [value]
                 * @return { avoid }
                 */
            ,   storageManager: function ( storage, type, name, value ) {

                    var storageTypeData = storage + 'Storage.' + name
                    ,   storageType = storage + 'Storage'
                    ,   val;

                    if ( type == 'set' ) {

                        if ( typeof value === 'object' ) {

                            value = JSON.stringify( value );
                            eval( storageType ).setItem( name, value );
                        }

                        else
                            eval( storageType ).setItem( name, value );
                    }

                    else
                        return eval( storageTypeData );


                }

                // insert data in elements
                /**
                 * [populateElement Insert data in any class or element]
                 * @param  { str } el   element(#id|.class)
                 * @param  { obj } data [data to insert]
                 * @return {[type]}      [description]
                 */
            ,   populateElement: function ( el, data ) {

                    // Assign data to form
                    $.each( data, function( k, v ) {

                        $( el ).attr( 'data-action-reference-' + k, v );
                    });

                }

                // delete vars in sessionStorage
                /**
                 * [deleteStorage Insert data in any class or element]
                 * @param  { arr } storage [ key ]
                 */
            ,   deleteVars: function ( storage ) {

                    // Assign data to form
                    $.each( storage, function( k, v ) {
                        console.log( eval( v ) );
                        delete v;
                    });

                }

                /**
                 * [removeDataAttributes description]
                 * @param  { str } target (id|class)
                 * @return {[type]}        [description]
                 */
            ,   removeDataAttributes: function ( target ) {

                    var i
                    ,   target = $( target )
                    ,   attrName
                    ,   dataAttrsToDelete = []
                    ,   dataAttrs = target.get( 0 ).attributes
                    ,   dataAttrsLen = dataAttrs.length

                    // loop through attributes and make a list of those
                    // that begin with 'data-'
                    for ( i = 0; i < dataAttrsLen; i++ ) {

                        if ( 'data-' === dataAttrs[ i ].name.substring( 0, 5 ) ) {

                            // Why don't you just delete the attributes here?
                            // Deleting an attribute changes the indices of the
                            // others wreaking havoc on the loop we are inside
                            // b/c dataAttrs is a NamedNodeMap (not an array or obj)
                            dataAttrsToDelete.push( dataAttrs[ i ].name );
                        }
                    }

                    // delete each of the attributes we found above
                    // i.e. those that start with "data-"
                    $.each( dataAttrsToDelete, function( index, attrName ) {
                        target.removeAttr( attrName );
                    });
                }

            ,   removeAttrsFromEl: function( regex ) {

                    return this.each( function() {
                        var $this = $( this )
                        ,   names = [];

                        $.each( this.attributes, function( i, attr ) {
                            if ( attr.specified && regex.test( attr.name ) ) {
                                    $this.removeAttr( attr.name );
                            }
                        });
                    });
                }

            ,   maxLengthChars: function ( el ) {

                    $( el ).on( 'keypress', function ( e ) {

                        var length = $( el ).text().length;

                        if ( length >= $( el ).attr( 'data-maxLength' ) )
                            e.preventDefault();
                    });
                }

            ,   arrayMove: function ( arr, fromIndex, toIndex ) {
                    var element = arr[ fromIndex ]
                    arr.splice( fromIndex, 1 );
                    arr.splice( toIndex, 0, element );
                }

    };

    // Expose utilities to the global scope
    window.Bppl.Helpers.Utilities = new UtilityHelper();

    window.Bppl.Helpers.Utilities.initialize();


})( jQuery, this, this.document );
/**
*
* Model Builder
*/
( function( $, window, document, utilities ) {

	var Builder = Gillie.Model.extend({

	});

	// Global Exposition
	window.Bppl.Models.Builder = new Builder();



})( this.jQuery, this, this.document, this.Bppl.Helpers.Utilities, undefined );


/**
*
* Model User
*/
( function( $, window, document, utilities ) {

	var User = Gillie.Model.extend({

			initialize: function() { }

		,	defaults: {
					email: ''
				,	username: ''
				,	password: ''
				// ,	password_confirm: ''
				,	location: ''
				,	url: ''
			}

		,	url: window.Constants.aUrl

			// Register
		,	register: function( event ) {
				// Register the user
				utilities.sync( 'user.register', event, this );
			}

			// Authors Signup
		,	authorsSignup: function( event ) {

				utilities.sync( 'user.authorsSignup', event, this );
			}

			// Newsletter Register
		,	newsletterRegister: function( event ) {

				// Register the user from newsletter
				utilities.sync( 'user.newsletterRegister', event, this );
			}

			// Create user account
		,	confirm: function( event ) {

				// Confirm key and create account
				utilities.sync( 'user.confirm', event, this );
			}

			// Log in
		,	login: function( event ) {

				// Send credentials to server.
				utilities.sync( 'user.login', event, this );

			}

			// Log in
		,	loginOrRegisterSocial: function( userData, success, error ) {

				// utilities.sync( 'post.check', event, this );
                var response
                ,   aOptions = {
                            success: success
                        ,   error: error
                        ,   dataType: 'json'
                        ,   contentType: 'application/json'
                        ,   async: true
                        // ,   url: aUrl + '/?action=save_bookmarklet_post'
                        ,   url: aUrl + '/?action=user.loginOrRegisterSocial'
                    }
                ,   aData = JSON.stringify( userData );

                return utilities.ajax( aOptions, aData );

            }

			// Log out
		,	logout: function( event ) {

				// Send credentials to server.
				utilities.sync( 'user.logout', event, this );
			}

			// Save user data
		,	save: function( event ) {

				// Update user data in server
				utilities.sync( 'user.update', event, this );

			}

			// Send the user a password recovery link
		,	recoverPassword: function( event ) {

				// Send a post request to send recover link
				utilities.sync( 'user.password_recover', event, this );

		    }

		    // Reset the password
		,	resetPassword: function( event ) {

				utilities.sync( 'user.password_reset', event, this );
			}
			// Register new user and go paypal
		,	paypal: function( event ) {

				utilities.sync( 'user.paypal', event, this );
		}


	});

	// Global Exposition
	window.Bppl.Models.User = new User();


})( this.jQuery, this, this.document, this.Bppl.Helpers.Utilities, undefined );
/**
*
* Model ListSuggestion
*/
( function( $, window, document, utilities ) {

	var ListSuggestion = Gillie.Model.extend({

			initialize: function() { }

		,	defaults: {
					ID: -1
				,	title: ''
				,	description: ''
				,	pending: false
				,	votes: {
							up: []
						,	down: []
					}
			}

			// Save the list suggestion to the database
		,	save: function( event ) {

				// Save the suggestion
				utilities.sync( 'list_suggestion.save', event, this );

			}


			// Upvotes or downvote a suggestion.
		,	vote: function( event ) {

				// Save the vote
				utilities.sync( 'list_suggestion.vote', event, this );
			}


	});

	// Global Exposition
	window.Bppl.Models.ListSuggestion = ListSuggestion;


})( this.jQuery, this, this.document, this.Bppl.Helpers.Utilities, undefined );

/**
*
* Model PostCollection
*/
( function( $, window, document, utilities ) {

	var PostCollection = Gillie.Model.extend({

			initialize: function() {

				this.url = window.Bppl.Config.AUrl;
			}

		,	defaults: {
					tags: []
				,	categories: {
							environment: []
						,	key: []
					}
				,	page: 1
				,	post_count: 0
				,	tags_not_in: []
				,	categories_not_in: []
				,	category_name: ''
				,	layout_view: 'list'
				,	type: 'list'
				,	list_id: 0
				,	superlist_id: 0
				,	s: ''
			}

			// Get posts from the server based on
			// the actual attributes
		,	sync: function( event ) {

				// Trigger event to add loading state to
				// collection
				this.trigger( 'disabled' );

				// Get posts
				utilities.sync( 'get_posts', event, this );

			}

			// Paginates to the next page.
		,	nextPage: function( event ) {

				// Augment the actual page by one
				this.attributes.page += 1;

				// Trigger event to refresh the url hash.
				this.trigger( 'nextPrev', this.attributes );

			}

			// Paginates to the previeus page.
		,	prevPage: function( event ) {

				if ( this.attributes.page > 1 ) {

					// Decrease the actual page by one.
					this.attributes.page -= 1;
				}

				// Trigger event to refresh the url hash.
				this.trigger( 'nextPrev', this.attributes );

			}

			// Reset all model attributes, so that a clean
			// query can be executed
		,	reset: function() {

				return this.set( this.defaults );
			}


	});

	// Global Exposition
	window.Bppl.Models.PostCollection = PostCollection();
	window.Bppl.Models.HomePostCollection = new PostCollection();


})( this.jQuery, this, this.document, this.Bppl.Helpers.Utilities, undefined );
/**
*
* Model Comment
*/
( function( $, window, document, utilities ) {

	var Comment = Gillie.Model.extend({

			initialize: function() { }

		,	defaults: {

					id: 0
				,	parent_id: 0
				,	depth: 1
				,	publish_date: ''
				,	post_id: 0
				,	content: ''
				,	pending: false
				,	author: {
							name: ''
						,	profile_url: '#'
						,	avatar_url: window.Constants.imagesUrl + 'user/default-profile.jpg'
					}
				,	attributesMap: [
							'id'
						,	'parent_id'
						,	'depth'
						,	'publish_date'
						,	'post_id'
						,	'content'
						,	'pending'
					]
			}

			// Save
		,	save: function( event ) {

				utilities.sync( 'comment.insert', event, this );
			}

	});

	// Global Exposition
	window.Bppl.Models.Comment = Comment;


})( this.jQuery, this, this.document, this.Bppl.Helpers.Utilities, undefined );
/**
*
* Model Like
*/
( function( $, window, document, utilities ) {

	var Like = Gillie.Model.extend({

			initialize: function() {}

		,	defaults: {
					// post_id: 0
					item_id: 0
				,	type: 'post'
				,	count: 0
				,	liked: false
				,	pending: true
				,	attributesMap: [
							'post_id'
						,	'count'
					]
			}

		,	save: function( event ) {

				utilities.sync( 'like.like', event, this );
			}

	});

	// Global Exposition
	window.Bppl.Models.Like = Like;


})( this.jQuery, this, this.document, this.Bppl.Helpers.Utilities, undefined );
/**
*
* Model List
*/
( function( $, window, document, model, utilities ) {

	var List = Gillie.Model.extend({

			initialize: function() {

			}

		,	defaults: {

					ID				: 0
		        ,   post_title		: ''
		        ,   post_name		: ''
		        ,   post_content	: ''
		        ,	post_date		: ''
		        ,   featured_image	: ''
		        ,   post_status		: 'draft'
		        ,   post_author		: ''
		        ,	items			: []
			}

			// Saves a new list
		,	save: function( event ) {

				utilities.sync( 'list.save', event, this );
			}

			// Add o remove an item from list
		,	toggle: function( event ) {

				utilities.sync( 'list.toggle', event, this );
			}

			// Get all user lists
		,	getUserLists: function( event ) {

				utilities.sync( 'list.get_user_lists', event, this );
			}

			// Get all user lists
		,	listFeat: function( event ) {

				utilities.sync( 'list.feat_list', event, this );
			}

	});

	// Global Exposition
	window.Bppl.Models.List = List;


})( this.jQuery, this, this.document, this.Bppl.Models.List, this.Bppl.Helpers.Utilities, undefined );
/**
*
* Model Flag
*/
( function( $, window, document, utilities ) {

	var Flag = Gillie.Model.extend({

			initialize: function() {

			}

		,	defaults: {

					// post_id: 0
					item_id: 0
				,	item_type: 'post'
				,	post_parent: 0
				,	author: 0
				,	description: ''
				,	type: 1
				,	pending: true
				,	attributes_map: [
							'item_id'
						,	'author'
						,	'description'
						,	'type'
					]

			}


		,	save: function( event ) {
				// console.log( event, this ); return;
				utilities.sync( 'flag.save', event, this );

			}

	});

	// Global Exposition
	window.Bppl.Models.Flag = Flag;

})( this.jQuery, this, this.document, this.Bppl.Helpers.Utilities, undefined );
/**
*
* Model Follow
*/
( function( $, window, document, utilities ) {

	var Follow = Gillie.Model.extend({

			initialize: function() { }

		,	defaults: {

					leader_id: 0
				,	pending: true
				,	attributesMap: [
						'user_id'
					]
			}

		,	follow: function( event ) {

				utilities.sync( 'follow.follow', event, this );
			}

	});

	// Global Exposition
	window.Bppl.Models.Follow = Follow;


})( this.jQuery, this, this.document, this.Bppl.Helpers.Utilities, undefined );
/**
*
* Model Carousel
*/
( function( $, window, document, utilities ) {

	var Carousel = Gillie.Model.extend({

			initialize: function() {

			}

		,	defaults: {

					query: ''
				,	loadedPages: 0
				,	postsPerPage: 0
				,	numberOfPages: 0
				,	userId: 0
				,	attributesMap: [
							'query'
						,	'loadedPages'
						,	'postsPerPage'
						,	'numberOfPages'
						,	'userId'
					]
			}

		,	load: function( event ) {

				utilities.sync( 'carousel.load', event, this );
			}

	});

	// Global Exposition
	window.Bppl.Models.Carousel = Carousel;


})( this.jQuery, this, this.document, this.Bppl.Helpers.Utilities, undefined );
/**
*
* Model Bookmarklet
*/
( function( $, window, document, utilities ) {

	var Bookmarklet = Gillie.Model.extend({

            // Save
            save: function( post, success, error ) {
                // console.log( post, success, error );return;
                var response
                ,   aOptions = {
                            success: success
                        ,   error: error
                        ,   dataType: 'json'
                        ,   contentType: 'application/json'
                        ,   async: true
                        // ,   url: aUrl + '/?action=save_bookmarklet_post'
                        ,   url: aUrl + '/?action=bookmarklet.save'
                    }
                ,   aData = JSON.stringify( post );
                // console.log( aOptions, aData, utilities.ajax( aOptions, aData ) );
                return utilities.ajax( aOptions, aData );

            }

            // Save
        ,   publish: function( post, success, error ) {
                // console.log( post, success, error );return;
                var response
                ,   aOptions = {
                            success: success
                        ,   error: error
                        ,   dataType: 'json'
                        ,   contentType: 'application/json'
                        ,   async: true
                        // ,   url: aUrl + '/?action=save_bookmarklet_post'
                        ,   url: aUrl + '/?action=bookmarklet.publish_post'
                    }
                ,   aData = JSON.stringify( post );
                // console.log( aOptions, aData, utilities.ajax( aOptions, aData ) );
                return utilities.ajax( aOptions, aData );

            }

	});

	// Global Exposition
	window.Bppl.Models.Bookmarklet = new Bookmarklet();



})( this.jQuery, this, this.document, this.Bppl.Helpers.Utilities, undefined );


/**
*
* Model Sharing
*/
( function( $, window, document, utilities ) {

	var Sharing = Gillie.Model.extend({

			// Defaults
			defaults: {
					post_id: 0
				,	email: ''
			}

			// Send newsletter form info to the server in order
			// to send the download email.
		,	save: function( event ) {

				// Send data to server
				utilities.sync( 'sharing.newsletter', event, this );
			}

		,	getLink: function( event ) {

				// Send data to server
				utilities.sync( 'sharing.get_link', event, this );
			}

	});

	// Global Exposition
	window.Bppl.Models.Sharing = new Sharing();



})( this.jQuery, this, this.document, this.Bppl.Helpers.Utilities, undefined );


/**
*
* Model Submitter
*/
( function( $, window, document, utilities ) {

	var Submitter = Gillie.Model.extend({

			initialize: function() { }

		,	defaults: {
					title: ''
				,	content: ''
				,	tags: []
				,	owner: false
				,	fiddle_link: ''
				,	demo_link: ''
				,	detail_link: ''
				,	external_link: ''
				,	externalLink: ''
				,	license: ''
				,	images: []
				,	featured_image: ''
				,	attachments: []
				,	list_id: ''
				,	category: 'graphic'
				,	sub_category: ''
				,	pending: true
				,	content_type: ''
				,	repo: ''
				,	on_prod_list_id: ''
			}


			// Save submitter data
		,	save: function( event ) {

				// Save post
				utilities.sync( 'submitter.save', event, this );
			}

		,	suscribe: function ( event ) {
				//create transient
				utilities.sync( 'helper.suscribe', event, this );
			}

	});

	// Global Exposition
	window.Bppl.Models.Submitter = new Submitter();


})( this.jQuery, this, this.document, this.Bppl.Helpers.Utilities, undefined );
/**
*
* Model BuilderPage
*/
( function( $, window, document, utilities ) {

	var BuilderPage = Gillie.Model.extend({

			initialize: function() {

				// Change
				// this.on( 'change', this.getPosts );
			}

			// Defaults
		,	defaults: {
					tags: []
				,	categories: {
							environment: []
						,	key: []
					}
				,	page: 1
				,	post_count: 0
				,	tags_not_in: []
				,	categories_not_in: []
				,	posts_per_page: 20
				,	type: 'post'
			}


			// Get posts
		,	getPosts: function( event ) {

				// Trigger changing event
				this.trigger( 'changing' );

				// Get posts
				utilities.sync( 'post.get', event, this );
			}

			// Checks whether there is at least one list with this
			// combination of terms.
		,	findSimilarLists: function( event ) {

				// Find similar posts
				utilities.sync( 'post.get', event, this, { type: 'list' } );
			}


			// Create a list with posts that match
			// selected terms.
		,	createList: function( event, data ) {

				// Create list with passed data
				utilities.sync( 'builder.create_list', event, this, { post: data } );
			}

			// Reset model data to defaults
		,	reset: function() {

				this.set( this.defaults );
				return this;
			}

			// Bring posts by their terms
		,	search: function( event ) {

				this.trigger( 'searching' );

				// Get posts
				utilities.sync( 'post.get', event, this );
			}

	});

	// Global Exposition
	window.Bppl.Models.BuilderPage = new BuilderPage();



})( this.jQuery, this, this.document, this.Bppl.Helpers.Utilities, undefined );

/**
*
* Model Sidebar
*/
( function( $, window, document, utilities ) {

	var Sidebar = Gillie.Model.extend({

			initialize: function() {

			}

		,	defaults: {
				twitter: ''
				,	github: ''
				,	stack_overflow: ''
				,	comments: ''
			}

		,	save: function( event ) {
				utilities.sync( 'sidebar.save', event, this );
			}

	});

	// Global Exposition
	window.Bppl.Models.Sidebar = new Sidebar();



})( this.jQuery, this, this.document, this.Bppl.Helpers.Utilities, undefined );


/**
*
* Model Track
*/
( function( $, window, document, utilities ) {

	var Track = Gillie.Model.extend({

			initialize: function() { }

		,	defaults: {
					item_id: 0
				,	item_type: 'post'
			}

			// Save data
		,	save: function( event ) {

				// Store event
				utilities.sync( 'sharing.track', event, this );
			}

	});

	// Global Exposition
	window.Bppl.Models.Track = new Track();


})( this.jQuery, this, this.document, this.Bppl.Helpers.Utilities, undefined );
/**
*
* Model Curation
*/
( function( $, window, document, utilities ) {

	var Curation = Gillie.Model.extend({

			initialize: function() {

				// Track curation
				this.on( 'curation_track', this.trackCuration );
			}

		,	defaults: {
					'item_type': 'post'
				,	'item_id': 0
				,	'decision': 'accept'
				,	'section': 'post-submissions'
				,	'request_type': ''
				,	'flag_id': 0
				,	'category_name': ''
				,	'type': 'post'
				,	'list_id': 0
				,	'posts_per_page': -1
				,	'items_order': []
				,	'post_id': 0
				,	'exlude_list_items': true
				,	'position': 0
				//,	'curation_type': [ 'curated' ]
			}

			// Accept a post or a comment
		,	curate: function( event ) {
				// console.log( event, this  );return;
				// Save options
				utilities.sync( 'curation.curate', event, this );
				this.trigger( 'curation_track' );
			}

			// Get lists in the given category
		,	getLists: function( event ) {

				this.set({ type: 'list', list_id: 0 });

				// Get lists
				utilities.sync( 'post.get', event, this );

			}

			// Get all the items inside a list
		,	getListItems: function( event ) {

				this.set( 'type', 'post' );

				// Get posts
				utilities.sync( 'list.items', event, this );
			}

			// Short list items
		,	sortListItems: function( event ) {

				// Sort items
				utilities.sync( 'list.sort_items', event, this );
				this.trigger( 'curation_track' );

			}

			// Stick post
		,	stickPost: function( event ) {

				// Stick items
				utilities.sync( 'post.stick', event, this );
				this.trigger( 'curation_track' );
			}

			// Track curation
		,	trackCuration: function( event ) {

				utilities.sync( 'curation.track', 'curation.track', this );
			}

			// Like Post
		,	likePost: function( event ) {

				utilities.sync( 'like.curator_like', event, this );
				// this.trigger( 'curation_track' );

			}

			// Like Post
		,	dislikePost: function( event ) {

				utilities.sync( 'like.curator_dislike', event, this );
				// this.trigger( 'curation_track' );

			}

	});

	// Global Exposition
	window.Bppl.Models.Curation = new Curation();



})( this.jQuery, this, this.document, this.Bppl.Helpers.Utilities, undefined );


/**
*
* Model Edition
*/
( function( $, window, document, utilities ) {

	var Edition = Gillie.Model.extend({

			initialize: function() { }

		,	url: 'http://mysite.com/api/v1/'

		,	defaults: {
					'ID': 0
				,	'post_content': ''
				,	'valid_username': false
				,	'valid_email': false
				,	'editor_username': ''
				,	'editor_email': ''
			}

			// Save new post content
		,	save: function( event ) {

				var _this = this;

				window.Bppl.Models.Bookmarklet.save(
						_this.toJSON()
					,	function( response ) {
							_this.trigger( event, _this.attributes, response );
						}
				);

				// this.req.get( '/post/:ID', event, data );
				// model.attr( 'sample' );
				// model.get( 'sample' );
				//
				// this.get( '' );
				//
				// GET    .com/wp-admin/admin-ajax.php?resource=post/10
				// GET    .com/wp-admin/admin-ajax.php?resource=post/10&ID=10&name=sample
				// POST   .com/wp-admin/admin-ajax.php?resource=post
				// PUT    .com/wp-admin/admin-ajax.php?resource=post/10
				// DELETE .com/wp-admin/admin-ajax.php?resource=post/10

			}

			// Create a user an update the post content
		,	createUserUpdatePost: function( event ) {

				utilities.sync( 'bookmarklet.create_user_update_post', event, this );

			}


	});

	// Global Exposition
	window.Bppl.Models.Edition = new Edition();



})( this.jQuery, this, this.document, this.Bppl.Helpers.Utilities, undefined );


/**
*
* Model LinkGenerator
*/
( function( $, window, document, utilities ) {

	var LinkGenerator = Gillie.Model.extend({

			initialize: function() {

			}

		,	defaults: {
					'post_id': 0
				,	'editor_name': ''
			}

			// Generate guest editor link
		,	generate: function( event ) {

				utilities.sync( 'user.generate_editor_link', event, this );

			}

	});

	// Global Exposition
	window.Bppl.Models.LinkGenerator = new LinkGenerator();


})( this.jQuery, this, this.document, this.Bppl.Helpers.Utilities, undefined );


/**
*
* Model Search
*/
( function( $, window, document, utilities ) {

	var Search = Gillie.Model.extend({

	});

	// Global Exposition
	window.Bppl.Models.Search = new Search();



})( this.jQuery, this, this.document, this.Bppl.Helpers.Utilities, undefined );


/**
*
* Model Breadcrumb
*/
( function( $, window, document, utilities ) {

	var Breadcrumb = Gillie.Model.extend({

	});

	// Global Exposition
	window.Bppl.Models.Breadcrumb = new Breadcrumb();



})( this.jQuery, this, this.document, this.Bppl.Helpers.Utilities, undefined );


/**
*
* Model Social
*/
( function( $, window, document, utilities ) {

	var Social = Gillie.Model.extend({

			// Defaults
			defaults: {
					email: ''
				,	password_confirm: ''
				,	password: ''
				,	newsletter_subscribe: true
				,	suggestedLink: ''
				,	getActionReferenceData: {}
			}

			// Create a user
		,	createUser: function( event ) {

				// Create user
				utilities.sync( 'user.confirm_social', event, this );
		 	}

		 ,	facebookCheck: function( event ) {

		 		// if ( utilities.storageManager( 'session', 'get', 'suggestedLink' ).length > 1 )
				this.attributes.suggestedLink = utilities.storageManager( 'session', 'get', 'suggestedLink' );

				if ( sessionStorage.likeData && typeof JSON.parse( utilities.storageManager( 'session', 'get', 'likeData' ) ) === 'object' )
		 			this.attributes.getActionReferenceData = JSON.parse( utilities.storageManager( 'session', 'get', 'likeData' ) );

		 		if ( sessionStorage.comments && typeof JSON.parse( utilities.storageManager( 'session', 'get', 'comments' ) ) === 'object' )
		 			this.attributes.getActionReferenceData = JSON.parse( utilities.storageManager( 'session', 'get', 'comments' ) );

		 		utilities.sync( 'social.facebook', event, this );
		    }

		,	googleCheck: function( event ) {

				// if ( utilities.storageManager( 'session', 'get', 'suggestedLink' ).length > 1 )
				this.attributes.suggestedLink = utilities.storageManager( 'session', 'get', 'suggestedLink' );

				if ( typeof JSON.parse( utilities.storageManager( 'session', 'get', 'likeData' ) ) === 'object' )
		 			this.attributes.getActionReferenceData = JSON.parse( utilities.storageManager( 'session', 'get', 'likeData' ) );

				if ( typeof JSON.parse( utilities.storageManager( 'session', 'get', 'comments' ) ) === 'object' )
		 			this.attributes.getActionReferenceData = JSON.parse( utilities.storageManager( 'session', 'get', 'comments' ) );

				utilities.sync( 'social.google', event, this );
		    }
	});

	// Global Exposition
	window.Bppl.Models.Social = new Social();


})( this.jQuery, this, this.document, this.Bppl.Helpers.Utilities );

/**
*
* Model Misc
*/
( function( $, window, document, utilities ) {

	var Misc = Gillie.Model.extend({

			defaults: {
					ID: 0
				,	featured_image: ''
				,	additional_images: []
				,	attachment: ''
				,	ref: 'builder'
			}

			// Save element
		,	save: function() {

				// Set global ID to post.
				this.set( 'ID', window.Constants.POST_ID );
				// console.log( this.toJSON(), 'luna', this.toJSON().inSingle );
				if ( this.toJSON().inSingle )
					this.set( 'ref', '' );

				// Bookmarklet
				var	_this = this
				,	image_url
				,	Bookmarklet = window.Bppl.Models.Bookmarklet.save(
						this.toJSON()
					,	function( response ) {

							// console.log( 'feat image', response );return;

							// Show feedback
							// utilities.alert( 'Featured image added to post!' );
							utilities.alert( 'Images uploaded correctly!' );
							// imageUrl = response.data.img_url;

							// // Set new image
							// $( '.post-image img' ).attr( 'src', imageUrl );

						}
				);
		    }

	});

	// Global Exposition
	window.Bppl.Models.Misc = new Misc();


})( this.jQuery, this, this.document, this.Bppl.Helpers.Utilities, undefined );


/**
* Model Post
*
*/
( function( $, window, document, utilities ) {

	var Post = Gillie.Model.extend({

			defaults: {
					'ID': 0
				,	'post_name': ''
			}

			// Trash a post
		,	trash: function( event ) {

				utilities.sync( 'post.trash', event, this );
			}

			// Check a post-name
		,	check: function( post, success, error ) {

				// utilities.sync( 'post.check', event, this );
                var response
                ,   aOptions = {
                            success: success
                        ,   error: error
                        ,   dataType: 'json'
                        ,   contentType: 'application/json'
                        ,   async: true
                        // ,   url: aUrl + '/?action=save_bookmarklet_post'
                        ,   url: aUrl + '/?action=post.check'
                    }
                ,   aData = JSON.stringify( post );

                return utilities.ajax( aOptions, aData );

            }

            // Remove post from specific list
		,	toggleFromEditorBox: function ( post, success, error ) {
                // console.log( post, success, error );return;
                var response
                ,   aOptions = {
                            success: success
                        ,   error: error
                        ,   dataType: 'json'
                        ,   contentType: 'application/json'
                        ,   async: true
                        // ,   url: aUrl + '/?action=save_bookmarklet_post'
                        ,   url: aUrl + '/?action=list.toggle'
                    }
                ,   aData = JSON.stringify( post );
                // console.log( aOptions, aData, utilities.ajax( aOptions, aData ) );
                return utilities.ajax( aOptions, aData );
			}

            // Get data from specific url
		,	getDataFromUrl: function ( post, success, error ) {
                // console.log( post, success, error );return;
                var response
                ,   aOptions = {
                            success: success
                        ,   error: error
                        ,   dataType: 'json'
                        ,   contentType: 'application/json'
                        ,   async: true
                        // ,   url: aUrl + '/?action=save_bookmarklet_post'
                        ,   url: aUrl + '/?action=post.get_data_url'
                    }
                ,   aData = JSON.stringify( post );
                // console.log( aOptions, aData, utilities.ajax( aOptions, aData ) );
                return utilities.ajax( aOptions, aData );
			}
	});

	// Global Exposition
	window.Bppl.Models.Post = new Post();


})( this.jQuery, this, this.document, this.Bppl.Helpers.Utilities, undefined );

/**
* Model: marketplace
*/
( function( $, window, document, utilities ) {

	var marketplace = Gillie.Model.extend({

			// Called on instantiation
			initialize: function() {

			}

			// Default attributes
		,	defaults: {

			}

	});

	// Global Exposition
	window.Bppl.Models.marketplace = new marketplace();



})( this.jQuery, this, this.document, this.Bppl.Helpers.Utilities );


/**
*
* Model NavBar
*/
( function( $, window, document, utilities ) {

	var NavBar = Gillie.Model.extend({

			initialize: function() {  }

		,	defaults: {

					pending: true
				,	attributesMap: [
							'pending'
					]
			}

			// Save
		,	save: function( event ) {

				utilities.sync( 'suggestion.insert', event, this );
			}

			// setCustomLink
		,	setCustomLink: function( event ) {

				utilities.sync( 'suggestion.setCustomLink', event, this );
			}

	});

	// Global Exposition
	window.Bppl.Models.NavBar = NavBar;


})( this.jQuery, this, this.document, this.Bppl.Helpers.Utilities, undefined );
/**
* Model: photo
*/
( function( $, window, document, utilities ) {

	var photo = Gillie.Model.extend({

            // Save
            save: function( post, success, error ) {
                // console.log( post, success, error );return;
                var response
                ,   aOptions = {
                            success: success
                        ,   error: error
                        ,   dataType: 'json'
                        ,   contentType: 'application/json'
                        // ,	jsonp: 'callback'
                        // ,	jsonpCallback: 'jsonpcallback'
                        ,   async: true
                        // ,   url: aUrl + '/?action=save_bookmarklet_post'
                        ,   url: aUrl + '/?action=photo.update'
                    }
                ,   aData = JSON.stringify( post );
                // console.log( aOptions, aData, utilities.ajax( aOptions, aData ) );
                return utilities.ajax( aOptions, aData );

                // function jsonpcallback( res ) {
                // 	console.log( res );
                // }

            }

        ,   saveBundle: function( post, success, error ) {
                // console.log( post, success, error );return;
                var response
                ,   aOptions = {
                            success: success
                        ,   error: error
                        ,   dataType: 'json'
                        ,   contentType: 'application/json'
                        // ,    jsonp: 'callback'
                        // ,    jsonpCallback: 'jsonpcallback'
                        ,   async: true
                        // ,   url: aUrl + '/?action=save_bookmarklet_post'
                        ,   url: aUrl + '/?action=photo.bundle'
                    }
                ,   aData = JSON.stringify( post );
                // console.log( aOptions, aData, utilities.ajax( aOptions, aData ) );
                return utilities.ajax( aOptions, aData );

                // function jsonpcallback( res ) {
                //  console.log( res );
                // }

            }

        ,   updateBundle: function( post, success, error ) {
                // console.log( post, success, error );return;
                var response
                ,   aOptions = {
                            success: success
                        ,   error: error
                        ,   dataType: 'json'
                        ,   contentType: 'application/json'
                        // ,    jsonp: 'callback'
                        // ,    jsonpCallback: 'jsonpcallback'
                        ,   async: true
                        // ,   url: aUrl + '/?action=save_bookmarklet_post'
                        ,   url: aUrl + '/?action=photo.update_bundle'
                    }
                ,   aData = JSON.stringify( post );
                // console.log( aOptions, aData, utilities.ajax( aOptions, aData ) );
                return utilities.ajax( aOptions, aData );

                // function jsonpcallback( res ) {
                //  console.log( res );
                // }

            }

        ,   editBundle: function( post, success, error ) {
                // console.log( post, success, error );return;
                var response
                ,   aOptions = {
                            success: success
                        ,   error: error
                        ,   dataType: 'json'
                        ,   contentType: 'application/json'
                        // ,    jsonp: 'callback'
                        // ,    jsonpCallback: 'jsonpcallback'
                        ,   async: true
                        // ,   url: aUrl + '/?action=save_bookmarklet_post'
                        ,   url: aUrl + '/?action=photo.edit_bundle'
                    }
                ,   aData = JSON.stringify( post );
                // console.log( aOptions, aData, utilities.ajax( aOptions, aData ) );
                return utilities.ajax( aOptions, aData );

                // function jsonpcallback( res ) {
                //  console.log( res );
                // }

            }

        ,   removeBundle: function( post, success, error ) {
                // console.log( post, success, error );return;
                var response
                ,   aOptions = {
                            success: success
                        ,   error: error
                        ,   dataType: 'json'
                        ,   contentType: 'application/json'
                        // ,    jsonp: 'callback'
                        // ,    jsonpCallback: 'jsonpcallback'
                        ,   async: true
                        // ,   url: aUrl + '/?action=save_bookmarklet_post'
                        ,   url: aUrl + '/?action=photo.remove_bundle'
                    }
                ,   aData = JSON.stringify( post );
                // console.log( aOptions, aData, utilities.ajax( aOptions, aData ) );
                return utilities.ajax( aOptions, aData );

                // function jsonpcallback( res ) {
                //  console.log( res );
                // }

            }

        ,   deletePhoto: function( post, success, error ) {
                // console.log( post, success, error );return;
                var response
                ,   aOptions = {
                            success: success
                        ,   error: error
                        ,   dataType: 'json'
                        ,   contentType: 'application/json'
                        // ,    jsonp: 'callback'
                        // ,    jsonpCallback: 'jsonpcallback'
                        ,   async: true
                        // ,   url: aUrl + '/?action=save_bookmarklet_post'
                        ,   url: aUrl + '/?action=photo.delete_photo'
                    }
                ,   aData = JSON.stringify( post );
                // console.log( aOptions, aData, utilities.ajax( aOptions, aData ) );
                return utilities.ajax( aOptions, aData );

                // function jsonpcallback( res ) {
                //  console.log( res );
                // }

            }

        ,   zipBundle: function( post, success, error ) {
                // console.log( post, success, error );return;
                var response
                ,   aOptions = {
                            success: success
                        ,   error: error
                        ,   dataType: 'json'
                        ,   contentType: 'application/json'
                        // ,    jsonp: 'callback'
                        // ,    jsonpCallback: 'jsonpcallback'
                        ,   async: true
                        // ,   url: aUrl + '/?action=save_bookmarklet_post'
                        ,   url: aUrl + '/?action=photo.zip_bundle'
                    }
                ,   aData = JSON.stringify( post );
                // console.log( aOptions, aData, utilities.ajax( aOptions, aData ) );
                return utilities.ajax( aOptions, aData );

                // function jsonpcallback( res ) {
                //  console.log( res );
                // }

            }

	});

	// Global Exposition
	window.Bppl.Models.Photo = new photo();



})( this.jQuery, this, this.document, this.Bppl.Helpers.Utilities );


/**
* Model: listManager
*/
( function( $, window, document, utilities ) {

	var listManager = Gillie.Model.extend({

            // Save
            save: function( post, success, error ) {
                // console.log( post, success, error );return;
                var response
                ,   aOptions = {
                            success: success
                        ,   error: error
                        ,   dataType: 'json'
                        ,   contentType: 'application/json'
                        // ,	jsonp: 'callback'
                        // ,	jsonpCallback: 'jsonpcallback'
                        ,   async: true
                        // ,   url: aUrl + '/?action=save_bookmarklet_post'
                        ,   url: aUrl + '/?action=list.save'
                    }
                ,   aData = JSON.stringify( post );
                // console.log( aOptions, aData, utilities.ajax( aOptions, aData ) );
                return utilities.ajax( aOptions, aData );

                // function jsonpcallback( res ) {
                // 	console.log( res );
                // }

            }

        ,   checkItem: function( post, success, error ) {
                // console.log( post, success, error );return;
                var response
                ,   aOptions = {
                            success: success
                        ,   error: error
                        ,   dataType: 'json'
                        ,   contentType: 'application/json'
                        // ,    jsonp: 'callback'
                        // ,    jsonpCallback: 'jsonpcallback'
                        ,   async: true
                        // ,   url: aUrl + '/?action=save_bookmarklet_post'
                        ,   url: aUrl + '/?action=list_manager.check'
                    }
                ,   aData = JSON.stringify( post );
                // console.log( aOptions, aData, utilities.ajax( aOptions, aData ) );
                return utilities.ajax( aOptions, aData );

                // function jsonpcallback( res ) {
                //  console.log( res );
                // }

            }

        ,   saveList: function( post, success, error ) {
                // console.log( post, success, error );return;
                var response
                ,   aOptions = {
                            success: success
                        ,   error: error
                        ,   dataType: 'json'
                        ,   contentType: 'application/json'
                        // ,    jsonp: 'callback'
                        // ,    jsonpCallback: 'jsonpcallback'
                        ,   async: true
                        // ,   url: aUrl + '/?action=save_bookmarklet_post'
                        ,   url: aUrl + '/?action=list_manager.save'
                    }
                ,   aData = JSON.stringify( post );
                // console.log( aOptions, aData, utilities.ajax( aOptions, aData ) );
                return utilities.ajax( aOptions, aData );

                // function jsonpcallback( res ) {
                //  console.log( res );
                // }

            }

        ,   updateBundle: function( post, success, error ) {
                // console.log( post, success, error );return;
                var response
                ,   aOptions = {
                            success: success
                        ,   error: error
                        ,   dataType: 'json'
                        ,   contentType: 'application/json'
                        // ,    jsonp: 'callback'
                        // ,    jsonpCallback: 'jsonpcallback'
                        ,   async: true
                        // ,   url: aUrl + '/?action=save_bookmarklet_post'
                        ,   url: aUrl + '/?action=listManager.update_bundle'
                    }
                ,   aData = JSON.stringify( post );
                // console.log( aOptions, aData, utilities.ajax( aOptions, aData ) );
                return utilities.ajax( aOptions, aData );

                // function jsonpcallback( res ) {
                //  console.log( res );
                // }

            }

        ,   editBundle: function( post, success, error ) {
                // console.log( post, success, error );return;
                var response
                ,   aOptions = {
                            success: success
                        ,   error: error
                        ,   dataType: 'json'
                        ,   contentType: 'application/json'
                        // ,    jsonp: 'callback'
                        // ,    jsonpCallback: 'jsonpcallback'
                        ,   async: true
                        // ,   url: aUrl + '/?action=save_bookmarklet_post'
                        ,   url: aUrl + '/?action=listManager.edit_bundle'
                    }
                ,   aData = JSON.stringify( post );
                // console.log( aOptions, aData, utilities.ajax( aOptions, aData ) );
                return utilities.ajax( aOptions, aData );

                // function jsonpcallback( res ) {
                //  console.log( res );
                // }

            }

        ,   removeBundle: function( post, success, error ) {
                // console.log( post, success, error );return;
                var response
                ,   aOptions = {
                            success: success
                        ,   error: error
                        ,   dataType: 'json'
                        ,   contentType: 'application/json'
                        // ,    jsonp: 'callback'
                        // ,    jsonpCallback: 'jsonpcallback'
                        ,   async: true
                        // ,   url: aUrl + '/?action=save_bookmarklet_post'
                        ,   url: aUrl + '/?action=listManager.remove_bundle'
                    }
                ,   aData = JSON.stringify( post );
                // console.log( aOptions, aData, utilities.ajax( aOptions, aData ) );
                return utilities.ajax( aOptions, aData );

                // function jsonpcallback( res ) {
                //  console.log( res );
                // }

            }

        ,   deletelistManager: function( post, success, error ) {
                // console.log( post, success, error );return;
                var response
                ,   aOptions = {
                            success: success
                        ,   error: error
                        ,   dataType: 'json'
                        ,   contentType: 'application/json'
                        // ,    jsonp: 'callback'
                        // ,    jsonpCallback: 'jsonpcallback'
                        ,   async: true
                        // ,   url: aUrl + '/?action=save_bookmarklet_post'
                        ,   url: aUrl + '/?action=listManager.delete_listManager'
                    }
                ,   aData = JSON.stringify( post );
                // console.log( aOptions, aData, utilities.ajax( aOptions, aData ) );
                return utilities.ajax( aOptions, aData );

                // function jsonpcallback( res ) {
                //  console.log( res );
                // }

            }

        ,   zipBundle: function( post, success, error ) {
                // console.log( post, success, error );return;
                var response
                ,   aOptions = {
                            success: success
                        ,   error: error
                        ,   dataType: 'json'
                        ,   contentType: 'application/json'
                        // ,    jsonp: 'callback'
                        // ,    jsonpCallback: 'jsonpcallback'
                        ,   async: true
                        // ,   url: aUrl + '/?action=save_bookmarklet_post'
                        ,   url: aUrl + '/?action=listManager.zip_bundle'
                    }
                ,   aData = JSON.stringify( post );
                // console.log( aOptions, aData, utilities.ajax( aOptions, aData ) );
                return utilities.ajax( aOptions, aData );

                // function jsonpcallback( res ) {
                //  console.log( res );
                // }

            }

	});

	// Global Exposition
	window.Bppl.Models.ListManager = new listManager();



})( this.jQuery, this, this.document, this.Bppl.Helpers.Utilities );


/**
*
* View NavBar
*/
( function( $, window, document, model, utilities ) {

	var NavBar = Gillie.View.extend({

			initialize: function() {

			}

			// Render the view of the comment saved
		,	onSave: function( model, data ) {

				// Show the feedback message
				utilities.alert( data.data.message );

				// Clean form
				$( '.suggest-bppl-item input' ).val( '' );
				$( '.suggest-bppl-item' ).hide();

				// Enable submitter btn
				$( '.suggest-new-item' ).text( 'Send' ).removeClass( 'disabled' );

			}

			// Render the view of the comment saved
		,	onSaveLink: function( model, data ) {

				// console.log( model, data );return;

				// Show the feedback message
				utilities.alert( data.data.message );

				$( '.custom-bppl-link' ).attr( 'href', data.data.url );
				$( '.custom-bppl-link p' ).text( data.data.title );

				if ( data.data.left_time ) {
					var template = '<br> ' + '<span class="countdown-timer" data-time="' + data.data.left_time + '"></span>';

					$( '.custom-bppl-link p' ).append( template );
				}

				// Clean form
				$( '.suggest-bppl-item input' ).val( '' );
				$( '.suggest-bppl-item' ).hide();

				// Enable submitter btn
				$( '.suggest-new-item' ).text( 'Send' ).removeClass( 'disabled' );

			}

	});

	// Global Exposition
	window.Bppl.Views.NavBar = new NavBar();



})( this.jQuery, this, this.document, this.Bppl.Models.NavBar, this.Bppl.Helpers.Utilities, undefined );
/**
*
* View User
*/
( function( $, window, document, model, utilities ) {

	var User = Gillie.View.extend({

			initialize: function() {

				model.on({

						// Hook to register sync event
						register: this.onRegister

						// Hook to register sync event
					,	newsletterRegister: this.onNewsletterRegister

						// Bind to confirmation
					,	confirm: this.onConfirm

						// Bind to login
					,	login: this.onLogin

						// Bind to authors Signup
					,	authorsSignup: this.onAuthorsSignup

						// Bind to logout
					,	logout: this.onLogout

						// Bind to update event
					,	save: this.onSave

						// Bind to pass recover and reset
					,	password_recover: this.onPassRecover
					,	password_reset: this.onPassReset

					,	paypal: this.onPaypal
				});

			}

			// Called after register
		,	onRegister: function( model, data ) {

				var	target = $( '#register-form' )
				,	submitBtn = $( target ).find( 'input[type="submit"][value="Register"]' );

				// Remove loading state
				// utilities.stopWorking( target );
				if ( utilities.isAjaxError( data ) ) {
					submitBtn.removeClass( 'disabled' );

					// Enable submitter btn
					$( '.suggest-new-item' ).text( 'Send' ).removeClass( 'disabled' );
					$( '.suggest-bppl-item' ).removeClass( 'processing' );

					return utilities.alert( 'This email is already registered' );
				}

				submitBtn.removeClass( 'disabled' );

				// Enable submitter btn
				$( '.suggest-new-item' ).text( 'Send' ).removeClass( 'disabled' );
				$( '.suggest-bppl-item' ).removeClass( 'processing' );

				return utilities.alert( 'Welcome to Bypeople. Pls check your email account and click on the confirmation link.' );

			}

		,	onAuthorsSignup: function ( model, data ) {

				var	target = $( '#form-authors-signup' )
				,	loginModal = '.LoginRegister-modal'
				,	modalBackdrop = '.modal-backdrop';

				// Remove loading state
				if ( utilities.stopWorking( target ) ) return;

				$( loginModal ).delay( 2000 ).fadeOut( 400 );
				$( modalBackdrop ).delay( 2000 ).fadeOut( 400 );
				return utilities.alert( "Thank you for being part of ByPeople. We'll get back to you soon." );
			}

			// Called after register
		,	onNewsletterRegister: function( model, data ) {

				var	target = $( '#newsletter-sign-up, #newsletter-sign-up-home' );

				// Remove loading state
				utilities.stopWorking( target );
				if ( utilities.isAjaxError( data ) ) {
					return utilities.alert( 'This email is already registered' );
				}

				return utilities.alert( 'Welcome to Bypeople. Pls check your email account and click on the confirmation link.' );

			}

			// Called on model's confirm event
		,	onConfirm: function( model, data ) {

				var target = $( '#confirmation-form' )
				,	url = ( model.url ) ? model.url : ''
				,	btn = $( '.btn-success' )
				,	cookiesArr ;

				// Remove loading state
				utilities.stopWorking( target );
				if ( utilities.isAjaxError( data ) ) {
					return utilities.alert( 'Something is wrong...' );
				}
				// $( target ).find( 'input[type="submit"]' ).val( 'Working...' );

				$( '.close-notice' ).trigger( 'click' );

				// Clean cookies
				cookiesArr = [ 'bppl_user', 'closed_notice' ];
				utilities.delCookie( cookiesArr );

				// $( target ).find( 'input[type="submit"]' ).val( 'Submit' );
				return utilities.alert( 'changes saved' );

				// if ( ! url ) window.location.reload( true );
				// else window.location.href = url;


			}

			// Callback for login event.
		,	onLogin: function( model, data ) {
				// console.log( model, data );
				var form = '#login-form'
				,	submit = $( form ).find( 'input[type="submit"]' );

				utilities.stopWorking( form );

				// Show notification on other status than 200.
				if ( data.status != 200 ) {
					return utilities.showGlobalNotification( data.text, '', 'failure', null, 0 );
				}

				// Check for pending events
				if ( model.event ) {

					// console.log( model.event, data.data.user );
					// Trigger custom event if there is one.
					// window.Bppl.Event.trigger( model.event, { user: data.data.user } );
					window.Bppl.Event.on( model.event, { user: data.data.user } );

					window.location.reload( true );

				} else {

					if ( data.data.message )
						utilities.alert( data.data.message );

					if ( window.Constants.ptmpname == 'photos-single' || window.Constants.ptmpname == 'photos' ) {
						var userData = {};

						userData.email = data.data.user.user_email;
						// console.log(userData, data.data);return;

						window.Bppl.Models.User.loginOrRegisterSocial( userData, function ( data ) {

							utilities.newCookie( 'bpplconnection', data.data.user.ID, 1, '/' );

							$( '.in-download' ).show();
							// $( '.modal-backdrop' ).trigger( 'click' );
							setTimeout( function () {

									utilities.downloadView();
									window.location = localStorage.dwnLink;

								}, 1000, setTimeout( function() {
									window.location.reload( true );
								}, 3500 ));
						});
					}

					else
						window.location.reload( true );

				}


			}

			// Callback for logout event.
		,	onLogout: function( model, data ) {

				// Do default procedure otherwise.
				window.location.reload( true );
			}

			/**
			 * Open the login form
			 * @param  {[type]} event      [user.login]
			 * @param  {[type]} login_type [manage form type to show]
			 * @param  {[type]} data       [attach the event data to this form]
			 * @param  {[type]} comment_id [extra ]
			 */
		,	toggleLogin: function( event, login_type, data, comment_id ) {

				var modal = '.LoginRegister-modal'
				,	backdrop = '.modal-backdrop'
				,	loginForm = '#login-form'
				,	registerForm = '.register-form.active'
				,	facebookForm = '.register-form.active'
				,	gPlusForm = '.register-form.active'
				,	githubForm = '.register-form.active';

				// Show login
				// if ( typeof login_type == 'undefined' ) {
				// 	$( modal ).show();
				// 	$( backdrop ).show();
				// } else {
				// 	switch ( login_type ) {
				// 		default:
				// 		case 'normal':
				// 			$( modal ).show();
				// 			$( backdrop ).show();
				// 		break;
				// 		case 'minified':
				// 			$( '.min-login' ).slideDown( 300 );
				// 		break;
				// 		case 'comment':
				// 			$( '.min-login.comments' ).slideDown( 300 );
				// 		break;
				// 		case 'comment-reply':
				// 			$( '#comments-form-' + comment_id + ' .min-login.comment-reply' ).slideDown( 300 );
				// 		break;
				// 		case 'suggest-bppl-item':
				// 			$( '.min-login.suggest-bppl-item' ).slideDown( 300 );
				// 		break;
				// 	}
				// }
				//

				// Show login
				if ( typeof login_type == 'undefined' || login_type == 'normal' ) {
					$( modal ).show().addClass( 'is-visible' );
					$( '.background-main-menu, .container-1200' ).addClass( 'mt-blurred' );
					// $( backdrop ).show();
				}

				if ( login_type == 'minified' )
					$( '.min-login' ).slideDown( 300 );

				if ( login_type == 'comment' )
					$( '.min-login.comments.active, .min-login.comments.no-single, .min-login.comments.single' ).slideDown( 300 );

				if ( login_type == 'comment-reply' )
					$( '#comments-form-' + comment_id + ' .min-login.comment-reply' ).slideDown( 300 );

				// Form data for resource suggestions
				if ( login_type == 'suggest-bppl-item' ) {

					$( '.min-login.active.' + login_type ).slideDown( 300 );

					// Assign data to form
					$.each( data, function( k, v ) {

						$( '#login-form' ).attr( 'data-action-reference-' + k, v );
					});
				}

				// Form data for list likes
				if ( login_type == 'list-like' ) {

					$( '.min-login.active.' + login_type ).slideDown( 300 );

					// Assign data to form
					$.each( data, function( k, v ) {

						$( '#login-form, #register-form' ).attr( 'data-action-reference-' + k, v );
					});

				}

				// Add the event we want to trigger to the
				// as a hidden input in the login form
				// if there is an event passed
				if ( event ) {

					if ( event == 'user.register' )
						$( registerForm ).find( 'input[name="event"]' )
							.attr( 'value', event );


					if ( event == 'user.login' )
						$( loginForm ).find( 'input[name="event"]' )
							.attr( 'value', event );
				}

				return;

			}

			// Fired when user is updated.
		,	onSave: function( model, data ) {

				var form = '.Settings-update'
				,	submit = $( form ).find( 'input[type="submit"]' );

				// Remove loading state.
				submit.removeClass( 'disabled' )
					.attr( 'value', submit.data( 'original-text' ) );

				utilities.alert( 'Your Settings Have Been Saved' );

			}

			// Fired after password recovery email is sent
		,	onPassRecover: function( model, response ) {

				var target = '#forgot-password';

				// Remove loading state
				utilities.stopWorking( target );
				if ( utilities.isAjaxError( response ) ) {
					return utilities.alert( 'Your confirmation link could not be sent' );
				}

				return utilities.alert( 'Check your email for the confirmation link.' );

		    }

		    // Triggered after user password is updated
		,	onPassReset: function( model, response ) {

				var target = '.reset-password-form';

				// Remove loading state
				utilities.stopWorking( target );

				if ( utilities.isAjaxError( response ) ) {
					return utilities.alert( 'There was a problem resetting your password' );
				}

				utilities.alert( 'Your password has been updated. You can login now' );

				sessionStorage.RP = 'rec';
				// window.location = window.Constants.siteURL + 'home';
		    }
			// Called after paypal register
		,	onPaypal: function( model, data ) {

				if ( data.data.url ) {
					window.location = data.data.url;
				}

		}
	});

	// Global Exposition
	window.Bppl.Views.User = new User();


})( this.jQuery, this, this.document, this.Bppl.Models.User, this.Bppl.Helpers.Utilities, undefined );
/**
*
* View ListSuggestion
*/
( function( $, window, document, model, utilities ) {

	var ListSuggestion = Gillie.View.extend({

			initialize: function() {

				this.target = '';
			}

			// Shows a tooltip with the data of the list
		,	showTooltip: function( model, data ) {

				var target = this.target
				,	targetId = $( target ).attr( 'id' )
				,	html = new EJS({ url: window.Constants.JSTemplates + "suggest list/ListSuggestion.tooltip.ejs?v=0.11" })
						.render( data.data.collection[ 0 ] );

				$( '#' + targetId ).append( html );
			}

			// Show form errors
		,	showError: function( error ) {

				var target = '.SuggestList-modal .error-message'
				,	form = '#form-suggestList'
				,	submit = $( form ).find( 'input[type="submit"]' );

				$( submit ).removeClass( 'disabled' )
					.attr( 'value', submit.data( 'original-text' ) );

				// $( target ).slideDown( 100 );

				utilities.alert( 'Please fill all the data in the form.', 'failure' );

			}

			// Shows the feedback on save
		,	onSave: function( model, data ) {

				var form = '#form-suggestList'
				,	submit = $( form ).find( 'input[type="submit"]' );

				submit.removeClass( 'disabled not-logged-in' )
					.attr( 'value', submit.data( 'original-text' ) );

				switch ( data.status ) {
					case 200:
						utilities.alert( data.text );
						break;

					case 600:
						utilities.alert( data.text, 'failure' );
						break;
				}

				utilities.clearForm( form );

			}

			// Called after vote response
		,	onVote: function( model, data ) {

				var newSuggestion = data.data.s
				,	upcount = data.data.up_count
				,	downcount = data.data.down_count;

				model.ID = newSuggestion.ID;
				model.description = newSuggestion.description;
				model.votes = newSuggestion.votes;

				var type = $( this.target ).data( 'vote-type' )
				,	text = upcount == 1 ? 'vote' : 'votes';


				switch ( type ) {
					case 'up':
						// $( this.target ).html( '<a href="#" class="vote-list logged-in" data-author="' + newSuggestion.author + '" data-list-id="' + newSuggestion.ID + '" data-vote-type="up"><i class="icon-thumbs-up-alt"></i> ' + upcount + ' ' + text + '</a>' );
						$( this.target ).html( '<a href="#" class="vote-list logged-in" data-author="' + newSuggestion.author + '" data-list-id="' + newSuggestion.ID + '" data-vote-type="up"><i class="icon-plus-sign"></i> ' + upcount + ' ' + text + '</a>' );

						$( this.target ).next().html( '<a href="#" class="vote-list logged-in" data-author="' + newSuggestion.author + '" data-list-id="' + newSuggestion.ID + '" data-vote-type="down"><i class="icon-thumbs-down-alt"></i> ' + downcount + '</a>' );
						break;
				}

			}

			// Render all lists suggestions
		,	onLoadLists: function( model, data ) {

				var html = new EJS({ url: window.Constants.JSTemplates + "suggest list/ListSuggestion.topRank.ejs?v=0.27" }).render( data.data );
				$( '.list-top-rank' ).html( html );
			}

	});

	// Global Exposition
	window.Bppl.Views.ListSuggestion = new ListSuggestion();


})( this.jQuery, this, this.document, this.Bppl.Models.ListSuggestion, this.Bppl.Helpers.Utilities, undefined );
/**
*
* View Builder
*/
( function( $, window, document, utilities ) {

	var Builder = Gillie.View.extend({


			// Set the term choosed in select box
			addTerm: function( data, box, input ) {

				var li = $( '<li>' )
				,	a = $( '<a>' )
				,	i = $( '<i>' )
				, 	ul = $( box ).children( 'ul' );

				a.attr( 'class', 'label-pick' );
				a.attr( 'id', data.refer );

				$.each( data, function( key, value ) {

					key = utilities.cammelCaseToHyphen( key );

					$( a ).attr( 'data-' + key, value );
				});

				i.attr( 'class', 'icon-remove' );
				a.append( i, ' ' + data.name );

				$( li ).prepend( a );

				if ( $( box ).hasClass( 'category-filter' ) ) {

					ul.empty();
					ul.append( li );

				}

				ul.append( li );

				$( input ).appendTo( ul );
			}

			// drop term from select box
		,	dropTerm: function( selector ) {

				$( selector ).remove();

			}

			// Add loading state and label maessage to home posts
			// placeholder and filters
		,	loadingState: function( message, label ) {

				var pinboards = '.pinboards-count'
				,	selCategory = '.category-selected'
				,	placeholder = '.Home-postcollection-placeholder';

				$( pinboards ).html( message )
					.css({ display: 'inline-block' });

				$( selCategory )
					.html( label + '<span class="icon-remove category-unselected"></span>' )
					.css({ display: 'inline-block' });

				// Add loading state collection placeholder
				$( placeholder ).addClass( 'disabled' );
			}

	});

	// Global Exposition
	window.Bppl.Views.Builder = new Builder();



})( this.jQuery, this, this.document, this.Bppl.Helpers.Utilities, undefined );
/**
*
* View PostCollection
*/
( function( $, window, document, model, utilities ) {

	var PostCollection = Gillie.View.extend({

			initialize: function() {

				// Render home posts
				model.on( 'renderHome', this.renderHomePosts );

				// Render pagination
				model.on( 'renderHome', this.renderPagination );

				// Render posts on pagination
				model.on( 'paginate', this.renderHomePosts );

				// Render pagination
				model.on( 'paginate', this.renderPagination );

				// On next and prev
				model.on( 'nextPrev', this.setHash );

				// Loading state
				model.on( 'disabled', this.loadingState );

			}

			// Renders the post and pinboards of the home page
			// based on the posts given from the server
		,	renderHomePosts: function( model, data ) {

				var layoutView = model.layout_view
				,	templateName, html, superlists
				,	termSuperlists = '.keyword-filters'
				,	container = '.Home-postcollection-placeholder'
				,	collection = '.Home-postcollection-placeholder';

				if ( data.data.posts.found_posts == 0 ) {

					templateName = 'Home.PostCollection.emptyView.ejs'

				} else if ( layoutView == 'grid' ) {

					templateName = 'Home.gridView.ejs?v=2';

				} else if ( layoutView == 'list'  ) {

					templateName = 'Home.listView.ejs?v=3'
				}

				// Add limit method
				data.data.limit = utilities.limit;
				data.data.posts.post_type = model.list_id == 0 ?
					'post': 'list';


				// Add page urls
				var urls = {
						code_url: 'CONTENT_TYPE_CODE_URL'
					,	freebie_url: 'CONTENT_TYPE_FREEBIE_URL'
					,	resource_url: 'CONTENT_TYPE_RESOURCE_URL'
				}

				$.each( urls, function( k, v ) {
					data.data.posts[ k ] = window.Constants[ v ];
				});

				// Get superlists
				if ( data.data.term_superlists ) {
					superlists = utilities.render( 'term-superlists', { items: data.data.term_superlists });
				}


				// Render markup
				html = new EJS({ url: window.Constants.JSTemplates + templateName })
					.render( data.data.posts );

				if ( ! model.superlist_id ) {
					$( termSuperlists ).html( superlists || '' );
				}

				$( container ).html( html );
				$( container ).removeClass( 'disabled' );
				// lab zone
				if( model.category_name && $( 'div' ).hasClass( 'query-description' ) ) {
					$( '.Home-postshome-results' ).insertBefore( '.query-description' );
					$( '.query-description' ).remove();
					$( '.floating-actions' ).remove();
				}

				// Hide global notification
				$( '.global-notifications' ).hide();

				return;

			}

			// Renders the pagination.
		,	renderPagination: function( model, data ) {

				var pagination = '.Home-postshome-wrapper > .pagination > ul'
				,	pages = Math.ceil( parseInt( data.data.posts.found_posts ) / 8 )
				,	current_page = model.page
				,	start, end;


				// Show pages from 1 to 10. If the total number
				// of pages is equal or lower than 10.
				if ( pages <= 10 ) {

					// Pages from 10 to 10.
					start = 1; end = pages;
				}

				// If we have more than 10 pages in total.
				else if ( pages > 10 ) {

					// Show pages from 1 to 10.
					if ( current_page <= 6 ) {
						start = 1; end = 10;
					}

					else {

						// If there are more than 4 next pages remaining,
						// show the previous 5 pages, the actual one and 4 next more.
						if ( pages - current_page >= 4 ) {
							start = current_page - 5;
							end = current_page + 4;
						}

						// Otherwise Show a range of 10 pages
						// until the last page.
						else if ( pages - current_page < 4 ) {
							start = pages - 9;
							end = pages;
						}
					}
				}

				// Get markup
				var	markup = new EJS({ url: window.Constants.JSTemplates + 'PostCollection.pagination.ejs' })
					.render({ number_of_pages: pages, current_page: model.page, start: start, end: end  });

				// Print pagination
				$( pagination ).html( markup );

			}

			// Set the hash.
		,	setHash: function( model ) {
				// Set the hash to the browser history.
				if ( model.category_name )
					utilities.updatePath( '/' + model.category_name + '/page/' + model.page );
				else
					utilities.updatePath( '/page/' + model.page ) ;
			}

			// Add opacity to home post collection
		,	loadingState: function( model ) {

				var placeholder = '.Home-postcollection-placeholder';

				$( placeholder ).addClass( 'disabled' );
			}

	});


	// Global Exposition
	window.Bppl.Views.PostCollection = new PostCollection();


})( this.jQuery, this, this.document, this.Bppl.Models.HomePostCollection, this.Bppl.Helpers.Utilities, undefined );
/**
*
* View LayoutView
*/
( function( $, window, document, model, utilities ) {

	var LayoutView = Gillie.View.extend({

			initialize: function() {

				// Render home posts
				//model.on( 'renderHome', this.renderHomePosts );
			}

			// Renders the post and pinboards of the home page
			// based on the posts given from the server
		,	change: function( mode, data ) {


				// TODO: render
				switch ( mode ) {
					case 'list':

						var html = new EJS({ url: window.Constants.JSTemplates + "Home.listView.ejs" }).render( data );

						// console.log( window.Constants.JSTemplates );

						// This is the selector of the content
						$( '.Home-postshome-results' ).html( html );

						break;

					case 'grid':
						var html = new EJS({ url: window.Constants.JSTemplates + "Home.gridView.ejs" }).render( data );

						// This is the selector of the content
						$( '.Home-postshome-results' ).html( html );

						break;
				}
			}

	});


	// Global Exposition
	window.Bppl.Views.LayoutView = new LayoutView();


})( this.jQuery, this, this.document, this.Bppl.Models.LayoutView, this.Bppl.Helpers.Utilities, undefined );
/**
*
* View Comment
*/
( function( $, window, document, model, utilities ) {

	var Comment = Gillie.View.extend({

			initialize: function() {


			}

			// Renders a form underneath the current comment
		,	showCommentForm: function( data, target ) {

				var html = new EJS({ url: window.Constants.JSTemplates + "Single.CommentForm.ejs?V=0.3" }).render( data.attributes );
				$( target ).parent().slideUp( 200 );
				$( target ).parent().after( html );
				$( target ).parent().slideDown( 200 );
			}

			// Hides the comment form associated with the current target
		,	hideCommentForm: function( target ) {

				$( target ).find( 'div.comments-form' )[0].remove();
			}

			// Render the view of the comment saved
		,	onSave: function( model, data ) {

				// Show the feedback message
				utilities.alert( 'Comment saved' );

				var	submit = '.save-comment';

				// Were there an error saving the comment?
				if ( utilities.isAjaxError( data ) ) {
					$( submit ).removeClass( 'disabled' )
						.attr( 'value', $( submit ).data( 'original-text' ) );

					return utilities.alert( data.text );
				}

				var comment = data.data.comment;

				// Set model attributes for rendering
				model = $.extend( model, {
						id: comment.comment_ID
					,	author: comment.author
					,	content: comment.comment_content
					,	parent_id: comment.comment_parent
					,	publish_date: comment.comment_date
					,	lower_depth: model.depth < 6
				});


				// var html = new EJS({ url: window.Constants.JSTemplates + "Single.NewComment.ejs?v=0.2" }).render( model );
				var html = utilities.render( 'Single.NewComment', model );

				// When the depth is 1, add the comment to comments-parent list
				if( model.depth == 1 ) {

					var li = $( '<li>', { id: 'comment-' + model.id } ).prependTo( 'ul.comments-parent' );
					$( '#comment-' + model.id ).html( html );
				}

				// When the depth is 2 or more, add the comment to the children list of the parent comment
				if ( model.depth >= 2 ) {

					var li = $( '<li>', { id: 'comment-' + model.id }).html( html );

					// Add children ul so the user can add children comments to the new comment added previously
					var ul = $( '<ul>', { class: 'children' } );

					// Add the new ul to DOM
					ul.push( ul[ 0 ] );
					$( '#comment-' + model.id ).after( ul );

					// Add the new li to DOM
					li.push( li[ 0 ] );
					$( '#comment-' + model.parent_id ).next( '.children' ).prepend( li );

				}

				// If comment is created in live
				// Add children ul so the user can add children comments to the new comment added previously
				var ul = $( '<ul>', { class: 'children' } );

				// Add the new ul to DOM
				ul.push( ul[ 0 ] );

				$( '#comment-' + model.id ).after( ul );


				// Increase the comments count
				var comments_count = comment.post_comment_count.total_comments;
				$( 'span.comments-count' ).text( comments_count );

				// Refresh time ago
				utilities.timeAgo();

				// Clean the textarea
				$( '#form-comment-0' ).find( 'textarea' ).val( '' );

				// Destroy all minified login
				$( '.min-login' ).remove();

				// Destroy the class not-logged-in of the save button
				$( '.save-comment' ).removeClass( 'not-logged-in' ).addClass( 'logged-in' );

				// Destroy all forms created in live
				$( '.comment-form-live' ).remove();

				// Reset the button text to its original state.
				$( submit ).attr( 'value'
					, $( submit ).data( 'original-text' )
				).removeClass( 'disabled' );

			}

			// On comment save
		,	onPopoverSave: function( _model, response ) {

				var formSel = '.list-item-comment-form'
				,	trigger = '.item-comment-popover';

				utilities.stopWorking( formSel );
				$( trigger ).popover( 'hide' );

				// Show the feedback message
				utilities.alert( 'Comment saved' );

		    }

			// Show form errors
		,	showError: function( post_id, error ) {

				var target = '.popover.comments#' + post_id + ' .error-message'
				,	form = '.list-item-comment-form'
				,	submit = $( form ).find( 'input[type="submit"]' );

				$( submit ).removeClass( 'disabled' )
					.attr( 'value', submit.data( 'original-text' ) );

				$( target ).slideDown( 100 );

			}

	});

	// Global Exposition
	window.Bppl.Views.Comment = new Comment();


})( this.jQuery, this, this.document, this.Bppl.Models.Comment, this.Bppl.Helpers.Utilities, undefined );
/**
*
* View Like
*/
( function( $, window, document, model, utilities ) {

	var Like = Gillie.View.extend({

			initialize: function() { }

			// Triggered on like response received.
		,	onSave: function( model, data ) {

				var	count, el;

				// Post
				if ( model.type == 'post' ) {

					el = '.post-body .actions .like-' + model.item_id;

					$( el ).removeClass( 'disabled' );

					if ( utilities.isAjaxError( data ) ) {
						return utilities.alert( data.text );
					}

					// Assign count
					count = data.data.count;

					// Alter like count
					$( el ).find( 'span.like-count' ).text( count );

					if ( data.data.is_liked ) {
						$( el ).find( 'i' ).css( 'color', '#cc2521' );
					}

					else {
						$( el ).find( 'i' ).css( 'color', '#5a5a5a' );
					}

					// Update text count
					if ( count == 1 ) {
						$( el ).find( '.bold' ).text( 'Like' );

					} else {
						$( el ).find( '.bold' ).text( 'Likes' );
					}
				}

				// Comment
				else if ( model.type == 'comment' ) {

					// On error
					if ( data.data.error ) {

						window.Bppl.Views.User.toggleLogin( 'user.login' );
					}

					el = '.post-comments .like-' + model.item_id;

					// Remove loading state
					utilities.stopWorking( el );
					if ( utilities.isAjaxError( data ) ) {
						// return utilities.alert( 'This email is already registered' );
						return utilities.alert( data.text );
					}

					// return utilities.alert( 'Welcome to Bypeople. Pls check your email account and click on the confirmation link.' );

					// Assign count
					count = data.data.count;

					// Alter like count
					$( el ).find( 'span.like-count' ).text( count );


					if ( data.data.is_liked ) {
						$( el ).find( 'i' ).css( 'color', '#00a0b5' );
					} else {
						$( el ).find( 'i' ).css( 'color', '#888' );
					}
				}

			}

		, 	onListLike: function( _model, response ) {

				// console.log( _model, response );

				if ( response && response.data && response.data.error ) {

					// window.Bppl.Views.User.toggleLogin( 'user.login' ); enable on list like
					return;
				}

				if ( response.status && response.status == 600 ) {
					utilities.alert( response.text );
					return;
				}

				var changeColor = '.heart-' + _model.item_id;

				$( changeColor ).toggleClass( 'icon-change-color-heart' );

				if ( $( changeColor ).hasClass( 'icon-change-color-heart' ) ) {

					// console.log( 'me siento sucio, manoceame' );
					$( changeColor ).parent().find( '.follow-txt' ).text( 'Following' );
					$( changeColor ).parent().toggleClass( 'liked' );
					$( changeColor ).parent().find( '.liked-text' ).text( 'liked' );
					utilities.alert( 'The item has been marked as favorite. <a href="' + window.Constants.siteURL + 'author/' + window.Constants.OWNER + '/#the-post-likes" target="_blank">Check it.</a>' );
				}

				else {

					// console.log( 'Oh que limpio estoy' );
					$( changeColor ).parent().find( '.follow-txt' ).text( 'Follow list' );
					$( changeColor ).parent().toggleClass( 'liked' );
					$( changeColor ).parent().find( '.liked-text' ).text( 'like' );
					utilities.alert( 'The item has been removed from your favorites.' );
				}

				// list and post in home  ( latest template )
				// var changeColor = '.like-' + _model.item_id;

				// $( changeColor + ' a' ).toggleClass( 'liked' );

				// if ( $( changeColor + ' a' ).hasClass( 'liked' ) ) {

				// 	$( changeColor ).parent().find( '.follow-txt' ).text( 'liked' );
				// 	utilities.alert( 'The item has been marked as favorite. <a href="' + window.Constants.siteURL + 'author/' + window.Constants.OWNER + '/#the-post-likes" target="_blank">Check it.</a>' );
				// }

				// else {

				// 	$( changeColor ).parent().find( '.follow-txt' ).text( 'like' );
				// 	// utilities.alert( 'The item has been removed from your favorites.' );
				// }

			}

	});

	// Global Exposition
	window.Bppl.Views.Like = new Like();


})( this.jQuery, this, this.document, this.Bppl.Models.Like, this.Bppl.Helpers.Utilities, undefined );
/**
*
* View List
*/
( function( $, window, document, model, utilities ) {

	var List = Gillie.View.extend({

			initialize: function() {

				// Organizes the colash for a list
				this.renderListFeaturedImage();

				// Styles the colash for every post
				this.renderCatListFeatImage();
			}


			// Render all user lists
		,	onSuccessUserLists: function( model, data ) {

				var lists = data.data.lists;
				var html = utilities.render( 'AddToList.userLists', data.data );

				$( '.lists-wrapper' ).html( html );
				utilities.timeAgo();
			}

			// Render the view when item has been pushed on or out from list
		,	onToggle: function( model, data ) {

				$.extend( model, data.data.list );

				if( $( '#' + model.ID ).hasClass( 'has-item' ) ) {

					$( '#' + model.ID ).removeClass( 'has-item' );

				}
				else {

					$( '#' + model.ID ).addClass( 'has-item' );

					// Sending updates to users
					$( '.lists-wrapper' ).removeClass( 'action-info' );
					$( '.sending-mails-info' ).remove();
				}

				$( '.lists-wrapper' ).removeClass( 'action-info' );

				$( '#' + model.ID ).find( '.AddToList-items-count' ).text( model.item_count );

			}

			// Build the featured image of a list
		,	renderListFeaturedImage: function() {

				if( $( '.list-canvas' ).length > 0 ) {

					$( '.list-canvas' ).css( 'position', 'relative' );

					$.each( $( '.list-canvas' ).children( 'img' ), function( key, img ){

						if( key > 0 ) {

							$(img ).css( { width:'250px', height:'auto', position:'absolute', top:'0', left: '0', border:'0' } );

							switch ( key ) {
								case 2:
									$( img ).css( { top:'0', left: '350px' } );
									break;

								case 3:
									$( img ).css( { top:'235px', left: '0' } );
									break;

								case 4:
									$( img ).css( { top:'235px', left: '350px' } );
									break;
							}
						}

					});
				}
			}

			// Build the featured image of a list
		,	renderCatListFeatImage: function() {

				var canvas = '.cat-main-page .viewport';
				if ( $( canvas ).length < 1 ) return;

				$.each( $( canvas ), function() {

					$.each( $( this ).children( 'img' ), function( key, img ) {

						if ( key > 0 ) {
							$( img ).css({ width: 200, height: 'auto', position: 'absolute', top: 5, border: 0 });

							if ( key == 2 ) {
								$( img ).css({ top: 5, left: 405 });
							}

							else if ( key == 3 ) {
								$( img ).css({ top: 92, left: 5 });
							}

							else if ( key == 4 ) {
								$( img ).css({ top: 92, left: 405 });
							}
						}

					});
				});

			}

		,	onListFeat: function ( model, data ) {

				var listId = data.data.list.ID
				input = $( '.wf-list.' + listId );

				if ( input.is( ':checked' ) )
					utilities.alert( 'The list was added to featured lists.' );
				else
					utilities.alert( 'The list has been removed from featured lists.' );

			}

	});

	// Global Exposition
	window.Bppl.Views.List = new List();


})( this.jQuery, this, this.document, this.Bppl.Models.List, this.Bppl.Helpers.Utilities, undefined );
/**
*
* View Flag
*/
( function( $, window, document, model, utilities ) {

	var Flag = Gillie.View.extend({

			// Open the flag modal with
			openModal: function( type ) {

				var modal = '.Flag-modal'
				,	input = $( modal ).find( 'form input[ name="item-type" ]' );

				// Set type to model
				input.attr( 'value', type );

				$( modal ).toggle();
                $( '.modal-backdrop' ).toggle();

			}

			// Triggered on save
		,	onSave: function( model, data ) {

				var form = '#form-flag-content'
				,	submit = $( form ).find( 'input[type="submit"]' );

				utilities.stopWorking ( form );

				switch ( data.status ) {
					case 200:
						utilities.showGlobalNotification( data.text, '', 'success', null, 4000 );
						utilities.clearForm( form );
						break;

					case 600:
						utilities.showGlobalNotification( data.text, '', 'failure', null, 4000 );
						break;
				}

			}

	});

	// Global Exposition
	window.Bppl.Views.Flag = new Flag();


})( this.jQuery, this, this.document, this.Bppl.Models.Flag, this.Bppl.Helpers.Utilities, undefined );
/**
*
* View Follow
*/
( function( $, window, document, model, utilities ) {

	var Follow = Gillie.View.extend({

			initialize: function() {

				// Global target
				this.target = document;
			}

		,	onProfileFollow: function( model, data ) {

				var type = $( this.target ).data( 'button-type' )
				,	following = data.data.following
				,	followers_count = data.data.followers_count;


				if( following ) {
					switch ( type ) {
						case 'button-bordered':
							$( this.target ).html( '<i class="icon-star"></i> <span class="bold">FOLLOWING</span>' );
							break;

						case 'link':
							$( this.target ).text( 'unfollow' );
							break;
					}

					$( this.target ).addClass( 'following' );
				}

				if( ! following ) {
					switch ( type ) {
						case 'button-bordered':
							$( this.target ).html( '<i class="icon-star"></i> <span class="bold">FOLLOW</span>' );
							break;

						case 'link':
							$( this.target ).text( 'follow' );
							break;
					}

					$( this.target ).removeClass( 'following' );
				}

				$( '.followers-count' ).text( followers_count );

			}

			// Render the button text when user hover it and the class is following
		,	onFollowingHover: function( target, type, hover ) {

				if( hover ) {

					switch ( type ) {
						case 'button-bordered':
							$( target ).html( '<i class="icon-star"></i> <span class="bold">Unfollow</span>' );
							break;

						case 'link':
							$( target ).text( 'unfollow' );
							break;
					}

					return;
				}

				switch ( type ) {
					case 'button-bordered':
						$( target ).html( '<i class="icon-star"></i> <span class="bold">Following</span>' );
						break;

					case 'link':
						$( target ).text( 'following' );
						break;
				}
			}

			// Called after grid view follow
		,	onHomeGridViewFollow: function( model, response ) {

				// On error
				if ( response.data.error ) {

					window.Bppl.Views.User.toggleLogin( 'user.login' );
				}

				// Following
				if ( response.data.following ) {

					var followBtn = $( this.target ).data( 'user-id' );

					$( 'a.follow-user[data-user-id="' + followBtn + '"]' ).each( function() {
						$( this ).text( 'Following' )
						.addClass( 'btn-success' );
					});
				}

				// Not following
				else {

					var followBtn = $( this.target ).data( 'user-id' );

					$( 'a.follow-user[data-user-id="' + followBtn + '"]' ).each( function() {
						$( this ).text( 'Follow' )
						.removeClass( 'btn-success' );
					});

				}

				// Change button text
				$( this.target ).removeClass( 'disabled' );

			}

	});

	// Global Exposition
	window.Bppl.Views.Follow = new Follow();


})( this.jQuery, this, this.document, this.Bppl.Models.Follow, this.Bppl.Helpers.Utilities, undefined );
/**
*
* View Carousel
*/
( function( $, window, document, model, utilities ) {

	var Carousel = Gillie.View.extend({

			initialize: function() {

				this.carousel = document;
				this.control = document;
				this.model = {};

			}

			// Trigged when data has been returned from server.
		,	onLoad: function( model, data ) {

				if( ! data.data.fullLoad ) {

					var html = new EJS({ url: window.Constants.JSTemplates + "/Carousel.Pages.ejs?v=0.0" })
						.render( data.data );

					$( this.carousel ).append( html );

					this.next( this.carousel );

					// Update the "data-loaded-pages" attribute to actually have
					// the number of pages we're loaded.
					$( this.carousel ).data( 'loaded-pages', model.loadedPages + model.numberOfPages );

					this.setLabelCount( model, true );

				}
				else {

					$( this.control ).removeClass( 'disabled' );
					$( this.carousel ).children( '.carousel-overlay' ).remove();
				}

			}

			// Displays the next page from the current displayed
		,	next: function( carousel ) {

				$.each( $( carousel ).children( 'ul' ), function( key, page ) {

					if( $( page ).is( ':visible' ) ) {

						var carouselPageId = '#' + $( carousel ).attr( 'id' ) + ' #' + $( page ).next( 'ul' ).attr( 'id' );

						utilities.setImageUrl( carouselPageId );

						$( page ).hide( 'slide', {

							direction: 'left',
							complete: function() {
								$( page ).next( 'ul' ).show( 'slide', { direction: 'right' } );
							}
						});

						return false;
					}

				});

				$( this.control ).removeClass( 'disabled' );
				$( carousel ).children( '.carousel-overlay' ).hide();

			}

			// Displays the prev page from the current displayed
		,	prev: function( carousel ) {

				$.each( $( carousel ).children( 'ul' ), function( key, page ) {

					if( $( page ).is( ':visible' ) ) {

						if( typeof $( page ).prev( 'ul' ).attr( 'id' ) != 'undefined' ) {

							$( page ).hide( 'slide', {
								direction: 'right',
								complete: function() {
									$( page ).prev( 'ul' ).show( 'slide', { direction: 'left' } );
								}
							});

							return false;
						}
					}

				});

			}

			// Verifies whether the current displayed page is the last one
		,	isLastPage: function( carousel ) {

				var page = $( carousel ).children( 'ul:visible' );

				return $( page ).is( ':last-child' );
			}

			// Changes the label count values
		,	setLabelCount: function( data, increase ) {


				/*var _bottomCount = $( this.carousel ).children( 'span.bottom-count' )
				,	_topCount = $( this.carousel ).children( 'span.top-count' )
				,	bottomCount = $( _bottomCount ).text()
				,	topCount = $( _topCount ).text();

				if( increase ) {
					$( this.carousel ).children( 'span.bottom-count' ).text( topCount + 1 );
					$( this.carousel ).children( 'span.top-count' ).text( topCount + data.numberItems );
					return;
				}

				$( this.carousel ).children( 'span.bottom-count' ).text( bottomCount - data.numberItems );
				$( this.carousel ).children( 'span.top-count' ).text( topCount - data.numberItems );*/


			}

	});

	// Global Exposition
	window.Bppl.Views.Carousel = new Carousel();


})( this.jQuery, this, this.document, this.Bppl.Models.Carousel, this.Bppl.Helpers.Utilities, undefined );
/**
*
* View Bookmarklet
*/
( function( $, window, document, model, utilities ) {

	var Bookmarklet = Gillie.View.extend({

			// Init
			initialize: function() {

                // Only initialize the bookmarklet page is present.
                var el = '.bookmarklet-body';
                if ( ! $( el ).length ) {
                    return;
                }

				// Set featured image uploader
                this.initUploader({
                        id: 'bookmarklet-image'
                    ,   slug: 'featuredImage'
                    ,   buttonText: 'Upload Featured Image'
                    ,   dragZoneText: 'Featured Image'
                    ,   dropAreaClass: 'featured-image-dragger'
                    ,   url: '/uploader.feat-image.php'
                });

                // Set attachment uploader
                this.initUploader({
                        id: 'attachment'
                    ,   slug: 'attachment'
                    ,   buttonText: 'Upload Attachment'
                    ,   dragZoneText: 'Attachment'
                    ,   dropAreaClass: 'attachment-dragger'
                    ,   url: '/uploader.attachment.php?direct'
                });

                // Set additional image uploader
                this.initUploader({
                        id: 'additional'
                    ,   slug: 'additional_images'
                    ,   buttonText: 'Upload Additional Images'
                    ,   dragZoneText: 'Additional Images'
                    ,   dropAreaClass: 'additional-dragger'
                    ,   url: '/uploader.php'
                });

                // Post data
                this.post = {
                        featuredImage: ''
                    ,   attachment: ''
                    ,   additional_images: []
                    ,   tags: {
                            collection: []
                        }

                    // Categories in post
                    ,   categories: {
                                key: []
                            ,   enviroment: []
                        }

                    // Categories that were not registered
                    ,   newCats: []
                    ,   title: ''
                    ,   content: ''
                    ,   externalLink: ''
                    ,   cont_type: ''
                    ,   ID: ''
                    ,   list_id: ''
                }

				// Tags Change event
                $( this.post.tags ).bind( 'change', this.onToggleTag );

                // Categories change event
                $( this.post.categories ).bind( 'change', this.onToggleCat );

                // Save post
                $( this ).bind( 'savePost', this.onSavePost );
                $( this ).bind( 'savePostError', this.onSaveError );

                // Listen for hash chage
                this.onHashChange();
                $( window ).on( 'hashchange', this.onHashChange );

                // Listen for type input selection
                $( '.bookmarklet .type-input' ).on( 'focus', this.onKeyInputFocus );

                // Setup shortcuts
                this.setupShortcuts();

			}

			// Init uploader
        ,   initUploader: function( args ) {

                var _this = this
                ,   markup = utilities.render( 'bookmarklet.uploader', args )
                ,   uploader
                ,   uploader_additional;

                // Prevent setting the uploader up if the
                // element is not present
                if ( typeof args.id != "string" || typeof args.url != "string" ) return false;
                if ( ! $( '#' + args.id ).length ) return;

                uploader = new qq.FileUploader({
                        element: document.getElementById( args.id )
                    ,   action: window.Constants.libsUrl + args.url
                    ,   debug: true
                    ,   multiple: false
                    ,   template: markup
                    ,   fileTemplate: '<li>' +
                                '<span class="qq-progress-bar"></span>' +
                                '<span class="qq-upload-spinner">+</span>' +
                                '<span class="qq-upload-finished"></span>' +
                                '<span class="qq-upload-file"></span>' +
                                '<span class="qq-upload-size"></span>' +
                                '<a class="qq-upload-cancel" href="#">Cancel</a>' +
                            '</li>'

                    ,   onProgress: function ( id, fileName, loaded, total ) {
                            // console.log( id, fileName, loaded, total );
                            $( '.save-post-button' ).attr( 'disabled', 'disabled' );
                        }

                    ,   onComplete: function( id, filename, response ) {

                            if ( response.fitSize == false ) {
                                return alert( 'The image must be 800x400' );
                            }

                            // Store the image or attachment or additional

                            switch ( args.slug ) {
                                case 'attachment':
                                    _this.post.attachment = response.file_name;
                                    break;
                                case 'featuredImage':
                                    _this.post.featuredImage = response.url;
                                    break;
                            }

                            $( '.save-post-button' ).removeAttr( 'disabled' );

                            // Show notification

                        }
                });

                if ( args.slug == 'additional_images' ) {

                    uploader_additional = new qq.FileUploader({
                            element: document.getElementById( args.id )
                        ,   action: window.Constants.libsUrl + args.url
                        ,   debug: true
                        ,   multiple: true
                        ,   template: markup
                        ,   fileTemplate: '<li>'
                                    + '<span class="qq-progress-bar"></span>'
                                    + '<span class="qq-upload-spinner">+</span>'
                                    + '<span class="qq-upload-finished"></span>'
                                    + '<span class="qq-upload-file"></span>'
                                    + '<span class="qq-upload-size"></span>'
                                    + '<a class="qq-upload-cancel" href="#">Cancel</a>'
                                + '</li>'

                        ,   onComplete: function( id, filename, response ) {

                                // Store the image or attachment or additional
                                $('#images_to_feat').append('<li><span class="close">&times;</span><img src="' + response.img_url_th + '" data-img-original-src="' + response.img_url + '" data-img_url="' + response.img_url_ft + '" alt="" /></li>');

                                _this.post.additional_images.push( response.img_url );

                            }
                    });

                }

            }

            // On toggle tag
        ,   onToggleTag: function( e, tagsCollection ) {

                var tags = '.selected-tags .attribute-tags-view'
                ,   html = $( '<div></div>' );

                $.each( tagsCollection.collection, function( key, val ) {
                    html.append( '<label class="label">' + val + '</label> ' );
                });

                $( tags ).html( html );

            }

            // On toggle Term
        ,   onToggleCat: function( e, data ) {

                var cats = '.selected-tags .' + data.parent + '-cats'
                ,   html = $( '<div></div>' );

                $.each( data.collection, function( key, val ) {
                    html.append( '<label class="label">' + val + '</label> ' );
                });

                $( cats ).html( html );
            }

            // After post saved
        ,   onSavePost: function( e, data ) {

                var saveBtn = '.save-post-button'
                ,   text = $( saveBtn ).data( 'original-text' )
                ,   closeOnSave = window.localStorage.getItem( 'bookmarklet.options.closeOnSave' );

                $( saveBtn ).removeClass( 'disabled' )
                    .text( text );

                // Show popover
                this.showPopover( data.data.permalink );

                // Whether to close bookmarklet
                if ( closeOnSave ) {
                    console.log( data );
                    console.log( 'Closing...' );
                    // window.close();
                }
            }


            // Handle error
        ,   onSaveError: function( e, data ) {
                console.log( data );
                return alert( 'Please login in order to save the post.' );
            }

            // Shows the popover for the save button
        ,   showPopover: function( permalink ) {

                var popover = '.popover'
                ,   target = '.save-post-button';

                // Set content
                $( popover ).find( '.popover-content' )
                    .html( '<p>Post saved.</p><p><a href="' + permalink + '">View Post</a></p>' );

                // Get position
                var offset = $( target ).offset()
                ,   targetWidth = $( target )[ 0 ].offsetWidth
                ,   targetHeight = $( target )[ 0 ].offsetHeight
                ,   popoverWidth = $( popover )[ 0 ].offsetWidth
                ,   popoverHeight = $( popover )[ 0 ].offsetHeight;

                // Taken the half
                // Calculate the half of the target
                // Place the half of the popover
                // in such spot

                // Half
                var half = offset.left + targetWidth / 2;
                half = half - popoverWidth / 2;

                // Top
                var offsetTop = popoverHeight + 10;

                // Place popover
                $( popover ).css({
                        top: offset.top - offsetTop - 95
                    ,   left: half - 58
                }).show();

            }

            // Listenes for chages in the hash
        ,   onHashChange: function( e )  {

                var actions = [ 'section-1', 'section-2' ]
                ,   action =  window.location.hash
                ,   content = ".bookmarklet-page .content"
                ,   saveBtn = ".bookmarklet-page .save-post-button";


                if ( typeof action != "string" ) return;
                action = action.replace( "#", "" );

                // Show appropriate section
                if ( actions.indexOf( action ) == -1 ) return;
                var buttons = ".footer .save-post .slide-content";


                // Show section 1
                $( buttons ).addClass( 'hide' );
                if ( action == 'section-1' ) {

                    $( content ).animate({
                        marginLeft: 0
                    }, 200 );

                    $( buttons + '[data-action="section-2"]' ).removeClass( "hide" );
                    $( saveBtn ).addClass( "hide" );
                    $( ".elements-cats-input" ).focus();
                }


                // Show section 2
                if ( action == 'section-2' ) {

                    $( content ).animate({
                        marginLeft: -1200
                    }, 200 );

                    $( buttons + '[data-action="section-1"]' ).removeClass( "hide" );
                    $( saveBtn ).removeClass( "hide" );
                    $( ".enviroment-cats-input" ).focus();
                }

            }

            // Shortcuts
        ,   setupShortcuts: function() {

                // Shortcuts
                $( document ).keydown( function( e ) {

                    if ( e.ctrlKey ) {

                        // Swap section: Ctrl 37: <-, 39: ->
                        if ( e.keyCode == 37 ) {
                            window.location.hash = "#section-1";
                            return;
                        }

                        else if ( e.keyCode == 39 ) {
                            window.location.hash = "#section-2";
                            return;
                        }


                        // Move through inputs: Ctrl + up(38), Ctrl + down(40)
                        var focused = $( 'input[type="text"]:focus' )
                        ,   inputs = $( 'input[type="text"]' )
                        ,   index = inputs.index( focused );


                        // Move to previeus input: Ctrl + Up
                        if ( e.keyCode == 38 ) {

                            // Focus next input
                            if ( inputs.eq( index - 1 ).length ) {
                                inputs.eq( index - 1 ).focus();
                            }
                        }

                        // Move to next Input: Ctrl + Down
                        if( e.keyCode == 40 ) {

                            // Focus next input
                            if ( inputs.eq( index + 1 ).length ) {
                                inputs.eq( index + 1 ).focus();
                            }

                        }

                        // Save: Ctrl + s
                        if ( e.keyCode == 83 ) {
                            e.preventDefault();
                            $( '.bookmarklet  .save-post-button' ).trigger( 'click' );
                        }

                    }

                });

            }


            // Focus event
        ,   onKeyInputFocus: function() {

                $( 'body' ).animate({
                    scrollTop: 1000
                }, 300 );

            }

            // Show notificationss
        ,   showNotifications: function() {

                var target = ".bookmarklet .header"
                ,   html
                ,   dismissed = window.localStorage.getItem( 'bookmarklet.notification.v1.dismissed' );

                // Has user dismissed the notification?
                if ( dismissed ) return;

                // Show notification
                html = new EJS({ url: window.Constants.JSTemplates + 'bookmarklet.notification.ejs?v=1' }).render()
                $( target ).prepend( html )

            }

	});

	// Global Exposition
	window.Bppl.Views.Bookmarklet = new Bookmarklet();



})( this.jQuery, this, this.document, this.Bppl.Models.Bookmarklet, this.Bppl.Helpers.Utilities, undefined );

/**
*
* View Sharing
*/
( function( $, window, document, model, utilities ) {

	var Sharing = Gillie.View.extend({

			// Init
			initialize: function() {

				// Bind to newsletter save
				model.on( 'saveNewsletter', this.onSaveNewsletter );

				// Bind to double modal newsletter save
				model.on( 'saveNewsletterBoth', this.onSaveNewsletterBoth );

				// Bind direct download
				model.on( 'getLink', this.onDirectDownload );

				// Listen for event
				window.addEventListener( 'message', this.onOpenerMessage );

			}

			// On save newsletter download request.
		,	onSaveNewsletter: function( model, data ) {

				var form = '.modal-sharing-email'
			 	,	submit = $( form ).find( 'input[type="submit"]' );

				submit.removeClass( 'disabled' )
					.attr( 'value', submit.data( 'original-text' ) );


				if ( utilities.isAjaxError( data ) )
					return utilities.alert( 'Something went wrong.', 'success' );

				return utilities.alert( 'Download link has been sent to your email.', '', function() {
					utilities.openModal( form );

				});

			}

			// Fired on save of email download of both
			// methods modal.
		,	onSaveNewsletterBoth: function( model, data ) {

				// console.log( model, data );

				var form = '.modal-sharing-both-form'
				// var form = '.sharing-both-form-newsletter'
			 	,	submit = $( form ).find( 'input[type="submit"]' );

				submit.removeClass( 'disabled' )
					.attr( 'value', submit.data( 'original-text' ) );

				// console.log( data );
				if ( utilities.isAjaxError( data ) )
					return utilities.alert( 'Something went wrong.', 'success' );

				$( '.sharing-both-form-newsletter' ).find( 'input[type="submit"]' ).val( 'Signup and Download' ).removeClass( 'disabled' );

				return utilities.alert( 'Download link has been sent to your email.', '', function() {
					utilities.openModal( form );

				});

			}

			// Fired on save of email download of both
			// methods modal.
		,	onDirectDownload: function( model, data ) {

				// console.log( model, data );

				var form = '.modal-sharing-both'
				, 	url = data.data.url
				,	github = model.post_git;

				// utilities.log( model, github );

				// validation for github
				// console.log( github.indexOf( "github.com" ) );

				if ( data.data.message && data.data.message != '' ) {
					$( '.download-direct' ).attr( 'href', '#' )
			 			.removeClass( 'disabled download-direct' )
			 			.addClass( 'premium-feature' )
			 			.attr( 'data-modal', '.modal-photo-download' )
			 			.html( '<i class="icon-download"></i> Direct download' )
						.parent().append( '<p><a class="premium-feature" data-modal=".modal-photo-download">' + data.data.message + '</p></a>' );

			 		return;
				}


				// Continue download normally
				if ( github && github.indexOf( "github.com" ) != -1 ) {

					$( '.download-direct' ).removeClass( 'disabled' )
						.html( '<i class="icon-download"></i> Direct download' );

				 	$( '.download-direct' ).click( function( e ) {

				 		e.preventDefault();
				 		utilities.log( 'Trasfering...', model.post_git + 'archive/master.zip' );
				 		window.location = model.post_git + 'archive/master.zip';

				 	});

				 	// Used on social login
					localStorage.dwnLink = model.post_git + 'archive/master.zip';

				} else {
					// console.log( data.data.url );
			 		$( '.download-direct' ).attr( 'href', data.data.url )
			 			.removeClass( 'disabled' )
			 			.html( '<i class="icon-download"></i> Direct download' );

			 		// Used on social login
					localStorage.dwnLink = data.data.url;
				}


			}

			// Open one of the three sharing modals
			// passing "postId" to them.
		,	openModal: function( method, postId, postGit, extraData ) {

				// console.warn( extraData );

				var map = {
						social: '.modal-sharing-social'
					,	email: '.modal-sharing-email'
					,	both: '.modal-sharing-both'
					,	direct: '.modal-sharing-both'
					}
				,	el
				,	data = {};

				if ( typeof map[ method ] == 'undefined' ) {
					return false;
				}

				// Set post ID
				el  = map[ method ];
				$( el ).find( 'input[name="post-id"]' ).attr( 'value', postId );

				// Add post ID to Twitter and Facebook messages.
				$( el ).find( '.download-facebook, .download-twitter, .download-direct' )
					.attr( 'data-post-id', postId )
					.attr( 'data-post-extradata', extraData );

				//set download-direct for logged users
				if ( $( '.download-direct' ).length == 1 ) {

					data.post_id = postId;
					data.post_git = postGit;

					if ( extraData && extraData.length >= 1 )
						data.extra_data = extraData;

					// Send data with both options
					model.set( data );
					model.getLink( 'getLink' );
				}


				// Revise on social login only
				data.post_id = postId;
				data.post_git = postGit;

				if ( extraData && extraData.length >= 1 )
					data.extra_data = extraData;

				// Send data with both options
				model.set( data );
				model.getLink( 'getLink' );
				// Revise on social login only

				// Open modal
				utilities.openModal( el );

			}


			// Trigger when message is sent from opened window.
		,	onOpenerMessage: function( e ) {

				var data = e.data
				,	el = '.modal .download-twitter';

				if ( typeof e.data == undefined ) {
					return;
				}

				if ( e.data.key != 'twitter_sharing' ) {
					return;
				}

				if ( ! data.dwn_link.length ) {
					return;
				}

				// Take user to download
				$( '.in-download' ).show();
				$( '.modal-backdrop' ).trigger( 'click' );
				setTimeout( function () {

					utilities.downloadView();

					window.location = data.dwn_link;
				}, 1500 );

			}

	});

	// Global Exposition
	window.Bppl.Views.Sharing = new Sharing();


})( this.jQuery, this, this.document, this.Bppl.Models.Sharing, this.Bppl.Helpers.Utilities, undefined );
/**
*
* View Submitter
*/
( function( $, window, document, model, utilities ) {

	var Submitter = Gillie.View.extend({

			// Init
			initialize: function() {

				// Run on post saved
				model.on( 'save', utilities.bind( this.onSave, this ) );
				model.on( 'save', utilities.bind( this.cleanSubmitter ) );

			}

			// Hide all the tabs and show the passed one.
		,	changeTab: function( el ) {

				var tabs = '#bmAppContainer .bp-smt-types .bp-smt-types-item'
				,	activeCat = 'bp-active-category'
				,	href = $( el ).attr( 'href' )
				,	hide = 'sb-smt-tab-hide';

				$( tabs ).each( function() {
					$( this ).removeClass( activeCat );
				});

				// Add active class to intended tab.
				$( el ).addClass( activeCat );

				// Remove
				$( '[class^="sb-smt-tab-"], [class*= " sb-smt-tab-"]' )
					.addClass( hide );

				// Show actual view
				$( href ).removeClass( hide );

				// Fix the height of the textareas
				this.fixTextAreas();

			}

			// On complete feat image upload
		,	onFeatImgUploaded: function( response ) {

				var progBar = $( '.sb-smt-feat-img-progress' );

				// Store image path
				$( '#bp-attachment-url' ).val( response.url );

				// Did image fix intended size?
				if ( response.fitSize == true ) {
					$( '.sb-smt-image-container img' ).attr( 'src', response.url );
                	$( '.sb-smt-image-overlay' ).removeClass( "visible" );

                	// Store featured image
                	model.set( 'featured_image', response.url );
				}

				else {
					alert( 'The main image of the post must be 600px width and 400px height exactly.'  );
				}

			}

			// Trigger after each additional image is uploaded.
		,	onImageUploaded: function( el, id, response ) {

				var progress = '.bp-smt-uploads-image-progress'
				,	counter = '.bp-smt-additional-images-counter'
				,	imagesArr;

				// Show the image
				el.find( 'img' ).attr( 'src', response.img_url );

				// Old IE does not support progress, so, when the upload finishes,
				// fully fill the progress bar.
				el.find( progress )
					.css( 'width', '100%' );

				// Change the span value
				$( counter ).text( '( ' + parseInt( id + 1 ) + ' )' );

				// Add image to array.
				imagesArr = typeof model.get( 'images' ) == 'object' ?
					model.get( 'images' ) : [];

				imagesArr.push( response.img_url );
				model.set( 'images', imagesArr );

			}

			// Trigger on attachment upload completed.
		,	onAttachUploaded: function( response ) {

				if ( response.upload_directory ) {

					$( '.profile-img-btn' ).removeClass( 'active' );
					$( '.the-profile-img img' ).attr( 'src', window.Constants.imagesUrl + 'user/data/' + response.imgName );
					return;
				}

				// Add "one" text.
				$( '.bp-smt-attachment-description' ).text( '(1)' );

				// Store the path of the image.
				var attachments = typeof model.get( 'attachments' ) == 'object' ?
					model.get( 'attachments' ) : [];

				attachments.push( response.path );
				model.set( 'attachments', attachments );
			}


			// Loading animation for additional images upload.
		,	imageUploadProgress: function( el, uploaded, total )  {

				var progress = uploaded / total * 100;
				el.find( '.bp-smt-uploads-image-progress' ).css( 'width', progress + '%' );
			}

			// Do the loading effect while uploading the attachment.
		,	progressAttachUpload: function( upBytes, totalBytes ) {

				var progress = upBytes / totalBytes
				,	el = '#bp-smt-attachment-upload';

				// Fade in button.
				$( el ).css( 'opacity', progress );

			}

			// Progress
		,	onProgressFImageUploader: function( uploaded, total ) {

				var progBar = $( '.sb-smt-feat-img-progress' )
				,	percentage = uploaded / total * 100;

				progBar.css( 'width', percentage + '%' );
			}

	    	// Get the data from the graphic tab.
	    ,	getGraphicData: function() {

	    		var name
	    		,	unfilled = []
	    		,	tab = ".sb-smt-tab-graphic-freebie"
	    		// ,	required = [ "title", "image", "freebie", "content" ]
	    		// ,	required = [ "title", "image", "content" ]
	    		,	required = [ "title", "content", "external_link" ]
	    		,	graphicData = {
		    				title: $( '#sb-smt-graphic-title' ).val().trim() // *
		    			// ,	content: tinyMCE.get( 'sb-smt-graphic-freebie-editor' ).getContent({ format : 'html' }) // *
		    			,	content: $( '#graphic-freebie-editor' ).val() // *
		    			,	tags: utilities.smtDataTags
		    			,	owner: $( 'input[id="sb-smt-verify-author-graphic"]' ).is( ':checked' )
		    			,	attachments: $( '.sb-smt-submit-post' ).attr( 'data-freebie' )
		    			,	detail_link: $( '.source-link' ).val()
		    			,	externalLink: $( '.source-link' ).val()
		    			,	external_link: $( '.source-link' ).val()
		    			,	featured_image: ( $( '.sb-smt-image-container > img' ).attr( 'src' ) != 'http://placehold.it/400x300&text=800x400' ) ? $( '.sb-smt-image-container > img' ).attr( 'src' ) : ''
		    			,	twitter: $( '.twitter' ).val()
		    			,	repo: $( '.github-repo' ).val()
		    			,	on_prod_list_id: $( '.on-production' ).val()
		    			,	event: 'post-submit'
	    			}
	    		,	is_admin = $( 'input[data-cat=graphic]' ).data( 'is-admin' );

	    		// Check for empty fields
	    		$( required ).each( function( key, val ) {

	    			// Title
	    			if ( val == "title" ) {

	    				if ( graphicData[ val ] == "Resource title..."
	    					|| graphicData[ val ] == "" ) {
	    					unfilled.push( "title" );
	    				}
	    			}

	    			// Content
	    			if ( val == "content" ) {

	    				if ( graphicData[ val ] == "Describe this resource..." || graphicData[ val ] == "" ) {
	    					unfilled.push( "content" );
	    				}

	    			}

	    			// Content
	    			if ( val == "external_link" ) {

	    				if ( graphicData[ val ] == "" ) {
	    					unfilled.push( "external_link" );
	    				}

	    			}

	    		});

				// Featured image
				// if ( is_admin == 1 ) { // via @/submit
					// if ( ! model.get( 'featured_image' ) ) {
					// 	unfilled.push( 'image' );
					// }
				// }

	    		// Freebie
	    		// if ( utilities.smtAttachmentsArray.length == 0 ) {
	    		// if ( ! model.get( 'attachments' ).length ) {
	    		// 	unfilled.push( "freebie" );
	    		// }

	    		// Are there unfilled fields?
	    		if ( unfilled.length > 0 ) {

	    			$.each( unfilled, function( key, val ) {

	    				// $( tab ).find( ".label-" + val )
	    				$( tab ).find( ".input-" + val )
	    					.addClass( "unfilled" );

	    			});

	    			utilities.alert( 'Please revise the inputs marked with yellow.', null, null, 7000 );

	    			return false;
	    		}


	    		return graphicData;
	    	}

	    	// Get the data from the graphic tab.
	    ,	getMarketplaceData: function() {

	    		var name
	    		,	priced = $( '.price' ).val().replace( /\D+/g, '')
	    		,	unfilled = []
	    		// ,	tab = ".sb-smt-tab-graphic-freebie"
	    		,	required = [ "title", "image", "freebie", "content", "price" ]
	    		,	marketplaceData = {
		    				title: $( '.market-title' ).text().trim() // *
		    			,	content: $( '#content-redactor' ).val() // *
		    			,	tags: utilities.smtDataTags
		    			,	license: $( 'input[name="sb-smt-licence-type"]:checked' ).val() == 'CUSTOM-LICENCE'
		    					? $( '#sb-smt-custom-licence-description' ).val() : $( 'input[name="sb-smt-licence-type"]:checked' ).val()
		    			,	category: $( '.market-submit' ).data( 'cat' )
		    			,	sub_category: utilities.smtDataMarketCat
		    			,	price: ( priced ) ? priced : 1
		    			// ,	owner: $( 'input[id="sb-smt-verify-author-graphic"]' ).is( ':checked' )
	    			}
	    		,	is_admin = $( 'input[data-cat=marketplace]' ).data( 'is-admin' );

	    		// Check for empty fields
	    		$( required ).each( function( key, val ) {

	    			// Title
	    			if ( val == "title" ) {

	    				if ( marketplaceData[ val ] == "Marketplace item title..."
	    					|| marketplaceData[ val ] == "" ) {
	    					unfilled.push( "title" );
	    				}
	    			}

	    			// Content
	    			if ( val == "content" ) {

	    				if ( marketplaceData[ val ] == "<p>Describe this graphic resource...</p>" ) {
	    					unfilled.push( "content" );
	    				}

	    			}

	    			// Content
	    			if ( val == "5" ) {

	    				if ( marketplaceData[ val ] == "5" ) {
	    					unfilled.push( "price" );
	    				}

	    			}

	    		});

				// Featured image
				// if ( is_admin == 1 ) {
					if ( ! model.get( 'featured_image' ) ) {
						unfilled.push( 'image' );
					}
				// }

	    		// Freebie
	    		// if ( utilities.smtAttachmentsArray.length == 0 ) {
	    		if ( ! model.get( 'attachments' ).length ) {
	    			unfilled.push( "freebie" );
	    		}

	    		// Are there unfilled fields?
	    		if ( unfilled.length > 0 ) {

	    			$.each( unfilled, function( key, val ) {

	    				// $( tab ).find( ".label-" + val )
	    				// 	.addClass( "unfilled" );

	    			});

	    			utilities.alert( 'Please revise the inputs marked with yellow.', null, null, 7000 );

	    			return false;
	    		}


	    		return marketplaceData;
	    	}

	    	// Get the data from the graphic tab.
	    ,	getThemeData: function() {

	    		var name
	    		,	theList = $( '.theme-label.selected' ).data( 'wplist-id' )
	    		,	theLicense = $( 'input.theme-license-submitter:checked' ).val() == 'other' ? $( '.other-theme-license' ).val() : $( 'input.theme-license-submitter:checked' ).val()
	    		,	unfilled = []
	    		// ,	tab = ".sb-smt-tab-graphic-freebie"
	    		,	required = [ "title", "image", "freebie", "content", "price" ]
	    		,	themeData = {
		    				title: $( '.theme-title' ).text().trim() // *
		    			,	content: $( '#content-theme-redactor' ).val() // *
		    			,	tags: utilities.smtDataTags
		    			,	license: ( theLicense != '' ) ? theLicense : 'GPL'
		    			,	category: $( '.theme-submit' ).data( 'cat' )
		    			,	sub_category: utilities.smtDataMarketCat
		    			,	list_id: ( theList ) ? theList : 1
		    			,	detail_link: $( '.theme-demo-link' ).val()
		    			// ,	owner: $( 'input[id="sb-smt-verify-author-graphic"]' ).is( ':checked' )
	    			}
	    		,	is_admin = $( 'input[data-cat=theme]' ).data( 'is-admin' );

	    		// Check for empty fields
	    		$( required ).each( function( key, val ) {

	    			// Title
	    			if ( val == "title" ) {

	    				if ( themeData[ val ] == "Theme item title..."
	    					|| themeData[ val ] == "" ) {
	    					unfilled.push( "title" );
	    				}
	    			}

	    			// Content
	    			if ( val == "content" ) {

	    				if ( themeData[ val ] == "<p>Describe this resource...</p>" ) {
	    					unfilled.push( "content" );
	    				}

	    			}

	    			// Content
	    			if ( val == "5" ) {

	    				if ( themeData[ val ] == "5" ) {
	    					unfilled.push( "price" );
	    				}

	    			}

	    		});

				// Featured image
				// if ( is_admin == 1 ) {
					if ( ! model.get( 'featured_image' ) ) {
						unfilled.push( 'image' );
					}
				// }

	    		// Freebie
	    		// if ( utilities.smtAttachmentsArray.length == 0 ) {
	    		if ( ! model.get( 'attachments' ).length ) {
	    			unfilled.push( "freebie" );
	    		}

	    		// Are there unfilled fields?
	    		if ( unfilled.length > 0 ) {

	    			$.each( unfilled, function( key, val ) {

	    				// $( tab ).find( ".label-" + val )
	    				// 	.addClass( "unfilled" );

	    			});

	    			utilities.alert( 'Please revise the inputs marked with yellow.', null, null, 7000 );

	    			return false;
	    		}


	    		return themeData;
	    	}

	    	// Get the data from the graphic tab.
	    ,	getPhotoData: function() {

	    		var name
	    		,	unfilled = []
	    		// ,	tab = ".sb-smt-tab-graphic-freebie"
	    		,	required = [ "title", "image", "freebie" ]
	    		,	photoData = {
		    				title: $( '.mi-title.photo-title' ).text().trim() // *
		    			,	tags: utilities.smtDataTags
		    			,	license: $( 'input[name="sb-smt-licence-type"]:checked' ).val() == 'CUSTOM-LICENCE'
		    					? $( '#sb-smt-custom-licence-description' ).val() : $( 'input[name="sb-smt-licence-type"]:checked' ).val()
		    			,	category: $( '.sb-smt-submit-post-photo' ).data( 'cat' )
		    			,	owner: $( '.owner-name' ).val()
		    			,	list_id: $( '.sb-smt-submit-post-photo' ).data( 'list-id' )

		    			// ,	owner: $( 'input[id="sb-smt-verify-author-graphic"]' ).is( ':checked' )
	    			}
	    		,	is_admin = $( 'input[data-cat=photo]' ).data( 'is-admin' );

	    		// Check for empty fields
	    		$( required ).each( function( key, val ) {

	    			// Title
	    			if ( val == "title" ) {

	    				if ( photoData[ val ] == "Photo item title..."
	    					|| photoData[ val ] == "" ) {
	    					unfilled.push( "title" );
	    				}
	    			}

	    		});

				// Featured image
				// if ( is_admin == 1 ) {
					if ( ! model.get( 'featured_image' ) ) {
						unfilled.push( 'image' );
					}
				// }

	    		// Freebie
	    		// if ( utilities.smtAttachmentsArray.length == 0 ) {
	    		if ( ! model.get( 'attachments' ).length ) {
	    			unfilled.push( "freebie" );
	    		}

	    		// Are there unfilled fields?
	    		if ( unfilled.length > 0 ) {

	    			$.each( unfilled, function( key, val ) {

	    				// $( tab ).find( ".label-" + val )
	    				// 	.addClass( "unfilled" );

	    			});

	    			utilities.alert( 'Please revise the inputs marked with yellow.', null, null, 7000 );

	    			return false;
	    		}


	    		return photoData;
	    	}

	    	// Get data for code tab
	    ,	getCodeData: function() {

	    		var name
	    		,	unfilled = []
	    		,	tab = ".sb-smt-tab-code-freebie"
	    		,	codeData = {
		    				title: $('#sb-smt-code-title').text().trim()
		    			,	content: tinyMCE.get( 'sb-smt-code-freebie-editor' ).getContent({format : 'html'})
		    			,	tags: utilities.smtDataTags
		    			,	fiddle_link: $('#sb-smt-code-jsfiddle-source').val()
		    			,	owner: $( 'input[id="sb-smt-verify-author-graphic"]' ).is( ':checked' )
	    			}
	    		,	required = [
	    					"title"
	    				,	"content"
	    			]
	    		,	is_admin = $( 'input[data-cat=code]' ).data( 'is-admin' );

	    		// Get the unfilled fields
	    		$.each( required, function( key, val ) {

					// Title
					if ( val == "title" ) {

						if ( codeData[ val ] == "Code snippet title..."
							 || codeData[ val ] == "" ) {

							unfilled.push( "title" );
						}

					}

					// Content
					if ( val == "content" ) {

						if (  codeData[ val ] == "<p>Describe this code snippet...</p>" ) {
							unfilled.push( "content" );
						}
					}

	    		});


				// Featured image
				if ( is_admin == 1 ) {
					if ( ! model.get( 'featured_image' ) ) {
						unfilled.push( 'image' );
					}
				}

	    		// Are there unfilled fields?
	    		if ( unfilled.length > 0 ) {

	    			$.each( unfilled, function( key, val ) {

	    				$( tab ).find( ".label-" + val )
	    					.addClass( "unfilled" );

	    			});

	    			utilities.alert( 'Please revise the inputs marked with yellow.', null, null, 7000 );

	    			return false;
	    		}


	    		// Return valid post
	    		return codeData;

	    	}

	    	// Get resource data.
	    ,	getResourceData: function() {

	    		var name
	    		,	unfilled = []
	    		,	tab = ".sb-smt-tab-tool-review"
	    		,	required = [ "title", "content" ]
	    		,	toolRevData = {
		    				title: $( '#sb-smt-tool-review-title' ).text().trim()
		    			,	content: tinyMCE.get( 'sb-smt-tool-review-editor' ).getContent()
		    			,	tags: utilities.smtDataTags
		    			,	link: $( '#sb-smt-tool-review-demo-link' ).val().trim()
		    			, 	detail_link: $( '#sb-smt-tool-review-detail-link' ).val()
		    			,	license: $( 'input[name="sb-smt-licence-type"]:checked' ).val() == 'CUSTOM-LICENCE'
		    					? $( '#sb-smt-custom-licence-description' ).val() : $( 'input[name="sb-smt-licence-type"]:checked' ).val()
		    			,	owner: 	$( 'input[id="sb-smt-verify-author-graphic"]' ).is( ':checked' )
	    			}
	    		,	is_admin = $( 'input[data-cat=resource]' ).data( 'is-admin' );


	    		// Check for unfilled fields
	    		$.each( required, function( key, val ) {

	    			// Title
	    			if ( val == "title" ) {

	    				if ( toolRevData[ val ] == "Resource title..."
	    					|| toolRevData[ val ] == "" )  {
	    					unfilled.push( "title" );
	    				}
	    			}

	    			// Content
	    			if ( val == "content" ) {
	    				if ( toolRevData[ val ] == "<p>Describe this resource...</p>" ) {
	    					unfilled.push( "content" );
	    				}
	    			}

	    		});

				// Featured image
				if ( is_admin == 1 ) {
					if ( ! model.get( 'featured_image' ) ) {
						unfilled.push( 'image' );
					}
				}

	    		// Detail
	    		if ( ! toolRevData.detail_link ) {
	    			unfilled.push( "detail-link" );
	    		}

	    		// Licence
	    		if ( toolRevData.license == 'undefined' ) {
	    			unfilled.push( "license" );
	    		}

	    		// Are there unfilled fields?
	    		if ( unfilled.length > 0 ) {

	    			$.each( unfilled, function( key, val ) {

	    				$( tab ).find( ".label-" + val )
	    					.addClass( "unfilled" );

	    			});

	    			utilities.alert( 'Please revise the inputs marked with yellow.', null, null, 7000 );

	    			return false;
	    		}

	    		return toolRevData;
	    	}

	    	// Trigger on save
	    ,	onSave: function( model, response ) {

	    		var overlayText = '.sb-smt-overlay .sb-smt-overlay-inner p';

	    		// Show done.
	    		$( overlayText ).text( 'done' );

	    		// Hide overlay
	    		this.overlay( 'hide' );

	    		if ( utilities.isAjaxError( response ) ) {
	    			return utilities.alert( response.text );
	    		}

	    		// Show success
	    		this.successView();

	    		if ( window.inProfile ) {
	    			utilities.alert( 'Item added to marketplace correctly.' );
	    			location.reload( true );
	    		}

	    	}


	    	// Show success view
	    ,	successView: function( title, message ) {

	    		var wrapper = '#bmAppContainer'
	    		,	view = '.sb-smt-success-view'
	    		,	scrollTop = $( window ).scrollTop() + 300;

	    		// Scroll the view if necessary.
	    		$( view ).css( 'top', scrollTop );

	    		if ( title != null ) {
	    			$( view ).find( 'h2' ).text( title );
	    		}

	    		if ( message != null ) {
	    			$( view ).find( 'p' ).text( message );
	    		}

	    		$( wrapper ).fadeOut( 200, function() {
	    			$( view ).fadeIn( 200 );
	    		});
	    	}

	    	// Show or hide overlay
	    ,	overlay: function( action ) {

	    		var overlay = '.sb-smt-overlay';

	    		if ( action == 'show' ) {
	    			$( overlay ).fadeIn( 'fast' );
	    		}

	    		else if ( action == 'hide' ) {
	    			$( overlay ).fadeOut( 'fast' );
	    		}

	    	}


	    	// Open submitter
	    ,	open: function() {

	    		var overlay = '.modal-backdrop'
	    		,	submitter = '#bmAppContainer'
	    		,	submit = '.sb-smt-submit-post'
	    		,	listId = model.get( 'list_id' )
	    		,	scroll = $( window ).scrollTop() + 300

				,	typeClasses = {
							graphic: [ '.type-graphic', '.sb-smt-tab-graphic-freebie' ]
						,	code: [ '.type-code', '.sb-smt-tab-code-freebie' ]
						,	resource: [ '.type-tool', '.sb-smt-tab-tool-review' ]
					}
				,	availableTypes = [ 'graphic', 'code', 'resource' ]
				,	contentType = model.get( 'content_type' )

				// Views
				,	views = '#bmAppContainer .bp-smt-types .bp-smt-types-item'
				,	tabs = 'div[class^="sb-smt-tab-"], div[class *= " sb-smt-tab-"]';


	    		if ( typeof listId == 'number' ) {
	    			$( submitter ).find( submit ).each( function() {

	    				// Add list id to submit button.
	    				$( this ).attr( 'data-list-id', listId );
	    			});
	    		}

	    		// Prevent
	    		if ( availableTypes.indexOf( contentType ) === -1 ) {
	    			return;
	    		}

	    		// Hide all tabs and view
	    		$( views ).hide();
	    		$( tabs ).hide();


	    		// Only show the appropriate tab and content
	    		$.each( typeClasses[ contentType ], function( k, v ) {
    				$( submitter ).find( v ).show()
    					.removeClass( 'sb-smt-tab-hide' );
	    		});

	    		// Fix the height of the textareas
	    		this.fixTextAreas();

	    		// Show submitter
	    		$( submitter ).css( 'top', scroll );
	    		$( overlay ).show();
	    		$( submitter ).show();
	    	}

	    	// Fixes the height of the text areas
	    ,	fixTextAreas: function() {

	    		// As usually, editors don't get their ideal size
				// we set their dimensions again.
				var editorsTbl = [
							// '#sb-smt-graphic-freebie-editor_tbl'
						 	'#sb-smt-code-freebie-editor_tbl'
						,	'#sb-smt-tool-review-editor_tbl'
					]
				,	editorIfr = [
							// { el: '#sb-smt-graphic-freebie-editor_ifr', height: 235 }
							{ el: '#sb-smt-code-freebie-editor_ifr', height: 175 }
						,	{ el: '#sb-smt-tool-review-editor_tbl', height: 249 }
					];

				$.each( editorsTbl, function( k, el ) {
					// $( el ).css( 'width', 511 );
					$( el ).css( 'width', '100%' );
				});

				$.each( editorIfr, function( k, el ) {
					$( el.el ).css( 'height', el.height );
				});

	    	}

	    	// Temporary method to append the post box to the grid view
	   //  ,	paintNewPost: function( model, response ) {

	   //  		var	collection = '.Home-postcollection-placeholder'
	   //  		, 	postCollection = window.Bppl.Models.HomePostCollection;

				// $( collection ).addClass( 'disabled' );

	   //  		// Set layout view to "grid" and repaint posts
	   //  		postCollection.set( 'layout_view', 'grid' )
	   //  			.sync( 'renderHome' );

	   //  	}

	    	// Clean submitter fields
	    ,	cleanSubmitter: function( _model, resp ) {

	    		var contentMsg = 'Describe the content you\'re sharing...'
	    		,	ed, editors
				,	titles = '#bmAppContainer h3[contenteditable]'
				,	inputs = '#bmAppContainer input[type="text"]';

				if ( window.inProfile ) {
					editors = [
						'content-redactor'
					]
					titles = '.mi-title';
					inputs = 'input[type="text"]';
				}
				else {
					editors = [
							'sb-smt-graphic-freebie-editor'
						,	'sb-smt-code-freebie-editor'
						,	'sb-smt-tool-review-editor'
					]
				}
				// console.log( editors[ a ] );
				// for ( a in editors ) {
				// 	if ( editors[ a ] != 'content-redactor' ) {
				// 		ed = tinyMCE.getInstanceById( editors[ a ] );
				// 		ed.setContent( contentMsg );
				// 	}
				// }

				$( '.sb-smt-graphic-tiny-editor' ).val( '' );

				$( titles ).each( function( k, v ) {
					if ( window.inProfile )
						$( this ).text( 'Marketplace item title.' );
					else
						$( this ).text( 'Post title...' );
				});

				// Inputs
				$( inputs ).each( function( key, val ) {
					$( this ).val( '' );
				});


	    	}

	});

	// Global Exposition
	window.Bppl.Views.Submitter = new Submitter();


})( this.jQuery, this, this.document, this.Bppl.Models.Submitter, this.Bppl.Helpers.Utilities, undefined );
/**
*
* View BuilderPage
*/
( function( $, window, document, model, utilities ) {

	var BuilderPage = Gillie.View.extend({

			initialize: function() {

				// Listen for Sync
				model.on( 'sync', utilities.bind( this.onSync, this ) );
				model.on( 'sync', utilities.bind( this.renderPagination, this ) );

                // Listen for pagination
                model.on( 'sync_paginate', utilities.bind( this.onSync, this ) );

                // Show loading effects
                model.on( 'changing', utilities.bind( this.onChanging, this ) );
                model.on( 'paginating', utilities.bind( this.onChanging, this ) );

                // Create list
                model.on( 'list_created', this.onListCreated );
                model.on( 'find_similar_lists', this.openModal );

                // Show loading state on search
                model.on( 'searching', this.loadingState );

        	}

			// Trigger on query change
		,   onChanging: function() {

                this.loadingState();

                // Add the terms to the term teller
                this.renderTermTeller();

            }

            // Add opacity to the posts to create a
            // loading effect
        ,   loadingState: function() {

                var results = ".builder-page .results";
                $( results ).css( "opacity", ".4" );

            }


            // Sync event
        ,   onSync: function( mod, data ) {

                // Place the content
                var resultsEl = ".builder-page .results"
                ,   meta = ".builder-page .result-meta"
                ,   markup
                ,   modal = '.Builder-modal'
                ,   count = '.posts-count span'
                ,   postsCount;

                // Get markup
                markup = new EJS({ url: window.Constants.JSTemplates + "BuilderPage.post-result.ejs?v=4"  })
                    .render( data.data.posts );

                $( resultsEl ).css( "opacity", "" )
                    .html( markup );

                // Count
                postsCount = data.data.posts.found_posts;
                $( meta ).find( ".post-count" ).text( postsCount );

                // Set post count
                model.set( 'post_count', postsCount );
                $( modal ).find( count )
                    .text( postsCount );

            }


            // Render term teller items
        ,   renderTermTeller: function() {

                var teller = ".builder-page .terms-teller"
                ,   keyTerms = ".key-section .key-terms"
                ,   env = ".env-section .env-terms"
                ,   tag = ".tag-section .tag-terms";

                // Clean html
                $( teller ).find( keyTerms ).html( "" )
                    .end().find( env ).html( "" )
                    .end().find( tag ).html( "" );

                // Key
                var cats = model.get( 'categories' );

                $.each( cats.key, function( key, val ) {
                    $( teller ).find( keyTerms ).append( '<li>' + val.slug + '</li> ' );
                });

                // Env
                $.each( cats.environment, function( key, val ) {
                    $( teller ).find( env ).append( '<li>' + val.slug + '</li> ' );
                });

                // Tags
                $.each( model.get( 'tags' ), function( key, val ) {
                    $( teller ).find( tag ).append( '<li>' + val.slug + '</li> ' );
                });

            }


            // Shows and handles the pagination
            // for the results
        ,   renderPagination: function( mod, data ) {

                var pagination = '.builder-body .pagination > ul'
                ,   pages = Math.ceil( parseInt( data.data.posts.found_posts ) / 20 )
                ,   markup = new EJS({ url: window.Constants.JSTemplates + 'BuilderPage.pagination.ejs' })
                        .render({ number_of_pages: pages });

                // Print pagination
                if ( data.data.posts.found_posts ) {
                    $( pagination ).html( markup );
                }

                else {
                    $( pagination ).html( '' );
                }

            }

            // Opens the modal
        ,   openModal: function( mod, data ) {

                var modal = '.Builder-modal'
                // ,   overlay = '.Builder-overlay'
                ,   overlay = '.modal-backdrop'
                ,   notification = '.Builder-modal .notification'
                ,   postLink = '.Builder-modal .notification a'
                ,   trigger = '.builder-page .open-modal';

                $( modal ).fadeIn( 200 );
                $( overlay ).fadeIn( 200 );

                if ( data.data.posts ) {

                    if ( data.data.posts.found_posts > 0 ) {
                        $( notification ).show();
                        $( postLink ).attr( 'href', data.data.posts.posts[ 0 ].permalink );
                    }
                }

                // Restart trigger default text
                $( trigger ).text( $( trigger ).data( 'original-text' ) );

            }

            // Closes the modal
        ,   closeModal: function() {

                var modal = '.Builder-modal'
                ,   overlay = '.Builder-overlay'
                ,   popover = '.submit-popover'
                ,   cancel = '.Builder-modal .modal-cancel'
                ,   form = '.Builder-modal .new-list'
                ,   notification = '.Builder-modal .notification';


                $( modal ).fadeOut( 200 );
                $( overlay ).fadeOut( 200 );
                $( modal ).find( popover ).hide();


                // Clear form
                if( $( cancel ).data( 'cleartext' ) == true ) {

                    utilities.clearForm( form  );
                    $( cancel ).data( 'cleartext', false )
                    $( cancel ).text( 'cancel' );
                }

                $( notification ).hide();

            }

            // Called after a list has been created
            // used to show feedback
        ,   onListCreated: function( mod, data ) {

                // Show success evt
                var modal = '.Builder-modal'
                ,   $submit = $( modal ).find( 'input[type="submit"]' )
                ,   $popover = $( modal ).find( '.submit-popover' )
                ,   cancel = '.Builder-modal .modal-cancel';

                // Show original text
                $submit.attr( 'value', $submit.data( 'original-text' ) )
                    .removeClass( 'disabled' );

                $( cancel ).text( 'Done' )
                    .data( 'cleartext', true );

                // Show popover
                $popover.find( 'a' )
                    .attr( 'href', data.data.permalink )
                    .text( 'View List' );

                $popover.show();

            }

	});

	// Global Exposition
	window.Bppl.Views.BuilderPage = new BuilderPage();


})( this.jQuery, this, this.document, this.Bppl.Models.BuilderPage, this.Bppl.Helpers.Utilities, undefined );

/**
*
* View Sidebar
*/
( function( $, window, document, utilities ) {

	var Sidebar = Gillie.View.extend({

			initialize: function() {

			}

			// Slide freebies widget elements
		,	slideFreebiesWidget: function( direction ) {

				var items = '.promo .slider-items'
				,	liGroup = $( items ).find( 'li' )
				,	index = 0, liLength = liGroup.length;


				for ( var i = 0; i < liLength; i++ ) {

					if ( $( liGroup[ i ] ).hasClass( 'active' ) ) {
						index = i; break;
					}
				};


				// Left
				if ( direction == 'left' && index - 1 >= 0 ) {
					$( liGroup[ index ] ).removeClass( 'active' );
					$( liGroup[ index - 1 ] ).addClass( 'active' );
				}

				// Right
				if ( direction == 'right' && index + 1 < liLength ) {
					$( liGroup[ index ] ).removeClass( 'active' );
					$( liGroup[ index + 1 ] ).addClass( 'active' );
				}

			}

			// Show form errors
		,	showError: function( error ) {

				var target = '.BecomeCurator-modal .error-message'
				,	form = '#form-becomeCurator'
				,	submit = $( form ).find( 'input[type="submit"]' );

				$( submit ).removeClass( 'disabled' )
					.attr( 'value', submit.data( 'original-text' ) );

				// $( target ).slideDown( 100 );

				utilities.alert( 'Please fill "What makes you awesome?" field.', 'failure' );

			}

			// Shows the feedback on save
		,	onSave: function( model, data ) {

				var form = '#form-becomeCurator'
				,	submit = $( form ).find( 'input[type="submit"]' );

				submit.removeClass( 'disabled not-logged-in' )
					.attr( 'value', submit.data( 'original-text' ) );

				switch ( data.status ) {
					case 200:
						utilities.alert( data.text );
						break;

					case 600:
						utilities.alert( data.text, 'failure' );
						break;
				}

				utilities.clearForm( form );

			}

	});

	// Global Exposition
	window.Bppl.Views.Sidebar = new Sidebar();



})( this.jQuery, this, this.document, this.Bppl.Helpers.Utilities, undefined );
/**
*
* View Curation
*/
( function( $, window, document, model, utilities ) {

	var Curation = Gillie.View.extend({

			initialize: function() {

				model.on({
						'curate': this.onCurate
					,	'get_lists': this.onGetLists
					,	'get_list_items': this.onGetListItems
					,	'sort_list_items': this.onSortListItems
					,	'stick_post': this.onStickPost
					,	'reject_post': this.onRejectPost
					,	'accept_post': this.onAcceptPost
					,	'like_post': this.onLikePost
					,	'dislike_post': this.onDislikePost
					,	'curation.track': this.onCurationTrack
				});
			}

			// Fired when response is returned from server
		,	onCurate: function( model, response ) {

				var actions = '.curator-actions', sel;

				// Post submission
				if ( model.section == 'post-submissions' ) {
					sel = '.post-submissions .post-' + model.item_id;
				}

				// List suggestion
				if ( model.section == 'list-suggestions' ) {
					sel = '.list-suggestions .list-suggestion-' + model.item_id;
				}

				// Flag request
				if ( model.section == 'flag-requests' ) {
					sel = '.flag-requests .' + model.item_type + '-' + model.item_id
				}

				// Curation from single post
				if ( model.section == 'single-post-submission' ) {
					sel = '.curator-actions';
				}

				// Curation of list from list suggestion modal
				if ( model.section == 'list-suggestions-modal' ) {
					sel = '.SuggestList-modal .list-suggestion-' + model.item_id;
				}

				// Show feedback message
				if ( model.decision == 'accept' ) {

					utilities.alert( 'You\'ve accepted this request.' );
				}

				else if ( model.decision == 'reject' ) {

					utilities.alert( 'You\'ve rejected this request' );
				}

				$( sel ).slideUp( 'fast' );
			}


			// Triggered after getting lists
		,	onGetLists: function( model, response ) {

				var data = response.data.posts
				, 	html = utilities.render( 'curation.lists', data )
				,	allLists = '.curation-wrapper .all-lists';

				$( allLists ).html( html );
				$( '.curation-wrapper' ).removeClass( 'disabled' );
				utilities.closeAlert();

			}


			// Called after getting list items
		,	onGetListItems: function( _model, response ) {

				var data = response.data.posts
				data.pending = function() {
					return this.post_status == 'publish' ? false : true;
				};
				data.list_id = _model.list_id;

				// var	html = utilities.render( 'curation.list-items', data )
				var	html = utilities.render( 'curation.lists1', data )
				,	target = '.curation-wrapper .list-' + _model.list_id
				,	listId;

				var pre = '<div class="group-items"><ul class="unstyled slats list-items" data-list-id="' + _model.list_id + '">'
				,	after = '</ul></div>';

				html = pre + html + after;

				// Apend HTML
				$( target ).append( html );

				// Sortable
				$( target ).find( '.list-items' )
					.sortable({
						handle: '.group-move'
					,	placeholder: 'ui-state-highlight'
					,	update: function( e, ui ) {

							newPositions = [];

							model.set( 'list_id', $( this ).data( 'list-id' ) );

							// Loop
							$( this ).find( 'li.group' ).each( function() {

								id = $( this ).data( 'id' );
								newPositions.push( id );
							});

							// Sort list items
							model.set( 'items_order', newPositions )
								.sortListItems( 'sort_list_items' );
						}
				});


				$( '.list-' + data.list_id ).removeClass( 'disabled' );

			}


			// Called after sorting list items
		,	onSortListItems: function( _model, response ) {

				var listId = '.list-' +  _model.list_id
				,	thumb =	jQuery( listId + ' .slat-thumb:first' ).attr( 'src' );

				//use the thumbnail
				jQuery( listId ).find( '.list-title img' ).attr( 'src', thumb );
				utilities.alert( 'The post has been moved', '' , null, 1200 );

			}

			// Fired after sticking post
		,	onStickPost: function( _model, response ) {

				utilities.alert( 'This post is stiky', '' , null, 1200 );

			}

			// Triggered after post curation
		,	onRejectPost: function( _model, response ) {

				utilities.alert( 'The post has been removed from this list.', '', null, 1200 );
			}

			// Called on accept post
		,	onAcceptPost: function( _model, response ) {

				utilities.alert( 'The post has been added to the list.', '', null, 1200 );

			}

			// Called on like post
		,	onLikePost: function( _model, response ) {

				utilities.alert( 'Post Liked.', '', null, 1200 );

			}

			// Called on dislike post
		,	onDislikePost: function( _model, response ) {

				utilities.alert( 'Post Disliked.', '', null, 1200 );

			}

			// Fired on curation track
		,	onCurationTrack: function( _model, response ) {


			}

	});

	// Global Exposition
	window.Bppl.Views.Curation = new Curation();


})( this.jQuery, this, this.document, this.Bppl.Models.Curation, this.Bppl.Helpers.Utilities, undefined );


/**
*
* View Edition
*/
( function( $, window, document, model, utilities ) {

	var Edition = Gillie.View.extend({

			initialize: function() {

				model.on({
						'post.update': this.onEditPostContent
					,	'post.create_user_update_post': utilities.bind( this.onCreateUserUpdatePost, this )
				});
			}


			// Called after post content is saved
		,	onEditPostContent: function( _model, response ) {

				var saveButton = 'a[data-action="edition.save"]'
				,	contentSel = '.post-content .post-content-text'
				,	actions = '.post-content-wrapper .content-edition-actions'
				,	editBtn = 'a[data-action="edition.edit"]'
				,	modalUpdateBtn = 'a[data-action="edition.update"]';

				$( saveButton ).text(
					$( saveButton ).data( 'original-text' )
				).removeClass( 'disabled' );

				$( actions ).fadeOut();
				$( editBtn ).fadeIn();
				$( contentSel ).removeClass( 'editable' )
					.removeAttr( 'contenteditable' );

				// Update button text
				$( modalUpdateBtn ).text(
					$( modalUpdateBtn ).data( 'original-text' )
				).removeClass( 'disabled' );

				utilities.alert( 'Post saved.', null, function() {

					if ( model.get( 'reload_page' ) ) {
						window.location.reload();
					}

				}, 2000 );

			}

			// Open Modal for new guest editor
		,	onCreateUserUpdatePost: function( _model, response ) {

				var popover  = 'a[data-action="edition.save"]'
				,	form = 'form[data-action="edition.update-post-create-account"]'
				,	submit = $( form ).find( 'input[type="submit"]' );


				// Return submit button state
				submit.removeClass( 'disabled' )
					.val( $( submit ).data( 'original-text' )
				);

				if ( utilities.isAjaxError( response ) ) {
					return utilities.alert( response.text, null, null, 5000 );
				}

				// Reload the page after
				model.set( 'reload_page', true );

				// Hide popover
				$( popover ).removeClass( 'not-logged-in' )
					.popover( 'destroy' );

				// Call regular callback
				this.onEditPostContent( _model, response );
			}

	});

	// Global Exposition
	window.Bppl.Views.Edition = new Edition();



})( this.jQuery, this, this.document, this.Bppl.Models.Edition, this.Bppl.Helpers.Utilities, undefined );

	/**
*
* View LinkGenerator
*/
( function( $, window, document, model, utilities ) {

	var LinkGenerator = Gillie.View.extend({

			initialize: function() {

				model.on({
						'generate_link': this.onGenerateLink
				});
			}

			// Called after link is generated
		,	onGenerateLink: function( model, response ) {

				var submit = 'form[role="linkgenerator.generate"] input[type="submit"]'
				,	alert = '.link-generator-page div[role="generated-url"]';

				$( submit ).removeClass( 'disabled' )
					.val( $( submit ).data( 'original-text' ) );

				$( alert ).slideDown( 'fast' ).find( '> label' )
					.text( response.data.link );

			}

	});

	// Global Exposition
	window.Bppl.Views.LinkGenerator = new LinkGenerator();


})( this.jQuery, this, this.document, this.Bppl.Models.LinkGenerator, this.Bppl.Helpers.Utilities, undefined );


/**
*
* View Search
*/
( function( $, window, document, utilities ) {

	var Search = Gillie.View.extend({

			// Init
			initialize: function() {

			}

			// Add loading state to home
		,	toggleFilterTerm: function( item ) {

				var	item = ( item.slug ) ? item.slug : item, text
				,	target = $( '.sublevel a.filter-term[data-slug="' + item + '"]' )
				,	selCategory = '.pinboards-count'
				, 	item_count = ( item.item_count ) ? item.item_count : $( target ).data( 'item-count' )
				, 	list_count = ( item.list_count ) ? item.list_count : $( target ).data( 'list-count' )
				, 	name
				,	patt
				,	lists = '.tree'
				,	homeCollection = '.Home-postcollection-placeholder'
				,	countData = $( selCategory ).data( 'list-count' ) != null;

				name = ( item.label ) ? item.label : ( $( target ).data( 'name' ) ) ? $( target ).data( 'name' ) : item;

				if ( sessionStorage.slug == target ) return;
				$( '.sublevel a' ).removeClass( 'toggle-color btn-pressed' );
				$( target ).addClass( 'toggle-color btn-pressed' );
				$( '.category-selected' ).hide();

				// Check whether we've data on 'pinboards-count' element.
				list_count = list_count || $( selCategory ).data( 'list-count' );

				// Show pinboards info
				$( lists ).html( name )
					.css({ display: 'inline-block' });

				patt = /(freebies|resources|live-codes)/gi;
				patt = patt.test( name );

				// Build feedback string
				( list_count && ! patt ) ? text = ': ' + list_count + ' Lists' : '';
				if ( item_count ) text += ' - ' + item_count + ' Resources';

				$( selCategory ).html( text )
					.css({ display: 'inline-block' });

				sessionStorage.slug = item;

			}

	});

	// Global Exposition
	window.Bppl.Views.Search = new Search();


})( this.jQuery, this, this.document, this.Bppl.Helpers.Utilities, undefined );


/**
*
* View Breadcrumb
*/
( function( $, window, document, utilities ) {

	var Breadcrumb = Gillie.Model.extend({

	});

	// Global Exposition
	window.Bppl.Views.Breadcrumb = new Breadcrumb();



})( this.jQuery, this, this.document, this.Bppl.Helpers.Utilities, undefined );


/**
* View: Social
*/
( function( $, window, document, model, utilities ) {

	var Social = Gillie.View.extend({


			// Init
			initialize: function() {

				model.on({
						'authorize': this.createPassword
					,	'create_user': this.onCreateUser
					,	'fb.check': utilities.bind( this.parseSocialCheck, this )
					,	'google.check': this.onSocialCheck
					,	'github.check': this.onSocialCheck
				});
			}

			// Create Password form
		,	createPassword: function() {

				var html, template = 'social.create-password'
				,	email = model.get( 'email' )
				,	registerModal = '.LoginRegister-modal'
				,	passwordModal = '.update-password[data-component="social"]';

				// Render template
				model.set( 'valid_email', utilities.isEmail( email ) );
				html = utilities.render( template, model.toJSON() );

				// Hide login modal
				$( registerModal ).hide();

				// Append HTML to footer
				$( html ).appendTo( 'body' )
					.show();

			}

			// Parse AJAX response content
		,	parseSocialCheck: function( model, response ) {

				// console.log( model, response );return;

				var data = {
						user: response.data.user
					,	exists: response.data.exists
					,	valid_email: utilities.isEmail( response.data.user.email )
					,	message : response.data.message
					,	getActionReferenceData: response.data.getActionReferenceData
				}

				if ( window.Constants.ptmpname == 'submit' )
					utilities.alert( 'Thank you, a curator will check your submission, if approved, will be published you will earn some points you can trade for our future deals.' );

				return this.onSocialCheck( data );

		    }

			// Called on user creation
		,	onCreateUser: function( model, resp ) {

				var error, form = '.update-password[data-component="social"]'
				,	_utilities = utilities;

				if ( ! resp.data.valid ) {
					error = resp.data.error_messages[ 0 ];
					utilities.stopWorking( form );
					return utilities.alert( error + ' Try using a different social account', 'success', null, 10000 );
				}

				// Close header-notice if exists
				$( '.close-notice' ).trigger( 'click' );

				// Clean cookies
				cookiesArr = [ 'bppl_user' ];
				utilities.delCookie( cookiesArr );

				window.location.reload();
			}

			// Called after Facebook response is received
		,	onSocialCheck: function( data ) {

				// console.log( data );return;

				var html, email, template = 'social.create-password'
				,	registerModal = '.LoginRegister-modal'
				,	passwordModal = '.update-password[data-component="social"]';

				if ( window.Constants.ptmpname == 'submit' )
					utilities.alert( 'Thank you, a curator will check your submission, if approved, will be published you will earn some points you can trade for our future deals.' );


				// Registered: Refresh page
				if ( data.exists ) {

					// Close header-notice if exists
					$( '.close-notice' ).trigger( 'click' );

					// Clean cookies
					cookiesArr = [ 'bppl_user', 'suggestedLink', 'likeData', 'comments' ];
					utilities.delCookie( cookiesArr );

					if ( typeof data.message != 'undefined' && data.message.length > 1 ) {

						utilities.alert( data.message );

						// Clean form
						$( '.suggest-bppl-item input' ).val( '' );
						$( '.suggest-bppl-item' ).hide();

						// Enable submitter btn
						$( '.btn-social' ).removeClass( 'disabled' );
					}

					if ( localStorage.dwnLink ) {
						$( '.in-download' ).show();
							// $( '.modal-backdrop' ).trigger( 'click' );
						setTimeout( function () {

							utilities.downloadView();
							window.location = localStorage.dwnLink;

						}, 1000, setTimeout( function() {
							return window.location.reload();
						}, 3500 ));
					}

					return window.location.reload();
				}

				// console.log( data );return;
				if ( typeof data.message != 'undefined' && data.message.length > 1 ) {

					utilities.alert( data.message );

					// Clean form
					$( '.suggest-bppl-item input' ).val( '' );
					$( '.suggest-bppl-item' ).hide();

					// Enable submitter btn
					$( '.btn-social' ).removeClass( 'disabled' );
				}

				// Email not received
				if ( data.valid_email ) {

					model.set( 'valid_email', false );
					model.set( 'referer', data.referer );
				}

				// Not registered: Create password form
				else if ( data.user.email ) {
					model.set({
							'email': data.user.email
						,	'valid_email': true
					});

					if ( data.profile_image_url )
						model.set( 'profile_image_url', data.profile_image_url )

					if ( data.user.bio )
						model.set( 'bio', data.data.user.bio );

					if ( data.referer )
						model.set( 'referer', data.referer );

				}

				if ( data.referer )
					model.set( 'referer', data.referer );

				// console.log( model );return;

				// Render template
				html = utilities.render( template, model.toJSON() );

				// console.log( html ); return;

				// Hide login modal
				$( registerModal ).hide();

				// Append HTML to footer
				$( html ).appendTo( 'body' )
					.show();

				// Close header-notice if exists
				$( '.close-notice' ).trigger( 'click' );

				// Clean cookies
				cookiesArr = [ 'bppl_user' ];
				utilities.delCookie( cookiesArr );

		    }

	});

	// Global Exposition
	window.Bppl.Views.Social = new Social();


})( this.jQuery, this, this.document, this.Bppl.Models.Social, this.Bppl.Helpers.Utilities );


/**
*
* View Misc
*/
( function( $, window, document, model, utilities ) {

	var Misc = Gillie.View.extend({

			initialize: function() {

                // Setup featured image uplader
                this.initUploader({
                        id: 'single-featured-image'
                    ,   slug: 'additional_images'
                    // ,   slug: 'featured_image'
                    ,   buttonText: 'Upload Featured Image'
                    ,   dragZoneText: 'Drop images here'
                    ,   dropAreaClass: 'featured-image-dragger'
                    // ,   url: '/uploader.feat-image.php'
                    ,   url: '/uploader.php'
                });

                // Setup attachments free uplader
                this.initUploader({
                        id: 'single-free-attachment'
                    ,   slug: 'attachment'
                    // ,   slug: 'featured_image'
                    ,   buttonText: 'Upload attachment'
                    ,   dragZoneText: 'Attachment'
                    ,   dropAreaClass: 'attachment-dragger'
                    ,   url: '/uploader.attachment.php?direct'
                });

                // Setup attachments free uplader in /submit page
                this.initUploader({
                        id: 'bp-smt-attachment-upload'
                    ,   slug: 'attachment'
                    // ,   slug: 'featured_image'
                    ,   buttonText: 'Upload freebie file'
                    ,   dragZoneText: 'Drag your file here'
                    ,   dropAreaClass: 'attachment-dragger'
                    ,   url: '/uploader.attachment.php?direct'
                });

                // Setup attachment premium image uplader
	            this.initUploader({
                        id: 'single-premium-attachment'
                    ,   slug: 'premiumAttachment'
                    // ,   slug: 'featured_image'
                    ,   buttonText: 'Upload attachment'
                    ,   dragZoneText: 'Attachment'
                    ,   dropAreaClass: 'premium-attachment-dragger'
                    ,   url: '/uploader.premium.attachment.marketplace.php?direct'
	            });

			}

			// Init uploader
        ,   initUploader: function( args ) {

                var _this = this
                ,   markup = utilities.render( 'bookmarklet.uploader', args )
                ,   uploader, uploader_additional
                ,   additionalImages = []
                ,   post = {};

                post.additional_images = [];

                // Prevent setting the uploader up if the
                // element is not present
                if ( typeof args.id != "string" || typeof args.url != "string" ) return false;
                if ( ! $( '#' + args.id ).length ) return;

                uploader = new qq.FileUploader({
                        element: document.getElementById( args.id )
                    ,   action: window.Constants.libsUrl + args.url
                    ,   debug: true
                    ,   multiple: false
                    ,   template: markup
                    ,   sizeLimit: 104850000 // max size
                    ,   minSizeLimit: 0 // min size
                    ,   fileTemplate: '<li>' +
                                '<span class="qq-progress-bar"></span>' +
                                '<span class="qq-upload-spinner">+</span>' +
                                '<span class="qq-upload-finished"></span>' +
                                '<span class="qq-upload-file"></span>' +
                                '<span class="qq-upload-size"></span>' +
                                '<a class="qq-upload-cancel" href="#">Cancel</a>' +
                            '</li>'

                    ,   onSubmit: function ( id, fileName ) {
                            // console.log( id, fileName );
                            $( 'body' ).append( '<div class="loader"></div>' );
                        }

                    ,   onError: function ( id, fileName, xhr ) {

                            utilities.alert( 'Opps, Try again or check your file size. Max file size supported is 100mb' );
                        }

                    ,   onProgress: function ( id, fileName, loaded, total ) {
                            // console.log( id, fileName, loaded, total );
                            var progress = loaded * 100 / total + '%';
                            // console.log( progress );
                            if( args.slug == 'attachment' )
                                $( '.free-attachment' ).addClass( 'disabled' ).attr( 'disabled', 'disabled' );

                            if( args.slug == 'premiumAttachment' )
                                $( '.premium-attachment' ).addClass( 'disabled' ).attr( 'disabled', 'disabled' );

                            $( '.loader' ).width( progress );
                            utilities.alert( 'Uploading: ' + Math.round( parseInt( progress ) ) + '%' );
                        }

                    ,   onComplete: function( id, filename, response ) {
                            // console.log( id, filename, response );
                            $( '.loader' ).remove();
                            utilities.alert( 'File uploaded succesfully' );

                            if ( response.fitSize == false )
                                return alert( 'The image must be 600x400' );

                            // Store the image or attachment
                            if ( args.slug == 'attachment' ) {

                                if ( $.map( response, function( n, i ) { return i; } ).length == 0 )
                                    utilities.alert( 'Opps, an error has been occurred.' );
                                else
                                    utilities.alert( 'Attachment uploaded correctly!' );

                                $( '.free-attachment' ).removeClass( 'disabled' ).removeAttr( 'disabled' );

                                $( '.the-free-attachment' ).val( response.file_name );

                                $( '.sb-smt-submit-post' ).attr( 'data-freebie', response.file_name );

                                return model.set( 'attachment', response.file_name );
                            }

                            if ( args.slug == 'premiumAttachment' ) {

                                utilities.alert( 'Premium attachment uploaded correctly!' );

                                $( '.premium-attachment' ).removeClass( 'disabled' ).removeAttr( 'disabled' );

                                $( '.the-premium-attachment' ).val( response.file_name );

                                return model.set( 'premiumAttachment', response.file_name );

                            }

                            // Store the image or attachment
                            model.set( 'featured_image', response.url )
                                .save();


                        }
                });

                if ( args.slug == 'additional_images' ) {

                    uploader_additional = new qq.FileUploader({
                            element: document.getElementById( args.id )
                        ,   action: window.Constants.libsUrl + args.url
                        ,   debug: true
                        ,   multiple: true
                        ,   template: markup
                        ,   fileTemplate: '<li>'
                                    + '<span class="qq-progress-bar"></span>'
                                    + '<span class="qq-upload-spinner">+</span>'
                                    + '<span class="qq-upload-finished"></span>'
                                    + '<span class="qq-upload-file"></span>'
                                    + '<span class="qq-upload-size"></span>'
                                    + '<a class="qq-upload-cancel" href="#">Cancel</a>'
                                + '</li>'

                        ,   onProgress: function ( id, fileName, loaded, total ) {
                                // console.log( id, fileName, loaded, total );
                                $( '.save-the-post' ).addClass( 'disabled' ).attr( 'disabled', 'disabled' );
                            }

                        ,   onComplete: function( id, filename, response ) {

                                // console.log( response );

                                // Store the image or attachment or additional
                                if ( window.Constants.POST_ID )
                                    $('#images_to_feat').append('<li><span class="close">&times;</span><img src="' + response.img_url_th + '" data-img-original-src="' + response.img_url + '" data-img_url="' + response.img_url_ft + '" data-post-id="' + window.Constants.POST_ID + '" alt="" /></li>');
                                else
                                    $('#images_to_feat').append('<li><span class="close">&times;</span><img src="' + response.img_url_th + '" data-img-original-src="' + response.img_url + '" data-img_url="' + response.img_url_ft + '" alt="" /></li>');


                                $( '#images_to_feat img:not( .ft_image )' ).each( function () {
                                    additionalImages.push( $( this ).data( 'img-original-src' ) );
                                });

                                post.additional_images = additionalImages;
                                post.additional_images.push( response.img_url );
                                post.additional_images = _.uniq( post.additional_images );
                                post.inSingle = true;

                                // Store the image or attachment
                                model.set( 'additional_images', post.additional_images )
                                model.set( 'inSingle', post.inSingle )
                                    .save();

                                $( '.save-the-post' ).removeClass( 'disabled' ).removeAttr( 'disabled' );
                                $( '.qq-upload-success' ).animate({
                                    opacity: 0
                                }, 4500 ).slideUp();

                            }
                    });

                }
            }

	});

	// Global Exposition
	window.Bppl.Views.Misc = new Misc();



})( this.jQuery, this, this.document, this.Bppl.Models.Misc, this.Bppl.Helpers.Utilities, undefined );


/**
*
* View Post
*/
( function( $, window, document, model, utilities ) {

	var Post = Gillie.View.extend({

			initialize: function() {

				model.on( 'trash', this.onTrash );
			}

			// Trigged after post is trashed
		,	onTrash: function( _model, response ) {

				if ( utilities.isAjaxError( response ) ) {
					return utilities.alert( 'There was a problem deleting the post' );
				}

				return utilities.alert( 'The post has been trashed.' );

		    }

	});

	// Global Exposition
	window.Bppl.Views.Post = new Post();


})( this.jQuery, this, this.document, this.Bppl.Models.Post, this.Bppl.Helpers.Utilities, undefined );


/**
* View: marketplace
*/
( function( $, window, document, utilities ) {

	var marketplace = Gillie.View.extend({

	});

	// Global Exposition
	window.Bppl.Views.marketplace = new marketplace();



})( this.jQuery, this, this.document, this.Bppl.Helpers.Utilities );


/**
* View: photo
*/
( function( $, window, document, utilities ) {

	var photo = Gillie.View.extend({

	});

	// Global Exposition
	window.Bppl.Views.Photo = new photo();



})( this.jQuery, this, this.document, this.Bppl.Helpers.Utilities );


/**
*
* Controller NavBar
*/
( function( $, window, document, view, model, utilities ) {

	var NavBar = Gillie.Controller.extend({

			// Init
			initialize: function() {

				// Comment collection
				this.collection = [];
			}

			// Set a new model with the suggestion data
			// Save the suggestion
			// Render the view of the success process
		,	save: function( event ) {

				// Check whether there are pending suggestions
				// and then insert them.
				$.each( this.collection, function( key, suggestion ) {

					// Save unsaved suggestions
					if ( suggestion.attributes.pending ) {

						// Listen to suggestion model `save` event.
						view.listenTo( suggestion, 'save', view[ event ] );

						// Save suggestion
						suggestion.save( 'save' );

						// Add saved attr.
						suggestion.attributes.pending = false;

					}

				});
			}

			// Set a new model with the suggestion data
			// Save the suggestion
			// Render the view of the success process
		,	saveLink: function( event ) {

				// Check whether there are pending suggestions
				// and then insert them.
				$.each( this.collection, function( key, customLink ) {

					// Save unsaved suggestions
					if ( customLink.attributes.pending ) {

						// Listen to customLink model `setCustomLink` event.
						view.listenTo( customLink, 'setCustomLink', view[ event ] );

						// Save customLink
						customLink.setCustomLink( 'setCustomLink' );

						// Add saved attr.
						customLink.attributes.pending = false;

					}

				});
			}

	});

	// Global Exposition
	window.Bppl.Controllers.NavBar = new NavBar();


})( this.jQuery, this, this.document, this.Bppl.Views.NavBar, this.Bppl.Models.NavBar, this.Bppl.Helpers.Utilities, undefined );
/**
*
* Controller User
*/
( function( $, window, document, view, model, utilities ) {

	var User = Gillie.Controller.extend({

	});

	// Global Exposition
	window.Bppl.Controllers.User = new User();



})( this.jQuery, this, this.document, this.Bppl.Views.User, this.Bppl.Models.User, this.Bppl.Helpers.Utilities, undefined );


/**
*
* Controller ListSuggestion
*/
( function( $, window, document, view, model, utilities ) {

	var ListSuggestion = Gillie.Controller.extend({

			initialize: function() {

				this.collection = [];
				this._target = $( document );
			}

			// Request to the model the insertion of the new list for each item in collection
			// Add an event listener to the view in the success process
		,	save: function() {

				// Open the modal window
				$( '.SuggestList-modal' ).show();
				$( '.modal-backdrop' ).show();

				// Check whether there are pending suggestions
				// and then insert them.
				$.each( this.collection, function( key, suggestion ) {

					// Save unsaved suggestions
					if ( suggestion.attributes.pending ) {

						// Listen to suggestion model `save` event.
						view.listenTo( suggestion, 'save', view.onSave );

						// Save suggestion
						suggestion.save( 'save' );

						// Add saved attr.
						suggestion.attributes.pending = false;

					}

				});
			}

			// Request to the model the vote thumbs up or down insertion for each item in collection
			// Add an event listener to the view in the success process
		,	vote: function( voteType, listId ) {

				// Open the modal window
				$( '.SuggestList-modal' ).show();
				$( '.modal-backdrop' ).show();

				// Get the target and add to the view
				view.target = this._target;

				// Check whether there are pending votes
				// and then insert them.
				$.each( this.collection, function( key, suggestion ) {

					// Save unsaved suggestions
					if ( suggestion.attributes.pending ) {

						// Listen to suggestion model `save` event.
						view.listenTo( suggestion, 'vote', view.onVote );

						// vote suggestion
						suggestion.vote( 'vote' );

						// Add voted attr.
						suggestion.attributes.pending = false;

					}

				});
			}

	});

	// Global Exposition
	window.Bppl.Controllers.ListSuggestion = new ListSuggestion();



})( this.jQuery, this, this.document, this.Bppl.Views.ListSuggestion, this.Bppl.Models.ListSuggestion, this.Bppl.Helpers.Utilities, undefined );
/**
*
* Controller Builder
*/
( function( $, window, document, view, model, utilities ) {

	var Builder = Gillie.Controller.extend({

			// Initialize

			initialize: function() {

				this.target = document;
				this.appear();

			}

			// Toggle Term
		,	toggleTerm: function( termId, tax, parent ) {

				var model = window.Bppl.Models.HomePostCollection;
				model.set( 'category_name', '' );

				var availableTax = [ 'category', 'tag' ]
				,	availableParents = [ 'key', 'environment' ]
				,	index, collection, term
				,	hash = utilities.getHash();

				if ( availableTax.indexOf( tax ) == -1 ) return false;

				// Create term
				term = {
					ID: termId
				}

				if ( parent == 'env' ) {
					parent = 'environment'
				}

				// Category
				if ( tax == 'category' ) {

					if ( availableParents.indexOf( parent ) == -1 ) return false;

					// Toggle
					utilities.toggle( model.attributes.categories[ parent ], term );

					if ( hash == '' ) {
						model.sync( 'renderHome' );
					}
					else {
						utilities.updateHash( '' );
					}

				}

				// Another
				else if ( tax == 'tag' ) {
					utilities.toggle( model.attributes.tags, term );

					if ( hash == '' ) {
						model.sync( 'renderHome' );
					}
					else {
						utilities.updateHash( '' );
					}

				}

			}

			// Filters the terms
		,	filterTerms: function( term, section ) {

				var terms = '.Builder-container '
				,	items = '.label'
				,	termName, match = 0
				,	map = {
						key: '.Builder-key-terms'
					,	env: '.Builder-env-terms'
				};

				// Add section to query
				terms += map[ section ];

				$( terms ).find( items )
					.each( function( key, val ) {

						termName = $( this ).text();

						req = new RegExp( term, 'i' );
						if ( ! req.test( termName ) ) {
							$( this ).hide();
						}

						else {
							match++;
							if ( match == 1 && term ) {
								$( this ).addClass( 'focus' );
							}
							$( this ).show();
						}
					}
				);

			}

			// Filter the specified categories.
		,	toggleFilterTerm: function( slug ) {

				var model = window.Bppl.Models.HomePostCollection
				,	path = utilities.getPath()
				,	parts = path.split( '/' );

				// Save the option in session.
				sessionStorage.slug = slug;

				// Set model category attributes
				model.reset().set( 'category_name', slug );

				if ( slug == null  ) {

					delete sessionStorage.slug;
					utilities.updatePath(  '/'  );
					model.sync( 'renderHome' );
				}
				else {

					// Redirect to category if we're on Chrome, IE or Firefox.
					if ( jQuery.browser.msie || jQuery.browser.chrome || jQuery.browser.mozilla )
						window.location = window.Constants.siteURL + slug;
					else
						utilities.updatePath(  '/' + slug  );

					var search = window.Bppl.Views.Search;
					search.toggleFilterTerm( slug ); // Render keyword information
				}
			}

		,	appear: function() {
				setTimeout( function () {
					$( '.share-actions' ).css( 'display', 'inline-block' );
				}, 1000 );
			}
	});

	// Global Exposition
	window.Bppl.Controllers.Builder = new Builder();


})( this.jQuery, this, this.document, this.Bppl.Views.Builder, this.Bppl.Models.Builder, this.Bppl.Helpers.Utilities, undefined );
/**
*
* Controller Filter
*/
( function( $, window, document, view, model, utilities ) {

	var Filter = Gillie.Controller.extend({


		// Filter posts
		filterPosts: function( term, section )  {

			var model = window.Bppl.Models.HomePostCollection;

			// model.attributes. =
			// model.sync( 'renderHome', 'another' );

		}


	});

	// Global Exposition
	window.Bppl.Controllers.Filter = new Filter();



})( this.jQuery, this, this.document, this.Bppl.Views.Filter, this.Bppl.Models.Filter, this.Bppl.Helpers.Utilities, undefined );
/**
*
* Controller LayoutView
*/
( function( $, window, document, view, model, utilities ) {

	var LayoutView = Gillie.Controller.extend({

			// Change layout mode
			change: function( mode ) {

				var model = window.Bppl.Models.HomePostCollection
				,	layouts = [ 'list', 'grid' ];

				if ( ! layouts.indexOf( mode ) === -1 ) return;

				model.set( 'layout_view', mode )
					.sync( 'renderHome' );

			}

	});


	// Global Exposition
	window.Bppl.Controllers.LayoutView = new LayoutView();


})( this.jQuery, this, this.document, this.Bppl.Views.LayoutView, this.Bppl.Models.LayoutView, this.Bppl.Helpers.Utilities, undefined );
/**
*
* Controller Comment
*/
( function( $, window, document, view, model, utilities ) {

	var Comment = Gillie.Controller.extend({

			// Init
			initialize: function() {

				// Comment collection
				this.collection = [];
			}


			// Calls to the view method which renders the form underneath the current comment
		,	showCommentForm: function( data, target ) {

				var comment = new model( data );

				view.showCommentForm( comment, target );
			}

			// Set a new model with the comment data
			// Save the comment
			// Render the view of the success process
		,	save: function( event ) {

				// Check whether there are pending comments
				// and then insert them.
				$.each( this.collection, function( key, comment ) {

					// console.log( 'comment.js', comment );
					// Save unsaved comments
					if ( comment.attributes.pending ) {

						// Listen to comment model `save` event.
						view.listenTo( comment, 'save', view[ event ] );

						// Save comment
						comment.save( 'save' );

						// Add saved attr.
						comment.attributes.pending = false;

					}

				});
			}


	});

	// Global Exposition
	window.Bppl.Controllers.Comment = new Comment();



})( this.jQuery, this, this.document, this.Bppl.Views.Comment, this.Bppl.Models.Comment, this.Bppl.Helpers.Utilities, undefined );
/**
*
* Controller Like
*/
( function( $, window, document, view, model, utilities ) {

	var Like = Gillie.Controller.extend({

			// Init
			initialize: function() {

				// Like collection
				this.collection = [];
			}


			// Set a new model with the like data
			// Save the like
			// Render the view of the success process
		,	save: function( callback ) {

				// Check whether there are pending likes
				// and then insert them.
				$.each( this.collection, function( key, like ) {

					// Save unsaved likes
					if ( like.attributes.pending ) {

						// Listen to like model `save` event.
						view.listenTo( like, 'save', view[ callback ] );

						// Save like
						like.save( 'save' );

						// Add saved attr.
						like.attributes.pending = false;

					}

				});
			}


	});

	// Global Exposition
	window.Bppl.Controllers.Like = new Like();



})( this.jQuery, this, this.document, this.Bppl.Views.Like, this.Bppl.Models.Like, this.Bppl.Helpers.Utilities, undefined );
/**
*
* Controller Flag
*/
( function( $, window, document, view, model, utilities ) {

	var Flag = Gillie.Controller.extend({

			// Init
			initialize: function() {

				// Flag collection
				this.collection = [];
			}


			// Set a new model with the Flag data
			// Save the Flag
			// Render the view of the success process
		,	save: function() {

				// re open the modal
				if( ! $( '.Flag-modal' ).is( ':visible' ) )
					utilities.openModal( '.Flag-modal' );

				// Check whether there are pending flags
				// and then insert them.
				$.each( this.collection, function( key, flag ) {

					// Save unsaved flags
					if ( flag.attributes.pending ) {

						// Listen to flag model `save` event.
						view.listenTo( flag, 'save', view.onSave );

						// Save flag
						flag.save( 'save' );

						// Add saved attr.
						flag.attributes.pending = false;
					}

				});
			}


	});

	// Global Exposition
	window.Bppl.Controllers.Flag = new Flag();



})( this.jQuery, this, this.document, this.Bppl.Views.Flag, this.Bppl.Models.Flag, this.Bppl.Helpers.Utilities, undefined );
/**
*
* Controller Follow
*/
( function( $, window, document, view, model, utilities ) {

	var Follow = Gillie.Controller.extend({

			// Init
			initialize: function() {

				// Follow collection
				this.collection = [];

				// Global target
				this.target = document;
			}


			// Set a new model with the Follow data
			// Save the Follow
			// Render the view of the success process
		,	follow: function( event, user ) {

				// Add the target to the view
				view.target = this.target;

				// Check whether there are pending Follows
				// and then insert them.
				$.each( this.collection, function( key, follow ) {

					// Save unsaved Follows
					if ( follow.attributes.pending ) {

						// Listen to Follow model `save` event.

						// Pass current user to model
						// follow.set( 'current_user_id', user.ID );

						// Profile
						view.listenTo( follow, 'profile', view.onProfileFollow );

						// Home grid view
						view.listenTo( follow, 'home', view.onHomeGridViewFollow );

						// follow Follow
						follow.follow( event );

						// Add saved attr.
						follow.attributes.pending = false;

					}

				});
			}


	});

	// Global Exposition
	window.Bppl.Controllers.Follow = new Follow();



})( this.jQuery, this, this.document, this.Bppl.Views.Follow, this.Bppl.Models.Follow, this.Bppl.Helpers.Utilities, undefined );
/**
*
* Controller PostCollection
*/
( function( $, window, document, view, model, utilities ) {

	var PostCollection = Gillie.Controller.extend({

	});

	// Global Exposition
	window.Bppl.Controllers.PostCollection = new PostCollection();



})( this.jQuery, this, this.document, this.Bppl.Views.PostCollection, this.Bppl.Models.PostCollection, this.Bppl.Helpers.Utilities, undefined );


/**
*
* Controller HomePost
*/
( function( $, window, document, view, model, utilities ) {

	var HomePost = function( a ) {

		// Class attributes can be set here
	}

	HomePost.prototype = {


	}

	// Global Exposition
	window.Bppl.Controllers.HomePost = new HomePost();



})( this.jQuery, this, this.document, this.Bppl.Views.HomePost, this.Bppl.Models.HomePost, this.Bppl.Helpers.Utilities, undefined );


/**
*
* Controller List
*/
( function( $, window, document, view, model, utilities ) {

	var List = Gillie.Controller.extend({

			// Init
			initialize: function() {

				// List collection
				this.collection = [];
			}

		,	addToListNew: function( newList ) {

				var list = new model( newList );

				// Listen to list model `save` event.
				view.listenTo( list, 'save', view.onSuccessUserLists );

				list.save( 'save' );
			}

		,	getUserLists: function() {

				var list = new model({ items: this.collection });

				// Listen to list model `getUserLists` event.
				view.listenTo( list, 'getUserLists', view.onSuccessUserLists );

				list.getUserLists( 'getUserLists' );

				utilities.openModal( '.AddToList-modal' );

				// Remove the not-logged-in class
				$( '.add-to-list-button' ).removeClass( 'not-logged-in' );
			}

		,	listFeat: function() {

				var list = new model({ ID: this.collection });

				list.listFeat( 'listFeat' );

			}

	});

	// Global Exposition
	window.Bppl.Controllers.List = new List();

})( this.jQuery, this, this.document, this.Bppl.Views.List, this.Bppl.Models.List, this.Bppl.Helpers.Utilities, undefined );
/**
*
* Controller Carousel
*/
( function( $, window, document, view, model, utilities ) {

	var Carousel = Gillie.Controller.extend({

			// Init
			initialize: function() {

				// Carousel collection
				this.collection = [];
			}


			/**
			* Requests a new page on memory or in server instead
			* @param { object } jquery object targeting the current carousel
			*/
		,	next: function( control, carousel, data ) {

				// if the last page is displayed and user asks for a new non-existent page
				// Ask to the model for new page
				view.carousel = carousel;
				view.control = control;

				if ( view.isLastPage( carousel ) ) {

					$( control ).addClass( 'disabled' );
					$( carousel ).children( '.carousel-overlay' ).show();

					var carousel = new model( data );

					// Listen to Carousel model `load` event.
					view.listenTo( carousel, 'load', view.onLoad );

					carousel.load( 'load' );

					return;

				}

				view.next( carousel );
				view.setLabelCount( data, true );
			}


	});

	// Global Exposition
	window.Bppl.Controllers.Carousel = new Carousel();



})( this.jQuery, this, this.document, this.Bppl.Views.Carousel, this.Bppl.Models.Carousel, this.Bppl.Helpers.Utilities, undefined );
/**
*
* Controller: Bookmarklet
*/
( function( $, window, document, view, model, utilities ) {

	var Bookmarklet = Gillie.Controller.extend({

			// Toggles a tag from the tag collection
            toggleTerm: function( tag, taxonomy, parent ) {

                var availableTax = [ 'category', 'tag' ]
                ,   index;

                if ( availableTax.indexOf( taxonomy ) == -1 ) return false;

                // Category
                if ( taxonomy == 'category' ) {
                    index = view.post.categories[ parent ].indexOf( tag )

                    if ( index != -1 ) {
                        delete view.post.categories[ parent ][ index ];
                        view.post.categories[ parent ].splice( index, 1 );
                    }

                    else {
                        view.post.categories[ parent ].push( tag );
                    }

                    // Trigger event
                    $( view.post.categories ).trigger( 'change', { parent: parent, collection: view.post.categories[ parent ] });

                }

                // Tag
                else if ( taxonomy == 'tag' ) {
                    index = view.post.tags.collection.indexOf( tag );

                    if ( index != -1 ) {
                        delete view.post.tags.collection[ index ];
                        view.post.tags.collection.splice( index, 1 );

                    } else {
                        view.post.tags.collection.push( tag );
                    }

                    // Trigger
                    $( view.post.tags ).trigger( 'change', { collection: view.post.tags.collection });

                }

            }

            // Toggles cont type
        ,   setContType: function( content ) {
                view.post.cont_type = content;
            }


            // Saves the post
        ,   savePost: function() {

                var post
                ,    success = function( data ) {
                        $( view ).trigger( 'savePost', data );
                    }

                ,   error = function( data ) {
                        $( view ).trigger( 'savePostError', data );
                    };


                // Set post data
                post = {
                        featuredImage: view.post.featuredImage
                    ,   title: view.post.title
                    ,   content: view.post.content
                    ,   tags: view.post.tags.collection
                    ,   externalLink: view.post.externalLink
                    ,   content_type: view.post.cont_type
                    ,   attachment: view.post.attachment
                    ,   categories: view.post.categories
                    ,   new_cats: view.post.newCats
                    ,   ID: view.post.ID
                    ,   list_id: view.post.list_id
                    ,   additional_images: view.post.additional_images
                    ,   license : view.post.license
                    ,   detail_link : view.post.thdemo
                }
                // console.log( post );return;
                model.save( post, success, error );
            }

            // Filters key tags
        ,   filterTerms: function( term, tagSection ) {

                var tags = '.bookmarklet ' + tagSection
                ,   items = '.label'
                ,   tagName;

                // Get names
                $( tags ).find( items ).each( function ( key, val ) {
                    tagName = $( this ).data( 'term' );

                    reg = new RegExp( term, 'i' );
                    if  ( ! reg.test( tagName ) ) {
                        $( this ).hide();
                    }

                    else {
                        $( this ).show();
                    }

                });
            }

            // Creates a tag
        ,   createTerm: function( tag, termSection, tax, parent ) {

                var tagsSel = ".bookmarklet-page " + termSection
                ,   catSections = [ '.elements-cats', '.services-cats', '.resources-tags'
                        ,   '.freebies-tags', '.enviroment-tags', '.attribute-tags'
                        ,   '.general-tags', '.theme-tags', '.icons-tags'
                    ]
                ,   tagName
                ,   exists = false
                ,   existsLocally = false
                ,   tagObj;


                // Find cats
                $( tagsSel ).find( ".label" ).each( function( key, val ) {

                    // Assign tag
                    tagName = String( $( this ).data( "term" ) );
                    if ( tagName.trim().toLowerCase() == tag ) {
                        existsLocally = true;
                    }

                });


                // Browse in all the section
                $( catSections.join( ', ' ) ).find( ".label" ).each( function( key, val ) {

                    // Assign tag
                    tagName = String( $( this ).data( "term" ) );

                    if ( tagName.trim().toLowerCase() == tag ) {
                        exists = $( this ).parent().data( "section" );
                    }

                });


                // Does not exists
                if ( ! exists ) {
                    $( tagsSel ).append( '<a href="#" data-tax="' + tax + '" class="selected label label-blue" data-term="' + tag + '" data-term-slug="' + tag.toLowerCase() + '">' + tag + '</a> ' );

                    // Add term to new cats
                    view.post.newCats.push({
                            term: tag
                        ,   tax: tax
                        ,   parent: parent
                        ,   section: termSection
                    });

                    // Toggle tag
                    this.toggleTerm( tag, tax, parent );
                }

                // Exists Locally
                else if ( existsLocally ) {

                    tagObj = $( tagsSel ).find( 'a[data-term-slug="' + tag + '"]' );

                    if ( ( tagObj ).length ) {
                        tagObj.eq( 0 ).toggleClass( 'selected' );
                    }

                    // Toggle tag
                    this.toggleTerm( tag, tax, parent );
                }

                else {
                    alert( 'Category `' + tag + '`  already exists in `' + exists + '`' );
                }

            }

	});

	// Global Exposition
	window.Bppl.Controllers.Bookmarklet = new Bookmarklet();



})( this.jQuery, this, this.document, this.Bppl.Views.Bookmarklet, this.Bppl.Models.Bookmarklet, this.Bppl.Helpers.Utilities, undefined );


/**
*
* Controller Sharing
*/
( function( $, window, document, view, model, utilities ) {

	var Sharing = Gillie.Controller.extend({


	});

	// Global Exposition
	window.Bppl.Controllers.Sharing = new Sharing();



})( this.jQuery, this, this.document, this.Bppl.Views.Sharing, this.Bppl.Models.Sharing, this.Bppl.Helpers.Utilities, undefined );


/**
*
* Controller Submitter
*/
( function( $, window, document, view, model, utilities ) {

	var Submitter = Gillie.Controller.extend({

			// Init
			initialize: function() {

				var el = '#sb-smt-graphic-freebie-editor';
				if ( ! $( el ).length ) { return; }

				// Collection of posts
				this.collection = [];

				// Initialize uploaders
				this.initEditors();

				// Initialize Images uploader
				this.imagesUploaders();

				// Attachment uploader
				// this.attachmentUploader( 'bp-smt-attachment-upload', 'uploader.attachment' );

				// Graphic freebie uploader
				this.featImageUploader( 'sb-smt-graphic-freebie-img-uploader' );

				// Code image uploader
				this.featImageUploader( 'sb-smt-code-freebie-img-uploader' );

				// Resource uploader
				this.featImageUploader( 'sb-smt-too-review-img-uploader' );
			}

			// Initialize uploaders
		,	initEditors: function() {

				var els = [
						'sb-smt-graphic-freebie-editor', 'sb-smt-code-freebie-editor'
					,	'sb-smt-tool-review-editor'/*, 'sb-smt-product-editor', 'sb-smt-deal-editor'
					,	'fork-editor'*/
				];

				$( document ).ready( function() {

					tinyMCE.init({

							// Mode
							mode: 'exact'

						,	elements: els.join( ', ' )
						,	theme: 'advanced'
						,	theme_advanced_statusbar_location: 'none'

						// Buttons
						,	theme_advanced_buttons1: 'bold, link, unlink, insertImage'
						,	theme_advanced_buttons2: ''
						,	theme_advanced_buttons3: ''

						// Toolbar
						,	theme_advanced_toolbar_location: 'top'

						// Setup
						,	setup: function( ed ) {

								// Set placeholder
								var tinymce_placeholder = $( '#' + ed.id );
								var attr = tinymce_placeholder.attr( 'placeholder' );

								// For some browsers, `attr` is undefined; for others,
								// `attr` is false.  Check for both.
							    if ( typeof attr !== 'undefined' && attr !== false ) {
							        var is_default = false;


							        ed.onInit.add( function( ed ) {

							            // Get the current content
							            var cont = ed.getContent();

							            // If its empty and we have a placeholder set the value
							            if( cont.length == 0 ) {
							                ed.setContent( tinymce_placeholder.attr( "placeholder" ) );

							                // Get updated content
							                cont = tinymce_placeholder.attr( "placeholder" );
							            }

							            // convert to plain text and compare strings
							            is_default = ( cont == tinymce_placeholder.attr( "placeholder" ) );

							            // Nothing to do
							            if ( ! is_default ) {
							                return;
							            }
							        });

							        ed.onMouseDown.add( function( ed, e ) {

							            var cont = ed.getContent({format : 'text'});
							            if ( attr != cont ) {
							            	is_default = false;
							            }

							            // Replace the default content on focus if the same as original placeholder
							            if ( is_default ) {
							                ed.setContent( '' );
							            }
							        });
							    }

							}

					});

				});

			}

			// Initialize uploaders
		,	imagesUploaders: function() {

				var dropArea = '#bp-smt-img-dragger'
				,	el = 'bp-smt-upload-images'
				, 	thumbsContainer = $( el )
				,	uploader = new qq.FileUploaderBasic({

							button: document.getElementById( el )
						,	action: window.Constants.libsUrl + '/uploader.php'
						,	debug: true
						,	multiple: true
						,	preview: ''
						,	allowedExtensions: [ 'jpg', 'jpeg', 'gif' ]

							// Submission
						,	onSubmit: function( id, fileName ) {

								if ( id > 4 ) {
									alert( 'A max of 5 images can be uploaded.' );
									return false;
								}
							}

							// Complete
						,	onComplete: function( id, fileName, response ) {

								view.onImageUploaded( this.preview, id, response );
							}

						,	onProgress: function( id, fileName, uploadedBytes, totalBytes ) {
								view.imageUploadProgress( this.preview, uploadedBytes, totalBytes );
							}

							// Just before start the upload
						,	onUpload: function( id, fileName ) {

								var container = $( '#bp-smt-img-dragger' );

								html = new EJS({ url: window.Constants.JSTemplates + 'smt.img-thumb.ejs' })
									.render({ id: id, img_path: '' });

								this.preview = $( html );

								// Append the markup with no image.
								this.preview.appendTo( container );
							}

							// NOTE: weirdly this function does not get executed on error
						,	onError: function ( id, fileName, errorReason ) {  }


				});

			}

			// Create uploader for attachments
		,	attachmentUploader: function( targetId, destinyFile ) {

				// Create the uploader for the attachments
				var	succeedUploads = 0
				,	bpAttachmentUploader = new qq.FileUploaderBasic({
						button: document.getElementById( targetId )
					,	action: window.Constants.libsUrl + '/' + destinyFile + '.php'
					,	debug: true
					,	allowedExtensions: [ 'psd', 'ai', 'jpg', 'png', 'jpeg', 'zip', 'gif' ]
					,	multiple: false

					,	onSubmit: function( id, fileName ) {

							// Validate Success uploads
							if ( succeedUploads > 0 ) {
								alert( 'You can only upload one attachment' );
								return false;
							}

						}

					,	onUpload: function( id, fileName ) { }

					,	onProgress: function( id, fileName, uploadedBytes, totalBytes  ) {

							// return view.onProgressAttachmentUploader( uploadedBytes, totalBytes );
							view.progressAttachUpload( uploadedBytes, totalBytes );
						}

					,	onComplete: function( id, fileName, response  ) {

							// Attachment uploaded
							if ( response.success == true ) {
								succeedUploads++;

								// Save attachment
								return view.onAttachUploaded( response );
							}

						}

					,	onError: function( id, fileName, errorReason ) {

							// Failed upload
							utilities.alert( 'Oops!, file is too large. Try again' );
						}

				});

			}

			// Creates the featured image for the specified target
		,	featImageUploader: function( targetId )  {

				var imgFitSize = false
				,	bpImagesUploader = new qq.FileUploaderBasic({
						button: document.getElementById( targetId )
					,	action: window.Constants.libsUrl + '/uploader.feat-image.php'
					,	debug: true
					,	multiple: false
					,	peview: ''
					,	allowedExtensions: [ 'jpg', 'jpeg' ]
					,	onSubmit: function( id, fileName ) {

							if ( ! bpImagesUploader._isAllowedExtension( fileName )  )
								return false;
						}

					,	onComplete: function( id, fileName, response ) {
							return view.onFeatImgUploaded( response );
						}

					,	onProgress: function( id, fileName, uploadedBytes, totalBytes ) {

							view.onProgressFImageUploader( uploadedBytes, totalBytes );
						}

						// Just before start the upload
					,	onUpload: function( id, fileName ) { }

						// NOTE: Weirdly this function does not get executed on error
					,	onError: function( id, fileName, errorReason ) { }

				});
			}


			// Save method acting as interface to store data
			// while user logs in.
		,	save: function() {

				// Save post
				model.save( 'save' );
			}


	});

	// Global Exposition
	window.Bppl.Controllers.Submitter = new Submitter();



})( this.jQuery, this, this.document, this.Bppl.Views.Submitter, this.Bppl.Models.Submitter, this.Bppl.Helpers.Utilities, undefined );


/**
*
* Controller BuilderPage
*/
( function( $, window, document, view, model, utilities ) {

	var BuilderPage = Gillie.Controller.extend({

			initialize: function() { }

			// Toggle term
        ,   toggleTerm: function( slug, termId, tax, parent ) {

                var availableTax = [ 'category', 'tag' ]
                ,   availableParents = [ 'key', 'environment' ]
                ,   index, term, collection;

                if ( availableTax.indexOf( tax ) == -1 ) {
                    return false;
                }

                term = {
                		ID: termId
                	,	slug: slug
                }

                // Category
                if ( tax == "category" ) {

                    if ( availableParents.indexOf( parent ) == -1 ) {
                        return false;
                    }

                    utilities.toggle( model.attributes.categories[ parent ], term );

                    // Trigger change and get first page
                    model.set( 'page', 1 )
                    	.getPosts( 'sync' );

                }

                // Tag
                else if ( tax == "tag" ) {
                    utilities.toggle( model.attributes.tags, term );

                    // Trigger change and get first page
                    model.set( 'page', 1 )
                    	.getPosts( 'sync' );
                }

            }


            // Toggles a not in term
        ,   toggleTermNotIn: function( term, termId, tax, parent ) {

                var availableTax = [ 'category', 'tag' ]
                ,   availableParents = [ 'key', 'environment' ]
                ,   index, collection;

                if ( availableTax.indexOf( tax ) == -1 ) {
                    return false;
                }

                // Create term
                term = {
                        ID: termId
                    ,   slug: term
                }

                // Category
                if ( tax == 'category' ) {

                    if ( availableParents.indexOf( parent ) == -1 ) {
                        return false;
                    }

                    utilities.toggle( model.attributes.categories_not_in, term );

                    // Trigger change and get first page
                    model.set( 'page', 1 )
                        .getPosts( 'sync' );

                }

                // Tag
                else if ( tax == 'tag' ) {
                    utilities.toggle( model.attributes.tags_not_in, term );

                    // Trigger change and get first page
                    model.set( 'page', 1 )
                        .getPosts( 'sync' );

                }

            }

            // Filters a term for a section
        ,   filterTerms: function( term, section ) {

                var terms = ".builder-body "
                ,   items = ".label"
                ,   termName
                ,   match = 0
                ,   map = {
                            key: ".key-cat-terms"
                        ,   env: ".env-cat-terms"
                        ,   tag: ".tag-terms"
                    }

                // Add section to query
                terms += map[ section ];

                $( terms ).find( items ).removeClass( "focus" )
                    .each( function( key, val ) {

                        termName = $( this ).text();

                        req = new RegExp( term, "i" );
                        if ( ! req.test( termName ) ) {
                            $( this ).hide();
                        }

                        else {
                            match++;
                            if ( match == 1 && term ) {
                                $( this ).addClass( "focus" );
                            }
                            $( this ).show();
                        }

                });

            }

            // Creates a representation of the term
            // and appends it to the input container
        ,   selectTerm: function() {

                var terms = ".builder-body .key-cat-terms"
                ,   selectContainer = ".builder-body .select-container"
                ,   template
                ,   tax
                ,   section
                ,   slug;

                // Find selected element
                slug = $( terms ).find( ".label.focus" ).data( "slug" );
                parent = $( terms ).find( ".label.focus" ).data( "parent" );
                tax = $( terms ).find( ".label.focus" ).data( "tax" );


                // This event will be responible for creating
                // the representation of the element
                // Fired then: onClick, and on enter
                // console.log( slug, parent, tax );


                // Build template
                template = [ '<li class="select-search-choice">'
                        ,   '<a href="#" data-slug="" data-section="" data-tax=""></a>'
                        ,   '</li>'
                    ].join( " " );

                // Insert
                $( template ).insertBefore( $( selectContainer ).find( ".select-search-field" ) );

            }

            // Removes a term from te selected list
            // And removes its representation
        ,   deselectTerm: function() {

            }


            // Fired when terms are added or removed
            // Takes care of creating the terms representation
            // Before each section's input
        ,   onQueryChange: function() {
                //
            }

            // Creates a list with the selected terms
        ,   createList: function( data ) {
                model.createList( data );
            }


	});

	// Global Exposition
	window.Bppl.Controllers.BuilderPage = new BuilderPage();



})( this.jQuery, this, this.document, this.Bppl.Views.BuilderPage, this.Bppl.Models.BuilderPage, this.Bppl.Helpers.Utilities, undefined );

/**
*
* Controller Sidebar
*/
( function( $, window, document, view, model, utilities ) {

	var Sidebar = Gillie.Controller.extend({

			initialize: function() {

			}

		,	save: function() {

				$( '.BecomeCurator-modal' ).show();
				$( '.modal-backdrop' ).show();

				view.listenTo( model, 'save', view.onSave );

				model.save( 'save' );

			}

	});

	// Global Exposition
	window.Bppl.Controllers.Sidebar = new Sidebar();



})( this.jQuery, this, this.document, this.Bppl.Views.Sidebar, this.Bppl.Models.Sidebar, this.Bppl.Helpers.Utilities, undefined );


/**
*
* Controller Curation
*/
( function( $, window, document, view, model, utilities ) {

	var Curation = Gillie.Controller.extend({

		initialize: function() {

		}


	});

	// Global Exposition
	window.Bppl.Controllers.Curation = new Curation();



})( this.jQuery, this, this.document, this.Bppl.Views.Curation, this.Bppl.Models.Curation, this.Bppl.Helpers.Utilities, undefined );


/**
*
* Controller Edition
*/
( function( $, window, document, view, model, utilities ) {

	var Edition = Gillie.Controller.extend({

		initialize: function() {

		}


	});

	// Global Exposition
	window.Bppl.Controllers.Edition = new Edition();



})( this.jQuery, this, this.document, this.Bppl.Views.Edition, this.Bppl.Models.Edition, this.Bppl.Helpers.Utilities, undefined );


/**
*
* Controller LinkGenerator
*/
( function( $, window, document, view, model, utilities ) {

	var LinkGenerator = Gillie.Controller.extend({

		initialize: function() {

		}


	});

	// Global Exposition
	window.Bppl.Controllers.LinkGenerator = new LinkGenerator();



})( this.jQuery, this, this.document, this.Bppl.Views.LinkGenerator, this.Bppl.Models.LinkGenerator, this.Bppl.Helpers.Utilities, undefined );


/**
*
* Controller Search
*/
( function( $, window, document, view, model, utilities ) {

	var Search = Gillie.Controller.extend({

	});

	// Global Exposition
	window.Bppl.Controllers.Search = new Search();



})( this.jQuery, this, this.document, this.Bppl.Views.Search, this.Bppl.Models.Search, this.Bppl.Helpers.Utilities, undefined );


/**
*
* Controller Breadcrumb
*/
( function( $, window, document, view, model, utilities ) {

	var Breadcrumb = Gillie.Controller.extend({

			initialize: function() {}

	});

	// Global Exposition
	window.Bppl.Controllers.Breadcrumb = new Breadcrumb();



})( this.jQuery, this, this.document, this.Bppl.Views.Breadcrumb, this.Bppl.Models.Breadcrumb, this.Bppl.Helpers.Utilities, undefined );


/**
*
* Controller Social
*/
( function( $, window, document, view, model, utilities ) {

	var Social = Gillie.Model.extend({

	});

	// Global Exposition
	window.Bppl.Controllers.Social = new Social();



})( this.jQuery, this, this.document, this.Bppl.Views.Social, this.Bppl.Models.Social, this.Bppl.Helpers.Utilities );


/**
*
* Controller Post
*/
( function( $, window, document, view, model, utilities ) {

	var Post = Gillie.Controller.extend({

	});

	// Global Exposition
	window.Bppl.Controllers.Post = new Post();



})( this.jQuery, this, this.document, this.Bppl.Views.Post, this.Bppl.Models.Post, this.Bppl.Helpers.Utilities, undefined );


/**
* Controller: marketplace
*/
( function( $, window, document, view, model, utilities ) {

	var marketplace = Gillie.Controller.extend({

		// Called on instantiation
		initialize: function() {

		}

	});

	// Global Exposition
	window.Bppl.Controllers.marketplace = new marketplace();


})( this.jQuery, this, this.document, this.Bppl.Views.marketplace, this.Bppl.Models.marketplace, this.Bppl.Helpers.Utilities );

/**
* Controller: photo
*/
( function( $, window, document, view, model, utilities ) {

	var photo = Gillie.Controller.extend({

		// Called on instantiation
		initialize: function() {

		}

	});

	// Global Exposition
	window.Bppl.Controllers.Photo = new photo();


})( this.jQuery, this, this.document, this.Bppl.Views.photo, this.Bppl.Models.photo, this.Bppl.Helpers.Utilities );

/**
* Miscelaneous Handler
*/
( function( $, window, document, /*view, controller, model,*/ utilities ) {

	var Misc = Gillie.Handler.extend({

			initialize: function() {

				this.checkLocal();

				this.checkCookies();

				// Turn download button fixed in lists
				this.turnListDwnBtnFixed();

				// Turn curator actions div fixed
				this.turnCuratorActionsFixed();

				// Turn Blog Posts actions div fixed
				this.turnBlogPostsActionsFixed();

				// Turn curators actions div fixed
				this.turnCuratorsActionsFixed();

				// Turn affiliate
				this.turnAffiliateFixed();

				// Activate pretty print
				this.prettyPrint();

				// Handle popover actions
				this.popover();

				// Handle tooltip actions
				this.tooltip();

				// Curation wall
				this.curationSetActiveState();

				// Setup featured image uploader
				// this.setupFeaturedImageUploader();

				// Adjust margin list
				// this.widthPostTitle();

				this.descriptionNone();

				this.showBackToTop();

				this.showFaqTransition();

				this.initLoadScripts();

				this.lazyLoad();

				this.placeHolderIE();

				// this.redactorArea( '.user-redactor' );
				// this.redactorArea( '.edit-me', 800, 240, true );

				// check for clean url's in editor curators box
				this.cleanUrl();
				// this.redactorArea( '.post-redactor', 789, 240 );

				// Animate border
				this.animatedBorder();

				/* _Marketplace uploader buttons*/
				Bppl.Controllers.Submitter.featImageUploader( 'marketplace-item-feat-img-uploader' );
				Bppl.Controllers.Submitter.attachmentUploader( 'marketplace-item-attachment-upload', 'uploader.free.attachment.marketplace' );
				Bppl.Controllers.Submitter.attachmentUploader( 'marketplace-premium-item-attachment-upload', 'uploader.premium.attachment.marketplace' );

				// _Photo Content type uploader photos
				Bppl.Controllers.Submitter.featImageUploader( 'photo-item-feat-img-uploader' );
				Bppl.Controllers.Submitter.attachmentUploader( 'photo-item-attachment-upload', 'uploader.photo.attachment' );

				// _Theme Content type uploader photos
				Bppl.Controllers.Submitter.featImageUploader( 'theme-item-feat-img-uploader' );
				Bppl.Controllers.Submitter.attachmentUploader( 'theme-item-attachment-upload', 'uploader.theme.attachment' );

				// Profile image uploader
				Bppl.Controllers.Submitter.attachmentUploader( 'profile-img-upload', 'uploader.profile-image' );

				// Galleries
				// utilities.bpGallery( '.bppl-img-gallery' );

				// Initialize responsive
				this.isMobile();


				// Enable filters
				this.enableFilters();

				// Simulate events method
				this.simulateEvents();

				// chk superlists items
				this.superListItems();

				// chk creators
				this.chkCreators();

				this.sidebarGallery();
				// center image use class
				// this.centerImage();

				$( '#wpadminbar' ).toggle();

				(function( jQuery ) {
					var matched,
						userAgent = navigator.userAgent || "";

					// Use of jQuery.browser is frowned upon.
					// More details: http://api.jquery.com/jQuery.browser
					// jQuery.uaMatch maintained for back-compat
					jQuery.uaMatch = function( ua ) {
						ua = ua.toLowerCase();

						var match = /(chrome)[ \/]([\w.]+)/.exec( ua ) ||
							/(webkit)[ \/]([\w.]+)/.exec( ua ) ||
							/(opera)(?:.*version)?[ \/]([\w.]+)/.exec( ua ) ||
							/(msie) ([\w.]+)/.exec( ua ) ||
							ua.indexOf("compatible") < 0 && /(mozilla)(?:.*? rv:([\w.]+))?/.exec( ua ) ||
							[];

						return {
							browser: match[ 1 ] || "",
							version: match[ 2 ] || "0"
						};
					};

					matched = jQuery.uaMatch( userAgent );

					jQuery.browser = {};

					if ( matched.browser ) {
						jQuery.browser[ matched.browser ] = true;
						jQuery.browser.version = matched.version;
					}

					// Deprecated, use jQuery.browser.webkit instead
					// Maintained for back-compat only
					if ( jQuery.browser.webkit ) {
						jQuery.browser.safari = true;
					}

				}( jQuery ));

				/*
				  Plugin: iframe autoheight jQuery Plugin
				  Version: 1.9.5
				  Description: when the page loads set the height of an iframe based on the height of its contents
				  see README: http://github.com/house9/jquery-iframe-auto-height
				*/
				// !function(e){e.fn.iframeAutoHeight=function(t){function i(e){h.debug&&h.debug===!0&&window.console&&console.log(e)}function n(t,n){i("Diagnostics from '"+n+"'");try{i("  "+e(t,window.top.document).contents().find("body")[0].scrollHeight+" for ...find('body')[0].scrollHeight"),i("  "+e(t.contentWindow.document).height()+" for ...contentWindow.document).height()"),i("  "+e(t.contentWindow.document.body).height()+" for ...contentWindow.document.body).height()")}catch(r){i("  unable to check in this state")}i("End diagnostics -> results vary by browser and when diagnostics are requested")}var r;if(e.browser===r){var o=[];return o.push("WARNING: you appear to be using a newer version of jquery which does not support the $.browser variable."),o.push("The jQuery iframe auto height plugin relies heavly on the $.browser features."),o.push("Install jquery-browser: https://raw.github.com/house9/jquery-iframe-auto-height/master/release/jquery.browser.js"),alert(o.join("\n")),e}var h=e.extend({heightOffset:0,minHeight:0,maxHeight:0,callback:function(){},animate:!1,debug:!1,diagnostics:!1,resetToMinHeight:!1,triggerFunctions:[],heightCalculationOverrides:[]},t);return i(h),this.each(function(){function t(e){var t=null;return jQuery.each(o,function(i,n){return e[n]?(t=s[n],!1):void 0}),null===t&&(t=s["default"]),t}function r(r){h.diagnostics&&n(r,"resizeHeight"),h.resetToMinHeight&&h.resetToMinHeight===!0&&(r.style.height=h.minHeight+"px");var o=e(r,window.top.document).contents().find("body"),s=t(e.browser),a=s(r,o,h,e.browser);i(a),a<h.minHeight&&(i("new height is less than minHeight"),a=h.minHeight),h.maxHeight>0&&a>h.maxHeight&&(i("new height is greater than maxHeight"),a=h.maxHeight),a+=h.heightOffset,i("New Height: "+a),h.animate?e(r).animate({height:a+"px"},{duration:500}):r.style.height=a+"px",h.callback.apply(e(r),[{newFrameHeight:a}])}var o=["webkit","mozilla","msie","opera"],s={};s["default"]=function(e,t,i){return t[0].scrollHeight+i.heightOffset},jQuery.each(o,function(e,t){s[t]=s["default"]}),jQuery.each(h.heightCalculationOverrides,function(e,t){s[t.browser]=t.calculation});var a=0,c=this.contentDocument||this.contentWindow.document;if(i(this),h.diagnostics&&n(this,"each iframe"),h.triggerFunctions.length>0){i(h.triggerFunctions.length+" trigger Functions");for(var u=0;u<h.triggerFunctions.length;u++)h.triggerFunctions[u](r,this)}if(e.browser.webkit||e.browser.opera||e.browser.chrome){i("browser is webkit or opera"),e(this).load(function(){var e=0,t=this,n=function(){r(t)};0===a?e=500:t.style.height=h.minHeight+"px",i("load delay: "+e),setTimeout(n,e),a++});var g=e(this).attr("src");e(this).attr("src",""),e(this).attr("src",g)}else"complete"===c.readyState?r(this):e(this).load(function(){r(this)})})}}(jQuery);;
				// setInterval( function () {
				// 	$('iframe#single-frame').iframeAutoHeight({debug: true});
				// }, 500 );

			}

		,	events: {
					// 'hover .hover-hint': 'tooltip'
				// ,	'hover .link-tooltip-deal , .main-tooltip-deal': 'tooltipMenu'
				// ,	'hover .link-tooltip-freebie , .main-tooltip': 'tooltipFreebie'

					// Edit post title
				// ,	'dbclick .post-header .post-title': ''

					// Save single post title
					'blur .post-header .post-title, .post-title-feat-list': 'savePostTitle'
				,	'focus .post-header .post-title, .description.post-content-editable': 'focusPostTitle'

				,	'blur .ext-link': 'saveExternalLink'
				,	'focus .ext-link': 'focusExtLink'
				,	'click .edit-ext-link': 'extLink'

				,	'blur .post_name': 'savePostName'
				,	'focus .post_name': 'focusPostName'
				,	'click .edit-postname': 'postName'

				,	'click .curation-back-to-top': 'backToTop'
				,	'click .privacy-policy': 'linkPopUp'
				,	'click .terms-and-conditions': 'linkPopUp'
				,	'click a[role="show-anchor"]': 'showFaqAnswer'

				,	'click a[role="faq-list"]': 'showFaqAnswer'
				// ,	'hover a[role="faq-title"]': 'showFaqTop'
				,	'click a[role="faq-title"]': 'backToTop'
				//	manage tootips in bypeople
				,	'mouseover .navbar-tooltip, .follows .like-post, .flag-article, .hint-tooltip': 'tooltips'
				,	'mouseleave .link-tooltip, .follows, .flag-article, .hint-tooltip': 'outTooltips'
				,	'focus .mi-title, .price' : 'clean'
				,	'blur .mi-title, .price' : 'reset'

				,	'blur .description.post-content-editable': 'savePostContent'

				// 	Affiliate
				,	'click .btn-generate-link': 'linkAffiliate'

				// Results filter
				,	'click .filter': 'filterBy'

				// Results filter attr
				,	'click .filter-attr': 'filterByAttr'

				// Close modals
				,	'click .close-this:not( .the-post-editor )': 'closeThis'
				,	'click .close-landing' : 'retractHome'
				,	'click .main-intro-principal .close-this': 'closeThisAd'

				// Screenshots
				,	'click .post-editor #byp_screenshot' : 'getScreenshot'

				// Open links in background
				, 	'click a[target="_blank"]': 'openInBackground'

				// Show creators
				,	'click .view-all-creators': 'showCreators'

				// Enable min login
				,	'click *[data-login-type]:not( .btn-facebook ):not( .btn-google-plus ):not( .btn-github )': 'showLoginForm'

				// hover image
				,	'mouseover .lbl-usr-avatar': 'hoverCard'

				// create link to send emails for authors
				,	'click .create-author-link': 'createAuthorLink'
				,	'click .make-author-link': 'makeAuthorLink'

				// Extras
				,	'click .download-article': 'downArt'

				// Expanded btn large-view
				,	'click .expandList': 'expandList'

				,	'click .expandSuperList': 'expandSuperList'
				// scroll to list
				,	'click .scrollList': 'scrollList'

				// scroll intro
				,	'click .scrollIntro': 'scrollIntro'

				// back history submmit
				,	'click .close.submmit': 'backHistory'

				// simple tooltip
				,	'mouseover .hint-tooltip': 'simpleTooltipOver'
				,	'mouseleave .hint-tooltip': 'simpleTooltipLeave'

				// hide/show admin bar
				,	'click .hide-admin-bar': 'hideAdminBar'

				// sidebar gallery bundle
				,	'click .elementBundleSidebar .btn_prev' : 'sidebarGalleryMove'
				,	'click .elementBundleSidebar .btn_next': 'sidebarGalleryMove'

				// format in contenteditable
				,	'paste [contenteditable]': 'pasteFormat'

				// remove sticky post from home cookie
				,	'click .not-show-more': 'notShowAgain'

				// Desktop mode version
				,	'click .desktop-mode': 'desktopView'
			}

		,	desktopView: function ( e ) {
				e.preventDefault();

				var targetWidth = 1240;

			    // $('#view-full').bind('click', function(){
			    $('meta[name="viewport"]').attr('content', 'width=' + targetWidth);
			    // });
			}

			//	Generate link affiliate
		,	linkAffiliate: function ( e ) {

				e.preventDefault();
				var getLink = $( '.link-user-affiliate' ).val()
				,	valueaff = $( '.value-aff' ).data( 'link-aff' );

				$( '.main-banner-generate' ).addClass( 'show-banner-generate' );
				getLink = getLink + valueaff;
				$( '.get-link-aff' ).val( getLink );

				$( '.banner-full-href' ).attr( 'href' , getLink );

				/* Code Full Banner */
				$( '.full-banner-code' ).text(

									'<style type="text/css"> @import url( "http://bypeople.com/css/banner/affiliate.css" ); </style>' +
									'<a href="' + getLink + '" target="_blank">' +
										'<div class="main-full-banner">' +
											'<aside>ADVERTISEMENT</aside>' +
											'<h3>5 GB of amazing and useful design resources ready to use in your projects</h3>' +
											'<span>Bypeople Join in</span>' +
										'</div>' +
									'</a>'

								);

				/* Squaer Mini Banner */
				$( '.rectangle-square-mini-code' ).text(

									'<style type="text/css"> @import url( "http://bypeople.com/css/banner/affiliate.css" ); </style>' +
									'<a href="' + getLink + '" target="_blank">' +
										'<div class="main-square-mini-banner">' +
											'<aside>ADVERTISEMENT</aside>' +
											'<h3>5 GB of amazing and useful design resources ready to use in your projects</h3>' +
											'<span>Bypeople Join in</span>' +
										'</div>' +
									'</a>'

								);

				/* Rectangle Medium Banner */
				$( '.rectangle-square-code' ).text(

									'<style type="text/css"> @import url( "http://bypeople.com/css/banner/affiliate.css" ); </style>' +
									'<a href="' + getLink + '" target="_blank">' +
										'<div class="main-square-banner">' +
											'<aside>ADVERTISEMENT</aside>' +
											'<h3>5 GB of amazing and useful design resources ready to use in your projects</h3>' +
											'<span>Bypeople Join in</span>' +
										'</div>' +
									'</a>'

								);

				/* Rectangle Large Banner */
				$( '.rectangle-large-code' ).text(

									'<style type="text/css"> @import url( "http://bypeople.com/css/banner/affiliate.css" ); </style>' +
									'<a href="' + getLink + '" target="_blank">' +
										'<div class="main-rectangle-large">' +
											'<aside>ADVERTISEMENT</aside>' +
											'<h3>5 GB of amazing and useful design resources ready to use in your projects</h3>' +
											'<span>Bypeople Join in</span>' +
										'</div>' +
									'</a>'

								);

			}

			// Animate border ( Authors Signup )
		,	animatedBorder: function() {

				$( '.border-top-animate-market' ).delay( 1000 ).animate({ 'width': '100%' }, 2000);
				$( '.border-top-animate' ).delay( 3000 ).animate({ 'width': '100%' }, 2000);

			}

		,	placeHolderIE: function() {

 				var input = document.createElement("input");

			    if( ( 'placeholder' in input ) == false ) {

					$( '[placeholder]' ).focus( function() {

						var i = $( this );

						if( i.val() == i.attr( 'placeholder' ) ) {

							i.val( '' ).removeClass( 'placeholder' );

							if( i.hasClass( 'password' ) ) {

								i.removeClass( 'password' );
								this.type = 'password';

							}
						}

					}).blur( function() {
						var i = $( this );
						if( i.val() == '' || i.val() == i.attr( 'placeholder' ) ) {
							if( this.type == 'password' ) {
								i.addClass( 'password' );
								this.type = 'text';
							}
							i.addClass( 'placeholder' ).val( i.attr( 'placeholder' ) );
						}
					}).blur().parents( 'form' ).submit( function() {

						$( this ).find( '[ placeholder]' ).each( function() {

							var i = $( this );
							if( i.val() == i.attr( 'placeholder' ) )
								i.val( '' );

						})

					});
				}

			}

			// Turn lists download button fixed when
			// it reaches the top of the screen.
		,	turnListDwnBtnFixed: function() {

				var el = '.selected-categories'
				,	actions = '.floating-actions'
				,	floatMain = '.float-main'
				,	navegation = '.navbar'
				,	logoMain = '.wrapper-logo img'
				,	actionsBtn = '.actions-buttons'
				,	userArea = '.user-topbar-area'
				,	titleLogo = '.title-logo span'
				,	leftPos, divPos;

				if ( ! $( el ).length ) return;

				// Turn element fixed when scrolltop
				// is at 130px.
				utilities.scrollTopCallback( 520

					,	function() {
							$( el ).find( actions )
								.addClass( 'floating' );
							$( floatMain ).css( 'display' , 'block' );
							// $( navegation ).css( 'height' , '38' ).addClass( 'semisticky' );
							// $( logoMain ).css( 'height' , '30' );
							// $( titleLogo ).css( 'font-size' , '22' );
							// $( actionsBtn ).animate({ marginTop: '8px' }, 0);
							// $( userArea ).animate({ marginTop: '10px' }, 0);
						}

					,	function() {
							$( el ).find( actions )
								.removeClass( 'floating' );
							$( floatMain ).css( 'display' , 'none' );
							// $( navegation ).css( 'height' , '44' ).removeClass( 'semisticky' );
							// $( logoMain ).css( 'height' , '37' );
							// $( titleLogo ).css( 'font-size' , '28' );
							// $( actionsBtn ).animate({ marginTop: '12px' }, 0);
							// $( userArea ).animate({ marginTop: '12px' }, 0);
						}
				);

			}


			// Activates prettyprint in
			// all "pre" tags.
		,	prettyPrint: function() {

				prettyPrint();

			}

			// Popover handlers
		,	popover: function() {

				var els = [ '.Popover-list-download', '.Popover-single-download', '.Popover-code-bundle' ];

				$.each( els, function( k, v ) {

					// Close when clicked outside.
					utilities.closeOnClickOut( v );
				});

			}

			// tooltip handlers
		,	 tooltip: function() {

				$( '.hover-hint' ).tooltip({
					placement: 'top'
				});

			}
			// tooltip menu
		,	tooltipMenu: function( e ) {

				e.preventDefault();
				$( '.feat-deal' ).toggleClass( 'toggle-tooltip' );
				$( '.triangle-top-deal' ).toggleClass( 'toggle-tooltip' );

			}

		,	tooltipFreebie: function( e ) {

				e.preventDefault();
				$( '.feat-freebie' ).toggleClass( 'toggle-tooltip' );
				$( '.triangle-top' ).toggleClass( 'toggle-tooltip' );

			}

			// Turn curator actions fixed
		,	turnCuratorActionsFixed: function() {

				var el = '.post-body'
				,	actions = '.curator-actions'
				,	logginAff = '.main-sidebar-aff';

				if ( ! $( el ).length ) return;

				// Turn element fixed when scrolltop
				// is at 108px.
				utilities.scrollTopCallback( 108

					,	function() {
							$( el ).find( actions )
								.addClass( 'fixed' );
						}

					,	function() {
							$( el ).find( actions )
								.removeClass( 'fixed' );
						}
				);

			}

			// Turn enter affiliate
		,	turnAffiliateFixed: function() {

				var logginAff = '.main-sidebar-aff';

				// Turn element fixed when scrolltop
				// is at 380px.
				utilities.scrollTopCallback( 300

					,	function () {
							$( logginAff ).addClass( 'fixed-aff' );
						}

					,	function () {
							$( logginAff ).removeClass( 'fixed-aff' );
						}
				);

			}

			// Turn Blog Posts actions fixed
		// ,	turnBlogPostsActionsFixed: function() {

		// 		var el = '.Home-sidebar-wrapper'
		// 		,	actions = '.related-meta';

		// 		if ( ! $( el ).length ) return;

		// 		// Turn element fixed when scrolltop
		// 		// is at 108px.
		// 		utilities.scrollTopCallback( 1443

		// 			,	function () {
		// 					$( el ).find( actions )
		// 						.addClass( 'sticky-blog' );
		// 				}

		// 			,	function () {
		// 					$( el ).find( actions )
		// 						.removeClass( 'sticky-blog' );
		// 				}
		// 		);

		// 	}

			// Turn Blog Posts actions fixed
		,	turnBlogPostsActionsFixed: function() {

				var el = '.ads-zone'
				,	actions = '.ads-block';

				if ( ! $( el ).length ) return;

				// Turn element fixed when scrolltop
				// is at 108px.
				utilities.scrollTopCallback( 1505

					,	function () {
							$( el ).find( actions )
								.addClass( 'sticky-blog' );
						}

					,	function () {
							$( el ).find( actions )
								.removeClass( 'sticky-blog' );
						}
				);

			}

			// Turn list curators Posts actions fixed
		,	turnCuratorsActionsFixed: function() {

				var el = '.main-postshome-wrapper'
				,	actions = '.curators-area';

				if ( ! $( el ).length ) return;

				// Turn element fixed when scrolltop
				// is at 108px.
				utilities.scrollTopCallback( 480

					,	function() {
							$( '.with-curators,.list-comments-wrapper' ).css( 'margin-left', '' );

							$( '.floating-actions.closed' ).addClass( 'floating' );
							$( '.floating-actions.closed .float-main' ).css( 'display' , 'block' );
							$( el ).find( actions )
								.addClass( 'sticky-curators' )
						}

					,	function() {
							$( '.with-curators,.list-comments-wrapper' ).css( 'margin-left', '' );

							$( '.floating-actions.closed' ).removeClass( 'floating' );
							$( '.floating-actions.closed .float-main' ).css( 'display' , 'none' );
							$( el ).find( actions )
								.removeClass( 'sticky-curators' );
						}
				);

			}


			// Set active state of curation items
		,	curationSetActiveState: function() {

				var el = '.curator-wall-page'
				,	hash;

				if ( ! $( el ).length ) return;

				hash = window.location.hash.match( /(.*)$/ );
				hash = hash ? hash[ 1 ] : '';
				hash = hash.replace( '#', '.' );

				if ( _.isEmpty( hash ) ) return;

				// Add active state to element
				$( hash ).addClass( 'active' );

				$( 'html, body' ).animate({
		          	scrollTop: $( hash ).offset().top - 200
		        }, 500 );

		    }

		    // Focus post title
		,	focusPostTitle: function( e ) {
				e.preventDefault();

                var target = e.currentTarget;
                $( target ).data( 'original-title', $( target ).text().trim() );

			}

		    // Focus post title
		,	focusExtLink: function( e ) {
				e.preventDefault();

                var target = e.currentTarget;
                $( target ).data( 'original-ext-link', $( target ).text().trim() );

			}

		    // Focus post title
		,	extLink: function( e ) {
				e.preventDefault();

				var target = e.currentTarget;

                 $( target ).parent().find( '.ext-link' ).show();

			}

		    // Focus post title
		,	focusPostName: function( e ) {
				e.preventDefault();

                var target = e.currentTarget;
                $( target ).data( 'original-post-name', $( target ).text().trim() );

			}

		    // Focus post title
		,	postName: function( e ) {
				e.preventDefault();

				var target = e.currentTarget;

                $( target ).parent().find( '.post_name' ).show();

			}

		    // Save post
		,	savePostTitle: function( e ) {

				e.preventDefault();

                var target = e.currentTarget
                ,   title = $( target ).text().trim()
                ,   originalTitle = $( target ).data( 'original-title' )
                ,   postId = $( target ).data( 'post-id' )
                ,	postType = $( target ).data( 'post-type' )
                ,   post = {
                            ID: postId
                        ,   title: title
                        ,	post_type: postType
                        ,   ref: 'builder'
                        ,   tags: [ 'post-revised' ]
                    };

                // Set variables
                if ( title != originalTitle ) {


                    // Save Post
                    window.Bppl.Models.Bookmarklet.save( post, function( data ) {

                        utilities.alert( 'Post saved!', null, null, 2000 );
                    });

                }

		    }

		    // Save post content
		,	savePostContent: function( e ) {

				e.preventDefault();

                var target = e.currentTarget
                ,   content = $( target ).text().trim()
                ,   originalContent = $( target ).data( 'original-content' )
                ,   postId = $( target ).data( 'post-id' )
                ,	postType = $( target ).data( 'post-type' )
                ,   post = {
                            ID: postId
                        ,   content: content
                        ,	post_type: postType
                        ,   ref: 'builder'
                        ,   tags: [ 'post-revised' ]
                    };

                // Set variables
                if ( content != originalContent ) {


                    // Save Post
                    window.Bppl.Models.Bookmarklet.save( post, function( data ) {

                        utilities.alert( 'Post saved!', null, null, 2000 );
                    });

                }

		    }

		    // Save post
		,	saveExternalLink: function( e ) {

				e.preventDefault();

                var target = e.currentTarget
                ,   extLink = $( target ).text().trim()
                ,   originalExtLink = $( target ).data( 'original-ext-link' )
                ,   postId = $( target ).data( 'post-id' )
                ,   post = {
                            ID: postId
                        ,   external_link: extLink
                        ,   ref: 'builder'
                        ,   tags: [ 'post-revised' ]
                    };

                // Hide the field
                $( '.ext-link' ).hide();

                // Set variables
                if ( extLink != originalExtLink ) {

                    // Save Post
                    window.Bppl.Models.Bookmarklet.save( post, function( data ) {

                        utilities.alert( 'External link saved!', null, null, 2000 );
                        $( '.post-source-button' ).attr( 'href', extLink );

                    });

                }

		    }

		    // Save post
		,	savePostName: function( e ) {

				e.preventDefault();

                var target = e.currentTarget
                ,   postName = $( target ).text().trim()
                ,   originalPostName = $( target ).data( 'original-post-name' )
                ,   postId = $( target ).data( 'post-id' )
                ,   post = {
                            ID: postId
                        ,   post_name: postName
                        ,	post_type: 'posts-lists'
                        ,   ref: 'builder'
                        ,   tags: [ 'post-revised' ]
                    };

                // Hide the field
                $( '.post_name' ).hide();

                // Set variables
                if ( postName != originalPostName && postName != '' ) {

                    // Save Post
                    window.Bppl.Models.Bookmarklet.save( post, function( data ) {
                        utilities.alert( 'The Slug has changed!', null, null, 2000 );

                    });

                }

		    }

		,	descriptionNone: function () {

				var size = $( '.description-suspensive' ).height()
				,	main = $( '#anchor' )
				,	title = $( '.lbl-post-link' )
				,	titlePack = [];

				if ( size < 1 ) {
					$( title ).each( function () {

					    titlePack.push( $( this ).text() );
					});

					$( main ).append( titlePack.slice( 0 , 3 ) );
				}

			}

			// Show go to top button
		,	showBackToTop: function() {

				var page = '.container-1200'
				,	el = '.curation-back-to-top';

				if ( ! $( page ).length ) {
					return;
				}

				$( window ).scroll( function() {
					if ( $( window ).scrollTop() > 800 ) {
						$( el ).fadeIn();
					} else {
						$( el ).fadeOut();
					}
				});

			}

			// Scroll the page back to the top
		,	backToTop: function( e ) {

				e.preventDefault();

				$( 'html , body' ).animate({
					scrollTop: 0
				}, 300 );

			}

			// Open link in a pop up
		,	linkPopUp: function( e ) {

				e.preventDefault();

				var target = e.currentTarget
				,	url = $( target ).attr( 'href' )
				,	width = $( target ).data( 'width' )
				,	height = $( target ).data( 'height' )
				,	top = ( $( window ).height() - height ) / 2
				,	left = ( $( window ).width() - width ) / 2
				,	options = 'width=' + width + ', height=' + height + ', top=' + top + ', left=' + left + ', scrollbars=yes';

				window.open( url , 'Pop Up', options );

			}

		,	showFaqAnswer: function( e ) {

				e.preventDefault();

				var target = e.currentTarget
				,	name = $( target ).data( 'name' );

				$( 'html, body' ).animate({
					scrollTop: $( 'a[name="' + name + '"]' ).offset().top - 60
				}, 300 );

			}

		,	showFaqTop: function( e ) {

				e.preventDefault();

				var target = e.currentTarget
				,	name = $( target ).attr( 'name' )
				,	top = '.faq-page span.top[data-name="' + name + '"]'
				,	isHover = $( target ).is( ':hover' );

				if ( isHover ) {
					$( top ).addClass( 'active' );
				} else {
					$( top ).removeClass( 'active' );
				}

			}

		,	showFaqTransition: function() {

				var path = utilities.getPath()
				,	parts = path.split( '/' )
				,	faq_link = parts[ 0 ]
				,	faq_parts = faq_link.split( '#' )
				,	name = faq_parts[ 1 ];

				if ( faq_parts[ 0 ] == 'faq' && typeof name != 'undefined' ) {
					$( 'html, body' ).animate({
						scrollTop: $( 'a[name="' + name + '"]' ).offset().top - 60
					}, 300 );
				}

			}

		,	tooltips: function ( e ){

				var target = e.currentTarget
				,	content = $( target ).data( 'content' )
				,	position = $( target ).data( 'position' )
				,	elClass = $( target ).data( 'elclass' );

				utilities.tooltip( e, position, elClass, content );
			}

		,	outTooltips: function ( e ){

				var target = e.currentTarget
				,	content = $( target ).data( 'content' )
				,	position = $( target ).data( 'position' );

				$( target ).parent().find( '.tooltip-bppl' ).remove();
			}

			// Load scripts that have interference on init load revise pls
		,	initLoadScripts: function () {

				// $.getScript( '//assets.pinterest.com/js/pinit.js' );
				// $.getScript( '//connect.facebook.net/en_US/all.js#xfbml=1' );
				//
			}

			// Load scripts that have interference on init load
		,	lazyLoad: function () {
				$( 'img.lazy' ).lazyload({
				    	effect : "show"
				    ,	threshold : 200
				    ,	load : function() {
		            		window.Bppl.Handlers.Misc.centerImage();
		            }
				});
			}

			// Enable redactor for users input textarea ahi mi vida a mi se me olvido que pena con tigo
		,	redactorArea: function ( element, w, h, btns ) {

				if ( btns )
					btns = [ 'createLink', 'undo', 'redo', 'sep', 'bold', 'italic' ]
				else
					btns = [ 'createLink', 'undo', 'redo', 'sep', 'bold', 'italic', 'underline', 'sep', 'fontSize', 'sep', 'insertImage' ];

				$( element ).editable({

			        	inlineMode: false
			        ,   imageUploadURL: window.Constants.libsUrl + '/redactor.php'
			        ,	borderColor: "#96ab14"
			        ,	height: ( h ) ? h : 225
			        ,	width: ( w ) ? w : 450
		            ,	alwaysVisible: true
            		,	buttons: btns

			            // Set the image error callback.
			        ,	imageErrorCallback: function ( data ) {
			                // Bad link.
			                if ( data.errorCode == 1 ) {
			                	console.log( 'Error link', data );
			                }

			                // No link in upload response.
			                else if ( data.errorCode == 2 ) {
			                	console.log( 'Sorry no link', data );
			                }

			                // Error during file upload.
			                else if ( data.errorCode == 3 ) {
			                	console.log( 'upps!', data )
			                }

			                // Parsing response failed.
			                else if ( data.errorCode == 4 ) {
			                	console.log( 'bad parsed', data );
			                }
			            }
		        });

			}

		,	clean: function ( e ) {

				var target = e.currentTarget;

				utilities.emulatePlaceholder( e );
			}

		,	reset: function ( e ) {

				var target = e.currentTarget;

				utilities.resetPlaceholder( e );
			}

			// Mobile Bppl functions
		,	isMobile: function ( e ) {

				// share plugin to mobile style
				$.getScript( '//s7.addthis.com/js/300/addthis_widget.js' );


				// slide menu for mobile devices
				$( '.slide-menu-icon' ).bind( 'touchstart', function () {

					if ( ! $( 'body' ).hasClass( 'slide-menu-active' ) ) {
						$( 'body' ).addClass( 'slide-menu-active' );
						$( '.slide-menu' ).addClass( 'active' );

						/* hide fixed modals */
						$( '.mt-modal' ).removeClass( 'is-visible' ).hide();
                        $( '.background-main-menu, .container-1200' ).removeClass( 'mt-blurred' );
						$( '.overlay-search, .search-modal, .search-navbar' ).removeClass( 'active' );
						$( '.search-modal' ).animate( { opacity: 0 }, 10 ).hide();
						$( '.overlay-search' ).animate( { opacity: 0 }, 10 ).slideUp( 10 );
						$( '.container-1200' ).unbind( 'mousewheel' );
						$( '.container-1200' ).unbind( 'touchmove' );

					} else {
						$( 'body' ).removeClass( 'slide-menu-active' );
						$( '.slide-menu' ).removeClass( 'active' );
					};
				});

				// if ( $( '.Home-postshome-wrapper' ).hasClass( 'list-single' ) ) { $( '.sidebar-responsive, .navbar' ).addClass( 'list' ) }

				// dropdown menu header desktop
				var down = $( '.changelink' ),
					menu = $( '.downmenu' ),
					defa = $( '.wrapper-logo a li' ),
					element = $( '.downmenu li' );

				menu.hide();

				down.click( function(e) {
					e.stopPropagation();
					if ( menu.hasClass( 'active' ) ) {
						menu.removeClass( 'active' ).hide()
						down.addClass( 'icon-chevron-down');
						down.removeClass( 'icon-chevron-up' );
					} else {
						menu.addClass( 'active' ).show();
						down.removeClass( 'icon-chevron-down');
						down.addClass( 'icon-chevron-up' );
					}
				});

				menu.click( function(e) {
				 	e.stopPropagation();
				});

				// element.click( function() {
				// 	$( this ).addClass( select ).appendTo( '.wrapper-logo a' );
				// 	defa.appendTo( menu );
				// 	defa = $( this );
				// });

				$( document ).click( function() {
				   	if ( menu.hasClass( 'active' ) ) {
				    	menu.removeClass( 'active' ).hide();
				    	down.addClass( 'icon-chevron-down');
						down.removeClass( 'icon-chevron-up' );
					}
				});

				// end dropdown desktop version

				$( document ).click( function() {

					$( '.newsletter-mobile, .avatarMobile, .menu-link' ).removeClass( 'active' );

					if ( $( '.profile-tooltip' ).hasClass( 'active' ) )
						$( '.profile-tooltip' ).toggleClass( 'active' );

				});

				$( '.drop-navbar' ).click( function( e ){

					e.stopPropagation();
					e.preventDefault();

					$( '.profile-tooltip' ).toggleClass( 'active' );

				});

				// select menu responsive
				$( '.logo' ).click( function() {

					window.location = window.Constants.siteURL;

				});

				// Search Modal
				$( '.search-navbar, .search-modal .close' ).click( function() {

					if ( $( '.overlay-search, .search-modal' ).hasClass( 'active' ) ) {

						$( '.overlay-search, .search-modal, .search-navbar' ).removeClass( 'active' );
						$( '.search-modal' ).animate( { opacity: 0 }, 10 ).hide();
						$( '.overlay-search' ).animate( { opacity: 0 }, 10 ).slideUp( 10 );

						$( '.container-1200' ).unbind( 'mousewheel' );
						$( '.container-1200' ).unbind( 'touchmove' );


					} else {

						$( '.search-modal' ).show().animate( { opacity: 1 }, 10 );
						$( '.mt-modal' ).removeClass( 'is-visible' );

						$( '.overlay-search' ).animate( { opacity: 1 }, 10 ).show();
						$( '.overlay-search, .search-modal' ).addClass( 'active' );

						$( '.overlay-search, .search-modal' ).bind( 'mousewheel MozMousePixelScroll', function() { return false; } );
						$( '.overlay-search, .search-modal' ).bind( 'touchmove', function() { return false; } );

					}

					$( document ).keyup( function( e ) {

                        if ( e.keyCode == 27 ) {

                            $( '.overlay-search, .search-modal' ).removeClass( 'active' );
                            $( '.overlay-search.in-photo-single, .overlay-search.in-photos' ).removeClass( 'hidden' );
							$( '.search-modal' ).animate( { opacity: 0 }, 10 ).hide();
							$( '.overlay-search' ).animate( { opacity: 0 }, 10 ).slideUp( 10 );

						}

                    });

				});

				// modal close
				$( '.regular-link.align-login.mt-btn' ).bind( 'touchstart click', function() {
					// $( '.overlay-search, .search-modal, .search-navbar' ).removeClass( 'active' );
					// $( '.search-modal' ).animate( { opacity: 0 }, 10 ).hide();
					// $( '.overlay-search' ).animate( { opacity: 0 }, 10 ).slideUp( 10 );
					// $( '.container-1200' ).unbind( 'mousewheel' );
					// $( '.container-1200' ).unbind( 'touchmove' );
				});

			}

		, 	sidebarGallery: function() {

				$( '.elementBundleSidebar' ).each(function() {

					var slider = $( this ).find( $( '.slider ul' ) )
					,	sliderLi = slider.find( 'li' )
					,	slideCount = sliderLi.length
					,	slideWidth = sliderLi.width()
					,	sliderUlWidth = slideCount * slideWidth;

					slider.css({ width: sliderUlWidth, marginLeft: - slideWidth });
					sliderLi.last().prependTo( slider );

				});
			}

		,	sidebarGalleryMove: function ( e ) {
				e.preventDefault();

				var target = e.currentTarget
				,	slider = $( target ).closest( '.elementBundleSidebar' )
				,	sliderUl = slider.find( 'ul' )
				,	sliderLi = sliderUl.find( 'li' )
				,	slideWidth = sliderLi.width()
				,	valueLeft = ( $( target ).hasClass( 'btn_next' ) ) ? '-' + slideWidth : '+' + slideWidth;

				if ( ! $( target ).hasClass( 'disable' ) ) {
					$( target ).addClass( 'disable' );
					sliderUl.animate({
						left: valueLeft
					}, 100, function () {
						( $( target ).hasClass( 'btn_next' ) ) ? sliderLi.first().appendTo( sliderUl ) : sliderLi.last().prependTo( sliderUl );
						sliderUl.css('left', '');
						$( target ).removeClass( 'disable' );
					});
				}
			}

			// Enable filters
		,	enableFilters: function () {

				var resources = $( 'li[role="resource"]' ).length
				,	graphics = $( 'li[role="graphic"]' ).length
				,	liveCodes = $( 'li[role="code"]' ).length
				,	lists = $( 'li[role="list"]' ).length;

				if ( resources >= 1 )
					$( '.filter[data-filter-by="resource"]' ).show().parent().addClass( 'active' ).parent().addClass( 'resource' );

				if ( liveCodes >= 1 )
					$( '.filter[data-filter-by="code"]' ).show().parent().addClass( 'active' ).parent().addClass( 'code' );

				if ( graphics >= 1 )
					$( '.filter[data-filter-by="graphic"]' ).show().parent().addClass( 'active' ).parent().addClass( 'graphic' );

				if ( lists >= 1 )
					$( '.filter[data-filter-by="list"]' ).show().parent().addClass( 'active' ).parent().addClass( 'list' );

			}

			// Make filters by content type
		,	filterBy: function ( e ) {

				e.preventDefault();

				var target = e.currentTarget
				,	val = $( target ).data( 'filter-by' );

				localStorage.filterBy = val;

				// Remove if exists
				$( '.filter' ).removeClass( 'filter-pressed' );
				$( 'li.results-list-listview' ).removeClass( 'filtered' );
				// $( '.wall' ).remove();

				// Add necessary classes and methods to run
				$( target ).addClass( 'filter-pressed' );
				$( 'li.results-list-listview:not( .filtered )' ).animate({
					opacity: 1
				});

				$( 'li[role="' + val +  '"]' ).addClass( 'filtered' ).prependTo( $( 'li[role="' + val +  '"]' ).parent() );
			}

			// Make filters by attr (rand|length|date)
		,	filterByAttr: function ( e ) {



				var target = e.currentTarget
				,	val = $( target ).data( 'filter-by' )
				,	li = '.results-list-listview'
				,	byLength = byDate = byRand = [];

				localStorage.filterByAttr = val;
				///last modifed

				if ( val == "listslym" || val == "bundles"){
					utilities.startWorking(target);
					return true;
				}else{
					e.preventDefault();
				}

				// Remove if exists
				$( '.filter-attr' ).removeClass( 'filter-pressed' );

				// Add necessary classes and methods to run
				$( target ).addClass( 'filter-pressed' );

				if ( val == 'length' ) {

 					// extract data from the lists
					$( li ).each( function () {
						// put raw data in array
						byLength.push( $( this ).data( 'count-items' ) );
					});

					// sort desc the array
					byLength = _.sortBy( byLength, function( num ) {
					    return -num;
					});

					// rearrange lists by items number
					$.each( byLength, function ( key, val ) {

						$( 'li.results-list-listview[data-count-items="' + val +  '"]' ).appendTo( $( 'li[data-count-items="' + val +  '"]' ).parent() );
					});

				}

				if ( val == 'date' ) {

 					// extract data from the lists
					$( li ).each( function () {
						// put raw data in array
						byDate.push( $( this ).data( 'timestamp' ) );
					});

					// sort desc the array
					byDate = _.sortBy( byDate, function( num ) {
					    return -num;
					});

					// rearrange lists by items number
					$.each( byDate, function ( key, val ) {

						$( 'li.results-list-listview[data-timestamp="' + val +  '"]' ).appendTo( $( 'li[data-timestamp="' + val +  '"]' ).parent() );
					});
				}

				if ( val == 'rand' ) {

 					// extract data from the lists
					$( li ).each( function () {
						// put raw data in array
						byRand.push( $( this ).data( 'count-items' ) );
					});

					// sort desc the array
					byRand = _.sortBy( byRand, function( num ) {
					    return num;
					});

					// rearrange lists by items number
					$.each( byRand, function ( key, val ) {

						$( 'li.results-list-listview[data-count-items="' + val +  '"]' ).appendTo( $( 'li[data-count-items="' + val +  '"]' ).parent() );
					});
				}


			}

		,	closeThis: function ( e ) {

				e.preventDefault();

				var target = e.currentTarget;

				$( target ).parent().animate({
					opacity: 0
				}, 400, function() {
					$( this ).slideUp();
				});

			}

		,	closeElement: function ( targetClass ) {

				var target = targetClass;

				$( target ).parent().animate({
					opacity: 0
				}, 500, function() {
					$( this ).slideUp();
				});

			}

		,	closeThisAd: function ( e ) {

				e.preventDefault();

				var target = e.currentTarget
				,	li = $( '.select-filters > li:nth-last-child( 2 )' );

				// li.addClass( 'top-6' );

				if ( $( '.filter-by-type' ).length > 0 ) {

					li.find( '.bppl-pet' ).remove();
				}

				// $( '.filter-by-type' ).addClass( 'top-30' );

			}

			// Close landing
		,	retractHome: function ( e ) {

				e.preventDefault();

				$( '.background-main-menu' ).addClass( 'no-intro' );

				$( '.main-intro-principal' ).removeClass( 'intro' );

				$( '.main-intro-principal span' ).removeClass( 'intro' );

				// Set the cookie when the user clicks the close button.
				if ( window.Constants.IS_FRONTPAGE )
					utilities.newCookie( 'introbppl', 'lol', 30 );
			}

			// Check anything
		,	checkLocal: function () {

				// Set the cookie if is the first time for the user
				if ( window.Constants.IS_FRONTPAGE )
					utilities.newCookie( 'visitor', 'new', 10 );
			}

		,	getScreenshot: function ( e ) {

				e.preventDefault();

				var bookmark = window.Bppl.Handlers.Bookmarklet;

				bookmark.get_screenshot( e );
			}

			// Open links in backgrounds
		,	openInBackground: function( e ) {

				if ( jQuery.browser.chrome ) {

					e.preventDefault();

					$( e.currentTarget ).removeAttr( 'target' );

					$( e.currentTarget ).simulate( 'click', { ctrlKey: true });

					$( e.currentTarget ).attr( 'target', '_blank' );
				}

			}

			// Simulate events
		,	simulateEvents: function () {
				(function($,undefined){var rkeyEvent=/^key/,rmouseEvent=/^(?:mouse|contextmenu)|click/;$.fn.simulate=function(type,options){return this.each(function(){new $.simulate(this,type,options)})};$.simulate=function(elem,type,options){var method=$.camelCase("simulate-"+type);this.target=elem;this.options=options;if(this[method])this[method]();else this.simulateEvent(elem,type,options)};$.extend($.simulate,{keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,NUMPAD_ADD:107,
				NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38},buttonCode:{LEFT:0,MIDDLE:1,RIGHT:2}});$.extend($.simulate.prototype,{simulateEvent:function(elem,type,options){var event=this.createEvent(type,options);this.dispatchEvent(elem,type,event,options)},createEvent:function(type,options){if(rkeyEvent.test(type))return this.keyEvent(type,options);if(rmouseEvent.test(type))return this.mouseEvent(type,
				options)},mouseEvent:function(type,options){var event,eventDoc,doc,body;options=$.extend({bubbles:true,cancelable:type!=="mousemove",view:window,detail:0,screenX:0,screenY:0,clientX:1,clientY:1,ctrlKey:false,altKey:false,shiftKey:false,metaKey:false,button:0,relatedTarget:undefined},options);if(document.createEvent){event=document.createEvent("MouseEvents");event.initMouseEvent(type,options.bubbles,options.cancelable,options.view,options.detail,options.screenX,options.screenY,options.clientX,options.clientY,
				options.ctrlKey,options.altKey,options.shiftKey,options.metaKey,options.button,options.relatedTarget||document.body.parentNode);if(event.pageX===0&&event.pageY===0&&Object.defineProperty){eventDoc=event.relatedTarget.ownerDocument||document;doc=eventDoc.documentElement;body=eventDoc.body;Object.defineProperty(event,"pageX",{get:function(){return options.clientX+(doc&&doc.scrollLeft||body&&body.scrollLeft||0)-(doc&&doc.clientLeft||body&&body.clientLeft||0)}});Object.defineProperty(event,"pageY",{get:function(){return options.clientY+
				(doc&&doc.scrollTop||body&&body.scrollTop||0)-(doc&&doc.clientTop||body&&body.clientTop||0)}})}}else if(document.createEventObject){event=document.createEventObject();$.extend(event,options);event.button={0:1,1:4,2:2}[event.button]||event.button}return event},keyEvent:function(type,options){var event;options=$.extend({bubbles:true,cancelable:true,view:window,ctrlKey:false,altKey:false,shiftKey:false,metaKey:false,keyCode:0,charCode:undefined},options);if(document.createEvent)try{event=document.createEvent("KeyEvents");
				event.initKeyEvent(type,options.bubbles,options.cancelable,options.view,options.ctrlKey,options.altKey,options.shiftKey,options.metaKey,options.keyCode,options.charCode)}catch(err){event=document.createEvent("Events");event.initEvent(type,options.bubbles,options.cancelable);$.extend(event,{view:options.view,ctrlKey:options.ctrlKey,altKey:options.altKey,shiftKey:options.shiftKey,metaKey:options.metaKey,keyCode:options.keyCode,charCode:options.charCode})}else if(document.createEventObject){event=document.createEventObject();
				$.extend(event,options)}if(!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase())||{}.toString.call(window.opera)==="[object Opera]"){event.keyCode=options.charCode>0?options.charCode:options.keyCode;event.charCode=undefined}return event},dispatchEvent:function(elem,type,event){if(elem.dispatchEvent)elem.dispatchEvent(event);else if(elem.fireEvent)elem.fireEvent("on"+type,event)},simulateFocus:function(){var focusinEvent,triggered=false,element=$(this.target);function trigger(){triggered=true}element.bind("focus",
				trigger);element[0].focus();if(!triggered){focusinEvent=$.Event("focusin");focusinEvent.preventDefault();element.trigger(focusinEvent);element.triggerHandler("focus")}element.unbind("focus",trigger)},simulateBlur:function(){var focusoutEvent,triggered=false,element=$(this.target);function trigger(){triggered=true}element.bind("blur",trigger);element[0].blur();setTimeout(function(){if(element[0].ownerDocument.activeElement===element[0])element[0].ownerDocument.body.focus();if(!triggered){focusoutEvent=
				$.Event("focusout");focusoutEvent.preventDefault();element.trigger(focusoutEvent);element.triggerHandler("blur")}element.unbind("blur",trigger)},1)}});function findCenter(elem){var offset,document=$(elem.ownerDocument);elem=$(elem);offset=elem.offset();return{x:offset.left+elem.outerWidth()/2-document.scrollLeft(),y:offset.top+elem.outerHeight()/2-document.scrollTop()}}function findCorner(elem){var offset,document=$(elem.ownerDocument);elem=$(elem);offset=elem.offset();return{x:offset.left-document.scrollLeft(),
				y:offset.top-document.scrollTop()}}$.extend($.simulate.prototype,{simulateDrag:function(){var i=0,target=this.target,options=this.options,center=options.handle==="corner"?findCorner(target):findCenter(target),x=Math.floor(center.x),y=Math.floor(center.y),coord={clientX:x,clientY:y},dx=options.dx||(options.x!==undefined?options.x-x:0),dy=options.dy||(options.y!==undefined?options.y-y:0),moves=options.moves||3;this.simulateEvent(target,"mousedown",coord);for(;i<moves;i++){x+=dx/moves;y+=dy/moves;coord=
				{clientX:Math.round(x),clientY:Math.round(y)};this.simulateEvent(target.ownerDocument,"mousemove",coord)}if($.contains(document,target)){this.simulateEvent(target,"mouseup",coord);this.simulateEvent(target,"click",coord)}else this.simulateEvent(document,"mouseup",coord)}})})(jQuery);

			}

			// Chk superlist items
		,	superListItems: function () {

				var postIds = []
				,	retrieve;

				$( 'li[data-post-class="superlist-item"]' ).each( function () {

					retrieve = _.indexOf( postIds, $( this ).data( 'post-id' ) );

					// Chk if the post exits in the array
					if ( retrieve == -1 ) {

						$( this ).addClass( 'revised' );
						postIds.push( $( this ).data( 'post-id' ) );
					}

					// remove repeated list
					else {
						$( this ).remove();
					}

				});

			}

		,	centerImage: function () {

			// focused the image based on the height of the container
			var contentBox = $( '.centerImage' ),
				contentImage = contentBox.find( 'img' ),
				contentOutSize = ( contentImage.height() - contentBox.height() ) / 2;

			contentImage.each( function ( e ) {
				if ( contentImage.height() > contentBox.height() ){
					$( this ).css({ 'margin-top' : -contentOutSize + 'px' });
				}
			});

		}

			// Chek creators
		,	chkCreators: function () {

				var template = '<li class="except-this"><a href="" class="icon-plus view-all-creators"></a></li>'
				,	length;

				$( '.created-by' ).each( function ( e ) {

					length = $( this ).find( 'li' ).length;

					if ( length > 5 ) {
						$( template ).insertAfter( $( this ).find( 'li' ).eq( 4 ) );
					}
				});

			}

			// Show creators
		,	showCreators: function ( e ) {

				e.preventDefault();

				var target = e.currentTarget
				,	modalTemplate = '<div class="modal-creators"></div>'
				,	creators = $( target ).parent().parent().find( 'li:not( .except-this )' ).clone();

				$( target ).parent().append( modalTemplate );
				$( '.modal-creators' ).append( creators );

				utilities.closeOnClickOut( '.modal-creators', function(){ $( '.modal-creators' ).remove(); } );

			}

			// Show login forms
		,	showLoginForm: function ( e ) {

				e.preventDefault();

				var target = e.currentTarget
				,	loginType = $( target ).data( 'login-type' )
				,	clickOutClass = '.' + loginType
				,	parentId = $( target ).data( 'parent-id' )
				,	data = $( target ).data()

				// Save in storage use it for google plus and github login strategies
				utilities.storageManager( 'session', 'set', 'likeData', data );
				utilities.newCookie( 'likeData', data );

				// console.log( data ); return;

				// remove other actives
				$( '.min-login' ).removeClass( 'active' );

				// Clean cache from the form
				$( '#login-form, #register-form, .box-left .btn-facebook, .box-left .btn-google-plus, .box-left .btn-github' ).removeData();

				// active actual
				$( target ).parent().find( clickOutClass ).addClass( 'active' );

				// Open the login form set to trigger the `user.login` event.
				if ( parentId )
					window.Bppl.Views.User.toggleLogin( 'user.login', loginType, null, parentId );
				else
					window.Bppl.Views.User.toggleLogin( 'user.login', loginType, data, null );

				utilities.closeOnClickOut( clickOutClass, function(){ $( clickOutClass ).hide(); } );
			}

			// hovercards
		,	hoverCard: function ( e ) {

				e.preventDefault();

				var target = e.currentTarget
				,	template = '';

				console.log( 'relative' );
			}

		,	cleanUrl: function () {

				utilities.updatePath( '/' + window.Constants.pathName );
			}

		,	createAuthorLink: function ( e ) {

				e.preventDefault();

				var target = e.currentTarget;


				$( '.set-mail' ).removeClass( 'active' ).removeAttr( 'style' );
				$( target ).parent().find( '.set-mail' ).addClass( 'active' );

				if ( $( '.set-mail.active' ).attr( 'data-html' ) )
					$( '.set-mail.active' ).html( $( '.set-mail.active' ).data( 'html' ) );

				// utilities.closeOnClickOut( '.set-mail', function(){ $( '.set-mail' ).removeClass( 'active' ); } );
			}

		,	makeAuthorLink: function ( e ) {

				e.preventDefault();

				var target = e.currentTarget
				,	idMd5 = $( target ).data( 'crypt' )
				,	id = $( target ).data( 'item-id' )
				,	email = $( target ).parent().find( 'input' ).val()
				,	html = $( target ).parent().html()
				,	templateLink = window.location.origin + window.Constants.pathName + '?own_author=true&4d9d6c17eeae2754c9b49171261b93b=' + email + '&authlocki=' + idMd5 + '#' + idMd5;

				$( '.set-mail.active' ).attr( 'data-html', html );
				$( '.set-mail.active' ).html( templateLink ).prepend( '<span class="close-this">&times;</span>' );

				// console.log( templateLink );
			}

		,	downArt: function ( e ) {

				e.preventDefault();

				var target = e.currentTarget
				,	position = $( target ).data( 'position' )
				,	elClass = $( target ).data( 'elclass' )
				,	content = $( target ).data( 'content' );

				utilities.popover( e, position, elClass, content );
				utilities.closeOnClickOut( '.popover-bppl', function() { $( '.popover-bppl' ).remove(); } );

			}

		,	expandList: function ( e ) {

			e.preventDefault();

			var target = e.currentTarget
			,	element = $( target ).parent().parent()
			, 	compact = $( target ).find( '.compact' )
			, 	expand = $( target ).find( '.expand' );

			if ( element.hasClass( 'expand' ) ) {
				element.removeClass( 'expand' );
				compact.hide();
				expand.show();
			} else {
				element.addClass( 'expand' );
				expand.hide();
				compact.show();
			}

		}
		,	expandSuperList: function ( e ) {

			e.preventDefault();

			$( '.expandSuperList' ).removeClass( 'pressed' );

			var btn = e.currentTarget
			,	lists = $( '.list-items.large-view' )
			,	listsBtn = $( '.expandList' )
			,	top = $( window ).scrollTop();

			$( btn ).addClass( 'pressed' );

			if ( $( btn ).hasClass( 'normal' ) ) {
				listsBtn.removeClass( 'full' );
				lists.find( '.group' ).removeClass( 'full' );
				lists.find( '.mediumImage' ).removeClass( 'hide' );
				lists.find( '.full-img' ).addClass( 'hide' );
			} else {
				lists.find( '.group' ).addClass( 'full' );
				lists.find( '.mediumImage' ).addClass( 'hide' );
				lists.find( '.full-img' ).removeClass( 'hide' );
				listsBtn.addClass( 'full' );
				$( 'img.load' ).lazyload({
		            	effect : 'fadeIn'
		            ,	threshold : 200
		            ,	load : function() {
		            		$( this ).removeClass( 'loadgif' );
							var imageHeight = $( this ).height()
							,	imageWidth = $( this ).width()
							,	outterHeight = ( imageHeight - 230 ) / 2
							,	outterWidth = ( 760 - imageWidth ) / 2;
							if ( imageHeight > 230 )
								$( this ).css({ 'margin-top' : -outterHeight + 'px' });
							if ( imageWidth < 760 )
								$( this ).css({ 'margin-left' : outterWidth + 'px' });
		            }
		        });
				$( window ).scrollTop( top - 1 );
			}

		}

		,	scrollList: function ( e ) {

			e.preventDefault();

			var element = e.currentTarget
			,	id = '#' + $( element ).attr( 'scrollList' )
			,	top = $( id ).offset().top - 200;

			$( '.scrollList' ).removeClass( 'pressed' );
			$( element ).addClass( 'pressed' );

			$( 'html, body' ).stop().animate({
		        'scrollTop': top
		    }, 250, 'swing');

		}

		,	scrollIntro: function ( e ) {

			e.preventDefault();

			var element = e.currentTarget
			,	size = $( element ).data( 'size' )
			,	top = ( size == "big" ) ? 630 : 165;

			$( 'html, body' ).stop().animate({
		        'scrollTop': top
		    }, 250, 'swing');

		}

		,	backHistory: function () {
				if ( history.length > 3 )
					history.back();
				else
					window.location = '/';
		}

			// simple tooltip over
		,	simpleTooltipOver: function( e ) {

				var target = e.currentTarget
				,	template = '<div class="simple-tooltip">' + $( target ).attr( 'data-content' ) + '</div>';

				$( target ).parent().append( template );

			}

			// simple tooltip leave
		,	simpleTooltipLeave: function( e ) {

				$( '.simple-tooltip' ).remove();

			}

			// Hide admin bar
		,	hideAdminBar: function ( e ) {

				$( '#wpadminbar' ).toggle();
			}

		,	pasteFormat: function ( e ) {
				// $( '.not[contenteditable]' ).on( 'paste', function(e) {
			    e.preventDefault();
			    var text = ( e.originalEvent || e ).clipboardData.getData( 'text/plain' ) || prompt( 'Paste something..' );
			    window.document.execCommand( 'insertText', false, text );
				// });
			}

			/**
			 * [sortelement sort markups element by ]
			 * @param  {[string]} ele [ string element to target]
			 * @param  {[type]} de      [ data attribute element to target]
			 * @return {[type]}         [void]
			 */
		,	sortelement : function ( ele , de, limit, ft ) { //element = to sort  de =

				sort = [];
				limit = typeof limit !== 'undefined' ? limit : 0;
				ft = typeof ft !== 'undefined' ? ft : 0;

				// extract data from the lists
				$( ele ).each( function () {
					// put raw data in array

						sort.push( $( this ).data( de ) );

				});

				// sort desc the array
				sort = _.sortBy( sort, function( num ) {
				    return -num;
				});

				// rearrange lists by items number
				p = 0;
				$.each( sort, function ( key, val ) {




					e = $( ele+'[data-'+de+'="' + val +  '"]' );
					e.appendTo( $( 'li[data-'+de+'="' + val +  '"]' ).parent() );
					if ( ( ft == 1 && ft == e.data( 'ft' ) ) || ( ft == 0 && limit >0  && limit > p) ){
						e.show();
						p++;
						return;
					}else{
						e.hide();
					}

					/*if( (limit >0  && limit < p)  ) {
						e.hide();
					}*/
				});
			}

		,	notShowAgain: function ( e ) {

				var target = e.currentTarget
				,	id = $( target ).attr( 'data-id' )
				,	ids = [];

				if ( utilities.chkCookie( 'stickypost' ) )
					var remoteids = JSON.parse( utilities.chkCookie( 'stickypost' ) );

				if ( remoteids && remoteids.length >= 1 ) {
					remoteids.push( id );
					ids = remoteids;
				}

				else {
					ids.push( id );
				}

				console.log( ids );

				utilities.newCookie( 'stickypost', ids, 365, '/' );
			}

		,	checkCookies: function () {
				var stickypost = utilities.chkCookie( 'stickypost' );

				if ( stickypost && stickypost.length >= 1 ) {

					$( '.sticky-post.hidden' ).each( function ( k, v ) {
						var id = $( v ).attr( 'data-id' );
						var indexof = stickypost.indexOf( id );

						if ( indexof == -1  )
							$( v ).removeClass( 'hidden' );

					});
				}

				else
					$( '.sticky-post.hidden' ).removeClass( 'hidden' );

			}


	});

	// Global Exposition
	window.Bppl.Handlers.Misc = new Misc();


})( this.jQuery, this, this.document, /*this.Bppl.Views.Misc, this.Bppl.Controllers.Misc, this.Bppl.Models.Misc,*/ this.Bppl.Helpers.Utilities, undefined );
/**
*
* Handler NavBar
*/
( function( $, window, document, view, controller, model, utilities ) {

	var NavBar = Gillie.Handler.extend({

			initialize: function() {

			}

		,	events: {
					'click .suggest-item': 'suggestForm'
				,	'click .suggest-new-item': 'sendConfirmation'
				,	'click .allowed' : 'permissions'
				,	'click .set-new-custom-bppl-link': 'openLinkSetUp'
				,	'focus .input-user .to-type': 'cleanField'
				,	'blur .input-user .to-type': 'holdField'
				,	'click .link-to-show': 'setUpSelection'
				,	'click .publish-it': 'publishIt'
			}

			// Open form
		,	suggestForm: function ( e ) {

				e.preventDefault();

				var target = e.currentTarget
				,	loginType = $( target ).data( 'login-type' );

				// // Open the login form set to trigger the `user.login` event.
				// window.Bppl.Views.User.toggleLogin( 'user.login', loginType );
				// utilities.closeOnClickOut( '.suggest-bppl-item', function(){ $( '.suggest-bppl-item' ).hide(); } );

			}

			// Open form
		,	sendConfirmation: function ( e ) {

				e.preventDefault();

				// Initialize vars
				var target = e.currentTarget
				,	email = $( target ).parent().find( '.suggest-item-email' )
				,	required = ( window.Constants.OWNER.length > 1 ) ? [ 'linkSuggested' ] : [ 'email', 'linkSuggested' ]
				,	errors = [];


				// Get the data from the form
				var formId = $( target ).parents( 'form:first' ).attr( 'id' )
				,	data = utilities.formToObject( '#' + formId, false, true )
				,	linkSuggested = $( target ).parents( '.box-container' ).find( '.box-block' ).find( '.link-suggested' ).val()
				,	emailSuggestor = $( target ).parent().find( '.suggest-item-email' ).val()
				,	login_type = $( target ).data( 'login-type' );

				// Minified login
				if ( typeof login_type == 'undefined' )
					var login_type = 'minified';

				// Add the attributes catched to the data object
				data.email = emailSuggestor;
				data.linkSuggested = linkSuggested;
				data.pending = true;

				// Show loading status.
				// $( target ).addClass( 'disabled' )
				//	.attr( 'value', 'Working...' );
				$( target ).text( 'Sending...' ).addClass( 'disabled' );
				$( '.suggest-bppl-item' ).addClass( 'processing' );

				// Validate fields empty
				utilities.validateEmptyFields( required, data, errors );

				if ( errors.length > 0 ) {

					// Print error
					utilities.alert( 'Complete all fields to send your suggestion.' );

					// Enable submitter btn
					$( target ).text( 'Send' ).removeClass( 'disabled' );
					$( '.suggest-bppl-item' ).removeClass( 'processing' );

					return;
				}

				if ( ! utilities.isUrl( data.linkSuggested ) ) {

					// Print error
					utilities.alert( 'Invalid Url format.' );

					// Enable submitter btn
					$( target ).text( 'Send' ).removeClass( 'disabled' );
					$( '.suggest-bppl-item' ).removeClass( 'processing' );

					return;
				}

				var suggestion = new model( data );

				// Validates whether the user is or not logged in
				if ( $( target ).hasClass( 'not-logged-in' ) )  {

					// Save to collection
					controller.collection.push( suggestion );

					var user = window.Bppl.Models.User;

					user.attributes.email = data.email;
					user.attributes.n_token = true;
					user.attributes.li = 13;
					user.attributes.linkSuggested = data.linkSuggested;

					user.register( 'register' );

					return;

				} else {

					// Add to collection
					controller.collection.push( suggestion );

					// Save pending comments
					controller.save( 'onSave' );
				}

				// Clean the textarea
				//$( '#' + formId ).find( 'textarea' ).val( '' );

			}

			// check if exists the link
		,	permissions: function ( e ) {

				e.preventDefault();

				var target = e.currentTarget
				,	link = $( target ).parents( '.box-container' ).find( '.box-block' ).find( '.link-suggested' ).val();

				if ( ! link ) {

					// Print error
					utilities.alert( 'Url field cannot be empty.' );

					// Enable submitter btn
					$( target ).removeClass( 'disabled' ).addClass( 'allowed' );

					return;
				}

				if ( ! utilities.isUrl( link ) ) {

					// Print error
					utilities.alert( 'Invalid Url format.' );

					// Enable submitter btn
					$( target ).removeClass( 'disabled' ).addClass( 'allowed' );

					return;
				}

				$( target ).addClass( 'disabled' ).removeClass( 'allowed' ).click();

			}

			// Close form
		,	closeSuggestForm: function ( e ) {

				e.preventDefault();

				// Clean form
				$( '.suggest-bppl-item input' ).val( '' );
				$( '.suggest-bppl-item' ).hide();
			}

			// Open link setup
		,	openLinkSetUp: function ( e ) {

				e.preventDefault();

				$( '.link-setup' ).removeAttr( 'style' ).addClass( 'block' );
			}

			// cleanField set as empty
		,	cleanField: function ( e ) {

				e.preventDefault();

				var target = e.currentTarget;

				$( target ).attr( 'data-placeholder', $( target ).text() );

			  	if ( $( target ).text() == $( target ).data( 'placeholder' ) )
					$( target ).text( '' );
			}

			// holdField set as holdField value
		,	holdField: function ( e ) {

				e.preventDefault();

				var target = e.currentTarget;

				if ( $( target ).text().length <= 1 || $( target ).text() == $( target ).data( 'placeholder' ) )
					$( target ).text( $( target ).data( 'placeholder' ) );
			}

			// setUpSelection
		,	setUpSelection: function ( e ) {

				e.preventDefault();

				var target = e.currentTarget
				,	value = $( target ).data( 'value' );

				$( '.link-to-show' ).removeClass( 'show-it' ).find( 'i:not( .icon-rocket )' ).remove();
				$( target ).addClass( 'show-it' ).prepend( '<i class="icon-pushpin"></i> ' );

				if ( $( '.show-it' ).data( 'value' ) == 'custom' ) {
					$( '.input-user' ).show();
					$( '.id-post' ).hide();
				}

				else if ( $( '.show-it' ).data( 'value' ) == 'id' ) {

					$( '.input-user' ).hide();
					$( '.id-post' ).show();
				}

				else
					$( '.input-user, .id-post' ).hide();


			}

			// publishIt
		,	publishIt: function ( e ) {

				e.preventDefault();

				var target = e.currentTarget
				,	content = $( '.content-custom-link' ).text()
				,	url = $( '.url-custom-link' ).text()
				,	id = $( '.id-custom-link' ).text()
				,	whatsToShow = $( '.show-it' ).attr( 'data-value' )
				,	data = {};

				if (  ! utilities.isUrl( url ) && whatsToShow == 'custom' ) {

					utilities.alert( 'Check the url format' );
					return;
				}

				data.titleLink = content;
				data.url = url;
				data.id = id;
				data.showMethod = whatsToShow;

				var customLink = new model( data );

				// Add to collection
				controller.collection.push( customLink );

				// Save the custom link
				controller.saveLink( 'onSaveLink' );

				// $( '.link-to-show' ).removeClass( 'show-it' ).find( 'i:not( .icon-rocket )' ).remove();
				// $( target ).addClass( 'show-it' ).prepend( '<i class="icon-pushpin"></i> ' );

				// if ( $( '.show-it' ).data( 'value' ) == 'custom' )
				// 	$( '.input-user' ).show();
				// else
				// 	$( '.input-user' ).hide();

			}


	});

	// Global Exposition
	window.Bppl.Handlers.NavBar = new NavBar();



})( this.jQuery, this, this.document, this.Bppl.Views.NavBar, this.Bppl.Controllers.NavBar, this.Bppl.Models.NavBar, this.Bppl.Helpers.Utilities, undefined );
/**
*
* Handler User
*/
( function( $, window, document, view, controller, model, utilities ) {

	var User = Gillie.Handler.extend({

			initialize: function() {

				// Toggle login form
				utilities.setImageUrl( '.profile-posts #page-1' );
                utilities.setImageUrl( '.profile-lists #page-1' );
                utilities.setImageUrl( '.likes-lists #page-1' );
                utilities.setImageUrl( '.following-lists #page-1' );
                this.chkUser();
                this.chk();
                if ( sessionStorage.RP )
                	this.modalRecoverPass();
                this.unloading();

			}

		,	events: {

					'click .register-form.active input[type="submit"]'	  : 'register'
				,	'click #forgot-password'          : 'forgotPassword'
				,	'submit #login-form'	          : 'login'
				,	'click .logout-button'			  : 'logout'
				,	'click .toggle-profile-tooltip'   : 'toggleProfileTooltip'
				,	'submit .User-confirmation-form'  : 'confirm'
				,	'submit .Settings-update'         : 'update'
				,	'submit .reset-password-form'     : 'resetPassword'
				,	'submit .tn-create-password'      : 'topbarCreatePassword'
				,	'submit #newsletter-sign-up'      : 'newsletterRegister'
				,	'submit #newsletter-sign-up-home'      : 'newsletterRegister'
				,	'click .close-notice'             : 'close'
				,	'submit #form-authors-signup'     : 'authorsSignup'
				,	'mouseover .the-profile-img' 		  : 'openSetImgForm'
				,	'mouseleave .profile-img-btn' 		  : 'closeSetImgForm'
				,	'click .set-profile-img'		  : 'setProfileImg'
				,	'focus .link-suggested': 'setLinkActive'
				,	'submit #payment_email'	          : 'gopaypal'
				,	'click .switch-login': 'switchLogin'
				,	'click .back-to-modal': 'btmSwitch'

			}

			// Register in site
		,	register: function( e ) {

				e.preventDefault();

				var	user = {}
				,	target = e.currentTarget
				,	btn = $( '.register-form.active .btn-view-more' )
				,	login_type = $( btn ).attr( 'data-login-type' )
				,	submitBtn = $( target ).find( 'input[type="submit"][value="Register"]' )
				,	getActionReferenceData = $( target ).data(); // Extract all data from external events (like|follow|download|suggest|etc);

				// getActionReferenceData
				user.getActionReferenceData = getActionReferenceData;

				// Add loading state
				if ( typeof login_type == 'undefined' || login_type == 'normal' ) {

					// if ( utilities.isWorking( target ) ) return;
					// utilities.startWorking( target );
					submitBtn.addClass( 'disabled' );

				} else if ( login_type == 'post-submit' ) {

					utilities.alert( 'Saving...' );

				} else if ( login_type == 'minified' ) {

					utilities.alert( 'Working...' );

				}

				// Extract object from form
				data = utilities.getFormData( $( target ).closest( '.register-form.active' ) );

				if( ! this.emailFormValidation( data ) ) { return; }

				model.attributes.email = data.email;
				model.attributes.n_token = data.n_token;
				model.attributes.li = data.li;

				// If a comment exists
				if ( typeof data.comment != 'undefined' ) {

					model.attributes.post_id = data.post_id;
					model.attributes.comment = data.comment;
					model.attributes.parent_id = data.parent_id;

				}

				// If is deals or marketplace
				if ( data.deals && data.marketplace ) {
					model.attributes.deals = data.deals;
					model.attributes.marketplace = data.marketplace;
				}

				else if ( data.deals ) {
					model.attributes.deals = data.deals;
				}

				else if ( data.marketplace ) {
					model.attributes.marketplace = data.marketplace;
				}

				// Additional data attached using getActionReferenceData
				// Object {actionReferencePostid: 23643, actionReferenceType: "post", actionReferenceLogintype: "list-like"}
				if ( user.getActionReferenceData ) {
					model.attributes.post_id = user.getActionReferenceData.actionReferencePostid;
					model.attributes.post_type = user.getActionReferenceData.actionReferenceType;
					model.attributes.attachedEvent = user.getActionReferenceData.actionReferenceLogintype;
				}

				// If post-submit exists via @/submit
				if ( login_type == 'post-submit' ) {

					model.attributes.title = data.title;
					model.attributes.content = data.content;
					model.attributes.owner = data.owner;
					model.attributes.attachments =  data.attachments;
					model.attributes.detail_link = data.detail_link;
					model.attributes.attachedEvent = login_type;
					model.attributes.featured_image = data.featured_image;
				}

				model.register( 'register' );

			}

			// Author marketplace or deals
		,	authorsSignup: function ( e ) {

				e.preventDefault();

				// Initialize vars
				var user = {}
				,	target = e.currentTarget
				,	submit = $( target ).find( 'input[ type="submit" ]' );

				// Get object from form
				data = utilities.getFormData( target );

				// If is deals or marketplace
				if ( data.deals2 && data.marketplace2 ) {
					model.attributes.deals2 = data.deals2;
					model.attributes.marketplace2 = data.marketplace2;
				}

				else if ( data.deals2 ) {
					model.attributes.deals2 = data.deals2;
				}

				else if ( data.marketplace2 ) {
					model.attributes.marketplace2 = data.marketplace2;
				}

				model.authorsSignup( 'authorsSignup' );

			}

			// Register in site using newsletter
		,	newsletterRegister: function( e ) {

				e.preventDefault();
				var	user = {}
				,	target = e.currentTarget
				,	btn = $( '#newsletter-sign-up .btn-success, #newsletter-sign-up-home .btn' );

				// Add loading state
				if ( utilities.isWorking( target ) ) return;
				utilities.startWorking( target );

				// Extract object from form
				data = utilities.getFormData( target );
				if ( ! this.emailFormValidation( data ) ) { return; }

				model.attributes.email = data.email;
				model.attributes.n_token = data.n_token;
				model.attributes.li = data.li;
				model.newsletterRegister( 'newsletterRegister' );

			}

			// Sends a confirmation email so that the user can reset
			// their password
		,	forgotPassword: function( e ) {

				e.preventDefault();

				var email = $( '.register-form.active .register-forget' ).val()
				,	target = e.currentTarget;

				if( ! this.emailFormValidation( { email: email } ) ) { return; }

				// Add loading state
				if ( utilities.isWorking( target ) ) return;
				// utilities.startWorking( target );

				// Set email attribute on model and send password reset link
				model.set( 'email', email )
					.recoverPassword( 'password_recover' );

			}


			// Login
		,	login: function( e ) {

				e.preventDefault();

				// Initialize vars
				var user = {}
				, 	errors = []
				,	target = e.currentTarget
				,	required = [ 'username', 'password' ]
				,	suggestedLink = $( '.link-suggested.active' ).val()
				,	submit = $( target ).find( 'input[ type="submit" ]' )
				,	getActionReferenceData = $( target ).data(); // Extract all data from external events (like|follow|download|suggest|etc)

				// Reset input styles
				$( ':input' ).removeClass( 'error' );

				// Get object from form
				user = utilities.getFormData( target );

				// suggetsed link
				user.suggestedLink = '';

				// getActionReferenceData
				user.getActionReferenceData = getActionReferenceData;

				// chk if the user makes a suggestion
				if ( suggestedLink && suggestedLink.length > 1 )
					user.suggestedLink = suggestedLink;

				// Validate empty fields
				utilities.validateEmptyFields( required, user, errors );

				// Show a notification if the required fields are empty
				if ( errors.length > 0 ) {

					utilities.showGlobalNotification( utilities.cammelCaseToSpace( errors[ 0 ] ) + ' field is required', '', 'failure', null, 0 );
					$( '#' + utilities.cammelCaseToHyphen( errors[ 0 ] ) ).addClass( 'error' );
					return false;

				}

				// Set loading animation
				if ( utilities.isWorking( target ) ) return;
				utilities.startWorking( target );

				// Set attributes and login
				$.extend( model.attributes, user );

				// Remove event if it is not set.
				if ( ! user.event || user.suggestedLink.length > 1 ) {
					delete model.attributes.event;
				}

				model.login( 'login' );

			}

			// Logout
		,	logout: function( e ) {

				e.preventDefault();

				model.logout( 'logout' );

			}

			/**
			* Validate the email value and email format
			*
			* @param { objetc } // object with the user structure that contains the email
			* @return { bool } // true if the validation is ok and false instead.
			*/
		,	emailFormValidation: function( user ) {

				// Initializes the vars
				var required = [ 'email' ]
				,	errors = []
				,	target = $( '#register-form' )
				,	submitBtn = $( target ).find( 'input[type="submit"][value="Register"]' );

				// Reset styles
				$( ':input' ).removeClass( 'error' );

				// Validate empty fields
				utilities.validateEmptyFields( required, user, errors );

				if( errors.length > 0 ) {

					utilities.alert( 'Email field is required' );
					$( '#' + utilities.cammelCaseToHyphen( errors[0] ) ).addClass( 'error' );
					// Remove loading state
					utilities.stopWorking( target );
					submitBtn.removeClass( 'disabled' );
					return false;

				}

				// Validate email format
				if( ! utilities.validateEmailFormat( user.email ) ) {

					utilities.showGlobalNotification( 'Email format is wrong.', '', 'failure', null, 0 );
					$( '#' + utilities.cammelCaseToHyphen( errors[0] ) ).addClass( 'error' );
					return false;

				}

				return true;
			}

			// Shows the top bar tooltip
		,	toggleProfileTooltip: function( e ) {

				e.preventDefault();

				var target = e.currentTarget;

				utilities.closeOnClickOut( '.profile-tooltip',
					function () { $( '.profile-tooltip').hide() } );

				$( '.profile-tooltip' ).toggle();

				if ( $( '.profile-tooltip' ).is( ':visible' ) ) {

					$( '.profile-tooltip' ).css( 'opacity', '1' );

				}

				else {
					$( '.profile-tooltip' ).css( 'opacity', '0' );
				}

			}

			// Confirm user account
		,	confirm: function( e ) {

				e.preventDefault();

				var target = e.currentTarget
				,	btn = $( '.btn-success' );

				data = utilities.getFormData( target )

				// Set loading animation
				if ( utilities.isWorking( target ) ) return;
				utilities.startWorking( target );

				// Create user
				model.set( data )
					.confirm( 'confirm' );

			}

			// Update user data
		,	update: function( e ) {

				e.preventDefault();

				var target = e.currentTarget
				,	data = utilities.getFormData( target )
				,	submit = $( target ).find( 'input[type="submit"]' );

				if ( submit.hasClass( 'disabled' ) ) return;

				// Set loading animation
				if ( utilities.isWorking( target ) ) return;
				utilities.startWorking( target );

				// Set data to the model.
				model.set( data )
					.save( 'save' );

			}

			// Reset password form
		,	resetPassword: function( e ) {

				e.preventDefault();

				var target = e.currentTarget
				,	data = utilities.getFormData( target );

				if ( utilities.isWorking( target ) ) return;
				utilities.startWorking( target );

				// Send update password request
				model.set( data )
					.resetPassword( 'password_reset' );

		 	}

		 	// Create user password
		,	topbarCreatePassword: function( e ) {

		 		e.preventDefault();

				var target = e.currentTarget
				,	btn = $( '.btn-success' );

				data = utilities.getFormData( target )

				// console.log( data );

				// Set loading animation
				if ( utilities.isWorking( target ) ) return;
				utilities.startWorking( target );

				// Create user
				model.set( data )
					.confirm( 'confirm' );

		  	}

		,	chkUser: function () {

				var bpplUserCookie = utilities.chkCookie( 'bppl_user' );

			}

		,	chk: function () {

				// Set tooltip position
				if ( $( '.topbar-notice' ).css( 'display' ) == 'block' ) {
					$( '.profile-tooltip' ).addClass( 'more-top' );
					$( '.logout-button' ).parent().remove();
				}

				if ( localStorage.closedNotice ) {

					// Chk is notice is closed
					var object = JSON.parse( localStorage.closedNotice ),
				    dateString = object.timestamp,
				    now = new Date().getTime().toString();

				    if ( dateString < parseInt( now ) ) {
				    	// delete localStorage.closedNotice;
				    }

				    else {

				    	$( 'body' ).addClass( 'normalize-body' )
				    	$( '.with-topbar-notice' ).addClass( 'hidden-notice' )
				    	$( '.topbar-notice' ).addClass( 'hide-notice' )

				    }

				}

			}

		,	modalRecoverPass: function() {

				if ( sessionStorage.RP != 'rec' )
					utilities.openModal( '.RecoverPass-modal' );

			}

		,	close: function () {

				var expires = utilities.addSecs( 25 );

				$( '.profile-tooltip' ).removeClass( 'more-top' );
				$( '.topbar-notice' ).slideUp( 500 );
				$( '*' ).each( function () {

					if ( $( this ).hasClass( 'with-topbar-notice' ) ) {
						$( this ).removeClass( 'with-topbar-notice' );
					}

				});

				var object = { value: "value", timestamp: expires }
				// localStorage.closedNotice = JSON.stringify( object );

				// Create cookie
				utilities.newCookie( 'closed_notice', JSON.stringify( object ) );

			}

		,	unloading: function () {
				window.onbeforeunload = function ( e ) {
				    var e = e || window.event;

				    // For IE and Firefox prior to version 4
				    if (e) {
				        // Clean cookies
						cookiesArr = [ 'closed_notice' ];
						utilities.delCookie( cookiesArr );
				    }

					// Clean cookies
					cookiesArr = [ 'closed_notice' ];
					utilities.delCookie( cookiesArr );
				};
			}

			// Open form to set profile image
		,	openSetImgForm: function ( e ) {

				e.preventDefault();

				var target = e.currentTarget
				,	formTemplate = $( '.profile-img-btn' );

				$( formTemplate ).addClass( 'active' );

			}

			// Open form to set profile image
		,	closeSetImgForm: function ( e ) {

				e.preventDefault();

				$( '.profile-img-btn' ).removeClass( 'active' );

			}

		,	setLinkActive: function ( e ) {
				e.preventDefault();

				var target = e.currentTarget
				,	formTemplate = $( '.profile-img-btn' );

				$( '.link-suggested' ).removeClass( 'active' );
				$( target ).addClass( 'active' );
			}

		,	gopaypal: function( e ) {

				e.preventDefault();
				var	user = {}
				,	target = e.currentTarget
				,	btn = $( '#register-form .btn-view-more' )
				,	login_type = $( btn ).data( 'login-type' )
				,	submitBtn = $( target ).find( 'input[type="submit"]' ) ;

				// Extract object from form
				data = utilities.getFormData( target );

				if( ! this.emailPaypalValidation( data ) ) { return; }

				model.attributes.email = data.email;
				model.attributes.email_conf = data.email_conf;
				model.attributes.deal_id = data.deal_id;
				if ( utilities.isWorking( target ) ) return;
					utilities.startWorking( target );
				// If a comment exists
				// Additional data attached using getActionReferenceData
				// Object {actionReferencePostid: 23643, actionReferenceType: "post", actionReferenceLogintype: "list-like"}


				model.paypal( 'paypal' );

			}

			/**
			* Validate the email value and email format
			*
			* @param { objetc } // object with the user structure that contains the email
			* @return { bool } // true if the validation is ok and false instead.
			*/
		,	emailPaypalValidation: function( user ) {

				// Initializes the vars
				var required = [ 'email', 'email_conf' ]
				,	errors = []
				,	target = $( '#payment_email' )
				,	submitBtn = $( target ).find( 'input[type="submit"]' );

				// Reset styles
				$( ':input' ).removeClass( 'error' );

				// Validate empty fields
				utilities.validateEmptyFields( required, user, errors );

				if( errors.length > 0 ) {

					utilities.alert( 'Email field is required' );
					$( '#' + utilities.cammelCaseToHyphen( errors[0] ) ).addClass( 'error' );
					// Remove loading state
					utilities.stopWorking( target );
					submitBtn.removeClass( 'disabled' );
					return false;

				}

				// Validate email format
				if( ! ( utilities.validateEmailFormat( user.email )  && utilities.validateEmailFormat( user.email_conf ) )  ) {

					utilities.showGlobalNotification( 'Email format is wrong.', '', 'failure', null, 0 );
					$( '#' + utilities.cammelCaseToHyphen( errors[0] ) ).addClass( 'error' );
					return false;
				}

				if ( user.email == user.email_conf ){
					return true;
				}else{
					utilities.showGlobalNotification( 'E-mail addresses should be the same.', '', 'failure', null, 0 );
					$( '#' + utilities.cammelCaseToHyphen( errors[0] ) ).addClass( 'error' );
				}

			}

		,	switchLogin: function ( e ) {

				e.preventDefault();

				$( '.LoginRegister-modal .social-area' ).addClass( 'hidden' );
				$( '.LoginRegister-modal .login-area' ).addClass( 'in-top' );

			}

		,	btmSwitch: function ( e ) {

				e.preventDefault();

				$( '.LoginRegister-modal .social-area' ).removeClass( 'hidden' );
				$( '.LoginRegister-modal .login-area' ).removeClass( 'in-top' );

			}


	});

	// Global Exposition
	window.Bppl.Handlers.User = new User();


})( this.jQuery, this, this.document, this.Bppl.Views.User, this.Bppl.Controllers.User, this.Bppl.Models.User, this.Bppl.Helpers.Utilities, undefined );
/**
*
* Handler ListSuggestion
*/
( function( $, window, document, view, controller, model, utilities ) {

	var ListSuggestion = Gillie.Handler.extend({

			initialize: function() {

			}

		,	events: {

					'mouseover .suggest-list-modal': 'tooltip'
				,	'click .suggest-list-modal': 'modal'
				,	'click .tweet-list': 'tweetList'
				, 	'submit #form-suggestList': 'save'
				,	'click .vote-list': 'vote'
				,	'keyup .list-name': 'countdown'

			}

		, 	tooltip: function( e ) {

				e.preventDefault();

				var target = e.currentTarget
				,	currentDay = ( new Date ).getDate()
				,	position = $( target ).data( 'position' )
				,	elClass = $( target ).data( 'elclass' )
				,	content = $( target ).data( 'content' );

				if ( currentDay % 2 == 0 ) {
					utilities.tooltip( e, position, elClass, content );
				}

			}

		,	modal: function( e ) {

				e.preventDefault();

				var currentDay = ( new Date ).getDate();

				// if ( currentDay % 2 != 0 ) {
					utilities.openModal( '.SuggestList-modal' );
				// }

			}

		,	tweetList: function( e ) {

				// e.preventDefault();

				// var target = e.currentTarget
				// ,	url = $( target ).attr( 'href' );

				// window.open( url, 'Suggest a List', 'width=500, height=500, scrollbars=yes' );

			}

			// Handle the event on submit form
		,	save: function( e ) {

				e.preventDefault();

				var target = e.currentTarget
				,	submit = $( target ).find( 'input[type="submit"]' )
				,	required = [ 'title' ]
				,	errors = [];

				if ( submit.hasClass( 'disabled' ) ) return;
				submit.addClass( 'disabled' ).attr( 'value', 'Working...' );

				// Get + validate data
				data = utilities.getFormData( target );

				// Validate
				$.each( required, function( k, v ) {

					if ( typeof data[ v ] != 'string' ) {
						errors.push( v );
					}
					else {

						if ( ! data[ v ].trim() ) {
							errors.push( v );
						}
					}

				});

				if ( errors.length )  {
					return view.showError();
				}

				var suggestion = new model( data );
				suggestion.save();



				suggestion.attributes.pending = true;
				controller.collection.push( suggestion );

				// Displays the login modal whether the user is not logged in
				if( $( target ).find( 'input:submit' ).hasClass( 'not-logged-in' ) ){

					// Close the modal window
					utilities.openModal( '.SuggestList-modal' );

					// Bind an event to call when the user finish the login
					window.Bppl.Event.on( 'user.login', utilities.bind( controller.save, controller ) );

					// Open the login form set to trigger the `user.login` event.
					window.Bppl.Views.User.toggleLogin( 'user.login' );

					return;
				}
				else {
					controller.save();
				}

			}

			// Up vote or down vote a suggestion.
		,	vote: function( e ) {

				e.preventDefault();
				var target = e.currentTarget
				,	data = {
						ID: -1
					,	votes: {
								up: []
							,	down: []
						}
				}
				,	voteType = $( target ).data( 'vote-type' );

				data.ID = $( target ).data( 'list-id' );

				// Add the vote to the list of votes appropriate
				data.votes[ voteType ].push( 1 );

				// Create a new suggestion with the got data
				var suggestion = new model( data );
				suggestion.attributes.pending = true;

				// Add the suggestion to the global collection
				// Add the current target to the global in controller
				controller.collection.push( suggestion );
				controller._target = target;

				// Displays the login modal whether the user is not logged in
				// if( $( target ).hasClass( 'not-logged-in' ) ){

					// Close the modal window
					// utilities.openModal( '.SuggestList-modal' );

					// Bind an event to call when the user finish the login
					// window.Bppl.Event.on( 'user.login', utilities.bind( controller.vote, controller ) );

					// Open the login form set to trigger the `user.login` event.
					// window.Bppl.Views.User.toggleLogin( 'user.login' );

					// return;
				// }
				// else {

					controller.vote();
				// }
			}

		,	countdown: function( e ) {

					var target = e.currentTarget
				,	count = $( target ).val().length;

				$( '.countdown' ).text( 140 - count + ' Chars left' );
			}

	});

	// Global Exposition
	window.Bppl.Handlers.ListSuggestion = new ListSuggestion();


})( this.jQuery, this, this.document, this.Bppl.Views.ListSuggestion, this.Bppl.Controllers.ListSuggestion, this.Bppl.Models.ListSuggestion, this.Bppl.Helpers.Utilities, undefined );

/**
*
* Handler Builder
*/
( function( $, window, document, view, controller, utilities ) {

	var Builder = Gillie.Handler.extend({

			initialize: function() {

				this.key_8 = 0;
				this.selectBox = document;
				this.inputTags = document;

				// Listen for URL path change using `History`.
				// History.Adapter.bind( window, 'statechange', this.checkUrl );

				this.checkUrl();

				delete sessionStorage.slug;
				delete localStorage.filterBy;
 				delete localStorage.filterByAttr;

			}

		,	events: {
					'click .select-tags-box': 'initTagBox'
				,	'click .Home-postshome-filtersbar .filter-term': 'toggleFilterTerm'
				,	'click .category-unselected': 'toggleCategoryTerm'
				,	'click .Builder-container .label': 'toggleTerm'
				,	'click .label-pick': 'dropTerm'
				,	'focus .Builder-key-input, .Builder-env-input': 'showFilters'
				,	'keyup .Builder-key-input': 'suprTerm'
				,	'click body': 'toggleFilters'
				,	'keyup .Builder-key-input, .Builder-env-input': 'filterTerms'
			}

			// This method is launched on page load
		, 	checkUrl: function () {

				var slug = sessionStorage.slug

				//	Get path without using "History"
				, 	routeStripper = /^[#\/]|\s+$/g
				,	path = window.location.pathname.replace( routeStripper, '' )
				,	parts = path.split( '/' )
				,	str = parts[ 0 ]

				,	spKeyword = parts[ 0 ].split( '-' )
				,	spKeySel = '.Home-postshome-filtersbar .select-filters .sublevel .filter-term[data-slug="' + spKeyword[ 0 ] + '"]'
				,	keywordsTerm
				,	keyword = '.Home-postshome-filtersbar .select-filters .sublevel .filter-term[data-slug="' + str + '"]';


				// Reload the History
				if ( str != '' ) {

					var search = window.Bppl.Views.Search;

					// Special cases for super pinboards
					switch ( str ) {
						case 'wordpress-themes':
						case 'wordpress-plugins':
						case 'wordpress-general':

							var pinboardsCount = $( '.keyword-filters > ul' ).data( 'pinboards' );

							str = str.toLowerCase().replace( /\b[a-z]/g, function( letter ) {
	    						return letter.toUpperCase();
							});

							$( '.category-selected' ).html( str.replace( /-/gi, ' ' ) + ' <span class="icon-remove category-unselected"></span>' ).show();
							$( '.pinboards-count' ).html(  ': ' + pinboardsCount + ' Lists ' ).show();
							$( spKeySel ).addClass( 'toggle-color' );

						break;

						default:

							patt = /(freebies|resources|live-codes)/gi;
							patt = patt.test( str );
							// Check the url term with the terms file

							if ( ! keywordsTerm ) {

								$.ajax({
										type: 'get'
									,	dataType: 'json'
									,	url: window.Constants.JSTemplates + 'terms-cache.json'
									,	async: false
									,	success: function( data ) {
											keywordsTerm = data;
										}
								});
							}

							if ( keywordsTerm && keywordsTerm.indexOf( str ) != -1 )
								search.toggleFilterTerm( str ); // Render keyword information

							if ( patt )
								search.toggleFilterTerm( str ); // Render keyword information

							$( keyword ).addClass( 'toggle-color btn-pressed' );

						break;
					}
				}

				else {
					delete sessionStorage.slug;
				}

			}

			// Toggle term
		,	toggleTerm: function( e ) {

				e.preventDefault();

				var target = e.currentTarget
				,	termId = $( target ).data( 'termId' )
				,	tax = $( target ).data( 'tax' )
				,	collection = '.Home-postcollection-placeholder'
				,	parent = $( target ).data( 'parent' );

				$( collection ).addClass( 'disabled' );
				$( target ).toggleClass( 'selected' );

				// Hide the category when filter-category is selected
				$( '.category-selected' ).css({ display:'none' });

				if( ! $( target ).hasClass( 'label-pick' ) )
					this.addTerm( target );

				controller.toggleTerm( termId, tax, parent );
				controller.filterTerms( '', parent );

			}

			// Add term to select box
		,	addTerm: function( target ) {

				// Get all data attributes into an object
				var data = $( target ).data();

				// Is the label selected?
				if( $( target ).hasClass( 'selected' ) ) {

					// If label is selected, then add the label to list tags in the top
					view.addTerm( data, this.selectBox, this.inputTags );
					$( this.inputTags ).attr( 'placeholder', '' );
				}
				else {

					// If label is unselected drop the label referenced in the top
					view.dropTerm( '#' + $( target ).data( 'refer' ) );
				}

				// Always the input is focus on add or drop
				$( this.inputTags ).focus().val( '' );

			}

			// Remove a term when user press backspace twice
		,	suprTerm: function( e ) {

				var target = e.currentTarget
				,	key = e.keyCode
				,	_this = this
				,	ulChildren = $( _this.selectBox ).children( 'ul' ).children()
				,	liLast = ulChildren.length - 2;

				if( key == 8 ) {

					// Executes only if the input value is empty
					if( $( target ).val() == '' ) {

						// Increase the number of the backspace count pressures
						_this.key_8 += 1;

						if(	_this.key_8 == 2 ) {

							// Reset backspace pressures count
							_this.key_8 = 0;

							// Get the label children
							var a = $( ulChildren[ liLast ] ).children( 'a' );
							// Reset the target, targetting to the label in the bottom
							e.currentTarget = '.' + a.attr( 'id' );
							_this.toggleTerm( e );

							// Remove
							$( ulChildren[ liLast ] ).remove();

							return;
						}

						// If the backspace count is 1, select the tag to delete
						$( ulChildren[ liLast ] ).addClass( 'selected' );

						// Reset all after 2 seconds
						setTimeout( function() {
					      	_this.key_8 = 0;
					      	$( ulChildren[ liLast ] ).removeClass( 'selected' );
					    }, 2000 );
					}
				}
			}

			// Drop term in select box
		,	dropTerm: function( e ) {

				e.preventDefault();

				var target = e.currentTarget
				,	refer = $( target ).data( 'refer' )
				,	parentCat = $( target ).data( 'parent' )
				,	back = '.curator-key-input';

				// Removes the term
				this.toggleTerm( e );

				$( '.' + refer  ).toggleClass( 'selected' );
				$( '#' + refer ).remove();

				$( back ).trigger({
				    type: 'keyup',
				    which: 8
				});

				// Show all filters
				controller.filterTerms( ' ', parent );
			}

			// Init the select box
		,	initTagBox: function( e ) {

				var target = e.currentTarget
				,	_this = this
				,	boxClass = $( target ).children( 'ul' ).children( 'li' );

				if( ! $( target ).hasClass( 'select-tags-box' ) )
					target = $( target ).parent( '.select-tags-box' );

				// Registry the select-box and input on global targets
				this.selectBox = target;
				this.inputTags = $( this.selectBox ).find( 'input[type="text"]' );

				$( this.inputTags ).focus().val( '' );
			}

			// Shows the suggestions
		,	showFilters: function( e ) {

				var target = e.currentTarget
				,	suggestions = ''
				,	section = $( target ).data( 'section' )
				,	map = {
							key: 'Builder-key-terms'
						,	env: 'Builder-env-terms'
					};

				if ( section == 'env' ) {
					$( '.' + map.key ).slideUp( 100 )
				}
				else {
					$( '.' + map.env ).slideUp( 100 )
				}

				$( '.' + map[ section ] ).slideDown( 100 );

			}


			// Hides the suggestions
		,	toggleFilters: function( e ) {

				var target = e.currentTarget
				,	container = '.Builder-container .suggestions-wrapper'
				,	section = $( target ).data( 'section' )
				,	map = {
							key: 'Builder-key-terms'
						,	env: 'Builder-env-terms'
					};

				if ( $( container ).has( e.target ).length === 0 ) {
					$( '.' + map.env ).slideUp( 100 );
					( $( '.' + map.key ).hasClass( 'category-listing' ) ) ? '' : $( '.' + map.key ).slideUp( 100 );
				}

			}

			// Hide filters
		,	hideFilters: function() {

			}

			// Filter the displayed terms
		,	filterTerms: function( e ) {

				var target = e.currentTarget
				,	query = $( target ).val()
				,	section = $( target ).data( 'section' );

				// Call controller method
				controller.filterTerms( query, section );
			}

			// Filter the specified categories.
		,	toggleFilterTerm: function( e ) {
				e.preventDefault();

				var target = e.currentTarget
				,	slug = $( target ).data( 'slug' )

				if( sessionStorage.slug == slug ) return;

				$( '.Home-postcollection-placeholder' ).addClass( 'disabled' );

				utilities.alert( 'Working...', null, null, 10000 );

				// Call controller method toggleFilterTerm
				controller.toggleFilterTerm( slug );
			}


			// Set the category term to empty
		,	toggleCategoryTerm: function( e ) {
				e.preventDefault();

				var target = e.currentTarget
				,	slug = ''
				,	homePostCollection = '.Home-postcollection-placeholder';

				$( target ).parent().css({ display: 'none' });
				$( '.pinboards-count, .keyword-filters' ).css({ display: 'none' });

				$( homePostCollection ).addClass( 'disabled' );

				utilities.alert( 'Working...', null, null, 10000 );

				$( '.sublevel a' ).removeClass( 'toggle-color' );

				// Call controller method toggleFilterTerm
				controller.toggleFilterTerm( null );
			}
	});

	// Global Exposition
	window.Bppl.Handlers.Builder = new Builder();



})( this.jQuery, this, this.document, this.Bppl.Views.Builder, this.Bppl.Controllers.Builder, this.Bppl.Helpers.Utilities, undefined );
/**
*
* Handler Filter
*/
( function( $, window, document, view, controller, utilities ) {

	var Filter = Gillie.Handler.extend({

			events: {
					'click .Filter-term' : 'filterPosts'
				,	'click .keyword-filters .label[role="superlist"]': 'filterSuperlist'
			}

			// Filters the posts in home
		,	filterPosts: function( e ) {
				e.preventDefault();

				var target = e.currentTarget
				,	term = $( target ).data( 'termId' )
				,	section = $( target ).data( 'section' );

				controller.filterPosts( term, section );

			}

			// Sample
		,	filterSuperlist: function( e ) {
				e.preventDefault();

				var target = e.currentTarget
				,	path = utilities.getPath()
				,	tag = {
							'ID': $( target ).data( 'term-id' )
						,	'slug': $( target ).data( 'term-slug' )
					}
				,	superlistId = window.Constants.SUPERLIST_ID
				,	model = window.Bppl.Models.HomePostCollection
				,	match = _.findWhere( model.get( 'tags' ), tag )
				,	tags
				,	parts = path.split( '/' )
				,	filters = '.keyword-filters li > a.label'
				,	selected = $( target ).data( 'selected' )
				,	pinboardId = $( target ).data( 'pinboard-id' );

				$( 'html, body' ).animate({ scrollTop: $( 'a[name="' + pinboardId + '"]' ).offset().top - 60 }, 500 );

				// Breadcrumb
				// $( '.breadcrumb .state2' )
				// 	.attr( 'href', '//' + document.domain + '/' +parts[ 0 ] + '/' + tag.slug )
				// 	.html( tag.slug.replace( /-/gi, ' ' ) )
				// 	.prepend( ' / ' );

				// Remove selected class in all tags
				$( filters ).removeClass( 'label-danger' )
					.addClass( 'label-bordered' )
					.data( 'selected', 'false' );

				// Is term selected
				if ( selected == 'true' ) {
					$( target ).data( 'selected', 'false' );
				}

				else {
					$( target ).addClass( 'label-danger' )
						.removeClass( 'label-bordered' )
						.data( 'selected', 'true' );
				}

			}

	});

	// Global Exposition
	window.Bppl.Handlers.Filter = new Filter();



})( this.jQuery, this, this.document, this.Bppl.Views.Filter, this.Bppl.Controllers.Filter, this.Bppl.Helpers.Utilities, undefined );


/**
*
* Handler HomePosts
*/
( function( $, window, document, view, controller, utilities ) {

	var HomePosts = Gillie.Handler.extend({

	});

	// Global Exposition
	window.Bppl.Handlers.HomePosts = new HomePosts();



})( this.jQuery, this, this.document, this.Bppl.Views.HomePosts, this.Bppl.Controllers.HomePosts, this.Bppl.Helpers.Utilities, undefined );
/**
*
* Handler Comment
*/
( function( $, window, document, view, controller, model, utilities ) {

	var Comment = Gillie.Handler.extend({

			initialize: function() {

			}

		,	events: {

					'click .show-comment-form' : 'showCommentForm'
				,	'click .save-comment' : 'save'
				// ,	'click .save-comment' : 'saveInline'
				,	'click .item-comment-popover': 'openCommentPopover'
				,	'submit .list-item-comment-form': 'saveInline'

			}

			// Replies a comment and render the form depending to the comment level
		,	showCommentForm: function( e ) {

				e.preventDefault();

				// Initialize vars and get the data
				var target = e.currentTarget, comment = {}
				,	parentTarget = $( target ).parent().parent()
				,	attrs = {
						'depth' : 'depth', 'parent_id' : 'idcomment'
					, 	'post_id' : 'postid', 'avatar_url' : 'avatarurl', 'loggedClass' : 'loggedclass'
				};


				$.each( attrs, function( k, v ) {
					comment[ k ] = $( target ).data( v );
				});

				// If a form is already displayed, delete that.
				//if( $( parentTarget ).find( '.comments-form' ).length > 0 ) {

				//	view.hideCommentForm( parentTarget );
				//	return;
				//}

				// Augment depth.
				//comment.depth += 1;
				//controller.showCommentForm( comment, target );

				$( '#comments-form-' + comment.parent_id ).slideDown( 300 );

			}

			// Saves a comment and refresh the view
		,	save: function( e ) {

				e.preventDefault();

				// Initialize vars
				var target = e.currentTarget
				,	required = [ 'content' ]
				,	errors = [];


				// Get the data from the form
				var formId = $( target ).closest( 'form' ).attr( 'id' )
				,	data = utilities.formToObject( '#' + formId, false, true )
				,	post_id = $( target ).data( 'post-id' )
				,	parent_id = $( target ).data( 'parent-id' )
				,	depth = $( target ).data( 'depth' )
				,	login_type = $( target ).data( 'login-type' );

				// Minified login
				if ( typeof login_type == 'undefined' )
					var login_type = 'minified';

				// Add the attributes catched to the data object
				data.post_id = post_id;
				data.parent_id = parent_id;
				data.depth = depth;
				data.pending = true;

				// Show loading status.
				// $( target ).addClass( 'disabled' )
				//	.attr( 'value', 'Working...' );
				// utilities.alert( 'Working...' );

				// Validate fields empty
				utilities.validateEmptyFields( required, data, errors );

				if ( errors.length > 0 ) {
					utilities.alert( 'Comment text cannot be empty.' );
					return;
				}


				// Instance a new model comment
				var comment = new model( data );


				$( '.comments.no-single,.comments.single' ).removeClass( 'active' );
				$( '.register-form' ).removeClass( 'active' );

				$( target ).closest( 'form' ).parent().find( '.comments.no-single,.comments.single' ).addClass( 'active' );
				$( target ).closest( 'form' ).parent().find( '.comments.no-single,.comments.single' ).find( '.register-form' ).addClass( 'active' );

				// Validates whether the user is or not logged in
				if ( $( target ).hasClass( 'not-logged-in' ) ) {

					// Save to collection
					controller.collection.push( comment );

					// Bind an event to call when the user finishes the login
					window.Bppl.Event.on( 'user.login', utilities.bind( function() {
						controller.save.call( controller, [ 'onSave' ] );
					}, controller ) );

					// Open the login form set to trigger the `user.login` event.
					window.Bppl.Views.User.toggleLogin( 'user.login', login_type, null, parent_id );

					// Add comment to register form
					if ( $( '.register-area #register-form, .register-form.active' ).attr( 'data-additional-fields' ) != 'true' ) {

						$( '.register-area #register-form, .register-form.active' )
							.append(
								'<input type="hidden" name="post_id" value="' + data.post_id + '">' +
								'<input type="hidden" name="comment" value="' + data.content + '">' +
								'<input type="hidden" name="parent_id" value="' + data.parent_id + '">'
							)
							.attr( 'data-additional-fields', 'true' );
					}

					$( '.min-login.comments.active .btn-facebook, .min-login.comments.active .btn-google-plus, .min-login.comments.active .btn-github, .min-login.comments.active' )
						.attr( 'data-post-id', data.post_id )
						.attr( 'data-login-type', 'comments' )
						.attr( 'data-comment', data.content )
						.attr( 'data-parent-id', data.parent_id );

				} else {

					// Add to collection
					controller.collection.push( comment );

					// Save pending comments
					controller.save( 'onSave' );
				}

				// Clean the textarea
				//$( '#' + formId ).find( 'textarea' ).val( '' );

			}

			// Open the popover so that we can comment.
		,	openCommentPopover: function( e ) {
				e.preventDefault();

				var target = e.currentTarget
				, 	postId = $( target ).data( 'post-id' );

				$( '.popover.comments#' + postId ).show();
				utilities.closeOnClickOut( '.popover.comments#' + postId, function(){ $( '.popover.comments#' + postId ).hide(); } );

			}

			// Save a comment from the list items comment form popover
		,	saveInline: function( e ) {
				e.preventDefault();

				var target = e.currentTarget
				,	required = [ 'content' ]
				,	data = utilities.getFormData( target )
				,	loginType = $( target ).data( 'type-login' )
				,	clickOutClass = '.comments';


				// Add loading state
				if ( utilities.isWorking( target ) ) return;
				utilities.startWorking( target );

				// Do we've content
				if ( typeof data.content != 'string' || ! data.content.trim() ) {

					utilities.stopWorking( target );
					return view.showError( data.post_id );

				}

				// Create comment object
				comment = new model( data );

				$( '.comments.list-header' ).removeClass( 'active' );
				$( '.register-form' ).removeClass( 'active' );

				$( target ).closest( '.comments.lbl-comment-list' ).parent().find( '.comments.list-header' ).addClass( 'active' );
				$( target ).closest( '.comments.lbl-comment-list' ).parent().find( '.comments.list-header' ).find( '.register-form' ).addClass( 'active' );

				// Validates whether the user is or not logged in
				if ( $( target ).hasClass( 'not-logged-in' ) ) {

					// Save to collection
					controller.collection.push( comment );

					// console.log( controller );

					// Bind an event to call when the user finishes the login
					window.Bppl.Event.on( 'user.login', utilities.bind( function() {
						controller.save.call( controller, [ 'onPopoverSave' ] )
					}, controller ) );

					// Bind an event to call when the user register the login
					window.Bppl.Event.on( 'user.register', utilities.bind( function() {
						controller.save.call( controller, [ 'onPopoverSave' ] )
					}, controller ) );

					// Open the login form set to trigger the `user.login` event.
					if ( loginType ) {

						window.Bppl.Views.User.toggleLogin( 'user.login', loginType );
						window.Bppl.Views.User.toggleLogin( 'user.register', loginType );
					}
					else
						window.Bppl.Views.User.toggleLogin( 'user.login' );

					// Add comment to register form
					if ( $( '.register-area #register-form, .register-form.active' ).attr( 'data-additional-fields' ) != 'true' ) {

						$( '.register-area #register-form, .register-form.active' )
							.append(
								'<input type="hidden" name="post_id" value="' + data.post_id + '">' +
								'<input type="hidden" name="comment" value="' + data.content + '">' +
								'<input type="hidden" name="parent_id" value="' + data.parent_id + '">'
							)
							.attr( 'data-additional-fields', 'true' );
					}

					$( '.min-login.comments.active .btn-facebook, .min-login.comments.active .btn-google-plus, .min-login.comments.active .btn-github, .min-login.comments.active' )
						.attr( 'data-post-id', data.post_id )
						.attr( 'data-login-type', 'comments' )
						.attr( 'data-comment', data.content )
						.attr( 'data-parent-id', data.parent_id );

					utilities.newCookie( 'comments', JSON.stringify( $( '.min-login.comments.active' ).data() ) ); // workaround

					utilities.closeOnClickOut( clickOutClass, function(){ $( clickOutClass ).hide(); $( '.popover.comments form input[type="submit"]' ).val( 'Comment' ).removeClass( 'clicked disabled' ) } );

				} else {

					// Add to collection
					controller.collection.push( comment );

					// Save pending comments
					controller.save( 'onPopoverSave' );
				}


			}

	});

	// Global Exposition
	window.Bppl.Handlers.Comment = new Comment();


})( this.jQuery, this, this.document, this.Bppl.Views.Comment, this.Bppl.Controllers.Comment, this.Bppl.Models.Comment, this.Bppl.Helpers.Utilities, undefined );
/**
*
* Handler Like
*/
( function( $, window, document, view, controller, model, utilities ) {

	var Like = Gillie.Handler.extend({

			initialize: function() { }

		,	events: {

					'click .post-like-button': 'save'
				,	'click .comment-like': 'commentSave'
				, 	'click .like-post': 'listItemSave'
			}

			// Save a new like on the post or delete if user likes it previously
		,	save: function( e ) {

				e.preventDefault();

				var target = e.currentTarget
				,	post_id = $( target ).data( 'postid' )
				,	count = $( target ).data( 'count' )
				,	liked = $( target ).data( 'liked' )
				,	data = {
							// post_id: post_id
							item_id: post_id
						,	type: 'post'
						,	count: count
						,	liked: liked
					};

				// Instance a new model like
				var like = new model( data );

				// Save to collection
				controller.collection.push( like );

				$( target ).addClass( 'disabled' );

				// Validates whether the user is or not logged in
				if ( $( target ).hasClass( 'not-logged-in' ) ) {

					// Bind an event to call when the user finish the login.
					window.Bppl.Event.on( 'user.login', utilities.bind( controller.save, controller ) );

					// Open the login form set to trigger the `user.login` event.
					window.Bppl.Views.User.toggleLogin( 'user.login' );

				} else {

					// Save pending comments
					controller.save( 'onSave' );
				}

			}


			// Save comment like
		,	commentSave: function( e ) {
				e.preventDefault();

				var target = e.currentTarget
				,	commentId = $( target ).data( 'comment-id' )
				,	count = $( target ).data( 'count' )
				,	liked = $( target ).data( 'liked' )
				,	data = {
						item_id: commentId
					,	type: 'comment'
					,	count: count
					,	liked: liked
				};

				// Instance a new model like
				var like = new model( data );

				// Save to collection
				controller.collection.push( like );

				// Validates whether the user is or not logged in
				if ( $( target ).hasClass( 'not-logged-in' ) ) {

					// Bind an event to call when the user finish the login.
					window.Bppl.Event.on( 'user.login', utilities.bind( controller.save, controller ) );

					// Open the login form set to trigger the `user.login` event.
					window.Bppl.Views.User.toggleLogin( 'user.login' );

				} else {

					// Save pending comments
					controller.save( 'onSave' );
				}

			}

		,	listItemSave: function( e ) {
				e.preventDefault();

				// if ( $( e.currentTarget ).hasClass( 'premium-feature' ) )

				var target = e.currentTarget
				,	postId = $( target ).data( 'post-id' )
				,	count = $( target ).data( 'count' )
				,	liked = $( target ).data( 'liked' )
				,	data = {
							item_id: postId
						,	type: 'post'

					};

				// Instance a new model like
				var like = new model( data );
				// console.log( like ); return;

				// Save to collection
				controller.collection.push( like );

				// Validates whether the user is or not logged in
				if ( $( target ).hasClass( 'not-logged-in' ) ) {

					// Bind an event to call when the user finish the login.
					window.Bppl.Event.on( 'user.login', utilities.bind( controller.save, controller ) );

					// Open the login form set to trigger the `user.login` event.
					window.Bppl.Views.User.toggleLogin( 'user.login' );

				} else {
					// console.log( 'ariete' );
					if ( $( target ).parent().hasClass( '.user-logged' ) ) {

						var clikedHeart = $( target ).parent().find( 'i' );

						if ( clikedHeart.hasClass( 'icon-change-color-heart' ) ) {
							$( target ).parent().find( 'i' ).css( 'color', '#fefefe' );
							$( target ).parent().find( '.follow-txt' ).text( 'Follow list' );
						}
						else {
							$( target ).parent().find( 'i' ).css( 'color', '#ec7063' );
							$( target ).parent().find( '.follow-txt' ).text( 'Following' );
						}
					}


					controller.save( 'onListLike' );
				}

			}


	});

	// Global Exposition
	window.Bppl.Handlers.Like = new Like();


})( this.jQuery, this, this.document, this.Bppl.Views.Like, this.Bppl.Controllers.Like, this.Bppl.Models.Like, this.Bppl.Helpers.Utilities, undefined );
/**
*
* Handler Flag
*/
( function( $, window, document, view, controller, model, utilities ) {

	var Flag = Gillie.Handler.extend({

			initialize: function() {

				// this.post_id = 0;
				this.item_id = 0;
				this.item_type = '';
				this.post_parent = 0;

			}

		,	events: {

					'click .flag-this-button, .Flag-flag': 'openModal'
				,	'submit #form-flag-content': 'save'

			}

			// Open modal
		,	openModal: function( e ) {

				e.preventDefault();

				var target = e.currentTarget;

				utilities.stopWorking ( '.Flag-modal form#form-flag-content' );

				this.item_id = $( target ).data( 'item-id' );
				this.item_type = $( target ).data( 'item-type' );
				this.post_parent = $( target ).data( 'post-parent' );

				// utilities.openModal( '.Flag-modal' );

			}

			// Save a new report
		,	save: function( e ) {

				e.preventDefault();

				var target = e.currentTarget
				,	submit = $( target ).find( 'input[type="submit"]' )
				,	data = utilities.formToObject( '#form-flag-content', false, true );

				data.item_id = this.item_id;
				data.item_type = this.item_type;
				data.post_parent = this.post_parent;
				data.description = $( target ).find( 'textarea[data-name="description"]' ).val();
				data.author = parseInt( window.Constants.OWNERID );

				// console.log(data);return;

				if ( utilities.isWorking( target ) ) return;
				utilities.startWorking( target );

				// Create a new model
				var flag = new model( data );

				// Push the model to the controller collection
				controller.collection.push( flag );

				// Validate if the user is logged in
				if( submit.hasClass( 'not-logged-in' ) ) {

					// Close the modal
					utilities.openModal( '.Flag-modal' );

					// Bind an event to call when the user finish the login
					window.Bppl.Event.on( 'user.login', utilities.bind( controller.save, controller ) );

					// Open the login form set to trigger the `user.login` event.
					window.Bppl.Views.User.toggleLogin( 'user.login' );
				}
				else {

					// Save flag request
					controller.save();
				}
			}


	});

	// Global Exposition
	window.Bppl.Handlers.Flag = new Flag();


})( this.jQuery, this, this.document, this.Bppl.Views.Flag, this.Bppl.Controllers.Flag, this.Bppl.Models.Flag, this.Bppl.Helpers.Utilities, undefined );

/**
*
* Handler Follow
*/
( function( $, window, document, view, controller, model, utilities ) {

	var Follow = Gillie.Handler.extend({

			initialize: function() {

			}

		,	events: {

					'click .follow-user': 'follow'
				,	'mouseenter .follow-user': 'followingHoverIn'
				,	'mouseleave .follow-user': 'followingHoverOut'

			}

			// Show "Unfollow" text on "following" hover.
		,	followingHoverIn: function( e ) {

				var target = e.currentTarget
				,	type = $( target ).data( 'button-type' );

				if ( $( target ).hasClass( 'following' ) ) {

					view.onFollowingHover( target, type, true );
				}
			}

			// Show "Follow" text back when "Follow" button is hovered out.
		,	followingHoverOut: function( e ) {

				var target = e.currentTarget
				,	type = $( target ).data( 'button-type' );

				if( $( target ).hasClass( 'following' ) ) {

					view.onFollowingHover( target, type, false );
				}
			}

			// Toggle the following of an user
		,	follow: function( e ) {

				e.preventDefault();

				var target = e.currentTarget
				,	userId = $( target ).data( 'user-id' )
				,	ref = $( target ).data( 'ref' )
				,	data = {
							followed: userId
						,	leader_id: userId
					};

				// Alias
				var alias = [ 'profile', 'home', 'home.grid_view', 'home.list_view'
					,	'list.grid_view', 'list.list_view'
				];

				if ( alias.indexOf( ref ) == -1 ) {
					utilities.alert( 'Invalid follow button.' );
					return;
				}

				// Add loading animation
				$( target ).addClass( 'disabled' )
					.text( 'Working...' );

				// Instance a new follow model
				var follow = new model( data );

				controller.target = target;
				controller.collection.push( follow );

				// Check whether the user is logged in
				if ( $( target ).hasClass( 'not-logged-in' ) )  {

					// Bind an event to call when the user finish the login
					window.Bppl.Event.on( 'user.login', utilities.bind( function( args ) {

						controller.follow( ref, args.user );

						$( target ).removeClass( 'not-logged-in' );

					}, controller ) );

					// Open the login form set to trigger the `user.login` event.
					window.Bppl.Views.User.toggleLogin( 'user.login' );

					setTimeout(function() {

						// Add loading animation
						$( target ).removeClass( 'disabled' )
							.text( 'Follow' );
					}, 500 );

				} else {

					// follow pendings
					controller.follow( ref );

				}

			}

			// Boxes follow
		,	boxesFollow: function( e ) {
				e.preventDefault();


			}

	});

	// Global Exposition
	window.Bppl.Handlers.Follow = new Follow();


})( this.jQuery, this, this.document, this.Bppl.Views.Follow, this.Bppl.Controllers.Follow, this.Bppl.Models.Follow, this.Bppl.Helpers.Utilities, undefined );
/**
*
* Handler LayoutView
*/
( function( $, window, document, view, controller, utilities ) {

	var LayoutView = Gillie.Handler.extend({

			events: {
				'click .layout-view' : 'change'
			}

			// Change the layout mode
			// Grid view or List View
		,	change: function( e ) {
				e.preventDefault();

				var target = e.currentTarget
				,	overlay = '.Home-postcollection-overlay'
				,	collection = '.Home-postcollection-placeholder'
				,	mode = $( target ).data( 'mode' )
				,	listView = '.Home-postshome-wrapper.list-single';

				$( target ).parent().parent()
					.find( 'li a' ).removeClass( 'active' );

				$( target ).addClass( 'active' );
				$( collection ).addClass( 'disabled' );

				// Add role to container
				if ( $( listView ).length )  {
					role = mode == 'list' ? 'post-list-view' : '';
					$( listView ).attr( 'role', role );
				}

				// Change layout view
				$( overlay ).show();
				controller.change( mode );

			}

	});

	// Global Exposition
	window.Bppl.Handlers.LayoutView = new LayoutView();


})( this.jQuery, this, this.document, this.Bppl.Views.LayoutView, this.Bppl.Controllers.LayoutView, this.Bppl.Helpers.Utilities, undefined );
/**
*
* Handler Post Collection
*/
( function( $, window, document, model, view, controller, utilities ) {

	var PostCollection = Gillie.Handler.extend({

			initialize: function() {

				// Listen for preset categories
				this.setOptions();

				// Check the current URL on page load.
				// this.checkUrl();

				// Listen for URL path change using `History`.
				History.Adapter.bind( window, 'statechange', this.checkUrl );

			}

			// Events
		,	events: {
				//	'click .Home-postshome-wrapper .pagination > ul li.group a': 'paginate'
				// ,	'click .Home-postshome-wrapper .pagination > ul li a.next' : 'next'
				// ,	'click .Home-postshome-wrapper .pagination > ul li a.prev' : 'prev'
			}

			// Paginate the posts results
		,	paginate: function( e ) {
				e.preventDefault();

				var target = e.currentTarget
				,	page = $( target ).data( 'page' )
				,	collection = '.Home-postcollection-placeholder'
				,	path = utilities.getPath()
				,	parts = path.split( '/' );

				$( target ).parent().parent().find( 'li' ).removeClass( 'active' );
				$( target ).parent().addClass( 'active' );

				// Show overlay
				$( collection ).addClass( 'disabled' );

				// Add the the page to the url
				// if ( model.attributes.category_name )
				if ( parts[ 0 ] )
					utilities.updatePath( '/' + parts[ 0 ] + '/' + 'page/' + page );
				else
					utilities.updatePath( '/page/' + page );

			}

			// Previeus page
		,	prev: function( e ) {
				e.preventDefault();

				var collection = '.Home-postcollection-placeholder';

				// Show overlay
				$( collection ).addClass( 'disabled' );

				// Paginate
				model.prevPage( 'paginate' );

			}

			// Next page
		,	next: function( e ) {
				e.preventDefault();

				var collection = '.Home-postcollection-placeholder'
				,	path = utilities.getPath()
				,	parts = path.split( '/' );

				if ( isNaN( parts[ 1 ] ) ) {
					page = 1;
				} else {
					page = parts[ 1 ];
				}

				// Show overlay
				$( collection ).addClass( 'disabled' );

				// Change active button number
				$( 'ul.pagination-list' ).find( 'li' ).removeClass( 'active' );
				$( 'ul.pagination-list' ).find( 'li' ).eq( page ).addClass( 'active' );

				// Paginate to next page
				model.nextPage( 'paginate' );
			}

			// Check URL in order to tell whether to paginate.
			// ISSUE: Is not listening for hashchange at times
			// and is taking some time to take effect too.
		,	checkUrl: function() {  // This method is launched every time that URL is changed.

				var path = History.getState().hash
				,	collection = '.Home-postcollection-placeholder'
				,	path = utilities.getPath()
				,	page
				,	parts = path.split( '/' );

				// Return if the pats has less than two parts.
				// if ( parts.length < 2 || parts.length > 3
					// || parts[ 0 ] != 'page' && parts[ 1 ] != 'page' || path == './' ) return; // path == './' solve the IE issue

				if( parts[ 0 ] == '.' ) parts[ 0 ] = parts[ 1 ];

				// Handle URL like ".com/wordpress/page/1"
				if ( parts.length == 3 && parts[ 1 ] == 'page' ) {

					page = parseInt( parts[ 2 ] );
					if ( isNaN( page ) ) return;
					if ( page < 1 ) return;

				}

				// Handle URL like ".com/page/1"
				else if ( parts[ 0 ] == 'page' ) {

					page = parseInt( parts[ 1 ] );
					if ( isNaN( page ) ) return;
					if ( page < 1 ) return;

				}

				if( parts[ 0 ] != 'page' && parts[ 0 ] != '.' )

					model.reset().set( 'category_name', parts[ 0 ] );

				model.attributes.categories.environment = [];
				model.attributes.page = page;

				// Add overlay
				$( collection ).addClass( 'disabled' );

				model.sync( 'renderHome' );

				if( parts[ 0 ] != 'page' && parts[ 0 ] == '.' && jQuery.browser.msie != true ) {

					// Render keyword information
					var search = window.Bppl.Views.Search;

					search.toggleFilterTerm( parts[ 0 ] );
				}


			}

			// Set category if we're in a category page
		,	setOptions: function() {

				var cat = window.Constants.CATEGORY_ENV
				,	listId = window.Constants.LIST_ID;

				if ( parseInt( cat ) ) {
					cat = {
						'ID': cat
					}
					model.attributes.categories.environment.push( cat );
				}

				if ( parseInt( listId ) ) {
					model.set( 'list_id', listId );
				}

			}

	});

	// Global Exposition
	window.Bppl.Handlers.PostCollection = new PostCollection();


})( this.jQuery, this, this.document, this.Bppl.Models.HomePostCollection, this.Bppl.Views.PostCollection, this.Bppl.Controllers.PostCollection, this.Bppl.Helpers.Utilities, undefined );

/**
*
* Handler List
*/
( function( $, window, document, view, controller, model, utilities ) {

	var List = Gillie.Handler.extend({

			initialize: function() {
				// this.categoriesSelector();
			}

		,	events: {

					'click .AddToList-list-item': 	'addToList'
				,	'click .add-to-list-button': 	'getUserLists'
				,	'submit #new-list-form': 		'addToListNew'
				,	'click .display-new-list-form': 'toggleListNewForm'
				,	'click .display-new-list-form-editor': 'toggleListNewFormEditor'
				,	'keyup #list-name-filter': 		'addToListFilter'
				,	'change .wf-list': 				'listFeat'
				,	'click .list-category': 'getListCats'

			}

			// Create a new list and add the current post to that
		,	addToListNew: function( e ) {

				e.preventDefault();

				var target = e.currentTarget
				,	idform = $( target ).attr( 'id' )
				,	itemId = $( '#post-item' ).val()
				,	list = utilities.formToObject( '#' + idform, false, false )
				,	required = [ 'post_title', 'post_name' ]
				,	errors = [];

				// Add the current post to the new list
				list.items = [ itemId ];

				// Validate empty fields
				$( '#post_title' ).removeClass('error');
				utilities.validateEmptyFields( required, list, errors );

				if( errors.length > 0 ) {
					utilities.showGlobalNotification( 'Some fields are required.', '', 'failure', null, 4000 );
					$( '#' + errors[0] ).addClass('error');
					return;
				}

				$( target ).find( 'input:submit' ).attr( 'value', 'Saving..' );

				controller.addToListNew( list );

				$( target ).find( 'input:submit' ).attr( 'value', 'Save' );

				utilities.clearForm( '#' + idform );

				this.toggleListNewForm( e );
			}

			// Displays the new list form
		,	toggleListNewForm: function( e ){

				e.preventDefault();

				if( $( '.new-list-area' ).css( 'display' ) == 'none' ){

					$( '.new-list-area' ).show();
					$( '.search-area' ).hide();
					$( '.lists-wrapper' ).hide();

				}
				else {
					$( '.new-list-area' ).slideUp( 100 );
					$( '.search-area' ).show();
					$( '.lists-wrapper' ).show();
					$( '.lists-wrapper' ).scrollTop( 0 );
				}
			}

			// Displays the new list form
		,	toggleListNewFormEditor: function( e ){

				e.preventDefault();

				$( '.modal-backdrop, .AddToList-modal, .new-list-area' ).show();
				$( '.search-area, .lists-wrapper' ).hide();
			}


			// Adds a post to any list
		,	addToList: function( e ) {

				e.preventDefault();

				var target = e.currentTarget
				,	itemId = $( target ).data( 'item-id' )
				,	ID = $( target ).attr( 'id' )
				,	data = {
							ID: ID
						,	items: [ itemId ]
					};

				// Instance an object and call the method toggle
				var list = new model( data );

				var templateEmail = '<div class="sending-mails-info"> ' +
						'<h4>Sending updates to users. Please wait!</h4>' +
					'</div>';

				if ( ! $( target ).hasClass( 'has-item' ) )
					$( target ).closest( '.lists-wrapper' ).addClass( 'active-info' ).append( templateEmail );

				// Listen to list model `toggle` event.
				view.listenTo( list, 'toggle', view.onToggle );

				list.toggle( 'toggle' );

			}

		,	getUserLists: function( e ) {

				e.preventDefault();

				var target = e.currentTarget
				,	itemId = $( target ).data( 'post-id' );

				controller.collection.push( itemId );

				// Validate if the user is logged in
				if( $( target ).hasClass( 'not-logged-in' ) ){

					// Bind an event to call when the user finish the login
					window.Bppl.Event.on( 'user.login', utilities.bind( controller.getUserLists, controller ) );

					// Open the login form set to trigger the `user.login` event.
					window.Bppl.Views.User.toggleLogin( 'user.login' );

					return;
				}
				else {

					controller.getUserLists();
				}
			}

		,	addToListFilter: function( e ) {

				var target = e.currentTarget
				,	term = $( target ).val();

				var elements = ".lists-wrapper ul"
				,	items = ".AddToList-list-item"
				,	titleSel = ".AddToList-list-title"
				,	title
				,	reg;

				// Get names
				$( elements ).find( items ).each( function( key, val ) {

					title = $( this ).find( titleSel ).text();

					reg = new RegExp( term, "i" );

					if ( ! reg.test( title ) ) {
						$( this ).hide();
					}
					else {
						$( this ).show();
					}
				});
			}

			// make feat list
		,	listFeat: function( e ) {

				var target = e.currentTarget
				,	listId = $( target ).data( 'id' )
				, 	data = {
						ID: listId
					}

				var list = new model( data );

				// Listen to list model `listFeat` event.
				view.listenTo( list, 'listFeat', view.onListFeat );

				list.listFeat( 'listFeat' );

			}

			// Get lists cats
		,	getListCats: function ( e ) {

				var target = e.currentTarget
				,	val = $( target ).attr( 'data-term-id' )

				$( target ).toggleClass( 'label-danger' );
			}

			// Categories selector
		,	categoriesSelector: function () {
				// $( '#list-categories' ).tokenInput( window.Constants.JSTemplates + 'categories.json' );
				$( "#list-categories" ).tokenInput([
	                { id: 7, name: "Ruby" },
	                { id: 11, name: "Python" },
	                { id: 13, name: "JavaScript" },
	                { id: 17, name: "ActionScript" },
	                { id: 19, name: "Scheme" },
	                { id: 23, name: "Lisp" },
	                { id: 31, name: "Fortran" },
	                { id: 37, name: "Visual Basic" },
	                { id: 41, name: "C" },
	                { id: 47, name: "Java" }
	            ]);

	            $( '.token-input-dropdown' ).insertBefore( '#list-categories' );
	            $( '.token-input-dropdown' ).css({
	            	top: 0,
	            	left: 0
	            })

	            //console.log( 'quazar' );
			}


	});

	// Global Exposition
	window.Bppl.Handlers.List = new List();


})( this.jQuery, this, this.document, this.Bppl.Views.List, this.Bppl.Controllers.List, this.Bppl.Models.List, this.Bppl.Helpers.Utilities, undefined );
/**
*
* Handler Carousel
*/
( function( $, window, document, view, controller, model, utilities ) {

	var Carousel = Gillie.Handler.extend({

			initialize: function() {

				this.initCarousel( '#user-posts-carousel' );
				this.initCarousel( '#user-lists-carousel' );
				this.initCarousel( '#user-likes-carousel' );
				this.initCarousel( '#user-following-carousel' );

			}

		,	events: {

					'click .carousel-control.left': 'prev'
				,	'click .carousel-control.right': 'next'
				,	'click .profile-tabs a': 'profileTabs'

			}

			// Shows the next page
		,	next: function( e ) {

				e.preventDefault();

				var target = e.currentTarget
				,	carouselTarget = $( target ).parent()
				,	data = $( carouselTarget ).data();

				if( $( target ).hasClass( 'disabled' ) ) return;

				controller.next( target, carouselTarget, data );

			}

			// Shows the prev page
		,	prev: function( e ) {

				e.preventDefault();

				var target = e.currentTarget
				,	carouselTarget = $( target ).parent()
				,	data = $( carouselTarget ).data();

				view.prev( carouselTarget );
				view.setLabelCount( data, false );
			}

			// Initialize the carousel
		,	initCarousel: function( carousel ) {

				if( $( carousel ).children( 'ul' ).length <= 1 ) {
					$( carousel ).children( '.carousel-control' ).each( function(){
						$( carousel ).find( '.carousel-control' ).remove();
					});
				}
			}

		// Initialize the carousel
		,	profileTabs: function( e ) {

			var target = $( e.currentTarget )
			, 	tabBox = $( '.profile-tabs' )
			,	tabSlide = '.tab-' + target.data( 'tab' );

				tabBox.find( 'a' ).removeClass( 'active' );
				target.addClass( 'active' );

				// console.log( $( tabSlide ) );
				// console.log( tabSlide );

				// tabSlide.addClass( 'dsdssa' );
				$( '.main-profile' ).addClass( 'hide' );
				$( tabSlide ).removeClass( 'hide' );

				// $( tabSlide ).hide();
				// console.log( $( target.data( 'tab' ) ) );
				// .hide();

			}

	});

	// Global Exposition
	window.Bppl.Handlers.Carousel = new Carousel();


})( this.jQuery, this, this.document, this.Bppl.Views.Carousel, this.Bppl.Controllers.Carousel, this.Bppl.Models.Carousel, this.Bppl.Helpers.Utilities, undefined );
/**
*
* Handler: Bookmarklet
*/
( function( $, window, document, view, controller, model, utilities ) {

	var Bookmarklet = Gillie.Handler.extend({


			// Events
			events: {
					'click .tags-section .label' : 'toggleTerm'
                ,   'click .content-type .label' : 'setContType'
                ,   'click .save-post-button' : 'savePost'
                ,   'keyup .elements-cats-input, .enviroment-cats-input, .resources-cats-input, .services-cats-input, .freebies-cats-input, .general-tags-input, .theme-tags-input, .icons-tags-input': 'filterKeyTags'
                ,   'click a.toggle-section' : 'toggleTagsSection'
                ,   'click .slide-content': 'slideContent'
                ,   'click .bookmarklet .notification-close': 'closeNotification'
                ,   'click .bookmarklet #byp_screenshot' : 'get_screenshot'
                ,   'click .bookmarklet #images_to_feat li img, #images_to_feat li img' : 'set_featured_image'
                ,   'click .bookmarklet span.close, .bookmarklet #images_to_feat span.close' : 'delete_image'
			}


			// Slide Content
		,	slideContent: function( e ) {
				e.preventDefault();


				var target = e.currentTarget
                ,   action = $( target ).data( 'action' )
				,	availableAction = [ 'section-1', 'section-2' ];

                if ( availableAction.indexOf( action ) == -1 ) return;

				// Change hash
				window.location.hash = '#' + action;
			}

			// Toggle term
		,	toggleTerm: function( e ) {
				e.preventDefault();

				var target = e.currentTarget
                ,   term = $( target ).data( 'term' ).trim().toLowerCase()
                ,   tax = $( target ).data( 'tax' )
                ,   parent = $( target ).data( 'parent' )
                ,   currentid = $( target ).data('listid')
                ,   idobj = $('.bookmarklet-list-id')
                ,   idtxt = $.trim( idobj.text() )
                ,   idval = '';

                // Toggle class
                $( target ).toggleClass( 'selected' );

                if ( $(target).parent().hasClass('theme-type')   ){

                    if ( !$( '.cats-area a[data-term="Theme"]' ).hasClass('selected') ) {

                         $( '.cats-area a[data-term="Theme"]' ).toggleClass( 'selected' );
                            controller.toggleTerm( 'theme', 'category', 'key' );
                    }
                    if ( !$( '.enviroment-tags a[data-term="Wordpress"]' ).hasClass('selected') ){

                        $( '.enviroment-tags a[data-term="Wordpress"]' ).toggleClass( 'selected' );
                        controller.toggleTerm( 'wordpress', 'category', 'enviroment' );
                        //$( '.selected-tags .enviroment-cats' ).show();

                    }


                    if ( idtxt ){

                        if ( $(target).hasClass('selected')){
                            $( target ).data('idassigned' , ','+ currentid );
                            idtxt = idtxt+','+ currentid;
                            idobj.text( idtxt );
                        }else{
                            idobj.text( idtxt.replace( $( target ).data('idassigned') , '' ) );
                        }


                    }else{
                        idobj.text( currentid );
                        $( target ).data('idassigned', currentid );
                    }
                }else{

                    controller.toggleTerm( term, tax, parent );

                    // Set a temporary variable to prevent bubbling the key event
                    window.Bppl.Helpers.choosing = true;

                    // Focus the input again
                    var inp = $( target ).parent().prev();
                    inp.find( 'input' ).focus().select();
                }
			}

			// Toggles content type
		,	setContType: function( e ) {
				e.preventDefault();

                var target = e.currentTarget
                ,   contType = $( target ).data( 'cont-type' );

                // Toggle content type
                $( this ).parent().find( '.label' ).removeClass( 'selected' );
                $( this ).addClass( 'selected' );

                controller.setContType( contType );
			}

			// Save post
		,	savePost: function( e ) {
				e.preventDefault();

				var title = '.title-content'
                ,   content = '.description-content'
                ,   link = '.external-link'
                ,   listId = '.bookmarklet-list-id'
                ,   gplvalue = $( 'input[name="sb-smt-licence-type"]:checked' ).val()
                ,   gplother = $( '.other-theme-license' ).val()
                ,   thdemo = $('.theme-demo-link').val()
                ,   listid = $( listId ).val()
                ,   is_numeric = !isNaN( parseFloat(listid) ) && isFinite( listid )//verifiy if is numeric or string
                ,   additional = $( '#images_to_feat li img:not( .ft_image )' );

                // console.log( view.post, view );

                if ( view.post.featuredImage.length < 1 ) {
                    return alert( 'Don`t forget to set the featured image.' );
                }

                if ( additional.length > 1 ) {
                    additional.each( function() {
                        view.post.additional_images.push( $( this ).data( 'img-original-src' ) );
                    });
                }
                // Remove duplicates
                view.post.additional_images = _.uniq( view.post.additional_images );

                // Check that type has been selected
                var tags = view.post.tags.collection
                ,   available = [ 'free', 'premium', 'hosted' ]
                ,   atLeastOne = false;

                for( var i in available ) {
                    if ( tags.indexOf( available[ i ] ) != -1 ) {
                        atLeastOne = true;
                    }
                }

                if ( ! atLeastOne ) {
                    return alert( 'Select at least one type `free`, `premium` or `hosted`. ' );
                }

                // Add loading state
                $( e.currentTarget ).addClass( 'disabled' )
                    .text( $( this ).data( 'loading-text' ) );

                // Get data
                view.post.title = $( title ).text();
                view.post.content = $( content ).text();
                view.post.externalLink = $( link ).data( 'link' );
                view.post.list_id = ( is_numeric )?listid:listid.split( ',' );
                // view.post.license = $( 'input[name="sb-smt-licence-type"]:checked' ).val();

                view.post.thdemo = thdemo;

                if( gplvalue == 'other' )
                    view.post.license = gplother;
                else
                    view.post.license = gplvalue;

                // console.log(view.post.additional_images, view.post);

                // Save post
                controller.savePost();
			}

			// Filters the key tags
        ,   filterKeyTags: function( e ) {

                var term
                ,   tagName = $( e.currentTarget ).val().trim().toLowerCase()
                ,   tagSection = $( e.currentTarget ).data( 'section' )
                ,   tax = $( this ).data( 'tax' )
                ,   parent = $( this ).data( 'parent' );

                // Tag mapping
                var sectionMap = {
                        elements: ".elements-cats"
                    ,   enviroment: ".enviroment-tags"
                    ,   services: ".services-cats"
                    ,   resources: ".resources-tags"
                    ,   freebies: ".freebies-tags"
                    ,   'general-tags': '.general-tags'
                    ,   'theme-tags': '.theme-tags'
                    ,   'icon-tags': '.icons-tags'
                    ,   type: ".type-tags"
                }

                if( typeof sectionMap[ tagSection ] == "undefined" ) {
                    return false;
                }

                // Add tag to collection
                if ( e.keyCode == 13 ) {

                    if ( window.Bppl.Helpers.choosing ) {
                        window.Bppl.Helpers.choosing = false;
                        return;
                    }

                    controller.createTerm( tagName, sectionMap[ tagSection ], tax, parent );
                }

                // Filter the tags in the section
                term = tagName;
                controller.filterTerms( term, sectionMap[ tagSection ] );
            }

            // Toggles the tags for a section
        ,   toggleTagsSection: function( e ) {

                e.preventDefault();
                var toggleTarget = $( e.target ).data( 'toggle' );


                $( this ).toggleClass( 'selected' );

                //$( "." + toggleTarget + "-cats-input" ).slideToggle( 330 );

                $( "." + toggleTarget + "-cats, ." + toggleTarget + "-tags, ."+toggleTarget).slideToggle( 330 );
            }

            // Closes the info notification
        ,   closeNotification: function() {

                var notification = '.bookmarklet .bookmarklet-notification.info';
                $( notification ).slideUp( 300 );

                // Set storage item
                if( ! window.localStorage ) return;
                window.localStorage.setItem(  'bookmarklet.notification.v1.dismissed', 'true' );

            }

        ,   get_screenshot: function( e ) {

                var target = $( e.target ).data( 'target' ),
                    url =  $( target ).val() ,
                    _this = this;

                $( 'label.img' ).text( '' );
                $( 'img.loading' ).show();
                $( e.target ).addClass( 'disabled' );
                if ( utilities.isUrl( url ) ){
                    var data =  { 'screnshot_token':window.Constants.screenshotid ,'url': url };
                    request = utilities.post( 'bypscreenshot', data, function( response ){

                        $( '#img_url' ).attr( 'src', response.img_url ).show();
                            _this.reset_featured_image();

                        $( '#images_to_feat' ).append( '<li><span class="close">&times;</span><img src="' + response.img_url + '" data-img_url="' + response.img_url + '" data-img-original-src="' + response.img_url + '"  alt="" class="ft_image" /></li>' );

                        // use in bookmarklet only
                        if ( window.Constants.postSlug == 'bookmarklet' ) {
                            view.post.additional_images.push( response.img_url );
                            view.post.featuredImage = response.img_url;
                        }

                        // Use for single only
                        else {
                            $( '.use-as-feat-img, .use-as-additional-img' ).attr( 'data-img_url', response.img_url );
                        }
                    });
                }
            }

        ,   set_featured_image: function ( e ) {

                var target = $( e.currentTarget )
                ,   imgToDel = target.data( 'img-original-src' )
                ,   additionalImages = [];

                this.reset_featured_image();

                target.addClass( 'ft_image' );

                if ( window.Constants.postSlug == 'bookmarklet' ) {

                    $( '#img_url' ).attr( 'src', target.data( 'img_url' ) ).show();
                    console.log( 'if:', view, view.post );
                    view.post.featuredImage = target.data( 'img_url' );
                }

                else {
                    // console.log( 'rome', window.Constants.POST_ID );
                    var post = {
                            ID: window.Constants.POST_ID
                        ,   featuredImage: target.data( 'img-original-src' )
                        ,   tags: [ 'post-revised' ]
                        ,   ref: 'builder'
                    };

                    console.log( 'else:', post );
                    // Handling img when feat img is selected
                    // $( '#images_to_feat img:not( .ft_image )' ).each( function () {
                    $( '#images_to_feat img' ).each( function () {
                        additionalImages.push( $( this ).data( 'img-original-src' ) );
                        $( this ).addClass( 'disabled' );
                    });

                    post.additional_images = additionalImages;
                    post.inSingle = true;

                    // var removeFrom = post.additional_images.indexOf( imgToDel );

                    // if ( removeFrom != -1 )
                    //     post.additional_images.splice( removeFrom, 1 );

                    // Set the new image
                    // $( '.post-image img' ).attr( 'src', target.data( 'img-original-src' ) );
                    $( '.post-image img' ).attr( 'src', target.data( 'img_url' ) );

                    // Save Post
                    window.Bppl.Models.Bookmarklet.save( post, function( data ) {

                        // Set the featured image
                        // $( '.post-image img' ).attr( 'src', target.data( 'img-original-src' ) );
                        $( '.post-image img' ).attr( 'src', target.data( 'img_url' ) );

                        // Show alert
                        utilities.alert( 'New featured image selected!' );
                    });
                }

            }

        ,   reset_featured_image: function ( ) {

                $( '#images_to_feat li img' ).removeClass( 'ft_image' );
            }

        ,   delete_image: function( e ) {

                var target = $( e.currentTarget )
                ,   src = target.parent().find( 'img' ).data( 'img-original-src' )
                ,   additional = $( '#images_to_feat li img:not( .ft_image )' );

                console.log( 'hakuna matata' );

                if ( additional.length > 1 ) {
                    additional.each( function() {
                        view.post.additional_images.push( $( this ).data( 'img-original-src' ) );
                    });
                }
                else {
                    view.post.additional_images = [];
                }

                // Remove duplicates
                view.post.additional_images = _.uniq( view.post.additional_images );

                if ( target.hasClass( 'ft_image' ) )
                    view.post.featuredImage = '';

                var removeFrom = view.post.additional_images.indexOf( src );

                if ( removeFrom != -1 )
                    view.post.additional_images.splice( removeFrom, 1 );

                // console.log(view.post.additional_images);

                target.parent().remove();
            }

	});

	// Global Exposition
	window.Bppl.Handlers.Bookmarklet = new Bookmarklet();



})( this.jQuery, this, this.document, this.Bppl.Views.Bookmarklet, this.Bppl.Controllers.Bookmarklet, this.Bppl.Models.Bookmarklet, this.Bppl.Helpers.Utilities );


/**
*
* Handler Sharing
*/
( function( $, window, document, view, model, controller, utilities ) {

	var Sharing = Gillie.Handler.extend({

			// Init
			initialize: function() {

				// Initialize Facebook
				this.fbInit();

				// Track shares
				this.track();

				// Use on social login
				$( window ).on( 'unload', function () {
					delete localStorage.dwnLink;
				});

			}

		,	events: {
					'submit .sharing-form-newsletter': 'newsletter'
				,	'submit .sharing-both-form-newsletter': 'newsletterBoth'
				,	'click .modal .download-twitter': 'twitterWindow'
				,	'click .modal .download-facebook': 'facebookWindow'
				,	'click .modal .download-direct': 'directDownload'

					// Open appropriate download modal
				,	'click .download-resource': 'downloadResource'
				,	'click .fb-share': 'facebookShare'

				// Share tooltip
				,	'click .share-post, .share-this-button': 'shareTooltip'
			}


			// Download by newsletter
		,	newsletter: function( e ) {
				e.preventDefault();

				var target = e.currentTarget
				, 	data, submit = $( target ).find( 'input[type="submit"]' )
				,	checkbox = '.modal-sharing-email .join-us';

				// Get data
				data = utilities.getFormData( target );

				// If there is no email
				if ( ! data.email ) {

					submit.removeClass( 'disabled' )
						.attr( 'value', submit.data( 'original-text' ) );
					return utilities.alert( 'Forgot to write your email' );
				}

				// Validate email
				if ( ! utilities.isEmail( data.email ) ) {

					submit.removeClass( 'disabled' )
						.attr( 'value', submit.data( 'original-text' ) );
					return utilities.alert( 'Invalid email format' );
				}

				// Validate join us
				if ( ! $( checkbox ).is( ':checked' ) ) {
					return utilities.alert( 'Please accept the terms' );
				}

				if ( submit.hasClass( 'disabled' ) ) return;

				// Show loading state in button
				submit.addClass( 'disabled' )
					.attr( 'value', 'Working...' );

				// Send data
				model.set( data );
				model.save( 'saveNewsletter' );
			}

			// Download by newsletter from both methods modal.
		,	newsletterBoth: function( e ) {
				e.preventDefault();

				var target = e.currentTarget
				, 	data, submit = $( target ).find( 'input[type="submit"]' )
				,	checkbox = '.modal-sharing-both .join-us';


				// Get data
				data = utilities.getFormData( target );

				// If there is no email
				if ( ! data.email ) {

					submit.removeClass( 'disabled' )
						.attr( 'value', submit.data( 'original-text' ) );
					return utilities.alert( 'Forgot to write your email' );
				}

				// Validate email
				if ( typeof data.email != 'undefined' ) {

					if ( ! utilities.isEmail( data.email ) ) {
						return utilities.alert( 'Invalid email' );
					}
				}

				// Validate join us
				// if ( ! $( checkbox ).is( ':checked' ) ) {
				// 	return utilities.alert( 'Please accept the terms' );
				// }

				if ( submit.hasClass( 'disabled' ) ) return;

				// Show loading state in button
				submit.addClass( 'disabled' )
					.attr( 'value', 'Working...' );

				// Send data with both options
				model.set( data );
				model.save( 'saveNewsletterBoth' );

                // Use on social login
                delete localStorage.dwnLink;

			}

			// Open Twitter's authorize URL window.
		,	twitterWindow: function( e ) {
				e.preventDefault();

				var target = e.currentTarget
				,	postId = $( target ).attr( 'data-post-id' )
				,	postGit = $( target ).attr( 'data-post-github' )
				,	extraData = $( target ).attr( 'data-post-extradata' )
				,	url = window.Constants.twitterRedirect + '?id=' + postId;

				if ( extraData && extraData.length >= 1 )
					url = url + '&extra_data=' + extraData;

				// console.warn( url, extraData );

				// Open modal
				utilities.openWindow( url, 700, 500 );

			}

			// Open Twitter's authorize URL window.
		,	directDownload: function( e ) {

				e.preventDefault();

				var target = e.currentTarget
				,	postId = $( target ).attr( 'data-post-id' )
				,	postGit = $( target ).attr( 'data-post-github' )
				,	url = $( target ).attr( 'href' );

				$( '.in-download' ).show();
				$( '.modal-backdrop' ).trigger( 'click' );

				setTimeout( function () {

					utilities.downloadView();

					window.location = url;
				}, 1500 );

			}

			// Download by social networks
		,	social: function( e ) {
				e.preventDefault();

			}

			// Download a resource
		,	downloadResource: function( e ) {

				e.preventDefault();

				var target = e.currentTarget
				,	method = $( target ).data( 'method' )
				,	postId = $( target ).data( 'post-id' )
				,	postGit = $( target ).data( 'post-github' )
				,	extraData = $( target ).data( 'post-extradata' )
				,	data = {};

				// console.log( extraData, postId );

				$( '.download-direct' ).addClass( 'disabled' ).html( '<i class="icon-download"></i> Loading...' );

				// Open modal
				if ( extraData && extraData.length >= 1 )
					view.openModal( method, postId, postGit, extraData );
				else
					view.openModal( method, postId, postGit, 'lego' );
			}


		,	facebookWindow: function( e ) {
				e.preventDefault();

				var target = e.currentTarget;
				// TODO, Get data attributes for setting up
				// post name, caption and description.
				if ( postId )
					delete postId;

				var postId = $( target ).attr( 'data-post-id' );
				var extraData = ( $( target ).attr( 'data-post-extradata' ) ) ? $( target ).attr( 'data-post-extradata' ) : 'lego';

				var url = window.location.href;
				url = url.slice( 0, url.indexOf('?') ); // Use it to remove unnecessary params in the url

				var obj = {
							method: 'feed'
						// ,	redirect_uri: window.location.href
						// ,	link: window.location.href
						,	redirect_uri: url
						,	link: url
						,	display: 'popup'
					}
				,	success = function( response ) {



						if ( typeof response != 'object'   ) {
							return;
						}
						if ( response.post_id ){


							// Get download URL from server
							utilities.post( 'sharing.get_link', { 'post_id': postId, 'extra_data': extraData }, function( data ) {

								if ( data.status == 200 ) {

									$( '.in-download' ).show();
									$( '.modal-backdrop' ).trigger( 'click' );
									setTimeout( function () {

										utilities.downloadView();

										window.location = data.data.url;
									}, 1500 );

								} else {

									utilities.alert( 'We are experiencing problems with downloads. Please try later.' );
								}

							} );
						}

					}

				// Call API
				FB.ui( obj, success );
			}

			// Track when user share list or posts.
		,	track: function() {

				if ( typeof twttr == 'undefined' ) { return; }
				var trackModel = window.Bppl.Models.Track;

				// Twitter
				twttr.ready( function() {

					// Event bindings
					twttr.events.bind( 'tweet', function( intentEvent ) {

						trackModel.on( 'saved', function( model, response ) {

						});

						// Store event
						trackModel.save( 'saved' );

					});

				});

			}

			// Initialize Facebook settings
		,	fbInit: function() {

				if ( typeof FB == 'undefined' ) { return; }

				if ( window.Constants.relative == 'prod' )
					FB.init({ appId: '299022556864918', status: true, cookie: true }); // server
				else
					FB.init({ appId: '178850402305449', status: true, cookie: true });  // pruebas
			}


			// Triggered when user share a post or a list
		,	facebookShare: function( e ) {
				e.preventDefault();

				var target = e.currentTarget
				,	uri = $( target ).data( 'href' )
				,	model = window.Bppl.Models.Track

				,	obj = {
							method: 'feed'
						// ,	redirect_uri: window.location.href
						,	link: uri
						,	picture: 'http://www.bypeople.com/wp-content/uploads/2013/06/puttypack-460x230.jpg'
						// ,	method: 'popup'
						, 	name: 'Debug post name'
						,	caption: 'Debug caption'
						,	description: 'Debug post description'
					}
				,	success = function( response ) {
						model.save();
					};

				// Call API
				FB.ui( obj, success );
			}

			// Display the share popover
		,	shareTooltip: function( e ) {

				e.preventDefault();

				var target = e.currentTarget
				,	text = $( target ).find( '> span' )
				,	interval, share
				, 	map = [
							'g-plusone'
						,	 'twitter-share-button'
						,	'fb-share'
					];

				$( target ).next( '.share-this-tooltip' ).toggle();
				utilities.closeOnClickOut( '.share-this-tooltip', function(){ $( '.share-this-tooltip' ).hide(); } );

				$.each( map, function( k, v ) {

					$( target ).next().find( '.' + v + '-off' )
						.addClass( v );
				});


				// Show loading state
				$( target ).addClass( 'disabled' )
					.find( '> span' ).text( 'Wait..' );


				// Hack to remove the loading state
				interval = setInterval( function() {

					// Google share
					share = $( target ).next().find( '.Share-google > [action="share"]' );

					if ( share.length == 0 ) {

						clearInterval( interval );
						$( target ).removeClass( 'disabled' )
							.find( '> span' ).text( 'Share' );
					}

				}, 400 );


				// Load Google+ and then, Twitter and Pinterest
				utilities.loadGooglePlus();
				setTimeout( function() {

					utilities.loadTwitter();
				}, 1 );

			}

	});

	// Global Exposition
	window.Bppl.Handlers.Sharing = new Sharing();



})( this.jQuery, this, this.document, this.Bppl.Views.Sharing, this.Bppl.Models.Sharing, this.Bppl.Controllers.Sharing, this.Bppl.Helpers.Utilities, undefined );

/**
*
* Handler Submitter
*/
( function( $, window, document, model, view, controller, utilities ) {

	var Submitter = Gillie.Handler.extend({

			// Init
			initialize: function() {
				// this.execNotifications();
				// this.pasteImg();
				utilities.maxLengthChars( '#sb-smt-graphic-title' );
			}

			// Events
		,	events: {

					// Tabs change
					'click #bmAppContainer .bp-smt-types .bp-smt-types-item': 'changeTab'
				,	'click .sb-smt-form-submitter': 'showImgUploader'
				,	'click #bp-smt-done-uploading-images-hook': 'showMainView'
				,	'click .sb-smt-submit-post': 'getPostData'
				,	'click .success-view-close, #sb-smt-success-dismiss i, .bp-bm-overlay, .submitter-close': 'close'
				,	'click .Submitter-suggest-item' : 'suggestItem'
				,	'focus #bmAppContainer [contenteditable]': 'emulatePlaceholder'
				,	'click #bmAppContainer [name="sb-smt-licence-type"]': 'showOtherLicense'
				,	'click .control-group.tags .label': 'toggleTags'
				,	'click .control-group.categories .custom-label': 'toggleCat'
				, 	'click #byp_screenshot' : 'capture_screnshot'
				,	'keyup .limited': 'limited'
				,	'click .LoginRegister-modal .close': 'hideAll'
				// ,	'click .modal-backdrop': 'hideAll'
			}

			// Change view when tabs are clicked.
		,	changeTab: function( e ) {
				e.preventDefault();

				var target = e.currentTarget
				,	ref = $( target ).attr( 'href' )
				,	id = $( target ).attr( 'id' );

				// Store the current category.
				model.set( 'category', $( target ).data( 'category' ) );

				// Remove
				view.changeTab( target );
			}


			// Show the uploader for images.
		,	showImgUploader: function( e ) {
				e.preventDefault();

				// Show submitter
				var submitter = '#bmAppContainer'
				,	imgUploader = '.bp-smt-img-uploads-container'
				,	scroll = $( window ).scrollTop() + 300;

				$( submitter ).fadeOut( 100, function( e ) {
					$( imgUploader ).css( 'top', scroll );
					$( imgUploader ).fadeIn( 100 );
				});

			}

			// Show submitter back
		,	showMainView: function( e ) {
				e.preventDefault();

				var submitter = '#bmAppContainer'
				,	imgUploader = '.bp-smt-img-uploads-container';

				$( imgUploader ).fadeOut( 100, function( e ) {
					$( submitter ).fadeIn( 100 );
				});
			}

			// Get post data to be saved
		,	getPostData: function( e ) {
				e.preventDefault();

				// Show overlay
				view.overlay( 'show' );

				var target = e.currentTarget
				,	cat = $( target ).data( 'cat' )
				,	data
				,	map = {
							'graphic': 'Graphic'
						,	'code': 'Code'
						,	'resource': 'Resource'
						,	'marketplace' : 'Marketplace'
						,	'photo' : 'Photo'
						,	'theme' : 'Theme'
					};

				if ( typeof map[ cat ] == 'undefined' ) {
					return utilities.alert( 'Invalid category name' );
				}

				// Get appropriate data
				data = view[ 'get' + map[ cat ] + 'Data' ]();
				if ( ! data ) {
					view.overlay( 'hide' );
					return;
				}

				// Save post
				model.set( data );


	    		if ( ! confirm( 'Do you want to send the post without loging into ByPeople?' ) ) {

	    			// console.log( 'user set credentials' );
			        // return false;

			    	// Bind an event to call when the user finishes the login.
					window.Bppl.Event.on( 'user.login', utilities.bind( controller.suscribe, controller ) );

					// Open the login form and set it to trigger "user.login" event.
					window.Bppl.Views.User.toggleLogin( 'user.login' );

					model.suscribe( 'suscribe' );
	    		}

	    		else {
	    			// console.log( 'user no set credentials', data );
					// Save pending post.
					model.save( 'save' );
					utilities.smtDataTags = [];
	    		}










				// // Check whether the user is logged in.
				// if ( $( target ).hasClass( 'not-logged-in' ) ) {

				// 	// Bind an event to call when the user finishes the login.
				// 	window.Bppl.Event.on( 'user.login', utilities.bind( controller.suscribe, controller ) );

				// 	// Open the login form and set it to trigger "user.login" event.
				// 	window.Bppl.Views.User.toggleLogin( 'user.login' );

				// 	model.suscribe( 'suscribe' );

				// } else {

				// 	// Save pending post.
				// 	model.save( 'save' );
				// 	utilities.smtDataTags = [];
				// }

			}


			// Close the submitter
		,	close: function( e ) {
				e.preventDefault();

				var successWrapper = '.sb-smt-success-view'
				,	overlay = '.modal-backdrop'
				,	submitter = '#bmAppContainer'
				,	submitterOverlay = '.sb-smt-overlay';

				$( successWrapper ).fadeOut( 100 );
				$( overlay ).fadeOut( 100 );
				$( submitterOverlay ).hide();
				$( submitter ).hide();
			}

			// Open the submitter suggesting such post
			// to a list.
		,	suggestItem: function( e ) {
				e.preventDefault();

				var target = e.currentTarget
				, 	id = $( target ).data( 'list-id' )
				,	contentType = $( target ).data( 'content-type' );

				// Suggest list.
				if ( typeof id == 'number' ) {
					model.set( 'list_id', id );
				}

				// Set content type on model
				model.set( 'content_type', contentType );

				// Open modal
				view.open();
			}

			// Remove default text from `h3` on focus
		,	emulatePlaceholder: function( e ) {
				e.preventDefault();

				var target = e.currentTarget;

				if ( $(  target ).data( 'cleaned' ) ) {
					return;
				}

				// Add cleaned attribute and clean text
				$( target ).attr( 'data-cleaned', 'true' )
					.text( '' );

			}

			// Show the input for other license of the selected radio is
			// "Other license"
		,	showOtherLicense: function( e ) {

				var target = e.currentTarget
				,	val = $( target ).val()
				,	textInput = '#bmAppContainer .other-licence > input[type="text"]';

				// Show or hide input
				val == 'CUSTOM-LICENCE' ? $( textInput ).slideDown( 'fast' )
					: $( textInput ).slideUp( 'fast' )

			}

			// Toogle tags  to attach the form
		,	toggleTags: function ( e ) {

				e.preventDefault();

				var target = e.currentTarget
				,	tag = ( ! $( target ).hasClass( 'theme-label' ) ) ? $( target ).text() : $( target ).data( 'wplist-id' )
				,	tagIn;

				$( target ).toggleClass( 'selected' );

				if ( $( target ).hasClass( 'selected' ) ) {

					utilities.smtDataTags.push( tag );
				}
				else {

					tagIn = utilities.smtDataTags.indexOf( tag );

					if( tagIn != -1 ) {

						utilities.smtDataTags.splice( tagIn, 1 );
					}
				}
			}

			// Toogle tags  to attach the form
		,	toggleCat: function ( e ) {

				e.preventDefault();

				var target = e.currentTarget
				,	cat = $( target ).data( 'subcat-id' )
				,	catIn;

				$( '.control-group.categories .custom-label' ).removeClass( 'selected' );

				$( target ).toggleClass( 'selected' );

				if ( $( target ).hasClass( 'selected' ) ) {

					utilities.smtDataMarketCat = cat;
				}
			}

		,	hideAll: function ( e ) {
				 $( '.sb-smt-overlay' ).hide();
			}

			//get screenshot
		, capture_screnshot: function( e ){

			var target = e.currentTarget
			,	scr = $( target )
			,	url = $.trim( $( '#byp_txt_screenshot' ).val() )
			,	loading = $( '.capture_area .loading' );
			$( '#byp_txt_screenshot' ).val( url );

			if ( utilities.isUrl( url ) ){
					loading.show();
				scr.addClass('disabled');
				var data = 	{ 'screnshot_token':window.Constants.screenshotid ,'url': url };
				request = utilities.post( 'bypscreenshot', data, function(data){

					model.set( 'featured_image', data.img_url );
					$('.sb-smt-image-container img').attr('src',data.img_url);
	                $('.sb-smt-image-overlay').removeClass('visible');
	                scr.removeClass('disabled');
	                loading.hide();
				} );
			}else{
				utilities.alert('Please write a valid url');
			}
		}
			// ExecNotifications
		,	execNotifications: function() {

				//intro_notification
				if ( utilities.chkCookie( 'intro_notification' ) && utilities.chkCookie( 'intro_notification' ).length >= 1 ) {

					if ( utilities.chkCookie( 'intro_notification' ) == 1 )
						utilities.alert( 'Thanks, your post has been sent to revision. <a href="' + window.Constants.siteURL + 'submit">Submit another</a>' );

					utilities.delCookie( 'intro_notification' );
				}
			}

		,	pasteImg: function() {

				(function($) {
				  var defaults;
				  $.event.fix = (function(originalFix) {
				    return function(event) {
				      event = originalFix.apply(this, arguments);
				      if (event.type.indexOf('copy') === 0 || event.type.indexOf('paste') === 0) {
				        event.clipboardData = event.originalEvent.clipboardData;
				      }
				      return event;
				    };
				  })($.event.fix);
				  defaults = {
				    callback: $.noop,
				    matchType: /image.*/
				  };
				  return $.fn.pasteImageReader = function(options) {
				    if (typeof options === "function") {
				      options = {
				        callback: options
				      };
				    }
				    options = $.extend({}, defaults, options);
				    return this.each(function() {
				      var $this, element;
				      element = this;
				      $this = $(this);
				      return $this.bind('paste', function(event) {
				        var clipboardData, found;
				        found = false;
				        clipboardData = event.clipboardData;
				        return Array.prototype.forEach.call(clipboardData.types, function(type, i) {
				          var file, reader;
				          if (found) {
				            return;
				          }
				          if (type.match(options.matchType) || clipboardData.items[i].type.match(options.matchType)) {
				            file = clipboardData.items[i].getAsFile();
				            reader = new FileReader();
				            reader.onload = function(evt) {
				              return options.callback.call(element, {
				                dataURL: evt.target.result,
				                event: evt,
				                file: file,
				                name: file.name
				              });
				            };
				            reader.readAsDataURL(file);
				            return found = true;
				          }
				        });
				      });
				    });
				  };
				})(jQuery);

				$( "html" ).pasteImageReader( function( results ) {

				    var dataURL, filename;
				    filename = results.filename, dataURL = results.dataURL;
				    var img = document.createElement( 'img' );
						img.src= dataURL;
					var w = img.width
					,	h = img.height;

				    // Test data
				    // console.log( results.file.size );
				    // console.log( results.file.type );
				    // console.log( w, h );
				    // console.log( dataURL );

				    if ( w == 800 && h == 600 ) {
					    $( '.sb-smt-image-container img' ).attr( 'src', dataURL);
					    $('.sb-smt-image-overlay').removeClass('visible');
				    }

				    // return $( ".pasteImage" ).css({
				    //     backgroundImage: "url(" + dataURL + ")"
				    // });

				});

			}

	});

	// Global Exposition
	window.Bppl.Handlers.Submitter = new Submitter();


})( this.jQuery, this, this.document, this.Bppl.Models.Submitter, this.Bppl.Views.Submitter, this.Bppl.Controllers.Submitter, this.Bppl.Helpers.Utilities, undefined );
/**
*
* Handler BuilderPage
*/
( function( $, window, document, model, view, controller, utilities ) {

	var BuilderPage = Gillie.Handler.extend({

			initialize: function() { }

			// Events
		,	events: {
					'click .builder-page .label': 'toggleTerm'
                ,   'keyup .builder-page .key-cat-input, .builder-page .env-cat-input, .builder-page .tags-input ': 'filterTerms'
                ,   'click .builder-page .select-container': 'focusSelectInput'
                ,   'click .builder-page .pagination > ul > li > a': 'paginateResults'

                ,   'submit .Builder-modal .new-list': 'newList'
                ,   'click .Builder-modal .modal-cancel': 'closeModal'
                ,   'click .builder-page .open-modal': 'openModal'
                ,   'mousedown .builder-page .label': 'toggleNotInTerm'

                // ,   'click .builder-page .result-content .excerpt, .builder-page .result-content .content': 'showFullContent'

                // Edit post content
                ,   'blur .builder-page .result-content .excerpt, .builder-page .result-content .content': 'savePostContent'
                ,   'focus .builder-page .result-content .excerpt, .builder-page .result-content .content': 'focusPostContent'

                // Edit post title
                ,   'focus .builder-page .result-content h3 > a': 'focusPostTitle'
                ,   'blur .builder-page .result-content h3 > a': 'savePostTitle'

                ,   'click .builder-page .builder-notification .close': 'hideGlobalNotification'

                // Search by post name
                ,   'submit  .search-form[role="builder"]': 'searchByName'

			}

			// Toggle a term
		,	toggleTerm: function( e ) {
				e.preventDefault();

				var target = e.currentTarget
				,	parent = $( target ).data( "parent" )
                ,   termId = $( target ).data( "term-id" )
                ,   slug = $( target ).data( "slug" )
                ,   tax = $( target ).data( "tax" );

                $( target ).toggleClass( "selected" );
                controller.toggleTerm( slug, termId, tax, parent );
			}

			// Filter terms
		,	filterTerms: function( e ) {

                var target = e.currentTarget
                ,	slug = $( target ).val()
                ,   idealWidth
                ,   section = $( target ).data( "section" );

                // On enter, append the first match if there were any
                if ( e.keyCode == 13 ) {

                    // Temporary
                    var map = {
                            key: ".key-cat-terms"
                        ,   env: ".env-cat-terms"
                        ,   tag: ".tag-terms"
                    }

                }

                // Change the width of the input
                idealWidth = $( target ).val().length * 6;
                $( target ).css( "width", idealWidth + 13 );

                // Filter all the elements, and select the first one
                controller.filterTerms( slug, section );
            }


            // Focus the text input
        ,   focusSelectInput: function( e ) {

                $( e.currentTarget ).find( 'input[type="text"]' )
                    .focus();
            }

            // Gets the posts corresponding posts for the page given
        ,   paginateResults: function( e ) {
                e.preventDefault();

                var target = e.currentTarget
                ,	page = $( target ).data( 'page' );

                // model.query.page = page;
                model.set( 'page', page );

                // Add active class and trigger model:paginate
                $( target ).parent().parent().find( 'li' ).removeClass( 'active');
                $( target ).parent().addClass( 'active' );

                // Get posts
                model.getPosts( 'sync_paginate' );
            }

            // Create a new list based on the selected terms
        ,   newList: function( e ) {
                e.preventDefault();

                var data
                ,   target = e.currentTarget;

                // Loading
                if( $( target ).find('input[type="text"]' ).hasClass( 'disabled' ) ) {
                    return;
                }

                $( target ).find( 'input[type="submit"]' )
                    .attr( 'value', 'Loading...' ).addClass( 'disabled'  );

                data = utilities.getFormData( target );
                model.createList( 'list_created', data );

            }

            // Toggle a term to get posts
            // that are not in it.
        ,   toggleNotInTerm: function( e ) {

                // Disable context menu
                if ( e.which != 3 ) return;
                $( document )[ 0 ].oncontextmenu = function() { return false; };

                var target = e.currentTarget
                ,   parent = $( target ).data( "parent" )
                ,   slug = $( target ).data( "slug" )
                ,   tax = $( target ).data( "tax" )
                ,   id = $( target ).data( 'term-id' );

                // Toggle Term
                $( target ).toggleClass( 'not-in' );
                controller.toggleTermNotIn( slug, id, tax, parent );
            }

            // Closes the modal
        ,   closeModal: function() {
                view.closeModal();
            }

            // Opens the modal
        ,   openModal: function( e ) {

                e.preventDefault();
                var target = e.currentTarget

                $( target ).text( 'Opening...' )

                // Get posts
                model.findSimilarLists( 'find_similar_lists' );
                // $( model ).trigger( 'open_modal' );

            }

            // Hide the exerpt and show the full content
        ,   showFullContent: function( e ) {

                var resultContent = $( e.currentTarget ).parent()
                ,   content = $( resultContent ).find( '.content' )
                ,   excerpt = $( resultContent ).find( '.excerpt' );

                if ( content.is( ':visible' ) ) {
                    excerpt.slideDown( 200 );
                    content.slideUp( 200 );
                }

                else {
                    excerpt.slideUp( 200 );
                    content.slideDown( 200 );
                }

            }

            // Hide the global notification
        ,   hideGlobalNotification: function() {

                var notification = '.builder-page .builder-notification > div';
                $( notification ).slideUp( 200 );

                // Save state
                localStorage.setItem( 'builder.notification.closed', true );

            }

            // Check whether there are notifications to show
        ,   showNotifications: function() {

                var closed = localStorage.getItem( 'builder.notification.closed' )
                ,   notification = '.builder-page .builder-notification'

                ,   html = [ '<div class="head-blue">'
                        ,   'You can show the show the full content of the posts by clicking on the content text.'
                        ,   '<button type="button" class="close white" data-dismiss="modal" aria-hidden="true"></button>'
                        ,   '</div>'
                    ].join( '' );
                html = $( html ).hide();


                // Show notification if it hasn't been closed
                if ( ! closed ) {

                    // Show it
                    $( window ).load( function() {

                        $( notification ).append( html );
                        $( html ).slideDown();

                    });

                }
            }

            // Handle results title edition
        ,   focusPostTitle: function( e ) {
                e.preventDefault();

                var target = e.currentTarget;
                $( target ).data( 'original-title', $( target ).text().trim() )

            }

            // Save post title
        ,   savePostTitle: function( e ) {
                e.preventDefault();

                var target = e.currentTarget
                ,   title = $( target ).text().trim()
                ,   originalTitle = $( target ).data( 'original-title' )
                ,   postId = $( target ).parent().parent().parent()
                        .parent().data( 'post-id' )
                ,   post = {
                            ID: postId
                        ,   title: title
                        ,   ref: 'builder'
                        ,   tags: [ 'post-revised' ]
                    }


                // Set variables
                if ( title != originalTitle ) {

                    // Save Post
                    window.Bppl.Models.Bookmarklet.save( post, function( data ) {
                        console.log( data );
                        utilities.alert( 'Post saved!', null, null, 2000 );
                    });

                }

            }

            // Focus post content
        ,   focusPostContent: function( e ) {
                e.preventDefault();

                var target = e.currentTarget;
                $( target ).data( 'original-content', $( target ).text().trim() );
            }


            // Save post content
        ,   savePostContent: function( e ) {
                e.preventDefault();

                var target = e.currentTarget
                ,   content = $( target ).text().trim()
                ,   originalContent = $( target ).data( 'original-content' )
                ,   postId = $( target ).parent().parent()
                        .parent().data( 'post-id' )
                ,   post = {
                            ID: postId
                        ,   content: content
                        ,   ref: 'builder'
                        ,   tags: [ 'post-revised' ]
                    }

                // Set variables
                if ( content != originalContent ) {

                    // Save Post
                    window.Bppl.Models.Bookmarklet.save( post, function( data ) {
                        utilities.alert( 'Post saved!', null, null, 2000 );
                    });

                }
            }

            // Search posts by name
        ,   searchByName: function( e ) {
                e.preventDefault();

                var target = e.currentTarget
                ,   data = utilities.getFormData( target );

                // Render search
                model.reset()
                    .set( data )
                    .search( 'sync' );

            }

	});

	// Global Exposition
	window.Bppl.Handlers.BuilderPage = new BuilderPage();


})( this.jQuery, this, this.document, this.Bppl.Models.BuilderPage, this.Bppl.Views.BuilderPage, this.Bppl.Controllers.BuilderPage, this.Bppl.Helpers.Utilities, undefined );

/**
*
* Handler Sidebar
*/
( function( $, window, document, view, controller, model, utilities ) {

	var Sidebar = Gillie.Handler.extend({

			// Initialize
			initialize: function() {

				// this.curatorPrevSlider();
				// this.mainSlider();
				this.prevSlider( '.sc-slider-post', '.main-post-profile i', 14 );
				this.prevSlider( '.sc-slider-list', '.main-list-profile i', 14 );
				this.prevSlider( '.sc-slider-like', '.main-likes-profile i', 14 );
				this.prevSlider( '.sc-slider-follow', '.main-follow-profile i', 14 );

				// Mobile sliders
				this.prevSlider( '.sc-slider-post-mobile', '.main-post-profile-mobile i', 4 );
				this.prevSlider( '.sc-slider-list-mobile', '.main-list-profile-mobile i', 4 );
				this.prevSlider( '.sc-slider-like-mobile', '.main-likes-profile-mobile i', 4 );
				this.prevSlider( '.sc-slider-follow-mobile', '.main-follow-profile-mobile i', 4 );

				// Tablet sliders
				this.prevSlider( '.sc-slider-post-tablet', '.main-post-profile-tablet i', 5 );
				this.prevSlider( '.sc-slider-list-tablet', '.main-list-profile-tablet i', 5 );
				this.prevSlider( '.sc-slider-like-tablet', '.main-likes-profile-tablet i', 5 );
				this.prevSlider( '.sc-slider-follow-tablet', '.main-follow-profile-tablet i', 5 );

				// Uncomment for enable auto play on slider
				// utilities.sliderAutoPlay( null , '.sc-slider' , '.sc-slider ul' );

			}

			// Events
		,	events: {

				// 	Freebies sidebar widget
				//	__________________________________

					'click .controls .Freebies-Widget-control': 'slideFreebiesWidget'
				,	'mouseover .become-curator-modal': 'curatorTooltip'
				,	'click .become-curator-modal': 'curatorModal'
				,	'submit #form-becomeCurator': 'sendBecomeCurator'
				,	'click .tweet-curator': 'tweetCurator'
				,	'click .faq-link': 'openFaq'
				,	'click .top-user-prize': 'topUserPopover'
				,	'click body': 'debug'

				// 	Profile change picture on event hover
				//	__________________________________

				,	'mouseover .sc-slider ul li a': 'profileChange'
				,	'mouseout .sc-slider ul li a': 'removeChange'

				// 	Hide tooltip download all items
				//	___________________________________

				,	'click body': 'toggleDownloadItems'

				// 	Slideshow
				// 	______________________________

					// Curator
				,	'click .sc-prev-curators' : 'moveCuratorLeft'
				,	'click .sc-next-curators' : 'moveCuratorRight'

					// General
				,	'click .bp-prev': 'moveSlideLeft'
				,	'click .bp-next': 'moveSlideRight'

					// Posts
				,	'click .sc-prev-post': 'moveSlider'
				,	'click .sc-next-post': 'moveSlider'

					// Lists
				,	'click .sc-prev-list': 'moveSlider'
				,	'click .sc-next-list': 'moveSlider'

					// Likes
				,	'click .sc-prev-like': 'moveSlider'
				,	'click .sc-next-like': 'moveSlider'

					// Following
				,	'click .sc-prev-follow': 'moveSlider'
				,	'click .sc-next-follow': 'moveSlider'

				// 	// Latest Resources
				// ,	'click .sc-prev-latest': 'moveSlider'
				// ,	'click .sc-next-latest': 'moveSlider'

					// Marketplace
				,	'click .sc-prev-marketplace': 'moveSlider'
				,	'click .sc-next-marketplace': 'moveSlider'




			}

		,	debug: function( e ) {
				// console.log( "Debug" );
				// var popover = '.popover-bppl';

				// $( popover ).remove();
			}

		, 	curatorTooltip: function( e ) {

				e.preventDefault();

				var target = e.currentTarget
				,	currentDay = ( new Date ).getDate()
				,	position = $( target ).data( 'position' )
				,	elClass = $( target ).data( 'elclass' )
				,	content = $( target ).data( 'content' )
				,	click = $( target ).data( 'click' );

				if ( currentDay % 2 == 0 ) {
					if ( click == 0 ) {
						utilities.tooltip( e, position, elClass, content );
					}
				}

			}

		, 	curatorModal: function( e ) {

				e.preventDefault();

				var target = e.currentTarget
				,	currentDay = ( new Date ).getDate()
				,	position = $( target ).data( 'modal' )
				,	click = $( target ).data( 'click' );

				if ( currentDay % 2 != 0 ) {
					utilities.openModal( '.BecomeCurator-modal' );
				} else {
					if ( click == 1 ) {
						utilities.popover( e, position, 'curators', 'Just <a class="tweet-curator" href="http://ctt.ec/GgL0y">tweet using "#bpCurators"</a> and tell us what make you that awesome! Check <a class="faq-link" href="/faq#become-a-curator">curators benefits</a>.', 'Become Curator' );
						utilities.closeOnClickOut( '.popover-bppl', function() { $( '.popover-bppl' ).remove(); } );
					}
				}

			}

		,	toggleDownloadItems: function( ) {

				$( '.Popover-list-download' ).hide();

			}

		,	tweetCurator: function( e ) {

				e.preventDefault();

				var target = e.currentTarget
				,	url = $( target ).attr( 'href' );

				window.open( url , 'Become Curator', 'width=500, height=500, scrollbars=yes' );

			}

		,	openFaq: function( e ) {

				var target = e.currentTarget
				,	url = $( target ).attr( 'href' );

				window.open( url , '_blank' );

			}

		,	sendBecomeCurator: function( e ) {

				e.preventDefault();

				var target = e.currentTarget
				,	submit = $( target ).find( 'input[type="submit"]' )
				,	required = [ 'comments' ]
				,	errors = [];

				// Add loading state
				if ( utilities.isWorking( target ) ) return;
				utilities.startWorking( target );

				// Get + validate data
				data = utilities.getFormData( target );

				// Validate
				$.each( required, function( k, v ) {

					if ( typeof data[ v ] != 'string' ) {
						errors.push( v );
					} else {
						if ( ! data[ v ].trim() ) {
							errors.push( v );
						}
					}

				});

				if ( errors.length ) {
					return view.showError();
				}

				if ( $( target ).find( 'input:submit' ).hasClass( 'not-logged-in' ) ) {

					// Close the modal window
					utilities.openModal( '.BecomeCurator-modal' );

					// Bind an event to call when the user finish the login
					window.Bppl.Event.on( 'user.login', utilities.bind( controller.save, controller ) );

					// Open the login form set to trigger the `user.login` event
					window.Bppl.Views.User.toggleLogin( 'user.login' );

					return;

				} else {

					controller.save();

				}

			}

		, 	topUserPopover: function( e ) {

				e.preventDefault();

				// var	target = e.currentTarget;

				utilities.popover( e, 'top', 'top-users', 'Top User on Bypeople', 'Top Users' );

				utilities.closeOnClickOut( '.popover-bppl', function(){ $( '.popover-bppl' ).remove(); } );
			}

			// Handle the slide of freebies
		,	slideFreebiesWidget: function( e ) {

				e.preventDefault();

				var target = e.currentTarget
				,	available = [ 'left', 'right' ]
				, 	direction = $( target ).data( 'direction' );

				if ( ! direction in available ) return;

				// Show appropriate "li"
				view.slideFreebiesWidget( direction );

			}

		/*
            ==================
                Slideshow
            ==================
        */

			/* Slider Curator */

		,	curatorPrevSlider: function() {
				utilities.slideShowPlay( '.sc-slider', '.sc-slider ul' );
			}

		,	moveCuratorLeft: function( e ) {
				e.preventDefault();
				utilities.moveLeftPlay( e, '.sc-slider', '.sc-slider ul' );
		    }

		,	moveCuratorRight: function ( e ) {
				e.preventDefault();
				utilities.moveRightPlay( e, '.sc-slider', '.sc-slider ul' );
		    }

			/* Slider General */
		,	moveSlideLeft: function( e ) {

				e.preventDefault();

				var target = e.currentTarget;
				$( '.bp-next, .bp-prev' ).removeAttr( 'data-action' );
				$( target ).attr( 'data-action', 'true' );

				utilities.moveRight();
			}

		,	moveSlideRight: function ( e ) {
				e.preventDefault();

				var target = e.currentTarget;

				$( '.bp-next, .bp-prev' ).removeAttr( 'data-action' );
				$( target ).attr( 'data-action', 'true' );

				utilities.moveLeft();
			}

			/* Slider with call AJAX */
		,	prevSlider: function ( slider, arrows, results ) {

				var main = slider
				,	sliders = main + ' ul'
				,	items = main + ' ul li';

				if ( $( main ).length >= 1 ) {

					if ( $( items ).length <= results )
						// console.log( $( arrows ) );
						$( arrows ).hide();
				}

				utilities.slideShow( main, sliders );

			}

		,	moveSlider: function ( e ) {

				e.preventDefault();

				var target = e.currentTarget
				,	main = $( target ).data( 'slide' )
				,	sliders = main + ' ul'
				,	data = ''
				,	max = [] // list page values from slides
				,	latestSlide // the max value in max array
				,	currentSlide // current slide in slider
				,	direction = $( target ).data( 'direction' );

				switch ( direction ) {

					case 'left':

							utilities.moveRight( e, main, sliders );

					break;

					case 'right':

						// loading ...
						$( target ).addClass( 'disabled' );

						// Set max array
						$( sliders ).each( function () {
							max.push( $( this ).data( 'page' ) );
						});

						// set necessary data for checking if ajax is needed.

						// Get the max value in max array
						latestSlide = _.max( max );

						// Set the current slider
						currentSlide = $( sliders + ':nth-child( 2 )' ).data( 'page' );

						// Check if the current slider has the same value of latestSlide
						if ( currentSlide == latestSlide ) {

							// Get posts using AJAX method
							data = utilities.ajax(
									{ type:'get' } // options
								,	{
											'action' : $( target ).data( 'action' )
										,	'page' : $( sliders ).length
										,	'profile' : $( main ).data( 'profile' )
									}
							);

							// $( main ).append( data );
							// Insert AJAX data after the latest slide
							$( data ).insertAfter( $( sliders + '[data-page="' + latestSlide + '"]' ) );

							// Reset slider properties
							utilities.slideShow( main, sliders ); // use to set size of slider wrapper

							// Move slider
							utilities.moveLeft( e, main, sliders );
						}

						else {

							utilities.moveLeft( e, main, sliders );
						}

					break;
				}

			}

		/*
            ==================
                End Slideshow
            ==================
        */

            /* Profile */
		,	profileChange: function ( e ) {
				var target = e.currentTarget
				,	image = $( target ).data( 'image' ) //profile
				,	source = $( target ).find( 'img' );

				if ( ! image ) { $( source ).addClass( 'hover-curator-img' ); }
				else {
					$( target ).attr( 'data-original-image', $( source ).attr( 'src' ) );
					$( source ).attr( 'src', window.Constants.imagesUrl + image );
				}
			}
		, 	removeChange: function ( e ) {
				var target = e.currentTarget
				,	image = $( target ).data( 'original-image' )
				,	source = $( target ).find( 'img' );

				if ( ! image ) { $( source ).removeClass();	}

				$( source ).attr( 'src', image );
			}

	});

	// Global Exposition
	window.Bppl.Handlers.Sidebar = new Sidebar();



})( this.jQuery, this, this.document, this.Bppl.Views.Sidebar, this.Bppl.Controllers.Sidebar, this.Bppl.Models.Sidebar, this.Bppl.Helpers.Utilities, undefined );

/**
*
* Handler Curation
*/
( function( $, window, document, view, controller, model, utilities ) {

	var Curation = Gillie.Handler.extend({

			// Initialize
			initialize: function() {

				// Handle the sort of elements
				this.handleListItemsSort();

			}

			// Events
		,	events: {
					'click .Curation-accept, .Curation-reject': 'curate'
				,	'click .Curation-curate': 'curate'

				// Load all lists for a given category
				,	'click .category-listing .cat-label, .content-curation .filter-term': 'showCatLists'

				// Load all items in a list
				,	'click .all-lists .group .list-title': 'showListItems'

				// Heart
				,	'click .all-lists .group-actions .group-sticky': 'stickPost'

				// Accept  and reject
				,	'click .all-lists .group-actions .group-remove': 'removePost'
				,	'click .all-lists .group-actions .group-accept': 'acceptPost'

				// Like Icon
				,	'click .all-lists .group-actions .like': 'likePost'

				// Dislike Icon
				,	'click .all-lists .group-actions .dislike': 'dislikePost'

				// Reorer items according user
				,	'click .set-pos-in-list': 'setItemPositionInList'

			}

			// Accept or reject a post or a comment
		,	curate: function( e ) {
				e.preventDefault();

				var target = e.currentTarget;
				if ( $( target ).hasClass( 'disabled' ) ) return;

				$( target ).addClass( 'disabled' )
					.text( 'Working...' );

				// console.log( utilities.data( e ) );return;

				model.set( utilities.data( e ) ).curate( 'curate' );
			}


			// Handle sorting list items
		,	handleListItemsSort: function() {

				// var listItems = '.curation-wrapper .list-items'
				var listItems = '.posts-list-view'
				,	newPositions, id, itemId;

				$( listItems ).sortable({
						handle: '.group-move'
					,	placeholder: 'ui-state-highlight'
					,	update: function( e, ui ) {

							newPositions = [];

							// Loop
							// $( this ).find( 'li.group' ).each( function() {
							$( this ).find( 'li.list-box-large' ).each( function() {

								id = $( this ).data( 'id' );
								newPositions.push( id );

							});

							console.log( newPositions );

							// Sort list items
							model.set( 'list_id', window.Constants.LIST_ID );
							model.set( 'items_order', newPositions )
								.sortListItems( 'sort_list_items' );

						}
				});
			}

			// Show all the lists in a particular category
		,	showCatLists: function( e ) {
				e.preventDefault();

				var target = e.currentTarget
				, 	slug = $( target ).data( 'slug' )
				,	count = $( target ).data( 'list-count' )
				,	name = $( target ).data( 'name' )
				,	categoryBox = '.selected-category'
				,	categoryCount = '.total-lists'
				,	info = '.category-info h3'
				,	pageInfo = '.curation-wrapper .page-info';


				// Hide page info
				$( pageInfo ).hide();

				// Show info
				$( info ).show();

				// Show loading animation
				utilities.alert( 'Working...', null, function() { }, 5000 );

				// Store cat name
				model.set( 'category_name', slug )
					.getLists( 'get_lists' );

				// Show category details on lists
				$( categoryBox ).html( name );
				$( categoryCount ).html( count );
				$( '.curation-wrapper' ).addClass( 'disabled' );

			}

			// Show all the items in a list
		,	showListItems: function( e ) {
				e.preventDefault();

				var target = e.currentTarget
				,	listId = $( target ).data( 'id' )
				,	loaded = $( target ).data( 'loaded' )
				,	itemsGroup = '.group-items';


				if ( loaded ) {

					utilities.alert( 'Working...', '' , null, 200 );
					$( '.list-' + listId ).find( itemsGroup ).remove();
					// Add "loaded" attribute to
					$( target ).data( 'loaded', false );
					return;

				}

				utilities.alert( 'Working...', '' , null, 600 );
				// Add "loaded" attribute to
				$( target ).data( 'loaded', true );


				// Get list items
				model.set( 'list_id', listId )
					.getListItems( 'get_list_items' );

				$( '.list-' + listId ).addClass( 'disabled' );

			}


			// Make a post sticky
		,	stickPost: function( e ) {
				e.preventDefault();

				var target = e.currentTarget
				,	postId = $( target ).data( 'post-id' );

				$( target ).toggleClass( 'sticky' );

				// Make post sticky
				model.set( 'post_id', postId )
					.stickPost( 'stick_post' );

			}

			// Reject a post
		,	removePost: function( e ) {
				e.preventDefault();

				var target = e.currentTarget
				,	postId = $( target ).data( 'post-id' );

				// Curate post
				model.set({
						item_id: postId
					,	item_type: 'post'
					,	decision: 'reject'
					,	request_type: 'curate'
				}).curate( 'reject_post' );

			}

			// Accept post
		,	acceptPost: function( e ) {
				e.preventDefault();

				var target = e.currentTarget
				,	postId = $( target ).data( 'post-id' );

				// Curate post
				model.set({
						item_id: postId
					,	item_type: 'post'
					,	decision: 'accept'
					,	request_type: 'curate'
				})
				.curate( 'accept_post' );

			}

			// Like Post
		,	likePost: function( e ) {
				e.preventDefault();

				var target  = e.currentTarget
				,	postId = $( target ).data( 'post-id' )
				,	vsTarget = $( target ).parent().find( '.group-dislike')
				,	likeStatus;

				$( target ).toggleClass( 'sticky' );
				$( vsTarget ).removeClass( 'sticky' );

				( $( target ).hasClass( 'sticky' ) ) ? likeStatus = 'true' : likeStatus = 'false';

				// Like on post
				model.set({
						post_id: postId
					,	like_status : likeStatus
					, 	curator_like : 'true'
				})
				.likePost( 'like_post' );
			}

			// dislike Post
		,	dislikePost: function( e ) {
				e.preventDefault();

				var target = e.currentTarget
				,	postId = $( target ).data( 'post-id' )
				,	vsTarget = $( target ).parent().find( '.group-like')
				,	likeStatus;

				$( target ).toggleClass( 'sticky' );
				$( vsTarget ).removeClass( 'sticky' );

				( $( target ).hasClass( 'sticky' ) ) ? likeStatus = 'true' : likeStatus = 'false';

				// Like on post
				model.set({
						post_id: postId
					,	like_status : likeStatus
					,	curator_like : 'false'
				})
				.likePost( 'dislike_post' );
			}

		,	setItemPositionInList: function ( e ) {

				e.preventDefault();

				var target = e.currentTarget
				,	listId = window.Constants.LIST_ID
				,	itemToMove = $( target ).attr( 'data-id' )
				,	positionToMove = $( target ).parent().find( '.setin' ).val()
				,	newPositions = [];

				// console.log( listId, itemToMove, positionToMove );

				$( '.list-box-large' ).each( function() {

					id = $( this ).data( 'id' );
					newPositions.push( id );

				});

				retrieveId = _.indexOf( newPositions, parseInt( itemToMove ) );

				// console.log( newPositions, retrieveId, itemToMove );

				utilities.arrayMove( newPositions, retrieveId, positionToMove - 1 );

				// console.log( newPositions ); return;


				// Sort list items
				model.set( 'list_id', listId );
				model.set( 'items_order', newPositions )
					.sortListItems( 'sort_list_items' );

			}

	});

	// Global Exposition
	window.Bppl.Handlers.Curation = new Curation();



})( this.jQuery, this, this.document, this.Bppl.Views.Curation, this.Bppl.Controllers.Curation, this.Bppl.Models.Curation, this.Bppl.Helpers.Utilities, undefined );


/**
*
* Handler Edition
*/
( function( $, window, document, view, model, controller, utilities ) {

	var Edition = Gillie.Handler.extend({

			// Initialize
			initialize: function() {

				// Turn the edition action button fixed when the top
				// of the screen is reached
				// this.handleScroll();

			}

			// Events
		,	events: {
					'click a[data-action="edition.edit"]': 'editSingleContent'
				,	'click a[data-action="edition.save"]': 'updateSingleContent'
				,	'click a[data-action="edition.cancel"]': 'cancelEdition'
				,	'click a[data-action="edition.update"]': 'modalUpdateContent'
				,	'submit form[data-action="edition.update-post-create-account"]': 'updateAndCreateAccount'
				,	'keyup form[data-action="edition.update-post-create-account"] input[name="editor-username"]': 'validateUsername'
				,	'keyup form[data-action="edition.update-post-create-account"] input[name="editor-email"]': 'validateUserEmail'

			}

			// Make the post content editable using "contenteditable"
		,	editSingleContent: function( e ) {

				e.preventDefault();
				var content  = '.post-content .post-content-text'
				,	actions = '.post-content-wrapper .content-edition-actions'
				,	target = e.currentTarget;

				$( content ).attr( 'contenteditable', '' )
					.addClass( 'editable' ).focus();

				$( actions ).fadeIn();
				$( target ).fadeOut();

			}

			// Update
		,	updateSingleContent: function( e ) {
				e.preventDefault();

				var target = e.currentTarget
				,	contentSel = '.post-content .post-content-text'
				,	content, post, html
				,	postId = $( target ).data( 'post-id' )
				,	editorName = $( target ).data( 'editor-name' );


				if ( $( target ).hasClass( 'disabled' ) ) {
					return;
				}

				if ( $( '.post-content-text' ).length < 1 )
					contentSel = '.edit-me .froala-element.f-basic';

				$( target ).text( 'Working..' )
					.addClass( 'disabled' );

				// Get content
				content = $( contentSel ).html();

				// post = {
				model.set({
						content: content
					,	ID: postId
					,	ref:  'builder'
					,	post_status: 'publish'
					,	editor_name: editorName
				});


				// Handle not logged in user
				if ( $( target ).hasClass( 'not-logged-in' ) ) {

					// Get popover HTML
					html = utilities.render( 'guest-editor-update-popover', model.toJSON() );

					// Open popover
					$( target ).popover({
							placement: 'bottom'
						,	html: true
						,	title: 'Hi, ' + utilities.words( editorName, 1, '' ) + ', create an account to edit this post later'
						,	content: html
					}).popover( 'show' );
					console.log( 'not-logged-in' );
				}


				else {
					model.save( 'post.update' );
				}


			}

			// Cancel edition
		,	cancelEdition: function( e ) {
				e.preventDefault();

				var editBtn = 'a[data-action="edition.edit"]'
				,	content  = '.post-content .post-content-text'
				,	actions = '.post-content-wrapper .content-edition-actions';

				$( editBtn ).fadeIn();
				$( content ).removeClass( 'editable' )
					.removeAttr( 'contenteditable' );

				$( actions ).fadeOut();

			}

			// Turn edition action button fixed
		,	handleScroll: function() {

				el = '.content-edition-actions .group-container';
				utilities.turnFixed( 50, null, 603, el );
			}

			// Update content with click from the modal
		,	modalUpdateContent: function( e ) {
				e.preventDefault();

				var target = e.currentTarget;

				// Add loading text
				$( target ).attr( 'data-original-text', $( target ).text() )
					.addClass( 'disabled' ).text( 'Working...' );

				// Save model data
				model.save( 'post.update' );
			}

			// Update content and assign the actual post to
			// the newly created used
		,	updateAndCreateAccount: function( e ) {
				e.preventDefault();

				var target = e.currentTarget
				,	data = utilities.getFormData( target )
				,	submitBtn = $( target ).find( 'input[type="submit"]' );


				if ( ! model.get( 'valid_email' ) || ! model.get( 'valid_username' ) ) {
					return utilities.alert( 'Oops, use the suggested email and username formats.'
						, null, null, 7000
					);
				}

				// BUG: `addClass` is not working
				submitBtn.addClass( 'disabled' ).attr( 'data-original-text', $( submitBtn ).val() )
					.val( 'Working...' );

				// TODO: Check whether the user fields are correct

				// Set attributes
				model.set( data )
					.createUserUpdatePost( 'post.create_user_update_post' );

			}

			// Check whether the inserted username is longer than 4 characters
		,	validateUsername: function( e ) {
				e.preventDefault();

				var target = e.currentTarget
				,	submit = 'form[data-action="edition.update-post-create-account"] input[type="submit"]';

				if ( $( target ).val().length > 4 ) {
					model.set( 'valid_username', true );
				}

				else {

					$( submit ).addClass( 'disabled' );
					model.set( 'valid_username', false );
				}

				if ( model.get( 'valid_username' ) && model.get( 'valid_email' ) ) {
					$( submit ).removeClass( 'disabled' );
				}

			}

			// Check whether user email is a valid one
		,	validateUserEmail: function( e ) {
				e.preventDefault();

				var target = e.currentTarget
				,	submit = 'form[data-action="edition.update-post-create-account"] input[type="submit"]'
				,	val = $( target ).val();


				if ( utilities.isEmail( val ) ) {
					model.set( 'valid_email', true );
				}

				else {
					model.set( 'valid_email', false );
					$( submit ).addClass( 'disabled' );
				}

				if ( model.get( 'valid_username' ) && model.get( 'valid_email' ) ) {
					$( submit ).removeClass( 'disabled' );
				}

			}

	});

	// Global Exposition
	window.Bppl.Handlers.Edition = new Edition();



})( this.jQuery, this, this.document, this.Bppl.Views.Edition, this.Bppl.Models.Edition, this.Bppl.Controllers.Edition, this.Bppl.Helpers.Utilities, undefined );


/**
*
* Handler LinkGenerator
*/
( function( $, window, document, view, model, controller, utilities ) {

	var LinkGenerator = Gillie.Handler.extend({

			// Initialize
			initialize: function() {

			}

			// Events
		,	events: {
				'submit form[role="linkgenerator.generate"]': 'generate'
			}

			// Generate link
		,	generate: function( e ) {
				e.preventDefault();

				var target = e.currentTarget
				,	data = utilities.getFormData( target )
				,	submit = $( target ).find( 'input[type="submit"]' );

				if ( submit.hasClass( 'disabled' ) ) {
					return;
				}

				submit.attr( 'data-original-text', submit.val() )
					.addClass( 'disabled' ).val( 'Working...' );

				// Set data on model and do AJAX request
				model.set( data )
					.generate( 'generate_link' );

			}

	});

	// Global Exposition
	window.Bppl.Handlers.LinkGenerator = new LinkGenerator();



})( this.jQuery, this, this.document, this.Bppl.Views.LinkGenerator, this.Bppl.Models.LinkGenerator, this.Bppl.Controllers.LinkGenerator, this.Bppl.Helpers.Utilities, undefined );


/**
* Handler Search
*/
( function( $, window, document, view, controller, utilities ) {

	var Search = Gillie.Handler.extend({

			// Init
			initialize: function() {

				// Search suggestions
				this.searchSuggestions();

			}

			// Event
		,	events: {
					'submit .search-form[role="autocomplete-search"]': 'searchByName'
				,	'click .autosuggest-label': 'useLabel'
				,	'click .search-icon': 'activeSearchBtn'
				,	'click .search-icon': 'activeSearchBtn'
			}

			// Add autocomplete functionality to search input
		,	searchSuggestions: function() {

				var el = '.search-bar input[role="search-input"]'
				,	cache, matcher, grep, match, _this = this, listMatches, specialTerm;

				// Define alias
				var aliasGroup = {
						'wordpress': [ 'wordpress', 'wp', 'word press', 'wordpres' ]
					,	'photoshop': [ 'psd', 'adobe photoshop', 'photoshop' ]
					,	'jquery': [ 'js', 'javascript', 'jquery', 'java script' ]
					,	'template': [ 'template', 'theme' ]
					,	'nodejs': [ 'nodejs', 'node js' ]
				};


				// Set autocomplete
				$( el ).autocomplete({

						// source: availableTags
						source: function( req, resp ) {

							req.term = req.term.trim();

							// Get JSON cache file just once
							if ( ! cache ) {

								$.ajax({
										type: 'get'
									,	dataType: 'json'
									,	url: window.Constants.JSTemplates + 'autocomplete-cache.json'
									,	async: false
									,	success: function( data ) {
											cache = data;
										}
								});
							}

							// Add the first two lists to matches collection
							//---------------------------

							matcher = new RegExp( $.ui.autocomplete.escapeRegex( req.term ), "i" );

							// Find lists by exact name
							listMatches = $.grep( cache, function( value ) {

								value = value.lable || value.label || value;
								return matcher.test( value );
							});

							// Add the first 2 matches to
							listMatches = listMatches.slice( 0, 2 );

							// Special case of "nodejs"
							// --------------------------
							if ( req.term == 'nodejs' ) {

								matcher = new RegExp( $.ui.autocomplete.escapeRegex( 'node js' ), "i" );

								// Find any 'node js'.
								specialTerm = $.grep( cache, function( value ) {

									value = value.lable || value.label || value;
									return matcher.test( value );
								});

								// Add special term first match to suggestions
								if ( specialTerm[ 0 ] ) listMatches.unshift( specialTerm[ 0 ] );
							}

							//---------------------------



   							// Loop throught aliases
   							var matches = false, grepGroup = [], grep;
       						$.each( aliasGroup, function( base, group ) {

       							var exp, regExp, m, term = '';

       							// E.G: [ 'wordpress', 'wp', 'word press' ]
       							$.each( group, function( k, v ) {

       								exp = '\\b' + v + '\\b';
       								regExp = new RegExp( exp );

       								// There is a match
       								if ( req.term.match( regExp ) ) {
       									matches = true;


       									// E.G: [ 'wordpress', 'wp', 'word press' ]
       									$.each( group, function( key, value ) {

       										// Replace term
	       									term = req.term.replace( regExp, value );

       										// Find words in any order
       										var arrayOfTerms = term.split( " " )
									        ,	term = $.map( arrayOfTerms, function ( tm ) {

									            	return $.ui.autocomplete.escapeRegex( tm );
								        		}).join( '|' );

	       									matcher = new RegExp( '\\b' + term, "i" );

								 			// Grep array
											grep = $.grep( cache, function( value ) {
												value = value.lable || value.label || value;
												return matcher.test( value );
											});

											// Concat group cats
											$.each( grep, function( i, obj ) {

												var jsonString = JSON.stringify( obj );

												// Only add objectes that are not present
												if ( grepGroup.indexOf( jsonString ) == -1 ) {
													grepGroup.push( jsonString );
												}

											});

       									});

       									// Parse JSON encoded group
       									$.each( grepGroup, function( k, v ) {
       										grepGroup[ k ] = JSON.parse( v );
       									});

										// End loop
										return false;

       								}

       							});

       							// End loop if there are matches
       							if ( matches ) {

       								return false;
       							}

       						});

							if ( ! matches ) {

								// Find word in any order
								var term = req.term
								,	arrayOfTerms = term.split( " " )
						        ,	term = $.map( arrayOfTerms, function ( tm ) {

						            	return $.ui.autocomplete.escapeRegex( tm );
					        		}).join( '|' );

								matcher = new RegExp( "\\b" + term, "i" );
								grep = $.grep( cache, function( value ) {

									value = value.lable || value.label || value;
									return matcher.test( value );
								});

								$.each( grep, function( i, obj ) {

									grepGroup.push( obj );
								});

							}

							// JSON
							$.each( grepGroup, function( key, val ) {
								grepGroup[ key ] = JSON.stringify( val );
							});

							// Add elements to "grepGroup" without repeating them
							$.each( listMatches.reverse(), function( k, v ) {

								var string = JSON.stringify( v )
								,	index;

								if ( index = grepGroup.indexOf( string ) != -1 ) {
									delete grepGroup[ index ];
									grepGroup.unshift( string );
								}
							});


							// Remove Duplicates from "grepGroup"
							grepGroup = _.uniq( grepGroup );

							// Decode JSON again
							$.each( grepGroup, function( k, v ) {
								grepGroup[ k ] = JSON.parse( v );
							});


							// Send response
							resp( grepGroup.slice( 0, 15 ) );
							return;

						}

						// Select
					,	select: function( e, item ) {

							// Act as we're toggling a term from filters
							if ( item.item.type == 'category_name' ) {

								if ( window.Constants.IS_POST_SINGLE || jQuery.browser.msie || jQuery.browser.chrome ) {

									window.location = window.Constants.siteURL + item.item.slug;
									return;
								}

								if ( sessionStorage.slug == item.item.slug ) return;

								// Set URL for category
								utilities.updatePath( '/' + item.item.slug );

								// Add loading state
								view.toggleFilterTerm( item.item );
								return;

							}

							var permalink = item.item.permalink;
							window.location = permalink;
						}

						// Whether to delay the suggestions
					,	delay: 0

						// Result messages
					,	messages: {
								noResults: function( amount ) { }
							,	results: function() { }
						}

						// On focus event
					,	focus: function( e, item ) { }

				});
				// }).data( 'ui-autocomplete' )._renderItem = function( ul, item ) {

				// 	// $( '.ui-autocomplete li:first a' ).append( 'asdfg' );
				// 	// $( "<p>Test</p>" ).insertAfter( '.ui-autocomplete li:first a' );
				// 	// $( '.ui-autocomplete li:first a' ).append( 'asdfg' );
				// 	if ( $( ul ).find( 'li:first' ).length > 0 ) {
				// 		var li = '<li><a>' + item.label + '</a></li>';
				// 	} else {
				// 		var li = '<li><a>' + item.label + ' [lolol]</a></li>';
				// 	}

				//     return $( li ).appendTo( ul );
				//     // return $( '<li><a>' + item.label + 'asdfghj</a></li>' ).appendTo( ul );

				// };

			}

			// Highlight the match in the suggested term
		,	highLight: function( item, term ) {

				var matcher = new RegExp( "(" + $.ui.autocomplete.escapeRegex( term ) + ")", "ig" );
  				item.label = item.label.replace( matcher, "<strong>$1</strong>" );
  				return item;
			}


			// Search on autocomplete search
		,	searchByName: function( e ) {

				e.preventDefault();

				var target = e.currentTarget
				,	data = utilities.getFormData( target )
				,	_view = window.Bppl.Views.Builder
				,	model = window.Bppl.Models.HomePostCollection
				,	keywordsTerm;

				data.s = data.s.toLowerCase();

				if( sessionStorage.slug == data.s ) return;

				// Clean URL
				if ( window.Constants.IS_POST_SINGLE || jQuery.browser.msie || jQuery.browser.chrome || jQuery.browser.mozilla ) {

					// Get JSON cache file just once
					if ( ! keywordsTerm ) {

						$.ajax({
								type: 'get'
							,	dataType: 'json'
							,	url: window.Constants.JSTemplates + 'terms-cache.json'
							,	async: false
							,	success: function( data ) {
									keywordsTerm = data;
								}
						});
					}

					if ( keywordsTerm.indexOf( data.s ) != -1 ) {

					  	window.location = window.Constants.siteURL + data.s.replace( / /gi, '-' );
					}
					else {

						window.location = window.Constants.siteURL + 'search/' + encodeURIComponent( data.s );
					}

					return;
				}

				// Verify if statement is category or simple search.
				// Get JSON cache file just once
				if ( ! keywordsTerm ) {

					$.ajax({
							type: 'get'
						,	dataType: 'json'
						,	url: window.Constants.JSTemplates + 'terms-cache.json'
						,	async: false
						,	success: function( data ) {
								keywordsTerm = data;
							}
					});
				}

				if ( keywordsTerm.indexOf( data.s ) != -1 ) {

				  	utilities.updatePath( '/' + data.s );

				  	// Loading view of keyword stats
				  	// Render keyword information
					view.toggleFilterTerm( data.s );

				}
				else {

					window.location = window.Constants.siteURL + 'search/' + encodeURIComponent( data.s );
				}

			}

			// Label for the search form
		,	useLabel: function( e ) {

				e.preventDefault();

				var target = e.currentTarget
				,	keyword = $( target ).data( 'keyword' );

				$( '.search-bar input[role="search-input"]' )
					.val( keyword )
					.trigger( 'focus' )
					.trigger( 'keydown' );
			}

		,	activeSearchBtn: function( e ) {
				e.preventDefault();

				var target = e.currentTarget
				,	searchElement = $( '.search-form[role="autocomplete-search"]' );

				// fast solution for search input, two search in home page
				$( target ).parent().find( 'input' ).submit();
				// $( '.search-form[role="autocomplete-search"]' ).submit();
			}
	});


	// Global Exposition
	window.Bppl.Handlers.Search = new Search();



})( this.jQuery, this, this.document, this.Bppl.Views.Search, this.Bppl.Controllers.Search, this.Bppl.Helpers.Utilities, undefined );


/**
*
* Handler Breadcrumb
*/
( function( $, window, document, view, controller, utilities ) {

	var Breadcrumb = Gillie.Handler.extend({

			initialize: function() {

				History.Adapter.bind( window, 'statechange', this.buildBreadcrumb );
				History.Adapter.bind( window, 'statechange', this.emptyTree );

				this.buildBreadcrumb();

			}

		,	events: {
					'click .breadcrumb-item .dropdown-lightbox ul li a': 'replaceBreadcrumbPath'
			}

		,	buildBreadcrumb: function () {

				//	Get path without using "History"
					routeStripper = /^[#\/]|\s+$/g
				,	path = window.location.pathname.replace( routeStripper, '' )
				,	parts = path.split( '/' )
				,	str = parts[ 0 ]

				,	spKeyword = parts[ 0 ].split( '-' )
				,	spKeySel = '.Home-postshome-filtersbar .select-filters .sublevel .filter-term[data-slug="' + spKeyword[ 0 ] + '"]'
				,	keyword = '.Home-postshome-filtersbar .select-filters .sublevel .filter-term[data-slug="' + str + '"]'

				,	pinboardsCount = $( '.keyword-filters > ul' ).data( 'pinboards' );


				// Reload the History
				if ( str != '' ) {

					// Special cases for super pinboards
					switch ( str ) {
						case 'wordpress-themes':
						case 'wordpress-plugins':
						case 'wordpress-general':

							$( '.pinboard-stats .tree' )

								// Breadcrumb
								.html( '<a href="' + window.Constants.siteURL + spKeyword[ 0 ] + '" class="regular-link">' + utilities.capitalize( spKeyword[ 0 ] ) + '</a> &rsaquo; ' );

							str = str.toLowerCase().replace( /\b[a-z]/g, function( letter ) {
	    						return letter.toUpperCase();
							});

							$( '.category-selected' ).html( str.replace( /-/gi, ' ' ) + ' <span class="icon-remove category-unselected"></span>' ).show();
							$( '.pinboards-count' ).html( ': ' + pinboardsCount + ' Lists ' ).show();
							$( spKeySel ).addClass( 'toggle-color' );

						break;

						default :

							var caret = 'span.icon-caret-down'
							,	a = $( '.breadcrumb-item .dropdown-lightbox ul li a' )
							,	dropdown = '';

							if ( window.Constants.IS_POST_SINGLE ) {
								$( caret ).show().click( function () {

									utilities.closeOnClickOut( '.breadcrumb-item .dropdown-lightbox', null );

									$( '.breadcrumb-item .dropdown-lightbox' ).toggle();

									if( $( '.breadcrumb-item .dropdown-lightbox' ).is( ':visible' ) ) {

										$( '.breadcrumb-item .dropdown-lightbox' ).css( 'opacity', '1' );
									}
									else {
										$( '.breadcrumb-item .dropdown-lightbox' ).css( 'opacity', '0' );
									}
								});

							}

						break;
					}
				}

				else {
					delete sessionStorage.slug;
				}
			}

		,	replaceBreadcrumbPath: function () {

				var target = e.currentTarget
				,	breadcrumbContent = $( target ).html()
				,	tree = $( '.breadcrumb-item .tree' );

				tree.html( breadcrumbContent );
			}

		,	emptyTree: function () {
				// $( '.tree' ).html( '' );
			}

	});

	// Global Exposition
	window.Bppl.Handlers.Breadcrumb = new Breadcrumb();



})( this.jQuery, this, this.document, this.Bppl.Views.Breadcrumb, this.Bppl.Controllers.Breadcrumb, this.Bppl.Helpers.Utilities, undefined );


/**
* Handler: Social
*/
( function( $, window, document, view, model, controller, utilities ) {

	var Social = Gillie.Handler.extend({

			// Init
			initialize: function() {

				// Listen for messages from opened windows
				window.addEventListener( 'message', this.onOpenerMessage );

			}

			// Events
		,	events: {
				// 	'click .LoginRegister-modal .social[role="facebook"]': 'facebook'
				// ,	'click .LoginRegister-modal .social[role="google"]': 'google'
				// ,	'click .LoginRegister-modal .social[role="github"]': 'github'
					'click .social[role="bypeople"]:not( .allowed )': 'bypeople'
				,	'click .submitter-close[data-modal=".LoginRegister-modal"]': 'bypeopleClose'
				,	'click .LoginRegister-modal .social[role="facebook"], .social[role="facebook"]:not( .allowed )': 'facebook'
				,	'click .LoginRegister-modal .social[role="google"], .social[role="google"]:not( .allowed )': 'google'
				,	'click .LoginRegister-modal .social[role="github"], .social[role="github"]:not( .allowed )': 'github'

				// Submission of create password form
				,	'submit .create-password[data-component="social"]': 'createUser'

			}

			// Access to minified login
		,	bypeople: function( e ) {

				e.preventDefault();

				var target = '.LoginRegister-modal';

				utilities.openModal( target );

				$( target ).addClass( 'minified' );
				utilities.closeOnClickOut( target, function() { $( target ).removeClass( 'minified' ); } );

			}

		,	bypeopleClose: function( e ) {

				e.preventDefault();

				var target = '.LoginRegister-modal';

				$( target ).removeClass( 'minified' );

			}

		,	loginType: function( target ) {

				var login_type = $( target ).data( 'login-type' );

				if ( typeof login_type == 'undefined' || login_type == 'normal' ) {
					if ( utilities.isWorking( target ) ) return;
					utilities.startWorking( target );
				} else if ( login_type == 'minified' ) {
					utilities.alert( 'Working...' );
				}

			}

			// Access to email address
		,	facebook: function( e ) {

				e.preventDefault();

				var _utilities = utilities
				,	_target = e.currentTarget
				,	_this = this
				,	_view = view
				,	_model = model
				// ,	fake = {
				// 		email: "blog@webdesignshock.com"
				// 	}
				,	_suggestedLink = $( '.link-suggested.active' ).val()
				,	getActionReferenceData = $( _target ).data();

				// Loading state
				_this.loginType( _target );

				// Open facebook popup
				FB.login( function( resp ) {

					if ( resp.authResponse ) {

						FB.api( '/me', function( resp ) {

							// Make an AJAX request to check whether the user
							// is already registered.

							// Save link value in session storage to use after in facebook login.
							if ( _suggestedLink && _suggestedLink.length > 1 )
								utilities.storageManager( 'session', 'set', 'suggestedLink', _suggestedLink );

							if ( getActionReferenceData )
								utilities.storageManager( 'session', 'set', 'comments', JSON.stringify( getActionReferenceData ) );

							if ( window.Constants.ptmpname == 'photos-single' || window.Constants.ptmpname == 'photos' ) {
								var userData = {};
								// console.log( 'dont allow' );

								userData.email = resp.email;

								window.Bppl.Models.User.loginOrRegisterSocial( userData, function ( data ) {
									// console.log( data.data );return;

									utilities.newCookie( 'bpplconnection', data.data.user.ID, 1, '/' );

									$( '.in-download' ).show();
									// $( '.modal-backdrop' ).trigger( 'click' );
									setTimeout( function () {

	   									utilities.downloadView();
	   									window.location = localStorage.dwnLink;

	   								}, 1000, setTimeout( function() {
	   									window.location.reload();
	   								}, 3500 ));
								});
							}

							else {
								return _model.facebookCheck( 'fb.check' );
							}

						});

					} else {

						$( _target ).removeClass( 'disabled' );
						// Authentication problem or not unauthorized app
						utilities.alert( 'We couldn\'t connect with your Facebook account.' );
						utilities.stopWorking( _target, '<i class="icon-facebook-sign"></i> Facebook' );

						// Use on social login
						delete localStorage.dwnLink;
					}
				}, { scope: 'email' } );

			}


			// Handle social login via google
		,	google: function( e ) {

				e.preventDefault()
				var	_target = e.currentTarget
				,	_suggestedLink = $( '.link-suggested.active' ).val()
				,	getActionReferenceData = $( _target ).data();

				var url = window.Constants.GOOGLE_AUTHORIZE_PAGE;

				// Loading state
				// this.loginType( e.currentTarget );

				// Create temporal cookies
				utilities.newCookie( 'suggestedLink', _suggestedLink, 1, '/' );

				if ( getActionReferenceData && typeof getActionReferenceData === 'object' )
					utilities.newCookie( 'comments', JSON.stringify( getActionReferenceData ), 1, '/' );

				if ( sessionStorage.likeData && typeof JSON.parse( utilities.storageManager( 'session', 'get', 'likeData' ) ) === 'object' )
		 			var _likeData = JSON.parse( utilities.storageManager( 'session', 'get', 'likeData' ) );

				utilities.newCookie( 'likeData', _likeData, 1, '/' );

				// Open window
				return utilities.openWindow( url, 700, 500 );

		 	}

			// Create a user
		,	createUser: function( e ) {

				e.preventDefault();

				var target = e.currentTarget, pass
				,	data = utilities.getFormData( target );

				// Check form state
				if ( utilities.isWorking( target ) ) return;
				utilities.startWorking( target );

				// Set data and create user
				model.set({
						email: data.email
					,	password: data.pass || data.email
					,	password_confirm: data.pass || data.email

				}).createUser( 'create_user' );

			}

			// Called when messages are send from opened windows
		,	onOpenerMessage: function( e ) {

				e.preventDefault();

				var data = e.data
				,	user, modelData
				,	refererAlias = {
							'google.oauth': 'google.check'
						,	'github.oauth': 'github.check'
					}
				,	_suggestedLink = $( '.link-suggested.active' ).val();

				// console.log( data );return;

				if ( _.isEmpty( data ) ) return;

				if ( data.referer != 'google.oauth' && data.referer != 'github.oauth' ) return;

				user = { email: data.user_email };

				modelData = {
						user: user
					, 	exists: data.exists == 'true' ? true : false
					,	valid_email: utilities.isEmail( data.user_email )
					,	referer: data.referer
				};

				// Save link value in session storage to use after in facebook login.
				utilities.storageManager( 'session', 'set', 'suggestedLink', _suggestedLink );

				if ( data.profile_image_url )
					modelData.profile_image_url = data.profile_image_url;

				if ( data.referer )
					modelData.referer = data.referer;

				if ( data.message )
					modelData.message = data.message;

				// Reload the page or open modal
				return model.trigger( refererAlias[ data.referer ], modelData );

		 	}

		 	// Called on GitHub
		,	github: function( e ) {

				e.preventDefault()
				var	_target = e.currentTarget
				,	_suggestedLink = $( '.link-suggested' ).val()
				,	getActionReferenceData = $( _target ).data();

				var url = window.Constants.GITHUB_AUTHORIZE_URL;

				// Loading state
				// this.loginType( e.currentTarget );

				// console.log( getActionReferenceData );return;

				// Create temporal cookies
				utilities.newCookie( 'suggestedLink', _suggestedLink, 1, '/' );

				if ( getActionReferenceData && typeof getActionReferenceData === 'object' )
					utilities.newCookie( 'comments', JSON.stringify( getActionReferenceData ), 1, '/' );

				if ( sessionStorage.likeData && typeof JSON.parse( utilities.storageManager( 'session', 'get', 'likeData' ) ) === 'object' )
		 			var _likeData = JSON.parse( utilities.storageManager( 'session', 'get', 'likeData' ) );

				utilities.newCookie( 'likeData', _likeData, 1, '/' );

				// Open GitHub window
				utilities.openWindow( url );

		 	}
	});

	// Global Exposition
	window.Bppl.Handlers.Social = new Social();


})( this.jQuery, this, this.document, this.Bppl.Views.Social, this.Bppl.Models.Social, this.Bppl.Controllers.Social, this.Bppl.Helpers.Utilities );


/**
*
* Handler Post
*/
( function( $, window, document, view, model, controller, utilities ) {

	var Post = Gillie.Handler.extend({

			initialize: function () {
				this.checkFtImgInAdditionals();
				this.leaveEditor();
				this.inEdition();
				this.translate();
			}

		,	events: {
					'click .post-options .trash-post-button, .editor-opts .trash-post-button, .draft-posts .trash-post-button ': 'trashPost'
				// ,	'click .use-as-feat-img': 'setFeatImg'
				,	'click .use-as-additional-img': 'addAdditionalImg'
				,	'click .use-to-delete-img': 'deleteImg'
				,	'click .bppl-additional-images .remove-this': 'delAdditionalImg'
				,	'click #images_to_feat li .close': 'delAdditionalImgInEditor'
				,	'click .active-post-editor': 'showEditor'
				,	'click .the-post-editor': 'hideEditor'
				,	'click .save-the-post': 'saveThePost'
				,	'click .publish-the-post': 'publishThePost'
				,	'click .republish-the-post': 'republishThePost'
				,	'click .new-post-button': 'newEditorPost'
				,	'keyup .the-post-title': 'setSlug'
				,	'blur .the-post-title': 'setSlugClass'
				,	'blur .the-post-name': 'setSlugInSlug'
				,	'paste .the-post-name': 'setSlugInSlug'
				,	'click .add-new-tag' : 'addTag'
				,	'click .new-label' : 'delTag'
				,	'click .AddToList-list-item' : 'toggleRelatedLists'
				,	'click .remove-this-list' : 'deleteFromRelatedLists'
				,	'click .get-the-data': 'scrappingUrl'
				,	'click .go-to-edit-the-post': 'activeEditorOpt'
				,	'keyup .the-source-link' : 'setGo'
				,	'click .publish-draft-post': 'publishDraftPost'
				,	'click .select-content-type': 'setPostTypeContent'
				,	'click .compact-view': 'compactView'
				,	'click .expand-view': 'expandView'

			}

			// Trash a post
		,	trashPost: function( e ) {
				e.preventDefault();

				var target = e.currentTarget
				,	postId = $( target ).data( 'post-id' );

				if ( ! confirm( 'Are you sure you want to delete this post?' ) )
			        return false;

				// Trash post
				model.set( 'ID', postId )
					.trash();

				// Apply only for drafted post for admin users
				if ( $( target ).hasClass( 'drafted' ) )
					window.Bppl.Handlers.Misc.closeElement( '.draft-' + postId );

				utilities.alert( 'The post has been deleted!', null, null, 2000 );

			}

		,	setFeatImg: function ( e ) {

				e.preventDefault();

				var target = e.currentTarget
				// ,	imgSrc = $( target ).data( 'img_url' )
				,	imgSrc = $( target ).data( 'img_url' )
				,	additionalImages = []
				,	imgToDel = $( '.ft_image' ).attr( 'src' )
				,	postId = ( $( target ).data( 'post-id' ) ) ? $( target ).data( 'post-id' ) : window.Constants.POST_ID
                ,   post = {
                            ID: postId
                        ,   featuredImage: imgSrc
                        ,   tags: [ 'post-revised' ]
                        ,   ref: 'builder'
                    };

                    console.log( post );

                // Reset image
                window.Bppl.Handlers.Bookmarklet.reset_featured_image();

                $( target ).addClass( 'ft_image' );

                // Handling img when feat img is selected

                $( '#images_to_feat img:not( .ft_image )' ).each( function () {
                	additionalImages.push( $( this ).data( 'img-original-src' ) );
                });

                post.additional_images = additionalImages;

                var removeFrom = post.additional_images.indexOf( imgToDel );

                if ( removeFrom != -1 )
                    post.additional_images.splice( removeFrom, 1 );

				// Save Post
                window.Bppl.Models.Bookmarklet.save( post, function( data ) {

                	// Set the img
                	$( '.post-image img' ).attr( 'src', imgSrc );

                    utilities.alert( 'New featured image selected!' );

                    // Enable goto button
					if ( $( '.go-button' ).length < 1 )
                    	$( '.editor-opts' ).append( '<a href="' + window.Constants.siteURL + $( '.the-post-name' ).val() + '" class="go-button btn-view-more btn-view-more-white btn-small disabled" target="_blank"><i class="icon-plus"></i> Go to post</a>' );
                    else
                    	$( '.go-button' ).removeClass( 'disabled' ).attr( 'href', window.Constants.siteURL + $( '.the-post-name' ).val() );
                });
			}

		,	addAdditionalImg: function ( e ) {

				e.preventDefault();

				var target = e.currentTarget
				,	additionalImages = []
				,	imgSrc = $( target ).data( 'img_url' )
				,	postId = $( target ).data( 'post-id' )
				,	imgTemplate = '<img src="' + imgSrc + '" alt="" />'
                ,   post = {
                            ID: postId
                        ,   tags: [ 'post-revised' ]
                        // ,   ref: 'builder'
                    };

                $( '.bppl-additional-images img' ).each( function () {
                	additionalImages.push( $( this ).attr( 'src' ) );
                });

                post.additional_images = additionalImages;

                post.additional_images.push( imgSrc );

				// Save Post
                window.Bppl.Models.Bookmarklet.save( post, function( data ) {

                	$( '.bppl-additional-images' ).prepend( imgTemplate );

                    utilities.alert( 'Post saved!', null, null, 2000 );
                });
			}

		,	deleteImg: function ( e ) {

				e.preventDefault();

				var target = e.currentTarget
				,	imgToDel = $( '#img_url' )
				,	screenShotOpts = $( '.screenshot-options' );

				imgToDel.attr( 'src', '#' ).hide();
				screenShotOpts.hide();

			}

		,	delAdditionalImg: function ( e ) {
				e.preventDefault();

				var target = e.currentTarget
				,	divToDel = $( target ).parent()
				,	imgToDel = $( target ).parent().find( 'img' ).attr( 'src' )
				,	additionalImages = []
				,	postId = $( target ).data( 'post-id' )
                ,   post = {
                            ID: postId
                        ,   tags: [ 'post-revised' ]
                        // ,   ref: 'builder'
                    };

                $( '.bppl-additional-images img' ).each( function () {
                	additionalImages.push( $( this ).attr( 'src' ) );
                });

                post.additional_images = additionalImages;

                var removeFrom = post.additional_images.indexOf( imgToDel );

                if ( removeFrom != -1 )
                    post.additional_images.splice( removeFrom, 1 );

				// Save Post
                window.Bppl.Models.Bookmarklet.save( post, function( data ) {

					divToDel.remove();

                    utilities.alert( 'Post saved!', null, null, 2000 );
                });
			}

		,	delAdditionalImgInEditor: function ( e ) {
				e.preventDefault();

				var target = e.currentTarget
				,	divToDel = $( target ).parent()
				,	imgToDel = $( target ).parent().find( 'img' ).attr( 'src' )
				,	additionalImages = []
				,	postId = $( target ).parent().find( 'img' ).data( 'post-id' )
                ,   post = {
                            ID: postId
                        ,   tags: [ 'post-revised' ]
                        // ,   ref: 'builder'
                    };

                $( '#images_to_feat img:not( .ft_image )' ).each( function () {
                	additionalImages.push( $( this ).data( 'img-original-src' ) );
                });

                post.additional_images = additionalImages;

                // console.log( post );

                var removeFrom = post.additional_images.indexOf( imgToDel );

                if ( removeFrom != -1 )
                    post.additional_images.splice( removeFrom, 1 );

                post.additional_images = _.uniq( post.additional_images );

                // console.log( 'latest:', post );
				// Save Post
                window.Bppl.Models.Bookmarklet.save( post, function( data ) {

					divToDel.remove();

                    utilities.alert( 'Post saved!' );
                });
			}

			// Post editor

		,	showEditor: function ( e ) {

				e.preventDefault();

				$( '.modal-post-editor, .post-editor' ).toggleClass( 'transitioned' );

				if ( jQuery.browser.msie || jQuery.browser.mozilla )
					$( '.post-editor' ).toggleClass( 'ie-moz' );

				// $( '.description-principal, .Home-postshome-filtersbar, .Home-subcontainer, .background-main-menu, .container-1200:not( .post-editor )' ).toggleClass( 'blurred' );

				$( e.currentTarget ).toggleClass( 'active' );

				if ( $( e.currentTarget ).hasClass( 'in-navbar' ) ) {

					$( '.new-post-button' ).trigger( 'click' ).remove();
					// $( '.trash-post-button' ).remove();
				}

				// Stop mousewheel event
				// $( 'html *:not(.overlay-search )' ).bind( 'mousewheel', function() {
			 //        return false;
			 //    });
			}

			// Post editor

		,	hideEditor: function ( e ) {

				e.preventDefault();

				$( '.modal-post-editor, .post-editor' ).toggleClass( 'transitioned' );

				$( '.active-post-editor' ).toggleClass( 'active' );

				if ( jQuery.browser.msie || jQuery.browser.mozilla )
					$( '.post-editor' ).toggleClass( 'ie-moz' );

				// $( '.description-principal, .Home-postshome-filtersbar, .Home-subcontainer, .background-main-menu, .container-1200:not( .post-editor )' ).toggleClass( 'blurred' );

				// Unbind stop mousewheel event
				// $( 'html *:not(.overlay-search )' ).unbind( 'mousewheel' );
			}

			// Check image within additionals
		,	checkFtImgInAdditionals: function() {

				// $( '.bppl-additional-images div:first-child' ).remove();

				// if ( $( '.active-post-editor' ).length == 2 )
					// $( '.active-post-editor.in-navbar' ).remove();
			}

			// Check image within additionals
		,	saveThePost: function( e ) {

				e.preventDefault();

				// Validate
				if ( $( '.the-post-title' ).val() == '' ) {
					utilities.alert( 'The title field is empty' );
					return;
				}

				var target = e.currentTarget
				,	title = $( '.the-post-title' ).val()
				,	slug = utilities.spacesToHyphen( $( '.the-post-name' ).val() )
				,	content = $( '.post-redactor' ).val()
				,	sourceLink = $( '.the-source-link' ).val()
				,	liveDemo = $( '.the-live-demo' ).val()
				,	postID = $( target ).attr( 'data-post-id' )
				,	attachment = $( '.the-free-attachment' ).val()
				,	premiumAttachment = $( '.the-premium-attachment' ).val()
				,	postAuthor = $( '.the-owner' ).attr( 'data-user-dandom-id' )
				,	tags = [ 'post-revised' ]
				,	contentType = $( '.select-content-type.active' ).attr( 'data-type-content' )
				,	repo = $( '.github-repo' ).val()
				,	post = {
	                       	ID: postID
						,	title: title
						,	post_name: slug
						,	post_author: postAuthor
						,	post_status: 'draft'
	                    ,   content: content
	                    ,   external_link: sourceLink
	                    ,   externalLink: sourceLink
	                    ,   detail_link: liveDemo
	                    ,   attachment: attachment
	                    ,   premiumAttachment: premiumAttachment
	                    ,	contentType: contentType
	                    ,   tags: tags
	                    ,	repo: repo
	                    ,	ref: 'builder'
					}

				// Maping the tags for this post
				$( '.tags-editor .label' ).each( function(){
				    tags.push( $( this ).text() );
				});

				// Attach tags to post object
				// post.tags.collection = tags;

				// Refresh post data
				$( '.title.post-title' ).text( title );
				$( '.post-content-text' ).html( content );
				$( '.post-source-button' ).attr( 'href', sourceLink );
				$( '.live-demo a' ).attr( 'href', liveDemo );

				// $( '.bppl-additional-images div:first-child' ).remove();

				// Save Post
                window.Bppl.Models.Bookmarklet.save( post, function( data ) {

                	// Experimental
                	if ( ! $( '.save-the-post' ).hasClass( 'from-new-post-button' ) ) {
                    	utilities.alert( 'The post has been saved as draft' );
                	}

                    //Close the post editor modal
                    if ( $( '.save-the-post' ).hasClass( 'new-post' ) ) {

						// Set val for the new post
						window.Constants.POST_ID = data.data.id;

						// Set post data
                    	$( '.save-the-post, .trash-post-button, .add-to-list-button, .use-as-feat-img, .use-as-additional-img, .publish-the-post' ).attr( 'data-post-id', data.data.id );

                    	// Enable modules
						$( '.attachments-editor, .feat-image-uploader, .trash-post-button, .new-post-button, .list-appears, .capture_area, .the-post-name' ).removeClass( 'disabled' );

                        // Experimental
                        $( '.save-the-post' ).addClass( 'editable-post' ).removeClass( 'new-post from-new-post-button' );

                        // Enable goto button
						if ( $( '.go-button' ).length < 1 )
	                    	$( '.editor-opts' ).append( '<a href="' + window.Constants.siteURL + $( '.the-post-name' ).val() + '" class="go-button btn-view-more btn-view-more-white btn-small disabled" target="_blank"><i class="icon-plus"></i> Go to post</a>' );
	                    else
	                    	$( '.go-button' ).removeClass( 'disabled' ).attr( 'href', window.Constants.siteURL + $( '.the-post-name' ).val() );
                    }
                    else {

                    	// $( '.close-this.the-post-editor' ).trigger( 'click' );

                    	// Enable goto button
						if ( $( '.go-button' ).length < 1 )
	                    	$( '.editor-opts' ).append( '<a href="' + window.Constants.siteURL + $( '.the-post-name' ).val() + '" class="go-button btn-view-more btn-view-more-white btn-small" target="_blank"><i class="icon-plus"></i> Go to post</a>' );
	                    else
	                    	$( '.go-button' ).removeClass( 'disabled' ).attr( 'href', window.Constants.siteURL + $( '.the-post-name' ).val() );

                    }
                });
			}

			// Check image within additionals
		,	publishThePost: function( e ) {

				e.preventDefault();

				// Validate
				if ( $( '.the-post-title' ).val() == '' ) {
					utilities.alert( 'The title field is empty' );
					return;
				}

				var target = e.currentTarget
				,	title = $( '.the-post-title' ).val()
				,	slug = utilities.spacesToHyphen( $( '.the-post-name' ).val() )
				,	content = $( '.post-redactor' ).val()
				,	sourceLink = $( '.the-source-link' ).val()
				,	liveDemo = $( '.the-live-demo' ).val()
				,	postID = $( target ).attr( 'data-post-id' )
				,	attachment = $( '.the-free-attachment' ).val()
				,	premiumAttachment = $( '.the-premium-attachment' ).val()
				,	postAuthor = $( '.the-owner' ).attr( 'data-user-dandom-id' )
				,	contentType = $( '.select-content-type.active' ).attr( 'data-type-content' )
				,	actualState = $( target ).attr( 'data-actual-state' )
				,	curator = $( target ).attr( 'data-curator' )
				,	repo = $( '.github-repo' ).val()
				,	tags = []
				,	post = {
	                       	ID: parseInt( postID )
						,	title: title
						,	post_name: slug
						,	post_author: postAuthor
						,	post_status: 'publish'
						,	actual_state: actualState
						,	curator: curator
	                    ,   content: content
	                    ,   external_link: sourceLink
	                    ,   externalLink: sourceLink
	                    ,   detail_link: liveDemo
	                    ,   attachment: attachment
	                    ,   premiumAttachment: premiumAttachment
	                    ,	contentType: contentType
	                    ,   tags: tags
	                    ,	repo: repo
	                    ,	ref: 'builder'
					}

				// Maping the tags for this post
				$( '.tags-editor .label' ).each( function(){
				    tags.push( $( this ).text() );
				});

				// Attach tags to post object
				// post.tags.collection = tags;

				// Refresh post data
				$( '.title.post-title' ).text( title );
				$( '.post-content-text' ).html( content );
				$( '.post-source-button' ).attr( 'href', sourceLink );
				$( '.live-demo a' ).attr( 'href', liveDemo );

				// $( '.bppl-additional-images div:first-child' ).remove();

				// Save Post
                window.Bppl.Models.Bookmarklet.save( post, function( data ) {

                	// Experimental
                	if ( ! $( '.save-the-post' ).hasClass( 'from-new-post-button' ) ) {
                    	utilities.alert( 'Congratulations, the post has been published!' );
                	}

                    //Close the post editor modal
                    if ( $( '.save-the-post' ).hasClass( 'new-post' ) ) {

						// Set val for the new post
						window.Constants.POST_ID = data.data.id;

						// Set post data
                    	$( '.save-the-post, .trash-post-button, .add-to-list-button, .use-as-feat-img, .use-as-additional-img, .publish-the-post' ).attr( 'data-post-id', data.data.id );

                    	// Enable modules
						$( '.attachments-editor, .feat-image-uploader, .trash-post-button, .new-post-button, .list-appears, .capture_area, .the-post-name' ).removeClass( 'disabled' );

                        // Experimental
                        $( '.save-the-post' ).addClass( 'editable-post' ).removeClass( 'new-post from-new-post-button' );

                        // Enable goto button
						if ( $( '.go-button' ).length < 1 )
	                    	$( '.editor-opts' ).append( '<a href="' + window.Constants.siteURL + $( '.the-post-name' ).val() + '" class="go-button btn-view-more btn-view-more-white btn-small disabled" target="_blank"><i class="icon-plus"></i> Go to post</a>' );
	                    else
	                    	$( '.go-button' ).removeClass( 'disabled' ).attr( 'href', window.Constants.siteURL + $( '.the-post-name' ).val() );
                    }
                    else {

                    	// $( '.close-this.the-post-editor' ).trigger( 'click' );

                    	// Enable goto button
						if ( $( '.go-button' ).length < 1 )
	                    	$( '.editor-opts' ).append( '<a href="' + window.Constants.siteURL + $( '.the-post-name' ).val() + '" class="go-button btn-view-more btn-view-more-white btn-small" target="_blank"><i class="icon-plus"></i> Go to post</a>' );
	                    else
	                    	$( '.go-button' ).removeClass( 'disabled' ).attr( 'href', window.Constants.siteURL + $( '.the-post-name' ).val() );

                    }
                });
			}

			// Check image within additionals
		,	republishThePost: function( e ) {

				e.preventDefault();

				// Validate
				if ( $( '.the-post-title' ).val() == '' ) {
					utilities.alert( 'The title field is empty' );
					return;
				}

				var target = e.currentTarget
				,	title = $( '.the-post-title' ).val()
				,	slug = utilities.spacesToHyphen( $( '.the-post-name' ).val() )
				,	content = $( '.post-redactor' ).val()
				,	sourceLink = $( '.the-source-link' ).val()
				,	liveDemo = $( '.the-live-demo' ).val()
				,	postID = $( target ).attr( 'data-post-id' )
				,	attachment = $( '.the-free-attachment' ).val()
				,	premiumAttachment = $( '.the-premium-attachment' ).val()
				,	postAuthor = $( '.the-owner' ).attr( 'data-user-dandom-id' )
				,	contentType = $( '.select-content-type.active' ).attr( 'data-type-content' )
				,	actualState = $( target ).attr( 'data-actual-state' )
				,	curator = $( target ).attr( 'data-curator' )
				,	repo = $( '.github-repo' ).val()
				,	tags = []
				,	post = {
	                       	ID: parseInt( postID )
						,	title: title
						,	post_name: slug
						,	post_author: postAuthor
						,	post_status: 'publish'
						,	actual_state: actualState
						,	curator: curator
	                    ,   content: content
	                    ,   external_link: sourceLink
	                    ,   externalLink: sourceLink
	                    ,   detail_link: liveDemo
	                    ,   attachment: attachment
	                    ,   premiumAttachment: premiumAttachment
	                    ,	contentType: contentType
	                    ,   tags: tags
	                    ,	repo: repo
	                    ,	republish: true
	                    ,	ref: 'builder'
					}

				// Maping the tags for this post
				$( '.tags-editor .label' ).each( function(){
				    tags.push( $( this ).text() );
				});

				// Attach tags to post object
				// post.tags.collection = tags;

				// Refresh post data
				$( '.title.post-title' ).text( title );
				$( '.post-content-text' ).html( content );
				$( '.post-source-button' ).attr( 'href', sourceLink );
				$( '.live-demo a' ).attr( 'href', liveDemo );

				// $( '.bppl-additional-images div:first-child' ).remove();

				if ( ! confirm( 'This post will be republished at home, are you sure?' ) )
			        return false;

			    console.log( post );

				// Save Post
                window.Bppl.Models.Bookmarklet.save( post, function( data ) {

                	// console.log( data );

                	// Experimental
                	if ( ! $( '.save-the-post' ).hasClass( 'from-new-post-button' ) ) {
                    	utilities.alert( 'Congratulations, the post has been published!' );
                	}

                    //Close the post editor modal
                    if ( $( '.save-the-post' ).hasClass( 'new-post' ) ) {

						// Set val for the new post
						window.Constants.POST_ID = data.data.id;

						// Set post data
                    	$( '.save-the-post, .trash-post-button, .add-to-list-button, .use-as-feat-img, .use-as-additional-img, .publish-the-post' ).attr( 'data-post-id', data.data.id );

                    	// Enable modules
						$( '.attachments-editor, .feat-image-uploader, .trash-post-button, .new-post-button, .list-appears, .capture_area, .the-post-name' ).removeClass( 'disabled' );

                        // Experimental
                        $( '.save-the-post' ).addClass( 'editable-post' ).removeClass( 'new-post from-new-post-button' );

                        // Enable goto button
						if ( $( '.go-button' ).length < 1 )
	                    	$( '.editor-opts' ).append( '<a href="' + window.Constants.siteURL + $( '.the-post-name' ).val() + '" class="go-button btn-view-more btn-view-more-white btn-small disabled" target="_blank"><i class="icon-plus"></i> Go to post</a>' );
	                    else
	                    	$( '.go-button' ).removeClass( 'disabled' ).attr( 'href', window.Constants.siteURL + $( '.the-post-name' ).val() );
                    }
                    else {

                    	// $( '.close-this.the-post-editor' ).trigger( 'click' );

                    	// Enable goto button
						if ( $( '.go-button' ).length < 1 )
	                    	$( '.editor-opts' ).append( '<a href="' + window.Constants.siteURL + $( '.the-post-name' ).val() + '" class="go-button btn-view-more btn-view-more-white btn-small" target="_blank"><i class="icon-plus"></i> Go to post</a>' );
	                    else
	                    	$( '.go-button' ).removeClass( 'disabled' ).attr( 'href', window.Constants.siteURL + $( '.the-post-name' ).val() );

                    }
                });
			}

			// Clean the post editor to create new post
		,	newEditorPost: function ( e ) {

				e.preventDefault();

				// Set val for the new post
				window.Constants.POST_ID = '';

				$( '.save-the-post, .trash-post-button, .add-to-list-button, .use-as-feat-img, .use-as-feat-img, .use-as-additional-img' ).attr( 'data-post-id', '' );
				$( '.save-the-post' ).addClass( 'new-post' ).removeClass( 'disabled' );

				$( '.the-owner' ).text( window.Constants.OWNER );
				$( '.post-editor input, .post-editor text-area, .post-redactor' ).val( '' );

				$( '#images_to_feat, .content-editor div[contenteditable="true"]' ).empty();

				$( '.post-image img' ).attr( 'src', 'http://placehold.it/400x200&text=800x400' );

				$( '.list-appears ul li:not( :last-child ), .post-box-editor.tags-editor, .post-box-editor.categories-editor, .go-button' ).remove();

				$( '.post-box-editor.categories-editor' ).append( '<span class="label">uncategorized</span>' );

				$( '.the-post-title' ).attr( 'placeholder', 'The title' );
				$( '.the-post-name' ).attr( 'placeholder', 'The slug' ).removeClass( 'unavailable the-post-name-edited' );
				$( '.the-source-link' ).attr( 'placeholder', 'Source link' );
				$( '.the-live-demo' ).attr( 'placeholder', 'Live demo link' );
				$( '.attachments-editor, .feat-image-uploader, .trash-post-button, .new-post-button, .list-appears, .capture_area, .the-post-name' ).addClass( 'disabled' );

				// New section of code IMPORTANT for review
				$( '.the-post-title' ).val( 'a' );
				$( '.save-the-post' ).addClass( 'from-new-post-button' ).click();
				$( '.the-post-title' ).val( '' );

			}

			// Set the slug for the new posts
		,	setSlug: function ( e ) {

				e.preventDefault();

				var target = e.currentTarget
				,	saveBtn = $( '.save-the-post' )
				,	editedSlug = $( '.the-post-name-edited' )
				,	slug = utilities.spacesToHyphen( $( target ).val() )
				,	unSlug = utilities.hyphenToSpace( slug );

				if ( saveBtn.hasClass( 'editable-post' ) && editedSlug.length == 0 ) {

					if ( $( '.the-post-name' ).hasClass( 'unavailable' ) )
						return;

					$( '.the-post-name' ).val( slug.toLowerCase() );
				}

			}

			// Set the slug class for slug in the new posts
		,	setSlugClass: function ( e ) {

				e.preventDefault();

				var target = e.currentTarget
				,	saveBtn = $( '.save-the-post' )
				,	postTitle = $( '.the-post-title' ).val()
				,	slug = $( '.the-post-name' )
				,	lowerSlug = utilities.spacesToHyphen( $( '.the-post-name' ).val() ).toLowerCase();

				slug.removeClass( 'disabled' );

				if ( saveBtn.hasClass( 'editable-post' ) ) {

					slug.addClass( 'the-post-name-edited' );

					//check the post-name
					model.check( lowerSlug, function( data ) {

						if ( data.data.status == false ) {
							$( '.the-post-name' ).css( 'color', '#b4cc21' );
							$( '.save-the-post' ).removeClass( 'disabled' );
						}
						else {
							$( '.the-post-name' ).css( 'color', '#f77' );
							$( '.save-the-post' ).addClass( 'disabled' );
						}
	                });
				}

			}

			// Set the slug for the new posts
		,	setSlugInSlug: function ( e ) {

				// e.preventDefault();

				var target = e.currentTarget
				,	slug = utilities.spacesToHyphen( $( target ).val() )
				,	unSlug = utilities.hyphenToSpace( slug )
				,	lowerSlug = utilities.spacesToHyphen( $( '.the-post-name' ).val() ).toLowerCase();

				$( '.the-post-name' ).val( lowerSlug );

				if ( $( '.the-post-title' ).val() == '' || $( '.the-post-title' ).val() != utilities.hyphenToSpace( $( '.the-post-name' ).val() ) )
					$( '.the-post-name' ).addClass( 'unavailable' )


				//check the post-name
				model.check( lowerSlug, function( data ) {

					if ( data.data.status == false ) {
						$( '.the-post-name' ).css( 'color', '#b4cc21' );
						$( '.save-the-post' ).removeClass( 'disabled' );
					}
					else {
						$( '.the-post-name' ).css( 'color', '#f77' );
						// $( '.save-the-post' ).addClass( 'disabled' );
					}
                });


			}

			// Add new tags
		,	addTag: function ( e ) {

				e.preventDefault();

				var target = e.currentTarget
				,	theTag = prompt( 'Insert the new tag.' )
				//reduce multiple places to single space and then split
				,	splittedTags = theTag.replace( /\s{2,}/g, ' ' ).split( ' ' );


				if ( theTag )
					$.each( splittedTags, function( k, v ) {
						$( target ).parent().append( '<span class="label new-label">' + v + '</span>' );
					});

			}

			// Del new tags
		,	delTag: function ( e ) {

				e.preventDefault();

				var target = e.currentTarget;

				$( target ).remove();

			}

			// Related list
		,	toggleRelatedLists: function ( e ) {

				e.preventDefault();

				var target = e.currentTarget
				,	listVal = $( target ).find( '.wrapp-data .AddToList-list-title' ).text()
				,	listId = $( target ).attr( 'id' )
				,	listPostCount = parseInt( $( target ).find( '.wrapp-data .AddToList-items-count' ).text(), 10 ) + 1
				,	template = '<li><a href="'
						+ window.Constants.siteURL + utilities.spacesToHyphen( listVal ).toLowerCase()
						+ '" class="regular-link" data-list-id="' + listId + '">'
						+ listVal + ' - ' + listPostCount
						+ ' posts.</a><span class="remove-this-list">&times;</span></li>'
				,	beforeOf = $( '.post-box-editor.list-appears ul li:last-child' )
				,	listToRemove = $( '.post-box-editor.list-appears ul li a[data-list-id="' + listId + '"]' );

				if ( $( target ).hasClass( 'has-item' ) )
					$( listToRemove ).parent().remove();

				else
					$( template ).insertBefore( beforeOf );

			}

			// Related list
		,	deleteFromRelatedLists: function ( e ) {

				e.preventDefault();

				var target = e.currentTarget
				,	listId = $( target ).parent().find( 'a' ).attr( 'data-list-id' )
				,	postId = window.Constants.POST_ID
				// ,	listToRemove = $( '.AddToList-list-item.has-item[id="' + listId + '"]' )
				,	listToRemove = $( target ).parent()
				,	data = {
							ID: listId
						,	items: [ postId ]
					}
				,	success = function ( data ) {
						window.Bppl.Handlers.Misc.closeElement( target );
					}
				,	error = function ( data ) {
						console.log( 'Something is wrong.', data.responseText );
					};

				// Instance an object and call the method toggle
				model.toggleFromEditorBox( data, success, error );

			}

			// Leave the editor
		,	leaveEditor: function () {
				$( document ).keyup( function ( e ) {
				  	// if ( e.keyCode == 13 ) { $( '.save' ).click(); }     // enter
				  	if ( e.keyCode == 27 ) { // esc key
				  		if ( $( '.active-post-editor' ).hasClass( 'active' ) )
				  			$( '.close-this.the-post-editor' ).click();
				  		else
				  			return;
				  	}
				});
			}

			// Scrapping the web
		,	scrappingUrl: function ( e ) {

				e.preventDefault();

				var target = e.currentTarget
				,	url = $( '.the-source-link' ).val()
				,	response
				,	data = {
						url: url
					}
				,	success = function ( data ) {

						if ( data.data.check != false ) {

							utilities.alert( 'Sorry, the current url exists. <a href="' + data.data.the_post.permalink + '" class="go-to-edit-the-post btn-view-more btn-view-more-blue btn-mini">EDIT</a>' );

							// Change button text to original
							$( target ).removeClass( 'disabled' ).text( 'Get data' );

							return;
						}

						// Assign data form url
						response = data.data.bm;

						// Replace values within the specific inputs
						$( '.the-post-title' ).val( ( response.title ) ? response.title : response.h1 ).trigger( 'keyup' );
						$( '.content-editor div[contenteditable="true"]' ).html( response.paragraph );

						// Save current data
						// $( '.save-the-post' ).trigger( 'click' );
						// screenshot
						$( '.capture_area #byp_txt_screenshot' ).val( url );
						$( '.capture_area #byp_screenshot' ).trigger( 'click' );

						// Change button text to original
						$( target ).removeClass( 'disabled' ).text( 'Get data' );
					}
				,	error = function ( data ) {
						console.log( 'Something is wrong.', data );
					};

				// Change button text
				$( target ).addClass( 'disabled' ).text( 'connecting... ' );

				// Set url link to Go button
				$( '.go-to-data' ).attr( 'href', url );

				model.getDataFromUrl( data, success, error );
			}

			// enable storage option
		,	activeEditorOpt : function ( e ) {

				e.preventDefault();

				var target = e.currentTarget;

				localStorage.boxEditor = 'inEdition';

				window.location = $( target ).attr( 'href' );

			}

			// initialize ditor in edited post
		,	inEdition: function () {

				if ( localStorage.boxEditor ) {

					setTimeout( function() {

						$( '.active-post-editor' ).trigger( 'click' );
					}, 500 );

					delete localStorage.boxEditor;
				}

			}

			// Set the go button
		,	setGo: function ( e ) {

				e.preventDefault();

				// Set url link to Go button
				$( '.go-to-data' ).attr( 'href', $( e.currentTarget ).val() );

			}

			// publish draft post
		,	publishDraftPost: function ( e ) {
				// .publish-post-button
				e.preventDefault();

				var target = e.currentTarget
				,	postID = $( target ).attr( 'data-post-id' )
				,	post = {
	                       	ID: postID
						,	post_status: 'publish'
	                    // ,   tags: { collection: [] }
					}

				// Save Post
                window.Bppl.Models.Bookmarklet.publish( post, function( data ) {

                	utilities.alert( data.data.message );

                	// Apply only for drafted post for admin users
					if ( $( target ).hasClass( 'drafted' ) )
						window.Bppl.Handlers.Misc.closeElement( '.draft-' + postID );
                });
			}

			// setPostTypeContent
		,	setPostTypeContent: function ( e ) {

				e.preventDefault();

				var target = e.currentTarget
				,	contentType = $( target ).attr( 'data-type-content' );

				$( '.select-content-type' ).addClass( 'btn-github' ).removeClass( 'active btn-view-more-blue btn-view-more-red btn-view-more-green' );

				$( target ).addClass( 'active' ).removeClass( 'btn-github' );

				if ( contentType == 'resource' )
					$( target ).addClass( 'btn-github' )

				if ( contentType == 'graphic' || contentType == 'font' )
					$( target ).addClass( 'btn-view-more-blue' )

				if ( contentType == 'snippet' )
					$( target ).addClass( 'btn-view-more-red' )

				if ( contentType == 'theme' )
					$( target ).addClass( 'btn-view-more-green' )

				if ( contentType == 'article' )
					$( target ).addClass( 'btn-view-more-red' )

				// console.log( contentType );

			}

		,	compactView: function ( e ) {

				e.preventDefault();

				var target = e.currentTarget;

				$( '.main-list-post-large, .lbl-content' ).hide();
			}

		,	expandView: function ( e ) {

				e.preventDefault();

				var target = e.currentTarget;

				$( '.main-list-post-large, .lbl-content' ).show();
			}

		,	translate: function () {
				$( '.list-box-large[data-article="yes"]:first' ).appendTo( $( '.list-box-large[data-article="yes"]:first' ).parent() );
			}
	});

	// Global Exposition
	window.Bppl.Handlers.Post = new Post();



})( this.jQuery, this, this.document, this.Bppl.Views.Post, this.Bppl.Models.Post, this.Bppl.Controllers.Post, this.Bppl.Helpers.Utilities, undefined );


/**
* Handler: marketplace
*/
( function( $, window, document, view, controller, utilities ) {

	var marketplace = Gillie.Handler.extend({

		// Bind events
		events: {
				'click .new-product': 'newProduct'
			,	'click .new-photo': 'newPhoto'
			,	'click .new-theme': 'newTheme'
			,	'click .owner-selector': 'ownerSelector'
			,	'click .theme-license-submitter': 'license'
		}

			// Open modal for new marketplace item
		,	newProduct: function ( e ) {

				e.preventDefault();
				utilities.openModal( '.NewProduct-modal' );

			}


			// Open modal for new photo item
		,	newPhoto: function ( e ) {

				e.preventDefault();
				utilities.openModal( '.NewPhoto-modal' );

			}


			// Open modal for new theme item
		,	newTheme: function ( e ) {

				e.preventDefault();
				utilities.openModal( '.NewTheme-modal' );

			}

			// Owner Selector : Active the hidden field if not are the owner
		,	ownerSelector: function ( e ) {
				// e.preventDefault();

				var target = e.currentTarget
				,	val = $( target ).val()
				,	ownName = $( '.owner-name' );

				if ( val != 'yes' )
					ownName.show();
				else
					ownName.hide();

			}

			// License : Make new license type fro the item
		,	license: function ( e ) {
				// e.preventDefault();

				var target = e.currentTarget
				,	val = $( target ).val()
				,	ownName = $( '.other-theme-license' );

				if ( $( target ).is( ':checked' ) ) {
					if( $( target ).val() == 'other' )
						ownName.show();
					else
						ownName.hide();
				}

			}

	});

	// Global Exposition
	window.Bppl.Handlers.marketplace = new marketplace();


})( this.jQuery, this, this.document, this.Bppl.Views.marketplace, this.Bppl.Controllers.marketplace, this.Bppl.Helpers.Utilities );


/**
* Handler: photo
*/
( function( $, window, document, view, controller, model, utilities ) {

	if ( $( '#image-hidden' ).length > 0 ) {
		var context = document.getElementById( 'canvas-obj' ).getContext( '2d' );
		var canvas = new fabric.Canvas( 'canvas-obj' );
	}

	var photo = Gillie.Handler.extend({

		initialize: function() {

				// this.background();

				$.getScript( 'https://cdn.rawgit.com/eligrey/FileSaver.js/master/FileSaver.min.js' ); // only to save image i9n client
				$.getScript( 'https://cdn.rawgit.com/hybridlabsco/JavaScript-Canvas-to-Blob/master/js/canvas-to-blob.min.js' );
				$.getScript( 'https://cdn.rawgit.com/krisk/fuse/master/src/fuse.min.js' );
				$.getScript( 'https://cdn.rawgit.com/paulirish/infinite-scroll/master/jquery.infinitescroll.min.js' );

				// $.getScript( 'http://cdnjs.cloudflare.com/ajax/libs/fabric.js/1.4.0/fabric.min.js' );
				// this.imageLoader();
				this.landingPage();
				this.loadCanvas();
				this.asyncImage();
				this.check();
				// this.shuffle();
				// this.categories();
				// this.runInBackground();

			}

		,	events: {
					'click .popLink' : 'popoverFilters'
				,	'click .filters li': 'selectTheFilter' // fx
				,	'click .download-filter' : 'download'
				,	'click .categories-btn' : 'categories'
				,	'keyup .search, .ui-autocomplete-input' : 'searchElement'
				,	'submit .search-in-photos' : 'searchElements'
				,	'mouseover .results.active li': 'resultsHover'
				,	'click .view-others': 'runInBackground' // txt
				,	'click .filters a': 'downloadImg' // txt
				,	'click .full-size-download': 'enablePremiumDownload'

				// Premium modal
				,	'click [data-premium-pack]': 'showPremiumPack'
				,	'click .btn-container': 'closePremiumPacks'

				// off bypeople modal
				,	'click .add-new-bundle': 'newBundleForm'
				,	'submit #new-photo-bundle': 'bundleActions'
				,	'submit #edit-photo-bundle': 'editBundle'
				,	'click .toggle-selection': 'togglePhotoSelection'
				,	'click .toggle-selection-direct': 'removeBundlePhoto'
				,	'click .remove-selection-direct, .remove-from-bypeople': 'removeBypeoplePhoto'

				,	'click .clear-all': 'cleanStorage'
				,	'keyup .search-bundle': 'bundleFilter'
				// ,	'click .bundle-results .bundle': 'toggleItemInList'
				,	'click .bundle-results .add-to-this-bundle': 'toggleItemInList'
				,	'blur #new-photo-bundle [name="bundle-name"]': 'slugify'
				,	'click .edit-this-bundle': 'editBundleData'
				,	'click .remove-this-bundle': 'removeBundle'
				,	'click .zip-this-bundle': 'createOrUpdateBundle'
				,	'click .to-bundle-selector': 'preventClickSelector'

				,	'click .enable-filter': 'enableFilter'
				,	'click .close-cms-modal': 'closeCms'
				,	'click .open-cms-modal': 'openCms'
				,	'click .open-cms-modal-sidebar': 'triggerCms'
			}

		,	wrapperText: function ( t, canvas, maxW, maxH, justify ) {

			    if (typeof maxH === "undefined") {
			        maxH = 0;
			    }
			    var words = t.text.split(" ");
			    var formatted = '';

			    // This works only with monospace fonts
			    justify = justify || 'left';

			    // clear newlines
			    var sansBreaks = t.text.replace(/(\r\n|\n|\r)/gm, "");
			    // calc line height
			    var lineHeight = new fabric.Text( sansBreaks, {
			        fontFamily: t.fontFamily,
			        fontSize: t.fontSize
			    }).height;

			    // adjust for vertical offset
			    var maxHAdjusted = maxH > 0 ? maxH - lineHeight : 0;
			    var context = canvas.getContext("2d");


			    context.font = t.fontSize + "px " + t.fontFamily;
			    var currentLine = '';
			    var breakLineCount = 0;

			    n = 0;
			    while (n < words.length) {
			        var isNewLine = currentLine == "";
			        var testOverlap = currentLine + ' ' + words[n];

			        // are we over width?
			        var w = context.measureText(testOverlap).width;

			        if (w < maxW) { // if not, keep adding words
			            if (currentLine != '') currentLine += ' ';
			            currentLine += words[n];
			            // formatted += words[n] + ' ';
			        } else {

			            // if this hits, we got a word that need to be hypenated
			            if (isNewLine) {
			                var wordOverlap = "";

			                // test word length until its over maxW
			                for (var i = 0; i < words[n].length; ++i) {

			                    wordOverlap += words[n].charAt(i);
			                    var withHypeh = wordOverlap + "-";

			                    if (context.measureText(withHypeh).width >= maxW) {
			                        // add hyphen when splitting a word
			                        withHypeh = wordOverlap.substr(0, wordOverlap.length - 2) + "-";
			                        // update current word with remainder
			                        words[n] = words[n].substr(wordOverlap.length - 1, words[n].length);
			                        formatted += withHypeh; // add hypenated word
			                        break;
			                    }
			                }
			            }
			            while (justify == 'right' && context.measureText(' ' + currentLine).width < maxW)
			            currentLine = ' ' + currentLine;

			            while (justify == 'center' && context.measureText(' ' + currentLine + ' ').width < maxW)
			            currentLine = ' ' + currentLine + ' ';

			            formatted += currentLine + '\n';
			            breakLineCount++;
			            currentLine = "";

			            continue; // restart cycle
			        }
			        if (maxHAdjusted > 0 && (breakLineCount * lineHeight) > maxHAdjusted) {
			            // add ... at the end indicating text was cutoff
			            formatted = formatted.substr(0, formatted.length - 3) + "...\n";
			            currentLine = "";
			            break;
			        }
			        n++;
			    }

			    if (currentLine != '') {
			        while (justify == 'right' && context.measureText(' ' + currentLine).width < maxW)
			        currentLine = ' ' + currentLine;

			        while (justify == 'center' && context.measureText(' ' + currentLine + ' ').width < maxW)
			        currentLine = ' ' + currentLine + ' ';

			        formatted += currentLine + '\n';
			        breakLineCount++;
			        currentLine = "";
			    }

			    // get rid of empy newline at the end
			    formatted = formatted.substr(0, formatted.length - 1);

			    var ret = new fabric.Text(formatted, { // return new text-wrapped text obj
			        left: t.left,
			        top: t.top,
			        fill: t.fill,
			        fontFamily: t.fontFamily,
			        fontSize: t.fontSize,
			        originX: t.originX,
			        originY: t.originY,
			        angle: t.angle,
			    });
			    return ret;
			}

		,	landingPage: function() {

				// with this method vertically center images
				$( 'img.load' ).lazyload({
		            	effect : 'fadeIn'
		            ,	threshold : 200
		            ,	load : function() {
		            		$( this ).removeClass( 'loadgif' );
							var imageHeight = $( this ).height(),
								outter = ( imageHeight - 254 ) / 2;
							if ( imageHeight > 254 )
								$( this ).css({ 'margin-top' : -outter + 'px' });
		            }
		        });

			}

		,	popoverFilters: function( e ) {
				// e.preventDefault();

				var target = e.currentTarget,
					popoverSelect = $( target ).parent().find( '.popEffects' );

				$( '.popEffects' ).removeClass( 'active' );

				popoverSelect.addClass( 'active' ).slideDown();

				utilities.closeOnClickOut( '.popEffects.active', function(){ $( '.popEffects.active' ).slideUp(); } );

				$( document ).keyup( function( e ) {
		            if ( e.keyCode == 27 )
		                popoverSelect.removeClass( 'active' ).slideUp();
		        });

			}

		,	selectTheFilter: function( e ) {

				var target = e.currentTarget
				,	box = $( target ).parents( '.popEffects' ).parent()
				,	img = box.find( 'img' )
				// ,	url = img.attr( 'src' )
				,	src = box.find( 'canvas' ).attr( 'data-src' )
				,	canvas = box.find( 'canvas' )
				,	canvasId = '#' + canvas.attr( 'id' )
				,	selectEffect = $( target ).attr( 'data-fx' );

				$( '.popEffects.active .filters li' ).removeClass( 'active' );
				$( target ).addClass( 'active' );

				// window.Bppl.Handlers.Photo.selectFilter( '#canvas-obj', src, selectEffect, img );

				// window.Bppl.Handlers.Photos.sayHello( 'hola danjavia' );

				// this.addFx( canvas, selectEffect, function() {
				// 	$( '.canvas-container .imageBox' ).remove();
				// });
				sessionStorage.fx = selectEffect;
				this.addFx( canvas, null, selectEffect, function() {
					$( '.canvas-container .imageBox' ).remove();
				});

			}

		,	selectFilter: function ( canvasId, src, selectEffect, img ) {

				// Photo history
				var history = JSON.parse( utilities.storageManager( 'session', 'get', 'photoHistory' ) );
				var effect = 'this.' + selectEffect + '().render()';

				if ( selectEffect != 'normal' ) {

					console.log( 'views:', canvasId, src, selectEffect, img );

					if ( $( 'span.' + selectEffect ).parent().hasClass( 'active' ) )
						$( 'span.' + selectEffect ).text( 'procesing...' );
					else
						$( 'span.' + selectEffect ).text( selectEffect );

					$( canvasId ).closest( '.list' ).find( '.btn-download' )
						.attr( 'data-fx', $( '.popEffects.active' ).find( '.filters li.instagram-filter.active' ).attr( 'data-fx' ) )
						.attr( 'data-with-filter', true )
						.attr( 'href', '#' )

					console.log( canvasId, src, effect );

					var imageProcessed = Caman( '#canvas-obj',  function () {
						console.log( 'processing' );

						window.Bppl.Handlers.Photo.addImg( canvas );
						this.reloadCanvasData();
						// this.revert( false );
						eval( effect );
						window.Bppl.Handlers.Photo.addText( canvas, 'texto de prueba' );
				 	});
					console.log( 'image:', imageProcessed )
					Caman.Event.listen( imageProcessed, "processStart", function ( job ) {
						console.log( 'processing2', job );
						if ( img )
							img.hide();

						$( canvasId ).removeClass( 'hidden' ).addClass( 'result' );
					});

					Caman.Event.listen( imageProcessed, "processComplete", function ( job ) {

						console.log( 'image in process' );
					});

					Caman.Event.listen( imageProcessed, "renderFinished", function ( job ) {
						console.log( 'finished processs' );
						if ( img )
							img.hide();

						$( canvasId ).removeClass( 'hidden' ).addClass( 'result' );
						$( 'span.' + selectEffect ).text( selectEffect );

						// Update history
						history.effect = selectEffect;
						history.success = true;
						utilities.storageManager( 'session', 'set', 'photoHistory', history );

						// window.Bppl.Handlers.Photo.addText( canvas );
					});


				} else {
					$( canvasId ).removeClass( 'result' );
					if ( img )
						img.show();
				};

			}

		,	download: function ( e ) {

				e.preventDefault();

				var target = e.currentTarget,
				popoverSelect = $( target ).parent().find( '.popDownload' );

				// $( '.popEffects' ).removeClass( 'active' ).slideUp();

				popoverSelect.addClass( 'active' ).show();

				utilities.closeOnClickOut( '.popDownload.active', function(){ $( '.popDownload.active' ).hide(); } );

				$( document ).keyup( function( e ) {
		            if ( e.keyCode == 27 )
		                popoverSelect.removeClass( 'active' ).hide();
		        });
			}

		,	categories: function ( e ) {

				var target = e.currentTarget
				,	dropdown = $( target ).parent().find( '.categories-select' )
				,	select = dropdown.find( 'select' )
				,	option = select.find( 'option' )
				,	imageId = select.attr( 'data-imgid' )
				,	categories 	= [];

				option.each( function() {
					if ( $( this ).hasClass( 'active' ) )
						categories.push( $( this ).val() );
				});

				( dropdown.hasClass( 'hide' ) ) ? dropdown.removeClass( 'hide' ) : dropdown.addClass( 'hide' );

				option.click( function( e ) {

					// e.preventDefault();

					if ( $( this ).hasClass( 'active' ) ) {
						$( this ).removeClass( 'active' );
						var this_v = $( this ).val();
						$.each( categories, function( k, v ) {
							if ( v !== this_v ) {
								retrieve = _.indexOf( categories, this_v );
								// Chk if the post exits in the array
								if ( retrieve > -1 )
									categories.splice( retrieve, 1 );
							}
						});
					} else {
						categories.push( $( this ).val() );
						$( this ).addClass( 'active' );
					}

			       	console.log( '=======================================' );
				    console.log( 'Image ' + imageId + ' categories : ' + categories )

				});

				// utilities.closeOnClickOut( '.categories-select', function(){ dropdown.addClass( 'hide' ); } );

				// $( document ).keyup( function( e ) {
				// 	if ( e.keyCode == 27 )
				// 		dropdown.addClass( 'hide' );
				// });

			}

		,	sayHello: function ( whatever ) {
				console.log( whatever );
			}

			// Search engine
        ,   enableSearchEngine: function ( query, search ) {

                var images = JSON.parse( localStorage.api )
                ,	post = {}
                ,	results = $( '.results' )
                ,	template
                ,	img
                ,   options = {
	                		caseSensitive: false
						,	includeScore: false
						,	shouldSort: true
						,	threshold: 0.6
						,	location: 0
						,	distance: 25
						,	maxPatternLength: 32
						,	keys: [ 'image_title' ]
                    }

                ,   f = new Fuse( images, options )
                ,   result = f.search( query );

                if ( search ) {

           //      	post.results = result;

	        		// window.Bppl.Models.Photo.save( post, function( data ) {

	        		// 	console.log( data.data.message );

	        		// });

                	return;
                }

                else {

                	var count = 0;

	                $.each( result, function ( k, v ) {

	                	if ( count >= 10 ) return false;

	                	img = v.image_ref.split( '/' )[ 2 ]; // basename de la imagen

	                	template = '<li><a href="/' + v.image_slug + '/">' +
	                		'<div class="image"><img src="http://photos.bypeople.com/bppl_image/208/' + img + '"></div>' +
	                		'<div class="data">' +
	                			'<strong> ' + v.image_title + '</strong>' +
	                			'<small> Tags: [ ' + v.tags.slice( 0, 7 ) + ' ] </small>' +
	                		'</div>' +
	                	'</a></li>';

	                	results.append( template );

	                	count++;
	                });
                }



            }

            // Single search
        ,	searchElement: function ( e ) {

        		var target = e.currentTarget
        		,	results = $( '.results' )
        		,	value = $( target ).val();

        		$( '.ui-autocomplete-input' ).removeClass( 'active' );
        		$( target ).addClass( 'active' );

                results.addClass( 'active' );

                if ( $( '.ui-autocomplete-input.active' ).val().length == 0 )
                	results.removeClass( 'active' );

				results.find( 'li' ).remove();

        		this.enableSearchEngine( value );

        		utilities.closeOnClickOut( '.results', function(){ $( '.results' ).removeClass( 'active' ); } );
        	}

        	// Multiple search
        ,	searchElements: function ( e ) {

        		e.preventDefault();

        		var target = e.currentTarget
        		,	results = $( '.results' )
        		,	value = $( '.ui-autocomplete-input.active' ).val();

        		this.enableSearchEngine( value, 's' );

        		window.location.href = '/search/' + value;
        	}

        ,	resultsHover: function ( e ) {

				var target = e.currentTarget;

				$( target ).parent().find( 'li' ).removeClass( 'item-selected' );

				$( target ).addClass( 'item-selected' );
        	}

        ,	background: function () {

        		var images = [
        				'bgphoto1'
        			,	'bgphoto2'
        			,	'bgphoto3'
        			,	'bgphoto4'
        			,	'bgphoto5'
        		];

        		$( '.container-960 .landingBg' ).addClass( images[ Math.floor( ( Math.random() * 4 ) + 1 ) ] );
        	}

        ,	loadCanvas: function () {
        		// e.preventDefault();

        		// var target = e.currentTarget
        		// ,	downloadType = $( target ).attr( 'data-download' );

        		// console.log( downloadType );

        		if ( $( '#image-hidden' ).length > 0 ) {

					// var history = JSON.parse( utilities.storageManager( 'session', 'get', 'photoHistory' ) );
					$( '#canvas-obj' ).css({
							width: 940
						,	height: 627
					});

					var context = document.getElementById( 'canvas-obj' ).getContext( '2d' );

					// var canvas = new fabric.Canvas( 'canvas-obj' );

					// Photo history

					// var imgElement = document.getElementById( 'testable' );
					// var imgInstance = new fabric.Image( imgElement, {
					//   	opacity: 1
					// });

					// canvas.add( imgInstance );
					this.addImg( canvas );
					// fabric.Image.fromURL( $( '#canvas-obj' ).attr( 'data-src' ), function( imgInstance ) {
					//   	canvas.add( imgInstance );
					// });

					$( '#canvas-obj' ).removeClass( 'hidden' );
					$( '#testable' ).addClass( 'hidden' );

					// Initialize history
			        if ( ! sessionStorage.photoHistory ) {

						var history = {
								effect: 'normal'
							,	success: false
							,	text: {
										size: [ 'w', 'h' ]
									,	pos: [ 'x', 'y' ]
									,	txt: 'Text goes here'
									,	color: '#abcdef'
									,	bgColor: '#abcdef'
								}
						};

						utilities.storageManager( 'session', 'set', 'photoHistory', history );
			        }
				}
        	}

        ,	runInBackground: function ( e ) {

        		e.preventDefault();

        		var testable = $( '#testable' );
        		var canvasObj = $( '#canvas-obj' );

        		if ( $( '#image-hidden' ).length > 0 ) {

					this.addFx( canvas, 'nostalgia', function() {
						$( '.canvas-container .imageBox' ).remove();
					});

					$( '#canvas-obj' ).removeClass( 'hidden' );
					$( '#testable' ).addClass( 'hidden' );

        		}
        	}

        ,	addImg: function ( canvas ) {

    //     		var imgElement = document.getElementById( 'testable' );
				// var imgInstance = new fabric.Image( imgElement, {
				//   	opacity: 1
				// }, { crossOrigin: 'anonymous' });

				// canvas.add( imgInstance );

				var img1 = new Image();
                img1.src = $( '#testable' ).attr( 'src' );

                //drawing of the test image - img1
                img1.onload = function () {
                    //draw background image
                    var ctx = document.getElementById( 'canvas-obj' ).getContext( '2d' );
                    ctx.drawImage( img1, 0, 0 );

                };

        	}

        ,	addCustomImg: function ( canvas, e, size, fn ) {

    //     		var imgElement = document.getElementById( 'testable' );
				// var imgInstance = new fabric.Image( imgElement, {
				//   	opacity: 1
				// }, { crossOrigin: 'anonymous' });

				// canvas.add( imgInstance );
				if ( e ) {

					var target = e.currentTarget;

					var img1 = new Image();
	                img1.src = $( target ).find( 'img' ).attr( 'src' );
				}
				else {
					var img1 = new Image();
	                img1.src = $( '.filters a' ).eq( 1 ).attr( 'href' );
	                console.log( 'src', img1.src );
				}

                //drawing of the test image - img1
                img1.onload = function () {
                    //draw background image
                    var cnvs = document.getElementById( 'canvas-obj' );
                    var ctx = cnvs.getContext( '2d' );

                    if ( size ) {

	                    cnvs.width = size.w;
	                    cnvs.height = size.h;
	                    $( '#canvas-obj' ).css({
	                    		width: size.w
	                    	,	height: size.h
	                    });
	                    console.log( size );
	                    // ctx.drawImage( img1, 0, 0, $( '#testable' ).width(), $( '#testable' ).height() );
	                    ctx.drawImage( img1, 0, 0, parseInt( size.w ), parseInt( size.h ) );
                    }

                    if ( fn ) {
                    	fn();
                    }

                };

        	}

        	/**
        	 * [addFx description]
        	 * @param {obj} canvas  [canvas form caman]
        	 * @param {fn} fx      [description]
        	 * @param {obj} size      {w:3, h:5}
        	 * @param { fn } success callback
        	 */
        ,	addFx: function ( canvas, size, fx, success ) {

        		var history = JSON.parse( utilities.storageManager( 'session', 'get', 'photoHistory' ) )
        		,	effect
        		,	loading = '<div class="imageBox"> ' +
							'<span class="centered"> Loading effect.</span>' +
						'</div>'

        		if ( ! success )
					effect = 'this.' + fx + '().render()';

				else
					effect = 'this.' + fx + '().render(' + success + ')';

    //     		var imgElement = document.getElementById( 'testable' );
				// var imgInstance = new fabric.Image( imgElement, {
				//   	opacity: 1
				// });
				// }, { crossOrigin: 'anonymous' });

				// canvas.add( imgInstance );
				console.log( fx );

				if ( fx ) {

					// console.log( 'init' );

					$( '.canvas-container' ).append( loading );

					Caman( '#canvas-obj',  function () {

						// console.log( 'processing' );

						this.revert();

						if ( size ) {

							this.resize({
							    width: parseInt( size.w ),
							    height: parseInt( size.h )
							});

							// $( '#canvas-obj' ).css({
							// 		width: size.w + '!important'
							// 	,	height: size.h
							// });
						}

						if ( fx != 'normal' )
							eval( effect );
						else
							$( '.canvas-container .imageBox' ).remove();

				 	});
				}

				else {
					Caman( '#canvas-obj',  function () {

						// this.revert();
						if ( size ) {

							console.log( 'processing', typeof size, size );

							this.resize({
							    width: parseInt( size.w ),
							    height: parseInt( size.h )
							});

							$( '#canvas-obj' ).css({
									width: size.w + '!important'
								,	height: size.h
							});
						}

						this.render();

						$( '.canvas-container .imageBox' ).remove();

				 	});
				}

				// fabric.Image.fromURL( $( '#canvas-obj' ).attr( 'data-src' ), function( imgInstance ) {
				//   	canvas.add( imgInstance );
				// });

        	}

        ,	addText: function ( canvas, txt ) {

        		var testable = $( '#testable' );
        		var canvasObj = $( '#canvas-obj' );
				// var canvas = new fabric.Canvas( 'canvas-obj' );
        		var history = JSON.parse( utilities.storageManager( 'session', 'get', 'photoHistory' ) );

    //     		var imgElement = document.getElementById( 'testable' );
				// var imgInstance = new fabric.Image( imgElement, {
				//   	opacity: 1
				// });
				// }, { crossOrigin: 'anonymous' });

				// canvas.add( imgInstance );

				// load base 64 image
				canvas.clear().renderAll();
				fabric.Image.fromURL( sessionStorage.canvasState, function( oImg ) {
				  	canvas.add( oImg );
				});

        		var text = new fabric.Text( ( txt ) ? txt : 'hello world lorem ipsum dolor sit amet triad angle met ar lis meta cool, hello world lorem ipsum dolor sit amet', {
						left: 10
					,	top: canvasObj.height() - 90
					,	padding: 20
					,	textAlign: 'right'
					,	fill: 'rgb( 250, 250, 250 )'
				});

				var formatted = window.Bppl.Handlers.Photo.wrapperText( text, canvas, canvasObj.width() - 20, canvasObj.height() - 20, 'right' );
				formatted.top = canvasObj.height() - 90;
				formatted.left = 10;
				formatted.lineHeight = 1;

				var rect = new fabric.Rect({ top: formatted.getTop(), left: 0, width: formatted.getWidth() + 20, height: formatted.getHeight(), fill: 'rgb( 200, 50, 50 )' });

				var group = new fabric.Group( [ rect, formatted ], {
				  		left: 5
				  	,	top: canvasObj.height() - ( rect.getHeight() + 10 )
				});

				canvas.add( group );

				// canvas.renderAll();
				console.log( 'less' );
				// canvas.setActiveObject( group ); ahh
				canvas.bringToFront( group );

				history.text.size = [ ( group.getWidth() * 100 / canvasObj.width() ), ( group.getHeight() * 100 / canvasObj.height() ) ];
				history.text.pos = [ group.getTop(), group.getLeft() ];
				history.text.color = 'rgb( 250, 250, 250 )';
				history.text.bgColor = 'rgb( 200, 50, 50 )';
				console.log( history );
				utilities.storageManager( 'session', 'set', 'photoHistory', history );

        	}

        ,	downloadImg: function ( e ) {

        	}

        ,	asyncImage: function() {
	        	function aload(a){"use strict";a=a||window.document.querySelectorAll("[data-aload]"),void 0===a.length&&(a=[a]);var b,c=0,d=a.length;for(c;d>c;c+=1)b=a[c],b["LINK"!==b.tagName?"src":"href"]=b.getAttribute("data-aload"),b.removeAttribute("data-aload");return a}
	        	window.onload = function () {aload();};
	        }

	    ,	enablePremiumDownload: function ( e ) {

	    		e.preventDefault();
	    		// console.log( 'habeis dado click' );

	    		// $( e.currentTarget ).removeAttr( 'download' );
	    	}

	    ,	showPremiumPack: function ( e ) {
	    		e.preventDefault();

	    		var target = e.currentTarget
	    		,	pack = $( target ).attr( 'data-premium-pack' );

	    		$( '.feats' ).removeClass( 'active' );
	    		$( pack ).addClass( 'active' );
	    	}

	    ,	closePremiumPacks: function ( e ) {
	    		e.preventDefault();

	    		// $( '.feats' ).removeClass( 'active' );
	    	}

	    ,	newBundleForm: function ( e ) {

	    		e.preventDefault();

	    		$( '.form-new-bundle' ).removeAttr( 'style' ).addClass( 'active' );
	    	}

	    ,	bundleActions: function ( e ) {

	    		e.preventDefault();

	    		var target = e.currentTarget
	    		,	bundle = {}
	    		,	data;

	    		data = utilities.getFormData( target );

	    		bundle.name = data.bundle_name;
	    		bundle.slug = data.bundle_slug;
	    		bundle.description = data.bundle_description;
	    		bundle.status = data.bundle_status;
	    		bundle.type = ( data.bundle_type ) ? data.bundle_type : 'batch';
	    		bundle.userId = ( data.bundle_user_id ) ? data.bundle_user_id : 1;
	    		is_guest = ( bundle.type == 'guest' ) ? 'geminis' : 'acuario';

	    		// console.log( bundle );return;

	    		window.Bppl.Models.Photo.saveBundle( bundle, function( data ) {

	    			var bundleId = data.data.bundle_id.$id
	    			,	template = '<li class="bundle" data-id="' + bundleId + '">'
	    					+ '<div class="title add-to-this-bundle" data-id="' + bundleId + '" data-user="' + bundle.userId + '" title="Click for adding the queued elements to this bundle">'
								+ '<h4 class="bundle-title">' + bundle.name + '</h4>'
								+ '<span class="item-count">0 Elements</span>'
							+ '</div>'
							+ '<div class="options">'
								+ '<a href="http://photos.bypeople.com/' + bundle.slug + '/" class="regular-link link-to-bundle" target="_blank" title="View bundle">'
									+ '<div class="bundle-opt"><i class="icon-external-link"></i></div>'
								+ '</a>'
								+ '<div class="bundle-opt edit-this-bundle"'
									+ 'data-id="' + bundleId + '"'
									+ 'data-title="' + bundle.name + '"'
									+ 'data-slug="' + bundle.slug + '"'
									+ 'data-description="' + bundle.description + '"'
									+ 'data-status="' + bundle.status + '"'
									+ 'data-type="' + bundle.type + '"'
									+ 'data-user-id="' + bundle.userId + '" title="Edit this bundle"><i class="icon-edit"></i></div>'
								+ '<div class="bundle-opt remove-this-bundle" data-id="' + bundleId + '" data-user="' + bundle.userId + '" title="Remove this bundle"><i class="icon-remove"></i></div>'
								+ '<div class="bundle-opt zip-this-bundle" data-id="' + bundleId + '" data-p="' + is_guest + '" title="Create zip and download"><i class="icon-download-alt"></i></div>'
							+ '</div>'
							+ '<div class="bundle-opt-dwn zip-this-bundle" data-id="' + bundleId + '" data-p="' + is_guest + '" title="Create zip and download"><i class="icon-download-alt"></i> Download bundle</div>'
						+ '</li>';

        			utilities.alert( data.data.message );

        			$( target ).find( 'input:not( [type="submit"] ), textarea' ).val( '' );

        			$( '.bundle-results' ).prepend( template );

        			if ( is_guest == 'geminis' )
        				$( '.bundle[data-id="' + bundleId + '"] .zip-this-bundle' )
        					.removeClass( 'zip-this-bundle' )
        					.addClass( 'premium-feature' )
        					.attr( 'data-modal', '.modal-photo-download' );

        			if ( $( '.empty-bundle' ).length == 1 ) {
        				$( '.empty-bundle' ).remove();
        			}

        			$( '.form-new-bundle.active .close-this' ).click();

        		});
	    	}

	    ,	editBundle: function ( e ) {

	    		e.preventDefault();

	    		var target = e.currentTarget
	    		,	bundle = {}
	    		,	data;

	    		data = utilities.getFormData( target );
	    		// console.log( data );

	    		bundle.id = data.bundle_id;
	    		bundle.name = data.bundle_name;
	    		bundle.slug = data.bundle_slug;
	    		bundle.description = data.bundle_description;
	    		bundle.status = ( data.bundle_status ) ? data.bundle_status : 2;
	    		bundle.type = ( data.bundle_type ) ? data.bundle_type : 'batch';
	    		bundle.userId = data.bundle_user_id;

	    		// console.log( bundle );return;

	    		window.Bppl.Models.Photo.editBundle( bundle, function( data ) {

	    			// console.log( data.data );

        			utilities.alert( data.data.message );

        			$( '.bundle[data-id="' + data.data.data.id + '"] .bundle-title' ).html( data.data.data.name );
        			$( '.bundle[data-id="' + data.data.data.id + '"] .link-to-bundle' ).attr( 'href', data.data.data.slug + '/' );

        			// $( target ).find( 'input:not( [type="submit"] ), textarea' ).val( '' );

        		});
	    	}

	    ,	removeBundle: function ( e ) {

	    		e.preventDefault();

	    		var target = e.currentTarget
	    		,	id = $( target ).attr( 'data-id' )
	    		,	user = $( target ).attr( 'data-user' )
	    		,	bundle = {};

	    		if ( ! confirm( 'This bundle will be deleted. Are you sure?' ) )
			        return false;

	    		bundle.id = id;
	    		bundle.user = user;

	    		$( '.bundle[data-id="' + bundle.id + '"] .title' ).toggleClass( 'active-remove' );

	    		// console.log( bundle );return;

	    		window.Bppl.Models.Photo.removeBundle( bundle, function( data ) {

	    			// console.log( data.data );
	    			var emptyTemplate = '<li class="empty-bundle">'
							+ '<div class="container">'
								+ '<h4>No bundles yet.</h4>'
								+ '<span class="add-new-bundle"><i class="icon-plus"></i> Create new bundle</span>'
							+ '</div>'
						+ '</li>';

        			utilities.alert( data.data.message );

        			$( '.bundle[data-id="' + data.data.bundle_id + '"]' )
        				.find( '.title.add-to-this-bundle.active-remove' ).removeClass( 'active active-remove' );

        			$( '.bundle[data-id="' + data.data.data.id + '"]' ).remove();

        			if ( $( '.bundle-results .bundle' ).length == 0 ) {
        				$( '.bundle-results' ).append( emptyTemplate );
        			}

        		});
	    	}

	    ,	createOrUpdateBundle: function ( e ) {

	    		e.preventDefault();

	    		var target = e.currentTarget
	    		,	id = $( target ).attr( 'data-id' )
	    		,	isPremium = $( target ).attr( 'data-p' )
	    		,	bundle = {};

	    		if ( ! confirm( 'The bundle will be created. Do you wish to continue?' ) )
			        return false;

	    		bundle.id = id;

	    		$( '.bundle[data-id="' + bundle.id + '"] .title' ).toggleClass( 'active-zip' );

	    		// console.log( bundle );return;

	    		window.Bppl.Models.Photo.zipBundle( bundle, function( data ) {

	    			console.log( data.data );

        			utilities.alert( data.data.message );

					$( '.bundle[data-id="' + data.data.bundle_id + '"]' )
        				.find( '.title.add-to-this-bundle.active-zip' ).removeClass( 'active active-zip' );

        			if ( isPremium == 'acuario' )
        				window.location = data.data.download_zip;

        		});
	    	}

	    ,	togglePhotoSelection: function ( e ) {

	    		e.preventDefault();

	    		var target = e.currentTarget
	    		,	state = $( target ).attr( 'data-state' )
	    		,	id = $( target ).attr( 'data-id' )
	    		,	ids = ( localStorage.photos ) ? JSON.parse( localStorage.photos ) : [];

	    		if ( state == 1 ) {
	    			$( target ).html( '<span class="little">Add to bundle</span> <i class="icon-check-empty"></i>' ).attr( 'data-state', 0 );

	    			utilities.remove( ids, id );
	    		}

				else {
	    			$( target ).html( '<span class="little">Added to bundle</span> <i class="icon-check"></i>' ).attr( 'data-state', 1 );
				}

				$( '.toggle-selection[data-state="1"]' ).each( function ( k, v ) {

	    			ids.push( $( v ).attr( 'data-id' ) );
				});

				ids = _.uniq( ids );

	    		localStorage.photos = JSON.stringify( ids );

	    		if ( JSON.parse( localStorage.photos ).length >= 1 ) {
	    			$( '.photos-cms-modal' ).animate({
	    				right: 0
	    			}, 400 );

					$( '.open-cms-modal' ).hide();

	    		}

	    		else {

	    			$( '.photos-cms-modal' ).animate({
	    				right: -320
	    			}, 400 );

					$( '.open-cms-modal' ).fadeIn( 400 );
	    		}

	    		$( '.img-selected-counter' ).html( ids.length );
	    		// console.log( ids );

	    	}

	    ,	removeBundlePhoto: function ( e ) {

	    		e.preventDefault();

	    		var target = e.currentTarget
	    		,	state = $( target ).attr( 'data-state' )
	    		,	id = $( target ).attr( 'data-id' )
	    		,	bundleId = $( target ).attr( 'data-bundle-id' )
	    		,	bundleData = {}
	    		,	ids = [];

	    		if ( state == 1 ) {

	    			if ( ! confirm( 'The photo will be removed from this bundle. Do you want to proceed? ' ) )
			        	return false;

	    			$( target ).html( '<i class="icon-ellipsis-horizontal"></i>' ).attr( 'data-state', 0 ).attr( 'title', 'loading' )
	    				.addClass( 'toggle-selection' ).removeClass( 'toggle-selection-direct' );

	    			utilities.remove( ids, id );
	    		}

	    		$( '.toggle-selection-direct[data-state="1"]' ).each( function ( k, v ) {

	    			ids.push( $( v ).attr( 'data-id' ) );
				});
				// console.log( ids );

				// Remove Item of Bundle

				ids = _.uniq( ids );

	    		bundleData.bundleId = bundleId;
	    		bundleData._ids = ids;
	    		// bundleData.state = ( $( target ).hasClass( 'active' ) ) ? 1 : 0;
	    		bundleData.state = 2; // set to 2 for m modify status of the individual bundle

	    		// console.log( bundleData );

	    		window.Bppl.Models.Photo.updateBundle( bundleData, function( data ) {

	    			// console.log( data.data );

        			utilities.alert( data.data.message );

        			$( '.list[data-id="' + id + '"]' ).remove();

        		});

	    		return;

	    	}

	    	// Remove image from ByPeople
	    ,	removeBypeoplePhoto: function ( e ) {

	    		e.preventDefault();

	    		var target = e.currentTarget
	    		,	state = $( target ).attr( 'data-state' )
	    		,	id = $( target ).attr( 'data-id' )
	    		,	ids = ( localStorage.photos ) ? JSON.parse( localStorage.photos ) : []
	    		,	imageData = {};

	    		imageData.id = id;
	    		imageData.origin = 'main';

	    		if ( ! confirm( 'The photo will be removed from ByPeople. Do you want to proceed? ' ) )
			        return false;

	    		window.Bppl.Models.Photo.deletePhoto( imageData, function( data ) {

	    			console.log( data.data );

        			utilities.alert( data.data.message );

        		});

	    		return;

				// else {
	   //  			$( target ).html( '<i class="icon-check"></i>' ).attr( 'data-state', 1 );
				// }

				$( '.toggle-selection[data-state="1"]' ).each( function ( k, v ) {

	    			ids.push( $( v ).attr( 'data-id' ) );
				});

				ids = _.uniq( ids );

	    		localStorage.photos = JSON.stringify( ids );

	    		if ( JSON.parse( localStorage.photos ).length >= 1 )
	    			$( '.photos-cms-modal' ).animate({
	    				right: -320
	    			}, 400 );

	    		else
	    			$( '.photos-cms-modal' ).animate({
	    				right: -320
	    			}, 400 );

	    		$( '.img-selected-counter' ).html( ids.length );
	    		// console.log( ids ); vale amor

	    	}

	    ,	check: function () {

	    		if ( ! localStorage.photos ) return;

	    		var ids = JSON.parse( localStorage.photos );

	    		if ( ids.length >= 1 ) {

	    			$.each( ids, function( k, v ) {
	    				$( '.toggle-selection[data-id="' + v + '"]' ).attr( 'data-state', 1 ).html( '<span class="little">Added to bundle</span> <i class="icon-check"></i>' );
	    			});

	    			$( '.photos-cms-modal' ).animate({
	    				right: 0
	    			}, 400 );

					$( '.open-cms-modal' ).hide();
	    		}

	    		else
	    			$( '.photos-cms-modal' ).animate({
	    				right: -320
	    			}, 400 );

	    		$( '.img-selected-counter' ).html( ids.length );
	    	}

	    ,	cleanStorage: function ( e ) {

	    		e.preventDefault();

	    		delete localStorage.photos;

	    		$( '.img-selected-counter' ).html( 0 );

	    		$( '.bundle-results .bundle' ).removeClass( 'active' );

	    		$( '.toggle-selection[data-state="1"]' )
	    			.html( '<span class="little">Add to bundle</span> <i class="icon-check-empty"></i>' )
	    			.attr( 'data-state', 0 );

	    		$( '.photos-cms-modal' ).animate({
    				right: -320
    			}, 400 );

    			$( '.open-cms-modal' ).fadeIn( 400 );
	    	}

	    ,	bundleFilter: function ( e ) {

	    		var target = e.currentTarget
				,	term = $( target ).val();

				var elements = ".bundle-results"
				,	items = ".bundle"
				,	titleSel = ".bundle-title"
				,	title
				,	reg;

				// Get names
				$( elements ).find( items ).each( function( key, val ) {

					title = $( this ).find( titleSel ).text();

					reg = new RegExp( term, "i" );

					if ( ! reg.test( title ) ) {
						$( this ).hide();
					}
					else {
						$( this ).show();
					}
				});
	    	}

	    ,	toggleItemInList : function ( e ) {

	    		e.preventDefault();

	    		var target = e.currentTarget
	    		,	bundleId = $( target ).attr( 'data-id' )
	    		,	user = $( target ).attr( 'data-user' )
	    		,	bundleData = {};

	    		if ( ! $( target ).hasClass( 'active' ) )

	    			if ( ! confirm( JSON.parse( localStorage.photos ).length + ' photos will be added to ' + $( target ).closest( '.bundle' ).find( '.bundle-title' ).text() + '. Do you want to proceed? ' ) )
			        	return false;

	    		$( target ).toggleClass( 'active' );

	    		bundleData.bundleId = bundleId;
	    		bundleData._ids = JSON.parse( localStorage.photos );
	    		// bundleData.state = ( $( target ).hasClass( 'active' ) ) ? 1 : 0;
	    		bundleData.state = 1;
	    		bundleData.user = user;

	    		// Here send data to server for adding itemes to bundles
	    		// console.log( bundleData );

	    		window.Bppl.Models.Photo.updateBundle( bundleData, function( data ) {

	    			// console.log( data.data );

        			utilities.alert( data.data.message );

        			var templateBundleOn = '- <a href="' + data.data.bundleData.slug + '">' + data.data.bundleData.name + ' (' + data.data.updated_images.length + ' photos)</a>';

        			// $( '.bundle-opt[data-id="' + data.data.bundle_id + '"]' ).closest( '.bundle' )
        			$( '.bundle[data-id="' + data.data.bundle_id + '"]' )
        				.find( '.item-count' )
        				.text( data.data.total_items + ' Elements' );

        			$( '.bundle[data-id="' + data.data.bundle_id + '"]' )
        				.find( '.title.add-to-this-bundle.active' ).removeClass( 'active' );

        			// Remove selected items from memory
        			$( '.img-selected-counter' ).html( 0 );

        			$( '.toggle-selection[data-state="1"]' )
		    			.html( '<span class="little">Add to bundle</span> <i class="icon-check-empty"></i>' )
		    			.attr( 'data-state', 0 );

        			delete localStorage.photos;

        			if ( data.data.bundleData.userId == '0' ) {
        				$( '.link-to-bundle, .edit-this-bundle' ).addClass( 'disabled' );
        			}

        			// $.each( data.data.updated_images, function ( k, v ) {

        			// 	$( '.individual-photo[data-id="' + v + '"] .bundled-on' ).append( templateBundleOn );
        			// });

        		});
	    	}

	    ,	slugify: function ( e ) {

	    		var target = e.currentTarget
	    		,	val = utilities.spacesToHyphen( $( target ).val() ).toLowerCase()

	    		$( '[name="bundle-slug"]' ).val( val );
	    	}

	    ,	editBundleData: function ( e ) {

		    	e.preventDefault();

		    	var target = e.currentTarget
		    	,	id = $( target ).attr( 'data-id' )
		    	,	name = $( target ).attr( 'data-title' )
		    	,	slug = $( target ).attr( 'data-slug' )
		    	,	description = $( target ).attr( 'data-description' )
		    	,	state = $( target ).attr( 'data-status' )
		    	,	type = $( target ).attr( 'data-type' )
		    	,	userId = $( target ).attr( 'data-user-id' );

		    	$( '#edit-photo-bundle [name=bundle-name]' ).val( name );
		    	$( '#edit-photo-bundle [name=bundle-slug]' ).val( slug );
		    	$( '#edit-photo-bundle [name=bundle-description]' ).val( description );
		    	$( '#edit-photo-bundle [name=bundle-status]' ).val( state );
		    	$( '#edit-photo-bundle [name=bundle-id]' ).val( id );
		    	$( '#edit-photo-bundle [name=bundle-type]' ).val( type );
		    	$( '#edit-photo-bundle [name=bundle-user-id]' ).val( userId );

		    	$( '.edit-bundle' ).removeAttr( 'style' ).addClass( 'active' );

		    }

		,	preventClickSelector: function ( e ) {

				e.preventDefault();
			}

		,	enableFilter: function ( e ) {

				e.preventDefault();

				$( '.enable-filter, .assign-form' ).toggle();
			}

		,	closeCms: function ( e ) {

				e.preventDefault();

				$( '.photos-cms-modal' ).animate({
    				right: -320
    			}, 400 );

    			$( '.open-cms-modal' ).fadeIn( 400 );
			}

		,	openCms: function ( e ) {

				e.preventDefault();

				$( '.photos-cms-modal' ).animate({
    				right: 0
    			}, 400 );

    			$( '.open-cms-modal' ).hide();
			}

		,	triggerCms: function ( e ) {

				e.preventDefault();

				$( '.open-cms-modal' ).click();
			}
	});

	// Global Exposition
	window.Bppl.Handlers.Photo = new photo();


})( this.jQuery, this, this.document, this.Bppl.Views.photo, this.Bppl.Controllers.photo, this.Bppl.Models.photo, this.Bppl.Helpers.Utilities );


/**
*
* Handler ListManager
*/
( function( $, window, document, view, model, controller, utilities ) {

	var ListManager = Gillie.Handler.extend({

			initialize: function () {

				// JSBlocks code
				!function(a,b){"object"==typeof module&&"object"==typeof module.exports?module.exports=b(a,!0):b(a)}("undefined"!=typeof window?window:this,function(a,b){function c(a,b,d,e,g){if(g!==!1&&(g=!0),a===b)return 0!==a||1/a==1/b;if(null==a||null==b)return a===b;a instanceof l&&(a=a._wrapped),b instanceof l&&(b=b._wrapped);var h=f.call(a);if(h!=f.call(b))return!1;switch(h){case"[object String]":return a==String(b);case"[object Number]":return a!=+a?b!=+b:0===a?1/a==1/b:a==+b;case"[object Date]":case"[object Boolean]":return+a==+b;case"[object RegExp]":return a.source==b.source&&a.global==b.global&&a.multiline==b.multiline&&a.ignoreCase==b.ignoreCase}if("object"!=typeof a||"object"!=typeof b)return!1;for(var i=d.length;i--;)if(d[i]==a)return e[i]==b;var j=a.constructor,k=b.constructor;if(j!==k&&!(l.isFunction(j)&&j instanceof j&&l.isFunction(k)&&k instanceof k)&&"constructor"in a&&"constructor"in b)return!1;d.push(a),e.push(b);var m=0,n=!0;if("[object Array]"==h){if(m=a.length,n=m==b.length)for(;m--&&(n=g?c(a[m],b[m],d,e,g):a[m]===b[m]););}else{for(var o in a)if(l.has(a,o)&&(m++,!(n=l.has(b,o)&&(g?c(a[o],b[o],d,e,g):a[o]===b[o]))))break;if(n){for(o in b)if(l.has(b,o)&&!m--)break;n=!m}}return d.pop(),e.pop(),n}function d(a,b){var c,d,e=this.__Class__;return l.isString(a)?d=e.prototype[a]:(b=a,d=e),this.__Class__=e.prototype.__Class__,c=d.apply(this,b||[]),this.__Class__=e,c}function e(a,b){if(null!=b){var c=a;a=function(a,d,e){return c.call(b,a,d,e)}}return a}var f=Object.prototype.toString,g=Array.prototype.slice,h=Object.prototype.hasOwnProperty,j={},k={},l=function(a){return k.expressionsCreated?0===arguments.length?k.staticExpression:k.createExpression(a):a};l.version="0.3.2",l.core=k,l.extend=function(){var a,b,c,d,e,f,g=arguments[0]||{},h=1,i=arguments.length,j=!1;for("boolean"==typeof g&&(j=g,g=arguments[1]||{},h=2),"object"==typeof g||l.isFunction(g)||(g={});i>h;h++)if(null!=(e=arguments[h]))for(d in e)a=g[d],c=e[d],g!==c&&(j&&c&&(l.isPlainObject(c)||(b=l.isArray(c)))?(b?(b=!1,f=a&&l.isArray(a)?a:[]):f=a&&l.isPlainObject(a)?a:{},g[d]=l.extend(j,f,c)):g[d]=c);return g},l.each=function(a,b,c){if(null!=a){var d=a.length,f=-1,g="number"==typeof d;if(b=e(b,c),g)for(;++f<d&&b(a[f],f,a)!==!1;);else for(f in a)if(b(a[f],f,a)===!1)break}},l.eachRight=function(a,b,c){if(null!=a){var d=a.length,f=a.length,g="number"==typeof d;if(b=e(b,c),g)for(;--f>=0;)b(a[f],f,a);else for(f in a)b(a[f],f,a)}},l.each(["Arguments","Function","String","Number","Date","RegExp"],function(a){l["is"+a]=function(b){return f.call(b)=="[object "+a+"]"}}),l.isArguments(arguments)||(l.isArguments=function(a){return!(!a||!h.call(a,"callee"))}),"function"!=typeof/./&&(l.isFunction=function(a){return!(!a||"function"!=typeof a)}),l.isArray=Array.isArray||function(a){return"[object Array]"==f.call(a)},l.extend(l,{noop:function(){},inherit:function(a,b,c){return(arguments.length<3&&l.isPlainObject(b)||1==arguments.length)&&(c=b,b=a,a=void 0),a?(b.prototype=m(a.prototype),b.prototype.constructor=b,l.extend(b.prototype,c),b.prototype.__Class__=a,b.prototype._super=d):c&&(b.prototype=c),b},type:function(a){return a instanceof Array?"array":"string"==typeof a||a instanceof String?"string":"number"==typeof a||a instanceof Number?"number":a instanceof Date?"date":"[object RegExp]"===f.call(a)?"regexp":null===a?"null":void 0===a?"undefined":l.isFunction(a)?"function":l.isBoolean(a)?"boolean":"object"},is:function(a,b){return arguments.length>1&&l.isFunction(b)?b.prototype.isPrototypeOf(a):l.type(a)==b},has:function(a,b){return!(!a||!h.call(a,b))},hasValue:function(a){return!(null==a||l.isNumber(a)&&isNaN(a))},toString:function(a){var b="";return l.hasValue(a)&&(b=a.toString()),b},unwrap:function(a){return k.expressionsCreated&&k.isExpression(a)?a.value():l.unwrapObservable?l.unwrapObservable(a):a},$unwrap:function(a,b,c){return b=e(b,c),a&&a.jquery?(b&&a.each(function(){b(this)}),a=a[0]):b&&b(a),a},toArray:function(a){if(l.isArguments(a))return g.call(a);if(l.isElements(a)){for(var b=Array(a.length),c=-1,d=a.length;++c<d;)b[c]=a[c];return b}return l.isArray(a)?a:[a]},toUnit:function(a,b){var c=b;return b=b||"px",l.isNaN(parseFloat(a))?a:l.isString(a)&&l.isNaN(parseInt(a.charAt(a.length-1),10))?c?a.replace(/[^0-9]+$/,b):a:a+b},clone:function(a,b){if(null==a)return a;var c,d,e=l.type(a);if("array"==e)return a.slice(0);if("object"==e){c=a.constructor===Object?{}:new a.constructor;for(d in a)c[d]=b?l.clone(a[d],!0):a[d];return c}if("date"==e)return new Date(a.getFullYear(),a.getMonth(),a.getDate(),a.getHours(),a.getMinutes(),a.getSeconds(),a.getMilliseconds());if("string"==e)return a.toString();if("regexp"==e){var f="";return a.global&&(f+="g"),a.ignoreCase&&(f+="i"),a.multiline&&(f+="m"),c=new RegExp(a.source,f),c.lastIndex=a.lastIndex,c}return a},isElements:function(a){var b=!1;if(a&&("undefined"!=typeof HTMLCollection&&(b=a instanceof window.HTMLCollection),"undefined"==typeof NodeList||b||(b=a instanceof NodeList),!b&&l.isString(a.item)))try{a.item(0),b=!0}catch(c){}return b},isElement:function(a){return!(!a||1!==a.nodeType)},isBoolean:function(a){return a===!0||a===!1||"[object Boolean]"==f.call(a)},isObject:function(a){return a===Object(a)},isPlainObject:function(a){var b;if(!a||"object"!=typeof a||"[object Object]"!==f.call(a)||a.nodeType||a.window==a)return!1;try{if(a.constructor&&!h.call(a,"constructor")&&!h.call(a.constructor.prototype,"isPrototypeOf"))return!1}catch(c){return!1}if(j.ownPropertiesAreLast)for(b in a)return h.call(a,b);for(b in a);return void 0===b||h.call(a,b)},isFinite:function(a){return isFinite(a)&&!l.isNaN(parseFloat(a))},isNaN:function(a){return l.isNumber(a)&&a!=+a},isNull:function(a){return null===a},isUndefined:function(a){return void 0===a},nothing:{},access:function(a,b,c){var d,e=0;for(c=arguments.length>2?c:l.nothing,b=b.split("."),d=b[0];d;){if(null==a)return c;a=a[d],d=b[++e]}return a},swap:function(a,b,c){var d=a.length;return b>=0&&c>=0&&d>b&&d>c&&(a[b]=a[c]+(a[c]=a[b],0)),a},move:function(a,b,c){return b!=c&&(c>=b&&c++,a.splice(c,0,a[b]),b>c&&b++,a.splice(b,1)),a},bind:function(a,b){var c,d=function(){},e=g.call(arguments,2);return c=function(){if(!(this instanceof c))return a.apply(b,e.concat(g.call(arguments)));d.prototype=a.prototype;var f=new d,h=a.apply(f,e.concat(g.call(arguments)));return Object(h)===h?h:f}},equals:function(a,b,d){return a=l.unwrap(a),b=l.unwrap(b),c(a,b,[],[],d)}}),l.at=function(a){return{index:a,prototypeIndentification:"__blocks.at__"}},l.first=function(){return l.first},l.last=function(){return l.last};var m=Object.create||function(a){var b=function(){};return b.prototype=a,new b};for(var n in[j])break;j.ownPropertiesAreLast="0"!=n,function(){!function(){function a(a,b){this._value=a,this._computedValue=void 0,b&&(this._parent=b,this._currentResult=l.isBoolean(b._result)?b._result:b._currentResult,this._lastCondition=b._condition||b._lastCondition,this._hasNot=b._hasNot)}function b(a,b,c,d){c=I.parseCallback(c,d)||c;for(var e,f,g={},h=0,i=b.length,j=l.isFunction(c),k=null!=c;i>h;h++)e=b[h],f=k?j?c(e,h,b):e[c]:e,a(g,f,e,b,c);return g}function c(b,e,f,g,h){var i=O.expressions({isRoot:h,name:b,path:e,descriptorName:f||"a",args:(y[f]||{}).args,methods:y,type:g||0,staticMethods:D}),j=new Function(["blocks","blox","expressions","cache","BaseExpression","LoopDescriptors","generateExpression","descriptors","createExpression","PrepareValues","slice","add","NumberExpression"],i)(l,l,Q,P,a,O,c,R,t,I,E,d,n);return h&&(Q[b+"Expression"]=j),j.prototype.forEach=j.prototype.each,j}function d(a,b){if(b.length>0){var c=x.determineIndex(b[0],a.length),d=E.call(b,x.isPosition(b[0])?1:0),e=0;if(c>=a.length)for(;e<d.length;e++)a[c+e]=d[e];else a.splice.apply(a,[c,0].concat(d))}return a}function e(a,b){return d(a,l.flatten(b,!0))}function g(a,b){this.__Class__(a,b)}function h(a,b){for(var c,d=0;d<b.length;d++)c=new RegExp("\\{"+d+"\\}","gm"),a=a.replace(c,b[d]);return a}function j(a,b){this.__Class__(a,b)}function k(a,b){return function(){return a.apply(this,b.concat(E.call(arguments)))}}function m(a,b,c){return b=b||0,setTimeout(function(){return a.apply(null,c)},b)}function n(a,b){this.__Class__(a,b)}function o(a,b){this.__Class__(a,b)}function p(a,b){this.__Class__(a,b)}function q(a){return function(){var b=l.unwrap(this._value||this.data||this);return l[a]?l.unwrap(l[a].apply(b,[b].concat(l.toArray(arguments)))):(b=l(b),b=b[a].apply(b,l.toArray(arguments)),b.result()||b.value())}}function r(){return{indexOrKey:"indexOrKey",length:"length",result:"result",isCollectionAnArray:"isCollectionAnArray",collection:"collection",expression:"expression",value:"value",resultIndex:0,isArrayCheck:'typeof length == "number"',skip:0,take:null,args:[],variables:[],objectBeforeLoops:[],arrayBeforeLoops:[],objectInLoops:[],arrayInLoops:[],objectAfterLoops:[],arrayAfterLoops:[],conditionsEnd:""}}function s(){var a,b={result:"result",inLoop:!0,items:[]},c=0,d=b.items,e=[],f=0;return{callback:function(g){var h=!0;switch(g.name){case"and":d.push(" && ");break;case"or":d.push(" || ");break;case"not":a===!1&&(b.inLoop=!1),a=void 0,d.splice(d.length-1,0,"!"),f++;break;default:h=!1,void 0!==g.boolResult&&(void 0!==a&&a===!0&&(b.inLoop=!1),a=g.boolResult,f++,d.push(b.result+c),g.inLoop=(g.inLoop||"").replace(/(\s|;)(break\s?;)/g,function(a){var b="";return";"==a[0]&&(b=";"),b})),e.push(l.format("var {0}{1};",b.result,c))}return c++,h},end:function(c){void 0!==a&&a===!0&&(b.inLoop=!1),c.conditionsDeclarations=e.join(""),f>1&&(c.conditions=!0,c[(b.inLoop?"inLoop":"afterLoop")+"Conditions"]=O.conditions(b),b.inLoop&&(b.inLoop=!1,c.afterLoopConditions=O.conditions(b)))}}}function t(a){for(var b,c,d=r(),e=a._isSingle,f=a._type,g=e?["array","object"]:[1==a._type?"array":"object"],h=e?"":0,i=[],j=e?void 0:s(),k=0,m=0,n=!1,o="",p=!0;a._parent;)l.each(g,function(c,f){switch("filter"==a._descriptor.identity&&(d.skip&&(o+=O.skip({index:k})),null!==d.take&&(o+=O.take({index:m})),d.skip=0,d.take=null),b=a._descriptor(h,c,a,i,o),o="",0===f&&d.args.push(b.args||[]),b.name){case"skip":return void(d.skip||(d.skip="skip"+h));case"take":return void(null===d.take&&(d.take="take"+h));case"reverse":return void(d.reverse=!d.reverse)}p=!1,(e||!j.callback(b))&&(0===f&&b.reverse&&(d.reverse=!d.reverse),e||(c="array"),void 0!==b.boolResult?d.resultIndex=h||0:h||(n=!0),b.beforeLoop&&d[c+"BeforeLoops"].push(b.beforeLoop),b.inLoop&&d[c+"InLoops"].push(b.inLoop),b.afterLoop&&d[c+"AfterLoops"].push(b.afterLoop))}),"skip"!=b.name&&"take"!=b.name&&"reverse"!=b.name?i.push(a):0==i.length&&(d.resultIndex+=1,"skip"==b.name?k=k||h:m=m||h),h=+h+1,a=a._parent;if(d.isObject=T.prototype.isPrototypeOf(a),e){switch(f){case"array":d.isArrayCheck=!0;break;case"object":d.isArrayCheck=!1}return"object"==typeof module&&"object"==typeof module.exports?(c=new Function(["blocks","collection"].concat(d.args[0]),a._loopDescriptor(d)),function(){return c.apply(this,[l].concat(l.toArray(arguments)))}):new Function(["collection"].concat(d.args[0]),a._loopDescriptor(d))}return j.end(d),p&&(d.arrayBeforeLoops.push(d.result+d.resultIndex+" = [];"),d.arrayInLoops.push(d.result+d.resultIndex+".push("+d.value+");")),n&&(d.resultIndex=0),"object"==typeof module&&"object"==typeof module.exports?(c=new Function(["blocks",d.expression],a._loopDescriptor(d)),function(a){return c(l,a)}):new Function(d.expression,a._loopDescriptor(d))}function u(a){var b={_loopDescriptor:O[a.identity]||O.singleExpression},c={_parent:b,_descriptor:a,_isSingle:!0,_type:a.parent.type};return c}function v(a){var b=Z[a];if(l.isFunction(b)){var c=u(b);if(l[a])return t(c);l[a]=t(c)}}var w=l.at;l.at=function(a){return{index:a,prototypeIndentification:"__blocks.at__"}},l.first=function(){return l.first},l.last=function(){return l.last};var x={isPosition:function(a){return a==l.first||a==l.last||a&&"__blocks.at__"==a.prototypeIndentification},determineIndex:function(a,b){return a==l.first?0:"__blocks.at__"==a.prototypeIndentification?a.index:b}},y={};a.prototype={_prototypeIndentification:"__blocks.expression__",_expression:a,type:function(){return"base"},is:function(a){return this._setResult(l.is(this._value,a)),this},value:function(){return this._value},not:function(){var a=new this._expression(this._value,this);return a._hasNot=!this._hasNot,a},or:function(){var a=new this._expression(this._value,this);return a._condition="or",a},and:function(){var a=new this._expression(this._value,this);return a._condition="and",a},result:function(){return this._not?!this._result:this._result},each:function(){},equals:function(a,b){var c=new this._expression(this._value,this);return c._setResult(l.equals(this._value,a,b)),c},hasValue:function(){return this._resultExpression(l.hasValue(this._value))},toString:function(){return new g(l.toString(this._value))},toArray:function(){return new S(l.toArray(this.value()))},clone:function(a){return l(l.clone(this._value,a))},_setResult:function(a){switch(this._hasNot&&(a=!a),this._lastCondition){case"and":this._result=this._currentResult&&a;break;case"or":this._result=this._currentResult||a;break;default:this._result=a}this._hasNot=!1,this._lastCondition=void 0},_resultExpression:function(a){var b=new this._expression(this._value,this);return b._setResult(a),b}},l.extend(l,{isEmpty:function(a){if(null==a)return!0;if(l.isArray(a)||l.isString(a)||l.isArguments(a))return!a.length;for(var b in a)return l.has(a,b)?!1:!0;return!0}});var z=function(a){return a},A=Object.prototype.hasOwnProperty,B=Math.max,C=Math.ceil;l.extend(l,{range:function(a,b,c){tart=+a||0,c="number"==typeof c?c:+c||1,null==b&&(b=a,a=0);for(var d=-1,e=B(0,C((b-a)/(c||1))),f=Array(e);++d<e;)f[d]=a,a+=c;return f},groupBy:function(a,c,d){return b(function(a,b,c){A.call(a,b)||(a[b]=[]),a[b].push(c)},a,c,d)},countBy:function(a,c,d){return b(function(a,b){A.call(a,b)||(a[b]=0),a[b]++},a,c,d)},sortBy:function(a,b,c){var d,e,f,g,h,j=b?b.length:0;return l.isPlainObject(b)&&(b=[b],j=1),l.isArray(b)?j>0?a.sort(function(a,c){for(i=0;i<j;i++)if(e=b[i],d=e.dir?e.dir.toLowerCase():"asc","none"!=d&&(g=a[e.field],h=c[e.field],g!==h))return f=g>h?1:-1,"desc"==d?-f:f}):a:(b=I.parseCallback(b,c),b||(b=z),l(a).map(function(a,c,d){return{value:a,index:c,criteria:b(a,c,d)}}).sort(function(a,b){if(g=a.criteria,h=b.criteria,g!==h){if(g>h||void 0===g)return 1;if(h>g||void 0===h)return-1}return a.index-b.index}).map("value").value())}});var D={},E=Array.prototype.slice,F={skip:function(){return{name:"skip",args:["skip"]}},take:function(){return{name:"take",args:["take"]}},and:function(){return{name:"and",args:[]}},or:function(){return{name:"or",args:[]}},not:function(){return{name:"not",args:[]}},reverse:function(){return{name:"reverse",args:[]}}};for(var G in F)F[G].identity=G;var H=l.core,I={parseCallback:function(a,b){if("string"==typeof a){var c=a;return function(a){return a[c]}}if(null!=b){var d=a;a=function(a,c,e){return d.call(b,a,c,e)}}return a},uniquePrepare:function(a,b){return l.isFunction(a)?I.parseCallback(a,b):a},mapPrepare:function(a,b){return I.parseCallback(a,b)},filterPrepare:function(a,b){return l.isFunction(a)||l.isString(a)?I.parseCallback(a,b):I.createFilterCallback(a)},reducePrepare:function(a,b,c){return l.isFunction(a)||l.isString(a)?I.parseCallback(a,c):I.parseCallback(a,c)},createFilterCallback:function(a){return function(b){return I.resolveFilterExpressionValue(!1,b,a)}},resolveFilterExpressionValue:function(a,b,c){if(c.field&&c.operator){var d=c.value;switch(b=b[c.field],c.operator.toLowerCase()){case"eq":a=b===d;break;case"neq":a=b!==d;break;case"lt":a=d>b;break;case"lte":a=d>=b;break;case"gt":a=b>d;break;case"gte":a=b>=d;break;case"startswith":a=l(b).startsWith(d);break;case"endswith":a=l(b).endsWith(d);break;case"contains":a=-1!==b.indexOf(d)}return a}if(c.logic&&c.filters){if(a&&"or"==c.logic)return!0;for(var e=!1,f=c.filters.length,g=0;f>g&&(e=I.resolveFilterExpressionValue(!1,b,c.filters[g]),!e||"or"!=c.logic);g++);return e}for(var h in c)if(b[h]!==c[h])return!1;return!0},flatten:function(a,b,c){if(l.isArray(b)||l.isArguments(b))if(a)c.push.apply(c,b);else for(var d=0;d<b.length;d++)I.flatten(a,b[d],c);else c.push(b)}};I.reduceRightPrepare=I.reducePrepare;for(var G in I)H[G]=I[G];var J={contains:function(a){return{boolResult:!1,args:["searchValue"],beforeLoop:"result"+a+"=false;",inLoop:"if (value===searchValue"+a+"){result"+a+"=true;break ;};"}},each:function(a){var b="callback"+a+"=blocks.core.parseCallback(callback"+a+",thisArg"+a+");";return{args:["callback","thisArg"],beforeLoop:""===a?""+b:"",inLoop:"callback"+a+"(value,indexOrKey,collection);",prepareValues:b}},equals:function(a,b){var c="deepEqual"+a+"=deepEqual"+a+"===false?false:true;";return{boolResult:!0,args:["compareValue","deepEqual"],beforeLoop:(""===a?""+c:"")+"var index"+a+"=0;var resultResolved"+a+"=false;var size"+a+"=0;var key"+a+";result"+a+"=true;if (Object.prototype.toString.call(collection)!==Object.prototype.toString.call(compareValue"+a+")){result"+a+"=false;resultResolved"+a+"=true;};if (!resultResolved"+a+"){var aCtor=collection.constructor;var bCtor=compareValue"+a+'.constructor;if (aCtor!==bCtor&&!(blocks.isFunction(aCtor)&&aCtor instanceof aCtor&&blocks.isFunction(bCtor)&&bCtor instanceof bCtor)&&("constructor" in collection&&"constructor" in compareValue'+a+")){result"+a+"=false;resultResolved"+a+"=true;}};",inLoop:("array"==b?"if (!resultResolved"+a+"){if (deepEqual"+a+"?!blocks.equals(value,compareValue"+a+"[size"+a+"],true):value!==compareValue"+a+"[size"+a+"]){result"+a+"=false;break;}size"+a+"+=1;};":"")+("object"==b?"if (!resultResolved"+a+"){if (blocks.has(collection,indexOrKey)){if (!blocks.has(compareValue"+a+",indexOrKey)||(deepEqual"+a+"?!blocks.equals(value,compareValue"+a+"[indexOrKey],true):value!==compareValue"+a+"[indexOrKey])){result"+a+"=false;break;}size"+a+"+=1;}};":""),afterLoop:("array"==b?"if (!compareValue"+a+"||size"+a+"!==compareValue"+a+".length){result"+a+"=false;resultResolved"+a+"=true;};":"")+("object"==b?"if (!resultResolved"+a+"&&result"+a+"){for (key"+a+" in compareValue"+a+"){if (blocks.has(compareValue"+a+",key"+a+")&&!size"+a+"--){break ;}}result"+a+"=!size"+a+";};":""),prepareValues:c}},every:function(a){var b="callback"+a+"=blocks.core.parseCallback(callback"+a+",thisArg"+a+");";return{boolResult:!0,args:["callback","thisArg"],beforeLoop:"result"+a+"=true;"+(""===a?""+b:""),inLoop:"if (callback"+a+"){if (!callback"+a+"(value,indexOrKey,collection)){result"+a+"=false;break ;}}else if (!value){result"+a+"=false;break ;};",prepareValues:b}},filter:function(a,b,c,d,e){var f="callback"+a+"=blocks.core.filterPrepare(callback"+a+",thisArg"+a+");";return{args:["callback","thisArg"],beforeLoop:(""===a?""+f:"")+(""===a||0===d.length?""+("array"==b?"result"+a+"=[];":"")+("object"==b?"result"+a+"={};":""):""),inLoop:"if (!callback"+a+"(value,indexOrKey,collection)){continue ;};"+e+";"+(""===a||0===d.length?""+("array"==b?"result"+a+".push(value);":"")+("object"==b?"result"+a+"[indexOrKey]=value;":""):""),prepareValues:f}},first:function(a){var b="if (callback"+a+"){callback"+a+"=blocks.core.parseCallback(callback"+a+",thisArg"+a+");};";return{args:["callback","thisArg"],beforeLoop:"var isNumber"+a+"=blocks.isNumber(callback"+a+");var size"+a+"=0;var count"+a+"=1;var current"+a+";if (isNumber"+a+"){result"+a+"=[];count"+a+"=callback"+a+";callback"+a+"=thisArg"+a+";};"+(""===a?""+b:""),inLoop:"if (callback"+a+"){if (callback"+a+"(value,indexOrKey,collection)){current"+a+"=value;}else {continue ;}}else {current"+a+"=value;};if (isNumber"+a+"){if (size"+a+"++>=count"+a+"){break ;}result"+a+".push(current"+a+");}else {result"+a+"=current"+a+";break ;};",prepareValues:b,everything:!0}},has:function(a){return{boolResult:!1,args:["key"],beforeLoop:"result"+a+"=false;",afterLoop:"result"+a+"=blocks.has(collection,key"+a+");"}},invoke:function(a,b,c,d){return{args:["method","args"],beforeLoop:"var isFunc"+a+"=blocks.isFunction(method"+a+");"+(""===a||0===d.length?""+("array"==b?"result"+a+"=[];":"")+("object"==b?"result"+a+"={};":""):"")+(""===a?"args"+a+"=Array.prototype.slice.call(arguments,2);":""),inLoop:"value=(isFunc"+a+"?method"+a+":value[method"+a+"]).apply(value,args"+a+"||[]);"+(""===a||0===d.length?""+("array"==b?"result"+a+".push(value);":"")+("object"==b?"result"+a+"[indexOrKey]=value;":""):"")}},isEmpty:function(a){return{boolResult:!0,beforeLoop:"result"+a+"=true;",inLoop:"result"+a+"=false;"}},join:function(a){return{args:["separator"],beforeLoop:"separator"+a+"=typeof separator"+a+'=="undefined"?",":separator'+a+";result"+a+'="";',inLoop:"result"+a+"+=value+separator"+a+";",afterLoop:"result"+a+"=result"+a+".substring(0,result"+a+".length-separator"+a+".length);"}},map:function(a,b,c,d){var e="callback"+a+"=blocks.core.parseCallback(callback"+a+",thisArg"+a+");";return{args:["callback","thisArg"],beforeLoop:(""===a?""+e:"")+(""===a?""+("array"==b?"result"+a+"=Array(collection.length);":"")+("object"==b?"result"+a+"=[];":""):"")+(""!==a&&0===d.length?"result"+a+"=[];":""),inLoop:"value=callback"+a+"(value,indexOrKey,collection);"+(""===a?""+("array"==b?"result"+a+"[indexOrKey]=value;":"")+("object"==b?"result"+a+".push(value);":""):"")+(""!==a&&0===d.length?"result"+a+".push(value);":""),prepareValues:e}},max:function(a){var b="callback"+a+"=blocks.core.parseCallback(callback"+a+",thisArg"+a+");";return{args:["callback","thisArg"],beforeLoop:"var max"+a+"=-Infinity;result"+a+"=max"+a+";"+(""===a?""+b:""),inLoop:"max"+a+"=callback"+a+"?callback"+a+"(value,indexOrKey,collection):value;result"+a+"=max"+a+">result"+a+"?max"+a+":result"+a+";",prepareValues:b,type:"NumberExpression"}},min:function(a){var b="callback"+a+"=blocks.core.parseCallback(callback"+a+",thisArg"+a+");";return{args:["callback","thisArg"],beforeLoop:"var min"+a+"=Infinity;result"+a+"=min"+a+";"+(""===a?""+b:""),inLoop:"min"+a+"=callback"+a+"?callback"+a+"(value,indexOrKey,collection):value;result"+a+"=min"+a+"<result"+a+"?min"+a+":result"+a+";",prepareValues:b,type:"NumberExpression"}},reduce:function(a){var b="callback"+a+"=blocks.core.reducePrepare(callback"+a+",memo"+a+",thisArg"+a+");";return{args:["callback","memo","thisArg"],beforeLoop:"var hasMemo"+a+"=memo"+a+"!=null;result"+a+"=memo"+a+";"+(""===a?""+b:""),inLoop:"if (hasMemo"+a+"){result"+a+"=callback"+a+"(result"+a+",value,indexOrKey,collection);}else {result"+a+"=collection[indexOrKey];hasMemo"+a+"=true;};",prepareValues:b,everything:!0}},size:function(a,b){return{beforeLoop:(""===a?""+("array"==b?"return collection.length;":""):"")+"result"+a+"=0;",inLoop:"result"+a+"++;",type:"NumberExpression"}},some:function(a){var b="callback"+a+"=blocks.core.parseCallback(callback"+a+",thisArg"+a+");";return{boolResult:!1,args:["callback","thisArg"],beforeLoop:"result"+a+"=false;"+(""===a?""+b:""),inLoop:"if (callback"+a+"){if (callback"+a+"(value,indexOrKey,collection)){result"+a+"=true;break ;}}else if (value){result"+a+"=true;break ;};",prepareValues:b}},type:"collection"};for(var G in J)J[G].identity=G,J[G].parent=J;var K={at:function(a){return{args:["position","count"],beforeLoop:"var isArray"+a+"=blocks.isNumber(count"+a+");var size"+a+"=0;indexOrKey=position"+a+"-1;if (isArray"+a+"){result"+a+"=[];};",inLoop:"if (isArray"+a+"){if (size"+a+"++>=count"+a+"){break ;}result"+a+".push(value);}else {result=value;break ;};"}},flatten:function(a){return{args:["shallow"],beforeLoop:"var flatten"+a+"=blocks.core.flatten;result"+a+"=[];",inLoop:"flatten"+a+"(shallow"+a+",value,result"+a+");"}},indexOf:function(a){return{args:["searchValue","fromIndex"],beforeLoop:"result"+a+"=-1;if (blocks.isNumber(fromIndex"+a+")){indexOrKey=fromIndex"+a+";};",inLoop:"if (value===searchValue"+a+"){result"+a+"=indexOrKey;break ;};",type:"NumberExpression"}},last:function(a){var b="if (callback"+a+"){callback"+a+"=blocks.core.parseCallback(callback"+a+",thisArg"+a+");};";return{reverse:!0,args:["callback","thisArg"],beforeLoop:"var isNumber"+a+"=blocks.isNumber(callback"+a+");var size"+a+"=0;var count"+a+"=1;var current"+a+";if (isNumber"+a+"){result"+a+"=[];count"+a+"=callback"+a+";callback"+a+"=thisArg"+a+";};"+(""===a?""+b:""),inLoop:"if (callback"+a+"){if (callback"+a+"(value,indexOrKey,collection)){current"+a+"=value;}else {continue ;}}else {current"+a+"=value;};if (isNumber"+a+"){if (size"+a+"++>=count"+a+"){break ;}result"+a+".unshift(current"+a+");}else {result"+a+"=current"+a+";break ;};",prepareValues:b,everything:!0}},lastIndexOf:function(a){return{reverse:!0,args:["searchValue","fromIndex"],beforeLoop:"result"+a+"=-1;if (blocks.isNumber(fromIndex"+a+")){indexOrKey=fromIndex"+a+";};",inLoop:"if (value===searchValue"+a+"){result"+a+"=indexOrKey;break ;};",type:"NumberExpression"}},range:function(a,b,c,d){return{args:["start","end","step"],beforeLoop:"length=Math.max(Math.ceil((end"+a+"-start"+a+")/step"+a+"),0);result"+a+"=Array(length);",inLoop:"value=start"+a+";start"+a+"+=step"+a+";"+(""===a||0===d.length?"result"+a+"[indexOrKey]=value;":"")}},reduceRight:function(a){return{reverse:!0,args:["callback","memo","thisArg"],beforeLoop:"var hasMemo"+a+"=memo"+a+"!=null;result"+a+"=memo"+a+";"+(""===a?"callback"+a+"=blocks.core.reducePrepare(callback"+a+",memo"+a+",thisArg"+a+");":""),inLoop:"if (hasMemo"+a+"){result"+a+"=callback"+a+"(result"+a+",value,indexOrKey,collection);}else {result"+a+"=collection[indexOrKey];hasMemo"+a+"=true;};",everything:!0}},unique:function(a,b,c,d){var e="callback"+a+"=blocks.core.uniquePrepare(callback"+a+",thisArg"+a+");";return{args:["callback","thisArg"],beforeLoop:"var seen"+a+"=[];var isFirst"+a+"=true;var isSorted"+a+"=blocks.isBoolean(callback"+a+")&&callback"+a+";var hasCallback"+a+"=blocks.isFunction(callback"+a+");var map"+a+";result"+a+"=[];"+(""===a?""+e:""),inLoop:"map"+a+"=hasCallback"+a+"?callback"+a+"(value,indexOrKey,collection):value;if (isSorted"+a+"?isFirst"+a+"||seen"+a+"[seen"+a+".length-1]!==map"+a+":!blocks.contains(seen"+a+",map"+a+")){isFirst"+a+"=false;seen"+a+".push(map"+a+");}else {continue ;};"+(""===a||0===d.length?"result"+a+".push(value);":""),prepareValues:e}},type:"array"};for(var G in K)K[G].identity=G,K[G].parent=K;var L={get:function(a){var b=(""===a?"keys"+a+"=blocks.flatten(Array.prototype.slice.call(arguments,1));":"")+(""!==a?"keys"+a+"=blocks.flatten(Array.prototype.slice.call(arguments,0));":"");return{args:["keys"],beforeLoop:(""===a?""+b:"")+"var singleKey"+a+"=keys"+a+".length<2;keys"+a+"=blocks.toObject(keys"+a+");result"+a+"={};",inLoop:"if (keys"+a+".hasOwnProperty(indexOrKey)){if (singleKey"+a+"){result"+a+"=value;}else {result"+a+"[indexOrKey]=value;}};",prepareValues:b}},invert:function(a,b,c,d){return{beforeLoop:"var temp"+a+";result"+a+"={};",inLoop:"temp"+a+"=value;value=indexOrKey;indexOrKey=temp"+a+";"+(""===a||0===d.length?"result"+a+"[indexOrKey]=value;":"")}},keys:function(a,b,c,d){return{beforeLoop:"result"+a+"=[];",inLoop:"value=indexOrKey;"+(""===a||0===d.length?"result"+a+".push(value);":"")}},pairs:function(a){return{beforeLoop:"result"+a+"=[];",inLoop:"result"+a+".push({key:indexOrKey,value:value});"}},values:function(a){return{beforeLoop:"result"+a+"=[];",inLoop:"result"+a+".push(value);"}},type:"object"};for(var G in L)L[G].identity=G,L[G].parent=L;var M,N,O={chainExpression:function(a){var b,c,d,e,f,g,h,i,j,k,m="";return m+="var "+a.indexOrKey+" = -1, "+a.collection+", "+a.length+", "+a.value+", "+(a.conditions?"":" "+a.result+a.resultIndex+",")+" "+a.result+(a.conditions?" = false":"")+"; "+a.conditionsDeclarations+" ",k=-1,l.each(a.args,function(n,o){c=n,k+=1,j=o,i=0==o,h=o==a.args.length-1,m+=" ",g=-1,l.each(c,function(h,i){b=h,g+=1,f=i,e=0==i,d=i==c.length-1,m+=" var "+b+k+" = "+a.expression+"._"+b+"; "}),m+=" "+a.expression+" = "+a.expression+"._parent; "}),m+=" ",l.eachRight(a.variables,function(n,o){c=n,k=a.variables.length,k+=-1,j=o,i=0==o,h=o==a.variables.length-1,m+=" ",g=-1,l.each(c,function(a,h){b=a,g+=1,f=h,e=0==h,d=h==c.length-1,m+=" var "+f+g+" = "+b+"; "}),m+=" "}),m+=" "+a.collection+" = "+a.expression+"._value; "+a.indexOrKey+" += "+a.skip+"; "+(a.take?" "+a.length+" = Math.min("+a.collection+".length, "+a.skip+" + "+a.take+"); ":"")+" "+(a.take?"":" "+a.length+" = "+a.collection+".length; ")+" "+(a.reverse?" "+a.indexOrKey+" = "+a.collection+".length - "+a.skip+"; ":"")+" ",l.eachRight(a.arrayBeforeLoops,function(b,d){c=b,k=a.arrayBeforeLoops.length,k+=-1,j=d,i=0==d,h=d==a.arrayBeforeLoops.length-1,m+=" "+c+" "}),m+=" "+(a.isObject?" for ("+a.indexOrKey+" in "+a.collection+") { ":"")+" "+(a.isObject?"":" "+(a.reverse?" while (--"+a.indexOrKey+" >= "+(a.take?a.take:"")+(a.take?"":"0")+") { ":"")+" "+(a.reverse?"":" while (++"+a.indexOrKey+" < "+a.length+") { ")+" ")+" "+a.value+" = "+a.collection+"["+a.indexOrKey+"]; ",l.eachRight(a.arrayInLoops,function(b,d){c=b,k=a.arrayInLoops.length,k+=-1,j=d,i=0==d,h=d==a.arrayInLoops.length-1,m+=" "+c+" "}),m+=" "+(a.inLoopConditions?" "+a.inLoopConditions+" ":"")+" } ",l.eachRight(a.arrayAfterLoops,function(b,d){c=b,k=a.arrayAfterLoops.length,k+=-1,j=d,i=0==d,h=d==a.arrayAfterLoops.length-1,m+=" "+c+" "}),m+=" "+(a.afterLoopConditions?" "+a.afterLoopConditions+" ":"")+" "+(a.conditions?"":" "+a.result+" = "+a.result+a.resultIndex+"; ")+" return "+a.result+"; "},conditions:function(a){var b,c,d,e,f,g="";return g+="if (",f=-1,l.each(a.items,function(h,i){b=h,f+=1,e=i,d=0==i,c=i==a.items.length-1,g+=b}),g+=") { "+a.result+" = true; "+(a.inLoop?" break; ":"")+" } "},expressions:function(a){var b,c,d,e,f,g,h,i,j,k,m="";return m+="function "+a.name+"Expression( ",k=-1,l.each(a.args,function(b,d){c=b,k+=1,j=d,i=0==d,h=d==a.args.length-1,m+=" "+c+", "}),m+=" parent ) { this._parent = parent; this._descriptor = descriptors."+a.descriptorName+"; ",k=-1,l.each(a.args,function(b,d){c=b,k+=1,j=d,i=0==d,h=d==a.args.length-1,m+=" this._"+c+" = "+c+"; "}),m+=" } "+(a.isRoot?" function "+a.name+"Expression(value) { this._value = value; this._loopDescriptor = LoopDescriptors.chainExpression; } ":"")+" blocks.inherit(BaseExpression, "+a.name+"Expression, { _type: "+a.type+', _name: "'+a.name+'", ',k=-1,l.each(a.methods,function(n,o){c=n,k+=1,j=o,i=0==o,h=o==a.methods.length-1,m+=" "+c.name+": function ( ",g=-1,l.each(c.args,function(a,h){b=a,g+=1,f=h,e=0==h,d=h==c.args.length-1,m+=" "+b+", "}),m+=" a ) { var type = expressions."+a.path+c.name+"; if (!type) { type = (expressions."+a.path+c.name+' = generateExpression("'+a.name+c.name+'", "'+a.path+c.name+'", "'+c.name+'", '+a.type+")); } "+c.prepareValues+" expression = new type(",g=-1,l.each(c.args,function(a,h){b=a,g+=1,f=h,e=0==h,d=h==c.args.length-1,m+=" "+b+", "}),m+=" this); "+(c.type?" if (this._hasConditions()) { this.result(); this._setLastCondition(); return new "+c.type+"(expression.value(), this); } return new "+c.type+"(expression.value()); ":"")+" "+(c.everything?" if (this._hasConditions()) { this.result(); this._setLastCondition(); } return blocks(expression.value(), this); ":"")+" return expression; }, "}),m+=" ",k=-1,l.each(a.staticMethods,function(b,d){c=b,k+=1,j=d,i=0==d,h=d==a.staticMethods.length-1,m+=" "+j+" : "+c+", "}),m+=" reverse: function () { var type = expressions."+a.path+"reverse; if (!type) { type = (expressions."+a.path+'reverse = generateExpression("'+a.path+'reverse", "'+a.path+'reverse", "reverse", '+a.type+")); } var expression = new type(this); return expression; }, each: function (callback, thisArg) { var type = expressions."+a.path+"each; if (!type) { type = (expressions."+a.path+'each = generateExpression("'+a.path+'each", "'+a.path+'each", "each", '+a.type+")); } callback = PrepareValues.parseCallback(callback, thisArg); var expression = new type(callback, thisArg, this); expression._loop(); return expression; }, value: function () { if (this._parent && this._computedValue === undefined) { this._execute(true); this._computedValue = blocks.isBoolean(this._result) ? this._parent._value : this._result; } return this._computedValue === undefined ? this._value : this._computedValue; }, result: function () { if (this._result === true || this._result === false) { return this._result; } if (this._parent) { this._execute(); } return this._result; }, _loop: function () { var func = cache."+a.path+" || (cache."+a.path+" = createExpression(this)); func(this); }, _execute: function (skipConditions) { var func = cache."+a.path+" || (cache."+a.path+' = createExpression(this, skipConditions)); if (func) { this._setResult(func(this)); } else { this._result = this._findValue(); } }, _hasConditions: function () { var name = this._name; return name.indexOf("and") != -1 || name.indexOf("or") != -1; }, _setLastCondition: function () { var name = this._name; var andIndex = name.lastIndexOf("and"); var orIndex = name.lastIndexOf("or"); this._lastCondition = andIndex > orIndex ? "and" : "or"; }, _findValue: function () { var parent = this._parent; while (parent) { if (parent._value) { return parent._value; } parent = parent._parent; } } }); return '+a.name+"Expression; "
				},singleExpression:function(a){var b,c,d,e,f,g="";return g+="var "+a.length+" = "+a.collection+".length, "+a.indexOrKey+" = "+(a.reverse?"":"-1")+(a.reverse?a.length:"")+", "+a.isCollectionAnArray+" = "+a.isArrayCheck+", "+a.result+", "+a.value+"; ",f=-1,l.each(a.variables,function(h,i){b=h,f+=1,e=i,d=0==i,c=i==a.variables.length-1,g+=" "}),g+=" if ("+a.isCollectionAnArray+") { ",f=-1,l.each(a.arrayBeforeLoops,function(h,i){b=h,f+=1,e=i,d=0==i,c=i==a.arrayBeforeLoops.length-1,g+=" "+b+" "}),g+=" "+(a.reverse?" while (--"+a.indexOrKey+" >= 0) { ":"")+" "+(a.reverse?"":" while (++"+a.indexOrKey+" < "+a.length+") { ")+" "+a.value+" = "+a.collection+"["+a.indexOrKey+"]; ",f=-1,l.each(a.arrayInLoops,function(h,i){b=h,f+=1,e=i,d=0==i,c=i==a.arrayInLoops.length-1,g+=" "+b+" "}),g+=" } ",f=-1,l.each(a.arrayAfterLoops,function(h,i){b=h,f+=1,e=i,d=0==i,c=i==a.arrayAfterLoops.length-1,g+=" "+b+" "}),g+=" } else { ",f=-1,l.each(a.objectBeforeLoops,function(h,i){b=h,f+=1,e=i,d=0==i,c=i==a.objectBeforeLoops.length-1,g+=" "+b+" "}),g+=" for ("+a.indexOrKey+" in collection) { "+a.value+" = "+a.collection+"["+a.indexOrKey+"]; ",f=-1,l.each(a.objectInLoops,function(h,i){b=h,f+=1,e=i,d=0==i,c=i==a.objectInLoops.length-1,g+=" "+b+" "}),g+=" } ",f=-1,l.each(a.objectAfterLoops,function(h,i){b=h,f+=1,e=i,d=0==i,c=i==a.objectAfterLoops.length-1,g+=" "+b+" "}),g+=" } return "+a.result+"; "},skip:function(a){var b="";return b+="if (skip"+a.index+"-- > 0) { continue; }"},take:function(a){var b="";return b+="if (take"+a.index+"-- <= 0) { break; }"},type:"loop"},P={},Q={},R=l.extend({},J,K,L,F);for(var G in R)M=R[G],l.isFunction(M)&&(N=M(" ","","",[]),y[G]={name:G,args:N.args,prepareValues:N.prepareValues||"",type:N.type,everything:N.everything});l.extend(D,{toObject:function(a){return new expressions.RootObjectExpression(blox.toObject(this.value(),a))},sortBy:function(a,b){return new expressions.RootArrayExpression(blox.sortBy(this.value(),a,b))},groupBy:function(a,b){return new expressions.RootObjectExpression(blox.groupBy(this.value(),a,b))},countBy:function(a,b){return new expressions.RootObjectExpression(blox.countBy(this.value(),a,b))},shuffle:function(){return new expressions.RootArrayExpression(blox.shuffle(this.value()))},set:function(a,b){return new expressions.RootObjectExpression(blox.set.call(void 0,this.value,a,b))},at:function(a,b){return new expressions.RootArrayExpression(blox.at(this._value,a,b))},concat:function(){var a=this.value();return new expressions.RootArrayExpression(a.concat.apply(a,arguments))},push:function(){var a=this.value();return a.push.apply(a,arguments),new expressions.RootArrayExpression(a)},pop:function(){var a=this.value();return a.pop(),new expressions.RootArrayExpression(a)},shift:function(){var a=this.value();return a.shift(),new expressions.RootArrayExpression(a)},slice:function(a,b){return new expressions.RootArrayExpression(this.value().slice(a,b))},sort:function(a){return new expressions.RootArrayExpression(this.value().sort(a))},splice:function(a,b){var c=this.value();return arguments.length>2?c.splice.apply(c,[a,b].concat(E.call(arguments,2))):c.splice(a,b),new expressions.RootArrayExpression(c)},unshift:function(){var a=this.value();return a.unshift.apply(a,arguments),new expressions.RootArrayExpression(a)}}),l.extend(D,{add:function(){return d(this.value(),arguments),this},remove:function(a,b){return l.remove(this.value(),a,b),this},removeAt:function(a,b){return l.removeAt(this.value(),a,b),this},removeAll:function(a,b){return 0===arguments.length?l.removeAll(this.value()):l.removeAll(this.value(),a,b),this},addMany:function(){return e(this.value(),arguments),this},swap:function(a,b){return l.swap(this.value(),a,b),this},move:function(a,b){return l.move(this.value(),a,b),this}});var S=c("RootArray","arr","",1,!0);l.extend(S.prototype,{reverse:function(){return new S(this._value.reverse())}}),l.extend(l,{add:function(a){return d(a,E.call(arguments,1))},addMany:function(a){return e(a,E.call(arguments,1))},remove:function(a,b,c){return x.isPosition(b)?l.removeAt(a,x.determineIndex(b,this._value.length),c):l.removeAll(a,b,c,!0)},removeAt:function(a,b,c){return l.isNumber(c)||(c=1),a.splice(b,c),a},removeAll:function(a,b,c,d){var e,f=0,g=l.isFunction(b);if(1==arguments.length)a.splice(0,a.length);else for(;f<a.length&&(e=a[f],!(e===b||g&&b.call(c,e,f,a))||(a.splice(f--,1),!d));f++);return a},toObject:function(a,b){for(var c,d={},e=arguments.length>1&&b,f=0,g=a.length;g>f;f++)c=a[f],l.isArray(c)?d[c[0]]=c[1]:l.isObject(c)?d[c.key]=c.value:d[c]=e?b[f]:!0;return d},shuffle:function(a){for(var b,c=[],d=0,e=a.length;e>d;d++)b=l.random(d),c[d]=c[b],c[b]=a[d];return c}});var T=c("RootObject","obj","",2,!0);l.set=function(a,b,c){var d;if(l.isString(b))a[b]=c;else for(d in b)a[d]=b;return a};var U=/^\s+|\s+$/gm,V=/^(\s|\u00A0)+/,W=/(\s|\u00A0)+$/;g.prototype.constructor=a,l.inherit(a,g,{_expression:g,type:function(){return"string"},substring:function(a,b){return new g(this._value.substring(a,b))},isEmpty:function(){return this._resultExpression(0==this._value.length)},size:function(){return new n(l.size(this._value))},contains:function(a){return this._resultExpression(-1!=this._value.indexOf(a))},startsWith:function(a){return this._resultExpression(l.startsWith(this._value,a))},endsWith:function(a){return this._resultExpression(l.endsWith(this._value,a))},trim:function(a){return new g(l.trim(this._value,a))},trimStart:function(a){return new g(l.trimStart(this._value,a))},trimEnd:function(a){return new g(l.trimEnd(this._value,a))},repeat:function(a){return new g(l.repeat(this._value,a))},reverse:function(){return new g(l.reverse(this._value))},wrap:function(a){return new g(l.wrap(this._value,a))},format:function(){return new g(h(this._value,E.call(arguments,0)))},matches:function(a,b){return new g(l.matches(this._value,a,b))},toUnit:function(a){return new g(l.toUnit(this._value,a))},clone:function(){return new g(this._value.toString())}}),l.extend(l,{startsWith:function(a,b){return l.isString(a)||(a=a.toString()),b=b.toString(),0==a.indexOf(b)},endsWith:function(a,b){return l.isString(a)||(a=a.toString()),b=b.toString(),a.lastIndexOf(b)==a.length-b.length},trim:function(a,b){return(a||"").toString().replace("string"==typeof b?new RegExp("^("+b+")+|("+b+")+$","g"):U,"")},trimStart:function(a,b){return(a||"").toString().replace("string"==typeof b?new RegExp("^("+b+")+"):V,"")},trimEnd:function(a,b){return(a||"").toString().replace("string"==typeof b?new RegExp("("+b+")+$"):W,"")},repeat:function(a,b){var c="",d=0;if(0>b||"number"!=typeof b)return a;for(b=Math.floor(b);b>d;d++)c+=a;return c},reverse:function(a){return l.isArray(a)?a.reverse():("string"!=typeof a&&(a=a.toString()),a.split("").reverse().join(""))},wrap:function(a,b){return l.isFunction(a)?function(){var c=[a];return push.apply(c,arguments),b.apply(this,c)}:b+a+l.reverse(b)},format:function(a){return h(a,E.call(arguments,1))},matches:function(a,b,c){c=l.isNumber(c)?c:Number.MAX_VALUE,l.isRegExp(b)||(b=new RegExp(b.toString(),"g"));var d,e,f=[];for(b.lastIndex=0,d=b.exec(a);c>0&&d&&(e=l.isArray(d)?d[0].length:d.length,f.push({result:d,input:d.input,startIndex:d.index,endIndex:d.index+e,length:e}),b.global);)d=b.exec(a),c--;return f}}),l.inherit(a,j,{bind:function(){return new j(l.bind.apply(this,[this._value].concat(E.call(arguments))))},partial:function(){return new j(k(this._value,E.call(arguments,0)))},memoize:function(a){return new j(l.memoize(this._value,a))},delay:function(a){return new j(m(this._value,a,E.call(arguments,1)))},throttle:function(a,b){return new j(l.throttle(this._value,a,b))},debounce:function(a,b){return new j(l.debound(this._value,a,b))},once:function(){return new j(l.once(this._value))},wrap:function(a){return new j(l.wrap(this._value,a))}}),l.extend(l,{partial:function(a){var b=E.call(arguments,1);return k(a,b)},memoize:function(a,b){var c={};return b||(b=z),function(){var d=b.apply(this,arguments);return c.hasOwnProperty(d)?c[d]:c[d]=a.apply(this,arguments)}},delay:function(a,b){return m(a,b,E.call(arguments,2))},throttle:function(a,b,c){var d,e,f,g=null,h=0;c||(c={});var i=function(){h=c.leading===!1?0:new Date,g=null,f=b.apply(d,e)};return function(){var j=new Date;h||c.leading!==!1||(h=j);var k=a-(j-h);return d=this,e=arguments,0>=k?(clearTimeout(g),g=null,h=j,f=b.apply(d,e)):g||c.trailing===!1||(g=setTimeout(i,k)),f}},debounce:function(a,b,c){var d,e,f,g,h;return function(){f=this,e=arguments,g=new Date;var i=function(){var j=new Date-g;b>j?d=setTimeout(i,b-j):(d=null,c||(h=a.apply(f,e)))},j=c&&!d;return d||(d=setTimeout(i,b)),j&&(h=a.apply(f,e)),h}},once:function(a){var b,c=!1;return function(){return c?b:(c=!0,b=a.apply(this,arguments),a=null,b)}}}),l.random=function(a,b){return 0==arguments.length?Math.random():(null==b&&(b=a,a=0),a+Math.floor(0|Math.random()*(b-a+1)))},l.inherit(a,n,{_expression:n,type:function(){return"number"},toUnit:function(a){return a=a||"px",new g(this._value+a,this)},random:function(a,b){return new n(l.random(a,b),this)},biggerThan:function(a){var b=new n(this._value,this);return b._setResult(this._value>a),b},lessThan:function(){var a=new n(this._value,this);return a._setResult(this._value<value),a}}),l.inherit(a,o,{_expression:o,type:function(){return"date"},addWeeks:function(a){return l.addWeeks(this._value,a),this},compare:function(a){return new o(l.compare(this._value,a))},equalsDate:function(a){return this._setResult(l.equalsDate(this._value,a)),this},equalsTime:function(a){return this._setResult(l.equalsTime(this._value,a)),this},clearTime:function(){return new o(l.clearTime(this._value))}}),l.extend(l,{addWeeks:function(a,b){return a.setDate(a.getDate()+7*b),a},compare:function(a,b){var c=a-b;return c=0===c?c:0>c?-1:1},equalsDate:function(a,b){return a.getFullYear()===b.getFullYear()&&a.getMonth()===b.getMonth()&&a.getDate()===b.getDate()},equalsTime:function(a,b){return a.getHours()===b.getHours()&&a.getMinutes()===b.getMinutes()&&a.getSeconds()===b.getSeconds()&&a.getMilliseconds()===b.getMilliseconds()},clearTime:function(a){return a.setHours(0,0,0,0),a}}),l.each([["Years","FullYear"],["Months","Month"],["Days","Date"],"Hours","Minutes","Seconds","Milliseconds"],function(a){var b=a,c=a;l.isArray(a)&&(b=a[0],c=a[1]),b="add"+b,l[b]=function(a,b){return a["set"+c](a["get"+c]()+b),a},o.prototype[b]=function(a){return new o(l[b](this._value,a))}}),l.inherit(a,p,{equals:function(){},matches:function(a,b){return new p(l.matches(this._value,a,b))},reset:function(){},clone:function(){return new p(l.clone(this._value))}});var H=l.core;H.expressionsCreated=!0,H.trigger&&H.trigger("expressionsCreated"),H.createExpression=function(b){var c;return b instanceof Array||b&&b.jquery?new S(b):"string"==typeof b||b instanceof String?new g(b):"number"==typeof b||b instanceof Number?new n(b):b instanceof Date?new o(b):"[object RegExp]"===(c=f.call(b))?new p(b):null==b?new a(b):"__blocks.expression__"==b._prototypeIndentification?b:"[object Function]"==c?new j(b):new T(b)},H.isExpression=function(a){return a&&"__blocks.expression__"==a._prototypeIndentification},H.staticExpression={range:function(a,b,c){c=c||1,1==arguments.length&&(b=a,a=0);var d=new S([]);return d.range(a,b,c)},repeat:function(){}},H.isArrayExpression=function(a){return ChildArrayExpression.prototype.isPrototypeOf(a)},H.isObjectExpression=function(a){return ChildObjectExpression.prototype.isPrototypeOf(a)};var X={array:S,object:T},Y=l.toObject(["value","not","and","or","type","is","result"]);l.core.applyExpressions=function(a,b,c){if(X[a]){var d,e=X[a].prototype;for(d in e)b[d]||Y[d]||!l.isFunction(e[d])||c&&!c[d]||(b[d]=q(d))}};var Z=l.extend({},J,K,L);for(var G in Z)v(G);l.forEach=l.each;var $=l.at,w=v("at");l.at=function(a,b,c){return l.isNumber(a)?$(a):w(a,b,c)};var _=l.first,ab=v("first");l.first=function(a,b,c){return 0==arguments.length?_:ab(a,b,c)};var bb=l.last,cb=v("last");l.last=function(a,b,c){return 0==arguments.length?bb:cb(a,b,c)};var db=l.contains;l.contains=function(a,b){return l.isString(a)?-1!=a.indexOf(b):db(a,b)}}(),function(){function a(a,b){if(null!=b){var c=a;a=function(a,d,e){return c.call(b,a,d,e)}}return a}function b(a){var b={};return l.each(a,function(a){b[a]=!0}),b}function c(){return!1}function d(){return!0}function e(a){this.originalEvent=a,this.type=a.type,this.isDefaultPrevented=a.defaultPrevented||void 0===a.defaultPrevented&&a.returnValue===!1?d:c,this.timeStamp=a.timeStamp||+new Date}function f(a,b,c){a.addEventListener&&"propertychange"!=b?a.addEventListener(b,function(a){c.call(this,e.fix(a))},!1):a.attachEvent&&a.attachEvent("on"+b,function(a){c.call(this,e.fix(a))})}function g(a,b){return a&&"string"==typeof a&&null!=b?(a=" "+a+" ",a.indexOf(" "+b+" ")):-1}function h(a){return String(a).replace($,"&amp;").replace(_,"&lt;")}function i(a){var b=document.createDocumentFragment(),c=document.createElement("div"),d=1,e="<table>",f="</table>",g="<tbody>",h="</tbody>",i="<tr>",j="</tr>";for(a=a.toString(),-1!=a.indexOf("<option")&&-1==a.indexOf("<select")?(a="<select>"+a+"</select>",d=2):-1==a.indexOf("<table")&&(a.match(/<(tbody|thead|tfoot)/)?(d=2,a=e+a+f):-1!=a.indexOf("<tr")?(d=3,a=e+g+a+h+f):a.match(/<(td|th)/)&&(d=4,a=e+g+i+a+j+h+f)),c.innerHTML="A<div>"+a+"</div>";d--;)c=c.lastChild;for(;c.firstChild;)b.appendChild(c.firstChild);return b}function j(a){return a?parseFloat(a[1]):void 0}function k(a,b,c){gb[b]?gb[b](a,c,function(b,c){f(a,b,c)}):f(a,b,c)}function m(a){return m.prototype.isPrototypeOf(this)?(this.__identity__=bb,this._tagName=a?a.toString().toLowerCase():null,this._attributes={},this._attributeExpressions=[],this._parent=null,this._children=[],this._isSelfClosing=!1,this._haveAttributes=!0,this._innerHTML=null,this._renderMode=m.RenderMode.All,this._haveStyle=!1,this._style={},this._states=null,this._state=null,void(l.isElement(a)&&(this._el=a))):new m(a)}function n(a,b){var c,d,e=' style="',f=!1;for(c in a)d=a[c],b&&ab.call(b.style,c)||(d||0===d)&&(f=!0,c=c.replace(/[A-Z]/g,o),e+=c,e+=":",e+=d,e+=";");if(b)for(c in b.style)d=b.style[c],(d||0===d)&&(f=!0,c=c.replace(/[A-Z]/g,o),e+=c,e+=":",e+=d,e+=";");return e+='"',f?e:""}function o(a){return"-"+a.toLowerCase()}function p(a,b,c){if(null!=c){c=l.isArray(c)?c:c.toString().split(" ");var d,e,f,h=0;if(m.Is(b))d=b._getAttr(W);else{if(b.classList)return void(mb?b.classList[a].apply(b.classList,c):l.each(c,function(c){b.classList[a](c)}));d=b.className}for(d=d||"";h<c.length;h++)e=c[h],f=g(d,e),"add"==a?0>f&&(""!==d&&(e=" "+e),d+=e):-1!=f&&(d=(d.substring(0,f)+" "+d.substring(f+e.length+1,d.length)).replace(V,""));m.Is(b)?b._state?b._state.attributes[W]=d:b._attributes[W]=d:b.className=d}}function q(a,b){var c=fb.data(a);if(c&&c.animating>0){for(var d,e=a.childNodes,f=0,h=0;b!=h;){if(!e[f])return Number.POSITIVE_INFINITY;d=e[f].className,f++,-1==g(d,"b-hide")&&h++}if(!e[f])return Number.POSITIVE_INFINITY;for(d=e[f].className;-1!=g(d,"b-hide");){if(f++,!e[f])return Number.POSITIVE_INFINITY;d=e[f].className}return f}return b}function r(a,b){var c=!1,d=fb.createIfNotExists(b),e=fb.createIfNotExists(b.parentNode),f=d.animateCallback,g="remove"==a?"hide":"add"==a?"show":a,h="remove"==a?function(){fb.clear(b,!0),b.parentNode&&b.parentNode.removeChild(b)}:"hide"==a?function(){b.style.display="none"}:l.noop,i=function(){d.animating-=1,e.animating-=1,d.animating||h()};if(1!=b.nodeType)return void h();if("show"==a&&(b.style.display=""),d.preprocess)return void h();if(f){c=!0,d.animating+=1,e.animating+=1;var j=l.context(b),k=j.$view||j.$root;f.call(k,b,i,g)}return c||s(g,b,h,i)}function s(a,b,c,d){function e(){p("remove",b,"b-"+a),p("remove",b,"b-"+a+"-end"),d(),b.removeEventListener("transitionend",e,!1),b.removeEventListener(f,e,!1)}if("undefined"==typeof window||void 0===window.ontransitionend)return void c();p("add",b,"b-"+a);var f,g=window.getComputedStyle(b),h="";void 0===window.onanimationend&&void 0!==window.onwebkitanimationend?(h="-webkit-",f="webkitAnimationEnd"):f="animationend";var i=parseFloat(g["transition-duration"])||0,j=parseFloat(g["transition-delay"])||0,k=parseFloat(g[h+"animation-duration"])||0,l=parseFloat(g[h+"animation-delay"])||0;return 0>=i&&0>=j&&0>=k&&0>=l?(p("remove",b,"b-"+a),void c()):(fb.createIfNotExists(b).animating+=1,fb.createIfNotExists(b.parentNode).animating+=1,setTimeout(function(){p("add",b,"b-"+a+"-end"),b.addEventListener("transitionend",e,!1),b.addEventListener(f,e,!1)},1),!0)}function t(a){return t.prototype.isPrototypeOf(this)?(this.__Class__(),void(8==a.nodeType?(this._commentText=a.nodeValue,this._el=a):this._commentText=a)):new t(a)}function u(a,b){for(var c,d,e,f,g,i,j,k,n,o=window.__blocksServerData__,p=[];a;){if(i=a.nodeType,1==i){d=a.tagName.toLowerCase(),c=new m(a),c._tagName=d,c._parent=b,b&&(c._each=b._each||b._childrenEach),c._haveAttributes=!1,f=a.attributes,e={};for(var q=0;q<f.length;q++)g=f[q],"style"!==g.nodeName&&(g.specified||eb.IE<8&&"value"==g.nodeName&&g.nodeValue)&&(e[g.nodeName.toLowerCase()]=eb.IE<11?g.nodeValue:g.value,c._haveAttributes=!0);c._attributes=e,c._createAttributeExpressions(o),a.style.cssText&&(c._haveStyle=!0,c._style=v(a.style.cssText)),w(c),"script"==d||"style"==d||"code"==d||c.hasClass("bl-skip")?c._innerHTML=a.innerHTML:c._children=u(a.childNodes[0],c),p.push(c)}else if(3==i)n=h(a.data),p.push(lb.Create(n,null,a)||n);else if(8==i)if(j=a.nodeValue,k=j.replace(V,""),0===k.indexOf("blocks"))c=new t(a),c._parent=b,c._attributes[db]=k.substring(6),n=u(a.nextSibling,c),c._children=n.elements,c._el._endElement=n.htmlElement,a=n.htmlElement||a,p.push(c);else{if(t.Is(b)&&0===k.indexOf("/blocks"))return{elements:p,htmlElement:a};if(t.Is(b))p.push("<!--"+j+"-->");else if(o){var r=parseInt(/[0-9]+/.exec(k),10);!l.isNaN(r)&&o[r]&&p.push(lb.Create(o[r]))}else 0!==k.indexOf("/blocks")&&p.push("<!--"+j+"-->")}a=a.nextSibling}return p}function v(a){for(var b,c,d,e=a.split(";"),f={},g=0;g<e.length;g++)c=e[g],c&&(b=c.indexOf(":"),-1!=b&&(d=[c.substring(0,b),c.substring(b+1)],f[d[0].toLowerCase().replace(V,"")]=d[1].replace(V,"")));return f}function w(a){var b,c=a._tagName;return void 0!==pb[c]?void(a._isSelfClosing=pb[c]):(b=document.createElement("div"),b.appendChild(document.createElement(c)),void(pb[c]=a._isSelfClosing=-1===b.innerHTML.indexOf("</")))}function x(a){return function(b){return 0===arguments.length?this[a]:(this[a]=b,this)}}function y(a,b){var c,d,e=0,f=0,g=0,h=0,i=!1,j=!1,k=0,l=[];a=a||"";for(var m=0;m<a.length;m++)e=a.charAt(m),i||j||("["==e?h++:"]"==e?h--:"{"==e?g++:"}"==e&&g--),0===g&&0===h&&("'"==e?i=!i:'"'==e&&(j=!j),i||j||("("==e?(0===f&&(d=a.substring(k,m).replace(V,""),k=m+1),f++):")"==e?(f--,0===f&&(c=a.substring(k,m).replace(V,""),c.length&&l.push(c),d&&(d=d.replace(/^("|')+|("|')+$/g,""),b(d,l)),l=[],d=void 0)):","==e&&1==f?(c=a.substring(k,m).replace(V,""),c.length&&l.push(c),k=m+1):"."==e&&0===f&&(k=m+1)))}function z(a){this._options=a||{},this._contextProperties={}}function A(a){var b=z.QueryCache[a]=[];return y(a,function(a,c){var d=l.queries[a],e={name:a,params:c,query:a+"("+c.join(",")+")"};d&&("attr"==a||"val"==a?b.unshift(e):b.push(e))}),b}function B(a){this.observable=a,this.chunkLengths={},this.dispose()}function C(a){a._dependencyType&&(a._getDependency=l.bind(D,a),a.on("get",a._getDependency))}function D(){var a=this,b=a.__value__,c=1==a._dependencyType?b:b.get;U.off(a,"get",a._getDependency),a._getDependency=void 0,kb.startObserving(),c.call(a.__context__),l.each(kb.stopObserving(),function(b){var c=b._dependencies=b._dependencies||[],d=!1;l.each(c,function(b){return a===b?(d=!0,!1):void 0}),d||c.push(a)})}function E(a){var b=a.__context__;return 1==a._dependencyType?a.__value__.call(b):2==a._dependencyType?a.__value__.get.call(b):a.__value__}function F(a,b,c){var d=a.errorMessage,e=a.errorMessages;d(c?"":b.errorMessage||e()[0]||""),a.valid(c)}function G(a){return a.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}function H(a){return H.Is(a)?a:H.Is(this)?(this._routeString=a,this._wildcard={},this._optional={},this._validate={},void(this._transform={})):new H(a)}function I(){this._currentRoute={},this._routes={}}function J(a){this.options=l.extend({},J.Defaults,a),this.execute()}function K(a){if(window){var b=window.jQuery||window.$;b&&b.ajax?b.ajax(a):J.Execute(a)}}function L(a){a=a||{};var b=a.data,c=a.baseUrl;a=this.options=(a.data=void 0)||l.extend(!0,{},this.options,a),c&&(a.read.url=c+a.read.url,a.create.url=c+a.create.url,a.destroy.url=c+a.destroy.url,a.update.url=c+a.update.url),this.data=l.observable(l.unwrap(b)||[]).extend().on("add remove",l.bind(this._onArrayChange,this)),this.hasChanges=l.observable(!1),this._aggregates=null,this._changes=[],this._changesMeta={},this._subscribeToEvents()}function M(a){this._options=a||{}}function N(a,b,c,d){var e=this;this._application=a,this._collection=d,this._initialDataItem=l.clone(c,!0),l.each(N.prototype,function(a,b){l.isFunction(a)&&0!==b.indexOf("_")&&(e[b]=l.bind(a,e))}),O(b,this),this.valid=l.observable(!0),this.isLoading=l.observable(!1),this.validationErrors=l.observable([]),this._isNew=!1,this._dataItem=c||{},this._properties=M.Inflate(this),this.options.baseUrl||(this.options.baseUrl=a.options.baseUrl),this.options.mode=L.ObjectMode,this._dataSource=new L(this.options),this._dataSource.on("change",this._onDataSourceChange,this),this._dataSource.requestStart(function(){e.isLoading(!0)}),this._dataSource.requestEnd(function(){e.isLoading(!1)}),this._dataSource.on("sync",this._onDataSourceSync),this.hasChanges=this._dataSource.hasChanges,this._ensurePropertiesCreated(c),this.init()}function O(a,b){var c,d;if(a.__used__)for(c in a)d=a[c],M.Is(d)||(b[c]=l.isObservable(d)?d.clone(!0):l.isFunction(d)?l.bind(d,b):N.prototype.isPrototypeOf(d)?d.clone(!0):l.isObject(d)&&!l.isPlainObject(d)?l.clone(d,!0):l.clone(d,!0));else for(c in a)d=a[c],l.isObservable(d)?d.__context__=b:l.isFunction(d)&&(b[c]=l.bind(d,b),b[c].unbound=d);a.__used__=!0}function P(a){this._options=l.extend({root:"/"},a),this._tryFixOrigin(),this._initial=!0,this._location=window.location,this._history=window.history,this._root=("/"+this._options.root+"/").replace(Eb,"/"),this._interval=50,this._fragment=this._getFragment(),this._wants=this._options.history===!0?Ib:this._options.history,this._use=this._wants==Jb&&this._history&&this._history.pushState?Jb:Ib,this._hostRegEx=new RegExp(G(this._location.host))}function Q(a,b,c,d){return R(a,b,c,d)}function R(a,b,c,d){var e,f=l.observable([]).extend(),g=M.Inflate(b);for(e in g)f[e]=g[e];return f._baseUpdate=f.update,l.each(l.observable.fn.collection,function(a,b){l.isFunction(a)&&0!==b.indexOf("_")&&(f[b]=l.bind(f[b],f))}),l.extend(f,l.observable.fn.collection,b),O(b,f),f._Model=a,f._prototype=b,c&&(f._application=c,f._view=l.__viewInInitialize__,b.options.baseUrl||(b.options.baseUrl=c.options.baseUrl)),f._dataSource=new L(b.options),f._dataSource.on("change",f._onDataSourceChange,f),f.hasChanges=f._dataSource.hasChanges,a&&(f.on("adding",f._onAdding,f),f.on("remove add",f._onChange,f)),l.isArray(d)&&f.reset(d),b.init&&b.init.call(f),f}function S(a,b,c){var d=this,e=this.options,f=this._views=[],g=l.has(e,"route");O(c,this),this._application=a,this._parentView=b||null,this._initCalled=!1,this._html=void 0,this.loading=l.observable(!1),this.isActive=l.observable(!g),this.isActive.on("changing",function(a,b){l.each(f,function(a){g||a.isActive(b)}),d._tryInitialize(b)}),(e.preload||this.isActive())&&this._load()}function T(a){this._router=new I(this),this._modelPrototypes={},this._collectionPrototypes={},this._viewPrototypes={},this._views={},this._currentRoutedView=void 0,this._started=!1,this.options=l.extend({},this.options,a),this._serverData=null,this._setDefaults(),this._prepare()}var U=function(){function a(a){return function(b,c){return arguments.length>1?U.on(this,a,b,c):U.on(this,a,b),this}}var b={on:function(a,b,c){return arguments.length>2?U.on(this,a,b,c):U.on(this,a,b),this},once:function(a,b,c){U.once(this,a,b,c)},off:function(a,b){U.off(this,a,b)},trigger:function(a){U.trigger(this,a,l.toArray(arguments).slice(1,100))}};return b._trigger=b.trigger,{register:function(c,d){d=l.isArray(d)?d:[d];for(var e=0;e<d.length;e++){var f=d[e];c[f]=b[f]?b[f]:a(f)}},on:function(a,b,c,d){b=l.toArray(b).join(" ").split(" ");var e,f=0,g=b.length;if(c)for(a._events||(a._events={});g>f;f++)e=b[f],a._events[e]||(a._events[e]=[]),a._events[e].push({callback:c,thisArg:d})},once:function(a,b,c,d){U.on(a,b,c,d),U.on(a,b,function(){U.off(a,b,c)})},off:function(a,b,c){l.isFunction(b)&&(c=b,b=void 0),void 0!==b||void 0!==c?l.each(a._events,function(d,e){void 0!==b&&void 0===c?a._events[b]=[]:l.each(d,function(b,d){return b.callback==c?(a._events[e].splice(d,1),!1):void 0})}):a._events=void 0},trigger:function(a,b){var c,d,e,f=!0;return a&&a._events&&(c=a._events[b],c&&c.length>0&&(e=Array.prototype.slice.call(arguments,2),l.each(c,function(b){b&&(d=a,void 0!==b.thisArg&&(d=b.thisArg),b.callback.apply(d,e)===!1&&(f=!1))}))),f},has:function(a,b){return!!l.access(a,"_events."+b+".length")}}}();!function(){function b(){if("complete"===document.readyState)setTimeout(d);else if(document.addEventListener)document.addEventListener("DOMContentLoaded",c,!1),window.addEventListener("load",c,!1);else{document.attachEvent("onreadystatechange",c),window.attachEvent("onload",c);var a=!1;try{a=null==window.frameElement&&document.documentElement}catch(b){}a&&a.doScroll&&!function e(){if(!l.isDomReady){try{a.doScroll("left")}catch(b){return setTimeout(e,50)}d()}}()}}function c(){(document.addEventListener||"load"==event.type||"complete"==document.readyState)&&d()}function d(){l.isDomReady||(l.isDomReady=!0,U.trigger(l.core,"domReady"),U.off(l.core,"domReady"))}l.isDomReady=!1,l.domReady=function(c,d){"undefined"==typeof document||"undefined"==typeof window||window.__mock__&&document.__mock__||(c=a(c,d),l.isDomReady||"complete"==document.readyState||window.jQuery&&window.jQuery.isReady?(l.isDomReady=!0,c()):(U.on(l.core,"domReady",c),b()))}}();var V=(Array.prototype.slice,/^\s+|\s+$/gm),W="class",X=l.queries={},Y=/^(?:mouse|pointer|contextmenu)|click/,Z=/^key/;e.PropertiesToCopy={all:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),mouse:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),keyboard:"char charCode key keyCode".split(" ")},e.CopyProperties=function(a,b,c){l.each(e.PropertiesToCopy[c],function(c){b[c]=a[c]})},e.prototype={preventDefault:function(){var a=this.originalEvent;this.isDefaultPrevented=d,a.preventDefault?a.preventDefault():a.returnValue=!1},stopPropagation:function(){var a=this.originalEvent;this.isPropagationStopped=d,a.stopPropagation&&a.stopPropagation(),a.cancelBubble=!0},stopImmediatePropagation:function(){var a=this.originalEvent;this.isImmediatePropagationStopped=d,a.stopImmediatePropagation&&a.stopImmediatePropagation(),this.stopPropagation()}},e.fix=function(a){var b=a.type,c=new e(a);return e.CopyProperties(a,c,"all"),c.target||(c.target=a.srcElement||document),3===c.target.nodeType&&(c.target=c.target.parentNode),c.metaKey=!!c.metaKey,Y.test(b)?e.fixMouse(a,c):Z.test(b)&&null==c.which&&(e.CopyProperties(a,c,"keyboard"),c.which=null!=a.charCode?a.charCode:a.keyCode),c},e.fixMouse=function(a,b){var c,d,f,g=a.button,h=a.fromElement;e.CopyProperties(a,b,"mouse"),null==b.pageX&&null!=a.clientX&&(d=b.target.ownerDocument||document,f=d.documentElement,c=d.body,b.pageX=a.clientX+(f&&f.scrollLeft||c&&c.scrollLeft||0)-(f&&f.clientLeft||c&&c.clientLeft||0),b.pageY=a.clientY+(f&&f.scrollTop||c&&c.scrollTop||0)-(f&&f.clientTop||c&&c.clientTop||0)),!b.relatedTarget&&h&&(b.relatedTarget=h===b.target?a.toElement:h),b.which||void 0===g||(b.which=1&g?1:2&g?3:4&g?2:0)};var $=/&/g,_=/</g,ab=Object.prototype.hasOwnProperty,bb="__blocks.VirtualElement__",cb="data-id",db="data-query",eb={};"undefined"!=typeof document&&l.extend(eb,{IE:document&&function(){for(var a=3,b=document.createElement("div"),c=b.getElementsByTagName("i");b.innerHTML="<!--[if gt IE "+ ++a+"]><i></i><![endif]-->",c[0];);return a>4?a:void 0}(),Opera:window&&window.navigator&&window.opera&&window.opera.version&&parseInt(window.opera.version(),10)||void 0,Safari:window&&window.navigator&&j(window.navigator.userAgent.match(/^(?:(?!chrome).)*version\/([^ ]*) safari/i)),Firefox:window&&window.navigator&&j(window.navigator.userAgent.match(/Firefox\/([^ ]*)/))});var fb=function(){function a(a){var b=a?m.Is(a)?a._state?a._state.attributes[cb]:a._attributes[cb]:1==a.nodeType?a.getAttribute(cb):8==a.nodeType?/\s+(\d+):[^\/]/.exec(a.nodeValue):null:null;return l.isArray(b)?b[1]:b}function b(a,b){m.Is(a)?a.attr(cb,b):1==a.nodeType&&a.setAttribute(cb,b)}var c={},d=1;return{id:function(b){return a(b)},collectGarbage:function(){l.each(c,function(a){a&&a.dom&&!document.body.contains(a.dom)&&fb.clear(a.id,!0)})},createIfNotExists:function(e){var f,g,h=e&&e.__identity__==bb;return f=h?c[e._getAttr(cb)]:c[e&&a(e)],f||(g=d++,e&&(h&&e._each?(e._haveAttributes=!0,e._state?e._state.attributes[cb]=g:e._attributes[cb]=g):b(e,g)),f=c[g]=e?{id:g,virtual:h?e:null,animating:0,observables:{},preprocess:h}:{id:g}),f},byId:function(a){return c[a]},data:function(b,d,e){var f=c[a(b)||b];if(f)return 1==arguments.length?f:(arguments.length>2&&(f[d]=e),f[d])},clear:function(b,d){var e=a(b)||b,f=c[e];!f||f.haveData&&!d||(l.each(f.observables,function(a){for(var b=0;b<a._elements.length;b++)a._elements[b].elementId==c.id&&(a._elements.splice(b,1),b--)}),c[e]=void 0,m.Is(b)?b.attr(cb,null):1==b.nodeType&&b.removeAttribute(cb))}}}(),gb={input:function(a,b,c){function d(a){clearTimeout(f),b(a)}function e(){f||(f=setTimeout(d,4))}var f;eb.IE<10?(c("propertychange",function(a){"value"===a.originalEvent.propertyName&&d(a)}),8==eb.IE&&(c("keyup",d),c("keydown",d)),eb.IE>=8&&(hb(a,d),c("dragend",e))):(c("input",d),eb.Safari<7&&"textarea"==a.tagName.toLowerCase()?(c("keydown",e),c("paste",e),c("cut",e)):eb.Opera<11?c("keydown",e):eb.Firefox<4&&(c("DOMAutoComplete",d),c("dragdrop",d),c("drop",d)))}},hb=function(){function a(a){var b=this.activeElement,c=b&&fb.data(b,"selectionchange");c&&c(a)}var b=!1;return function(c,d){b||(f(c.ownerDocument,"selectionchange",a),b=!0),fb.createIfNotExists(c).selectionChange=d}}(),ib=l.dom={valueTagNames:{input:!0,textarea:!0,select:!0},valueTypes:{file:!0,hidden:!0,password:!0,text:!0,color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,range:!0,search:!0,tel:!0,time:!0,url:!0,week:!0},props:{"for":!0,"class":!0,value:!0,checked:!0,tabindex:!0,className:!0,htmlFor:!0},propFix:{"for":"htmlFor","class":"className",tabindex:"tabIndex"},attrFix:{className:"class",htmlFor:"for"},addClass:function(a,b){a&&p("add",a,b)},removeClass:function(a,b){a&&p("remove",a,b)},html:function(a,b){if(a)if(b=b.toString(),8==a.nodeType)ib.comment.html(a,b);else if(eb.IE<10){for(;a.firstChild;)a.removeChild(this._element.firstChild);a.appendChild(i(b))}else a.innerHTML=b},css:function(a,b,c){a&&b&&("display"==b?ob.setVisibility(a,"none"==c?!1:!0):a.style[b]=c)},on:function(a,b,c){a&&k(a,b,c)},off:function(){},removeAttr:function(a,b){a&&b&&ib.attr(a,b,null)},attr:function(a,c,d){var e=ib.props[c];return c=ib.propFix[c.toLowerCase()]||c,l.core.skipExecution&&l.core.skipExecution.element===a&&l.core.skipExecution.attributeName==c||!a?void 0:8==a.nodeType?void ib.comment.attr(a,c,d):("checked"==c&&(d="checked"!=d&&"string"==typeof d&&"radio"==a.getAttribute("type")&&d!=a.value&&null!=a.defaultValue&&""!==a.defaultValue?!1:!!d),1===arguments.length?e?a[c]:a.getAttribute(c):void(null!=d?"value"==c&&"select"==a.tagName.toLowerCase()?(d=b(l.toArray(d)),l.each(a.children,function(a){a.selected=!!d[a.value]})):e?a[c]=d:a.setAttribute(c,d):e?"value"==c&&"select"==a.tagName.toLowerCase()?a.selectedIndex=-1:a[c]&&(a[c]=""):a.removeAttribute(c)))},comment:{html:function(a,b){for(var c,d=a,e=d.parentNode,f=d.nextSibling,g=0;f&&(8!=f.nodeType||-1==f.nodeValue.indexOf("/blocks"));)g++,c=f.nextSibling,e.removeChild(f),f=c;
				return e.insertBefore(i(b),d.nextSibling),g},attr:function(a,b,c){if(a&&b==cb&&c){var d=a,e=a._endElement;return d.nodeValue=" "+c+":"+d.nodeValue.replace(V,"")+" ",e.nodeValue=" "+c+":"+e.nodeValue.replace(V,"")+" ",this}return this}}},jb={},kb=function(){var a=[];return{startObserving:function(){a.push([])},stopObserving:function(){return a.pop()},currentObservables:function(){return a[a.length-1]},registerObservable:function(b){var c=a[a.length-1],d=!1;c&&(l.each(c,function(a){return a===b?(d=!0,!1):void 0}),d||c.push(b))}}}(),lb={Html:0,ValueOnly:2,Create:function(a,b,c){for(var d,e,f,g=-1,h=0,i=[];a.length>++g;)d=a.charAt(g),"{"==d&&"{"==a.charAt(g+1)?e=g+2:"}"==d&&"}"==a.charAt(g+1)&&(e&&(f=a.substring(e,g),b||(f=f.replace(/&amp;/g,"&").replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&lt;/g,"<").replace(/&gt;/g,">")),d=a.substring(h,e-2),d&&i.push(d),i.push({expression:f,attributeName:b}),h=g+2),e=0);return d=a.substring(h),d&&i.push(d),i.text=a,i.attributeName=b,i.element=c,i.isExpression=!0,f?i:null},GetValue:function(a,b,c,d){var e,f="",g=c.length,h=-1;if(!a)return c.text;if(1==g)f=lb.Execute(a,b,c[0],c,d);else for(;++h<g;)e=c[h],f+="string"==typeof e?e:lb.Execute(a,b,e,c,d);return c.lastResult=f,f},Execute:function(a,b,c,d,e){var f,g,i,j,k,m,n=c.expression,o=c.attributeName;return m=jb[n]=jb[n]||new Function("c","with(c){with($this){ return "+n+"}}"),kb.startObserving(),k=m(a),f=l.isObservable(k),j=f?k():k,j=null==j?"":j.toString(),j=h(j),i=kb.stopObserving(),e!=lb.ValueOnly&&(f||i.length)&&(o||(b=fb.createIfNotExists()),b&&(b.haveData=!0,g={length:j.length,attr:o,context:a,elementId:b.id,expression:n,entire:d},l.each(i,function(a){a._expressionKeys[b.id]||(a._expressionKeys[b.id]=!0,a._expressions.push(g))})),o||(j="<!-- "+b.id+":blocks -->"+j)),j}};l.VirtualElement=l.inherit(m,{tagName:function(a){return a?(this._tagName=a,this):this._tagName},html:function(a){return arguments.length>0?(a=null==a?"":a,this._state?this._state.html!==a&&(this._state.html=a,ib.html(this._el,a)):(this._innerHTML=a,ib.html(this._el,a)),this._children=[],this):this._innerHTML||""},text:function(a){return arguments.length>0?(null!=a&&(a=h(a),this.html(a)),this):this.html()},parent:function(){return this._parent},children:function(a){return"number"==typeof a?this._children[a]:this._children},attr:function(a,c){var d,e=this;if("string"==typeof a){var f=this._tagName,g=this._attributes.type,h=c,i=fb.data(this),j=this._getAttr("value");if(a=l.unwrapObservable(a),a=ib.attrFix[a]||a,c=l.unwrapObservable(c),l.isObservable(h)&&"value"==a&&ib.valueTagNames[f]&&(!g||ib.valueTypes[g])?(i.subscribe="select"==f?"change":"input",i.valueObservable=h):!l.isObservable(h)||"checked"!=a||"checkbox"!=g&&"radio"!=g||(i.subscribe="click",i.valueObservable=h),1==arguments.length)return d=this._getAttr(a),void 0===d?null:d;"checked"!=a||null==c||this._fake?"disabled"==a&&(c=c?"disabled":null):c="radio"==this._attributes.type&&"string"==typeof c&&j!=c&&null!=j?null:c?"checked":null,"textarea"!=f||"value"!=a||this._el?"value"==a&&"select"==f?(this._values=b(l.toArray(c)),ib.attr(this._el,a,c)):(this._haveAttributes=!0,this._state?this._state.attributes[a]!==c&&(this._state.attributes[a]=c,ib.attr(this._el,a,c)):(this._attributes[a]=c,ib.attr(this._el,a,c))):this.html(c)}else l.isPlainObject(a)&&l.each(a,function(a,b){e.attr(b,a)});return this},removeAttr:function(a){return this._attributes[a]=null,ib.removeAttr(this._el,a),this},css:function(a,b){var c=this;if("string"==typeof a){if(a=l.unwrap(a),b=l.unwrap(b),!a)return;if(a=a.toString().replace(/-\w/g,function(a){return a.charAt(1).toUpperCase()}),1===arguments.length)return b=this._getCss(a),void 0===b?null:b;"display"==a&&(b="none"==b||!b&&""!==b?"none":""),this._haveStyle=!0,m.CssNumbers[a]||(b=l.toUnit(b)),this._state?this._state.style[a]!==b&&(this._state.style[a]=b,ib.css(this._el,a,b)):(this._style[a]=b,ib.css(this._el,a,b))}else l.isPlainObject(a)&&l.each(a,function(a,b){c.css(b,a)});return this},addChild:function(a,b){var c,d=this._template||this._children;return a&&(a._parent=this,this._childrenEach||this._each?a._each=!0:this._el&&(c=i(a.render(l.domQuery(this))),a._el=c.childNodes[0],"number"==typeof b?this._el.insertBefore(c,this._el.childNodes[b]):this._el.appendChild(c)),"number"==typeof b?d.splice(b,0,a):d.push(a)),this},addClass:function(a){return p("add",this,a),ib.addClass(this._el,a),this},removeClass:function(a){return p("remove",this,a),ib.removeClass(this._el,a),this},toggleClass:function(a,b){b===!1?this.removeClass(a):this.addClass(a)},hasClass:function(a){return-1!=g(this._attributes[W],a)},renderBeginTag:function(){var a;return a="<"+this._tagName,this._haveAttributes&&(a+=this._renderAttributes()),this._haveStyle&&(a+=n(this._style,this._state)),a+=this._isSelfClosing?" />":">"},renderEndTag:function(){return this._isSelfClosing?"":"</"+this._tagName+">"},render:function(a,b){var c="",d="",e=this._el;return void 0!==b&&(this._state={attributes:{},style:{},html:null,expressions:{}},this._states||(this._states={}),this._states[b]=this._state),this._el=void 0,this._execute(a),this._el=e,this._renderMode!=m.RenderMode.None&&(this._renderMode!=m.RenderMode.ElementOnly&&(d=this._state&&null!==this._state.html?this._state.html:null!=this._innerHTML?this._innerHTML:this.renderChildren(a,b)),c+=this.renderBeginTag(),c+=d,c+=this.renderEndTag()),this._state=null,c},renderChildren:function(a,b){for(var c,d,e="",f=this._template||this._children,g=f.length,h=-1;++h<g;)c=f[h],"string"==typeof c?e+=c:m.Is(c)?(c._each=c._each||this._each,e+=c.render(a,b)):a?(d=lb.GetValue(a._context,null,c),this._state&&(this._state.expressions[h]=d),e+=d):e+=!this._each&&c.lastResult?c.lastResult:lb.GetValue(null,null,c);return e},sync:function(a,b,c){b&&(this._state=this._states[b],this._el=c,this._each=!1,this._sync=!0),this._execute(a),this.renderBeginTag(),this._innerHTML||this._childrenEach||this._renderMode==m.RenderMode.None||this.syncChildren(a,b),this.renderEndTag(),b&&(this._state=null,this._el=void 0,this._each=!0,this._sync=!1)},syncChildren:function(a,b,c){for(var d,e,f,g=this._template||this._children,h=g.length,j=this._state,k=8==this._el.nodeType?this._el.nextSibling:this._el.childNodes[c||0],l=-1;++l<h;)f=g[l],f.isExpression?a&&(e=lb.GetValue(a._context,null,f,j?lb.ValueOnly:lb.Html),(!j||j&&j.expressions[l]!==e)&&(j?(j.expressions[l]=e,k?(8==k.nodeType&&(k=k.nextSibling),k.nodeValue=e,k=k.nextSibling):this._el.textContent=e):(this._el.insertBefore(i(e),k),d=k,k=k.nextSibling,this._el.removeChild(d)))):"string"!=typeof f&&f._renderMode!=m.RenderMode.None?(f._each=f._each||this._each,f.sync(a,b,k),k=k.nextSibling):k=k.nextSibling},updateChildren:function(a,b,c,d){for(var e,f=this._template,g=f[0],h=1===f.length&&m.Is(g),i=d.childNodes,j=c.getSyncIndex(),k=c._context.childs,l=this._length(),n=this._headers?this._headers.length:0,o=-1;++o<b;)c._context=e=k[o],e.$this=a[o],e.$parent=e.$parentContext.$this,h?g.sync(c,j+o,i[o+n]):this.syncChildren(c,j+o,o*l+n);c.popContext()},_length:function(){for(var a=this._template,b=-1,c=0;++b<a.length;)a[b]._renderMode!==m.RenderMode.None&&(c+=1);return c},_getAttr:function(a){var b=this._state;return b&&void 0!==b.attributes[a]?b.attributes[a]:this._attributes[a]},_getCss:function(a){var b=this._state;return b&&void 0!==b.style[a]?b.style[a]:this._style[a]},_execute:function(a){if(a&&(this._each&&(this._el=void 0),this._renderMode!=m.RenderMode.None)){var b,c=this._attributes[cb];(!c||a._serverData)&&(fb.createIfNotExists(this),a.applyContextToElement(this),c=this._attributes[cb],b=fb.byId(c)),this._attributeExpressions.length&&this._executeAttributeExpressions(a._context),a.executeQuery(this,this._attributes[db]),b&&!b.haveData&&fb.clear(this)}},_renderAttributes:function(){var a,b,c=this._attributes,d=this._state,e="";"option"==this._tagName&&this._parent._values&&(d?d.attributes.selected=this._parent._values[d.attributes.value]?"selected":null:c.selected=this._parent._values[c.value]?"selected":null);for(a in c)b=c[a],d&&ab.call(d.attributes,a)||(""===b?e+=" "+a:null!=b&&(e+=" "+a+'="'+b+'"'));if(d)for(a in d.attributes)b=d.attributes[a],""===b?e+=" "+a:null!=b&&(e+=" "+a+'="'+b+'"');return e},_createAttributeExpressions:function(a){var b,c=this._attributeExpressions,d=this._attributes[cb],e=this._each;l.each(this._attributes,function(f,g){b=!e&&a&&a[d+g]?lb.Create(a[d+g],g):lb.Create(f,g),b&&c.push(b)})},_executeAttributeExpressions:function(a){for(var b,c,d,e=this._el?!1:!0,f=this._state&&this._state.attributes,g=fb.byId(f?f[cb]:this._attributes[cb]),h=this._attributeExpressions,i=0;i<h.length;i++)c=h[i],d=lb.GetValue(a,g,c),b=c.attributeName,(f&&f[b]!==d||!f)&&(e?this._state?this._state.attributes[b]=d:this._attributes[b]=d:ib.attr(this._el,b,d))}}),m.Is=function(a){return a&&a.__identity__==bb},m.RenderMode={All:0,ElementOnly:2,None:4},m.CssNumbers={columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0};var mb=!0;if("undefined"!=typeof document){var nb=document.createElement("div");nb.classList&&(nb.classList.add("a","b"),mb="a b"==nb.className)}var ob={insert:function(a,b,c){b=q(a,b);var d,e,f=a.childNodes[b];l.each(c,function(b){if(d=11==b.nodeType?b.childNodes.length:0,e=b.childNodes?b.childNodes[0]:void 0,f?a.insertBefore(b,f):a.appendChild(b),d)for(;d;)r("add",e),e=e.nextSibling,d--;else r("add",b)})},remove:function(a,b,c){var d,e=0;for(b=q(a,b);c>e;e++)d=a.childNodes[b],d&&r("remove",d)&&b++},setVisibility:function(a,b){b?ob.show(a):ob.hide(a)},show:function(a){r("show",a)},hide:function(a){r("hide",a)}};l.VirtualComment=l.inherit(m,t,{renderBeginTag:function(){var a=this._getAttr(cb),b="<!-- ";return a&&(b+=a+":"),b+=this._commentText.replace(V,"")+" -->"},renderEndTag:function(){var a=this._getAttr(cb),b="<!-- ";return a&&(b+=a+":"),b+="/blocks -->"},_executeAttributeExpressions:l.noop}),t.Is=function(a){return t.prototype.isPrototypeOf(a)};var pb={};z.QueryCache={},z.prototype={options:function(){return this._options},dataIndex:x("_dataIndex"),context:x("_context"),popContext:function(){this._context&&(this._context=this._context.$parentContext)},applyContextToElement:function(a){var b=fb.createIfNotExists(a);b.domQuery=this,b.context=this._context,(this._hasChanged||a._each&&!a._parent._each)&&(a._parent&&!a._each&&(b=fb.createIfNotExists(a._parent),b.childrenContext=this._context),this._hasChanged=!1,b.haveData=!0)},pushContext:function(a){var b,c=this._context,d=c?c.$parents.slice(0):[];return this._hasChanged=!0,c&&d.unshift(c.$this),b={$this:a,$root:c?c.$root:a,$parent:c?c.$this:null,$parents:c?d:[],$index:this._dataIndex||null,$parentContext:c||null},b.$context=b,this._context=b,this.applyDefinedContextProperties(),b},getSyncIndex:function(){for(var a=this._context,b="";a&&a.$index;)b=a.$index.__value__+"_"+b,a=a.$parentContext;return b},contextBubble:function(a,b){var c=this._context;this._context=a,b(),this._context=c},addProperty:function(a,b){this._contextProperties[a]=b,this.applyDefinedContextProperties()},removeProperty:function(a){delete this._contextProperties[a]},applyDefinedContextProperties:function(){var a,b=this._context,c=this._contextProperties;for(a in c)b[a]=c[a]},executeElementQuery:function(a){var b=m.Is(a)?a._attributes[db]:1==a.nodeType?a.getAttribute(db):a.nodeValue.substring(a.nodeValue.indexOf("blocks")+6).replace(V,"");b&&this.executeQuery(a,b)},executeQuery:function(a,b){var c=z.QueryCache[b]||A(b,a);this.executeMethods(a,c)},executeMethods:function(a,b){for(var c,d,e,f,g,h,i,j=fb.data(a),k=0,n=0;n<b.length;n++)if(h=this._context,c=l.queries[b[n].name],f=b[n].params,d=c.passDomQuery?[this]:[],!m.Is(a)||c.call||c.preprocess||!c.update&&!c.ready){kb.startObserving();for(var o=0;o<f.length;o++)if(g=f[o],i=jb[g]=jb[g]||new Function("c","with(c){with($this){ return "+g+"}}"),e={},e.rawValue=i(h),e.value=l.unwrapObservable(e.rawValue),c.passDetailValues?(e.isObservable=l.isObservable(e.rawValue),e.containsObservable=kb.currentObservables().length>k,k=kb.currentObservables().length,d.push(e)):d.push(c.passRawValues?e.rawValue:e.value),c===l.queries["if"]||c===l.queries.ifnot){if(!e.value&&c===l.queries["if"]||e.value&&c===l.queries.ifnot){if(!f[2])break;this.executeQuery(a,f[2]);break}this.executeQuery(a,f[1]);break}if(m.Is(a)){if(t.Is(a)&&!c.supportsComments)continue;if(c.call)c.call===!0?a[b[n].name].apply(a,d):(d.unshift(c.prefix||b[n].name),a[c.call].apply(a,d));else if(c.preprocess&&c.preprocess.apply(a,d)===!1){this.subscribeObservables(b[n],j,h);break}}else if(c.call){var p=fb.data(a).virtual;p._each&&(p=m("div"),p._el=a,p._fake=!0),c.call===!0?p[b[n].name].apply(p,d):(d.unshift(c.prefix||b[n].name),p[c.call].apply(p,d))}else j&&j.preprocess&&c.ready?c.ready.apply(a,d):c.update&&c.update.apply(a,d);this.subscribeObservables(b[n],j,h)}else j.haveData=!0,j.execute||(j.execute=[],j.executeHash={}),j.executeHash[b[n].query]||(j.execute.push(b[n]),j.executeHash[b[n].query]=!0)},subscribeObservables:function(a,b,c){var d=kb.stopObserving();b&&(b.haveData=!0,l.each(d,function(d){b.observables[d.__id__+a.query]||(b.observables[d.__id__+a.query]=d,d._elements.push({elementId:b.id,cache:[a],context:c}))}))},createElementObservableDependencies:function(a){for(var b,c,d,e=0;e<a.length;e++)if(b=a[e],d=(b.tagName||"").toLowerCase(),1===b.nodeType||8==b.nodeType){if(c=fb.data(b)){if(this._context=c.context||this._context,c.dom=b,c.execute&&this.executeMethods(b,c.execute),c.subscribe){var f=c.updateOn||c.subscribe;k(b,f,qb[f])}c.preprocess=!1,this._context=c.childrenContext||this._context}"script"!=d&&"code"!=d&&-1==(" "+b.className+" ").indexOf("bl-skip")&&this.createElementObservableDependencies(b.childNodes)}this._context=null},createFragment:function(a){var b=i(a);return this.createElementObservableDependencies(b.childNodes),b},cloneContext:function(a){var b=l.clone(a);return b.$context=b,b}};var qb={change:function(a){var b=a.target||a.srcElement;qb.getSetValue(b,fb.data(b).valueObservable)},click:function(a){qb.change(a)},input:function(a){var b=a.target||a.srcElement;qb.getSetValue(b,fb.data(b).valueObservable)},keydown:function(a){var b=a.target||a.srcElement,c=b.value,d=fb.data(b);d&&setTimeout(function(){c!=b.value&&qb.getSetValue(b,fb.data(b).valueObservable)})},getSetValue:function(a,b){var c=a.tagName.toLowerCase(),d=a.getAttribute("type");if("checkbox"==d)b(a.checked);else if("select"==c&&a.getAttribute("multiple")){var e=[],f=a.selectedOptions;f?l.each(f,function(a){e.push(a.getAttribute("value"))}):l.each(a.options,function(a){a.selected&&e.push(a.getAttribute("value"))}),b(e)}else l.core.skipExecution={element:a,attributeName:"value"},b(a.value),l.core.skipExecution=void 0}};l.extend(X,{"if":{},ifnot:{},template:{passDomQuery:!0,passRawValues:!0,preprocess:function(a,b,c){var d,e=a._serverData;b=l.$unwrap(b),l.isElement(b)?d=b.innerHTML:(d=document.getElementById(b),d=d?d.innerHTML:b),d&&(c&&l.queries["with"].preprocess.call(this,a,c,"$template"),e&&e.templates&&e.templates[fb.id(this)]||(this.html(d),!this._each&&this._el&&(this._children=u(this._el.childNodes[0],this),this._innerHTML=null)))}},define:{passDomQuery:!0,preprocess:function(a,b,c){if(this._renderMode!=m.RenderMode.None){var d=a.context(),e=a.cloneContext(d),f=this.renderEndTag;a.context(e),a.addProperty(b,c),this.renderEndTag=function(){return a.removeProperty(b),a.context(d),f.call(this)}}}},"with":{passDomQuery:!0,passRawValues:!0,preprocess:function(a,b,c){if(this._renderMode!=m.RenderMode.None){var d=this.renderEndTag;c&&a.addProperty(c,b),a.pushContext(b),this.renderEndTag=function(){return c&&a.removeProperty(c),a.popContext(),d.call(this)}}}},each:{passDomQuery:!0,passRawValues:!0,supportsComments:!0,_getStaticHtml:function(a,b){var c,d,e,f=b._children,g=b._headers,h=b._footers,i=-1,j="",k="";if(g)for(c=Math.max(g.length,h.length);++i<c;)g[i]&&(j+=g[i].render(a)),h[i]&&(k+=h[i].render(a));else for(g=b._headers=[],h=b._footers=[];++i<f.length;)e=f[i],e.isExpression||("string"!=typeof e?(e._each=!0,d=e._attributes["data-role"],"header"==d?(j+=e.render(a),g.push(e),f.splice(i--,1)):"footer"==d&&(k+=e.render(a),h.push(e),f.splice(i--,1))):""===e.replace(V,"").replace(/(\r\n|\n|\r)/gm,"")&&f.splice(i--,1));return{header:j,headersCount:g.length,footer:k,footersCount:h.length}},preprocess:function(a,b){var c,d,e,f,g,h=a.getSyncIndex(),i=this,j=0;if(this._sync)return void i.updateChildren(a,b,this._el);if(this._template=this._template||this._children,this._childrenEach=!0,a._serverData&&(d=a._serverData[fb.id(this)],a._serverData[fb.id(this)]=void 0,d)){var k=document.createElement("div");k.innerHTML=d,i._template=i._children=u(k.childNodes[0],i)}if(e=X.each._getStaticHtml(a,i),g=e.header,l.isObservable(b)&&(d=fb.data(i),d.eachData={id:b.__id__,element:i,startOffset:e.headersCount,endOffset:e.footersCount}),c=l.unwrapObservable(b),f=a._context.childs=[],l.isArray(c))for(j=0;j<c.length;j++)a.dataIndex(l.observable.getIndex(b,j)),f.push(a.pushContext(c[j])),g+=this.renderChildren(a,h+j),a.popContext(),a.dataIndex(void 0);else if(l.isObject(c))for(var m in c)a.dataIndex(l.observable.getIndex(b,j)),a.pushContext(c[m]),g+=i.renderChildren(a),a.popContext(),a.dataIndex(void 0),j++;this.html(g+e.footer)}},options:{passDomQuery:!0,passRawValues:!0,preprocess:function(a,b,c){c=c||{};for(var d,e="$this",f=lb.Create("{{"+(c.text||e)+"}}"),g=lb.Create("{{"+(c.value||e)+"}}","value"),h=l.isString(c.caption)&&new m("option"),i=new m("option"),j=this._children,k=0;k<j.length;k++)d=j[k],(!d._attributes||d._attributes&&!d._attributes["data-role"])&&j.splice(k--,1);i._attributeExpressions.push(g),i._children.push(f),i._parent=this,this._children.push(i),h&&(h._attributes["data-role"]="header",h._innerHTML=c.caption,this.addChild(h)),l.queries.each.preprocess.call(this,a,b)}},render:{passDetailValues:!0,preprocess:function(a){if(!this._each&&!this._sync)throw new Error("render() is supported only() in each context");this._renderMode=a.value?m.RenderMode.All:m.RenderMode.None,a.containsObservable&&this._renderMode==m.RenderMode.None&&(this._renderMode=m.RenderMode.ElementOnly,this.css("display","none"),fb.data(this,"renderCache",this))},update:function(a){var b=fb.data(this);b.renderCache&&a.value&&(this.innerHTML=b.renderCache.renderChildren(l.domQuery(this)),l.domQuery(this).createElementObservableDependencies(this.childNodes),b.renderCache=null),this.style.display=a.value?"":"none"}},updateOn:{preprocess:function(a){fb.data(this).updateOn=a}},animate:{preprocess:function(a){fb.data(this).animateCallback=a}},setClass:{preprocess:function(a,b){arguments.length>1?this.toggleClass(a,!!b):this.addClass(a)},update:function(a,b){var c=fb.data(this).virtual;c._each&&(c=m(),c._el=this),arguments.length>1?c.toggleClass(a,b):c.addClass(a)}},html:{call:!0},text:{call:!0},visible:{call:"css",prefix:"display"},attr:{passRawValues:!0,call:!0},val:{passRawValues:!0,call:"attr",prefix:"value"},checked:{passRawValues:!0,call:"attr"},disabled:{passRawValues:!0,call:"attr"},css:{call:!0},width:{call:"css"},height:{call:"css"},focused:{preprocess:l.noop,update:function(a){a&&this.focus()}},on:{ready:function(a,b,c){if(a&&b){b=l.toArray(b);var d=this,e=function(a){var d=l.context(this),e=d.$template||d.$view||d.$root;l.each(b,function(b){b.call(e,a,c)})};a=l.isArray(a)?a:a.toString().split(" "),l.each(a,function(a){f(d,a,e)})}}}}),l.each(["click","dblclick","mousedown","mouseup","mouseover","mousemove","mouseout","select","change","submit","reset","focus","blur","keydown","keypress","keyup"],function(a){l.queries[a]={passRawValues:!0,ready:function(b,c){l.queries.on.ready.call(this,a,b,c)}}});var rb="__blocks.observable__";B.prototype={dispose:function(){this.childNodesCount=void 0,this.startIndex=0,this.observableLength=void 0,this.startOffset=0,this.endOffset=0},setStartIndex:function(a){this.startIndex=a+this.startOffset},setChildNodesCount:function(a){void 0===this.childNodesCount&&(this.observableLength=this.observable.__value__.length),this.childNodesCount=a-(this.startOffset+this.endOffset)},chunkLength:function(a){var b,c=this.chunkLengths,d=fb.id(a),e=c[d]||(this.childNodesCount||a.childNodes.length)/(this.observableLength||this.observable.__value__.length);return b=l.isNaN(e)||1/0===e?0:Math.round(e),c[d]=b,b},getAt:function(a,b){for(var c=this.chunkLength(a),d=a.childNodes,e=[],f=0;c>f;f++)e[f]=d[b*c+f+this.startIndex];return e},insertAt:function(a,b,c){ob.insert(a,this.chunkLength(a)*b+this.startIndex,l.isArray(c)?c:[c])},removeAt:function(a,b){var c=this.chunkLength(a);ob.remove(a,c*b+this.startIndex,c)},remove:function(a,b){var c=this;this.each(function(d){for(var e=0;b>e;e++)c.removeAt(d,a)}),fb.collectGarbage(),this.dispose(),this.observable._indexes.splice(a,b)},removeAll:function(){var a=this,b=this.observable.__value__;this.each(function(c){l.each(b,function(){a.removeAt(c,0)})})},add:function(a,b){var c=this,d=this.observable;l.each(a,function(a,c){d._indexes.splice(b+c,0,l.observable(b+c))}),this.each(function(e,f){var g,h=l.domQuery(e),i=l.context(e),j="";if(h.contextBubble(i,function(){g=h.getSyncIndex();for(var c=0;c<a.length;c++)h.dataIndex(l.observable.getIndex(d,c+b,!0)),i.childs.splice(c+b,0,h.pushContext(a[c])),j+=f.renderChildren(h,g+(c+b)),h.popContext(),h.dataIndex(void 0)}),0===e.childNodes.length)ib.html(e,j),h.createElementObservableDependencies(e.childNodes);else{var k=h.createFragment(j);c.insertAt(e,b,k)}}),this.dispose()},each:function(a){for(var b=0,c=this.observable._elements;b<c.length;b++){var d=c[b];d.element||(d.element=fb.data(d.elementId).dom),this.setup(d.element,a)}},setup:function(a,b){if(a){var c,d,e,f,g=fb.data(a).eachData;if(g&&g.id==this.observable.__id__)if(c=g.element,this.startOffset=g.startOffset,this.endOffset=g.endOffset,1==a.nodeType)this.setStartIndex(0),this.setChildNodesCount(a.childNodes.length),b(a,c,a);else{for(d=fb.id(a),f=a.parentNode.firstChild,e=0;f!=a;)f=f.nextSibling,e++;for(this.setStartIndex(e+1);f&&(8!=f.nodeType||1!=f.nodeValue.indexOf(d+":/blocks"));)f=f.nextSibling,e++;this.setChildNodesCount(e-this.startIndex),b(a.parentNode,c,a)}}}};var sb=1;l.observable=function(a,b){var c=function(a){0===arguments.length&&U.trigger(c,"get",c);var b=E(c),d=c.update;return 0===arguments.length?(kb.registerObservable(c),b):(l.equals(a,b,!1)||U.trigger(c,"changing",a,b)===!1||(c.update=l.noop,c._dependencyType?2==c._dependencyType&&c.__value__.set.call(c.__context__,a):l.isArray(b)&&l.isArray(a)&&c.reset?c.reset(a):c.__value__=a,c.update=d,c.update(),U.trigger(c,"change",a,b)),c)};return a=l.unwrap(a),l.extend(c,l.observable.fn.base),c.__id__=sb++,c.__value__=a,c.__context__=b||l.__viewInInitialize__||c,c._expressionKeys={},c._expressions=[],c._elementKeys={},c._elements=[],l.isArray(a)?(l.extend(c,l.observable.fn.array),c._indexes=[],c._chunkManager=new B(c)):l.isFunction(a)?c._dependencyType=1:a&&l.isFunction(a.get)&&l.isFunction(a.set)&&(c._dependencyType=2),C(c),c};var tb={};l.extend(l.observable,{getIndex:function(a,b,c){if(!l.isObservable(a))return tb[b]||(tb[b]=l.observable(b)),tb[b];var d,e=a._indexes;return e?e.length==a.__value__.length||c?d=e[b]:(d=l.observable(b),e.splice(b,0,d)):d=l.observable(b),d},fn:{base:{__identity__:rb,update:function(){var a,b,c,d,e,f,g=this._elements;l.eachRight(this._expressions,function(b){d=b.element,c=b.context,d||(a=fb.data(b.elementId),d=b.element=a.dom);try{f=l.unwrap(jb[b.expression](c))}catch(g){f=""}f=null==f?"":f.toString(),e=b.length-f.length,b.length=f.length,d?b.attr?d.setAttribute(b.attr,lb.GetValue(c,null,b.entire)):d.nextSibling?(d=d.nextSibling,d.nodeValue=f+d.nodeValue.substring(b.length+e)):d.parentNode.appendChild(document.createTextNode(f)):(d=a.virtual,b.attr&&d.attr(b.attr,lb.GetValue(c,null,b.entire)))});for(var h=0;h<g.length;h++)f=g[h],d=f.element,!d&&fb.data(f.elementId)&&(d=f.element=fb.data(f.elementId).dom,d||(d=fb.data(f.elementId).virtual)),m.Is(d)||document.body.contains(d)?(b=l.domQuery(d),b.contextBubble(f.context,function(){b.executeMethods(d,f.cache)})):(g.splice(h,1),h-=1);return l.each(this._dependencies,function(a){C(a),a.update()}),l.each(this._indexes,function(a,b){a(b)}),this},on:function(a,b,c){return U.on(this,a,b,c||this.__context__),this},once:function(a,b,c){return U.once(this,a,b,c||this.__context__),this},off:function(a,b){return U.off(this,a,b),this},extend:function(a){var b,c=l.observable[a];return 0===arguments.length?(l.core.expressionsCreated&&l.core.applyExpressions(l.type(this()),this),this):c?(b=c.apply(this,l.toArray(arguments).slice(1)),l.isObservable(b)?b:this):void 0},clone:function(a){var b=this.__value__;return l.observable(a?l.clone(b):b,this.__context__)},toString:function(){var a=this.__context__,b=1==this._dependencyType?this.__value__.call(a):2==this._dependencyType?this.__value__.get.call(a):this.__value__;return kb.registerObservable(this),null!=b&&l.isFunction(b.toString)?b.toString():String(b)}},array:{reset:function(a){if(0===arguments.length)return this.removeAll(),this;a=l.unwrap(a);var b=this.__value__,c=this._chunkManager,d=Math.max(a.length-b.length,0),e=Math.max(b.length-a.length,0),f=a.length-d;return U.trigger(this,"removing",{type:"removing",items:b,index:0}),U.trigger(this,"adding",{type:"adding",items:a,index:0}),c.each(function(b,c){var d=l.domQuery(b);d.contextBubble(l.context(b),function(){c.updateChildren(a,f,d,b)})}),d>0?c.add(a.slice(b.length),b.length):e>0&&c.remove(a.length,e),this.__value__=a,U.trigger(this,"remove",{type:"remove",items:b,index:0}),U.trigger(this,"add",{type:"add",items:a,index:0}),this},add:function(a,b){return this.splice(l.isNumber(b)?b:this.__value__.length,0,a),this},addMany:function(a,b){return this.splice.apply(this,[l.isNumber(b)?b:this.__value__.length,0].concat(l.toArray(a))),this},swap:function(a,b){var c,d=this(),e=this._elements,f=this._chunkManager;l.swap(d,a,b);for(var g=0;g<e.length;g++)c=e[g].element,a>b?(f.insertAt(c,a,f.getAt(c,b)),f.insertAt(c,b,f.getAt(c,a))):(f.insertAt(c,b,f.getAt(c,a)),f.insertAt(c,a,f.getAt(c,b)));return this},move:function(a,b){var c,d=this(),e=this._elements,f=this._chunkManager;l.move(d,a,b),b>a&&b++;for(var g=0;g<e.length;g++)c=e[g].element,f.insertAt(c,b,f.getAt(c,a));return this},remove:function(a,b){return this.removeAll(a,b,!0)},removeAt:function(a,b){return l.isNumber(b)||(b=1),this.splice(a,b),this},removeAll:function(a,b,c){var d,e,f=this.__value__,g=this._chunkManager;if(0===arguments.length)(U.has(this,"removing")||U.has(this,"remove"))&&(d=l.clone(f)),U.trigger(this,"removing",{type:"removing",items:d,index:0}),g.removeAll(),this._indexes=[],d=f.splice(0,f.length),U.trigger(this,"remove",{type:"remove",items:d,index:0});else{var h,i=l.isFunction(a);for(e=0;e<f.length&&(h=f[e],!(h===a||i&&a.call(b,h,e,f))||(this.splice(e,1),e-=1,!c));e++);}return this.update(),this},concat:function(){var a=this();return a.concat.apply(a,l.toArray(arguments))},slice:function(a,b){return arguments.length>1?this().slice(a,b):this().slice(a)},join:function(a){return arguments.length>0?this().join(a):this().join()},pop:function(){var a=this,b=a();return a.splice(b.length-1,1)[0]},push:function(){return this.addMany(arguments),this.__value__.length},reverse:function(){var a=this().reverse(),b=this._chunkManager;return this._indexes.reverse(),b.each(function(c){for(var d=1;d<a.length;d++)b.insertAt(c,0,b.getAt(c,d))}),this.update(),a},shift:function(){return this.splice(0,1)[0]},sort:function(a){for(var b,c,d=this.__value__,e=d.length,f=arguments.length>0,g=this._chunkManager,h=this._indexes,i=0;e>i;i++){var j=[d[i],i];g.each(function(a){j.push(g.getAt(a,i))}),d[i]=j}for(d.sort(function(b,c){return b=b[0],c=c[0],f?a.call(this,b,c):c>b?-1:b>c?1:0}),h.length>0&&(this._indexes=[]),i=0;e>i;i++)c=d[i],h.length>0&&this._indexes.push(h[c[1]]),b=2,g.each(function(a){g.insertAt(a,e,c[b]),b++}),d[i]=c[0];return this.update(),d},splice:function(a,b){var c,d=this.__value__,e=this._chunkManager,f=[],g=arguments;return a=0>a?d.length-a:a,b&&a<d.length&&a>=0&&(b=Math.min(d.length-a,b),f=d.slice(a,a+b),U.trigger(this,"removing",{type:"removing",items:f,index:a}),e.remove(a,b),f=d.splice(a,b),U.trigger(this,"remove",{type:"remove",items:f,index:a})),g.length>2&&(c=l.toArray(g),c.splice(0,2),U.trigger(this,"adding",{type:"adding",index:a,items:c}),e.add(c,a),d.splice.apply(d,[a,0].concat(c)),U.trigger(this,"add",{type:"add",index:a,items:c})),this.update(),f},unshift:function(){return this.addMany(arguments,0),this.__value__.length}}}});var ub={waiting:{},initExpressionExtender:function(a){var b=a.clone();return b.view=l.observable([]),b.view._connections={},b.view._observed=[],b.view._updateObservable=l.bind(ub.updateObservable,b),b._operations=a._operations?l.clone(a._operations):[],b._getter=l.bind(ub.getter,b),b.view._initialized=!1,b.view.on("get",b._getter),b.on("add",function(){b.view._initialized&&(b.view._connections={},b.view.reset(),ub.executeOperations(b))}),b.on("remove",function(){b.view._initialized&&(b.view._connections={},b.view.reset(),ub.executeOperations(b))}),b},getter:function(){U.off(this.view,"get",this._getter),this._getter=void 0,this.view._initialized=!0,ub.executeOperationsPure(this)},updateObservable:function(){ub.executeOperations(this)},executeOperationsPure:function(a){var b=[],c=a.view._observed,d=a.view._updateObservable;l.each(c,function(a){U.off(a,"change",d)}),c=a.view._observed=[],kb.startObserving(),l.each(a._operations,function(c){if("step"==c.type){var d=a.view;a.view=l.observable([]),a.view._connections={},b.length&&ub.executeOperationsChunk(a,b),c.step.call(a.__context__),a.view=d}else b.push(c)}),b.length&&ub.executeOperationsChunk(a,b),l.each(kb.stopObserving(),function(a){c.push(a),a.on("change",d)})},executeOperations:function(a){var b=a.__id__,c=ub.waiting;c[b]||(c[b]=!0,setTimeout(function(){ub.executeOperationsPure(a),c[b]=!1},0))},executeOperationsChunk:function(a,b){var c="add",d="remove",e="exists",f=e,g=a.__value__,h=a.view,i=h._connections,j={},k=0,m=h.update,n=0,o=g.length;h.update=l.noop,l.each(b,function(c){"skip"==c.type?(n=c.skip,l.isFunction(n)&&(n=n.call(a.__context__)),n=l.unwrap(n)):"take"==c.type?(o=c.take,l.isFunction(o)&&(o=o.call(a.__context__)),o=l.unwrap(o)):"sort"==c.type&&(g=l.isString(c.sort)?l.clone(g).sort(function(a,b){return a[c.sort]-b[c.sort]}):l.isFunction(c.sort)?l.clone(g).sort(c.sort):l.clone(g).sort(),1==b.length&&b.push({type:"filter",filter:function(){return!0}}))}),l.each(g,function(m,p){if(0>=o){for(;h().length-k>0;)h.removeAt(h().length-1);return!1}switch(l.each(b,function(b){var h=b.filter;if(f=void 0,h){if(!h.call(a.__context__,m,p,g))return f=void 0,void 0!==i[p]&&(f=d),!1;f=e,void 0===i[p]&&(f=c)}else if("skip"==b.type){if(f=e,n-=1,n>=0)return f=d,!1;0>n&&void 0===i[p]&&(f=c)}else if("take"==b.type){if(0>=o)return f=d,!1;o-=1,f=e,void 0===i[p]&&(f=c)}}),f){case c:j[p]=k,h.splice(k,0,m),k++;break;case d:h.removeAt(k);break;case e:j[p]=k,k++}}),h._connections=j,h.update=m,h.update()}};l.observable.filter=function(a){var b=ub.initExpressionExtender(this),c=a;return(!l.isFunction(c)||l.isObservable(c))&&(c=function(b){var c=l.unwrap(a),d=String(c).toLowerCase();return b=String(l.unwrap(b)).toLowerCase(),!c||-1!=b.indexOf(d)}),b._operations.push({type:"filter",filter:c}),b},l.observable.step=function(a){var b=ub.initExpressionExtender(this);return b._operations.push({type:"step",step:a}),b},l.observable.skip=function(a){var b=ub.initExpressionExtender(this);return b._operations.push({type:"skip",skip:a}),b},l.observable.take=function(a){var b=ub.initExpressionExtender(this);return b._operations.push({type:"take",take:a}),b},l.observable.sort=function(a){var b=ub.initExpressionExtender(this);return b._operations.push({type:"sort",sort:a}),b},l.query=function(a,b){l.domReady(function(){l.$unwrap(b,function(b){l.isElement(b)||(b=document.body);var c=new z,d=u(b)[0],e=window.__blocksServerData__;c.pushContext(a),c._serverData=e,e?d.render(c):d.sync(c),c.createElementObservableDependencies([b])
				})})},l.executeQuery=function(a,b){var c=m.Is(a)?"preprocess":"update",d=Array.prototype.slice.call(arguments,2),e=l.queries[b];e.passDomQuery&&d.unshift(l.domQuery(a)),e[c].apply(a,d)},l.context=function(a,b){if(a=l.$unwrap(a)){var c=fb.data(a);if(c){if(b&&c.childrenContext)return c.childrenContext;if(c.context)return c.context}return l.context(m.Is(a)?a._parent:a.parentNode,!0)}return null},l.dataItem=function(a){var b=l.context(a);return b?b.$this:null},l.isObservable=function(a){return!!a&&a.__identity__===rb},l.unwrapObservable=function(a){return a&&a.__identity__===rb?a():a},l.domQuery=function(a){if(a=l.$unwrap(a)){var b=fb.data(a,"domQuery");return b?b:l.domQuery(m.Is(a)?a._parent:a.parentNode)}return null},l.extend(l.queries,{view:{passDomQuery:!0,preprocess:function(a,b){b.isActive()?(this.css("display",""),b._html&&l.queries.template.preprocess.call(this,a,b._html,b)):this.css("display","none"),X["with"].preprocess.call(this,a,b,"$view")},update:function(a,b){b.isActive()?(b._html&&(X["with"].preprocess.call(this,a,b,"$view"),this.innerHTML=b._html,b._children=b._html=void 0,l.each(u(this.childNodes[0]),function(b){m.Is(b)&&b.sync(a)}),a.createElementObservableDependencies(this.childNodes)),ob.show(this)):ob.hide(this)}},navigateTo:{update:function(a,b){function c(c){c=c||window.event,c.preventDefault(),c.returnValue=!1,l.isString(a)?window.location.href=a:a.navigateTo(a,b)}f(this,"click",c)}},trigger:{}});var vb={required:{priority:9,validate:function(a,b){return a!==b.defaultValue&&""!==a&&a!==!1&&void 0!==a&&null!==a?!0:void 0}},minlength:{priority:19,validate:function(a,b,c){return void 0===a||null===a?!1:a.length>=parseInt(c,10)}},maxlength:{priority:29,validate:function(a,b,c){return void 0===a||null===a?!0:a.length<=parseInt(c,10)}},min:{priority:39,validate:function(a,b,c){return void 0===a||null===a?!1:a>=c}},max:{priority:49,validate:function(a,b,c){return void 0===a||null===a?!1:c>=a}},email:{priority:59,validate:function(a){return/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i.test(a)}},url:{priority:69,validate:function(a){return/^(https?:\/\/)?([\da-z\.-]+)\.([a-z\.]{2,6})([\/\w \.-]*)*\/?$/.test(a)}},date:{priority:79,validate:function(a){return a?!/Invalid|NaN/.test(new Date(a.toString()).toString()):!1}},creditcard:{priority:89,validate:function(a){if(l.isString(a)&&0===a.length)return!1;if(l.isNumber(a)&&(a=a.toString()),/[^0-9 \-]+/.test(a))return!1;var b=0,c=0,d=!1;a=a.replace(/\D/g,"");for(var e=a.length-1;e>=0;e--){var f=a.charAt(e);c=parseInt(f,10),d&&(c*=2)>9&&(c-=9),b+=c,d=!d}return b%10===0}},regexp:{priority:99,validate:function(a,b,c){return l.isRegExp(c)?void 0===a||null===a?!1:c.test(a):!1}},number:{priority:109,validate:function(a){return l.isNumber(a)?!0:l.isString(a)&&0===a.length?!1:/^(-?|\+?)(?:\d+|\d{1,3}(?:,\d{3})+)?(?:\.\d+)?$/.test(a)}},digits:{priority:119,validate:function(a){return/^\d+$/.test(a)}},letters:{priority:129,validate:function(a){return a?/^[a-zA-Z]+$/.test(a):!1}},equals:{priority:139,validate:function(a,b,c){return l.equals(a,l.unwrap(c))}}};l.observable.validation=function(a){var b,c,d=this,e=a.maxErrors,f=this.errorMessages=l.observable([]),g=this._validators=[];this.errorMessage=l.observable("");for(b in a)c=a[b],vb[b]?g.push({option:c,validate:vb[b].validate,priority:vb[b].priority}):("validate"==b||"asyncValidate"==b)&&g.push({option:"",validate:c.validate?c.validate:c,priority:c.priority||Number.POSITIVE_INFINITY,isAsync:"asyncValidate"==b});g.sort(function(a,b){return a.priority>b.priority?1:-1}),this.valid=l.observable(!0),this.validate=function(){var b,h,i,j=d.__value__,k=!0,m=0,n=0;for(f.removeAll();n<g.length&&!(m>=e);n++){if(h=g[n],h.isAsync)return h.validate(j,function(b){F(d,a,!!b)}),!0;b=h.option,c=h.option,l.isPlainObject(b)&&(c=b.value),l.isFunction(c)&&(c=c.call(d.__context__)),i=h.validate(j,a,c),l.isString(i)&&(i=[i]),(l.isArray(i)||!i)&&(f.addMany(l.isArray(i)?i:b&&b.message?[b.message]:c&&l.isString(c)?[c]:[]),k=!1,m++)}return F(this,a,k),this.valid(k),U.trigger(this,"validate"),k},a.validateOnChange&&this.on("change",function(){this.validate()}),a.validateInitially&&this.validate()},l.route=function(a){return H(a)},H.Is=function(a){return H.prototype.isPrototypeOf(a)},H.Has=function(a){return null!=a._routeString},H.Combine=function(a,b){if(!H.Has(b))return a;if(!H.Has(a))return b;var c=H(a+b);return l.extend(c._wildcard,a._wildcard,b._wildcard),l.extend(c._optional,a._optional,b._optional),l.extend(c._validate,a._validate,b._validate),c},H.prototype={wildcard:function(){var a=this._wildcard,b=l.flatten(l.toArray(arguments));return l.each(b,function(b){a[b]=!0}),this},optional:function(a,b){return this._addMetadata("optional",a,b),this},validate:function(a,b){return this._addMetadata("validate",a,b),this},transform:function(a,b){return this._addMetadata("_transform",a,b),this},toString:function(){return this._routeString?this._routeString.toString():""},trailingSlash:function(){return this},_transfromParam:function(a,b){var c=this._transform[a];return""===b&&l.has(this._optional,a)&&(b=this._optional[a]),c?c(b):b},_validateParam:function(a,b){var c=this._validate[a];return c?c(b):!0},_addMetadata:function(a,b,c){var d=this["_"+a];l.isPlainObject(b)?l.each(b,function(a,b){d[b]=a}):l.isString(b)&&(d[b]=c)}},l.core.Router=I,I.GenerateRoute=function(a,b){var c=new I,d=c.registerRoute(a),e=c.routeTo(d,b);return 0===a.indexOf("/")&&0!==e.indexOf("/")?"/"+e:e},I.prototype={registerRoute:function(a,b){a=H(a),b=H(b?this._routes[H(b).toString()].route:void 0);var c=H.Combine(b,a),d=c._routeString=c._routeString.replace(/^\//,""),e=this._generateRouteStringData(d);return this._routes[d]={route:c,data:e,regExCollection:this._generateRouteRegEx(c,e),parent:H.Has(b)?this._routes[b.toString()]:void 0},d},routeTo:function(a,b){var c,d=this._routes[a],e=d.route,f="";return b=b||{},l.each(d.data,function(a){c=a.param,c?e._validateParam(b[c])&&(f+=l.has(b,c)?b[c]:e._optional[c]):f+=a.string}),f},routeFrom:function(a){var b,c=this._getUrlParams,d=[];return a=decodeURI(a),l.each(this._routes,function(e){l.each(e.regExCollection,function(f){if(f.regEx.test(a)){for(b=f.regEx.exec(a);e;)d.unshift({id:e.route._routeString,params:c(e,f.params,b)}),e=e.parent;return!1}})}),d.length?d:null},_getUrlParams:function(a,b,c){var d,e,f=a.route,g={};return l.each(b,function(a,b){d=c[b+1],f._validateParam(a,d)&&(g[a]=f._transfromParam(a,d))}),l.each(a.data,function(a){e=a.param,e&&!g[e]&&l.has(f._optional,e)&&void 0!==f._optional[e]&&(g[e]=f._optional[e])}),g},_generateRouteRegEx:function(a,b){var c,d,e,f,g,h=[],i=this._sliceLastFromRegExString,j=this._getOptionalParametersCombinations(a,b);return l.each(j,function(j){e="^",f=[],l.each(b,function(b){if(g=b.param){if(d=!0,l.has(a._optional,g)&&j[g]||(c=!1),j[g])return;f.push(g),e+=a._wildcard[g]?l.has(a._optional,g)?"(.*?)":"(.+?)":l.has(a._optional,g)?"([^/]*?)":"([^/]+?)"}else"/"==b.string&&(d&&c&&(e=i(e)),d=!1,c=!0),e+=G(b.string)}),d&&c&&(e=i(e)),h.push({regEx:new RegExp(e+"$","i"),params:f})}),h},_sliceLastFromRegExString:function(a){for(var b,c=0;c<a.length&&(b=a.length-c-1,"/"!=a.charAt(b)||"]"==a.charAt(b+1));c++);return a.substring(0,b-1)},_getOptionalParametersCombinations:function(a,b){var c,d,e,f=this._getOptionalParameters(a,b),g=Math.pow(2,f.length),h=f.length,i=[{}];for(d=0;g>d;d++){for(c={},c.__lowestIndex__=h,c.__length__=0,e=0;h>e;e++)d&Math.pow(2,e)&&(e<c.__lowestIndex__&&(c.__lowestIndex__=e),c[f[e]]=!0,c.__length__+=1);c.__length__&&i.push(c)}return i.sort(function(a,b){var c=a.__length__-b.__length__;return c?c:b.__lowestIndex__-a.__lowestIndex__}),i},_getOptionalParameters:function(a,b){var c=[];return l.each(b,function(b){l.has(a._optional,b.param)&&c.push(b.param)}),c},_generateRouteStringData:function(a){var b=this._pushStringData,c=[],d=0;return a.replace(/{{[^}]+}}/g,function(e,f){b(c,a.substring(d,f)),d=f+e.length,c.push({param:e.substring(2,e.length-2)})}),d!=a.length&&b(c,a.substring(d)),c},_pushStringData:function(a,b){var c=b.split("/");l.each(c,function(b,d){b&&a.push({string:b}),d!=c.length-1&&a.push({string:"/"})})}};var wb=function(){var a=Date.now();return function(){return"blocks-"+l.version+"-"+a++}}();J.Execute=function(a){return new J(a)},J.Defaults={type:"GET",url:"",processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",jsonp:"callback",jsonpCallback:function(){return wb()}},J.Accepts={"*":"*/".concat("*"),text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},J.Meta={statusFix:{0:200,1223:204}},J.prototype={execute:function(){var a=this.options,b=window.__blocksServerData__;if("GET"==a.type&&a.data&&this.appendDataToUrl(a.data),b&&b.requests&&b.requests[a.url])this.callSuccess(b.requests[a.url]);else try{"jsonp"==a.dataType?this.scriptRequest():this.xhrRequest()}catch(c){}},xhrRequest:function(){var a=this.options,b=this.createXHR();b.onabort=l.bind(this.xhrError,this),b.ontimeout=l.bind(this.xhrError,this),b.onload=l.bind(this.xhrLoad,this),b.onerror=l.bind(this.xhrError,this),b.open(a.type.toUpperCase(),a.url,a.async,a.username,a.password),b.setRequestHeader("Content-Type",a.contentType),b.setRequestHeader("Accept",J.Accepts[a.dataType||"*"]),b.send(a.data||null)},createXHR:function(){var a=XMLHttpRequest||window.ActiveXObject;try{return new a("Microsoft.XMLHTTP")}catch(b){}},xhrLoad:function(a){var b=a.target,c=J.Meta.statusFix[b.status]||b.status,d=c>=200&&300>c||304===c;d?this.callSuccess(b.responseText):this.callError(b.statusText)},xhrError:function(){this.callError()},scriptRequest:function(){var a=this,b=this.options,c=document.createElement("script"),d={},e=l.isFunction(b.jsonpCallback)?b.jsonpCallback():b.jsonpCallback;d[b.jsonp]=e,this.appendDataToUrl(d),window[e]=function(b){window[e]=null,a.scriptLoad(b)},c.onerror=this.scriptError,c.async=b.async,c.src=b.url,document.head.appendChild(c)},scriptLoad:function(a){this.callSuccess(a)},scriptError:function(){this.callError()},appendDataToUrl:function(a){var b=this,c=this.options,d=/\?/.test(c.url);l.isPlainObject(a)?l.each(a,function(a,e){c.url+=b.append(d,e,a.toString())}):l.isArray(a)?l.each(a,function(a,c){b.appendDataToUrl(c)}):c.url+=b.append(d,a.toString(),"")},append:function(a,b,c){var d=a?"&":"?";return d+=b,c&&(d+="="+c),d},callSuccess:function(a){var b=this.options.success,c="success";b&&b(a,c,null),this.callComplete(c)},callError:function(a){var b=this.options.error,c="error";b&&b(null,c,a),this.callComplete(c)},callComplete:function(a){var b=this.options.complete;b&&b(null,a)}};var xb="create",yb="update",zb="destroy",Ab="GET",Bb="application/json; charset=utf-8",Cb=["change","sync","error","requestStart","requestEnd"];l.DataSource=L,L.ArrayMode=1,L.ObjectMode=2,L.prototype={options:{baseUrl:"",idAttr:"",mode:L.ArrayMode,read:{url:"",type:Ab,contentType:Bb},update:{url:"",type:"POST",contentType:Bb},create:{url:"",type:"POST",contentType:Bb},destroy:{url:"",type:"POST",contentType:Bb}},read:function(a,b){var c=this;return b=arguments[arguments.length-1],l.isFunction(a)&&(a={}),a=a||{},c._ajax("read",a,function(d){l.isString(d)&&(d=JSON.parse(d)),c.options.mode==L.ArrayMode&&(l.isArray(d)||(l.isArray(d.value)?d=d.value:l.isObject(d)&&l.each(d,function(a){return l.isArray(a)?(d=a,!1):void 0}))),l.isArray(d)||(d=[d]),a&&a.__updateData__===!1||c._updateData(d),b&&l.isFunction(b)&&b(d)}),c},update:function(){if(0!==arguments.length){var a;arguments.length>1&&l.type(arguments[0])!=l.type(arguments[1])?(a=[arguments[1]],a[0][this.options.idAttr]=arguments[0]):a=l.flatten(arguments),a.length>0&&(this._changes.push({type:yb,items:a}),this._onChangePush())}},hasChanges:function(){return this._changes.length>0},clearChanges:function(){return this._changes.splice(0,this._changes.length),this._changesMeta={},this.hasChanges(!1),this},sync:function(){var a,b=this,c=this._changes,d=c.length;return l.each(c,function(c){l.each(c.items,function(e){a=e,e.__id__&&delete e.__id__,b._ajax(c.type,{data:a},function(){d--,d||b._trigger("sync")})})}),this.clearChanges()},_ajax:function(a,b,c){var d,e=this;b=l.extend({},this.options[a],b),d=b.type.toUpperCase(),b.url=I.GenerateRoute(b.url,b.data),this._trigger("requestStart",{}),K({type:b.type,url:b.url,data:d==Ab?null:JSON.stringify(b.data),contentType:b.contentType,dataType:b.dataType,jsonp:b.jsonp,success:function(a,b,d){e._trigger("requestEnd",{}),a&&c(a,b,d)},error:function(){e._trigger("requestEnd",{}),e._trigger("error")}})},_updateData:function(a){this.data.removeAll(),this.data.addMany(a),this.clearChanges(),this._trigger("change")},_onArrayChange:function(a){var b=a.type;"remove"==b?this._remove(a.items):"removeAt"==b?this._remove(this.data.slice(a.index,a.index+a.count)):"add"==b&&this._add(a.items)},_onChangePush:function(){var a,b=this._changesMeta,c=this._changes,d=c[c.length-1],e=this.options.idAttr,f=d.type;l.each(d.items,function(d){switch(f){case xb:d.__id__=wb(),b[d.__id__]=d;break;case yb:a=b[d[e]],a&&(c.splice(a.index,1),a.item=d,a.index=c.length-1),b[d[e]]={index:c.length-1,item:d};break;case zb:a=b[d?d.__id__:void 0],a&&(c.splice(a.index,1),c.pop(),b[d.__id__]=void 0)}}),c.length>0&&this.options.autoSync?this.sync():this.hasChanges(c.length>0)},_add:function(a){this._changes.push({type:xb,items:a}),this._onChangePush()},_remove:function(a){this._changes.push({type:zb,items:a}),this._onChangePush()},_subscribeToEvents:function(){var a=this,b=this.options;l.each(Cb,function(c){b[c]&&a.on(c,b[c])})}},U.register(L.prototype,["on","_trigger","change","error","requestStart","requestEnd"]),l.core.applyExpressions("array",l.DataSource.prototype,l.toObject(["size","at","isEmpty","each"])),M.Is=function(a){return M.prototype.isPrototypeOf(a)},M.Inflate=function(a){var b,c,d={};for(b in a)c=a[b],M.Is(c)&&(c=c._options,c.propertyName=b,d[c.field||b]=c);return d},M.Create=function(a,b,c){var d;return arguments.length<3&&(c=a.value||a.defaultValue),b=a.thisArg?a.thisArg:b,d=l.observable(c,b).extend("validation",a).on("changing",a.changing,b).on("change",a.change,b),l.each(a.extenders,function(a){d=d.extend.apply(d,a)}),d},M.prototype.extend=function(){var a=this._options;return a.extenders=a.extenders||[],a.extenders.push(l.toArray(arguments)),this},N.prototype={options:{},init:l.noop,collection:function(){return this._collection},validate:function(){var a,b,c=this._properties,d=!0;for(b in c)a=this[b],l.isObservable(a)&&!a.validate()&&(d=!1);return this.valid(d),this._updateValidationErrors(),d},dataItem:function(){var a,b,c=this._properties,d={};for(a in c)b=c[a],"__id__"!=a&&l.isFunction(this[b.propertyName])&&(d[b.field||b.propertyName]=this[b.propertyName]());return this.isNew()&&delete d[this.options.idAttr],d},reset:function(a){return this._ensurePropertiesCreated(a),this},isNew:function(){var a=this.options.idAttr,b=l.unwrap(this[a]),c=this._properties[a];return!b&&0!==b||c&&b===c.defaultValue?!0:!1},read:function(a,b){return l.isFunction(a)&&(b=a,a=void 0),this._dataSource.read({data:a},b),this},destroy:function(a){return a=a===!1?!1:!0,a&&this._collection&&this._collection.remove(this),this._dataSource._remove([this.dataItem()]),this},sync:function(){return this.isNew()&&this._dataSource.add(this.dataItem()),this._dataSource.sync(),this},clone:function(){return new this.constructor(l.clone(this._initialDataItem,!0))},_setPropertyValue:function(a,b){var c=a.propertyName;l.isFunction(this[c])?(this[c](b),this._dataSource.update(this.dataItem())):this[c]=a.isObservable?this._createObservable(a,b):function(){return b}},_ensurePropertiesCreated:function(a){var b,c,d,e=this._properties;if(a){N.prototype.isPrototypeOf(a)&&(a=a.dataItem());for(c in a)b=e[c],b||(b=e[c]=l.extend({},this._application.Property.Defaults()),b.propertyName=c),this._setPropertyValue(b,a[c])}for(c in e)b=e[c],l.has(a,b.propertyName)||(d=b.field||b.propertyName,this._setPropertyValue(b,b.value||(l.has(a,d)?a[d]:b.defaultValue)))},_createObservable:function(a,b){var c=this,d=this._properties,e=M.Create(a,this,b);return e.on("change",function(){c.isNew()||c._dataSource.update(c.dataItem())}).on("validate",function(){var a,b=!0;for(a in d)if(!c[a].valid()){b=!1;break}c._updateValidationErrors(),c.valid(b)}),this._collection||e.extend(),e},_onDataSourceChange:function(){var a=l.unwrapObservable(this._dataSource.data())[0];this._ensurePropertiesCreated(a)},_updateValidationErrors:function(){var a,b,c=this._properties,d=[];for(b in c)a=this[b],a.errorMessages&&d.push.apply(d,a.errorMessages());this.validationErrors.reset(d)}},l.core.expressionsCreated&&l.core.applyExpressions("object",N.prototype);var Db=/^[#\/]|\s+$/g,Eb=/^\/+|\/+$/g,Fb=/msie [\w.]+/,Gb=/\/$/,Hb=/[?#].*$/,Ib="hash",Jb="pushState";P.prototype={start:function(){var a=this._fragment,b=document.documentMode,c=Fb.exec(navigator.userAgent.toLowerCase())&&(!b||7>=b);this._use==Ib&&c&&(this._createIFrame(),this.navigate(a)),this._initEvents(c),this._tryAdaptMechanism(a)||this._loadUrl()},navigate:function(a,b){b&&b!==!0||(b={trigger:!!b});var c=this._root+(a=this._getFragment(a||"")),d=this._use,e=this._iframe,f=this._location;if(a=a.replace(Hb,""),this._fragment===a)return!1;if(this._fragment=a,""===a&&"/"!==c&&(c=c.slice(0,-1)),this._wants==Jb&&d==Jb)this._history[b.replace?"replaceState":"pushState"]({},document.title,c);else{if(d!=Ib)return f.assign(c),!0;this._updateHash(f,a,b.replace),e&&a!==this.getFragment(this._getHash(e))&&(b.replace||e.document.open().close(),this._updateHash(e.location,a,b.replace))}return this._loadUrl(a)},_initEvents:function(a){var b=this._use,c=l.bind(this._onUrlChanged,this);this._wants==Jb&&f(document,"click",l.bind(this._onDocumentClick,this)),b==Jb?f(window,"popstate",c):b==Ib&&!a&&"onhashchange"in window?f(window,"hashchange",c):b==Ib&&(this._checkUrlInterval=setInterval(c,this._interval))},_loadUrl:function(a){var b=this._initial;return this._initial=!1,this._fragment=a=this._getFragment(a),U.trigger(this,"urlChange",{url:a,initial:b})},_getHash:function(a){var b=(a?a.location:this._location).href.match(/#(.*)$/);return b?b[1]:""},_getFragment:function(a){if(null==a)if(this._use==Jb){var b=this._root.replace(Gb,"");a=this._location.pathname,a.indexOf(b)||(a=a.slice(b.length))}else a=this._getHash();return a.replace(this._location.origin,"").replace(Db,"")},_onUrlChanged:function(){var a=this._getFragment();return a===this._fragment&&this._iframe&&(a=this._getFragment(this._getHash(this._iframe))),a===this._fragment?!1:(this._iframe&&this.navigate(a),void this._loadUrl())},_onDocumentClick:function(a){for(var b=a.target;b;){if(b&&b.tagName&&"a"==b.tagName.toLowerCase()){var c,d=b.getAttribute("download");""===d||d||!this._hostRegEx.test(b.href)||a.altKey||a.ctrlKey||a.metaKey||a.shiftKey||2===a.which||this.navigate(b.href)&&(c=document.getElementById(window.location.hash.replace(/^#/,"")),c&&c.scrollIntoView&&c.scrollIntoView(),a.preventDefault());break}b=b.parentNode}},_tryAdaptMechanism:function(a){var b=this._root,c=this._use,d=this._location,e=d.pathname.replace(/[^\/]$/,"$&/")===b;if(this._fragment=a,this._wants==Jb){if(c!=Jb&&!e)return a=this._fragment=this._getFragment(null,!0),d.replace(b+d.search+"#"+a),!0;c==Jb&&e&&d.hash&&(this._fragment=this._getHash().replace(Db,""),this._history.replaceState({},document.title,b+a+d.search))}},_updateHash:function(a,b,c){if(c){var d=a.href.replace(/(javascript:|#).*$/,"");a.replace(d+"#"+b)}else a.hash="#"+b},_createIFrame:function(){var a=document.createElement("iframe");a.style.display="none",a.src="javascript:0",a.tabIndex=-1,document.body.appendChild(a),this._iframe=a.contentWindow},_tryFixOrigin:function(){var a=window.location;a.origin||(a.origin=a.protocol+"//"+a.hostname+(a.port?":"+a.port:""))}},U.register(P.prototype,["on"]),l.observable.remote=function(a){return R(null,{options:a},null,this.__value__)},l.observable.fn.collection={read:function(a,b){var c=this;return l.isFunction(a)&&(b=a,a=void 0),this._dataSource.read({data:a},b?function(){b.call(c.__context__)}:l.noop),this},clearChanges:function(){return this._dataSource.clearChanges(),this},sync:function(){return this._dataSource.sync(),this},update:function(a,b){return 0===arguments.length?this._baseUpdate.call(this):this._dataSource.update(a,b),this},sortBy:function(a,b){if("string"==typeof a){var c=a;a=function(a){return a[c]()}}return l.sortBy(this.__value__,a,b),this},clone:function(){return R(this._Model,this._prototype,this._application,this.__value__)},_onAdding:function(a){var b=this,c=this._Model,d=a.items;l.each(d,function(a,e){N.prototype.isPrototypeOf(a)&&(a=a.dataItem()),d[e]=new c(a,b)})},_onChange:function(a){var b,c=a.type,d=a.items,e=[],f=0;if(!this._internalChanging){for(;f<d.length;f++)b=d[f],b&&("remove"==c||"add"==c&&b.isNew())&&e.push(b.dataItem());"remove"==c?this._dataSource.data.removeAt(a.index,a.items.length):"add"==c&&this._dataSource.data.addMany(e)}},_onDataSourceChange:function(){this._internalChanging=!0,this.reset(this._dataSource.data()),this._internalChanging=!1,this.clearChanges(),this._view&&this._view.trigger("ready")}},S.prototype={init:l.noop,ready:l.noop,routed:l.noop,parentView:function(){return this._parentView},route:function(){return this._application._history.navigate(l.toArray(arguments).join("/")),this},navigateTo:function(a,b){this._application.navigateTo(a,b)},_tryInitialize:function(a){!this._initialized&&a&&(this.options.url&&!this._html?(this._callInit(),this._load()):(this._initialized=!0,this._callInit(),this.isActive()&&this.isActive.update()))},_routed:function(a,b){this._tryInitialize(!0),this.routed(a,b),l.each(this._views,function(c){c.isActive()&&c._routed(a,b)}),this.isActive(!0)},_callInit:function(){if(!this._initCalled){var a,b;l.__viewInInitialize__=this;for(a in this)b=this[a],l.isObservable(b)&&(b.__context__=this);this.init(),l.__viewInInitialize__=void 0,this._initCalled=!0}},_load:function(){var a=this.options.url,b=this._application._serverData;b&&b.views&&b.views[a]&&(a=this.options.url=void 0,this._tryInitialize(!0)),a&&!this.loading()&&(this.loading(!0),K({isView:!0,url:a,success:l.bind(this._loaded,this),error:l.bind(this._error,this)}))},_loaded:function(a){this._html=a,this._tryInitialize(!0),this.loading(!1)},_error:function(){this.loading(!1)}},U.register(S.prototype,["on","off","trigger"]);var Kb;l.Application=function(a){return Kb=Kb||new T(a)},l.core.deleteApplication=function(){Kb=void 0},T.prototype={options:{history:!0},Property:function(a){return l.isString(a)?function(){return this[a]()}:(a=l.extend({},this.Property.Defaults(),a),a=new M(a))},Model:function(a){var b=this,c=function(d,e){return N.prototype.isPrototypeOf(this)?void this._super([b,a,d,e]):new c(d,e)};return a=a||{},a.options=a.options||{},l.inherit(N,c,a)},Collection:function(a,b){var c=this,d=function(e){return Q.prototype.isPrototypeOf(this)?this._super([a,b,c,e]):new d(e)};return a?N.prototype.isPrototypeOf(a.prototype)||(b=a,a=this.Model()):a=this.Model(),b=b||{},b.options=b.options||{},l.inherit(Q,d,b)},View:function(a,b,c){return 1==arguments.length?this._views[a]:void(l.isString(b)?(this._viewPrototypes[b]=this._createView(c),c.options.parentView=a):this._viewPrototypes[a]=this._createView(b))},extend:function(a){return l.extend(this,a),O(a,this),this},navigateTo:function(a,b){return a.options.route?(this._history.navigate(this._router.routeTo(a.options.routeName,b)),!0):!1},start:function(a){this._started||(this._started=!0,this._serverData=window.__blocksServerData__,this._createViews(),l.domReady(l.bind(this._ready,this,a)))},_prepare:function(){l.domReady(function(){setTimeout(l.bind(function(){this.start()},this))},this)},_startHistory:function(){this._history=new P(this.options),this._history.on("urlChange",l.bind(this._urlChange,this)).start()},_ready:function(a){this._serverData=window.__blocksServerData__,this._startHistory(),l.query(this,a),this._viewsReady(this._views)},_viewsReady:function(a){l.each(a,function(a){a.ready!==l.noop&&(a.isActive()?a.ready():a.isActive.once("change",function(){a.loading()?a.loading.once("change",function(){a.ready()}):a.ready()}))})},_urlChange:function(a){var b=this,c=this._currentView,d=this._router.routeFrom(a.url),e=!1;return l.each(d,function(d){return l.each(b._views,function(f){return f.options.routeName==d.id?(!c&&(f.options.initialPreload||a.initial&&b._serverData&&"pushState"==b.options.history)&&(f.options.url=void 0),c&&c!=f&&c.isActive(!1),f._routed(d.params,a),b._currentView=f,e=!0,!1):void 0}),e?!1:void 0}),!e&&c&&c.isActive(!1),e},_createView:function(a){return a.options=l.extend({},this.View.Defaults(),a.options),l.inherit(S,function(b,c){this._super([b,c,a])},a)},_createViews:function(){for(var a,b,c,d,e=l.pairs(this._viewPrototypes),f=this._views,g=[],h=0;0!==e.length;)for(;h<e.length;h++){if(a=e[h],b=a.value,c=b.prototype.options.parentView){if(!this._viewPrototypes[c])throw e.splice(h,1),h--,new Error("View with "+c+"does not exist");f[c]&&(d=new b(this,f[c]),f[c][a.key]=d,f[c]._views.push(d),d.parentView().isActive()||d.isActive(!1),e.splice(h,1),h--)}else d=new b(this),this[a.key]=d,e.splice(h,1),h--,c=void 0;d&&(l.has(d.options,"route")&&(d.options.routeName=this._router.registerRoute(d.options.route,this._getParentRouteName(d))),f[a.key]=d,g.push(d))}for(h=0;h<g.length;h++)g[h]._tryInitialize(g[h].isActive());this._viewPrototypes=void 0},_getParentRouteName:function(a){for(;a;){if(a.options.routeName)return a.options.routeName;a=a.parentView()}},_setDefaults:function(){this.Model.Defaults=l.observable({options:{}}).extend(),this.Collection.Defaults=l.observable({options:{}}).extend(),this.Property.Defaults=l.observable({isObservable:!0,validateOnChange:!1,maxErrors:1,validateInitially:!1}).extend(),this.View.Defaults=l.observable({options:{}}).extend()}}}()}();var o=a.blocks;return l.noConflict=function(b){return a.blocks===l&&(a.blocks=o),b&&a.blocks===l&&(a.blocks=o),l},"function"==typeof define&&define.amd&&define("blocks",[],function(){return l}),b!==!0&&(a.blocks=l),l});
				//# sourceMappingURL=blocks.min.js.map
				// JSBlocks code

				blocks.query({
			        name: blocks.observable( 'The title for your amazing list' ),
			        description: blocks.observable( 'A single description for your awesome list.' ),
					urls: blocks.observable([]),
			        clicked: function (e) {
			        	e.preventDefault();
					    // this points to the model
					    //$( this.clickCount ).insertBefore( '.button.new' );

					    this.urls.push( this.url() );
			            this.url('');
					},

					clickCount: '<div class="ui icon input">'
							+ '<input type="text" placeholder="Insert URL" data-query="val(url)" autofocus>'
							+ '<i class="browser icon"></i>'
						+ '</div>'
						+ '<div class="ui inverted divider"></div>',

					url: blocks.observable(),
			    });

			    this.checkLists();

				// is.js Library
			    $.getScript( 'https://cdn.rawgit.com/arasatasaygin/is.js/master/is.min.js' );
			    $.getScript( 'https://cdn.rawgit.com/padolsey-archive/jquery.fn/master/cross-domain-ajax/jquery.xdomainajax.js' );
			}

		,	events: {
					'submit #list-manager-form': 'listManagerAdd'
				// ,	'keyup .new-element': 'newListManagerEl'
				,	'click .add-url': 'newListManagerElClicking'
				,	'keyup .set-title': 'setTitle'
				,	'keyup .set-description': 'setDescription'
				,	'click .send-list': 'sendDataToServer'
				,	'click .create-new': 'reset'
				,	'click .remove-this': 'removeItemFromList'
				,	'click .generate-list': 'generateTheList'

			}

			// Trash a post
		,	trashListManager: function( e ) {
				e.preventDefault();

			}

			// Add new elements to the lists manager
		,	listManagerAdd: function ( e ) {

				e.preventDefault();

				var target = e.currentTarget;

				var data = utilities.formToObject( '#list-manager-form', false, false );
				var tpl = '<li><i class="icon-circle"></i></li>';

				$( '.list-manager-loader' ).show();

				localStorage.listManager = JSON.stringify( data );

				$( '.element-adder' ).removeClass( 'hidden' );

				// $( '.ten.wide.column' ).hide();
				// $( '.six.wide.column' ).addClass( 'full' );

				$( '.ten.wide.column' ).addClass( 'over-out' );

				setTimeout( function () {

					$( '.ten.wide.column' ).addClass( 'none' );

				}, 80 );


				$( '.six.wide.column' ).addClass( 'full clare' );

				setTimeout( function () {

					$( '.list-manager-loader' ).hide();
				}, 1000 );
			}

			// new url for list
		,	newListManagerEl: function ( e ) {

				e.preventDefault();

				var target = e.currentTarget;

				if ( e.which == 13 ) {
					console.warn( $( target ).val() );
				}

			}

			// Check results for url
		,	newListManagerElClicking: function ( e ) {

				e.preventDefault();

				var target = e.currentTarget
				,	url = $( '.new-element' ).val()
				,	listManager = JSON.parse( localStorage.listManager )

				// Set regex rule for urls
				// is.setRegexp( /^(http|https)/, 'url' );


				// Check if is url
				if ( ! is.url( url ) ) {

					$( '.new-element' ).addClass( 'error' );
					return;
				}

				else {

					if ( ! is.startWith( url, 'http' ) )
						url = 'http://' + url;

					$( '.new-element' ).removeClass( 'error' ).addClass( 'disabled' );
					$( '.add-url' ).addClass( 'disabled' ).html( '<i class="icon-spinner"></i> Loading' );
					$( '.list-manager-loader' ).show();
				}

				// Check if exists items in the object
				if ( ! listManager.items )
					listManager.items = [];


				// Add urls to object
				listManager.items.push( url );

				localStorage.listManager = JSON.stringify( listManager );


				// Send data for checking results on db
				var checkData = {};

				checkData.url = url;

				window.Bppl.Models.ListManager.checkItem( checkData, function( data ) {

					// Add data to view and get feedback
	    			var urlInfo = data.data.data;

	    			var wrapper = $("<div></div>").append( data.responseText )
    				,	title
    				,	description

    				if ( urlInfo.title == undefined )
    					title = '<input type="text" class="set-title" placeholder="Write a title"/>';
    				else
    					title = urlInfo.title;

    				if ( urlInfo.description == undefined )
    					description = '<input type="text" class="set-description" placeholder="Write short description"/>';
    				else
    					description = urlInfo.description;

    				var	tpl = '<li>'
								+ '<h3><i class="icon-chevron-right"></i>' + title + '</h3>'
								+ '<p>' + description + '</p>'
    						+ '</li>';

    				// $( tpl ).insertAfter( '.element-adder > h4' );
    				$( tpl ).insertBefore( '.element-adder .urls' );

    				// Remove value saved on the input
    				$( '.new-element' ).val( '' ).removeClass( 'disabled' );
					$( '.add-url' ).removeClass( 'disabled' ).html( '<i class="icon-plus"></i> Add URL' );
					$( '.list-manager-loader' ).hide();
        		});

			}

			// Set title if not exist
		,	setTitle: function ( e ) {

				e.preventDefault();

				var target = e.currentTarget;

				if ( e.which == 13 ) {
					$( target ).parent().html( '<i class="icon-chevron-right"></i>' + $( target ).val() );
				}

			}

			// Set Description if not exist
		,	setDescription: function ( e ) {

				e.preventDefault();

				var target = e.currentTarget;

				if ( e.which == 13 ) {
					$( target ).parent().html( $( target ).val() );
				}

			}

			// Sen dat to server
		,	sendDataToServer: function ( e ) {
				e.preventDefault();

				var target = e.currentTarget;

				// Check if the user is loggued
				if ( $( target ).hasClass( 'not-logged-in' ) ) {

					$( '.no-login-schema' ).click();

				} else {

					$( '.list-manager-loader' ).show();

					// Send data to server and save in json file.
					data = JSON.parse( localStorage.listManager );

					window.Bppl.Models.ListManager.saveList( data, function( r ) {

						// Add data to view and get feedback

		    			// var objectInfo = r.data.req;
		    			var objectInfo = r.data;

		    			if ( objectInfo.message && objectInfo.message.length > 1 ) {

			    			$( '.list-manager-loader' ).hide();

			    			delete localStorage.listManager;

			    			utilities.alert( objectInfo.message );

			    			$( '.send-list, .add-url' ).addClass( 'disabled' );

		    			}

	        		});
				}

			}

			// Reset data
		,	reset: function ( e ) {
				e.preventDefault();

				if ( ! confirm( 'Do you want to create another list?' ) )
					return;

				delete localStorage.listManager;

				window.location.reload();

				// Send data to server and save in json file.
				data = JSON.parse( localStorage.listManager );

				window.Bppl.Models.ListManager.saveList( data, function( r ) {

					// Add data to view and get feedback

	    			// var objectInfo = r.data.req;
	    			var objectInfo = r.data;

	    			if ( objectInfo.message && objectInfo.message.length > 1 ) {

		    			utilities.alert( objectInfo.message ); return;
	    			}

        		});
			}

		,	checkLists: function () {

				if ( localStorage.listManager ) {

					var listManager = JSON.parse( localStorage.listManager );

					console.log( listManager );

					$( '.element-adder' ).removeClass( 'hidden' );

					$( '.ten.wide.column' ).hide();
					$( '.six.wide.column' ).addClass( 'full' );

					$( '.the-list > li h3' ).html( listManager.list_name );
					$( '.the-list > li p' ).html( listManager.list_description );

					if ( ! listManager.items ) {
						$( '.list-manager-loader' ).hide();
						return;
					}

					$.each( listManager.items, function ( k, v ) {

						// console.log( v );

						var checkData = {};
						checkData.url = v;

						window.Bppl.Models.ListManager.checkItem( checkData, function( data ) {

							// Add data to view and get feedback
			    			var urlInfo = data.data.data;

			    			var wrapper = $("<div></div>").append( data.responseText )
		    				,	title
		    				,	description

		    				if ( urlInfo.title == undefined )
		    					title = '<input type="text" class="set-title" placeholder="Write a title"/>';
		    				else
		    					title = urlInfo.title;

		    				if ( urlInfo.description == undefined )
		    					description = '<input type="text" class="set-description" placeholder="Write short description"/>';
		    				else
		    					description = urlInfo.description;

		    				// Check if the current user is admin or not
		    				if ( window.Constants.ltnm ) {
		    					var	tpl = '<li>'
										+ '<h3>' + title + '</h3>'
										+ '<p>' + description + '</p>'
										+ '<p><b>Url requested: </b> <a href="' + checkData.url + '" target="_blank"><b><i> ' + checkData.url + '</i></b></a></p>'
										+ '<span class="remove-this btn btn-view-more btn-view-more-red" data-url="' + checkData.url + '"><i class="icon-remove"></i> Remove</span>'
		    						+ '</li>';
		    				}

		    				else {

			    				var	tpl = '<li>'
											+ '<h3><i class="icon-chevron-right"></i>' + title + '</h3>'
											+ '<p>' + description + '</p>'
			    						+ '</li>';
		    				}

		    				// $( tpl ).insertAfter( '.element-adder > h4' );
		    				$( tpl ).insertBefore( '.element-adder .urls' );

		    				// Remove value saved on the input
		    				$( '.new-element' ).val( '' ).removeClass( 'disabled' );
							$( '.add-url' ).removeClass( 'disabled' ).html( '<i class="icon-plus"></i> Add URL' );

		        		});
					});

				}

				$( '.list-manager-loader' ).hide();

			}

			// Remove oitem form sended list
		,	removeItemFromList: function ( e ) {

				e.preventDefault();

				var target = e.currentTarget
				,	element = $( target ).parent()
				,	removableUrl = $( target ).attr( 'data-url' )
				,	listManager = JSON.parse( localStorage.listManager );

				element.remove();

				// remmove from array

				listManager.items = jQuery.grep( listManager.items, function( value ) {

				  return value != removableUrl;

				});

				// Save the new list object
				localStorage.listManager = JSON.stringify( listManager );

			}

		,	generateTheList: function ( e ) {

				e.preventDefault();

				var listManager = JSON.parse( localStorage.listManager )
				,	user = listManager.user

				listManager.items = [];

				$( '.list-manager-loader' ).show();

				$( '.element-adder li' ).each( function ( k, v ) {
					console.log( v );
					var post = {};

					post.url = $( v ).find( 'span' ).attr( 'data-url' );
					post.title = $( v ).find( 'h3' ).text();
					post.description = $( v ).find( 'p:first' ).text();

					// console.log( post );
					listManager.items.push( post );
				});


				// Save the new list object
				localStorage.listManager = JSON.stringify( listManager );

				// console.log( listManager );return;

				window.Bppl.Models.ListManager.save( listManager, function( data ) {
					console.log( data );
					$( '.list-manager-loader' ).hide();
					utilities.alert( 'The list was saved.' );
				});

			}
	});

	// Global Exposition
	window.Bppl.Handlers.ListManager = new ListManager();



})( this.jQuery, this, this.document, this.Bppl.Views.ListManager, this.Bppl.Models.ListManager, this.Bppl.Controllers.ListManager, this.Bppl.Helpers.Utilities, undefined );


